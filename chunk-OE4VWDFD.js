import{a as P,b as ce}from"./chunk-ITLSRYM2.js";import{a as L,b as z,c as ee,d as te,e as ae,f as le,g as se,h as ne,i as re,j as oe,k as ie,l as j}from"./chunk-AFU5KDMG.js";import{b as Q,e as R,f as X,h as Y,i as _}from"./chunk-JAENS3D3.js";import{a as $}from"./chunk-A2OWKKGL.js";import{g as A,k as G}from"./chunk-I4Q2S2XA.js";import{b as J,c as K}from"./chunk-77L5NP7A.js";import{a as w}from"./chunk-OLOKUDVI.js";import{b as H}from"./chunk-R4A63S45.js";import{r as V,t as E}from"./chunk-UHRSAPGQ.js";import{a as I,b as N}from"./chunk-N2WTMF3X.js";var M=L.size,O=L.maxSize,F=L.maxOutlineSize,pe=L.lineWidth,U=L.tallSymbolWidth;function C(e){let t=e.outline,n=e.material!=null?e.material.color:null,a=n!=null?n.toHex():null;if(t==null||"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&a==="#ffffff"?{color:"#bdc3c7",width:.75}:null;let s=w(t.size)||0;return{color:"rgba("+(t.color!=null?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,F),style:"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"?R(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}async function he(e,t){if(e.thumbnail?.url)return e.thumbnail.url;if(t.type==="icon"&&t?.resource?.href)return _(t);let n=H("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){let a=await $(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(a&&"thumbnail"in a&&a.thumbnail?.url)return a.thumbnail.url}return n}function T(e,t=1){let n=e.a,a=K(e),s=a.h,c=a.s/t,o=100-(100-a.v)/t,{r:h,g:y,b:i}=J({h:s,s:c,v:o});return[h,y,i,n]}function W(e){return e.type==="water"?e.color==null?null:e.color:e.material?.color==null?null:e.material.color}function r(e,t=0){let n=W(e);if(!n){if(e.type==="fill")return null;let s=X.r,c=j(s,t);return[c,c,c,100]}let a=n.toRgba();for(let s=0;s<3;s++)a[s]=j(a[s],t);return a}async function me(e,t){let n=e.style;return n==="none"?null:{type:"pattern",x:0,y:0,src:await Q(H(`esri/symbols/patterns/${n}.png`),t.toCss(!0)),width:5,height:5}}function ue(e){return e.outline?C(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Z(e,t){let n=W(e);if(!n)return null;let a="rgba(";return a+=j(n.r,t)+",",a+=j(n.g,t)+",",a+=j(n.b,t)+",",a+n.a+");"}function q(e,t){let n=Z(e,t);return n?"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:n,width:Math.min(e.size?w(e.size):.75,F),style:"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"?R(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?w(2):e.join:null}:{}}function D(e,t,n){let a=n!=null?.75*n:0;return{type:"linear",x1:a?.25*a:0,y1:a?.5*a:0,x2:a||4,y2:a?.5*a:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function fe(e){let t=e.depth,n=e.height,a=e.width;return a!==0&&t!==0&&n!==0&&a===t&&a!=null&&n!=null&&a<n}function ye(e,t,n){let a=[];if(!e)return a;switch(e.type){case"icon":{let o=t,h=t;switch(e.resource?.primitive??A){case"circle":a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:r(e,0),stroke:C(e)});break;case"square":a.push({shape:{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)});break;case"triangle":a.push({shape:{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)});break;case"cross":a.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,h]},{command:"M",values:[0,.5*h]},{command:"L",values:[o,.5*h]}]},stroke:ue(e)});break;case"x":a.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,h]},{command:"M",values:[o,0]},{command:"L",values:[0,h]}]},stroke:ue(e)});break;case"kite":a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*h]},{command:"L",values:[.5*o,h]},{command:"Z",values:[]}]},fill:r(e,0),stroke:C(e)})}break}case"object":switch(e.resource?.primitive??G){case"cone":{let s=D(r(e,0),r(e,-.6),n?U:t),c=ne(t,n);a.push({shape:c[0],fill:s},{shape:c[1],fill:s});break}case"inverted-cone":{let s=r(e,0),c=D(s,r(e,-.6),t),o=re(t);a.push({shape:o[0],fill:c},{shape:o[1],fill:s});break}case"cube":{let s=le(t,n);a.push({shape:s[0],fill:r(e,0)},{shape:s[1],fill:r(e,-.3)},{shape:s[2],fill:r(e,-.5)});break}case"cylinder":{let s=D(r(e,0),r(e,-.6),n?U:t),c=se(t,n);a.push({shape:c[0],fill:s},{shape:c[1],fill:s},{shape:c[2],fill:r(e,0)});break}case"diamond":{let s=oe(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.3)},{shape:s[3],fill:r(e,-.7)});break}case"sphere":{let s=D(r(e,0),r(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,a.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{let s=ie(t);a.push({shape:s[0],fill:r(e,-.3)},{shape:s[1],fill:r(e,0)},{shape:s[2],fill:r(e,-.6)});break}}break}return a}function B(e){let t=typeof e?.size=="number"?e?.size:null;return t?w(t):null}function de(e){return e.type==="icon"?"multiply":"tint"}async function be(e,t){let n=B(t),a=t?.maxSize?w(t.maxSize):null,s=t?.disableUpsampling??!1,c=e.symbolLayers,o=[],h=[],y=!1,i=0,d=0,v=0;c.forEach(l=>{if(l.type!=="icon"&&l.type!=="object")return;l&&l.type==="icon"&&(v=Math.max(l.size&&w(l.size),v));let p=l.type==="icon"?l.size&&w(l.size):0,u=n||p?Math.ceil(Math.min(n||p,a||O)):M,f=l.type==="icon"?l.angle:null;if(t?.rotation!=null&&(f=(f??0)+t.rotation),h.push(f),l?.resource?.href){let b=he(e,l).then(g=>{let x=l?.material?.color,S=de(l);return ce(g,u,x,S,s)}).then(g=>{let x=g.width,S=g.height;return i=Math.max(i,x),d=Math.max(d,S),f&&(y=!0),[{shape:{type:"image",x:0,y:0,width:x,height:S,src:g.url},fill:null,stroke:null}]});o.push(b)}else{let b=u;l.type==="icon"&&n&&(b=u*(p/v));let g=t?.symbolConfig==="tall"||t?.symbolConfig?.isTall||l.type==="object"&&fe(l);i=Math.max(i,g?U:b),d=Math.max(d,b),f&&l.resource?.primitive&&["square","triangle","x"].includes(l.resource?.primitive)&&(y=!0),o.push(Promise.resolve(ye(l,b,g)))}});let m=await Promise.allSettled(o),k=[];return m.forEach(l=>{l.status==="fulfilled"?k.push(l.value):l.reason&&V.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",l.reason)}),P(k,[i,d],{node:t?.node,scale:!1,opacity:t?.opacity,ariaLabel:t?.ariaLabel,rotations:h,useRotationSize:y})}function ge(e,t){let n=e.symbolLayers,a=[],s=Y(e),c=B(t),o=(t?.maxSize?w(t.maxSize):null)||F,h,y=0,i=0;return n.forEach((d,v)=>{if(!d||d.type!=="line"&&d.type!=="path")return;let m=[];switch(d.type){case"line":{let k=q(d,0);if(k==null)break;let l=k?.width||0;v===0&&(h=l);let p=Math.min(c||l,o),u=v===0?p:c?p*(l/h):p,f=u>pe/2?2*u:pe;i=Math.max(i,u),y=Math.max(y,f),k.width=u,m.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[y,.5*i]}]},stroke:k});break}case"path":{let k=Math.min(c||M,o),l=r(d,0),p=r(d,-.2),u=Z(d,-.4),f=u?{color:u,width:1}:{};if(d.profile==="quad"){let b=d.width,g=d.height,x=ee(b&&g?b/g:1,g===0,b===0),S=N(I({},f),{join:"bevel"});m.push({shape:x[0],fill:p,stroke:S},{shape:x[1],fill:p,stroke:S},{shape:x[2],fill:l,stroke:S})}else m.push({shape:z.pathSymbol3DLayer[0],fill:p,stroke:f},{shape:z.pathSymbol3DLayer[1],fill:l,stroke:f});i=Math.max(i,k),y=i}}a.push(m)}),Promise.resolve(P(a,[y,i],{node:t?.node,scale:s,opacity:t?.opacity,ariaLabel:t?.ariaLabel}))}async function ke(e,t){let n=e.type==="mesh-3d",a=e.symbolLayers,s=B(t),c=t?.maxSize?w(t.maxSize):null,o=s||M,h=[],y=0,i=0,d=!1;for(let v=0;v<a.length;v++){let m=a.at(v),k=[];if(!n||m.type==="fill"){switch(m.type){case"fill":{let l=Math.min(o,c||O);if(y=Math.max(y,l),i=Math.max(i,l),d=!0,n){let p=z.meshSymbol3DFill,u=Z(m,-.4),f=u?{color:u,width:1,join:"round"}:{};k.push({shape:p[0],fill:r(m,0),stroke:f},{shape:p[1],fill:r(m,-.2),stroke:f},{shape:p[2],fill:r(m,-.6),stroke:f})}else{let p=r(m,0),u="pattern"in m?m.pattern:null,f=C(m),b=W(m);u!=null&&u.type==="style"&&u.style!=="solid"&&b&&(p=await me(u,b)),k.push({shape:z.fill[0],fill:p,stroke:f})}break}case"line":{let l=q(m,0);if(l==null)break;let p={stroke:l,shape:z.fill[0]};y=Math.max(y,M),i=Math.max(i,M),k.push(p);break}case"extrude":{let l=I({join:"round",width:1},q(m,-.4)),p=r(m,0),u=r(m,-.2),f=Math.min(o,c||O),b=te(f);l.width=1,k.push({shape:b[0],fill:u,stroke:l},{shape:b[1],fill:u,stroke:l},{shape:b[2],fill:p,stroke:l});let g=M,x=.7*M+.5*f;y=Math.max(y,g),i=Math.max(i,x);break}case"water":{let l=W(m),p=T(l),u=T(l,2),f=T(l,3),b=ae();d=!0,k.push({shape:b[0],fill:p},{shape:b[1],fill:u},{shape:b[2],fill:f});let g=Math.min(o,c||O);y=Math.max(y,g),i=Math.max(i,g);break}}h.push(k)}}return P(h,[y,i],{node:t?.node,scale:d,opacity:t?.opacity,ariaLabel:t?.ariaLabel})}function Ie(e,t){if(e.symbolLayers.length===0)return Promise.reject(new E("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return be(e,t);case"line-3d":return ge(e,t);case"polygon-3d":case"mesh-3d":return ke(e,t)}return Promise.reject(new E("symbolPreview: swatchInfo3D","symbol not supported."))}export{r as a,me as b,B as c,Ie as d};
