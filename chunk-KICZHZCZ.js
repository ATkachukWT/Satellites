import{b as u}from"./chunk-AFC2H4Q3.js";import{c as v}from"./chunk-YR2HD3ZC.js";import{H as s}from"./chunk-QHVIRF5H.js";import{I as $}from"./chunk-WZDN6K3C.js";import{a as i}from"./chunk-QGVBCWUY.js";import{E as V,O as b,j as g,m as L}from"./chunk-CKJ56T2Q.js";import{r as w}from"./chunk-UHRSAPGQ.js";var y=Symbol(),G=F=>{let r=class extends F{constructor(){super(...arguments),this.layerViews=new v,this._debouncedUpdate=b(async()=>{let{layer:t,parent:a}=this,o=a?.footprintLayerView,n=[],d=this._createQuery();if(d&&o){let{features:m}=await o.queryFeatures(d);this.suspended||(n=m.map(h=>t.acquireLayer(h)))}this.removeHandles(y),this.addHandles(n,y)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(t=>t.updating)}enableLayerUpdates(){return L([this._updatingHandles.addWhen(()=>this.parent?.footprintLayerView?.dataUpdating===!1,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),g(()=>this.removeHandles(y))])}updateLayers(){this.suspended?this.removeHandles(y):this._updatingHandles.addPromise(V(this._debouncedUpdate()).catch(t=>{w.getLogger(this).error(t)}))}_createQuery(){let t=this.parent?.footprintLayerView,a=this.layer?.parent;if(!t||!a||a.destroyed)return null;let{layer:{maximumVisibleSublayers:o},view:{scale:n}}=this;if(!o)return null;let{itemTypeField:d,itemSourceField:m,itemNameField:h,minScaleField:c,maxScaleField:f,objectIdField:S,orderBy:H}=a,U=u(`${c} IS NULL OR ${n} <= ${c} OR ${c} = 0`,`${f} IS NULL OR ${n} >= ${f}`),p=H?.find(l=>l.field&&!l.valueExpression),e=t.createQuery();if(e.returnGeometry=!1,e.num=o,e.outFields=[S,m,h],e.where=u(e.where,U),this.unsupportedItemTypes!=null){let l=`${d} NOT IN (${this.unsupportedItemTypes.map(_=>`'${_}'`)})`;e.where=u(e.where,l)}return p?.field&&(e.orderByFields=[`${p.field} ${p.order==="descending"?"DESC":"ASC"}`],e.outFields.push(p.field)),e}};return i([s({readOnly:!0})],r.prototype,"creatingLayerViews",null),i([s()],r.prototype,"layer",void 0),i([s()],r.prototype,"layerViews",void 0),i([s({readOnly:!0})],r.prototype,"unsupportedItemTypes",void 0),i([s()],r.prototype,"parent",void 0),i([s({readOnly:!0})],r.prototype,"isUpdating",null),r=i([$("esri.views.layers.CatalogDynamicGroupLayerView")],r),r};export{G as a};
