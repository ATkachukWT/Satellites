import{a as O}from"./chunk-NLZLCUU5.js";import{a as E}from"./chunk-WPZN772I.js";import{p as v}from"./chunk-4ABKPPKG.js";import{L as x,O as g,d as h,j as d}from"./chunk-KD27XIJC.js";import{l as c}from"./chunk-B3FO6PT7.js";import{a as k}from"./chunk-4XZ6X7MQ.js";import{E as w,d as I}from"./chunk-ETE32IYO.js";import{S as b}from"./chunk-ONUGDWDK.js";import{b as p,k as P}from"./chunk-UHRSAPGQ.js";var M={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function K(s){let o=s.folders||[],t=o.slice(),e=new Map,n=new Map,a=new Map,f=new Map,y=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:a,esriGeometryPolygon:f};(s.featureCollection?.layers||[]).forEach(r=>{let m=p(r);m.featureSet.features=[];let i=r.featureSet.geometryType;e.set(i,m);let S=r.layerDefinition.objectIdField;i==="esriGeometryPoint"?G(n,S,r.featureSet.features):i==="esriGeometryPolyline"?G(a,S,r.featureSet.features):i==="esriGeometryPolygon"&&G(f,S,r.featureSet.features)}),s.groundOverlays&&s.groundOverlays.forEach(r=>{y.set(r.id,r)}),o.forEach(r=>{r.networkLinkIds.forEach(m=>{let i=N(m,r.id,s.networkLinks);i&&t.push(i)})}),t.forEach(r=>{if(r.featureInfos){r.points=p(e.get("esriGeometryPoint")),r.polylines=p(e.get("esriGeometryPolyline")),r.polygons=p(e.get("esriGeometryPolygon")),r.mapImages=[];for(let m of r.featureInfos)switch(m.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{let i=l[m.type].get(m.id);i&&r[M[m.type]]?.featureSet.features.push(i);break}case"GroundOverlay":{let i=y.get(m.id);i&&r.mapImages.push(i);break}}r.fullExtent=F([r])}});let u=F(t);return{folders:o,sublayers:t,extent:u}}function Q(s,o,t,e){let n=I?.findCredential(s);s=b(s,{token:n?.token});let a=P.kmlServiceUrl;return w(a,{query:{url:s,model:"simple",folders:"",refresh:t!==0||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:e})}function U(s,o,t=null,e=[]){let n=[],a={},f=o.sublayers,y=new Set(o.folders.map(l=>l.id));return f.forEach(l=>{let u=new s;if(t?u.read(l,t):u.read(l),e.length&&y.has(u.id)&&(u.visible=e.includes(u.id)),a[l.id]=u,l.parentFolderId!=null&&l.parentFolderId!==-1){let r=a[l.parentFolderId];r.sublayers||(r.sublayers=[]),r.sublayers?.unshift(u)}else n.unshift(u)}),n}function G(s,o,t){t.forEach(e=>{s.set(e.attributes[o],e)})}function J(s,o){let t;return o.some(e=>e.id===s&&(t=e,!0)),t}function N(s,o,t){let e=J(s,t);return e&&(e.parentFolderId=o,e.networkLink=e),e}async function X(s){let o=E.fromJSON(s.featureSet).features,t=s.layerDefinition,e=O(t.drawingInfo.renderer),n=v.fromJSON(s.popupInfo),a=[];for(let f of o){let y=await e.getSymbolAsync(f);f.symbol=y,f.popupTemplate=n,f.visible=!0,a.push(f)}return a}function F(s){let o=h(g),t=h(g);for(let e of s){if(e.polygons?.featureSet?.features)for(let n of e.polygons.featureSet.features)c(o,n.geometry),d(t,o);if(e.polylines?.featureSet?.features)for(let n of e.polylines.featureSet.features)c(o,n.geometry),d(t,o);if(e.points?.featureSet?.features)for(let n of e.points.featureSet.features)c(o,n.geometry),d(t,o);if(e.mapImages)for(let n of e.mapImages)c(o,n.extent),d(t,o)}return x(t,g)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:k.WGS84}}export{K as a,Q as b,U as c,X as d,F as e};
