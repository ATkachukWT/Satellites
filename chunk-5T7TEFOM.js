import{a as V,b as g,c as p}from"./chunk-QW5LN4Z5.js";import"./chunk-F7NFZM65.js";import{b as C}from"./chunk-O4MHA7YC.js";import"./chunk-2JKSIF4Q.js";import"./chunk-YQGS4EZO.js";import"./chunk-3REMXE4W.js";import"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-KAMRW6HF.js";import"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-USMAJP2P.js";import"./chunk-4N5OXIEM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-JTDXB5TK.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-NHEQ4TAR.js";import"./chunk-BIRSPTTF.js";import"./chunk-IZLELRQR.js";import"./chunk-7EMOONQX.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import{c as y,d as P,e as _}from"./chunk-I2UM4WSJ.js";import{e as n,f as x}from"./chunk-DCHNVAWJ.js";import"./chunk-64RBIOV3.js";import"./chunk-6Z6LKUG5.js";import{a as v}from"./chunk-V2GNNIXD.js";import{b as T}from"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import{a as N}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import{a as k}from"./chunk-NMRTZBDM.js";import"./chunk-XZIOXVVJ.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as r}from"./chunk-QHVIRF5H.js";import{I as f}from"./chunk-WZDN6K3C.js";import{a as s}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{o as F}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-L4EKTZIP.js";import"./chunk-N2WTMF3X.js";var w="esri-utility-network-association-list",b={featureObserver:`${w}__feature-observer`,filterContainer:`${w}__filter-container`,limitNoticeContainer:`${w}__limit-notice-container`,loadingContainer:`${w}__loading-container`},l=class extends P{constructor(t,e){super(t,e),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver(([o])=>{o?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.filterText="",this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new k,this.viewModel=new p}initialize(){this.setUpObserver()}loadDependencies(){return y({icon:()=>import("./chunk-A7SCRTXK.js"),input:()=>import("./chunk-GNJKUSIE.js"),loader:()=>import("./chunk-43NVUQHZ.js"),notice:()=>import("./chunk-5ZX46MTW.js")})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){let t=this.viewModel.associationViewModels,e=this.selectedLayer?t.get(this.selectedLayer):null;return e?e.length:0}set currentFeaturePage(t){let{featuresPerPage:e,associatedFeatureCount:o}=this,i=Math.ceil(o/e)||1,a=Math.max(Math.min(t,i),1);this._set("currentFeaturePage",a)}get currentFeaturePage(){return this._get("currentFeaturePage")??1}get endIndex(){let{currentFeaturePage:t,featuresPerPage:e,maxFeatureCount:o}=this;return Math.min(t*e,o)}renderConnectivityIcon(t,e){let{tooltipReferenceMap:o}=this,i;switch(t){case"junction-edge-from-connectivity":i="connection-end-left";break;case"junction-edge-to-connectivity":i="connection-end-right";break;case"junction-edge-midspan-connectivity":i="connection-middle";break;default:i="connection-to-connection"}return n("calcite-icon",{afterCreate:a=>o.set(e,a),afterRemoved:()=>o.delete(e),icon:i,scale:"s",slot:"content-start"})}renderFeatureCountWarning(){let{associatedFeatureCount:t,maxFeatureCount:e,messagesFeature:o}=this;return t>e?n("calcite-notice",{class:this._isFeatureCountNoticeOpen?b.limitNoticeContainer:void 0,closable:!0,icon:"information",kind:"info",open:!0,scale:"s",width:"full",onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},n("div",{slot:"title"},o.associationsLimitNoticeTitle),n("div",{slot:"message"},v(o.associationsLimitNoticeMessage,{number:e}))):null}renderFeatureObserver(){return n("div",{afterCreate:this._onObserverCreate,bind:this,class:b.featureObserver,key:"feature-observer"})}renderFilter(){return n("div",{class:b.filterContainer,key:"filter"},n("calcite-input",{icon:"search",placeholder:this.messagesFeature.associationFilterPlaceholder,type:"search",onCalciteInputInput:t=>{this.filterText=t.currentTarget.value.trim().toLowerCase(),this.currentFeaturePage=1}}))}renderLoading(){return n("div",{class:b.loadingContainer,key:"loading-container"},this.renderLoadingIcon())}renderLoadingIcon(){return n("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(t){let{messagesFeature:e}=this;switch(t){case"connectivity":case"junction-junction-connectivity":return e.associationsJunctionJunction;case"junction-edge-from-connectivity":return e.associationsJunctionEdgeFrom;case"junction-edge-midspan-connectivity":return e.associationsJunctionEdgeMidspan;case"junction-edge-to-connectivity":return e.associationsJunctionEdgeTo;default:return""}}setUpObserver(){this.addHandles(N(()=>this._observerNode,()=>this._onObserverChange()))}_increaseFeaturePage(){this.currentFeaturePage++}async _onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);let{state:t,showAllEnabled:e}=this.viewModel;this._observerNode&&t==="ready"&&e&&this._observer.observe(this._observerNode)}_onObserverCreate(t){this._observerNode=t}};s([r()],l.prototype,"_observer",void 0),s([r()],l.prototype,"_observerNode",void 0),s([r()],l.prototype,"associatedFeatureCount",null),s([r()],l.prototype,"currentFeaturePage",null),s([r()],l.prototype,"endIndex",null),s([r()],l.prototype,"featuresPerPage",void 0),s([r()],l.prototype,"filterText",void 0),s([r()],l.prototype,"headingLevel",void 0),s([r()],l.prototype,"maxFeatureCount",void 0),s([r(),_("esri/widgets/Feature/t9n/Feature")],l.prototype,"messagesFeature",void 0),s([r(),_("esri/t9n/common")],l.prototype,"messagesCommon",void 0),s([r()],l.prototype,"selectedLayer",void 0),s([r()],l.prototype,"tooltipReferenceMap",void 0),s([r({type:p})],l.prototype,"viewModel",void 0),l=s([f("esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList")],l);var E=l;function M(t){let{percentAlong:e}=t;return e==null?"":T(e,{style:"percent",maximumFractionDigits:2})}function I(t){let{associationType:e}=t;return e==="connectivity"||e==="junction-junction-connectivity"||e==="junction-edge-from-connectivity"||e==="junction-edge-midspan-connectivity"||e==="junction-edge-to-connectivity"}function O(t){return t.associationType==="junction-edge-midspan-connectivity"}var A,j="esri-feature-utility-network-associations",R={base:j,listItemHidden:`${j}__list-item--hidden`},$="nested",c=A=class extends E{constructor(t,e){super(t,e),this.description=null,this.flowItems=null,this.flowType="feature-utility-network-association-type",this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new p,this.visibleElements=new g}initialize(){this.setUpObserver()}loadDependencies(){return y({chip:()=>import("./chunk-3D46QYDW.js"),icon:()=>import("./chunk-A7SCRTXK.js"),list:()=>import("./chunk-BLHBX2NH.js"),"list-item":()=>import("./chunk-5G3JHIPS.js"),tooltip:()=>import("./chunk-LXEV3PFE.js")})}destroy(){this.tooltipReferenceMap.clear()}render(){let t=this.viewModel.associationViewModels,{state:e,showAllEnabled:o}=this.viewModel,{state:i}=this.parentFeatureViewModel??{};return n("div",{class:this.classes(R.base,V.widget)},e==="loading"||e==="querying"||i==="loading"?this.renderLoading():n("calcite-list",{displayMode:$,label:this.selectedLayer?.title??this.messagesCommon.untitled},o&&this.selectedLayer?n(x,null,this.renderFilter(),this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):Array.from(t.keys(),a=>this._renderTypeList(a,t.get(a)))))}_showAllAssociations(t){let{flowItems:e,viewModel:o,description:i}=this;if(!e||!t)return;o.showAllEnabled=!0;let a=new A({selectedLayer:t,title:t?.title,flowItems:e,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:i,visibleElements:new g({title:!1,description:!1}),viewModel:o});e.push(a)}_renderAssociatedFeatureListPage(){let t=this.viewModel.associationViewModels.get(this.selectedLayer).filter(e=>C(e.featureViewModel).toLowerCase().includes(this.filterText)).slice(0,this.endIndex);return[...this._renderTooltips(t),...this._renderAssociatedFeatureList(t)]}_renderItemTooltip(t){let{tooltipReferenceMap:e}=this;return I(t.association)?n("calcite-tooltip",{key:`tooltip-${t.featureViewModel.uid}`,overlayPositioning:"fixed",referenceElement:e.get(t.featureViewModel.uid)},this.getConnectivityTooltip(t.association.associationType)):null}_renderAssociatedFeature(t){let{featureViewModel:e}=t,o=C(e),i=e.state==="loading",a=this._findFlowItem(e),d=a<0&&this._isParentFeature(e),m=d||a>=0;return n("calcite-list-item",{class:i?R.listItemHidden:void 0,description:F(t.terminalName??""),key:`associated-feature-type-${e.uid}`,label:F(o),onCalciteListItemSelect:()=>this._handleFeatureClick(d,a,e)},I(t.association)?this.renderConnectivityIcon(t.association.associationType,t.featureViewModel.uid):null,O(t.association)?n("calcite-chip",{label:M(t.association),scale:"s",slot:"content-end"},M(t.association)):null,this._renderChevronIconNode(m))}async _selectAssociation(t){let{flowItems:e,featureVisibleElements:o}=this;if(!e)return;t.abilities={utilityNetworkAssociationsContent:!0};let{default:i}=await import("./chunk-CILU6NBL.js");e.push(new i({flowItems:e,flowType:"feature-association",viewModel:t,visibleElements:o}))}_handleFeatureClick(t,e,o){if(t)this.flowItems.drain(i=>{"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy()});else if(e<0||!this.flowItems)this._selectAssociation(o);else for(;this.flowItems.length>e+1;){let i=this.flowItems.pop();i&&("showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy())}}_featureViewModelMatch(t,e){let o=t.graphic,i=o?.layer,a=null;i?.type==="subtype-sublayer"&&i.parent?a=i.parent.globalIdField??null:i&&"globalIdField"in i&&(a=i.globalIdField);let d=a?o?.attributes[a]:null,m=e.graphic,u=m?.layer,h=null;u?.type==="subtype-sublayer"&&u.parent?h=u.parent.globalIdField??null:u&&"globalIdField"in u&&(h=u.globalIdField);let L=h?m?.attributes[h]:null;return d&&L&&d===L}_isParentFeature(t){let e=this.flowItems?.getItemAt(0);if(!e)return!1;let o=e.parentFeatureViewModel;return this._featureViewModelMatch(o,t)}_findFlowItem(t){return this.flowItems?.findIndex(e=>{if(e.flowType!=="feature-association")return!1;let o=e.viewModel;return this._featureViewModelMatch(o,t)})??-1}_renderTooltips(t){return t.toArray().map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(t){return t.toArray().map(e=>this._renderAssociatedFeature(e))}_renderChevronIconNode(t){return n("calcite-icon",{flipRtl:!0,icon:t?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(t,e){let{messagesFeature:o}=this,{displayCount:i}=this.viewModel,a=e.slice(0,i),d=a.length<e.length;return n("calcite-list-item",{key:"show-all",label:t.title,open:!0,value:t.id},n("calcite-chip",{label:String(e.length),scale:"s",slot:"content-end"},e.length),n("calcite-list",{group:t.id,label:t.title??""},[this._renderTooltips(a),this._renderAssociatedFeatureList(a)],d?n("calcite-list-item",{description:v(o?.numberRecords,{number:e.length.toString()}),key:"show-all-item",label:o.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(t)},n("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};s([r()],c.prototype,"description",void 0),s([r()],c.prototype,"featureVisibleElements",void 0),s([r()],c.prototype,"flowItems",void 0),s([r()],c.prototype,"flowType",void 0),s([r()],c.prototype,"listType",void 0),s([r()],c.prototype,"parentFeatureViewModel",void 0),s([r()],c.prototype,"title",void 0),s([r({type:p})],c.prototype,"viewModel",void 0),s([r({type:g,nonNullable:!0})],c.prototype,"visibleElements",void 0),c=A=s([f("esri.widgets.Feature.FeatureUtilityNetworkAssociationList")],c);var Te=c;export{Te as default};
