import{a as oe,b as se,c as ne,d as L}from"./chunk-DCHNVAWJ.js";import{a as b}from"./chunk-64RBIOV3.js";import{a as Y,b as Z,c as ee,d as E,e as te}from"./chunk-6Z6LKUG5.js";import{a as Q}from"./chunk-SLAWDKDA.js";import{a as j,b as J,j as K}from"./chunk-MWSXMSWY.js";import{b as W}from"./chunk-ZVCMULXF.js";import{a as M}from"./chunk-GJASVPF6.js";import{a as q}from"./chunk-LXQPIAN7.js";import{c as V}from"./chunk-FTDD7QBB.js";import{a as X}from"./chunk-DB3UIQCU.js";import{b as G}from"./chunk-R4A63S45.js";import{t as U}from"./chunk-ONUGDWDK.js";import{C as D,H as u}from"./chunk-QHVIRF5H.js";import{I as z}from"./chunk-WZDN6K3C.js";import{a as h}from"./chunk-QGVBCWUY.js";import{i as O}from"./chunk-IYZFKXJ6.js";import{O as H,b as N,r as B,s as $,z as A}from"./chunk-CKJ56T2Q.js";import{b as x,r as I}from"./chunk-UHRSAPGQ.js";import{J as re}from"./chunk-L4EKTZIP.js";import{a as g}from"./chunk-N2WTMF3X.js";var S=!1,ie=e=>{S=!0,re(e)};var ae;function de(){S||ie(U(G(ae)))}function $e(e){let t=[];for(let r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return t.length>0?Promise.all(t):null}ae="components/assets";function le(e){return typeof e=="string"?document.getElementById(e):e??null}function De(e,t){for(;;){let r=e.firstChild;if(!r)break;t.appendChild(r)}}var ce={handleInterceptedEvent:(e,t,r,o)=>(e.scheduleRender(),t.properties[`on${o.type}`].apply(t.properties.bind||r,[o]))};var Pe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}},pe=e=>g(g({},Pe),e);var be=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},we=(e,t)=>e.find(t),he=(e,t,r=!1)=>{let o=e;return t.forEach((c,i)=>{let p=o?.children?we(o.children,n=>n.domNode===c):void 0;r&&!p&&i!==t.length-1||(o=p)}),o},me=e=>{let t,r=g(g({},ce),e),o=pe(r),c=o.performanceLogger,i,p=!0,n=!1,s=[],f=[],m=(l,a,w)=>{let y;o.eventHandlerInterceptor=(Ie,Ne,Ae,je)=>function(v){let R;c("domEvent",v);let C=be(v.currentTarget,y.domNode),ve=C.some(P=>customElements.get(P?.tagName?.toLowerCase()));if(v.eventPhase===Event.CAPTURING_PHASE||!ve)C.reverse(),R=he(y.getLastRender(),C);else{let P=v.composedPath(),_e=P.slice(P.indexOf(v.currentTarget),P.indexOf(y.domNode)).reverse();R=he(y.getLastRender(),_e,!0)}let k;return R&&(k=r.handleInterceptedEvent(t,R,this,v)),c("domEventProcessed",v),k},r.postProcessProjectionOptions?.(o);let F=w();y=l(a,F,o),o.eventHandlerInterceptor=void 0,s.push(y),f.push(w),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(y,F)},_=()=>{if(i=void 0,p){p=!1,c("renderStart",void 0);for(let l=0;l<s.length;l++){let a=f[l]();c("rendered",void 0);try{s[l].update(a)}catch(w){console.error(w)}c("patched",void 0)}c("renderDone",void 0),p=!0}};return r.modifyDoRenderImplementation&&(_=r.modifyDoRenderImplementation(_,s,f)),t={renderNow:_,scheduleRender:()=>{i||n||(i=requestAnimationFrame(_))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),n=!0},resume:()=>{n=!1,p=!0,t.scheduleRender()},append:(l,a)=>{m(b.append,l,a)},insertBefore:(l,a)=>{m(b.insertBefore,l,a)},merge:(l,a)=>{m(b.merge,l,a)},replace:(l,a)=>{m(b.replace,l,a)},detach:l=>{for(let a=0;a<f.length;a++)if(f[a]===l)return f.splice(a,1),s.splice(a,1)[0];throw new Error("renderFunction was not found")}},t};var ue=new Set;function fe(e){ue.add(e),e.finally(()=>ue.delete(e))}var ge,Re="esri.widgets.Widget",Ee=0;function ye(e,t){let r=Object.prototype.hasOwnProperty;for(let o in t)r.call(t,o)&&r.call(e,o)&&(e[o]!=null&&t[o]!=null&&typeof e[o]=="object"&&typeof t[o]=="object"?ye(e[o],t[o]):e[o]=t[o]);return e}var Ce=me({postProcessProjectionOptions(e){let t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(o,c,i,p)=>{let n=t?.(o,c,i,p),s=r.test(o);if(!((o=o.replace(r,"")).toLowerCase()in i)||s){let f=o[2].toLowerCase()+o.slice(3),m=a=>n?.call(i,a);i.addEventListener(f,m,s);let _=()=>i.removeEventListener(f,m,s),l=p.afterRemoved;p.afterRemoved=a=>{l?.(a),_()}}return n}},handleInterceptedEvent(e,t,r,o){let{eventPhase:c,type:i}=o,p=c===Event.CAPTURING_PHASE,n=`on${i}${p?"capture":""}`,s=t.properties;(s&&n in s||(n=`on${i[0].toUpperCase()}${i.slice(1)}${p?"Capture":""}`,s&&n in s))&&(Y(),e.scheduleRender(),s[n].call(s.bind||r,o))}}),T=!1,d=class extends q.EsriPromiseMixin(M.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=Ce,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=H(async()=>{if(this._messageBundleProps?.length){let n=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:s,propertyName:f})=>{if(this.destroyed)return;let m=await W(s);this.uiStrings&&Object.keys(this.uiStrings)&&(m=ye(x(m),this.uiStrings)),this[f]=m}));if(this.destroyed)return;for(let s of n)s.status==="rejected"&&I.getLogger(this).error("widget-intl:locale-error",this.declaredClass,s.reason)}await this.loadLocale()}),de();let r="esri-widget-uid-"+Q(),o=this.render.bind(this);this._trackingTarget=new D(()=>{this.autoRenderingEnabled&&this.scheduleRender()});let c=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),i=()=>{if(!this._readyForTrueRender||this.destroyed)return null;let n=o()??c(),s=n.properties??={};if(s.key??=r,L(n.vnodeSelector)){if(!this.visible)return c()}else this.visible?s.styles||(s.styles={}):(s.class="",s.styles={display:"none"}),s.styles.display??="";let f=0;return n.children?.forEach(m=>{L(m.vnodeSelector)||(m.properties??={},m.properties.key??=`${this.id}--${f++}`)}),ne(this,n)};this.render=()=>{if(T)return i();let n=Z(this)??null;if(n)return n;this._trackingTarget.clear(),T=!0;try{n=O(this._trackingTarget,i)}catch(s){throw I.getLogger(this).error(s),s}finally{T=!1}return n&&ee(this,n),n};let p=this.beforeFirstRender();p?this._resourcesFetch=p.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),fe(this._resourcesFetch)}normalizeCtorArgs(e,t){let r=g({},e);return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){let e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(A):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(N(this._trackingTarget),N(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,E(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return le(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Ee++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(ge=oe,se)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(E(this),this._projector.scheduleRender())}classes(...e){return te.apply(this,e)}renderNow(){E(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(j(()=>this.viewModel,(t,r)=>{r&&this.removeHandles("delegated-events"),t&&B(t)&&this.addHandles(this._delegatedEventNames.map(o=>$(t,o,c=>{this.emit(o,c)})),"delegated-events")},K)),this.postInitialize();let e=async()=>{await this._loadLocale().catch(A),this.scheduleRender()};this.addHandles([V(e),j(()=>this.uiStrings,e),J(()=>this.container,t=>{this.destroyed||this._attach(t)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};d[ge]=!0,d.vnodeSelector="div",h([u()],d.prototype,"_readyForTrueRender",void 0),h([u({value:null})],d.prototype,"container",null),h([X("container")],d.prototype,"castContainer",null),h([u()],d.prototype,"icon",null),h([u()],d.prototype,"id",null),h([u()],d.prototype,"label",null),h([u()],d.prototype,"renderable",null),h([u()],d.prototype,"uiStrings",void 0),h([u()],d.prototype,"viewModel",void 0),h([u({value:!0})],d.prototype,"visible",null),h([u()],d.prototype,"key",void 0),h([u()],d.prototype,"children",void 0),h([u()],d.prototype,"afterCreate",void 0),h([u()],d.prototype,"afterUpdate",void 0),h([u()],d.prototype,"afterRemoved",void 0),d=h([z(Re)],d);var Ct=d;function jt(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}export{le as a,De as b,$e as c,Ct as d,jt as e};
