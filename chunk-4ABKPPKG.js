import{a as ee}from"./chunk-PMVQ5DJK.js";import{a as oe}from"./chunk-KAMRW6HF.js";import{a as c}from"./chunk-JTDXB5TK.js";import{P as se,h as re,l as ie}from"./chunk-HP4LYRR4.js";import{a as U}from"./chunk-NRBJLISB.js";import{a as Zt}from"./chunk-KJULKTB5.js";import{c as q}from"./chunk-YR2HD3ZC.js";import{a as at}from"./chunk-X4LNX4BR.js";import{a as b}from"./chunk-WLHY3MMA.js";import{a as te}from"./chunk-DB3UIQCU.js";import{a as nt,b as Yt}from"./chunk-SBHKMV3P.js";import{f as a}from"./chunk-SG7CQU4O.js";import{H as o,J as pt}from"./chunk-QHVIRF5H.js";import{I as i,w as Xt,x as f}from"./chunk-WZDN6K3C.js";import{a as t}from"./chunk-QGVBCWUY.js";import{M as Qt}from"./chunk-CKJ56T2Q.js";import{b as d,r as Ht}from"./chunk-UHRSAPGQ.js";import{a as $t}from"./chunk-N2WTMF3X.js";var Nt,R=Nt=class extends a{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Nt({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};t([o({type:String,json:{write:!0}})],R.prototype,"name",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],R.prototype,"expression",void 0),t([o({type:["string","number"],json:{write:!0}})],R.prototype,"returnType",void 0),R=Nt=t([i("esri.popup.ExpressionInfo")],R);var pe=R;var _t,y=_t=class extends ee.IdentifiableMixin(pt){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new _t({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};t([o()],y.prototype,"active",void 0),t([o()],y.prototype,"className",void 0),t([o()],y.prototype,"disabled",void 0),t([o()],y.prototype,"icon",void 0),t([o()],y.prototype,"id",void 0),t([o()],y.prototype,"indicator",void 0),t([o()],y.prototype,"title",void 0),t([o()],y.prototype,"type",void 0),t([o()],y.prototype,"visible",void 0),y=_t=t([i("esri.support.actions.ActionBase")],y);var P=y;var jt,lt=jt=class extends P{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new jt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};t([o()],lt.prototype,"image",void 0),lt=jt=t([i("esri.support.actions.ActionButton")],lt);var ne=lt;var mt=class extends a{constructor(e){super(e),this.type=null}};t([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],mt.prototype,"type",void 0),mt=t([i("esri.popup.content.Content")],mt);var m=mt;var dt=new nt({asc:"ascending",desc:"descending"}),G=class extends c.ClonableMixin(a){constructor(e){super(e),this.field=null,this.order="ascending"}};t([o({type:String,json:{write:!0}})],G.prototype,"field",void 0),t([o({type:dt.apiValues,json:{type:dt.jsonValues,read:dt.read,write:dt.write}})],G.prototype,"order",void 0),G=t([i("esri.popup.support.AttachmentsOrderByInfo")],G);var ae=G;var N=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};t([o({type:String,json:{write:!0}})],N.prototype,"description",void 0),t([o({type:["auto","preview","list"],json:{write:!0}})],N.prototype,"displayType",void 0),t([o({type:[ae],json:{write:!0}})],N.prototype,"orderByFields",void 0),t([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),t([o({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],N.prototype,"type",void 0),N=t([i("esri.popup.content.AttachmentsContent")],N);var T=N;var St,O=St=class extends m{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new St({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?d(this.outFields):null})}};t([o()],O.prototype,"creator",void 0),t([o()],O.prototype,"destroyer",void 0),t([o()],O.prototype,"outFields",void 0),t([o({type:["custom"],readOnly:!0})],O.prototype,"type",void 0),O=St=t([i("esri.popup.content.CustomContent")],O);var Ct=O;var Rt,D=Rt=class extends a{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new Rt({title:this.title,expression:this.expression})}};t([o({type:String,json:{write:!0}})],D.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],D.prototype,"expression",void 0),t([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],D.prototype,"returnType",void 0),D=Rt=t([i("esri.popup.ElementExpressionInfo")],D);var le=D;var Tt,$=Tt=class extends m{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new Tt({expressionInfo:this.expressionInfo?.clone()})}};t([o({type:le,json:{write:!0}})],$.prototype,"expressionInfo",void 0),t([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=Tt=t([i("esri.popup.content.ExpressionContent")],$);var W=$;var K=class extends c.ClonableMixin(a){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};t([U(Zt)],K.prototype,"dateFormat",void 0),t([o({type:Boolean,json:{write:!0}})],K.prototype,"digitSeparator",void 0),t([o({type:f,json:{write:!0}})],K.prototype,"places",void 0),K=t([i("esri.popup.support.FieldInfoFormat")],K);var me=K;var Ot,v=Ot=class extends a{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Ot({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};t([o({type:String,json:{write:!0}})],v.prototype,"fieldName",void 0),t([o({type:me,json:{write:!0}})],v.prototype,"format",void 0),t([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],v.prototype,"isEditable",void 0),t([o({type:String,json:{write:!0}})],v.prototype,"label",void 0),t([U(new nt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],v.prototype,"stringFieldOption",void 0),t([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],v.prototype,"statisticType",void 0),t([o({type:String,json:{write:!0}})],v.prototype,"tooltip",void 0),t([o({type:Boolean,json:{write:!0}})],v.prototype,"visible",void 0),v=Ot=t([i("esri.popup.FieldInfo")],v);var ct=v;var At,g=At=class extends m{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,r){r.fieldInfos=e&&e.map(s=>s.toJSON())}clone(){return new At(d({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};t([o({type:Object,json:{write:!0}})],g.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],g.prototype,"description",void 0),t([o({type:[ct]})],g.prototype,"fieldInfos",void 0),t([b("fieldInfos")],g.prototype,"writeFieldInfos",null),t([o({type:String,json:{write:!0}})],g.prototype,"title",void 0),t([o({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],g.prototype,"type",void 0),g=At=t([i("esri.popup.content.FieldsContent")],g);var A=g;var M=class extends a{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};t([o({type:String,json:{write:!0}})],M.prototype,"altText",void 0),t([o({type:String,json:{write:!0}})],M.prototype,"caption",void 0),t([o({type:String,json:{write:!0}})],M.prototype,"title",void 0),t([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],M.prototype,"type",void 0),M=t([i("esri.popup.content.mixins.MediaInfo")],M);var V=M;var Mt,E=Mt=class extends pt{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Mt({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};t([o()],E.prototype,"color",void 0),t([o()],E.prototype,"fieldName",void 0),t([o()],E.prototype,"tooltip",void 0),t([o()],E.prototype,"value",void 0),E=Mt=t([i("esri.popup.content.support.ChartMediaInfoValueSeries")],E);var de=E;var Et,_=Et=class extends a{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Et({colors:d(this.colors),fields:d(this.fields),normalizeField:this.normalizeField,series:d(this.series),tooltipField:this.tooltipField})}};t([o({type:[oe],json:{type:[[f]],write:!0}})],_.prototype,"colors",void 0),t([o({type:[String],json:{write:{isRequired:!0}}})],_.prototype,"fields",void 0),t([o({type:String,json:{write:!0}})],_.prototype,"normalizeField",void 0),t([o({type:[de],json:{read:!1}})],_.prototype,"series",void 0),t([o({type:String,json:{write:!0}})],_.prototype,"tooltipField",void 0),_=Et=t([i("esri.popup.content.support.ChartMediaInfoValue")],_);var ce=_;var H=class extends V{constructor(e){super(e),this.type=null,this.value=void 0}};t([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],H.prototype,"type",void 0),t([o({type:ce,json:{write:{isRequired:!0}}})],H.prototype,"value",void 0),H=t([i("esri.popup.content.mixins.ChartMediaInfo")],H);var j=H;var S=Yt()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Bt,ut=Bt=class extends j{constructor(e){super(e),this.type="bar-chart"}clone(){return new Bt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:S.write,isRequired:!0}}})],ut.prototype,"type",void 0),ut=Bt=t([i("esri.popup.content.BarChartMediaInfo")],ut);var ft=ut;var kt,yt=kt=class extends j{constructor(e){super(e),this.type="column-chart"}clone(){return new kt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:S.write,isRequired:!0}}})],yt.prototype,"type",void 0),yt=kt=t([i("esri.popup.content.ColumnChartMediaInfo")],yt);var ht=yt;var Jt,Q=Jt=class extends a{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Jt({linkURL:this.linkURL,sourceURL:this.sourceURL})}};t([o({type:String,json:{write:!0}})],Q.prototype,"linkURL",void 0),t([o({type:String,json:{write:{isRequired:!0}}})],Q.prototype,"sourceURL",void 0),Q=Jt=t([i("esri.popup.content.support.ImageMediaInfoValue")],Q);var ue=Q;var Lt,z=Lt=class extends V{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new Lt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};t([o({type:Number,json:{write:!0}})],z.prototype,"refreshInterval",void 0),t([o({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],z.prototype,"type",void 0),t([o({type:ue,json:{write:{isRequired:!0}}})],z.prototype,"value",void 0),z=Lt=t([i("esri.popup.content.ImageMediaInfo")],z);var vt=z;var qt,wt=qt=class extends j{constructor(e){super(e),this.type="line-chart"}clone(){return new qt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:S.write,isRequired:!0}}})],wt.prototype,"type",void 0),wt=qt=t([i("esri.popup.content.LineChartMediaInfo")],wt);var xt=wt;var Ut,bt=Ut=class extends j{constructor(e){super(e),this.type="pie-chart"}clone(){return new Ut({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};t([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:S.write,isRequired:!0}}})],bt.prototype,"type",void 0),bt=Ut=t([i("esri.popup.content.PieChartMediaInfo")],bt);var It=bt;var X={base:V,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":ft,"column-chart":ht,"line-chart":xt,"pie-chart":It,image:vt}};var Pt,w=Pt=class extends m{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(r=>r.type==="image"?vt.fromJSON(r):r.type==="barchart"?ft.fromJSON(r):r.type==="columnchart"?ht.fromJSON(r):r.type==="linechart"?xt.fromJSON(r):r.type==="piechart"?It.fromJSON(r):void 0).filter(Boolean)}writeMediaInfos(e,r){r.mediaInfos=e&&e.map(s=>s.toJSON())}clone(){return new Pt(d({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};t([o()],w.prototype,"activeMediaInfoIndex",void 0),t([o({type:Object,json:{write:!0}})],w.prototype,"attributes",void 0),t([o({type:String,json:{write:!0}})],w.prototype,"description",void 0),t([o({types:[X]})],w.prototype,"mediaInfos",void 0),t([at("mediaInfos")],w.prototype,"readMediaInfos",null),t([b("mediaInfos")],w.prototype,"writeMediaInfos",null),t([o({type:String,json:{write:!0}})],w.prototype,"title",void 0),t([o({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),w=Pt=t([i("esri.popup.content.MediaContent")],w);var B=w;var Dt,Y=Dt=class extends a{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Dt({field:this.field,order:this.order})}};t([o({type:String,json:{write:!0}})],Y.prototype,"field",void 0),t([o({type:["asc","desc"],json:{write:!0}})],Y.prototype,"order",void 0),Y=Dt=t([i("esri.popup.support.RelatedRecordsInfoFieldOrder")],Y);var gt=Y;var I=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};t([o({type:String,json:{write:!0}})],I.prototype,"description",void 0),t([o({type:Number,json:{type:f,write:!0}})],I.prototype,"displayCount",void 0),t([o({type:["list"],json:{write:{isRequired:!0}}})],I.prototype,"displayType",void 0),t([o({type:[gt],json:{write:!0}})],I.prototype,"orderByFields",void 0),t([o({type:Number,json:{type:f,write:{isRequired:!0}}})],I.prototype,"relationshipId",void 0),t([o({type:String,json:{write:!0}})],I.prototype,"title",void 0),t([o({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],I.prototype,"type",void 0),I=t([i("esri.popup.content.RelationshipContent")],I);var k=I;var Wt,Z=Wt=class extends m{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new Wt({text:this.text})}};t([o({type:String,json:{write:!0}})],Z.prototype,"text",void 0),t([o({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],Z.prototype,"type",void 0),Z=Wt=t([i("esri.popup.content.TextContent")],Z);var J=Z;var F=class extends c.ClonableMixin(a){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};t([o({type:String,json:{write:!0}})],F.prototype,"title",void 0),t([o({type:String,json:{write:!0}})],F.prototype,"description",void 0),t([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],F.prototype,"type",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedNetworkSourceId",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedAssetGroup",void 0),t([o({type:Number,json:{type:f,write:!0}})],F.prototype,"associatedAssetType",void 0),F=t([i("esri.popup.support.UtilityNetworkAssociationType")],F);var fe=F;var C=class extends c.ClonableMixin(m){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};t([o({type:String,json:{write:!0}})],C.prototype,"description",void 0),t([o({type:Number,json:{type:f,write:!0}})],C.prototype,"displayCount",void 0),t([o({type:String,json:{write:!0}})],C.prototype,"title",void 0),t([o({type:[fe],json:{write:!0}})],C.prototype,"associationTypes",void 0),t([U({utilityNetworkAssociations:"utility-network-associations"})],C.prototype,"type",void 0),C=t([i("esri.popup.content.UtilityNetworkAssociationsContent")],C);var tt=C;var ye={base:null,key:"type",typeMap:{attachment:T,media:B,text:J,expression:W,field:A,relationship:k,utilityNetworkAssociations:tt}},he={base:null,key:"type",typeMap:{attachment:T,media:B,text:J,expression:W,field:A,relationship:k}};var Kt,et=Kt=class extends a{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Kt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};t([o({type:Boolean,json:{write:!0}})],et.prototype,"returnTopmostRaster",void 0),t([o({type:Boolean,json:{write:!0}})],et.prototype,"showNoDataRecords",void 0),et=Kt=t([i("esri.popup.LayerOptions")],et);var ve=et;var Vt,ot=Vt=class extends a{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Vt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?d(this.orderByFields):null})}};t([o({type:Boolean,json:{write:!0}})],ot.prototype,"showRelatedRecords",void 0),t([o({type:[gt],json:{write:!0}})],ot.prototype,"orderByFields",void 0),ot=Vt=t([i("esri.popup.RelatedRecordsInfo")],ot);var zt=ot;var Gt,rt=Gt=class extends P{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new Gt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};t([o()],rt.prototype,"image",void 0),t([o()],rt.prototype,"value",void 0),rt=Gt=t([i("esri.support.actions.ActionToggle")],rt);var we=rt;var it="relationships/",xe="expression/",Ie=q.ofType({key:"type",defaultKeyValue:"button",base:P,typeMap:{button:ne,toggle:we}}),ge={base:m,key:"type",typeMap:{media:B,custom:Ct,text:J,attachments:T,fields:A,expression:W,relationship:k,utilityNetworkAssociations:tt}},be=new Set(["attachments","fields","media","text","expression","relationship"]),Fe=new Set([...be,"utility-network-associations"]),l=class extends c.ClonableMixin(a){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Xt(ge,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Qt(e)?e:(Ht.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){let{popupElements:s}=r;return Array.isArray(s)&&s.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,s):this._readPopupInfo(r)}writeWebSceneContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeWebMapContent(e,r,s,p){this._writePopupTemplateContent(e,r,p)}writeFieldInfos(e,r,s,p){let{content:n}=this,u=Array.isArray(n)?n:null;if(e){let h=u?u.filter(x=>x.type==="fields"):[],L=h.length&&h.every(x=>x.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(x=>{let st=x.toJSON(p);return L&&(st.visible=!1),st})}if(u)for(let h of u)h.type==="fields"&&this._writeFieldsContent(h,r)}writeLayerOptions(e,r,s,p){r[s]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(p)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){let s=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...s,...this._getContentExpressionInfos(this.content,s)]),re(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){let r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writePopupTemplateContent(e,r,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(p=>s?.origin==="web-scene"?be.has(p.type):Fe.has(p.type)).map(p=>p?.toJSON(s)),r.popupElements.forEach(p=>{p.type==="attachments"?this._writeAttachmentContent(r):p.type==="media"?this._writeMediaContent(p,r):p.type==="text"?this._writeTextContent(p,r):p.type==="relationship"&&this._writeRelationshipContent(p,r)})):r.description=e}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;let s=d(e.fieldInfos);Array.isArray(r.fieldInfos)?s.forEach(p=>{let n=r.fieldInfos.find(u=>u.fieldName?.toLowerCase()===p.fieldName?.toLowerCase());n?n.visible=!0:r.fieldInfos.push(p)}):r.fieldInfos=s}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){let s=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],p=[...r.relatedRecordsInfo?.orderByFields||[],...s];r.relatedRecordsInfo=$t({showRelatedRecords:!0},p?.length&&{orderByFields:p})}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;let s=d(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...s]:r.mediaInfos=s}_readPopupInfoElements(e,r,s){let p={description:!1,mediaInfos:!1};return s.map(n=>n.type==="media"?(n.mediaInfos||!r||p.mediaInfos||(n.mediaInfos=r,p.mediaInfos=!0),B.fromJSON(n)):n.type==="text"?(n.text||!e||p.description||(n.text=e,p.description=!0),J.fromJSON(n)):n.type==="attachments"?T.fromJSON(n):n.type==="fields"?A.fromJSON(n):n.type==="expression"?W.fromJSON(n):n.type==="relationship"?k.fromJSON(n):n.type==="utilityNetworkAssociations"?tt.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){let{field:r,order:s}=e;if(!r?.startsWith(it))return null;let p=r.replace(it,"").split("/");if(p.length!==2)return null;let n=parseInt(p[0],10),u=p[1];return!Number.isNaN(n)&&u?k.fromJSON({relationshipId:n,orderByFields:[{field:u,order:s}]}):null}_toFieldOrderJSON(e,r){let{order:s,field:p}=e;return{field:`${it}${r}/${p}`,order:s}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:s,relatedRecordsInfo:p={showRelatedRecords:!1}}){let n=[];e?n.push(new J({text:e})):n.push(new A),Array.isArray(r)&&r.length&&n.push(B.fromJSON({mediaInfos:r})),s&&n.push(T.fromJSON({displayType:"auto"}));let{showRelatedRecords:u,orderByFields:h}=p;return u&&h?.length&&h.forEach(L=>{let x=this._toRelationshipContent(L);x&&n.push(x)}),n.length?n:e}_getContentElementFields(e){let r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){let s=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...s.reduce((p,n)=>[...p,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):r==="relationship"||r==="utility-network-associations"?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){let{caption:r,title:s,value:p}=e,n=p||{},{fields:u,normalizeField:h,tooltipField:L,sourceURL:x,linkURL:st}=n,Ft=[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(x),...this._extractFieldNames(st),...u??[]];return h&&Ft.push(h),L&&Ft.push(L),Ft}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((s,p)=>[...s,...p.type==="expression"&&p.expressionInfo?[p.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,s)=>[...r,...this._getContentElementFields(s)],[]):[]}async _collectExpressionInfoFields(e,r,s){s&&await Promise.all(s.map(p=>ie(e,r,p.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:r,visible:s})=>!(s!==void 0&&!s||!r||r.startsWith(it)||r.startsWith(xe))).map(r=>r.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((r,s)=>[...r,...this._getActionFields(s)],[]):[]}_getActionFields(e){let{className:r,title:s,type:p}=e,n=p==="button"||p==="toggle"?e.image:"";return[...this._extractFieldNames(s),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return se(e).filter(r=>!(r.indexOf(it)===0||r.indexOf(xe)===0))}};t([o({type:Ie})],l.prototype,"actions",void 0),t([o()],l.prototype,"content",void 0),t([te("content")],l.prototype,"castContent",null),t([at("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],l.prototype,"readContent",null),t([b("web-scene","content",{popupElements:{type:q.ofType(he)},showAttachments:{type:Boolean},mediaInfos:{type:q.ofType(X)},description:{type:String},relatedRecordsInfo:{type:zt}})],l.prototype,"writeWebSceneContent",null),t([b("content",{popupElements:{type:q.ofType(ye)},showAttachments:{type:Boolean},mediaInfos:{type:q.ofType(X)},description:{type:String},relatedRecordsInfo:{type:zt}})],l.prototype,"writeWebMapContent",null),t([o({type:[pe],json:{write:!0}})],l.prototype,"expressionInfos",void 0),t([o({type:[ct]})],l.prototype,"fieldInfos",void 0),t([b("fieldInfos")],l.prototype,"writeFieldInfos",null),t([o({type:ve})],l.prototype,"layerOptions",void 0),t([b("layerOptions")],l.prototype,"writeLayerOptions",null),t([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],l.prototype,"lastEditInfoEnabled",void 0),t([o()],l.prototype,"outFields",void 0),t([o()],l.prototype,"overwriteActions",void 0),t([o()],l.prototype,"returnGeometry",void 0),t([o({json:{type:String}})],l.prototype,"title",void 0),t([b("title")],l.prototype,"writeTitle",null),l=t([i("esri.PopupTemplate")],l);var fa=l;export{ae as a,T as b,le as c,me as d,ct as e,A as f,de as g,B as h,gt as i,J as j,fe as k,pe as l,P as m,ne as n,we as o,fa as p};
