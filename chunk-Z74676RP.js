import{a as Lt,b as S}from"./chunk-4CZRO4GS.js";import{b as At}from"./chunk-KW7LE7CZ.js";import{a as k,b as Pe,c as oe,d as Ee}from"./chunk-BIFE464S.js";import{a as bt}from"./chunk-2EE5YRTN.js";import{a as _t}from"./chunk-U2JOSABV.js";import"./chunk-2GRWIJ52.js";import"./chunk-5B4YOQU5.js";import{b as gt,c as vt,d as ft,e as q}from"./chunk-3VYKLHOM.js";import{a as re}from"./chunk-HOMK53AL.js";import"./chunk-LKA3X57N.js";import"./chunk-NWNJEGEK.js";import"./chunk-KBHP2G24.js";import"./chunk-ALYBHVUD.js";import{a as se}from"./chunk-FJNBIBDX.js";import{b as ie,c as Ae,d as dt,e as Ce,f as ut,o as mt}from"./chunk-AF5UMDFO.js";import{c as ht,e as pt}from"./chunk-PCKPAUFQ.js";import"./chunk-C27Q2S3P.js";import"./chunk-O2PACODW.js";import"./chunk-5XQ3V6FG.js";import"./chunk-JAPGPEA6.js";import"./chunk-VU5W7W6Y.js";import{d as yt,j as wt}from"./chunk-TYMNCBDR.js";import"./chunk-XMOJ4BVW.js";import"./chunk-7GENY6TF.js";import"./chunk-2L3Q5NER.js";import"./chunk-XCJ4FRLL.js";import"./chunk-JNJTT3PL.js";import"./chunk-53FQLWMN.js";import"./chunk-PGFEC2N6.js";import"./chunk-5KY2RG7F.js";import"./chunk-XQ4DD6H6.js";import"./chunk-IQA3CVAZ.js";import"./chunk-2DH3L3DZ.js";import"./chunk-2VR3WADU.js";import"./chunk-5QOQFLF6.js";import"./chunk-2I3LIA7G.js";import"./chunk-5DVGZXEZ.js";import"./chunk-AGQUA5I4.js";import"./chunk-VC6GZ45F.js";import"./chunk-BENEV3E6.js";import"./chunk-R3G2IXBO.js";import"./chunk-2M72FQ5L.js";import"./chunk-SBYRP3FT.js";import"./chunk-N3W77OHB.js";import"./chunk-D4EX42XK.js";import"./chunk-HMAWCT6U.js";import"./chunk-7PDWRJ35.js";import"./chunk-ALHY5HFC.js";import"./chunk-724E6NM3.js";import{e as M}from"./chunk-JKP7KG6H.js";import"./chunk-MF655E4C.js";import"./chunk-NOHUHVCW.js";import"./chunk-2XYAAYOE.js";import"./chunk-4X7VNDTG.js";import"./chunk-34RMJISL.js";import"./chunk-54P55TN4.js";import"./chunk-BVDJBTNQ.js";import"./chunk-LSUWBOLF.js";import"./chunk-LCFWGHLF.js";import"./chunk-XACQ2RJ5.js";import"./chunk-3TRID6QS.js";import{n as ct}from"./chunk-VUJT53YX.js";import"./chunk-WUXNV6ZW.js";import"./chunk-KE2U7ENE.js";import"./chunk-PSFZFYFC.js";import"./chunk-GI4NW5SA.js";import"./chunk-T5NHE3SD.js";import"./chunk-SWCOPTUX.js";import"./chunk-7EWNVUY7.js";import"./chunk-SXYHD4V6.js";import{a as be}from"./chunk-FSW536RM.js";import"./chunk-YNDA4ZZB.js";import{b as at}from"./chunk-JAN3FVXP.js";import"./chunk-F4HA2HQL.js";import{a as lt}from"./chunk-BSKAVVQS.js";import"./chunk-AEU2INWT.js";import"./chunk-Z4UBZ6W2.js";import{b as Le}from"./chunk-CMKJEBQJ.js";import"./chunk-AQMR24IC.js";import"./chunk-3J3Q4LMA.js";import"./chunk-PSNQ2KG3.js";import"./chunk-JXRFF2VE.js";import"./chunk-7WCQBAQY.js";import"./chunk-V4ZQZTCB.js";import{a as $e,b as st}from"./chunk-PEYNLMWW.js";import"./chunk-FQIIIJGL.js";import"./chunk-SZTSN5BD.js";import"./chunk-VAOSSSLB.js";import"./chunk-6L543SC5.js";import"./chunk-CUV3BSEW.js";import"./chunk-6FI5AY7X.js";import"./chunk-ZCAR53EN.js";import"./chunk-DH67ILIV.js";import"./chunk-7GUYYJRR.js";import{d as nt}from"./chunk-WS4AMEGN.js";import"./chunk-CU7FHMWW.js";import"./chunk-CSFAHB4Y.js";import"./chunk-AMISFAT3.js";import"./chunk-PTXLSCMJ.js";import{k as et,l as tt,m as it}from"./chunk-NRRX2M6N.js";import"./chunk-PMLKCTEJ.js";import"./chunk-MYO2G5ZH.js";import"./chunk-EG2DTURK.js";import"./chunk-4XEE5PE3.js";import"./chunk-XWEUR6F7.js";import"./chunk-O2J7LFYY.js";import"./chunk-422PSKZ7.js";import"./chunk-SFANISLX.js";import"./chunk-5L4CW2H2.js";import"./chunk-UJ7KVQR6.js";import{i as rt,j as x,k as ot}from"./chunk-B74L7AUE.js";import"./chunk-MJO3PLZV.js";import"./chunk-YU3IFRYW.js";import"./chunk-XKFJ6GWH.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import"./chunk-EM2AEAFS.js";import{a as te}from"./chunk-VGAXEXH3.js";import"./chunk-YEPHAEAY.js";import"./chunk-76X7RFM4.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import"./chunk-L7NOU4T2.js";import"./chunk-SU7IJ65K.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-HUUJBVXR.js";import"./chunk-4LDVFWME.js";import"./chunk-A45BLB26.js";import"./chunk-DFYW3Y3B.js";import"./chunk-UBQPWKE4.js";import"./chunk-YSD7LK2L.js";import"./chunk-LXEWGICX.js";import"./chunk-NIYDRLW4.js";import"./chunk-4K47EN3B.js";import"./chunk-FSWSNKJD.js";import"./chunk-MVDZB4AK.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FGEB67EG.js";import{h as we}from"./chunk-YEXMIDOT.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-VYZHOYXV.js";import"./chunk-K7YQAHQ7.js";import"./chunk-XAHD7XBV.js";import"./chunk-J6YGDWJF.js";import"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-ONYJLWAD.js";import{f as W}from"./chunk-VMECOA4F.js";import"./chunk-KOUNUVF6.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-PMVQ5DJK.js";import{g as Ye,h as _e,j as ve,l as fe,m as ye,q as Ze}from"./chunk-77L5NP7A.js";import"./chunk-KAMRW6HF.js";import"./chunk-6DGDLLNL.js";import"./chunk-UWWWQ44M.js";import"./chunk-BHB4UQZT.js";import"./chunk-DJW5LMRG.js";import{a as Xe}from"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import"./chunk-YW3L7OMP.js";import"./chunk-VTGWQ7AP.js";import"./chunk-PHNFWHVF.js";import"./chunk-KRAKR4MK.js";import"./chunk-MCO7DSFO.js";import"./chunk-D7WE3OBT.js";import"./chunk-JTDXB5TK.js";import"./chunk-XCIPBOI4.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-G7TP3ZYQ.js";import"./chunk-Y6YEAKJ5.js";import{b as Qe}from"./chunk-U4TLMQTY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import{a as A}from"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import{b as Je,i as Ke}from"./chunk-HM5RIVQC.js";import"./chunk-EM35R6FY.js";import"./chunk-2ZFXOJDB.js";import{o as ge}from"./chunk-QXXXCEV5.js";import{G as We,J as qe,b as Ne,c as X,d as ke,e as Y,n as Be,p as Fe,u as Z,w as $,y as ee}from"./chunk-6B5XFA6F.js";import{g as J,h as he}from"./chunk-OLOKUDVI.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import{a as pe,c as K}from"./chunk-PTZYZULI.js";import{a as me}from"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import{a as y}from"./chunk-BOVYXYHK.js";import"./chunk-HX2VGIR2.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import{e as Ue,h as Ie}from"./chunk-QT6UNBJP.js";import"./chunk-64RBIOV3.js";import"./chunk-6Z6LKUG5.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import{a as L,i as Re,j as O}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import{b as xe}from"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-BUSG3ZOF.js";import"./chunk-XZIOXVVJ.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import{Q as Ge,W as ue,X as je,_ as He}from"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import{c as Te}from"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as n,J as N,g as De}from"./chunk-QHVIRF5H.js";import{I}from"./chunk-WZDN6K3C.js";import{a as o}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{b as w}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{r as ze}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as P,b as E}from"./chunk-N2WTMF3X.js";var T=class extends N{constructor(t){super(t)}initialize(){this.addHandles([L(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:t,startPoint:e})=>{t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(e)},O),L(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:t,endPoint:e})=>{t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(e)},O),L(()=>({result:this._computedResult,viewData:this.viewData}),({result:t,viewData:e})=>{e.result=t},O)])}_applyProjectionAndElevationAlignment(t){if(t==null)return t;let{spatialReference:e,elevationProvider:i}=this.view;return vt(t,e,i)??(ft(this.analysis,t.spatialReference,ze.getLogger(this)),null)}get _computedResult(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:i,unit:s}=this.viewData;if(t==null||e==null)return null;let r=mt(t,e),l=pt(t,e);if(r==null)return null;let u,d;switch(i){case S.Auto:d=l!=null?"geodesic":"euclidean",u=l??r.horizontal;break;case S.Geodesic:if(l==null)return null;d="geodesic",u=l;break;case S.Euclidean:d="euclidean",u=r.horizontal}let c=r.direct,h=r.vertical,a=ue(c.value,c.unit,s),m=ue(u.value,u.unit,s),p=je(h.value,h.unit,s);return c=M(c,a),u=M(u,m),h=M(h,p),{mode:d,directDistance:c,horizontalDistance:u,verticalDistance:h}}};o([n()],T.prototype,"view",void 0),o([n()],T.prototype,"analysis",void 0),o([n()],T.prototype,"viewData",void 0),o([n()],T.prototype,"_computedResult",null),T=o([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],T);var f,V;(function(t){t[t.None=0]="None",t[t.Direct=1]="Direct",t[t.Triangle=2]="Triangle",t[t.ProjectedGeodesic=3]="ProjectedGeodesic"})(f||(f={})),function(t){t[t.Auto=0]="Auto",t[t.AboveSegment=1]="AboveSegment",t[t.BelowSegment=2]="BelowSegment"}(V||(V={}));var ae=class extends st{constructor(e,i){super(e,i,new $e(At,()=>import("./chunk-PVBQPB5W.js")),Me),this.primitiveType=Je.TRIANGLE_STRIP}initializePipeline(e){return it({blending:e.transparent?at(e.oitPass):null,polygonOffset:e.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:Ke.LESS},depthWrite:et,colorWrite:tt})}},Me=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.LENGTH,3]]);var B=class extends lt{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}};o([Le()],B.prototype,"polygonOffsetEnabled",void 0),o([Le()],B.prototype,"transparent",void 0);var ne=class extends rt{constructor(e){super(e,Oe),this._configuration=new B,this.vertexAttributeLocations=Me,this.produces=new Map([[be.OPAQUE_MATERIAL,i=>!this._transparent&&we(i)],[be.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,i=>this._transparent&&we(i)]])}getConfiguration(e,i){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=i.oitPass,this._configuration}get visible(){let{outlineColor:e,stripeEvenColor:i,stripeOddColor:s}=this.parameters;return e[3]>=te||i[3]>=te||s[3]>=te}intersect(){}createGLMaterial(e){return new Ve(e)}createBufferWriter(){return new Se}get _transparent(){let{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}},Ve=class extends nt{beginSlot(e){return this.getTechnique(ae,e)}},Oe=class extends ot{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=K(1,.5,0,1),this.stripeEvenColor=K(1,1,1,1),this.stripeOddColor=K(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}},Et=Qe().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).f32(A.LENGTH),Mt=y(),Vt=y(),Ot=y(),St=y(),zt=y(),Se=class{constructor(){this.vertexBufferLayout=Et}elementCount(e){return 2*(e.get(A.POSITION).indices.length/2+1)}write(e,i,s,r,l,u){let{data:d,indices:c}=s.get(A.POSITION),h=s.get(A.NORMAL).data,a=d.length/3;c&&c.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");let m=Mt,p=Vt,v=Ot,C=St,R=zt,G=l.position,j=l.normal,z=l.uv0,H=0;for(let b=0;b<a;++b){let F=3*b;if(X(m,d[F],d[F+1],d[F+2]),b<a-1){let U=3*(b+1);X(p,d[U],d[U+1],d[U+2]),X(R,h[U],h[U+1],h[U+2]),Z(R,R),Y(v,p,m),Z(v,v),$(C,R,v),Z(C,C)}let de=Fe(m,p);e&&i&&(ee(m,m,e),ee(p,p,e),ee(C,C,i));let D=u+2*b,Q=D+1;G.setVec(D,m),G.setVec(Q,m),j.setVec(D,C),j.setVec(Q,C),z.set(D,0,H),z.set(D,1,-1),z.set(Q,0,H),z.set(Q,1,1),b<a-1&&(H+=de)}let ce=l.length;for(let b=0;b<2*a;++b)ce.set(u+b,H)}};var le=class extends gt{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=y(),this._originTransform=Xe(),this._arrowCenter=y(),this._renderOccluded=x.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=pe(),this._contrastColor=pe(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial?.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){let i=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:i})}}get color(){return this._color}set color(e){ye(e,this._color)||(me(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){ye(e,this._color)||(me(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e;this._arrowMaterial=new ne({outlineColor:e,stripeEvenColor:s,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new De,this._handles.add(L(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=w(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(this._geometry?.startRenderSpace==null||this._geometry.endRenderSpace==null)return;let i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,e.addGeometry(i),this._viewChanged()}_createArrowGeometry(e,i,s,r){let l=this.view,u=l.renderCoordsHelper,d=[],c=[],h=(a,m)=>{let p=W.get();Y(p,a,s),d.push(p),c.push(m)};if(r.type==="euclidean"){r.eval(.5,this._arrowCenter);let a=W.get();if(u.worldUpAtPosition(this._arrowCenter,a),Dt(e,i,a)){let{heading:m,tilt:p}=l.camera,{direction:v}=wt(l,e,m,p,Tt);Ne(a,v)}h(e,a),h(i,a)}else{r.eval(.5,this._arrowCenter);let a=this._arrowSubdivisions+1&-2;for(let m=0;m<a;++m){let p=m/(a-1),v=W.get(),C=W.get();r.eval(p,v),u.worldUpAtPosition(v,C),h(v,C)}}return ct(this._arrowMaterial,d,c)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&this._geometry!=null){let e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;let e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e,r=e,l=e;this._arrowMaterial.setParameters({stripeEvenColor:s,outlineColor:r,stripeOddColor:l})}};function Dt(t,e,i){let s=We(Ct,e,t),r=$(Ct,s,i);return qe(r)===0}var Ct=y(),Tt=yt();var _=class extends N{get _parameters(){let t=this.view.effectiveTheme,{accentColor:e,textColor:i}=t,s=fe(e),r=Ze(e,.75),l=fe(_e(e)),u=_e(i,Ye.Low);return{accentColor:s,contrastColor:l,translucentAccentColor:r,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:ve(u,.6),textCalloutColor:ve(u,.5)}}get visible(){return this.analysisView.visible}get viewMode(){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(t==null||e==null||t.equals(e))return f.None;let i=this.analysisView.result;if(i==null)return f.Direct;if(this.actualVisualizedMeasurement==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?f.ProjectedGeodesic:f.Direct;let{verticalDistance:s,horizontalDistance:r}=i,l=M(s,"meters").value,u=M(r,"meters").value;return Math.min(l/u,u/l)<this.triangleCollapseRatioThreshold?f.Direct:f.Triangle}get actualVisualizedMeasurement(){let{measurementMode:t,result:e}=this.analysisView;switch(t){case S.Auto:return e!=null&&M(e.horizontalDistance,"meters").value>ht?"geodesic":"euclidean";case S.Euclidean:return"euclidean";case S.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return this._triangleOrientationOverride==null}set allowVisualElementsOrientationChange(t){this._triangleOrientationOverride==null!==t&&(this._triangleOrientationOverride==null?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return this.actualVisualizedMeasurement==="geodesic"?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=y(),this._endPosition=y(),this._cornerPosition=y(),this._startPositionAtSeaLevel=y(),this._endPositionAtSeaLevel=y(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=V.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){let t=this._parameters,e={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:i,guideStippleLengthPixels:s,triangleLineWidth:r,geodesicProjectionLineWidth:l,directLabelFontSize:u,verticalLabelFontSize:d,horizontalLabelFontSize:c}=t;this._segmentVisualElement=new le(E(P({},e),{geometry:null,renderOccluded:x.OccludeAndTransparent})),this._triangleVisualElement=new q(E(P({},e),{width:r,renderOccluded:x.OccludeAndTransparent})),this._rightAngleQuad=new _t(E(P({},e),{renderOccluded:x.OccludeAndTransparent}));let h=E(P({},e),{polygonOffset:!0,renderOccluded:x.OccludeAndTransparent});this._projectedGeodesicLine=new q(E(P({},h),{width:l,stipplePattern:re(s)})),this._geodesicStartHint=new q(E(P({},h),{width:i,stipplePattern:re(s)})),this._geodesicEndHint=new q(E(P({},h),{width:i,stipplePattern:re(s)})),this._segmentLabel=new oe(E(P({},e),{fontSize:u})),this._verticalLabel=new oe(E(P({},e),{fontSize:d})),this._horizontalLabel=new oe(E(P({},e),{fontSize:c})),this.addHandles([L(()=>{let{elevationAlignedStartPoint:a,elevationAlignedEndPoint:m}=this.analysisView,p=this.view;return{view:p,camera:p.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:a,elevationAlignedEndPoint:m,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},a=>this._updateGeometryAndViewMode(a),O),L(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateVisualElementVisibility(a),O),L(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),a=>this._updateLabelText(a),O),L(()=>({visible:this.visible,viewMode:this.viewMode}),a=>this._updateLabelVisibility(a),O),L(()=>this._measurementArrowStripeLength,a=>this._updateSegmentStripeLength(a),O),Te(async()=>this._updateMessageBundle()),L(()=>this._parameters,({textBackgroundColor:a,textCalloutColor:m,textColor:p,translucentAccentColor:v,accentColor:C,contrastColor:R})=>{let{_segmentLabel:G,_verticalLabel:j,_horizontalLabel:z,_triangleVisualElement:H,_rightAngleQuad:ce,_projectedGeodesicLine:b,_geodesicStartHint:F,_geodesicEndHint:de,_segmentVisualElement:D}=this;G.backgroundColor=a,G.calloutColor=m,G.textColor=p,j.backgroundColor=a,j.calloutColor=m,j.textColor=p,z.backgroundColor=a,z.calloutColor=m,z.textColor=p,H.color=v,ce.color=v,b.color=v,F.color=v,de.color=v,D.color=C,D.contrastColor=R},Re)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=w(this._segmentVisualElement),this._triangleVisualElement=w(this._triangleVisualElement),this._rightAngleQuad=w(this._rightAngleQuad),this._projectedGeodesicLine=w(this._projectedGeodesicLine),this._geodesicStartHint=w(this._geodesicStartHint),this._geodesicEndHint=w(this._geodesicEndHint),this._segmentLabel=w(this._segmentLabel),this._verticalLabel=w(this._verticalLabel),this._horizontalLabel=w(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case f.None:break;case f.Direct:this._segmentVisualElement.visible=!0;break;case f.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case f.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:l,visualizedMeasurement:u,stripeLength:d}){let c=t.renderCoordsHelper;if(c==null||s==null||r==null||s.equals(r))return;let h=this._startPosition,a=this._endPosition;c.toRenderCoords(s,h),c.toRenderCoords(r,a);let m=l===V.AboveSegment?1:-1,p=m*(c.getAltitude(a)-c.getAltitude(h));p<0&&(h=this._endPosition,a=this._startPosition);let v=u==="geodesic"?new Pe(this._startPosition,this._endPosition,c.spatialReference):new k(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=v,this._updateSegmentStripeLength(d),i){case f.Direct:this._updateSegment(v,l);break;case f.Triangle:this._updateSegmentAndTriangle({view:t,camera:e,segment:v,orientation:l,startPosition:h,endPosition:a,deltaSign:m,altitudeDelta:p});break;case f.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:l,startPosition:h,endPosition:a})}}_updateSegment(t,e){this._segmentLabel.anchor=e===V.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:i,orientation:s,startPosition:r,endPosition:l,deltaSign:u,altitudeDelta:d}){let c=this._cornerPosition;t.worldUpAtPosition(r,c),Be(c,c,u*Math.abs(d)),ke(c,c,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[c[0],c[1],c[2]],[l[0],l[1],l[2]]]],this._rightAngleQuad.geometry={previous:r,center:c,next:l};let h=new k(r,c),a=new k(c,l),m=xt(r,l,c,s,e);this._segmentLabel.anchor=m.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=m.vertical,this._horizontalLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._horizontalLabel.anchor=m.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:i,endPosition:s}){t.setAltitude(this._startPositionAtSeaLevel,0,i),t.setAltitude(this._endPositionAtSeaLevel,0,s);let r=new Pe(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new k(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new k(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=e===V.AboveSegment?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){t!=null?(this._segmentLabel.text=e==="euclidean"?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){let i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,t)switch(e){case f.Direct:i.visible=!0;break;case f.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case f.ProjectedGeodesic:i.visible=!0;case f.None:}}get _labelsText(){if(this.destroyed)return null;let t=this.messages,e=this.analysisView.result;if(e==null||t==null)return null;let{directDistance:i,horizontalDistance:s,verticalDistance:r}=e,l=this.analysisView.unit,u=d=>P({directDistance:"",horizontalDistance:"",verticalDistance:""},d);switch(l){case"metric":return u({directDistance:i&&Ae(t,i),horizontalDistance:s&&Ae(t,s),verticalDistance:r&&dt(t,r)});case"imperial":return u({directDistance:i&&Ce(t,i),horizontalDistance:s&&Ce(t,s),verticalDistance:r&&ut(t,r)});default:return u({directDistance:i&&ie(t,i,l),horizontalDistance:s&&ie(t,s,l),verticalDistance:r&&ie(t,r,l)})}}_updateSegmentStripeLength(t){let e=this._segmentVisualElement;t!=null?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(this._triangleOrientationOverride!=null)return this._triangleOrientationOverride;let t=this.visualElementOrientation;return t===V.Auto?this.view.state.camera.aboveGround?V.AboveSegment:V.BelowSegment:t}_requiresGeodesicGuideAt(t){let e=this.view;if(!e?.state)return!1;let i=e.state.camera,s=e.renderCoordsHelper;if(!s)return!1;let r=i.computeScreenPixelSizeAt(t);return s.getAltitude(t)/r>=10}get _measurementArrowStripeLength(){let{result:t,unit:e}=this.analysisView;if(t==null)return null;let i=null,s=t.directDistance;switch(e){case"metric":i=s&&M(s,"meters");break;case"imperial":i=s&&M(s,He(s.value,s.unit));break;default:i=s&&M(s,e)}return i==null?null:Ue(i.value/30)*Ge(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,xe("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){}};function xt(t,e,i,s,r){let l=Rt,u=Gt;r.projectToRenderScreen(i,l),r.projectToRenderScreen(e,u);let d={segment:"bottom",horizontal:"top",vertical:l[0]<u[0]?"left":"right"};{let c=jt,h=Ht;if(se(t,i,r,c),se(t,e,r,h),ge(c,h)>=Pt){let a=Math.sign(c[1])===Math.sign(h[1]);d.segment=a?Ee(d.vertical):d.vertical}else{let a=Ut;se(i,e,r,a),ge(a,h)>=Pt&&(d.segment=Math.sign(a[0])===Math.sign(h[0])?Ee(d.horizontal):d.horizontal)}}if(s===V.BelowSegment){let c=h=>h==="top"?"bottom":"top";d.segment=c(d.segment),d.horizontal=c(d.horizontal),d.vertical=c(d.vertical)}return d}o([n()],_.prototype,"_parameters",null),o([n()],_.prototype,"_triangleOrientationOverride",void 0),o([n()],_.prototype,"messages",void 0),o([n()],_.prototype,"view",void 0),o([n()],_.prototype,"analysis",void 0),o([n()],_.prototype,"analysisView",void 0),o([n()],_.prototype,"loadingMessages",void 0),o([n()],_.prototype,"visible",null),o([n()],_.prototype,"viewMode",null),o([n()],_.prototype,"actualVisualizedMeasurement",null),o([n()],_.prototype,"visualElementOrientation",void 0),o([n()],_.prototype,"triangleCollapseRatioThreshold",void 0),o([n()],_.prototype,"allowVisualElementsOrientationChange",null),o([n()],_.prototype,"labels",null),o([n()],_.prototype,"_labelsText",null),o([n()],_.prototype,"_actualVisualElementsOrientation",null),o([n()],_.prototype,"_measurementArrowStripeLength",null),_=o([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],_);var Pt=Math.cos(Ie(12)),Rt=he(),Gt=he(),jt=J(),Ht=J(),Ut=J();var g=class extends bt(N){constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=S.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){let t=this.view,e=this.analysis;this._analysisVisualization=new _({view:t,analysis:e,analysisView:this}),this._analysisController=new T({view:t,analysis:e,viewData:this})}destroy(){this._analysisController=w(this._analysisController),this._analysisVisualization=w(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){}};o([n()],g.prototype,"updating",null),o([n({readOnly:!0})],g.prototype,"type",void 0),o([n({constructOnly:!0,nonNullable:!0})],g.prototype,"analysis",void 0),o([n()],g.prototype,"result",void 0),o([n()],g.prototype,"measurementMode",void 0),o([n()],g.prototype,"elevationAlignedStartPoint",void 0),o([n()],g.prototype,"elevationAlignedEndPoint",void 0),o([n({readOnly:!0})],g.prototype,"viewMode",null),o([n({readOnly:!0})],g.prototype,"actualVisualizedMeasurement",null),o([n()],g.prototype,"visualElementOrientation",null),o([n()],g.prototype,"allowVisualElementsOrientationChange",null),o([n()],g.prototype,"triangleCollapseRatioThreshold",null),o([n({readOnly:!0})],g.prototype,"directLabelText",null),o([n({readOnly:!0})],g.prototype,"horizontalLabelText",null),o([n({readOnly:!0})],g.prototype,"verticalLabelText",null),o([n()],g.prototype,"_analysisVisualization",void 0),o([n()],g.prototype,"_analysisController",void 0),o([n()],g.prototype,"unit",null),o([n(Lt)],g.prototype,"_defaultUnit",void 0),g=o([I("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],g);var Us=g;export{Us as default};
