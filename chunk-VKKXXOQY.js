import{h as Tt}from"./chunk-QT6UNBJP.js";import{m as Pt}from"./chunk-LFH24RLM.js";import{n as Ut}from"./chunk-KGVXGH6H.js";import{a as vt}from"./chunk-DB3UIQCU.js";import{a as bt}from"./chunk-SBHKMV3P.js";import{f as At}from"./chunk-SG7CQU4O.js";import{H as J}from"./chunk-QHVIRF5H.js";import{I as kt}from"./chunk-WZDN6K3C.js";import{a as q}from"./chunk-QGVBCWUY.js";import{v as Mt}from"./chunk-CKJ56T2Q.js";import{b as wt,r as H,t as yt}from"./chunk-UHRSAPGQ.js";import{a as Z,c as ut}from"./chunk-V76GWARL.js";var ot=class{constructor(e=null,n=null,o=null){this.minValue=e,this.maxValue=n,this.noDataValue=o}};var Xt=9999999e31,Jt=2e-7,Kt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function tt(t){return Kt[t]??[-34028234663852886e22,34028234663852886e22]}function ke(t,e){return t==null||e==null?"s32":t<0?t>=-128&&e<128?"s8":t>=-32768&&e<32768?"s16":"s32":e<256?"u8":e<65536?"u16":"u32"}function $t(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function Ae(t,e,n,o){let[r,i]=tt(n),s=$t(n);return s&&(r-=1e-5,i+=1e-5),s?n.startsWith("u")?Ht(t,e,o,[r,i]):Qt(t,e,o,[r,i]):Yt(t,e,o,[r,i])}function be(t,e){for(let n=0;n<e.length;n++)e[n]&&isNaN(t[n])&&(e[n]=0,t[n]=0)}function Ht(t,e,n,o){let[r,i]=o;for(let s=0;s<e.length;s++)if(e[s]){let c=t[s];c<r||c>i?e[s]=0:n[s]=c+.5|0}}function Qt(t,e,n,o){let[r,i]=o;for(let s=0;s<e.length;s++)if(e[s]){let c=t[s];c<r||c>i?e[s]=0:n[s]=c+(c>0?.5:-.5)|0}}function Yt(t,e,n,o){let[r,i]=o;for(let s=0;s<e.length;s++)if(e[s]){let c=t[s];c<r||c>i?e[s]=0:n[s]=c}}function ve(t,e,n){if(t.depthCount&&t.depthCount>1)return;let{pixels:o,statistics:r,pixelType:i}=t,s=o[0].length,c=t.bandMasks??[],h=t.mask??new Uint8Array(s).fill(255),a=i==="f32"||i==="f64",l=tt(i),u=!1;for(let f=0;f<o.length;f++){let m=typeof e=="number"?e:e[f];if(m==null)continue;let d=r?.[f]?.minValue??l[0],g=r?.[f]?.maxValue??l[1];if(d>m+Number.EPSILON||g<m-Number.EPSILON)continue;let w=c[f]||h.slice(),y=o[f],k=n?.customFloatTolerance;if(a&&k!==0){let M=k;M||(M=Math.abs(m)>=Xt?Jt*Math.abs(m):i==="f32"?2**-23:Number.EPSILON);for(let x=0;x<y.length;x++)w[x]&&Math.abs(y[x]-m)<M&&(y[x]=0,w[x]=0,h[x]=0,u=!0)}else for(let M=0;M<y.length;M++)w[M]&&y[M]===m&&(y[M]=0,w[M]=0,h[M]=0,u=!0);c[f]=w}if(u){let f=t.bandMasks||t.pixels.length>1?c:null;n?.matchAllNoData?t.mask=f&&f.length>1?p(f):h:(t.bandMasks=f,t.mask=h)}function p(f){if(f.length<2)return f[0];let m=f[0].length,d=new Uint8Array(m).fill(0);for(let g=0;g<f.length;g++){let w=f[g];for(let y=0;y<m;y++)w[y]&&(d[y]=255)}return d}u&&"updateStatistics"in t&&t.updateStatistics()}var Q,G=Q=class extends At{static createEmptyBand(t,e){return new(Q.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];let e=t[0].length,n=new Uint8Array(e).fill(255);for(let o=0;o<t.length;o++){let r=t[o];for(let i=0;i<e;i++)r[i]||(n[i]=0)}return n}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){return this.pixels?.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new yt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new ot)}getAsRGBA(){let t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){let t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(n=>Zt(n,this.mask));let t=this.mask,e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;let[e,n]=tt(t),o=this.pixels,r=this.width*this.height,i=o.length,s,c,h,a=[];for(let l=0;l<i;l++){h=Q.createEmptyBand(t,r),s=o[l];for(let u=0;u<r;u++)c=s[u],h[u]=c>n?n:c<e?e:c;a.push(h)}this.pixels=a,this.pixelType=t}extractBands(t){let{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;let o=e.length,r=t.some(u=>u>=e.length),i=o===t.length&&!t.some((u,p)=>u!==p);if(r||i)return this;let s=this.bandMasks?.length===o?t.map(u=>this.bandMasks[u]):void 0,{mask:c,validPixelCount:h}=this,{width:a,height:l}=this;return s?.length&&(c=Q.combineBandMasks(s),h=c.filter(u=>!!u).length),new Q({pixelType:this.pixelType,width:a,height:l,mask:c,bandMasks:s,validPixelCount:h,maskIsAlpha:this.maskIsAlpha,pixels:t.map(u=>e[u]),statistics:n&&t.map(u=>n[u])})}clone(){let t=new Q({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount}),e;this.mask!=null&&(t.mask=new Uint8Array(this.mask)),this.bandMasks&&(t.bandMasks=this.bandMasks.map(o=>new Uint8Array(o)));let n=Q.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];let o=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=o?this.pixels[e].slice():new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=wt(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){let{mask:e,maskIsAlpha:n,premultiplyAlpha:o,pixels:r}=this;if(!t||!r?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let i,s,c,h;i=s=c=r[0],r.length>=3?(s=r[1],c=r[2]):r.length===2&&(s=r[1]);let a=new Uint32Array(t),l=this.width*this.height;if(i.length===l)if(e!=null&&e.length===l)if(n)for(h=0;h<l;h++){let u=e[h];if(u){let p=u/255;a[h]=o?u<<24|c[h]*p<<16|s[h]*p<<8|i[h]*p:u<<24|c[h]<<16|s[h]<<8|i[h]}}else for(h=0;h<l;h++)e[h]&&(a[h]=255<<24|c[h]<<16|s[h]<<8|i[h]);else for(h=0;h<l;h++)a[h]=255<<24|c[h]<<16|s[h]<<8|i[h];else H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){let{pixels:e,mask:n,statistics:o}=this;if(!t||!e?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let r=this.pixelType,i=1,s=0,c=1;if(o&&o.length>0){for(let d of o)if(d.minValue!=null&&(s=Math.min(s,d.minValue)),d.maxValue!=null&&d.minValue!=null){let g=d.maxValue-d.minValue;c=Math.max(c,g)}i=255/c}else{let d=255;r==="s8"?(s=-128,d=127):r==="u16"?d=65535:r==="s16"?(s=-32768,d=32767):r==="u32"?d=4294967295:r==="s32"?(s=-2147483648,d=2147483647):r==="f32"?(s=-34e38,d=34e38):r==="f64"&&(s=-Number.MAX_VALUE,d=Number.MAX_VALUE),i=255/(d-s)}let h=new Uint32Array(t),a=this.width*this.height,l,u,p,f,m;if(l=u=p=e[0],l.length!==a)return H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(u=e[1],e.length>=3&&(p=e[2]),n!=null&&n.length===a)for(f=0;f<a;f++)n[f]&&(h[f]=255<<24|(p[f]-s)*i<<16|(u[f]-s)*i<<8|(l[f]-s)*i);else for(f=0;f<a;f++)h[f]=255<<24|(p[f]-s)*i<<16|(u[f]-s)*i<<8|(l[f]-s)*i;else if(n!=null&&n.length===a)for(f=0;f<a;f++)m=(l[f]-s)*i,n[f]&&(h[f]=255<<24|m<<16|m<<8|m);else for(f=0;f<a;f++)m=(l[f]-s)*i,h[f]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(t){let{pixels:e,mask:n}=this;if(!t||!e?.length)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let o,r,i,s;o=r=i=e[0],e.length>=3?(r=e[1],i=e[2]):e.length===2&&(r=e[1]);let c=this.width*this.height;if(o.length!==c)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let h=0;if(n!=null&&n.length===c)for(s=0;s<c;s++)t[h++]=o[s],t[h++]=r[s],t[h++]=i[s],t[h++]=1&n[s];else for(s=0;s<c;s++)t[h++]=o[s],t[h++]=r[s],t[h++]=i[s],t[h++]=1}};function Zt(t,e){let n=1/0,o=-1/0,r=t.length,i,s=0;if(e!=null)for(i=0;i<r;i++)e[i]&&(s=t[i],n=s<n?s:n,o=s>o?s:o);else for(i=0;i<r;i++)s=t[i],n=s<n?s:n,o=s>o?s:o;return new ot(n,o)}q([J({json:{write:!0}})],G.prototype,"width",void 0),q([J({json:{write:!0}})],G.prototype,"height",void 0),q([J({json:{write:!0}})],G.prototype,"pixelType",void 0),q([vt("pixelType")],G.prototype,"castPixelType",null),q([J({json:{write:!0}})],G.prototype,"validPixelCount",void 0),q([J({json:{write:!0}})],G.prototype,"mask",void 0),q([J({json:{write:!0}})],G.prototype,"maskIsAlpha",void 0),q([J({json:{write:!0}})],G.prototype,"pixels",void 0),q([J()],G.prototype,"premultiplyAlpha",void 0),q([J({json:{write:!0}})],G.prototype,"statistics",void 0),q([J({json:{write:!0}})],G.prototype,"depthCount",void 0),q([J({json:{write:!0}})],G.prototype,"noDataValues",void 0),q([J({json:{write:!0}})],G.prototype,"bandMasks",void 0),G=Q=q([kt("esri.layers.support.PixelBlock")],G);var _=G;var Bt,It;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(Bt||(Bt={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(It||(It={}));var Oe=6;function N(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function je(t){if(!t?.length||t.some(l=>!N(l)))return null;if(t.length===1)return t[0]?.clone()??null;let e=t,{width:n,height:o,pixelType:r}=e[0];if(e.some(l=>l.width!==n||l.height!==o))return null;let i=e.map(({mask:l})=>l).filter(l=>l!=null),s=null;i.length&&(s=new Uint8Array(n*o),s.set(i[0]),i.length>1&&Dt(i.slice(1),s));let c=[];e.forEach(({pixels:l})=>c.push(...l));let h=e.map(({statistics:l})=>l).filter(l=>l?.length),a=[];return h.forEach(l=>a.push(...l)),new _({pixelType:r,width:n,height:o,mask:s,pixels:c,statistics:a.length?a:null})}function Ge(t){if(!t)return;let e=t.colormap;if(!e||e.length===0)return;let n=e.sort((u,p)=>u[0]-p[0]),o=0;n[0][0]<0&&(o=n[0][0]);let r=Math.max(256,n[n.length-1][0]-o+1),i=new Uint8Array(4*r),s=[],c,h=0,a=0,l=n[0].length===5;if(r>65536)return n.forEach(u=>{s[u[0]-o]=l?u.slice(1):u.slice(1).concat([255])}),{indexed2DColormap:s,offset:o,alphaSpecified:l};if(t.fillUnspecified)for(c=n[a],h=c[0]-o;h<r;h++)i[4*h]=c[1],i[4*h+1]=c[2],i[4*h+2]=c[3],i[4*h+3]=l?c[4]:255,h===c[0]-o&&(c=a===n.length-1?c:n[++a]);else for(h=0;h<n.length;h++)c=n[h],a=4*(c[0]-o),i[a]=c[1],i[a+1]=c[2],i[a+2]=c[3],i[a+3]=l?c[4]:255;return{indexedColormap:i,offset:o,alphaSpecified:l}}function We(t,e){if(!N(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;let n=t.clone(),o=n.pixels,r=n.mask,i=n.width*n.height;if(o.length!==1)return t;let{indexedColormap:s,indexed2DColormap:c,offset:h,alphaSpecified:a}=e,l=0,u=o[0],p=new Uint8Array(u.length),f=new Uint8Array(u.length),m=new Uint8Array(u.length),d,g=0;if(s){let w=s.length-1;if(r!=null)for(l=0;l<i;l++)r[l]&&(g=4*(u[l]-h),g<h||g>w?r[l]=0:(p[l]=s[g],f[l]=s[g+1],m[l]=s[g+2],r[l]=s[g+3]));else{for(r=new Uint8Array(i),l=0;l<i;l++)g=4*(u[l]-h),g<h||g>w?r[l]=0:(p[l]=s[g],f[l]=s[g+1],m[l]=s[g+2],r[l]=s[g+3]);n.mask=r}}else if(c)if(r!=null)for(l=0;l<i;l++)r[l]&&(d=c[u[l]],p[l]=d[0],f[l]=d[1],m[l]=d[2],r[l]=d[3]);else{for(r=new Uint8Array(i),l=0;l<i;l++)d=c[u[l]],p[l]=d[0],f[l]=d[1],m[l]=d[2],r[l]=d[3];n.mask=r}return n.pixels=[p,f,m],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=a,n}function qe(t,e){if(!N(t))return null;let{pixels:n,mask:o}=t,r=n.length,i=e.lut,{offset:s}=e;i&&i[0].length===1&&(i=n.map(()=>i));let c=[],h=e.outputPixelType||"u8";for(let l=0;l<r;l++){let u=Ct(n[l],o,i[l],s||0,h);c.push(u)}let a=new _({width:t.width,height:t.height,pixels:c,mask:o,pixelType:h});return a.updateStatistics(),a}function Ct(t,e,n,o,r){let i=t.length,s=_.createEmptyBand(r,i);if(e)for(let c=0;c<i;c++)e[c]&&(s[c]=n[t[c]-o]);else for(let c=0;c<i;c++)s[c]=n[t[c]-o];return s}function ze(t,e){if(!N(t))return null;let n=t.clone(),{pixels:o}=n,r=n.width*n.height,i=e.length,s=Math.floor(i/2),c=e[Math.floor(s)],h=o[0],a,l,u,p,f,m,d=!1,g=new Uint8Array(r),w=new Uint8Array(r),y=new Uint8Array(r),k=n.mask,M=e[0].mappedColor.length===4;for(k||(k=new Uint8Array(r),k.fill(M?255:1),n.mask=k),f=0;f<r;f++)if(k[f]){for(a=h[f],d=!1,m=s,l=c,u=0,p=i-1;p-u>1;){if(a===l.value){d=!0;break}a>l.value?u=m:p=m,m=Math.floor((u+p)/2),l=e[Math.floor(m)]}d||(a===e[u].value?(l=e[u],d=!0):a===e[p].value?(l=e[p],d=!0):a<e[u].value?(d=!1,l=null):a>e[u].value&&(a<e[p].value?(l=e[u],d=!0):p===i-1?(d=!1,l=null):(l=e[p],d=!0))),d?(g[f]=l.mappedColor[0],w[f]=l.mappedColor[1],y[f]=l.mappedColor[2],k[f]=l.mappedColor[3]):g[f]=w[f]=y[f]=k[f]=0}return n.pixels=[g,w,y],n.mask=k,n.pixelType="u8",n.maskIsAlpha=M,n}function Xe(t,e){if(!N(t))return null;let{width:n,height:o}=t,{inputRanges:r,outputValues:i,outputPixelType:s,noDataRanges:c,allowUnmatched:h,isLastInputRangeInclusive:a}=e,l=t.pixels[0],u=_.createEmptyBand(s,l.length),p=t.mask,f=new Uint8Array(n*o);p?f.set(p):f.fill(255);let m=t.pixelType.startsWith("f")?1e-6:0,d=r.map(M=>M-m);d[0]=r[0],d[d.length-1]=r[r.length-1]+(a?1e-6:0);let g=r.length/2,[w,y]=tt(s);for(let M=0;M<o;M++)for(let x=0;x<n;x++){let A=M*n+x;if(f[A]){let b=l[A],v=!1;for(let T=g-1;T>=0;T--)if(b===d[2*T]||b>d[2*T]&&b<d[2*T+1]){u[A]=i[T],v=!0;break}v||(h?u[A]=b>y?y:b<w?w:b:f[A]=0)}}let k=c?.length;if(k)for(let M=0;M<o;M++)for(let x=0;x<n;x++){let A=M*n+x;if(!p||p[A]){let b=l[A];for(let v=0;v<k;v+=2)if(b>=c[v]&&b<=c[v+1]){u[A]=0,f[A]=0;break}}}return new _({width:n,height:o,pixelType:s,pixels:[u],mask:f})}function St(t,e,n,o){let r=n!=null&&n.length>=2?new Set(n):null,i=n?.length===1?n[0]:null,s=!!e?.length;for(let c=0;c<t.length;c++)if(o[c]){let h=t[c];if(s){let a=!1;for(let l=0;l<e.length;l+=2)if(h>=e[l]&&h<=e[l+1]){a=!0;break}a||(o[c]=0)}o[c]&&(h===i||r?.has(h))&&(o[c]=0)}}function Vt(t,e){let n=t[0].length;for(let o=0;o<n;o++)if(e[o]){let r=!1;for(let i=0;i<t.length;i++)if(t[i][o]){r=!0;break}r||(e[o]=0)}}function Dt(t,e){let n=t[0].length;for(let o=0;o<n;o++)if(e[o]){let r=!1;for(let i=0;i<t.length;i++)if(t[i][o]===0){r=!0;break}r&&(e[o]=0)}}function Je(t,e){if(!N(t))return null;let{width:n,height:o,pixels:r}=t,i=n*o,s=new Uint8Array(i);t.mask?s.set(t.mask):s.fill(255);let c=r.length,{includedRanges:h,noDataValues:a,outputPixelType:l,matchAll:u,lookups:p}=e;if(p){let f=[];for(let m=0;m<c;m++){let d=p[m],g=Ct(r[m],s,d.lut,d.offset||0,"u8");f.push(g)}f.length===1?s.set(f[0]):u?Vt(f,s):Dt(f,s)}else if(u){let f=[];for(let m=0;m<c;m++){let d=new Uint8Array(i);d.set(s),St(r[m],h?.slice(2*m,2*m+2),a?.[m],d),f.push(d)}f.length===1?s.set(f[0]):Vt(f,s)}else for(let f=0;f<c;f++)St(r[f],h?.slice(2*f,2*f+2),a?.[f],s);return new _({width:n,height:o,pixelType:l,pixels:r,mask:s})}function Ke(t){let{srcPixelType:e,inputRanges:n,outputValues:o,allowUnmatched:r,noDataRanges:i,isLastInputRangeInclusive:s,outputPixelType:c}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;let h=e.includes("16")?65536:256,a=e.includes("s")?-h/2:0,l=_.createEmptyBand(c,h),u=new Uint8Array(h);r&&u.fill(255);let[p,f]=tt(c);if(n?.length&&o?.length){let d=n.map(g=>g-1e-6);d[0]=n[0],s&&(d[d.length-1]=n[n.length-1]);for(let g=0;g<d.length;g++){let w=o[g]>f?f:o[g]<p?p:o[g],y=Math.ceil(d[2*g]-a),k=Math.floor(d[2*g+1]-a);for(let M=y;M<=k;M++)l[M]=w,u[M]=255}}if(i?.length)for(let m=0;m<i.length;m++){let d=Math.ceil(i[2*m]-a),g=Math.floor(i[2*m+1]-a);for(let w=d;w<=g;w++)u[w]=0}return{lut:l,offset:a,mask:u}}function $e(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;let o=t.includes("16")?65536:256,r=t.includes("s")?-o/2:0,i=new Uint8Array(o);if(e)for(let s=0;s<e.length;s++){let c=Math.ceil(e[2*s]-r),h=Math.floor(e[2*s+1]-r);for(let a=c;a<=h;a++)i[a]=255}else i.fill(255);if(n)for(let s=0;s<n.length;s++)i[n[s]-r]=0;return{lut:i,offset:r}}function te(t,e,n,o,r,i,s,c){return{xmin:r<=n*t?0:r<n*t+t?r-n*t:t,ymin:i<=o*e?0:i<o*e+e?i-o*e:e,xmax:r+s<=n*t?0:r+s<n*t+t?r+s-n*t:t,ymax:i+c<=o*e?0:i+c<o*e+e?i+c-o*e:e}}function He(t,e){if(!t||t.length===0)return null;let n=t.find(m=>m.pixelBlock);if(n?.pixelBlock==null)return null;let o=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,r=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,i=.01*Math.min(o,r),s=t.sort((m,d)=>Math.abs(m.extent.ymax-d.extent.ymax)>i?d.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-d.extent.xmin)>i?m.extent.xmin-d.extent.xmin:0),c=Math.min.apply(null,s.map(m=>m.extent.xmin)),h=Math.min.apply(null,s.map(m=>m.extent.ymin)),a=Math.max.apply(null,s.map(m=>m.extent.xmax)),l=Math.max.apply(null,s.map(m=>m.extent.ymax)),u={x:Math.round((e.xmin-c)/o),y:Math.round((l-e.ymax)/r)},p={width:Math.round((a-c)/o),height:Math.round((l-h)/r)},f={width:Math.round((e.xmax-e.xmin)/o),height:Math.round((e.ymax-e.ymin)/r)};return Math.round(p.width/n.pixelBlock.width)*Math.round(p.height/n.pixelBlock.height)!==s.length||u.x<0||u.y<0||p.width<f.width||p.height<f.height?null:{extent:e,pixelBlock:ee(s.map(m=>m.pixelBlock),p,{clipOffset:u,clipSize:f})}}function pt(t,e,n,o,r,i){let{width:s,height:c}=n.block,{x:h,y:a}=n.offset,{width:l,height:u}=n.mosaic,p=te(s,c,o,r,h,a,l,u),f=0,m=0;if(i){let d=i.hasGCSSShiftTransform?360:i.halfWorldWidth??0,g=s*i.resolutionX,w=i.startX+o*g;w<d&&w+g>d?m=i.rightPadding:w>=d&&(f=i.leftMargin-i.rightPadding,m=0)}if(p.xmax-=m,typeof e!="number")for(let d=p.ymin;d<p.ymax;d++){let g=(r*c+d-a)*l+(o*s-h)+f,w=d*s;for(let y=p.xmin;y<p.xmax;y++)t[g+y]=e[w+y]}else for(let d=p.ymin;d<p.ymax;d++){let g=(r*c+d-a)*l+(o*s-h)+f;for(let w=p.xmin;w<p.xmax;w++)t[g+w]=e}}function ee(t,e,n={}){let{clipOffset:o,clipSize:r,alignmentInfo:i,blockWidths:s}=n;if(s)return ne(t,e,{blockWidths:s});let c=t.find(P=>N(P));if(c==null)return null;let h=r?r.width:e.width,a=r?r.height:e.height,l=c.width,u=c.height,p=e.width/l,f=e.height/u,m={offset:o||{x:0,y:0},mosaic:r||e,block:{width:l,height:u}},d=c.pixelType,g=_.getPixelArrayConstructor(d),w=c.pixels.length,y=[],k,M;for(let P=0;P<w;P++){M=new g(h*a);for(let B=0;B<f;B++)for(let U=0;U<p;U++){let I=t[B*p+U];N(I)&&(k=I.pixels[P],pt(M,k,m,U,B,i))}y.push(M)}let x=t.some(P=>P==null||P.mask!=null&&P.mask.length>0),A=t.some(P=>P?.bandMasks&&P.bandMasks.length>1),b=x?new Uint8Array(h*a):void 0,v=A?[]:void 0;if(b){for(let P=0;P<f;P++)for(let B=0;B<p;B++){let U=t[P*p+B],I=U!=null?U.mask:null;pt(b,I??(U?255:0),m,B,P,i)}if(v)for(let P=0;P<w;P++){let B=new Uint8Array(h*a);for(let U=0;U<f;U++)for(let I=0;I<p;I++){let C=t[U*p+I],V=C?.bandMasks?.[P]??C?.mask;pt(B,V??(C?255:0),m,I,U,i)}v.push(B)}}let T=new _({width:h,height:a,pixels:y,pixelType:d,bandMasks:v,mask:b});return T.updateStatistics(),T}function ne(t,e,n){let o=t.find(g=>g!=null);if(o==null)return null;let r=t.some(g=>g==null||!!g.mask),{width:i,height:s}=e,c=r?new Uint8Array(i*s):null,{blockWidths:h}=n,a=[],l=o.getPlaneCount(),u=_.getPixelArrayConstructor(o.pixelType);if(r)for(let g=0,w=0;g<t.length;w+=h[g],g++){let y=t[g];if(!N(y))continue;let k=y.mask;for(let M=0;M<s;M++)for(let x=0;x<h[g];x++)c[M*i+x+w]=k==null?255:k[M*y.width+x]}let p=t.some(g=>g?.bandMasks&&g.bandMasks.length>1),f=p?[]:void 0,m=i*s;for(let g=0;g<l;g++){let w=new u(m),y=p?new Uint8Array(m):void 0;for(let k=0,M=0;k<t.length;M+=h[k],k++){let x=t[k];if(!N(x))continue;let A=x.pixels[g];if(A!=null){for(let b=0;b<s;b++)for(let v=0;v<h[k];v++)w[b*i+v+M]=A[b*x.width+v];if(y){let b=x.bandMasks?.[g]??x.mask;for(let v=0;v<s;v++)for(let T=0;T<h[k];T++)y[v*i+T+M]=b?b[v*x.width+T]:255}}}a.push(w),f&&y&&f.push(y)}let d=new _({width:i,height:s,mask:c,bandMasks:f,pixels:a,pixelType:o.pixelType});return d.updateStatistics(),d}function Qe(t,e,n){if(!N(t))return null;let{width:o,height:r}=t,i=e.x,s=e.y,c=n.width+i,h=n.height+s;if(i<0||s<0||c>o||h>r||i===0&&s===0&&c===o&&h===r)return t;t.mask||(t.mask=new Uint8Array(o*r));let a=t.mask;for(let l=0;l<r;l++){let u=l*o;for(let p=0;p<o;p++)a[u+p]=l<s||l>=h||p<i||p>=c?0:1}return t.updateStatistics(),t}function ie(t){if(!N(t))return null;let e=t.clone(),{width:n,height:o,pixels:r}=t,i=r[0],s=e.pixels[0],c=t.mask;for(let h=2;h<o-1;h++){let a=new Map;for(let u=h-2;u<h+2;u++)for(let p=0;p<4;p++){let f=u*n+p;rt(a,i[f],c?c[f]:1)}s[h*n]=Ft(a),s[h*n+1]=s[h*n+2]=s[h*n];let l=3;for(;l<n-1;l++){let u=(h-2)*n+l+1;rt(a,i[u],c?c[u]:1),u=(h-1)*n+l+1,rt(a,i[u],c?c[u]:1),u=h*n+l+1,rt(a,i[u],c?c[u]:1),u=(h+1)*n+l+1,rt(a,i[u],c?c[u]:1),u=(h-2)*n+l-3,at(a,i[u],c?c[u]:1),u=(h-1)*n+l-3,at(a,i[u],c?c[u]:1),u=h*n+l-3,at(a,i[u],c?c[u]:1),u=(h+1)*n+l-3,at(a,i[u],c?c[u]:1),s[h*n+l]=Ft(a)}s[h*n+l+1]=s[h*n+l]}for(let h=0;h<n;h++)s[h]=s[n+h]=s[2*n+h],s[(o-1)*n+h]=s[(o-2)*n+h];return e.updateStatistics(),e}function Ft(t){if(t.size===0)return 0;let e=0,n=-1,o=0,r=t.keys(),i=r.next();for(;!i.done;)o=t.get(i.value),o>e&&(n=i.value,e=o),i=r.next();return n}function at(t,e,n){if(n===0)return;let o=t.get(e);o===1?t.delete(e):t.set(e,o-1)}function rt(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function _t(t,e,n){let{x:o,y:r}=e,{width:i,height:s}=n;if(o===0&&r===0&&s===t.height&&i===t.width)return t;let{width:c,height:h}=t,a=Math.max(0,r),l=Math.max(0,o),u=Math.min(o+i,c),p=Math.min(r+s,h);if(u<0||p<0||!N(t))return null;o=Math.max(0,-o),r=Math.max(0,-r);let{pixels:f}=t,m=i*s,d=f.length,g=[];for(let M=0;M<d;M++){let x=f[M],A=_.createEmptyBand(t.pixelType,m);for(let b=a;b<p;b++){let v=b*c,T=(b+r-a)*i+o;for(let P=l;P<u;P++)A[T++]=x[v+P]}g.push(A)}let w=new Uint8Array(m),y=t.mask;for(let M=a;M<p;M++){let x=M*c,A=(M+r-a)*i+o;for(let b=l;b<u;b++)w[A++]=y?y[x+b]:1}let k=new _({width:n.width,height:n.height,pixelType:t.pixelType,pixels:g,mask:w});return k.updateStatistics(),k}function Nt(t,e=!0){if(!N(t))return null;let{pixels:n,width:o,height:r,mask:i,pixelType:s}=t,c=[],h=Math.round(o/2),a=Math.round(r/2),l=r-1,u=o-1;for(let f=0;f<n.length;f++){let m=n[f],d=_.createEmptyBand(s,h*a),g=0;for(let w=0;w<r;w+=2)for(let y=0;y<o;y+=2){let k=m[w*o+y];if(e){let M=y===u?k:m[w*o+y+1],x=w===l?k:m[w*o+y+o],A=y===u?x:w===l?M:m[w*o+y+o+1];d[g++]=(k+M+x+A)/4}else d[g++]=k}c.push(d)}let p=null;if(i!=null){p=new Uint8Array(h*a);let f=0;for(let m=0;m<r;m+=2)for(let d=0;d<o;d+=2){let g=i[m*o+d];if(e){let w=d===u?g:i[m*o+d+1],y=m===l?g:i[m*o+d+o],k=d===u?y:m===l?w:i[m*o+d+o+1];p[f++]=g*w*y*k?1:0}else p[f++]=g}}return new _({width:h,height:a,pixelType:s,pixels:c,mask:p})}function Ye(t,e,n=0,o=!0){if(!N(t))return null;let{width:r,height:i}=e,{width:s,height:c}=t,h=new Map,a={x:0,y:0},l=1+n,u=t;for(let p=0;p<l;p++){let f=Math.ceil(s/r),m=Math.ceil(c/i);for(let d=0;d<m;d++){a.y=d*i;for(let g=0;g<f;g++){a.x=g*r;let w=_t(u,a,e);h.set(`${p}/${d}/${g}`,w)}}p<l-1&&(u=Nt(u,o)),s=Math.round(s/2),c=Math.round(c/2)}return h}function Ze(t){let{pixelBlock:e,tileSize:n,level:o,row:r,col:i,useBilinear:s}=t;if(!N(e))return null;let{width:c,height:h}=n,a=2**o,l=a*c,u=a*h,p=_t(e,{y:r*u,x:i*l},{width:l,height:u});if(!p)return null;for(let f=o;f>0;f--)p=Nt(p,s);return p}function Rt(t,e,n,o,r=0){let{width:i,height:s}=t,{width:c,height:h}=e,a=o.cols,l=o.rows,u=Math.ceil(c/a-.1/a),p=Math.ceil(h/l-.1/l),f,m,d,g,w,y,k,M=u*a,x=M*p*l,A=new Float32Array(x),b=new Float32Array(x),v=new Uint32Array(x),T=new Uint32Array(x),P,B,U=0;for(let I=0;I<p;I++)for(let C=0;C<u;C++){f=12*(I*u+C),m=n[f],d=n[f+1],g=n[f+2],w=n[f+3],y=n[f+4],k=n[f+5];for(let V=0;V<l;V++){U=(I*l+V)*M+C*a,B=(V+.5)/l;for(let S=0;S<V;S++)P=(S+.5)/a,A[U+S]=(m*P+d*B+g)*i+r,b[U+S]=(w*P+y*B+k)*s+r,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}f+=6,m=n[f],d=n[f+1],g=n[f+2],w=n[f+3],y=n[f+4],k=n[f+5];for(let V=0;V<l;V++){U=(I*l+V)*M+C*a,B=(V+.5)/l;for(let S=V;S<a;S++)P=(S+.5)/a,A[U+S]=(m*P+d*B+g)*i+r,b[U+S]=(w*P+y*B+k)*s+r,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}}return{offsets_x:A,offsets_y:b,offsets_xi:v,offsets_yi:T,gridWidth:M}}function tn(t,e){let{coefficients:n,spacing:o}=e,{offsets_x:r,offsets_y:i,gridWidth:s}=Rt(t,t,n,{rows:o[0],cols:o[1]}),{width:c,height:h}=t,a=new Float32Array(c*h),l=180/Math.PI;for(let u=0;u<h;u++)for(let p=0;p<c;p++){let f=u*s+p,m=u===0?f:f-s,d=u===h-1?f:f+s,g=r[m]-r[d],w=i[d]-i[m];if(isNaN(g)||isNaN(w))a[u*c+p]=90;else{let y=Math.atan2(w,g)*l;y=(360+y)%360,a[u*c+p]=y}}return a}function en(t,e,n,o,r="nearest"){if(!N(t))return null;r==="majority"&&(t=ie(t));let{pixels:i,mask:s,bandMasks:c,pixelType:h}=t,a=t.width,l=t.height,u=_.getPixelArrayConstructor(h),p=i.length,{width:f,height:m}=e,d=!1;for(let U=0;U<n.length;U+=3)n[U]===-1&&n[U+1]===-1&&n[U+2]===-1&&(d=!0);let{offsets_x:g,offsets_y:w,offsets_xi:y,offsets_yi:k,gridWidth:M}=Rt({width:a,height:l},e,n,o,r==="majority"?.5:0),x,A=(U,I,C,V)=>{let S=U instanceof Float32Array||U instanceof Float64Array?0:.5;for(let F=0;F<m;F++){x=F*M;for(let D=0;D<f;D++){if(g[x]<0||w[x]<0)U[F*f+D]=0;else if(V)U[F*f+D]=I[y[x]+k[x]*a];else{let O=Math.floor(g[x]),z=Math.floor(w[x]),L=Math.ceil(g[x]),W=Math.ceil(w[x]),X=g[x]-O,$=w[x]-z;if(!C||C[O+z*a]&&C[L+z*a]&&C[O+W*a]&&C[L+W*a]){let it=(1-X)*I[O+z*a]+X*I[L+z*a],Y=(1-X)*I[O+W*a]+X*I[L+W*a];U[F*f+D]=(1-$)*it+$*Y+S}else U[F*f+D]=I[y[x]+k[x]*a]}x++}}},b=[],v,T=c?.length===p,P=[];for(let U=0;U<p;U++){if(T){let I=new Uint8Array(f*m);A(I,c[U],c[U],!0),P.push(I)}v=new u(f*m),A(v,i[U],T?c[U]:s,r==="nearest"||r==="majority"),b.push(v)}let B=new _({width:f,height:m,pixelType:h,pixels:b,bandMasks:T?P:void 0});if(s!=null)B.mask=new Uint8Array(f*m),A(B.mask,s,s,!0);else if(d){B.mask=new Uint8Array(f*m);for(let U=0;U<f*m;U++)B.mask[U]=g[U]<0||w[U]<0?0:1}return B.updateStatistics(),B}var nt=new Map;nt.set("meter-per-second",1),nt.set("kilometer-per-hour",.277778),nt.set("knots",.514444),nt.set("feet-per-second",.3048),nt.set("mile-per-hour",.44704);var dt=180/Math.PI,gt=5,ct=new bt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function xt(t,e){return nt.get(t)/nt.get(e)||1}function Et(t){return(450-t)%360}function Ot(t,e="geographic"){let[n,o]=t,r=Math.sqrt(n*n+o*o),i=Math.atan2(o,n)*dt;return i=(360+i)%360,e==="geographic"&&(i=Et(i)),[r,i]}function jt(t,e="geographic"){let n=t[1];e==="geographic"&&(n=Et(n)),n%=360;let o=t[0];return[o*Math.cos(n/dt),o*Math.sin(n/dt)]}function rn(t,e,n,o="geographic"){if(!N(t)||n==null)return t;let r=e==="vector-magdir"?t.clone():Lt(t,e),i=r.pixels[1];for(let s=0;s<i.length;s++)i[s]=o==="geographic"?(i[s]+n[s]+270)%360:(i[s]+360-n[s])%360;return e==="vector-magdir"?r:Lt(r,"vector-magdir")}function Lt(t,e,n="geographic",o=1){if(!N(t))return t;let{pixels:r,width:i,height:s}=t,c=i*s,h=r[0],a=r[1],l=t.pixelType.startsWith("f")?t.pixelType:"f32",u=_.createEmptyBand(l,c),p=_.createEmptyBand(l,c),f=0;for(let d=0;d<s;d++)for(let g=0;g<i;g++)e==="vector-uv"?([u[f],p[f]]=Ot([h[f],a[f]],n),u[f]*=o):([u[f],p[f]]=jt([h[f],a[f]],n),u[f]*=o,p[f]*=o),f++;let m=new _({pixelType:l,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[u,p]});return m.updateStatistics(),m}function an(t,e,n=1){if(n===1||!N(t))return t;let o=t.clone(),{pixels:r,width:i,height:s}=o,c=r[0],h=r[1],a=0;for(let l=0;l<s;l++)for(let u=0;u<i;u++)e==="vector-uv"?(c[a]*=n,h[a]*=n):c[a]*=n,a++;return o.updateStatistics(),o}function hn(t,e,n,o,r){if(r==null||!r.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/o),height:Math.round(n/o),resolution:t.width/e};let i=r.xmin,s=r.ymax,c=(t.xmax-t.xmin)/e*o,h=(t.ymax-t.ymin)/n*o,a=(c+h)/2;return t.xmin=i+Math.floor((t.xmin-i)/c)*c,t.xmax=i+Math.ceil((t.xmax-i)/c)*c,t.ymin=s+Math.floor((t.ymin-s)/h)*h,t.ymax=s+Math.ceil((t.ymax-s)/h)*h,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/h),resolution:a}}var se=Gt(0,0,0);function Gt(t=0,e=0,n=Math.PI,o=!0){o&&(n=(2*Math.PI-n)%(2*Math.PI));let r=o?-1:1,i=13*r,s=-7*r,c=-2*r,h=-16*r,a=21.75,[l,u]=j(0,e+i,n,a),[p,f]=j(t-5.5,e+s,n,a),[m,d]=j(t+5.5,e+s,n,a),[g,w]=j(t-1.5,e+c,n,a),[y,k]=j(t+1.5,e+c,n,a),[M,x]=j(t-1.5,e+h,n,a),[A,b]=j(t+1.5,e+h,n,a);return[l,u,p,f,g,w,y,k,m,d,M,x,A,b]}function le(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));let o=10,r=n?-1:1,i=5*r,s=20*r,c=25*r,h=45,a=0,l=0,u=2,p=0,f=u*r,m=n?1:-1,d=o/2*m,[g,w]=[a+d,l-s],[y,k]=[g+u*m,w],[M,x]=[y-p*m,k+f],[A,b]=[a-d,l-c],[v,T]=[A+p*m,b-f],P=Math.ceil(t/gt),B=Math.floor(P/10);P-=8*B;let U=[],I=[];for(let X=0;X<P/2;X++,B--){B<=0&&P%2==1&&X===(P-1)/2&&(A=a,v=A+p*m,b=(b+w)/2,T=b-f);let[$,it]=j(A,b,e,h);if(B>0){let[Y,st]=j(y,b,e,h),[lt,R]=j(g,w,e,h);U.push(Y),U.push(st),U.push($),U.push(it),U.push(lt),U.push(R)}else{let[Y,st]=j(y,k,e,h),[lt,R]=j(M,x,e,h),[E,ft]=j(v,T,e,h);I.push($),I.push(it),I.push(E),I.push(ft),I.push(lt),I.push(R),I.push(Y),I.push(st)}b+=i,w+=i,k+=i,x+=i,T+=i}let[C,V]=j(a+d,l+s,e,h),S=(o/2+u)*m,[F,D]=j(a+S,l+s,e,h),[O,z]=j(a+d,l-c,e,h),[L,W]=j(a+S,l-c,e,h);return{pennants:U,barbs:I,shaft:[C,V,F,D,O,z,L,W]}}function j(t,e,n,o=1){let r=Math.sqrt(t*t+e*e)/o,i=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[r,(2*Math.PI+i-n)%(2*Math.PI)]}var ht=[0,1,3,6,10,16,21,27,33,40,47,55,63],oe=[0,.5,1,1.5,2],re=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function et(t,e,n,o){let r=xt(o||"knots",n),i;for(i=1;i<e.length;i++)if(i===e.length-1){if(t<e[i]*r)break}else if(t<=e[i]*r)break;return Math.min(i-1,e.length-2)}function ae(t,e,n,o,r){let i=0;switch(e){case"beaufort_kn":i=et(t,ht,"knots",n);break;case"beaufort_km":i=et(t,ht,"kilometer-per-hour",n);break;case"beaufort_ft":i=et(t,ht,"feet-per-second",n);break;case"beaufort_m":i=et(t,ht,"meter-per-second",n);break;case"classified_arrow":i=et(t,r??[],o,n);break;case"ocean_current_m":i=et(t,oe,"meter-per-second",n);break;case"ocean_current_kn":i=et(t,re,"knots",n)}return i}function he(t,e){let{style:n,inputUnit:o,outputUnit:r,breakValues:i}=e,s=ct.fromJSON(o),c=ct.fromJSON(r),h=7*6,a=15,l=0,u=0,{width:p,height:f,mask:m}=t,d=t.pixels[0],g=t.pixels[1],w=m!=null?m.filter(x=>x>0).length:p*f,y=new Float32Array(w*h),k=new Uint32Array(a*w),M=e.invertDirection?Gt(0,0,0,!1):se;for(let x=0;x<f;x++)for(let A=0;A<p;A++){let b=x*p+A;if(!m||m[x*p+A]){let v=(g[b]+360)%360/180*Math.PI,T=ae(d[b],n,s,c,i);for(let B=0;B<M.length;B+=2)y[l++]=(A+.5)/p,y[l++]=(x+.5)/f,y[l++]=M[B],y[l++]=M[B+1]+v,y[l++]=T,y[l++]=d[b];let P=7*(l/h-1);k[u++]=P,k[u++]=P+1,k[u++]=P+2,k[u++]=P+0,k[u++]=P+4,k[u++]=P+3,k[u++]=P+0,k[u++]=P+2,k[u++]=P+3,k[u++]=P+2,k[u++]=P+5,k[u++]=P+3,k[u++]=P+5,k[u++]=P+6,k[u++]=P+3}}return{vertexData:y,indexData:k}}var mt=[];function ce(t,e){if(mt.length===0)for(let f=0;f<30;f++)mt.push(le(5*f,0,!e.invertDirection));let n=xt(ct.fromJSON(e.inputUnit),"knots"),{width:o,height:r,mask:i}=t,s=t.pixels[0],c=t.pixels[1],h=6,a=[],l=[],u=0,p=0;for(let f=0;f<r;f++)for(let m=0;m<o;m++){let d=f*o+m,g=s[d]*n;if((!i||i[f*o+m])&&g>=gt){let w=(c[d]+360)%360/180*Math.PI,{pennants:y,barbs:k,shaft:M}=mt[Math.min(Math.floor(g/5),29)];if(y.length+k.length===0)continue;let x=a.length/h,A=(m+.5)/o,b=(f+.5)/r;for(let v=0;v<y.length;v+=2)a[u++]=A,a[u++]=b,a[u++]=y[v],a[u++]=y[v+1]+w,a[u++]=0,a[u++]=g;for(let v=0;v<k.length;v+=2)a[u++]=A,a[u++]=b,a[u++]=k[v],a[u++]=k[v+1]+w,a[u++]=0,a[u++]=g;for(let v=0;v<M.length;v+=2)a[u++]=A,a[u++]=b,a[u++]=M[v],a[u++]=M[v+1]+w,a[u++]=0,a[u++]=g;for(let v=0;v<y.length/6;v++)l[p++]=x,l[p++]=x+1,l[p++]=x+2,x+=3;for(let v=0;v<k.length/8;v++)l[p++]=x,l[p++]=x+1,l[p++]=x+2,l[p++]=x+1,l[p++]=x+2,l[p++]=x+3,x+=4;l[p++]=x+0,l[p++]=x+1,l[p++]=x+2,l[p++]=x+1,l[p++]=x+3,l[p++]=x+2,x+=4}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(l)}}function fe(t,e){let o=0,r=0,{width:i,height:s,mask:c}=t,h=t.pixels[0],a=[],l=[],u=xt(ct.fromJSON(e.inputUnit),"knots"),p=e.style==="wind_speed"?gt:Number.MAX_VALUE;for(let f=0;f<s;f++)for(let m=0;m<i;m++){let d=h[f*i+m]*u;if((!c||c[f*i+m])&&d<p){for(let w=0;w<4;w++)a[o++]=(m+.5)/i,a[o++]=(f+.5)/s,a[o++]=w<2?-.5:.5,a[o++]=w%2==0?-.5:.5,a[o++]=0,a[o++]=d;let g=4*(o/24-1);l[r++]=g,l[r++]=g+1,l[r++]=g+2,l[r++]=g+1,l[r++]=g+2,l[r++]=g+3}}return{vertexData:new Float32Array(a),indexData:new Uint32Array(l)}}function cn(t,e){return e.style==="simple_scalar"?fe(t,e):e.style==="wind_speed"?ce(t,e):he(t,e)}function fn(t,e,n,o=[0,0],r=.5){let{width:i,height:s,mask:c}=t,[h,a]=t.pixels,[l,u]=o,p=Math.round((i-l)/n),f=Math.round((s-u)/n),m=p*f,d=new Float32Array(m),g=new Float32Array(m),w=new Uint8Array(m),y=e==="vector-uv";for(let M=0;M<f;M++)for(let x=0;x<p;x++){let A=0,b=M*p+x,v=Math.max(0,M*n+u),T=Math.max(0,x*n+l),P=Math.min(s,v+n),B=Math.min(i,T+n);for(let U=v;U<P;U++)for(let I=T;I<B;I++){let C=U*i+I;if(!c||c[C]){A++;let V=y?[h[C],a[C]]:[h[C],(360+a[C])%360],[S,F]=y?V:jt(V);d[b]+=S,g[b]+=F}}if(A>=(P-v)*(B-T)*(1-r)){w[b]=1;let[U,I]=Ot([d[b]/A,g[b]/A]);d[b]=U,g[b]=I}else w[b]=0,d[b]=0,g[b]=0}let k=new _({width:p,height:f,pixels:[d,g],mask:w});return k.updateStatistics(),k}var K=()=>H.getLogger("esri.views.2d.engine.flow.dataUtils"),ue=10;async function Mn(t,e,n,o){let r=performance.now(),i=pe(e,n),s=performance.now(),c=de(e,i,n.width,n.height),h=performance.now(),a=xe(c,!0),l=performance.now(),u=t==="Streamlines"?we(a,ue):ye(a),p=performance.now();return Z("esri-2d-profiler")&&(K().info("I.1","_createFlowFieldFromData (ms)",Math.round(s-r)),K().info("I.2","_getStreamlines (ms)",Math.round(h-s)),K().info("I.3","createAnimatedLinesData (ms)",Math.round(l-h)),K().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-l)),K().info("I.5","createFlowMesh (ms)",Math.round(p-r)),K().info("I.6","Mesh size (bytes)",u.vertexData.buffer.byteLength+u.indexData.buffer.byteLength)),await Promise.resolve(),Mt(o),u}function pe(t,e){let n=ge(e.data,e.width,e.height,t.smoothing);return t.interpolate?(o,r)=>{let i=Math.floor(o),s=Math.floor(r);if(i<0||i>=e.width)return[0,0];if(s<0||s>=e.height)return[0,0];let c=o-i,h=r-s,a=i,l=s,u=i<e.width-1?i+1:i,p=s<e.height-1?s+1:s,f=n[2*(l*e.width+a)],m=n[2*(l*e.width+u)],d=n[2*(p*e.width+a)],g=n[2*(p*e.width+u)],w=n[2*(l*e.width+a)+1],y=n[2*(l*e.width+u)+1];return[(f*(1-h)+d*h)*(1-c)+(m*(1-h)+g*h)*c,(w*(1-h)+n[2*(p*e.width+a)+1]*h)*(1-c)+(y*(1-h)+n[2*(p*e.width+u)+1]*h)*c]}:(o,r)=>{let i=Math.round(o),s=Math.round(r);return i<0||i>=e.width||s<0||s>=e.height?[0,0]:[n[2*(s*e.width+i)],n[2*(s*e.width+i)+1]]}}function me(t,e,n,o,r,i,s,c,h){let a=[],l=n,u=o,p=0,[f,m]=e(l,u);f*=t.velocityScale,m*=t.velocityScale;let d=Math.sqrt(f*f+m*m),g,w;a.push({x:l,y:u,t:p,speed:d});for(let y=0;y<t.verticesPerLine;y++){let[k,M]=e(l,u);k*=t.velocityScale,M*=t.velocityScale;let x=Math.sqrt(k*k+M*M);if(x<t.minSpeedThreshold)return a;let A=k/x,b=M/x;if(l+=A*t.segmentLength,u+=b*t.segmentLength,p+=t.segmentLength/x,Math.acos(A*g+b*w)>t.maxTurnAngle)return a;if(t.collisions){let v=Math.round(l*h),T=Math.round(u*h);if(v<0||v>s-1||T<0||T>c-1)return a;let P=i[T*s+v];if(P!==-1&&P!==r)return a;i[T*s+v]=r}a.push({x:l,y:u,t:p,speed:x}),g=A,w=b}return a}function de(t,e,n,o){let r=[],i=new ut,s=1/Math.max(t.lineCollisionWidth,1),c=Math.round(n*s),h=Math.round(o*s),a=new Int32Array(c*h);for(let u=0;u<a.length;u++)a[u]=-1;let l=[];for(let u=0;u<o;u+=t.lineSpacing)for(let p=0;p<n;p+=t.lineSpacing)l.push({x:p,y:u,sort:i.getFloat()});l.sort((u,p)=>u.sort-p.sort);for(let{x:u,y:p}of l)if(i.getFloat()<t.density){let f=me(t,e,u,p,r.length,a,c,h,s);if(f.length<2)continue;r.push(f)}return r}function ge(t,e,n,o){if(o===0)return t;let r=Math.round(3*o),i=new Array(2*r+1),s=0;for(let a=-r;a<=r;a++){let l=Math.exp(-a*a/(o*o));i[a+r]=l,s+=l}for(let a=-r;a<=r;a++)i[a+r]/=s;let c=new Float32Array(t.length);for(let a=0;a<n;a++)for(let l=0;l<e;l++){let u=0,p=0;for(let f=-r;f<=r;f++){if(l+f<0||l+f>=e)continue;let m=i[f+r];u+=m*t[2*(a*e+(l+f))],p+=m*t[2*(a*e+(l+f))+1]}c[2*(a*e+l)]=u,c[2*(a*e+l)+1]=p}let h=new Float32Array(t.length);for(let a=0;a<e;a++)for(let l=0;l<n;l++){let u=0,p=0;for(let f=-r;f<=r;f++){if(l+f<0||l+f>=n)continue;let m=i[f+r];u+=m*c[2*((l+f)*e+a)],p+=m*c[2*((l+f)*e+a)+1]}h[2*(l*e+a)]=u,h[2*(l*e+a)+1]=p}return h}function xe(t,e){let n=new ut,o=t.reduce((h,a)=>h+a.length,0),r=new Float32Array(4*o),i=new Array(t.length),s=0,c=0;for(let h of t){let a=s;for(let l of h)r[4*s]=l.x,r[4*s+1]=l.y,r[4*s+2]=l.t,r[4*s+3]=l.speed,s++;i[c++]={startVertex:a,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:r,lineDescriptors:i}}function we(t,e){let{lineVertices:o,lineDescriptors:r}=t,i=0,s=0;for(let f of r)i+=2*f.numberOfVertices,s+=6*(f.numberOfVertices-1);let c=new Float32Array(i*9),h=new Uint32Array(s),a=0,l=0;function u(){h[l++]=a-2,h[l++]=a,h[l++]=a-1,h[l++]=a,h[l++]=a+1,h[l++]=a-1}function p(f,m,d,g,w,y,k,M){let x=a*9,A=0;c[x+A++]=f,c[x+A++]=m,c[x+A++]=1,c[x+A++]=d,c[x+A++]=y,c[x+A++]=k,c[x+A++]=g/2,c[x+A++]=w/2,c[x+A++]=M,a++,c[x+A++]=f,c[x+A++]=m,c[x+A++]=-1,c[x+A++]=d,c[x+A++]=y,c[x+A++]=k,c[x+A++]=-g/2,c[x+A++]=-w/2,c[x+A++]=M,a++}for(let f of r){let{totalTime:m,timeSeed:d}=f,g=null,w=null,y=null,k=null,M=null,x=null;for(let A=0;A<f.numberOfVertices;A++){let b=o[4*(f.startVertex+A)],v=o[4*(f.startVertex+A)+1],T=o[4*(f.startVertex+A)+2],P=o[4*(f.startVertex+A)+3],B=null,U=null,I=null,C=null;if(A>0){B=b-g,U=v-w;let V=Math.sqrt(B*B+U*U);if(B/=V,U/=V,A>1){let S=B+M,F=U+x,D=Math.sqrt(S*S+F*F);S/=D,F/=D;let O=Math.min(1/(S*B+F*U),e);S*=O,F*=O,I=-F,C=S}else I=-U,C=B;I!==null&&C!==null&&(p(g,w,y,I,C,m,d,P),u())}g=b,w=v,y=T,M=B,x=U,k=P}p(g,w,y,-x,M,m,d,k)}return{vertexData:c,indexData:h}}function ye(t){let{lineVertices:r,lineDescriptors:i}=t,s=0,c=0;for(let V of i){let S=V.numberOfVertices-1;s+=4*S*2,c+=6*S*2}let h=new Float32Array(s*16),a=new Uint32Array(c),l,u,p,f,m,d,g,w,y,k,M,x,A,b,v=0,T=0;function P(){a[T++]=v-8,a[T++]=v-7,a[T++]=v-6,a[T++]=v-7,a[T++]=v-5,a[T++]=v-6,a[T++]=v-4,a[T++]=v-3,a[T++]=v-2,a[T++]=v-3,a[T++]=v-1,a[T++]=v-2}function B(V,S,F,D,O,z,L,W,X,$,it,Y,st,lt){let R=v*16,E=0;for(let ft of[1,2])for(let zt of[1,2,3,4])h[R+E++]=V,h[R+E++]=S,h[R+E++]=F,h[R+E++]=D,h[R+E++]=L,h[R+E++]=W,h[R+E++]=X,h[R+E++]=$,h[R+E++]=ft,h[R+E++]=zt,h[R+E++]=st,h[R+E++]=lt,h[R+E++]=O/2,h[R+E++]=z/2,h[R+E++]=it/2,h[R+E++]=Y/2,v++}function U(V,S){let F=y+M,D=k+x,O=Math.sqrt(F*F+D*D);F/=O,D/=O;let z=y*F+k*D;F/=z,D/=z;let L=M+A,W=x+b,X=Math.sqrt(L*L+W*W);L/=X,W/=X;let $=M*L+x*W;L/=$,W/=$,B(l,u,p,f,-D,F,m,d,g,w,-W,L,V,S),P()}function I(V,S,F,D,O,z){if(y=M,k=x,M=A,x=b,y==null&&k==null&&(y=M,k=x),m!=null&&d!=null){A=V-m,b=S-d;let L=Math.sqrt(A*A+b*b);A/=L,b/=L}y!=null&&k!=null&&U(O,z),l=m,u=d,p=g,f=w,m=V,d=S,g=F,w=D}function C(V,S){y=M,k=x,M=A,x=b,y==null&&k==null&&(y=M,k=x),y!=null&&k!=null&&U(V,S)}for(let V of i){l=null,u=null,p=null,f=null,m=null,d=null,g=null,w=null,y=null,k=null,M=null,x=null,A=null,b=null;let{totalTime:S,timeSeed:F}=V;for(let D=0;D<V.numberOfVertices;D++)I(r[4*(V.startVertex+D)],r[4*(V.startVertex+D)+1],r[4*(V.startVertex+D)+2],r[4*(V.startVertex+D)+3],S,F);C(S,F)}return{vertexData:h,indexData:a}}function Wt(t,e){let n=e.pixels,{width:o,height:r}=e,i=new Float32Array(o*r*2),s=e.mask||new Uint8Array(o*r*2);if(e.mask||s.fill(255),t==="vector-uv")for(let c=0;c<o*r;c++)i[2*c]=n[0][c],i[2*c+1]=-n[1][c];else if(t==="vector-magdir")for(let c=0;c<o*r;c++){let h=n[0][c],a=Tt(n[1][c]),l=Math.cos(a-Math.PI/2),u=Math.sin(a-Math.PI/2);i[2*c]=l*h,i[2*c+1]=u*h}return{data:i,mask:s,width:o,height:r}}async function kn(t,e,n,o,r,i){let s=performance.now(),c=Ut(e.spatialReference);if(!c){let M=await qt(t,e,n,o,r,i);return Z("esri-2d-profiler")&&K().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-s)),Z("esri-2d-profiler")&&K().info("I.9","Number of parts",1),M}let[h,a]=c.valid,l=a-h,u=Math.ceil(e.width/l),p=e.width/u,f=Math.round(n/u),m=e.xmin,d=[],g=performance.now();for(let M=0;M<u;M++){let x=new Pt({xmin:m,xmax:m+p,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});d.push(qt(t,x,f,o,r,i)),m+=p}let w=await Promise.all(d);Z("esri-2d-profiler")&&K().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-g)),Z("esri-2d-profiler")&&K().info("I.9","Number of parts",w.length);let y={data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o},k=0;for(let M of w){for(let x=0;x<M.height;x++)for(let A=0;A<M.width;A++)k+A>=n||(y.data[2*(x*n+k+A)]=M.data[2*(x*M.width+A)],y.data[2*(x*n+k+A)+1]=M.data[2*(x*M.width+A)+1],y.mask[x*n+k+A]=M.mask[x*M.width+A]);k+=M.width}return Z("esri-2d-profiler")&&K().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-s)),y}async function qt(t,e,n,o,r,i){let s={requestProjectedLocalDirections:!0,signal:i};if(r!=null&&(s.timeExtent=r),t.type==="imagery"){await t.load({signal:i});let a=t.rasterInfo.dataType,l=await t.fetchImage(e,n,o,s);return l?.pixelData?.pixelBlock==null?{data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o}:Wt(a,l.pixelData.pixelBlock)}await t.load({signal:i});let c=t.serviceRasterInfo.dataType,h=await t.fetchPixels(e,n,o,s);return h?.pixelBlock==null?{data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o}:Wt(c,h.pixelBlock)}export{ot as a,tt as b,ke as c,$t as d,Ae as e,be as f,ve as g,_ as h,Bt as i,It as j,Oe as k,N as l,je as m,Ge as n,We as o,qe as p,Ct as q,ze as r,Xe as s,Je as t,Ke as u,$e as v,He as w,ee as x,Qe as y,_t as z,Ye as A,Ze as B,tn as C,en as D,ct as E,xt as F,Ot as G,rn as H,Lt as I,an as J,hn as K,fe as L,cn as M,fn as N,Mn as O,kn as P};
