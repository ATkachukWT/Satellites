import{b as d}from"./chunk-3ATD3H4Q.js";import{c as C}from"./chunk-ME2B26KJ.js";import{A as f,e as j,z as y}from"./chunk-I4Q2S2XA.js";import{a as c}from"./chunk-KAMRW6HF.js";import{a as u,b as x}from"./chunk-OLOKUDVI.js";import{j as L}from"./chunk-BOVYXYHK.js";import{a as z}from"./chunk-5HJY3X5Y.js";import{a as S}from"./chunk-JRCKELO6.js";import{b as w}from"./chunk-R4A63S45.js";import{E as k}from"./chunk-ETE32IYO.js";var v="picture-fill",O="simple-fill",M="simple-line",R="simple-marker",T="text",A="cim",E=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),b=new z(1e3);function nt(t){let o=t.style,r=null;if(t)switch(t.type){case R:o!=="cross"&&o!=="x"&&(r=t.color);break;case O:o&&o!=="solid"?o!=="none"&&(r={type:"pattern",x:0,y:0,src:w(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=t.color;break;case v:r={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case T:r=t.color;break;case A:r=d(t)}return r}function et(t,o){let r=t+"-"+o;return b.get(r)!==void 0?Promise.resolve(b.get(r)):k(t,{responseType:"image"}).then(n=>{let e=n.data,l=e.naturalWidth,i=e.naturalHeight,a=document.createElement("canvas");a.width=l,a.height=i;let s=a.getContext("2d");s.fillStyle=o,s.fillRect(0,0,l,i),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0);let m=a.toDataURL();return b.put(r,m),m})}function g(t){if(!t)return null;let o=null;switch(t.type){case O:case v:case R:o=g(t.outline);break;case M:{let r=u(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(o={color:t.color,style:U(t.style),width:r,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join},o.dashArray=N(o).join(",")||"none");break}default:o=null}return o}function N(t){if(!t?.style)return[];let{dashArray:o,style:r,width:n}=t;if(typeof o=="string"&&o!=="none")return o.split(",").map(i=>Number(i));let e=n??0,l=E.has(r)?E.get(r).map(i=>i*e):[];if(t.cap!=="butt")for(let[i,a]of l.entries())l[i]=i%2==1?a+e:Math.max(a-e,1);return l}var U=(()=>{let t={};return o=>{if(t[o])return t[o];let r=o.replaceAll("-","");return t[o]=r,r}})(),lt=new c([128,128,128]);var I=new c("white");function H(t){let o=t.symbolLayers?.at(-1);if(o&&"outline"in o)return o?.outline?.size}function bt(t){if(!t)return 0;if(f(t)){let o=H(t);return o??0}return x(g(t)?.width)}function gt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(o=>o.type==="object");case"line-3d":return t.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return t.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function wt(t){return t.resource?.href??""}function St(t,o){if(!t)return null;let r=null;return f(t)?r=J(t):y(t)&&(r=t.type==="cim"?d(t):t.color?new c(t.color):null),r?h(r,o):null}function J(t){let o=t.symbolLayers;if(!o)return null;let r=null;return o.forEach(n=>{n.type==="object"&&n.resource?.href||(r=n.type==="water"?n.color:n.material?n.material.color:null)}),r?new c(r):null}function h(t,o){if(o==null||t==null)return t;let r=t.toRgba();return r[3]=r[3]*o,new c(r)}function P(t,o,r){let n=t.symbolLayers;if(!n)return;let e=l=>h(o=o??l??(r!=null?I:null),r);n.forEach(l=>{if(l.type!=="object"||!l.resource?.href||o)if(l.type==="water")l.color=e(l.color);else{let i=l.material!=null?l.material.color:null,a=e(i);l.material==null?l.material=new j({color:a}):l.material.color=a,r!=null&&"outline"in l&&l.outline?.color!=null&&(l.outline.color=h(l.outline.color,r))}})}function W(t,o,r){(o=o??t.color)&&(t.color=h(o,r)),r!=null&&"outline"in t&&t.outline?.color&&(t.outline.color=h(t.outline.color,r))}function kt(t,o,r){t&&(o||r!=null)&&(o&&(o=new c(o)),f(t)?P(t,o,r):y(t)&&W(t,o,r))}async function V(t,o){let r=t.symbolLayers;r&&await S(r,async n=>$(n,o))}async function $(t,o){switch(t.type){case"extrude":B(t,o);break;case"icon":case"line":case"text":q(t,o);break;case"path":K(t,o);break;case"object":await G(t,o)}}function q(t,o){let r=D(o);r!=null&&(t.size=r)}function D(t){for(let o of t)if(typeof o=="number")return o;return null}function B(t,o){t.size=typeof o[2]=="number"?o[2]:0}async function G(t,o){let{resourceSize:r,symbolSize:n}=await Q(t),e=F(o,r,n);t.width=p(o[0],n[0],r[0],e),t.depth=p(o[1],n[1],r[1],e),t.height=p(o[2],n[2],r[2],e)}function K(t,o){let r=F(o,L,[t.width,void 0,t.height]);t.width=p(o[0],t.width,1,r),t.height=p(o[2],t.height,1,r)}function F(t,o,r){for(let n=0;n<3;n++){let e=t[n];switch(e){case"symbol-value":{let l=r[n];return l!=null?l/o[n]:1}case"proportional":break;default:if(e&&o[n])return e/o[n]}}return 1}async function Q(t){let{computeObjectLayerResourceSize:o}=await import("./chunk-OEDQI725.js"),r=await o(t,10),{width:n,height:e,depth:l}=t,i=[n,l,e],a=1;for(let s=0;s<3;s++){let m=i[s];if(m!=null){a=m/r[s];break}}for(let s=0;s<3;s++)i[s]==null&&(i[s]=r[s]*a);return{resourceSize:r,symbolSize:i}}function p(t,o,r,n){switch(t){case"proportional":return r*n;case"symbol-value":return o??r;default:return t}}function X(t,o){let r=D(o);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{let n=t.width/t.height;n>1?(t.width=r,t.height=r*n):(t.width=r*n,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function xt(t,o){if(t&&o)return f(t)?V(t,o):void(y(t)&&X(t,o))}function Lt(t,o,r){if(t&&o!=null)if(f(t)){let n=t.symbolLayers;n&&n.forEach(e=>{if(e.type==="object")switch(r){case"tilt":e.tilt=(e.tilt??0)+o;break;case"roll":e.roll=(e.roll??0)+o;break;default:e.heading=(e.heading??0)+o}e.type==="icon"&&(e.angle+=o)})}else y(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=o))}function Ct(t){if(!t)return null;let o=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return C(o)}function zt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(o=>o.type==="extrude")}export{nt as a,et as b,g as c,N as d,U as e,lt as f,bt as g,gt as h,wt as i,St as j,kt as k,xt as l,Lt as m,Ct as n,zt as o};
