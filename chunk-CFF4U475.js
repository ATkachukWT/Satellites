import{a as P}from"./chunk-OCNYIIP3.js";import{a as U}from"./chunk-IKCK67OG.js";import"./chunk-C4ERY4CA.js";import"./chunk-WDTJILD4.js";import"./chunk-YAZINLP3.js";import"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import"./chunk-WV5CXXQQ.js";import"./chunk-KBDKZSTB.js";import"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import"./chunk-HBMVPT4U.js";import"./chunk-L6ZFUQTH.js";import"./chunk-4MB4OYWM.js";import"./chunk-XG5NROZE.js";import"./chunk-7OTP74QG.js";import"./chunk-ZU53JDRS.js";import"./chunk-KQEHVUTS.js";import"./chunk-7LUXMWRM.js";import"./chunk-TO337MWO.js";import"./chunk-WKYBGWI5.js";import"./chunk-62PJ3MJN.js";import"./chunk-OVJTX4VC.js";import"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import"./chunk-QDXM6RGS.js";import"./chunk-E3UR4EIC.js";import"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import"./chunk-R5HXEPJ3.js";import"./chunk-CJM4TC3F.js";import"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-DZBH24YT.js";import"./chunk-7E723FQO.js";import"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-NFARB7KW.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import"./chunk-WT3XCHGP.js";import"./chunk-CUJB6F5L.js";import"./chunk-5NHJFBCW.js";import{a as L}from"./chunk-WPZN772I.js";import"./chunk-AZ7O5NEQ.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-ZPQDV27Y.js";import"./chunk-SIMI7FRM.js";import"./chunk-YQGS4EZO.js";import{a as Z}from"./chunk-3REMXE4W.js";import"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-IRI7XXYY.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import"./chunk-JTDXB5TK.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import{b as j}from"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import{a as x,d as A}from"./chunk-WDETDPZG.js";import"./chunk-HX2VGIR2.js";import{d as g}from"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import{c as E}from"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{c as C}from"./chunk-QHVIRF5H.js";import"./chunk-WZDN6K3C.js";import"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{b as D,r as h,t as v}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as $}from"./chunk-N2WTMF3X.js";var m=null;function q(e,o,a,n={}){let r=o.elementType,c="value",s=r.type==="array"?[{name:c,type:r.type,elementType:r.elementType}]:r.type==="dictionary"?[{name:c,type:r.type,properties:r.properties}]:[{name:c,type:r.type}];return new P(e.map(i=>{let t={};return k(t,s,{[c]:i},a,n),t[c]}))}function B(e,o,a={}){let n=e instanceof L?new U({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return o.constructFeatureSet(n,a.spatialReference,null,!0,a.lruCache,a.interceptor)}function H(e,o,a={}){let{spatialReference:n,interceptor:r,lruCache:c}=a;return typeof e=="string"?o.createFeatureSetCollectionFromService(e,n,c,r):o.createFeatureSetCollectionFromMap(e,n,c,r)}function K(e,o,a,n={}){let r={};return k(r,o.properties,e,a,n),new m.Dictionary(r)}function k(e,o,a,n,r={}){let c={};for(let s of Object.keys(a))c[s.toLowerCase()]=a[s];for(let s of o){let i=s.name.toLowerCase();if(r.variablesPreProcessed)e[i]=c[i];else switch(s.type){case"array":{let t=c[i];e[i]=t==null?null:q(t,s,n,r);break}case"feature":{let t=c[i];e[i]=t==null?null:m.Feature.createFromGraphic(t,r?.timeZone);break}case"featureSet":{let t=c[i];e[i]=t==null?null:n?B(t,n,r):null;break}case"featureSetCollection":{let t=c[i];e[i]=t==null?null:n?H(t,n,r):null;break}case"dictionary":{let t=c[i];e[i]=t==null?null:K(t,s,n,r);break}case"date":{let t=c[i];e[i]=t?t instanceof g?t:r?.timeZone?g.dateJSAndZoneToArcadeDate(t,r?.timeZone):g.dateJSToArcadeDate(t):null;break}case"dateOnly":{let t=c[i];e[i]=t?t instanceof x?t:x.fromReader(t):null;break}case"time":{let t=c[i];e[i]=t?t instanceof A?t:A.fromReader(t):null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[i]=c[i];break;case"voxel":{let t=c[i];e[i]=t==null?null:new m.Voxel(t,r?.timeZone);break}}}}function V(e,o){for(let a of e)o.push(a),a.type==="dictionary"&&V(a.properties,o);return o}function G(e,o,a,n,r){let{spatialReference:c,interceptor:s,lruCache:i,console:t,abortSignal:y,timeZone:u,services:w={portal:E.getDefault()}}=a,f={vars:{},spatialReference:c,interceptor:s,timeZone:u,lrucache:i,useAsync:r,services:w,console:t,abortSignal:y};return o&&k(f.vars,e.variables,o,n,a),f}function S(e,o){switch(o.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{let a=(e.type,e),n="geometry"in a?a.geometry():null,r="readAttributes"in a?a.readAttributes():a.attributes;return new Z({geometry:n,attributes:r})}case"dictionary":{let a=e,n=a.attributes,r={};for(let c of Object.keys(n))r[c]=S(a.field(c),o);return r}case"array":return("toArray"in e?e.toArray():e).map(a=>S(a,o))}return e}var J={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},M={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},z={variables:[{name:"$voxel",type:"voxel"}]},N=new Map([["aggregate-field",{variables:[{name:"$feature",type:"feature"}]}],["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup",J],["popup-element",J],["popup-feature-reduction",M],["popup-element-feature-reduction",M],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup-voxel",z],["popup-element-voxel",z]]);function ue(e){e==="feature-reduction-popup"?(C(h.getLogger("esri.arcade"),'profile name: "feature-reduction-popup"',{replacement:'"popup-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-feature-reduction"):e==="feature-reduction-popup-element"&&(C(h.getLogger("esri.arcade"),'profile name: "feature-reduction-popup-element"',{replacement:'"popup-element-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-element-feature-reduction");let o=N.get(e);if(!o){let a=Array.from(N.keys()).map(n=>`'${n}'`).join(", ");throw new v("createArcadeProfile:invalid-profile-name",`Invalid profile name '${e}'. You must specify one of the following values: ${a}`)}return D(o)}async function le(e,o,a={}){m||(m=await j());let{arcade:n,arcadeUtils:r}=m,{loadScriptDependencies:c,referencesMember:s,scriptIsAsync:i}=n,t=V(o.variables,[]),y=t.filter(p=>p.type==="featureSet"||p.type==="featureSetCollection").map(p=>p.name.toLowerCase()),u=n.parseScript(e,y);if(!u)throw new v("arcade:invalid-script","Unable to create SyntaxTree");let w=r.extractFieldNames(u),f=n.scriptTouchesGeometry(u),T=t.map(p=>p.name.toLowerCase()).filter(p=>s(u,p)),l=i(u,y);await c(u,l,y);let I={vars:{},spatialReference:null,useAsync:l};for(let p of T)I.vars[p]="any";let{lruCache:F}=a,O=n.compileScript(u,I),R=n.featureSetUtils(),{services:Y}=a;return{execute:(p,d={})=>{if(l)throw new v("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");let b=O(G(o,p,$({lruCache:F},d),R,l));return d.rawOutput?b:S(b,r)},executeAsync:async(p,d={})=>{let b=await O(G(o,p,$({lruCache:F,services:Y},d),R,l));return d.rawOutput?b:S(b,r)},isAsync:l,variablesUsed:T,fieldsUsed:w,geometryUsed:f,syntaxTree:u}}export{le as createArcadeExecutor,ue as createArcadeProfile};
