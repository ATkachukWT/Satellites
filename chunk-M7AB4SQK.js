import{a as Q}from"./chunk-XN6KHUVJ.js";import{a as U}from"./chunk-3A3BGKXB.js";import{b as V}from"./chunk-BGOXHRAZ.js";import{a as j}from"./chunk-G7BT6VC5.js";import{p as F,q as k}from"./chunk-YQGS4EZO.js";import{H as G}from"./chunk-I4Q2S2XA.js";import{b}from"./chunk-TBA3OZMJ.js";import{a as v,b as S}from"./chunk-W26XKMAT.js";import{a as N}from"./chunk-BCSLWH5H.js";import{B as W,z as J}from"./chunk-HP4LYRR4.js";import{a as z}from"./chunk-AFC2H4Q3.js";import{d as M}from"./chunk-SLAWDKDA.js";import{d as R}from"./chunk-JRCKELO6.js";import{a as I}from"./chunk-WLHY3MMA.js";import{a as B}from"./chunk-SBHKMV3P.js";import{d as h}from"./chunk-ETE32IYO.js";import{f as L}from"./chunk-SG7CQU4O.js";import{H as d}from"./chunk-QHVIRF5H.js";import{D as C,I as D,p as T}from"./chunk-WZDN6K3C.js";import{a as c}from"./chunk-QGVBCWUY.js";import{b as P,t as i}from"./chunk-UHRSAPGQ.js";import{a as g,b as E}from"./chunk-N2WTMF3X.js";var x,a=x=class extends L{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new x(P({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};c([d({type:[String],json:{write:!0}})],a.prototype,"attachmentTypes",void 0),c([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],a.prototype,"attachmentsWhere",void 0),c([d({type:Boolean,json:{write:!0}})],a.prototype,"cacheHint",void 0),c([d({type:[String],json:{write:!0}})],a.prototype,"keywords",void 0),c([d({type:[String],json:{write:!0}})],a.prototype,"globalIds",void 0),c([d({json:{write:!0}})],a.prototype,"name",void 0),c([d({type:Number,json:{read:{source:"resultRecordCount"}}})],a.prototype,"num",void 0),c([d({type:[Number],json:{write:!0}})],a.prototype,"objectIds",void 0),c([d({type:[String],json:{write:!0}})],a.prototype,"orderByFields",void 0),c([d({type:Boolean,json:{default:!1,write:!0}})],a.prototype,"returnMetadata",void 0),c([d({type:[Number],json:{write:!0}})],a.prototype,"size",void 0),c([d({type:Number,json:{read:{source:"resultOffset"}}})],a.prototype,"start",void 0),c([I("start"),I("num")],a.prototype,"writeStart",null),c([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],a.prototype,"where",void 0),a=x=c([D("esri.rest.support.AttachmentQuery")],a),a.from=T(a);var H=a;var Bt=new B({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Rt(t,e,n,r){let o=await w(t);if(await q(t,e,r),!o.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return o.addAttachment(e,n)}function q(t,e,n){let{attributes:r}=e,{objectIdField:o}=t;return t.capabilities?.data?.supportsAttachment?e?r?o&&r[o]?Promise.resolve():Promise.reject(new i(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new i(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(n,"A feature is required to add/delete/update attachments")):Promise.reject(new i(n,"this layer doesn't support attachments"))}async function Mt(t,e,n,r,o){let s=await w(t);if(await q(t,e,o),!s.updateAttachment)throw new i(o,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,n,r)}async function kt(t,e,n){let{applyEdits:r}=await import("./chunk-MSQRR7WO.js"),o=await t.load(),s=n;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(s=E(g({},s),{globalIdToObjectId:await nt(o,e.deleteFeatures,o.globalIdField)})),r(o,o.source,e,n)}async function zt(t,e,n){let{uploadAssets:r}=await import("./chunk-MSQRR7WO.js"),o=await t.load();return r(o,o.source,e,n)}async function Nt(t,e,n,r){let o=await w(t);if(await q(t,e,r),!o.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,n)}async function Gt(t,e,n){let r=(await t.load({signal:e?.signal})).source;if(!r.fetchRecomputedExtents)throw new i(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function Qt(t,e,n,r){e=H.from(e),await t.load();let o=t.source,s=t.capabilities;if(!s?.data?.supportsAttachment)throw new i(r,"this layer doesn't support attachments");let{attachmentTypes:l,objectIds:p,globalIds:u,num:y,size:m,start:f,where:A}=e;if(!s?.operations?.supportsQueryAttachments&&(l?.length>0||u?.length>0||m?.length>0||y||f||A))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(p?.length||u?.length||A))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",e);return!s?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),o.queryAttachments(e)}async function Ut(t,e,n,r){let o=await w(t);if(!o.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(b.from(e)??t.createQuery(),n)}async function Vt(t,e,n,r){let o=await w(t);if(!o.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(b.from(e)??t.createQuery(),n)}async function Jt(t,e,n,r){let o=await w(t);if(!o.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return o.queryExtent(b.from(e)??t.createQuery(),n)}async function Wt(t,e,n,r){let o=await w(t);if(!o.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(j.from(e),n)}async function Ht(t,e,n,r){let o=await w(t);if(!o.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(j.from(e),n)}async function $t(t){let e=t.source;if(e?.refresh)try{let{dataChanged:n,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON=g(g({},t.sourceJSON),r),t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(await z(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Zt(t){let e=new b,n=t.capabilities?.data,r=t.capabilities?.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];let{timeOffset:o,timeExtent:s}=t;return e.timeExtent=o!=null&&s!=null?s.offset(-o.value,o.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function _t(t){let{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Kt(t){let{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(let r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Xt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function Yt(t,e,n,r){let o=n?.feature,s=!!t.subtypes?.length;if(s&&!n?.excludeImpliedDomains){let u=Y(t,e);if(u)return u}let l=s&&X(t,o);if(l){let u=l?.domains?.[e];return u?.type==="inherited"?r:u}let p=ot(t.types,t.typeIdField,o);if(p){let u=p.domains&&p.domains[e];if(u&&u?.type!=="inherited")return u}if(r)return r;if(!n?.excludeImpliedDomains){let u=tt(t,e);if(u)return u}return null}function X(t,e){let{subtypes:n,subtypeField:r}=t;if(!e?.attributes||!n?.length||!r)return null;let o=e.attributes[r];return o==null?null:n.find(s=>s.code===o)}function Y(t,e){let{fieldsIndex:n,subtypeField:r}=t,{name:o,type:s}=n.get(e)??{};if(!o)return null;if((r&&n.get(r)?.name)===o&&t.subtypes?.length){let l=t.subtypes.map(p=>new v({code:_(p.code,s),name:p.name}));if(l?.length)return new S({codedValues:l})}return null}function tt(t,e){let{fieldsIndex:n}=t,{name:r,type:o}=n.get(e)??{};if(!r)return null;if(("typeIdField"in t?n.get(t.typeIdField)?.name:null)===r&&"types"in t&&t.types?.length){let s=t.types.map(l=>new v({code:_(l.id,o),name:l.name}));return new S({codedValues:s})}return null}function _(t,e){return e?W({type:e})&&typeof t=="number"?`${t}`:J({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function w(t){return(await t.load()).source}async function te(t,e){if(!h)return;let n=h.findCredential(t);if(n)return n.userId;let r;try{let o=await F(t,e);o&&(r=await h.checkSignInStatus(`${o}/sharing`))}catch{}return r?r.userId:null}async function K(t,e){if(!h||h.findCredential(t))return;let n;try{let r=await F(t,e);r&&(n=await h.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{let r=e!=null?e.signal:null;await h.getCredential(t,{signal:r})}catch{}}async function ee(t,e,n){let r=t.parsedUrl?.path;r&&t.authenticationTriggerEvent===e&&await K(r,n)}async function re(t){let e=t.parsedUrl?.path;e&&et(t)&&await K(e)}function et(t){return rt(t)&&("serviceDefinitionExpression"in t&&$(t.serviceDefinitionExpression)||"definitionExpression"in t&&$(t.definitionExpression))}function rt(t){return!(!k(t)||!t.capabilities?.query.supportsCurrentUser)}function $(t){return!!t?.toLowerCase().includes("current_user")}function ne(t){return!st(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}var O=C({types:G});function oe(t,e){if(t.defaultSymbol)return t.types?.length?new V({defaultSymbol:O(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:O(n.symbol,n,e)}))}):new U({symbol:O(t.defaultSymbol,t,e)})}function se(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;let n=t.editingInfo?.lastEditDate?.getTime();return n==null||(e*=1e3,Date.now()-n<e)}async function nt(t,e,n){if(e==null)return null;let r=[],{objectIdField:o}=t;if(e.forEach(y=>{let m=null;if("attributes"in y){let{attributes:f}=y;m={globalId:f[n],objectId:f[o]!=null&&f[o]!==-1?f[o]:null}}else m={globalId:y.globalId,objectId:y.objectId!=null&&y.objectId!==-1?y.objectId:null};m.globalId!=null&&(m.objectId!=null&&m.objectId!==-1||r.push(m.globalId))}),r.length===0)return null;let s=t.createQuery();s.where=r.map(y=>`${n}='${y}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[o,n],s.cacheHint=!1;let l=await R(Q(t,s));if(!l.ok)return null;let p=new Map,u=l.value.features;for(let y of u){let m=y.attributes[n],f=y.attributes[o];m!=null&&f!=null&&f!==-1&&p.set(M(m),f)}return p}function ot(t,e,n){if(!e||!n||!t)return null;let r=n.getAttribute(e);return r==null?null:t.find(o=>{let{id:s}=o;return s!=null&&s.toString()===r.toString()})??null}function st(t){return t.sourceJSON?.isMultiServicesView||it(t)}function it(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map(e=>e.trim()).includes("map")}function ie(t,e,n){let r=e?.queryAttributeBins;if(!r)throw new i(n,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new i(n,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Z(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning");break;case"date":if(!r.supportsDate)throw new i(n,"Layer source does not support date binning");if(t.binParameters.snapToData&&!r.supportsSnapToData)throw new i(n,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!r.supportsReturnFullIntervalBin)throw new i(n,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new i(n,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new i(n,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!r.supportsNormalization||!Z(t.binParameters.normalizationType,r.supportedNormalizationTypes)))throw new i(n,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!r.supportsStackBy)throw new i(n,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!r.supportsSplitBy)throw new i(n,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!r.supportsFirstDayOfWeek)throw new i(n,"Layer source does not support firstDayOfWeek binning");let o=r?.supportedStatistics;if(t.outStatistics&&o){let s=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(let{statisticType:l}of t.outStatistics){let p=s.get(l);if(p&&!o[p])throw new i(n,`Layer source does not support ${l} statistic type`)}}}function Z(t,e){return t!=null&&!!e?.[N.toJSON(t)]}export{H as a,Bt as b,Rt as c,Mt as d,kt as e,zt as f,Nt as g,Gt as h,Qt as i,Ut as j,Vt as k,Jt as l,Wt as m,Ht as n,$t as o,Zt as p,_t as q,Kt as r,Xt as s,Yt as t,X as u,Y as v,te as w,ee as x,re as y,$ as z,ne as A,oe as B,se as C,nt as D,ot as E,st as F,ie as G};
