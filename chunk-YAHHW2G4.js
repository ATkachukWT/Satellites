import{a as mt}from"./chunk-PQNOJ4XM.js";import{A as ht,C as ct,a as rt,g as it,h as st,j as at,p as ot,t as T,u as nt,v as L,w as g,x as R,y as w,z as lt}from"./chunk-LG7DXNE4.js";import{d as Xe,e as X,j as x,m as et,q as tt}from"./chunk-7S2234XQ.js";import{b as pt}from"./chunk-QCAQAWPU.js";import{a as Je}from"./chunk-6SGUOKGX.js";import{c as Ke}from"./chunk-SWCOPTUX.js";import{a as O}from"./chunk-FSW536RM.js";import{k as $e,m as Qe,n as Ye}from"./chunk-YNDA4ZZB.js";import{a as Ze}from"./chunk-BSKAVVQS.js";import{b as f}from"./chunk-CMKJEBQJ.js";import{a as qe,b as Ne}from"./chunk-PEYNLMWW.js";import{d as We}from"./chunk-WS4AMEGN.js";import{b as Me,k as ze,l as Be,m as Ve}from"./chunk-NRRX2M6N.js";import{i as He,k as ke}from"./chunk-B74L7AUE.js";import{b as je}from"./chunk-YU3IFRYW.js";import{a as K}from"./chunk-VGAXEXH3.js";import{h as J}from"./chunk-YEXMIDOT.js";import{b as S}from"./chunk-37H4LYIE.js";import{b as A}from"./chunk-YQNUGDFH.js";import{a as Ue}from"./chunk-QCZ3ZIGQ.js";import{a as Ie}from"./chunk-YHWE4TIZ.js";import{q as we,r as Fe}from"./chunk-I4Q2S2XA.js";import{a as Z}from"./chunk-KAMRW6HF.js";import{n as Re}from"./chunk-DTU6MHUX.js";import{d as Ce,e as Ge}from"./chunk-KRAKR4MK.js";import{m as Ee}from"./chunk-2NP7F5RO.js";import{c as _e}from"./chunk-XCIPBOI4.js";import{E as be,F as Q,G as Se,P as Le,j as fe,o as ge}from"./chunk-KD27XIJC.js";import{b as Te}from"./chunk-U4TLMQTY.js";import{a as m}from"./chunk-RWCIDBNQ.js";import{c as v,i as Y}from"./chunk-HM5RIVQC.js";import{a as Oe}from"./chunk-EM35R6FY.js";import{g as Pe}from"./chunk-QXXXCEV5.js";import{n as Ae}from"./chunk-6B5XFA6F.js";import{a as $}from"./chunk-OLOKUDVI.js";import{a as ve,c as xe,f as De}from"./chunk-PTZYZULI.js";import{a as P}from"./chunk-BOVYXYHK.js";import{a as ye}from"./chunk-JGEVVXD4.js";import{p as de}from"./chunk-B3FO6PT7.js";import{a as W,j as ue}from"./chunk-LXFQWIWE.js";import{a as G}from"./chunk-JRCKELO6.js";import{m as me}from"./chunk-KGVXGH6H.js";import{f as he}from"./chunk-WZDN6K3C.js";import{a as d}from"./chunk-QGVBCWUY.js";import{A as k,B as ce,P as pe,u as E,v as H}from"./chunk-CKJ56T2Q.js";import{q as ne,r as le}from"./chunk-UHRSAPGQ.js";import{a as ie,v as se,w as ae,x as oe}from"./chunk-V76GWARL.js";import{a as N,b as j}from"./chunk-N2WTMF3X.js";var ut=class{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,s){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,s,r,i)}},yt=class{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=j(N({},i),{ignoreInvisibleLayers:!0}),this._frameTask=e.registerTask(Ce.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Ge);else for(let t of this._queries)t.result.reject(E())}queryElevation(e,t,r,i=0){let s=pe(),a={x:e,y:t,minDemResolution:i,result:s,signal:r};return this._queries.push(a),k(r,()=>{se(this._queries,a),s.reject(E())}),s.promise}get running(){return this._queries.length>0}runTask(e){let t=this._queries;this._queries=[];let r=this._getElevationQueryProvider();if(!r)return t.forEach(h=>h.result.reject()),void e.madeProgress();let i=t.map(h=>[h.x,h.y]),s=t.reduce((h,c)=>Math.min(h,c.minDemResolution),1/0),a=new ye({points:i,spatialReference:this.spatialReference}),n=t.length>1&&t.some(h=>!!h.signal)?new AbortController:null,l=n!=null?n.signal:t[0].signal;if(n!=null){let h=0;t.forEach(c=>k(c.signal,()=>{h++,c.result.reject(E()),h===t.length&&n.abort()}))}let p=j(N({},this._queryOptions),{minDemResolution:s,signal:l});r.queryElevation(a,p).then(h=>{t.forEach((c,V)=>{c.signal!=null&&c.signal.aborted?c.result.reject(E()):c.result.resolve(h.geometry.points[V][2])})}).catch(h=>{t.forEach(c=>c.result.reject(h))}),e.madeProgress()}get test(){}};var b,y;(function(o){o[o.USER=1]="USER",o[o.SCALE_RANGE=2]="SCALE_RANGE",o[o.FILTER=4]="FILTER",o[o.DECONFLICTION=8]="DECONFLICTION",o[o.ALL_GRAPHIC=15]="ALL_GRAPHIC",o[o.ALL_LABEL=255]="ALL_LABEL"})(b||(b={})),function(o){o[o.GRAPHIC=1]="GRAPHIC",o[o.LABEL=16]="LABEL"}(y||(y={}));var F=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}};var dt=class{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===Ue.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}},I=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var U=class extends Ne{constructor(e,t){super(e,t,new qe(pt,()=>import("./chunk-BW2452ND.js")))}initializePipeline(e){let{hudDepth:t,terrainDepthTest:r}=e,i={func:r?Y.ALWAYS:Y.LESS};return Ve(t?{depthTest:i,depthWrite:ze}:{blending:Me(v.ONE,v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA),depthTest:i,colorWrite:Be})}};var u=class extends Ze{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}};d([f()],u.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([f()],u.prototype,"occlusionTestEnabled",void 0),d([f()],u.prototype,"hasVerticalOffset",void 0),d([f()],u.prototype,"hasScreenSizePerspective",void 0),d([f()],u.prototype,"hudDepth",void 0),d([f()],u.prototype,"hudDepthAlignStart",void 0),d([f()],u.prototype,"terrainDepthTest",void 0);var _=class extends He{constructor(e,t){super(e,D),this.produces=new Map([[O.LINE_CALLOUTS,r=>J(r)],[O.LINE_CALLOUTS_HUD_DEPTH,r=>J(r)]]),this._configuration=new u(t),this._uniqueMaterialIdentifier=q(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){let r=t.slot===O.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hudDepth=r,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=K||(this.parameters.borderColor?.[3]??0)>=K}intersect(){}createGLMaterial(e){return new ee(e)}createBufferWriter(){return new te}validateParameters(e){this._uniqueMaterialIdentifier=q(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}};function q({renderOccluded:o,isDecoration:e,horizontalScreenOffset:t,color:r,size:i,occlusionTest:s,shaderPolygonOffset:a,hudDepthAlignStart:n,centerOffsetUnits:l,hasSlicePlane:p,screenSizePerspective:h,verticalOffset:c,borderColor:V}){return ne`${o}:${e}:${t}:[${r}]:${i}:${s}:${a}:${n}:${l}:${p}:${h!=null}:{${c.screenLength}:${c.minWorldLength}:${c.maxWorldLength}}:[${V}]`}var ee=class extends We{beginSlot(e){return this.getTechnique(U,e)}},D=class extends ke{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=xe(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}},vt=Te().vec3f(m.POSITION).vec3f(m.NORMAL).vec2f(m.UV0).vec4f(m.CENTEROFFSETANDDISTANCE),ft=[S(0,0),S(1,0),S(0,1),S(1,0),S(1,1),S(0,1)],te=class{constructor(){this.vertexBufferLayout=vt}elementCount(e){return 6*e.get(m.POSITION).indices.length}write(e,t,r,i,s,a){Qe(r.get(m.POSITION),e,s.position,a,6),Ye(r.get(m.NORMAL),t,s.normal,a,6),$e(r.get(m.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,a,6);for(let n=0;n<ft.length;++n)s.uv0.setVec(a+n,ft[n])}};var C=class o extends lt{constructor(e,t){super(e,null,t,Ct),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new _(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){let t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){let e=new D,t=this.symbol,r=t.callout;if(r.color){let a=Z.toUnitRGBA(r.color);a[3]*=this._getLayerOpacity(),e.color=a}else e.color=De;if(e.size=$(r.size||0),t.verticalOffset){let{screenLength:a,minWorldLength:n,maxWorldLength:l}=t.verticalOffset;e.verticalOffset={screenLength:$(a),minWorldLength:n||0,maxWorldLength:l??1/0}}e.borderColor=r.border?.color!=null?Z.toUnitRGBA(r.border.color):null;let i=t.symbolLayers.at(0).type==="object",s=t.type==="label-3d";return e.occlusionTest=!i&&!ie("enable-feature:non-occluded-hud"),i&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Dt}createGraphics3DGraphic(e){let t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new tt,t.elevationOffset||0),s=t.symbol,a=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&a||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!Fe(l)))return null;let n=Je(r.geometry);return n==null?null:this._createAs3DShape(n,i,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){let i=this._elevationContext.mode,s=Xe(o.elevationModeChangeTypes,r,i);return s!==x.UPDATE||e.forEach(a=>{let n=t(a);n!=null&&this.updateGraphicElevationContext(a.graphic,n)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,r=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){let{elevationContext:r,metadata:i}=t;this.setGraphicElevationContext(e,r,i?.elevationOffset??0),t.needsElevationUpdates=X(r.mode)}computeComplexity(){return new it({verticesPerFeature:6})}_getOrCreateMaterial(e){let t=this._perInstanceMaterialParameters(e),r=q(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let i=e.materialCollection.get(r);return i==null&&(i=new _(t,this._context.spherical),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new _(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,r,i){let s=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:s}),n=this._getOrCreateMaterial(r),l=new Ke(n.material,xt(r),null,je.Point,a),p=ht(this._context,e,l,t,i);if(p==null)return null;let h=new T(this,p.object,[l],n.isUnique?[n.material]:null,null,ot,t);return h.metadata=new nt(r.elevationOffset),h.alignedSampledElevation=p.sampledElevation,h.needsElevationUpdates=X(t.mode),ct(h,e,this._context.elevationProvider),h}};function xt(o){let{translation:e,centerOffset:t}=o,r=new A(e?[e[0],e[1],e[2]]:[0,0,0],re,3,!0),i=new A(t?[t[0],t[1],t[2],t[3]]:[0,0,0,1],re,4,!0);return[[m.POSITION,r],[m.NORMAL,new A([0,0,1],re,3,!0)],[m.CENTEROFFSETANDDISTANCE,i]]}C.elevationModeChangeTypes={definedChanged:x.UPDATE,staysOnTheGround:x.UPDATE,onTheGroundChanged:x.RECREATE};var re=[0],Dt={mode:"relative-to-ground",offset:0},Ct={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},gt=class extends rt{constructor(e,t,r=P(),i=ve(),s=0,a="world",n=0,l=null){super(e,t),this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=s,this.centerOffsetUnits=a,this.elevationOffset=n,this.materialCollection=l}},bt=class extends F{};var St=()=>le.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Ur(o,e){if(!we(o))return St().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${o.type}' does not support callouts`),null;if(!o.callout)return null;let t=Gt[o.callout.type];return t?new t(o,e):(St().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${o.callout.type}`),null)}var Gt={line:C};function M(o){return 2216+4096*o.symbolLayers.length+o.complexity.memory.resourceBytes}var Lt=class extends R{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){let t=await this.symbol.fetchSymbol({signal:e,acceptedFormats:Ie});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:st}globalPropertyChanged(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,t):L.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??g.Loading}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}get cachedMemory(){return M(this)}};var _t=new he(Array,o=>be(o,Le),null,10,5),Pt=W(),z=class{get labelLayers(){return this._labelLayers||oe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,t,r,i,s){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=b.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=s?et(s,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(y.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=y.GRAPHIC,t){let r=t?this._visibleFlags|t|y.LABEL*t:this._visibleFlags;return e===y.GRAPHIC?(r&b.ALL_GRAPHIC)===b.ALL_GRAPHIC:(r&b.ALL_LABEL)===b.ALL_LABEL}setVisibilityFlag(e,t,r){let i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);let s=this.isVisible(e);if(i===s)return!1;if(e===y.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(s));else{this._forEachSymbolLayerGraphic(n=>n.setVisibility(s));let a=this.isVisible(y.LABEL);this._forEachLabelGraphic(n=>n.setVisibility(a))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){let t=this.graphic.geometry;if(t==null)return!1;this._extent=W(),Re(t,this._extent);let r=t.spatialReference;if(!me(r,e)&&!mt(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return i.type!=="mesh"&&i.type!=="extent"||(i=de.fromExtent(i.type==="mesh"?i.extent:i)),Ee(i,t,r)}get usedMemory(){let e=_e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){let e={render:{origin:P(),num:0},draped:{origin:Oe(),num:0}};for(let t of this.layers)t?.computeAttachmentOrigin(e);return e.render.num>1&&Ae(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Pe(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Q(s.boundingBox):s.boundingBox=Q(),s.requiresDrapedElevation=!1,await G(this.layers,async a=>{if(a==null)return;let n=a.type==="draped"?t:e,l=_t.acquire(),p=await a.getProjectedBoundingBox(n,r,s.screenSpaceObjects,i,l);isFinite(p[2])&&isFinite(p[5])||(s.requiresDrapedElevation=!0),p&&fe(s.boundingBox,l),_t.release(l)}),ge(s.boundingBox)||ue(Se(s.boundingBox,Pt))?s:null}needsElevationUpdates(){for(let e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type!=="object3d"&&i.type!=="lod-instance"||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(i=>{i.type==="object3d"&&i.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(t=>t.updateHighlights(e))}_forEachGraphicList(e,t){e?.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}};var Et=class extends R{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{let i=this.symbolLayers[r];i!=null&&(i.symbol=e,i.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));let r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;let i=[],{make:s}=await import("./chunk-WRRNWCCF.js");for(let a=0;a<r;a++){let n=t.at(a);if(n.enabled===!1)continue;B.renderPriority=1-(1+a)/r,B.renderPriorityStep=1/r,B.ignoreDrivers=n.ignoreDrivers;let l=s(this.symbol,n,this._context,B),p=ce(e,()=>{this.symbolLayers[a]=null,l.destroy()});p&&i.push(p),this.symbolLayers[a]=l}if(await G(this.symbolLayers,async(a,n)=>{if(a!=null)try{await a.load(),this._extentPadding+=Math.max(this._extentPadding,a.extentPadding)}catch{this.symbolLayers[n]=null}}),i.forEach(a=>a.remove()),H(e),this.symbolLayers.length&&!this.symbolLayers.some(a=>!!a))throw new Error}getSymbolLayerSize(e){let t=this.symbolLayers[e];return t!=null?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}updateFocus(e,t){this.symbolLayers.forEach(r=>r?.updateFocus(e,t))}createGraphics3DGraphic(e,t){let r=e.graphic,i=this.symbolLayers.map(a=>a?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new z(r,t||this,i,e.layer,s)}get complexity(){return at(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,t){let r=this.symbolLayers.length;for(let i=0;i<r;i++){let s=this.symbolLayers[i],a=n=>{let l=n.layers[i];return l instanceof T?l:null};if(s!=null&&!s.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==w.LOADED?L.RecreateSymbol:this.symbolLayers.reduce((r,i)=>r!==L.RecreateSymbol&&i!=null?Math.min(r,i.applyRendererDiff(e,t)):r,L.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===w.FAILED||e.diff.type!=="partial")return;let t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;let r=t.symbolLayers.diff;this.symbolLayers.forEach((i,s)=>{if(i==null)return;let a=r[s];if(a){let n={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};i.prepareSymbolLayerPatch(n),e.symbolStatePatches.push(...n.symbolLayerStatePatches),n.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,p)=>{let h=l.layers[s];h!=null&&n.graphics3DGraphicPatches.forEach(c=>c(h,p))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(r,i)=>r.updateGeometry(i,t))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,(s,a)=>s.updateTransform(a,t,r,i))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){let i=this.symbolLayers[r];if(i==null)continue;let s=e.layers[r];if(!s||!t(i,s))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){let r=this.symbolLayers[t];if(r==null)continue;let i=e.layers[t];i!=null&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=!1,t=!1;for(let r of this.symbolLayers)if(r!=null){if(r.loadStatus===w.LOADING)return g.Loading;r.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?g.Mixed:g.Fast:e?g.Slow:g.Undefined}async queryForSnapping(e,t,r,i){let s=this.symbolLayers.filter(ae).filter(n=>n.queryForSnapping!=null).map(n=>n.queryForSnapping(e,t,r,i)),a=await Promise.all(s);return H(i),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(let e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return M(this)}},B=new I;export{ut as a,yt as b,b as c,y as d,F as e,dt as f,gt as g,bt as h,Ur as i,Et as j,Lt as k};
