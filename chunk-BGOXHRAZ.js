import{b as ue,g as ne,h as C,i as ae,j as pe,k as w}from"./chunk-SXNHGK6A.js";import{d as ie}from"./chunk-PFSX77NO.js";import{a as fe}from"./chunk-ZJWWZWMH.js";import{a as oe}from"./chunk-JGU5JAYW.js";import{L as re,y as le}from"./chunk-I4Q2S2XA.js";import{a as S}from"./chunk-JTDXB5TK.js";import{i as $,l as de}from"./chunk-HP4LYRR4.js";import{b as T}from"./chunk-4G7UTTZJ.js";import{a as se}from"./chunk-NRBJLISB.js";import{a as P}from"./chunk-MWSXMSWY.js";import{c as A}from"./chunk-EXJYW3PC.js";import{a as J}from"./chunk-X4LNX4BR.js";import{a as L}from"./chunk-WLHY3MMA.js";import{a as R}from"./chunk-DB3UIQCU.js";import{h as ee,i as te}from"./chunk-ETE32IYO.js";import{f as c}from"./chunk-SG7CQU4O.js";import{H as r}from"./chunk-QHVIRF5H.js";import{I as d,k as X,p as Y}from"./chunk-WZDN6K3C.js";import{a as o}from"./chunk-QGVBCWUY.js";import{b as m,g as K,r as Q,t as W}from"./chunk-UHRSAPGQ.js";import{w as Z}from"./chunk-V76GWARL.js";import{a as N,b as k}from"./chunk-N2WTMF3X.js";var U=class extends S.ClonableMixin(c){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};o([r(w)],U.prototype,"value",void 0),o([r(w)],U.prototype,"value2",void 0),o([r(w)],U.prototype,"value3",void 0),U=o([d("esri.renderers.support.UniqueValue")],U);var y=U;var v=class extends S.ClonableMixin(c){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;let t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(s=>new y({value:s})):t==="object"?e[0]instanceof y?e:e.map(s=>new y(s)):null}};o([r({type:String,json:{write:!0}})],v.prototype,"description",void 0),o([r({type:String,json:{write:!0}})],v.prototype,"label",void 0),o([r(C)],v.prototype,"symbol",void 0),o([r({type:[y],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new y({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{let s=[];for(let i of e){let l=[i.value,i.value2,i.value3].filter(Z).map(u=>u.toString());s.push(l)}t.values=s}}}})],v.prototype,"values",void 0),o([R("values")],v.prototype,"castValues",null),v=o([d("esri.renderers.support.UniqueValueClass")],v);var z=v;var D=class extends S.ClonableMixin(c){constructor(e){super(e),this.heading=null,this.classes=null}};o([r({type:String,json:{write:!0}})],D.prototype,"heading",void 0),o([r({type:[z],json:{write:{isRequired:!0}}})],D.prototype,"classes",void 0),D=o([d("esri.renderers.support.UniqueValueGroup")],D);var H=D;var B,g=B=class extends c{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new B({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){let e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};o([r({type:String,json:{write:!0}})],g.prototype,"description",void 0),o([r({type:String,json:{write:!0}})],g.prototype,"label",void 0),o([r(ae)],g.prototype,"symbol",void 0),o([r(w)],g.prototype,"value",void 0),g=B=o([d("esri.renderers.support.UniqueValueInfo")],g);var F=g;var E,ce="esri.renderers.UniqueValueRenderer",b=()=>Q.getLogger(ce),me="uvInfos-watcher",he="uvGroups-watcher",be=",",_e=Y(F);function Ve(e){let{field1:t,field2:s,field3:i,fieldDelimiter:l,uniqueValueInfos:u,valueExpression:a}=e,p=!(!t||!s);return[{classes:(u??[]).map(f=>{let{symbol:_,label:V,value:q,description:I}=f,[x,G,j]=p?q?.toString()?.split(l||"")||[]:[q],h=[];return(t||a)&&h.push(x),s&&h.push(G),i&&h.push(j),{symbol:_,label:V,values:[h],description:I}})}]}function O(e){return e!=null&&e!==""&&(typeof e!="string"||e.trim()!==""&&e.toLowerCase()!=="<null>")||(e=null),e+""}var n=E=class extends ne(ue){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,s){if(!t&&!s)return;if(!t||!s)return{type:"complete",oldValue:t,newValue:s};let i=!1,l={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let u=0;u<s.length;u++){let a=t.find(p=>p.value===s[u].value);a?ie(a,s[u])?(l.changed.push({type:"complete",oldValue:a,newValue:s[u]}),i=!0):l.unchanged.push({oldValue:a,newValue:s[u]}):(l.added.push(s[u]),i=!0)}for(let u=0;u<t.length;u++)s.find(a=>a.value===t[u].value)||(l.removed.push(t[u]),i=!0);return i?l:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:X(e)}writeField(e,t,s,i){typeof e=="string"?t[s]=e:i?.messages?i.messages.push(new W("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):b().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,s){return s.portal||A.getDefault()}readStyleOrigin(e,t,s){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){let i=ee(t.styleUrl,s);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,s,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=te(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?b().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?b().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void b().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let s;s=typeof e=="object"?_e(e):new F({value:e,symbol:re(t)}),this.uniqueValueInfos?.push(s),this._valueInfoMap[O(s.value)]=s,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void b().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let t=this.uniqueValueInfos;if(t)for(let s=0;s<t.length;s++){let i=t[s];if(String(i.value)===String(e)){delete this._valueInfoMap[O(e)],t.splice(s,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let s=t;return this.valueExpression&&t?.arcade==null&&(s=k(N({},s),{arcade:await T()})),this._getUniqueValueInfo(e,s)}getSymbol(e,t){return this.valueExpression&&t?.arcade==null?void b().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(e,t)?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let s=t;if(this.valueExpression&&s?.arcade==null){let l=await T(),{arcadeUtils:u}=l;u.hasGeometryOperations(this.valueExpression)&&await u.enableGeometryOperations(),s=k(N({},s),{arcade:l})}return this._getUniqueValueInfo(e,s)?.symbol||this.defaultSymbol}get symbols(){let e=[];for(let t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){let e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),s=this.uniqueValueInfos?.reduce((i,l)=>i+l.getMeshHash(),"");return`${e}.${t}.${s}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){let e=new E({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:m(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:m(this.visualVariables),legendOptions:m(this.legendOptions),authoringInfo:m(this.authoringInfo),backgroundFillSymbol:m(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);let t=m(this.uniqueValueInfos),s=m(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(m(this.styleOrigin))),Object.freeze(t),Object.freeze(s)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",s),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){let s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(s)}async collectSymbolFields(e,t){let s=[...this.symbols.map(i=>i.collectRequiredFields(e,t)),de(e,t,this.valueExpression)];$(e,t,this.field),$(e,t,this.field2),$(e,t,this.field3),await Promise.all(s)}populateFromStyle(){return oe(this.styleOrigin,{portal:this.portal}).then(e=>{let t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach(s=>{let i=new le({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:s.name});this.defaultSymbol||s.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);let l=new F({value:s.name,symbol:i});t.push(l),this._valueInfoMap[O(s.name)]=l}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",be)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};let{uniqueValueInfos:e}=this;if(e)for(let t of e)this._valueInfoMap[O(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(me);let{uniqueValueInfos:e}=this;if(e){let t=[];for(let s of e)t.push(P(()=>({symbol:s.symbol,value:s.value,label:s.label,description:s.description}),(i,l)=>{i!==l&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,me)}}_watchUniqueValueGroups(){this.removeHandles(he);let{uniqueValueGroups:e}=this;if(e){let t=[];for(let s of e){t.push(P(()=>({classes:s.classes}),(i,l)=>{i!==l&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(let i of s.classes??[])t.push(P(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(l,u)=>{l!==u&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(t,he)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();let e=[],{field:t,field2:s,field3:i,fieldDelimiter:l,uniqueValueGroups:u,valueExpression:a}=this;if(!t&&!a)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();let p=!(!t||!s);for(let f of u)for(let _ of f.classes??[]){let{symbol:V,label:q,values:I,description:x}=_;for(let G of I??[]){let{value:j,value2:h,value3:ye}=G,M=[j];s&&M.push(h),i&&M.push(ye);let ve=p?M.join(l||""):M[0]??void 0;e.push(new F({symbol:V,label:q,value:ve,description:x}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();let{field:t,field2:s,valueExpression:i,fieldDelimiter:l,uniqueValueInfos:u}=this;if(!t&&!i||!u.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();let a=!(!t||!s),p=u.map(_=>{let{symbol:V,label:q,value:I,description:x}=_,[G,j,h]=a?I?.toString()?.split(l||"")||[]:[I];return new z({symbol:V,label:q,description:x,values:[new y({value:G,value2:j,value3:h})]})}),f=[new H({classes:p})];e&&Object.freeze(f),this._set("uniqueValueGroups",f),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){let{viewingMode:s,scale:i,spatialReference:l,arcade:u,timeZone:a}=t??{},p=this._cache.compiledFunc,f=u.arcadeUtils;if(!p){let V=f.createSyntaxTree(this.valueExpression);p=f.createFunction(V),this._cache.compiledFunc=p}let _=f.executeFunction(p,f.createExecContext(e,f.getViewInfo({viewingMode:s,scale:i,spatialReference:l}),a));return this._valueInfoMap[O(_)]}_getUnqiueValueInfoForFields(e){let t=this.field,s=e.attributes,i;if(this.field2){let l=this.field2,u=this.field3,a=[];t&&a.push(s[t]),l&&a.push(s[l]),u&&a.push(s[u]),i=a.join(this.fieldDelimiter||"")}else t&&(i=s[t]);return this._valueInfoMap[O(i)]}static fromPortalStyle(e,t){let s=new E(t?.properties);s._set("styleOrigin",Object.freeze({styleName:e})),s._set("portal",t?.portal||A.getDefault());let i=s.populateFromStyle();return i.catch(l=>{b().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",l)}),i}static fromStyleUrl(e,t){let s=new E(t?.properties);s._set("styleOrigin",Object.freeze({styleUrl:e}));let i=s.populateFromStyle();return i.catch(l=>{b().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",l)}),i}};o([r({readOnly:!0})],n.prototype,"_cache",null),o([se({uniqueValue:"unique-value"})],n.prototype,"type",void 0),o([r(pe)],n.prototype,"backgroundFillSymbol",void 0),o([r({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],n.prototype,"field",null),o([R("field")],n.prototype,"castField",null),o([L("field")],n.prototype,"writeField",null),o([r({type:String,value:null,json:{write:!0}})],n.prototype,"field2",null),o([r({type:String,value:null,json:{write:!0}})],n.prototype,"field3",null),o([r({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],n.prototype,"orderByClassesEnabled",void 0),o([r({type:String,value:null,json:{write:!0}})],n.prototype,"valueExpression",null),o([r({type:String,json:{write:!0}})],n.prototype,"valueExpressionTitle",void 0),o([r({type:fe,json:{write:!0}})],n.prototype,"legendOptions",void 0),o([r({type:String,json:{write:!0}})],n.prototype,"defaultLabel",void 0),o([r(K(N({},C),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],n.prototype,"defaultSymbol",null),o([r({type:String,value:null,json:{write:!0}})],n.prototype,"fieldDelimiter",null),o([r({type:A,readOnly:!0})],n.prototype,"portal",void 0),o([J("portal",["styleName"])],n.prototype,"readPortal",null),o([r({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],n.prototype,"styleOrigin",void 0),o([J("styleOrigin",["styleName","styleUrl"])],n.prototype,"readStyleOrigin",null),o([L("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],n.prototype,"writeStyleOrigin",null),o([r({type:[H],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,s)=>(t.uniqueValueGroups||Ve(t)).map(i=>H.fromJSON(i,s))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],n.prototype,"uniqueValueGroups",null),o([r({type:[F],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],n.prototype,"uniqueValueInfos",null),n=E=o([d(ce)],n);var At=n;export{F as a,At as b};
