import{b as qe,g as Q,h as He,i as Ze,j as M,n as $e,p as We,q as X}from"./chunk-7S2234XQ.js";import{a as ze}from"./chunk-5QOQFLF6.js";import{a as ke}from"./chunk-2I3LIA7G.js";import{b as Ie,c as Ae,d as Re,e as we}from"./chunk-TY4DYZZJ.js";import{a as De,d as j,j as je}from"./chunk-6SGUOKGX.js";import{a as Me,b as Ge,c as Ne,e as Ue,j as J,k as Be,q as Ve}from"./chunk-VUJT53YX.js";import{b as Te}from"./chunk-F4FOXK2P.js";import{g as D}from"./chunk-5L4CW2H2.js";import{a as A}from"./chunk-MJO3PLZV.js";import{a as Le}from"./chunk-7JW7DYCQ.js";import{a as W}from"./chunk-UP67O2XH.js";import{a as $}from"./chunk-NIYDRLW4.js";import{f as Z}from"./chunk-ONYJLWAD.js";import{k as Fe}from"./chunk-I4Q2S2XA.js";import{a as xe}from"./chunk-KAMRW6HF.js";import{a as T}from"./chunk-6DGDLLNL.js";import{b as H}from"./chunk-BHB4UQZT.js";import{a as q}from"./chunk-ALWV3RJ2.js";import{C as ge,D as fe,F as ve,K as Pe,d as me,t as he,v as ye,z as be}from"./chunk-KD27XIJC.js";import{k as Ee}from"./chunk-XRRQM4E2.js";import{a as I}from"./chunk-RWCIDBNQ.js";import{b as Ce,c as z,d as Se,y as k}from"./chunk-6B5XFA6F.js";import{a as w}from"./chunk-ZTOZWLEE.js";import{c as Oe,f as _e}from"./chunk-PTZYZULI.js";import{a as v,j as ce}from"./chunk-BOVYXYHK.js";import{g as ue,h as de,k as pe}from"./chunk-C4UMJHQC.js";import{D as le,e as ne}from"./chunk-CKJ56T2Q.js";import{r as ie}from"./chunk-UHRSAPGQ.js";import{a as se,b as oe}from"./chunk-N2WTMF3X.js";var Et=1.2,Ct=_e,St=4;function Rt(a){switch(a){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Je(a,e){let t=(r,s,i=!1)=>new we(r.map(o=>{let l=s(o.tesselation);return i&&Ve(l),new Re([new Ae(new Ie(l))],o.minScreenSpaceRadius)}));switch(a){case"sphere":return t([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Ue(e,.5,r,!0));case"cube":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Me(e,1));case"cone":return t(Y,r=>J(e,1,.5,r,!1),!0);case"inverted-cone":return t(Y,r=>J(e,1,.5,r,!0),!0);case"cylinder":return t(Y,r=>Be(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Ne(e,1),!0);case"diamond":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>Ge(e,1),!0);default:return}}var Y=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];var g=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new R}},x=class extends g{constructor(e){super(e),this.estimated=!0}},G=class extends g{constructor(e,t){super(t),this.numComplexities=e}},N=class extends x{constructor(e,t){super(t),this.numComplexities=e}},R=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};var pt=new x({});function zt(a){return a.type==="web-style"?pt:Qe(a.symbolLayers.toArray().map(e=>ee(a,e)))}function Qe(a){let e=0,t=0,r=0,s=!1,i=0,o=new R;for(let l of a)l!=null&&(e+=l.verticesPerFeature,t+=l.verticesPerCoordinate,r+=l.drawCallsPerFeature,o.bytesPerFeature+=l.memory.bytesPerFeature,o.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,o.resourceBytes+=l.memory.resourceBytes,o.draped.bytesPerFeature+=l.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,s=s||l.estimated,++i);return s?new N(i,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:o}):new G(i,{verticesPerFeature:e,verticesPerCoordinate:t,drawCallsPerFeature:r,memory:o})}function kt(a){let e=Qe(a);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}var K={};function ee(a,e){let t=mt(a,e),r=Le(e)?2:0;switch(e.type){case"extrude":return new g({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:t});case"fill":if(a.type==="mesh-3d")return new g({drawCallsPerFeature:r,memory:t});if(e.outline!=null&&e.outline.size>0)return new g({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case"water":return new g({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case"line":return new g({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case"object":return e.resource?.href?new x({verticesPerFeature:100,memory:t}):oe(se({},ht(e.resource?.primitive??Fe)),{memory:t});case"path":{let s=0,i=0;switch(e.profile){case"circle":s=10;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":i=3;break;case"miter":case"bevel":i=1;break;default:return}let o=2*s,l=s*i*2,d=l+o,n=-2*l-o;switch(e.cap){case"none":break;case"butt":case"square":n+=2*(s-1);break;case"round":n+=2*(s*2*2+s);break;default:return}return new g({verticesPerFeature:n,verticesPerCoordinate:d,memory:t})}case"text":case"icon":return new g({verticesPerFeature:6,memory:t});default:return}}function mt(a,e){let t=a.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?h.EXTRUDE_EDGES:h.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?h.FILL_OUTLINE:h.FILL;case"water":return h.FILL;case"line":return e.join==="round"?h.LINE_ROUND:h.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return h.PATH_ROUND_CIRCLE;case"quad":return h.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return h.PATH_MITER_CIRCLE;case"quad":return h.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return t?h.OBJECT_POINT:h.OBJECT_POLYGON;case"icon":case"text":return t?h.ICON_POINT:h.ICON_POLYGON;default:return}}function ht(a){let e=K[a];if(e)return e;let t=yt(Je(a,new Te({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return K[a]=new g({verticesPerFeature:t}),K[a]}function yt(a){return a.reduce((e,t,r)=>e+t.numVertices*(1/10**r),0)/a.reduce((e,t,r)=>e+1/10**r,0)}var h={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};function te(a){return a.mapPositions!=null}function ir(a,e,t,r,s){let i=a.stageObject,o=i.geometries,l=0;for(let d of o){if(!te(d))continue;let{update:n,averageGeometrySampledElevation:c}=Ye(d,e,t,r,s);l+=c,n&&i.geometryVertexAttributeUpdated(d,I.POSITION)}return l/o.length}function nr(a,e,t,r,s,i){let o=a.stageObject,l=e.centerPointInElevationSR,d=0;o.usesVerticalDistanceToGround?(r(l,b),He(o,b.verticalDistanceToGround),d=b.sampledElevation):(r(l,b),e.mode!=="absolute-height"&&(d=b.sampledElevation));let n=w(bt,i??o.transformation),c=z(Xe,n[12],n[13],n[14]);A.TESTS_DISABLE_OPTIMIZATIONS?(y[0]=l.x,y[1]=l.y,y[2]=b.z,H(l.spatialReference,y,n,s.spatialReference)&&(i?w(i,n):o.transformation=n)):s.setAltitudeOfTransformation(b.z,n);let u=re/s.unitInMeters;return(Math.abs(n[12]-c[0])>=u||Math.abs(n[13]-c[1])>=u||Math.abs(n[14]-c[2])>=u)&&(i?w(i,n):o.transformation=n),d}var bt=q();function lr(a,e,t,r,s){let i=a.graphics3DSymbolLayer.lodRenderer;if(i==null)return 0;let o=e.centerPointInElevationSR;r(o,b);let l=e.mode!=="absolute-height"?b.sampledElevation:0,d=i.instanceData,n=a.instanceIndex,c=gt;d.getGlobalTransform(n,c);let u=z(Xe,c[12],c[13],c[14]);A.TESTS_DISABLE_OPTIMIZATIONS?(y[0]=o.x,y[1]=o.y,y[2]=b.z,H(o.spatialReference,y,c,s.spatialReference)&&d.setGlobalTransform(n,c)):s.setAltitudeOfTransformation(b.z,c);let m=re/s.unitInMeters;return(A.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-u[0])>=m||Math.abs(c[13]-u[1])>=m||Math.abs(c[14]-u[2])>=m)&&d.setGlobalTransform(n,c),l}function cr(a,e,t,r,s){let i=a.stageObject,o=i.geometries;if(o.length===0)return 0;let l=0,d=null,n=0,c=!1;for(let u of o){if(!te(u))continue;let m=u.attributes.get(I.POSITION);if(m!==d){let{update:p,averageGeometrySampledElevation:L}=Ye(u,e,t,r,s);n=L,d=m,c=p}c&&i.geometryVertexAttributeUpdated(u,I.POSITION),l+=n}return l/o.length}var re=.01,y=v(),f=v(),F=v(),gt=q(),Xe=v(),b=new Ze;function Ye(a,e,t,r,s){let i=!1,o=a.transformation,l=e.requiresSampledElevationInfo;f[0]=o[12],f[1]=o[13],f[2]=o[14],a.invalidateBoundingInfo();let d=a.getMutableAttribute(I.POSITION),n=d.data,c=d.size,u=n.length/c,m=new ke(a.mapPositions,t),p=0,L=0;for(let ae=0;ae<u;ae++){if(F[0]=n[p],F[1]=n[p+1],F[2]=n[p+2],r(m,b),l&&(L+=b.sampledElevation),A.TESTS_DISABLE_OPTIMIZATIONS)n[p]=m.array[m.offset],n[p+1]=m.array[m.offset+1],n[p+2]=b.z,Ee(n,t,p,n,s.spatialReference,p,1),n[p]-=f[0],n[p+1]-=f[1],n[p+2]-=f[2],i=!0;else{y[0]=n[p]+f[0],y[1]=n[p+1]+f[1],y[2]=n[p+2]+f[2],s.setAltitude(y,b.z),n[p]=y[0]-f[0],n[p+1]=y[1]-f[1],n[p+2]=y[2]-f[2];let V=re/s.unitInMeters;(Math.abs(F[0]-n[p])>=V||Math.abs(F[1]-n[p+1])>=V||Math.abs(F[2]-n[p+2])>=V)&&(i=!0)}p+=c,m.offset+=3}return L/=u,{update:i,averageGeometrySampledElevation:L}}var Ke=class{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=r}},et=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,s,i,o,l,d=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=i,this.elevationAligner=o,this.elevationContext=l,this._edgeState=d,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;let t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;let e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){let{stageObject:r,_edgeState:s,_stageLayer:i}=this;if(s==null)return;let o=tt(s.baseMaterial);s.edgeMaterial.objectTransparency!==o&&(s.edgeMaterial.objectTransparency=o,this.resetEdgeObject(t)),i.stage.renderer.withEdgeView(l=>l.updateAllComponentOpacities(r,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){let{stageObject:r,_edgeState:s,_stageLayer:i}=this;s!=null&&i.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterial,e,!t),s.hasSlicePlane=e})}setVisibility(e){let{_edgeState:t,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),t!=null&&s.stage.renderer.withEdgeView(i=>{i.hasObject(r)?i.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,i,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,r,s){if(this.elevationAligner==null)return;r!=null&&$e(this.elevationContext.featureExpressionInfoContext,r);let i=(o,l)=>qe(o,e,this.elevationContext,t,l);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,i,t),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,t,r){let s=(i,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,t),this.resetEdgeObject(r)}getCenterObjectSpace(e=v()){return Ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=me()){let t=this.stageObject.boundingVolumeObjectSpace;return ge(e,t.min),fe(e,t.max),e}computeAttachmentOrigin(e){let t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(let r of this.stageObject.geometries)r.computeAttachmentOrigin(P)&&(k(P,P,t),Se(e.render.origin,e.render.origin,P),e.render.num++)}async getProjectedBoundingBox(e,t,r,s,i){let o=this.getBoundingBoxObjectSpace(i),l=ft,d=Pe(o)?1:l.length;for(let c=0;c<d;c++){let u=l[c];_[0]=o[u[0]],_[1]=o[u[1]],_[2]=o[u[2]],k(_,_,this.stageObject.transformation),S[3*c]=_[0],S[3*c+1]=_[1],S[3*c+2]=_[2]}if(!e(S,0,d))return null;ve(o);let n=null;this.calculateRelativeScreenBounds&&(n=this.calculateRelativeScreenBounds());for(let c=0;c<3*d;c+=3){for(let u=0;u<3;u++)o[u]=Math.min(o[u],S[c+u]),o[u+3]=Math.max(o[u+3],S[c+u]);n&&r.push({location:S.slice(c,c+3),screenSpaceBoundingRect:n})}if(t?.service&&this.elevationContext.mode!=="absolute-height"){he(o,P);let c=this.elevationContext.mode==="relative-to-scene"?"scene":"ground",u=0;if(t.useViewElevation)u=t.service.getElevation(P[0],P[1],c)??0;else try{let m=je(o,t.service.spatialReference,t);u=await t.service.queryElevation(P[0],P[1],s,m,c)??0}catch{}be(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e){e.stateType===Z.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===Z.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){let{_edgeState:t,stageObject:r,_stageLayer:s,_visible:i}=this;t!=null&&s.stage.renderer.withEdgeView(o=>{i?this._addOrUpdateEdgeObject(t,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,t,r){let s=tt(e.baseMaterial);e.edgeMaterial.objectTransparency=s,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!r).then(()=>this._stageLayer?.sync())}};function tt(a){return a.parameters.transparent?W.TRANSPARENT:W.OPAQUE}var S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=v(),P=v(),ft=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var rt=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}};var U,at;(function(a){a[a.RecreateSymbol=0]="RecreateSymbol",a[a.RecreateGraphics=1]="RecreateGraphics",a[a.FastUpdate=2]="FastUpdate"})(U||(U={})),function(a){a[a.Slow=0]="Slow",a[a.Fast=1]="Fast",a[a.Mixed=2]="Mixed",a[a.Loading=3]="Loading",a[a.Undefined=4]="Undefined"}(at||(at={}));var B=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=O.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===O.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===O.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=O.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=O.FAILED,!le(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=ne(this._abortController):this._loadStatus===O.LOADING&&(this._loadStatus=O.FAILED),this._loader=null}},O;(function(a){a[a.LOADING=0]="LOADING",a[a.LOADED=1]="LOADED",a[a.FAILED=2]="FAILED"})(O||(O={}));var E=()=>ie.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),st=class extends B{constructor(e,t,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=E(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new X,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=ot(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){let e=this.complexity;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;let t=this._drivenProperties,r=ot(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size||r.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,s){let i=e.projectionSuccess,o="polygons"in e?e.polygons:null,l=`${s} geometry failed to be created`;i?!this._logGeometryValidationWarnings(t,r,s)&&o&&o.length===0&&r==="rings"&&t.length>0&&t[0].length>2&&E().warnOncePerTick(`${l} (filled rings should use clockwise winding - try reversing the order of vertices)`):E().warnOncePerTick(`${l} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,r){let s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(E().warnOncePerTick(`${s} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(E().warnOncePerTick(`${s} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,r=null){if(t!=null&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{let s=e;if(!isFinite(s.x)||!isFinite(s.y))return E().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":pe(e)&&E().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return vt}_defaultElevationInfoZ(){return Pt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new X){let r=e.geometry,s=this.getDefaultElevationInfo(r);t.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,t.mode=this.getGeometryElevationMode(r,s),t.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;let i=!this._elevationOptions.supportsOnTheGround&&t.mode==="on-the-ground";i&&(t.mode="relative-to-ground",t.offsetMeters=0);let o=i?We:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(o,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=it){let r=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?r:e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,t=it){let r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return j(null,r);let s=e!=null?xe.toUnitRGB(e):ce;return j(s,r)}_getVertexOpacityAndColor(e,t=null){let r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,i=j(r,s);return t&&(i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t),i}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return ee(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{let s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,s)!==M.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let s=M.UPDATE;return e.forEach(i=>{let o=t(i);if(o!=null){let l=i.graphic;this.setGraphicElevationContext(l,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=M.RECREATE}),s}applyRendererDiff(e,t){return U.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;let t=this._fastUpdates.visualVariables,r=t.size?D(t.size.field,e):0,s=t.color?D(t.color.field,e):0,i=t.opacity?D(t.opacity.field,e):0;return Oe(r,s,i,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&E().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){let e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function ot(a){let e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return a&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(t=>{switch(t.type){case"color":if(e.color=!0,t.stops)for(let r=0;r<t.stops.length;r++){let s=t.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0;break;case"rotation":e.rotation=!0}}),e}var vt={mode:"on-the-ground",offset:0,unit:"meters"},Pt={mode:"absolute-height",offset:0,unit:"meters"},it={hasIntrinsicColor:!1};function Qr(a,e,t,r,s){if(nt(a,e))return null;t.localOrigin=Ot(a,e);let i=new ze({geometries:[t],castShadow:!1,layerUid:a.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:i,sampledElevation:Q(i,e,a.elevationProvider,a.renderCoordsHelper,r)}}function Xr(a,e,t,r){return nt(e,t)?null:Q(a,t,e.elevationProvider,e.renderCoordsHelper,r)}function nt(a,e){let t=a.clippingExtent;return!!t&&(T(e,C,a.elevationProvider.spatialReference),!ye(t,C))}function Yr(a,e,t){let r=a.elevationContext,s=t.spatialReference;T(e,C,s),r.centerPointInElevationSR=$(C[0],C[1],e.hasZ?C[2]:0,s??null)}function Kr(a){switch(a.type){case"point":return a;case"polygon":case"extent":return De(a);case"polyline":{let e=a.paths[0];if(!e||e.length===0)return null;let t=de(e,ue(e)/2);return $(t[0],t[1],t[2],a.spatialReference)}case"mesh":return a.extent.center}return null}function Ot(a,e){return T(e,C,a.renderCoordsHelper.spatialReference),a.localOriginFactory.getOrigin(C)}var C=v();var lt=class{constructor(e,t){this.renderer=e,this.symbol=t}};export{lt as a,Et as b,Ct as c,St as d,Rt as e,Je as f,g,pt as h,zt as i,Qe as j,kt as k,mt as l,yt as m,te as n,ir as o,nr as p,lr as q,cr as r,Ke as s,et as t,rt as u,U as v,at as w,B as x,O as y,st as z,Qr as A,Xr as B,Yr as C,Kr as D,Ot as E};
