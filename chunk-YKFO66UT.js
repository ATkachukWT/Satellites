import{a as he}from"./chunk-N52QLLCJ.js";import{a as A,b as x,c as B,d as G,e as Q,f as N,g as z,h as F,i as J}from"./chunk-FNHORG6X.js";import"./chunk-KAFWB3JH.js";import"./chunk-KO6SRXH5.js";import"./chunk-WOGTXK7W.js";import"./chunk-CQUBHG54.js";import"./chunk-K3Z3MI77.js";import{a as oe}from"./chunk-YAZINLP3.js";import{c as Y}from"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import{b as k}from"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import"./chunk-HBMVPT4U.js";import{a as Z}from"./chunk-L6ZFUQTH.js";import{a as ie}from"./chunk-4MB4OYWM.js";import{a as se}from"./chunk-ZU53JDRS.js";import{a as H}from"./chunk-TO337MWO.js";import"./chunk-62PJ3MJN.js";import"./chunk-OVJTX4VC.js";import{c as ee}from"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import{b as W,c as pe}from"./chunk-QDXM6RGS.js";import{b as $,c as X}from"./chunk-E3UR4EIC.js";import{b as re}from"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import{a as ae}from"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import{a as K}from"./chunk-R5HXEPJ3.js";import{b as L}from"./chunk-CJM4TC3F.js";import{c as E}from"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import{a as _}from"./chunk-DZBH24YT.js";import{a as fe}from"./chunk-7E723FQO.js";import{b as le,c as ue,d as de,e as ce,f as ye,g as me}from"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import{a as te}from"./chunk-WT3XCHGP.js";import{a as j}from"./chunk-CUJB6F5L.js";import{a as ge}from"./chunk-5NHJFBCW.js";import{a as V}from"./chunk-WPZN772I.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-YQGS4EZO.js";import"./chunk-3REMXE4W.js";import{p as U}from"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import{b as R}from"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import{e as q}from"./chunk-W26XKMAT.js";import{a as C,b as M}from"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import"./chunk-JTDXB5TK.js";import"./chunk-2NP7F5RO.js";import"./chunk-7QY3BMVN.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-RZF6KTKU.js";import{e as w,f as ne}from"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-SLAWDKDA.js";import"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import"./chunk-EXJYW3PC.js";import{a as D}from"./chunk-SXQPBCOX.js";import{m as P}from"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import{a as m}from"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as r}from"./chunk-QHVIRF5H.js";import{I as f}from"./chunk-WZDN6K3C.js";import{a as t}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{m as S,t as b}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";var u=class extends D{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getSource(){let{featureDefinition:{collection:e,layerDefinition:s,spatialReference:i,supportedCrs:p},layer:{apiKey:l,customParameters:n,effectiveMaxRecordCount:a}}=this;return{type:"ogc-source",collection:e,layerDefinition:s,maxRecordCount:a,queryParameters:{apiKey:l,customParameters:n},spatialReference:i,supportedCrs:p}}queryExtent(e,s={}){return null}queryFeatureCount(e,s={}){return null}queryFeatures(e,s={}){return this.queryFeaturesJSON(e,s).then(i=>V.fromJSON(i))}queryFeaturesJSON(e,s={}){let i=this.getSource();return this.load(s).then(()=>J(i,e,s))}queryObjectIds(e,s={}){return null}serviceSupportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator)||!!this.featureDefinition.supportedCrs[e.wkid]}_conformsToType(e,s){let i=new RegExp(`^${S(s)}$`,"i");return e.conformsTo.some(p=>i.test(p))??!1}_getCapabilities(e,s){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryBins:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:s,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsCurrentUser:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:he,editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}_getMaxRecordCount(e){let s=e?.components?.parameters;return s?.limit?.schema?.maximum??s?.limitFeatures?.schema?.maximum}_getStorageSpatialReference(e){let s=e.storageCrs??x,i=F(s);return i==null?m.WGS84:new m({wkid:i})}_getSupportedSpatialReferences(e,s){let i="#/crs",p=e.crs??[x],l=p.includes(i)?p.filter(a=>a!==i).concat(s.crs??[]):p,n=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return l.filter(a=>!n.test(a))}async _loadOGCServices(e,s){let i=s!=null?s.signal:null,{apiKey:p,collectionId:l,customParameters:n,fields:a,geometryType:ve,hasZ:Se,objectIdField:be,timeInfo:Ce,url:Re}=e,xe={fields:a?.map(d=>d.toJSON()),geometryType:M.toJSON(ve),hasZ:Se??!1,objectIdField:be,timeInfo:Ce?.toJSON()},c={apiKey:p,customParameters:n,signal:i},h=await N(Re,c),[O,I]=await Promise.all([Q(h,c),G(h,c)]);if(!this._conformsToType(O,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new b("ogc-feature-layer:no-geojson-support","Server does not support geojson");let y=I.collections.find(({id:d})=>d===l);if(!y)throw new b("ogc-feature-layer:collection-not-found","Server does not contain the named collection");let Fe=this._conformsToType(O,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await z(h,c):null,T=await B(y,xe,c),we=this._getMaxRecordCount(Fe),Oe=this._getCapabilities(T.hasZ,we),Ie=this._getStorageSpatialReference(y).toJSON(),Te=this._getSupportedSpatialReferences(y,I),De=new RegExp(`^${S(A)}`,"i"),g={};for(let d of Te){let v=F(d);v!=null&&(g[v]||(g[v]=d.replace(De,"")))}this.featureDefinition={capabilities:Oe,collection:y,layerDefinition:T,spatialReference:Ie,supportedCrs:g}}};t([r()],u.prototype,"featureDefinition",void 0),t([r({constructOnly:!0})],u.prototype,"layer",void 0),t([r()],u.prototype,"type",void 0),u=t([f("esri.layers.graphics.sources.OGCFeatureSource")],u);var Pe=ie(),o=class extends Z(H(K(Y(k(E(ee(re(oe(_(fe(te(L(j(ge)))))))))))))){constructor(e){super(e),this.capabilities=null,this.collectionId=null,this.copyright=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.maxRecordCount=null,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new u({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then(()=>this._fetchService(e))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}get effectiveMaxRecordCount(){return this.maxRecordCount??this.capabilities?.query.maxRecordCount??5e3}get isTable(){return this.loaded&&this.geometryType==null}set renderer(e){w(e,this.fieldsIndex),this._set("renderer",e)}on(e,s){return super.on(e,s)}createPopupTemplate(e){return ae(this,e)}createQuery(){return new R}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,s){let i,p=!1,l=s?.feature?.attributes,n=this.typeIdField&&l?.[this.typeIdField];return n!=null&&this.types&&(p=this.types.some(a=>a.id==n&&(i=a.domains?.[e],i?.type==="inherited"&&(i=this._getLayerDomain(e)),!0))),p||i||(i=this._getLayerDomain(e)),i}queryFeatures(e,s){return this.load().then(()=>this.source.queryFeatures(R.from(e)||this.createQuery(),s)).then(i=>(i?.features?.forEach(p=>{p.layer=p.sourceLayer=this}),i))}serviceSupportsSpatialReference(e){return this.source?.serviceSupportsSpatialReference(e)??!1}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),w(this.renderer,this.fieldsIndex),ne(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(let s of this.fields)if(s.name===e&&s.domain)return s.domain;return null}};t([r({readOnly:!0,json:{origins:{service:{read:!0}}}})],o.prototype,"capabilities",void 0),t([r({type:String,json:{write:!0}})],o.prototype,"collectionId",void 0),t([r({type:String})],o.prototype,"copyright",void 0),t([r({readOnly:!0})],o.prototype,"defaultPopupTemplate",null),t([r({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],o.prototype,"description",void 0),t([r({type:String})],o.prototype,"displayField",void 0),t([r({type:Number})],o.prototype,"effectiveMaxRecordCount",null),t([r(me)],o.prototype,"elevationInfo",void 0),t([r({type:[q],json:{origins:{service:{name:"layerDefinition.fields"}}}})],o.prototype,"fields",void 0),t([r(Pe.fieldsIndex)],o.prototype,"fieldsIndex",void 0),t([r({readOnly:!0,type:P,json:{origins:{service:{name:"layerDefinition.extent"}}}})],o.prototype,"fullExtent",void 0),t([r({type:C.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:C.read}}}}})],o.prototype,"geometryType",void 0),t([r({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],o.prototype,"hasZ",void 0),t([r({type:Boolean,readOnly:!0})],o.prototype,"isTable",null),t([r({type:[W],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:pe},write:!0}}}})],o.prototype,"labelingInfo",void 0),t([r(de)],o.prototype,"labelsVisible",void 0),t([r(ye)],o.prototype,"legendEnabled",void 0),t([r({type:Number})],o.prototype,"maxRecordCount",void 0),t([r({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],o.prototype,"objectIdField",void 0),t([r({type:["OGCFeatureLayer"]})],o.prototype,"operationalLayerType",void 0),t([r(ue)],o.prototype,"popupEnabled",void 0),t([r({type:U,json:{name:"popupInfo",write:!0}})],o.prototype,"popupTemplate",void 0),t([r({types:$,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:X,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],o.prototype,"renderer",null),t([r(le)],o.prototype,"screenSizePerspectiveEnabled",void 0),t([r({readOnly:!0})],o.prototype,"source",void 0),t([r({readOnly:!0,type:m,json:{origins:{service:{read:!0}}}})],o.prototype,"spatialReference",void 0),t([r({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],o.prototype,"title",void 0),t([r({readOnly:!0,json:{read:!1}})],o.prototype,"type",void 0),t([r({type:String,readOnly:!0})],o.prototype,"typeIdField",void 0),t([r({type:[se]})],o.prototype,"types",void 0),t([r(ce)],o.prototype,"url",void 0),o=t([f("esri.layers.OGCFeatureLayer")],o);var Dt=o;export{Dt as default};
