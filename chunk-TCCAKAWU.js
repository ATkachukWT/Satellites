import{a as O,b as X}from"./chunk-HBIHX3QX.js";import{a as Z}from"./chunk-DD4REJYH.js";import{a as Y,b as _,c as $,d as rr}from"./chunk-7WIURX4Y.js";import{a as L}from"./chunk-XD6DLQ5C.js";import{a as V}from"./chunk-2VPSOQ3I.js";import{c as D}from"./chunk-N64WAD57.js";import{A as T,B as K,C as Q,D as W,J as I,ga as U,p as J,r as b,v as M,y as C}from"./chunk-MGSAXUID.js";import"./chunk-OCNYIIP3.js";import"./chunk-M2IX3KDU.js";import{a as c,b as f}from"./chunk-GPURZ6GA.js";import"./chunk-I7FLOUNH.js";import"./chunk-W26XKMAT.js";import"./chunk-DGBDFGKO.js";import"./chunk-44S2QQS2.js";import"./chunk-CWUY5SXW.js";import{c as z,g as B,h as H}from"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-NRBJLISB.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-WDETDPZG.js";import{a as v,d as m,f as y,i as F}from"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-UBFCO3DV.js";import"./chunk-XZIOXVVJ.js";import{a as E}from"./chunk-5RAXVJQI.js";import{c as G}from"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import{a as x,j as A,k as N}from"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import{a as R}from"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import"./chunk-QHVIRF5H.js";import"./chunk-WZDN6K3C.js";import"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{k as q}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";var u=null;async function or(r){let t=q.geometryServiceUrl??"";if(!t){z()||await B();for(let n of r)n.container[n.indexer]=H(n.container[n.indexer],R.WGS84);return}let e=r.map(n=>n.container[n.indexer]),a=new O({geometries:e,outSpatialReference:R.WGS84}),i=await X(t,a);for(let n=0;n<i.length;n++){let o=r[n];o.container[o.indexer]=i[n]}}async function tr(r,t){let e=new E({portal:r,id:t});return await e.load(),u===null&&(u=await import("./chunk-WEUQNLDW.js")),await u.fetchKnowledgeGraph(e.url)}function j(r,t,e,a,i){if(r===null)return null;if(m(r)||v(r))return r;if(T(r)||T(r))return r.toJSDate();if(K(r))return r.toStorageFormat();if(Q(r))return r.toStorageString();if(M(r)){let n={};for(let o of r.keys())n[o]=j(r.field(o),t,e,a,i),n[o]instanceof x&&i.push({container:n,indexer:o});return n}if(y(r)){let n=r.map(o=>j(o,t,e,a,i));for(let o=0;o<n.length;o++)n[o]instanceof x&&i.push({container:n,indexer:o});return n}return b(r)?r.spatialReference.isWGS84?r:r.spatialReference.isWebMercator&&t?N(r):r:void 0}function ar(r,t){if(!r)return r;if(r.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return A(r);if(r.spatialReference.equals(t.spatialReference))return r;throw new f(t,c.WrongSpatialReference,null)}function P(r,t){if(!r)return null;let e={};for(let a in r)e[a]=d(r[a],t);return e}function d(r,t){return r===null?null:y(r)?r.map(e=>d(e,t)):r instanceof Y?{graphTypeName:r.typeName,id:r.id,graphType:"entity",properties:P(r.properties,t)}:r instanceof _?{graphType:"object",properties:P(r.properties,t)}:r instanceof rr?{graphTypeName:r.typeName,id:r.id,graphType:"relationship",originId:r.originId??null,destinationId:r.destinationId??null,properties:P(r.properties,t)}:r instanceof $?{graphType:"path",path:r.path?r.path.map(e=>d(e,t)):null}:b(r)?ar(r,t):m(r)||v(r)||F(r)?r:null}function Ir(r){r.mode==="async"&&(r.functions.knowledgegraphbyportalitem=function(t,e){return r.standardFunctionAsync(t,e,(a,i,n)=>{if(W(n,2,2,t,e),n[0]===null)throw new f(t,c.PortalRequired,e);if(n[0]instanceof V){let h=I(n[1]),l;return l=t.services?.portal?t.services.portal:G.getDefault(),tr(L(n[0],l),h)}if(m(n[0])===!1)throw new f(t,c.InvalidParameter,e);let o=I(n[0]);return tr(t.services?.portal??G.getDefault(),o)})},r.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),r.functions.querygraph=function(t,e){return r.standardFunctionAsync(t,e,async(a,i,n)=>{W(n,2,4,t,e);let o=n[0];if(!C(o))throw new f(t,c.InvalidParameter,e);let h=n[1];if(!m(h))throw new f(t,c.InvalidParameter,e);u===null&&(u=await import("./chunk-WEUQNLDW.js"));let l=null,g=J(n[2],null);if(!(g instanceof D||g===null))throw new f(t,c.InvalidParameter,e);if(g){let s=[];l=j(g,!0,!1,t,s),s=s.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),s.length>0&&await or(s)}let k=new Z({openCypherQuery:h,bindParameters:l});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(k.outputSpatialReference=t.spatialReference);let nr=(await u.executeQueryStreaming(o,k)).resultRowsStream.getReader(),S=[];try{for(;;){let{done:s,value:p}=await nr.read();if(s)break;if(y(p))for(let w of p)S.push(d(w,t));else{let w=[];for(let er of p)w.push(d(p[er],t));S.push(w)}}}catch(s){throw s}return D.convertJsonToArcade(S,U(t),!1,!0)})},r.signatures.push({name:"querygraph",min:2,max:4}))}export{Ir as registerFunctions};
