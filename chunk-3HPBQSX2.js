import{a as R}from"./chunk-QCZ3ZIGQ.js";import{o as F}from"./chunk-YQGS4EZO.js";import{a as E,b as w}from"./chunk-6YRWGF73.js";import{a as T,e as j}from"./chunk-LXFQWIWE.js";import{h as x,m as M,r as P,s as q,v as D}from"./chunk-QT6UNBJP.js";import{c as z}from"./chunk-YR2HD3ZC.js";import{m as k}from"./chunk-LFH24RLM.js";import{d as W,e as L,n as d}from"./chunk-Z5Q7KLA4.js";import{a as I}from"./chunk-4XZ6X7MQ.js";import{ha as V,p as C,q as N,r as _,t as v,x as G,z as U}from"./chunk-KGVXGH6H.js";import{t as u}from"./chunk-UHRSAPGQ.js";var oe=12,m=class e{constructor(t){let i=e.checkUnsupported(t);if(i!=null)throw i;let r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=C(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;let n=r.lods.reduce((c,f)=>(f.level<c.minLod.level&&(c.minLod=f),c.max=Math.max(c.max,f.level),c),{minLod:r.lods[0],max:-1/0}),o=n.minLod,l=2**o.level,a=o.resolution*l,h=o.scale*l;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:h,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,h/=2}clone(){return new e(this.toTileInfo())}toTileInfo(){return new w({dpi:this.dpi,origin:new d({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new E({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,n){let o=this.levels[t],l=o.tileSize[0],a=o.tileSize[1];n[0]=this.origin[0]+r*l,n[2]=this.origin[0]+(r+1)*l,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=W(t[0]),i[1]=L(t[1]),i[2]=W(t[2]),i[3]=L(t[3])):this._isGCS&&(i[0]=x(t[0]),i[1]=x(t[1]),i[2]=x(t[2]),i[3]=x(t[3]))}getExtentGeometry(t,i,r,n=new k){return this.getExtent(t,i,r,g),n.spatialReference=this.spatialReference,n.xmin=g[0],n.ymin=g[1],n.xmax=g[2],n.ymax=g[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){let{resolution:r,scale:n}=this.levels[this.levels.length-1],o=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:n/2,tileSize:[o,o]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){let i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(e.checkUnsupported(t))return!1;let r=new e(t);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;let n=Math.min(this.levels.length-1,r.levels.length-1,i),o=this.levels[n].resolution,l=.5*o;return!M(r.origin[0],this.origin[0],l)||!M(r.origin[1],this.origin[1],l)?!1:(l=.5*o/2**n/this.pixelSize*oe,M(o,r.levels[n].resolution,l))}rootTilesInExtent(t,i=null,r=1/0){let n=new Array,o=this.levels[0].tileSize;if(t==null||o[0]===0||o[1]===0)return n;e.computeRowColExtent(t,o,this.origin,g);let l=g[1],a=g[3],h=g[0],c=g[2],f=c-h,S=a-l;if(f*S>r){let p=Math.floor(Math.sqrt(r));S>p&&(l=l+Math.floor(.5*S)-Math.floor(.5*p),a=l+p),f>p&&(h=h+Math.floor(.5*f)-Math.floor(.5*p),c=h+p)}for(let p=l;p<a;p++)for(let O=h;O<c;O++)n.push([0,p,O]);return i!=null&&(i[0]=this.origin[0]+h*o[0],i[1]=this.origin[1]-a*o[1],i[2]=this.origin[0]+c*o[0],i[3]=this.origin[1]-l*o[1]),n}static computeRowColExtent(t,i,r,n){let o=.001*(t[2]-t[0]+(t[3]-t[1]));n[0]=Math.max(0,Math.floor((t[0]+o-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((t[2]-o-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-t[3]+o)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-t[1]-o)/i[1]))}static isPowerOfTwo(t){let i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!P(n.resolution,r/2**n.level))}static hasGapInLevels(t){let i=t.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){let i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){let i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?y():t.lods.length<1?new u("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(t)?e.hasGapInLevels(t)?new u("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(t)?e.hasOriginPerLODs(t)?new u("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new u("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new u("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){let r=t[2]-t[0],n=t[3]-t[1],o=V(i),l=1.2*Math.max(r,n),a=256,h=l/a,c=h*o*(96/.0254),f=new e(new w({size:[a,a],origin:new d({x:t[0]-.5*(l-r),y:t[3]+.5*(l-n)}),lods:[new E({level:0,resolution:h,scale:c})],spatialReference:i}));return f.ensureMaxLod(20),f}static makeWebMercatorAuxiliarySphere(t){let i=new e(e.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){let n=256/i,o=new e(new w({size:[i,i],origin:new d({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new E({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return o.ensureMaxLod(r),o}get test(){}};function y(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}m.WebMercatorAuxiliarySphereTileInfo=new w({size:[256,256],origin:new d({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:I.WebMercator}),spatialReference:I.WebMercator,lods:[new E({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),m.WebMercatorAuxiliarySphere=m.makeWebMercatorAuxiliarySphere(19);var g=T();var H=64,Ne=512,_e=2.5,Ge=q(D/10),Ue=2,se=T();m.WebMercatorAuxiliarySphere.getExtent(0,0,0,se);var Ve=T([-180,-90,180,90]),ke="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Fe="Surface extent is too large for tile resolution at level 0.",Pe=4;var s;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(s||(s={}));function B(e){return e!=null&&"type"in e&&e.type==="vector-tile"}function J(e){return e!=null&&"type"in e&&e.type==="raster-tile"}function K(e){return e!=null&&"type"in e&&e.type==="tile-texture"}function Q(e){return e!=null&&"type"in e&&e.type==="image+type"}function X(e){return A(e)||G(e)||U(e)}function A(e){return _(e)||v(e)}function le(e,t,i,r){if(e==null)return y();let n=e.spatialReference;if(n.isGeographic&&!A(n))return new u("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");let o=m.checkUnsupported(e);return o??(i==null?new u("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):ae(e,i)||(t==null||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function ae(e,t){let i=e.lods,r=i[0].resolution*2**i[0].level,n=[r*e.size[0],r*e.size[1]],o=[e.origin.x,e.origin.y],l=j(t),a=T();m.computeRowColExtent(l,n,o,a);let h=(a[2]-a[0])*(a[3]-a[1]);if(h>H){let c=i[0].scale*2**i[0].level,f=Math.max((l[3]-l[1])/e.size[1],(l[2]-l[0])/e.size[0])*c/r,S=Math.floor(Math.log(f)/Math.log(10));return f=Math.ceil(f/10**S)*10**S,new u("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:f,requiredNumRootTiles:h,allowedNumRootTiles:H})}return null}var Y=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:le},Symbol.toStringTag,{value:"Module"}));function ce(e,t,i,r){if(e==null)return y();let n=e?.lods.length-1,o=e.spatialReference;if(o.isWebMercator){if(!m.makeWebMercatorAuxiliarySphere(n).compatibleWith(e,r))return new u("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!X(o))return new u("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!m.makeGCSWithTileSize(e.spatialReference,e.size[0],n).compatibleWith(e,r))return e.spatialReference.isWGS84?new u("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new u("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}var Z=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ce},Symbol.toStringTag,{value:"Module"}));var ue={[R.Global]:Z,[R.Local]:Y};function ht(e,t){e||console.warn("Terrain: "+t)}var b=!1,fe=!1;function mt(e){fe=e,b=b||e}function pt(e){b=e}function gt(e,t){if(b&&!e){let i=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+i),new Error("Assertion failed"+(t?": "+t:""))}}function $(e){return e?.type==="imagery-tile"||e?.type==="wcs"}function ee(e){return e?.type==="imagery-tile-3d"}function te(e){return e?.type==="tile-3d"}function ie(e){return e?.type==="vector-tile-3d"}function re(e){return e?.type==="wmts-3d"}function he(e){return e?.type==="elevation-3d"}function Tt(e){return e?.type==="group"}function St(e){return e&&(te(e)||re(e)||ee(e)||ie(e))}function me(e){return e&&(te(e)||ee(e)||ie(e)||re(e))}function dt(e){return me(e)||he(e)}function xt(e){return J(e?.sourceLayerInfo?.data)}function Et(e){return pe(e?.sourceLayerInfo)||!!e?.isVTLBackground}function wt(e){return K(e?.sourceLayerInfo?.data)}function yt(e){let t=e?.sourceLayerInfo?.data;return Q(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function pe(e){return B(e?.data)}function vt(e){return e!=null&&"release"in e&&e.release(),null}function Mt(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function ne(e,t,i,r,n){return ue[r].checkIfTileInfoSupportedForViewSR(e,i,t,n)}function Rt(e,t,i){let r=null,n=null;if(e?.type==="wmts"){let l=ge(e,t,i);r=l.tileInfo,n=l.fullExtent}else{n=$(e)?e.getCompatibleFullExtent(t):e.fullExtent;let l=i===R.Local;$(e)?r=e.getCompatibleTileInfo(t,n,l):e?.type==="vector-tile"?r=l&&!Te(t)||Se.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):r=e.tileInfo}let o="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return r!=null&&n!=null&&ne(r,n,t,i,o)==null?{tileInfo:r,fullExtent:n}:null}function ge(e,t,i){let r=F(e);if(r!=null){if(!z.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{let n=r.find(o=>ne(o.tileInfo,o.fullExtent,t,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Te(e){return e.isWGS84||e.isWebMercator||v(e)||!N(e)}var Se={force512VTL:!1};function bt(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Ot(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function It(e,t,i=de){return Math.abs(e-t)<i}function Wt(e){return e===s.NORTH_EAST?s.SOUTH_WEST:e===s.NORTH_WEST?s.SOUTH_EAST:e===s.SOUTH_WEST?s.NORTH_EAST:s.NORTH_WEST}function Lt(e){return e===s.NORTH?s.SOUTH:e===s.EAST?s.WEST:e===s.SOUTH?s.NORTH:s.EAST}function Ht(e){return e===s.NORTH_WEST||e===s.SOUTH_WEST}function At(e){return e===s.NORTH_WEST||e===s.NORTH_EAST}function zt(e){return e===s.NORTH_WEST||e===s.WEST||e===s.SOUTH_WEST}function Ct(e){return e===s.NORTH_EAST||e===s.EAST||e===s.SOUTH_EAST}function Nt(e){return e===s.SOUTH_EAST||e===s.SOUTH||e===s.SOUTH_WEST}function _t(e){return e===s.NORTH_EAST||e===s.NORTH||e===s.NORTH_WEST}var Gt=[s.NORTH,s.EAST,s.SOUTH,s.WEST],Ut=[s.NORTH_EAST,s.SOUTH_EAST,s.SOUTH_WEST,s.NORTH_WEST],de=1e-5;export{m as a,H as b,Ne as c,_e as d,Ge as e,Ue as f,se as g,Ve as h,ke as i,Fe as j,Pe as k,s as l,B as m,J as n,K as o,Q as p,X as q,A as r,ht as s,b as t,fe as u,mt as v,pt as w,gt as x,$ as y,ee as z,ie as A,he as B,Tt as C,St as D,me as E,dt as F,xt as G,Et as H,wt as I,yt as J,pe as K,vt as L,Mt as M,ne as N,Rt as O,Te as P,Se as Q,bt as R,Ot as S,It as T,Wt as U,Lt as V,Ht as W,At as X,zt as Y,Ct as Z,Nt as _,_t as $,Gt as aa,Ut as ba};
