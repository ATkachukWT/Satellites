import{a as fi,b as gi}from"./chunk-OQV2EZEM.js";import{a as ni,b as Wt,n as mi}from"./chunk-2IZGBHXN.js";import{a as Zt,b as Qo,c as Lt,e as $o,g as ti,h as ei,i as E,j as be}from"./chunk-O2KLTSVL.js";import{b as Ce}from"./chunk-UCE3Z44N.js";import{a as si,b as ai,c as li,e as pi,g as ci,j as di,k as ui,l as hi}from"./chunk-2CQRLDTB.js";import{a as Ho,i as Yo,j as Ko,m as Xo,o as Jo,p as C}from"./chunk-QH6FSADD.js";import{a as ri,b as Ct}from"./chunk-27KA5M4B.js";import{s as oi,t as ii}from"./chunk-AF5UMDFO.js";import{a as Oe,d as Me}from"./chunk-FQUEI65G.js";import{a as j,b as Te,d as jo,g as Bo,h as B}from"./chunk-ZJQOPRYL.js";import{a as Se}from"./chunk-4OC4J3KU.js";import{b as zo,d as Zo,e as Lo,f as Wo,i as xe,j as No,k as _e,l as qo,t as yi}from"./chunk-T4QAGZWF.js";import{b as q,h as zt,j as Fo}from"./chunk-7BXTHPPE.js";import{e as Go,g as Ao}from"./chunk-C27Q2S3P.js";import{f as So,o as bo}from"./chunk-O2PACODW.js";import{a as Uo}from"./chunk-IZXGUN7P.js";import{b as Ht,d as Vo,f as pt,j as A,k as Z,m as Eo}from"./chunk-JKP7KG6H.js";import{a as we,b as Do}from"./chunk-CCTFA5SZ.js";import{a as Ro}from"./chunk-CU7VLLP2.js";import{b as Mo,f as Co,l as Po,m as ve,o as Ft,p as Io,w as ko}from"./chunk-2XYAAYOE.js";import{d as ye}from"./chunk-PM3EZWDJ.js";import{b as Oo,e as Mt}from"./chunk-SU7IJ65K.js";import{a as Ot}from"./chunk-LXEWGICX.js";import{a as bt}from"./chunk-NIYDRLW4.js";import{c as vo}from"./chunk-E2J2V7JN.js";import{a as To}from"./chunk-QCZ3ZIGQ.js";import{d as yo}from"./chunk-PFSX77NO.js";import{e as lt}from"./chunk-VMECOA4F.js";import{d as xo,i as _o}from"./chunk-PHODKV66.js";import{a as ge}from"./chunk-JPMGMA4B.js";import{a as wo}from"./chunk-3REMXE4W.js";import{a as Gt}from"./chunk-DVBZA6ZU.js";import{a as at,b as At}from"./chunk-NFXNGFHZ.js";import{b as nt,c as ao,d as lo,e as po,f as co,g as de,o as ue,x as he}from"./chunk-QXXXCEV5.js";import{A as me,B as fe,b as uo,c as Dt,d as st,e as Ut,n as St,u as ho,v as mo,w as fo,x as go}from"./chunk-6B5XFA6F.js";import{d as Vt,f as eo}from"./chunk-OLOKUDVI.js";import{a as O,c as oo,i as pe}from"./chunk-BOVYXYHK.js";import{a as io}from"./chunk-JGEVVXD4.js";import{p as rt,q as so}from"./chunk-B3FO6PT7.js";import{i as ro,l as ce,m as no}from"./chunk-C4UMJHQC.js";import{a as Et}from"./chunk-BCREO4Q5.js";import{a as z,d as ae,h as Ne,j as ot}from"./chunk-MWSXMSWY.js";import{f as We}from"./chunk-JRCKELO6.js";import{c as se}from"./chunk-YR2HD3ZC.js";import{a as et}from"./chunk-GJASVPF6.js";import{j as $e,k as to,n as P}from"./chunk-Z5Q7KLA4.js";import{a as it}from"./chunk-4XZ6X7MQ.js";import{B as le,J as je,Q as Be,da as Ye,fa as _t,ha as Tt,ia as Ke,k as qe,la as Xe,ma as Je,oa as Qe}from"./chunk-KGVXGH6H.js";import{D as ne,H as l,J as tt}from"./chunk-QHVIRF5H.js";import{I as _}from"./chunk-WZDN6K3C.js";import{a}from"./chunk-QGVBCWUY.js";import{E as re,b as H,g as Le,j as xt}from"./chunk-CKJ56T2Q.js";import{b as wt}from"./chunk-UHRSAPGQ.js";import{h as Ze,w as $}from"./chunk-V76GWARL.js";import{a as F,b as N}from"./chunk-N2WTMF3X.js";var M;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(M||(M={}));var D;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(D||(D={}));var qt={[D.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[D.UndoInvalidError]:"There are no items to Undo",[D.RedoInvalidError]:"There are no items to Redo",[D.ApplyInvalidError]:"Cannot apply an item that is already applied"},L=class extends Error{constructor(){super(qt[D.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},Y=class extends Error{constructor(){super(qt[D.UndoInvalidError]),this.type="undo-redo-undo-error"}},Pt=class extends Error{constructor(){super(qt[D.RedoInvalidError]),this.type="undo-redo-redo-error"}},Nt=class extends Error{constructor(){super(qt[D.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var U;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(U||(U={}));var jt=class extends tt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=M.NeverApplied}get canUndo(){return this.status===M.Applied}get canRedo(){return this.status===M.Undone}async executeUndoRedoOperation(t){switch(t){case U.Apply:if(this.status!==M.NeverApplied)throw new Nt;return await this.apply(),void(this.status=M.Applied);case U.Undo:if(this.status!==M.Applied)throw new Y;return await this.undo(),void(this.status=M.Undone);case U.Redo:if(this.status!==M.Undone)throw new Y;return await this.redo(),void(this.status=M.Applied)}}};a([l()],jt.prototype,"name",void 0),a([l()],jt.prototype,"tag",void 0),jt=a([_("esri.undoredo.UndoableOperation")],jt);var k=class extends tt{constructor(){super(...arguments),this._stack=new se,this._stackPosition=-1,this._updatingHandles=new Gt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Y;if(this.updating)throw new L;let t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(U.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Pt;if(this.updating)throw new L;let t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Pt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(U.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new L;await this._updatingHandles.addPromise((async()=>{t.status===M.NeverApplied&&await t.executeUndoRedoOperation(U.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new L;await this._updatingHandles.addPromise((async()=>{t.status===M.NeverApplied&&await t.executeUndoRedoOperation(U.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await ae(()=>!this.updating);let o=new se;for(let i=0;i<this._stack.length;i++){let r=this._stack.getItemAt(i);r&&(r.tag===t?(r.destroy(),i===this._stackPosition&&(this._stackPosition=o.length-1)):o.push(r))}this._stack=o,this._stackPosition>o.length-1&&(this._stackPosition=o.length-1)}async clear(t=!1){if(this.updating&&!t)throw new L;await ae(()=>!this.updating),this._drainStack()}};a([l()],k.prototype,"_stack",void 0),a([l()],k.prototype,"_stackPosition",void 0),a([l()],k.prototype,"updating",null),a([l({readOnly:!0})],k.prototype,"canUndo",null),a([l({readOnly:!0})],k.prototype,"hasUndo",null),a([l({readOnly:!0})],k.prototype,"canRedo",null),a([l({readOnly:!0})],k.prototype,"hasRedo",null),k=a([_("esri.UndoRedo")],k);var Bt=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var Pe,W=Pe=class extends rt{constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){let t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,this.rings.length!==0||!t)return;let o=Be(this.radius,this.radiusUnit,"meters"),i=t.spatialReference,r,n="geographic";if(i.isWebMercator?n="webMercator":((i.wkid&&qe[i.wkid])!=null||(i.wkt2||i.wkt)&&Qe(i.wkt2||i.wkt))&&(n="projected"),this.geodesic){let s;switch(n){case"webMercator":s=to(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=t}r=this._createGeodesicCircle(s,o,e),n==="webMercator"&&(r=$e(r))}else{let s;n==="webMercator"||n==="projected"?s=o/Ke(t.spatialReference):n==="geographic"&&(s=Ye(o,"meters",je(t.spatialReference).radius)),r=this._createPlanarCircle(t,s,e)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){let{center:t,numberOfPoints:e,radius:o,radiusUnit:i,geodesic:r}=this;return new Pe({center:t?.clone(),numberOfPoints:e,radius:o,radiusUnit:i,geodesic:r})}_createGeodesicCircle(t,e,o){let i=[],r=[t.x,t.y];for(let n=0;n<360;n+=360/o){let s=this.hasZ?[0,0,t.z??0]:[0,0];Go(s,r,n,e,it.WGS84),i.push(s)}return i.push(i[0]),new rt({rings:[i]})}_createPlanarCircle(t,e,o){let i=[],r=2*Math.PI/o;for(let n=0;n<o;++n){let s=r*n,c=[t.x+Math.cos(-s)*e,t.y+Math.sin(-s)*e];this.hasZ&&c.push(t.z??0),i.push(c)}return i.push(i[0]),new rt({spatialReference:t.spatialReference,rings:[i]})}};a([l({type:P})],W.prototype,"center",void 0),a([l()],W.prototype,"geodesic",void 0),a([l()],W.prototype,"numberOfPoints",void 0),a([l()],W.prototype,"radius",void 0),a([l()],W.prototype,"radiusUnit",void 0),W=Pe=a([_("esri.geometry.Circle")],W);var vi=W;function Yt(t,e,o=null){return o!=null?[t,e,o]:[t,e]}function v(t,e,o=null){return o!=null?{x:t,y:e,z:o}:{x:t,y:e}}var Kt=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(o=>this.mapToLocal(o)).filter($)}get doUnnormalization(){return!1}},Ie=class extends Kt{constructor(e,o,i=null){super(o),this._defaultZ=i,this.transform=we(),this.transformInv=we(),this.transform=Do(e),vo(this.transformInv,this.transform)}makeMapPoint(e,o){return Yt(e,o,this._defaultZ)}mapToLocal(e){return v(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return Yt(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},ke=class extends Kt{constructor(e,o){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=O(),this.tangentFrameUpWS=O(),this.tangentFrameRightWS=O(),this.tangentFrameForwardWS=O(),this.localFrameRightWS=O(),this.localFrameUpWS=O(),this.worldToLocalTransform=ge(),this.localToWorldTransform=ge(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=o,this.defaultZ=o.hasZ?o.z:null;let i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Et.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Et.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Et.Z,this.tangentFrameForwardWS);let r=O();St(r,this.tangentFrameForwardWS,mo(i,this.tangentFrameForwardWS)),Ut(this.localFrameRightWS,i,r),ho(this.localFrameRightWS,this.localFrameRightWS),fo(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),_o(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),xo(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,o){return Yt(e,o,this.defaultZ)}mapToLocal(e){let o=O();this.view.renderCoordsHelper.toRenderCoords(new P({x:e[0],y:e[1],spatialReference:this.spatialReference}),o),me(o,o,this.worldToLocalTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(o,new P({spatialReference:this.view.spatialReference}));return i!=null?v(i.x/this.scale,i.y/this.scale):null}localToMap(e){let o=O();this.view.renderCoordsHelper.toRenderCoords(new P({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),o),me(o,o,this.localToWorldTransform);let i=this.view.renderCoordsHelper.fromRenderCoords(o,new P({spatialReference:this.view.spatialReference}));return i!=null?Yt(i.x,i.y,this.defaultZ):null}};function wi(t,e){if(t.type==="2d")return new Ie(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){let o=e.length>2?new P({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new P({x:e[0],y:e[1],spatialReference:t.spatialReference});return new ke(t,o)}return null}function K(t,e){let o=new P({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(o.z=t[2]),o}function xi(t,e){return new io({points:t,spatialReference:e})}function Re(t,e,o){let i=new so({paths:t,spatialReference:e});return o&&ce(i),i}function ut(t,e,o,i=!0){let r=wt(t);r.forEach(s=>{let c=s[0],p=s[s.length-1];Ze(c,p)&&s.length!==1||s.push(s[0])});let n=new rt({rings:r,spatialReference:e});return n.rings.forEach(s=>{ro(s)||s.reverse()}),o&&ce(n),i&&n.isSelfIntersecting&&le(e)&&(n=bo(n)),n}function Ve(t,e,o){let i=e.mapToLocalMultiple(t),r=[],n={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y},c=Math.round(s.x-n.x),p=Math.round(s.y-n.y),d=Math.max(Math.abs(c),Math.abs(p));if(o){let u={x:n.x+d,y:n.y+d},f={x:n.x-d,y:n.y-d};r.push(v(u.x,f.y),v(f.x,f.y),v(f.x,u.y),v(u.x,u.y))}else{let u={x:c>0?n.x+d:n.x-d,y:p>0?n.y+d:n.y-d};r.push(v(n.x,n.y),v(u.x,n.y),v(u.x,u.y),v(n.x,u.y))}return Ti(ut([r.map(u=>e.localToMap(u)).filter($)],e.spatialReference,e.doUnnormalization,!0),r,e)}function _i(t,e,o){let i=e.mapToLocalMultiple(t);if(i.length===1){let p=i[0];i=[v(p.x-48,p.y+48),v(p.x+48,p.y-48),v(p.x+48,p.y-48),v(p.x-48,p.y+48)]}let r=[],n={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(o){let c=Math.round(s.x-n.x),p=Math.round(s.y-n.y);r.push(v(n.x-c,n.y-p),v(s.x,n.y-p),v(s.x,s.y),v(n.x-c,s.y))}else r.push(v(n.x,n.y),v(s.x,n.y),v(s.x,s.y),v(n.x,s.y));return Ti(ut([r.map(c=>e.localToMap(c)).filter($)],e.spatialReference,e.doUnnormalization,!0),r,e)}function Ti(t,e,o){let i=Xt(e[3],e[2],o),r=Xt(e[1],e[2],o),n=Xt(e[0],e[1],o),s=Xt(e[0],e[3],o);return{geometry:t,midpoints:i!=null&&r!=null&&n!=null&&s!=null?{top:i,right:r,bottom:n,left:s}:null}}function Xt(t,e,o){ct[0]=t.x,ct[1]=t.y,ct[2]=0,dt[0]=e.x,dt[1]=e.y,dt[2]=0,go(ct,ct,dt,.5),Jt.x=ct[0],Jt.y=dt[1],Jt.z=dt[2];let i=o.localToMap(Jt);return i!=null?K(i,o.spatialReference):null}var Jt=v(0,0,0),ct=O(),dt=O();function Ee(t,e,o,i){let r=e.mapToLocalMultiple(t),n=null,s=null;if(o)n=r[0],s=r[1];else{let w=r[0],y=r[1],S=Math.round(y.x-w.x),T=Math.round(y.y-w.y),b=Math.max(Math.abs(S),Math.abs(T));n=v(S>0?w.x+b/2:w.x-b/2,T>0?w.y+b/2:w.y-b/2),s=v(Math.abs(S)>Math.abs(T)?n.x-b/2:n.x,Math.abs(S)>Math.abs(T)?n.y:n.y-b/2)}let c=e.localToMap(n),p=e.localToMap(s);if(c==null||p==null)return null;e.doUnnormalization&&no([[c,p]],e.spatialReference);let d=K(c,e.spatialReference),u=K(p,e.spatialReference),f=Tt(e.spatialReference),x=0;if(le(e.spatialReference))x=f*So(d,u,null);else{let w=n.x-s.x,y=n.y-s.y;x=f*Math.sqrt(w*w+y*y)*(i||1)}let h=new vi({center:d,radius:x,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:ut(h.rings,h.spatialReference,!1),center:d,edge:u}}function Si(t,e,o){let i=e.mapToLocalMultiple(t),r=i[0],n=i[1],s=Math.round(n.x-r.x),c=Math.round(n.y-r.y),p=v(o?r.x:r.x+s/2,o?r.y:r.y+c/2),d=o?s:s/2,u=o?c:c/2,f=60,x=[],h=2*Math.PI/f;function w(V){let Ki=Math.cos(V),Xi=Math.sin(V);return v(d*Ki+p.x,u*Xi+p.y)}for(let V=0;V<f;V++)x.push(w(V*h));x.push(x[0]);let{spatialReference:y,doUnnormalization:S}=e,T=ut([x.map(V=>e.localToMap(V)).filter($)],y,S,!1),b=e.localToMap(w(Math.PI/2)),yt=e.localToMap(w(0)),vt=e.localToMap(w(-Math.PI/2)),Rt=e.localToMap(w(Math.PI));return{geometry:T,midpoints:b!=null&&yt!=null&&vt!=null&&Rt!=null?{top:K(b,y),right:K(yt,y),bottom:K(vt,y),left:K(Rt,y)}:null}}function X(t,e,o){if(t==null)return"noTool";switch(t){case"point":return Ji();case"multipoint":return"multipoint";case"polyline":return Qi(e,o);case"polygon":return $i(e,o);case"rectangle":case"circle":return tr(e,o);default:return}}function Ji(t){return"point"}function Qi(t,e){let o=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?o<2?"freehandStart":"freehandEnd":o<2?"polylineZeroVertices":"polylineOneVertex"}function $i(t,e){let o=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(o<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(o<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function tr(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function bi(t,e){let o=t?.geometry;if(!t||o?.type!=="mesh"||!e)return;let{renderCoordsHelper:i,elevationProvider:r}=e,{camera:n}=e.state,{extent:s}=o,{center:c,spatialReference:p}=s,d=Tt(p),u=_t(p),f=Tt(i.spatialReference),x=s.width*d,h=s.height*u,w=(s.zmax??0)*u,y=w-(s.zmin??0)*u,S=Math.max(x,h,y)/f,{x:T,y:b}=c,yt=c.z??0;Dt(Qt,T,b,yt),i.toRenderCoords(Qt,p,Qt);let vt=S/n.computeScreenPixelSizeAt(Qt);if(vt>n.width*or)return"meshTooClose";if(vt<er)return"meshTooFar";let Rt=Co(t),{absoluteZ:V}=Io(T,b,w,p,e,Rt);return V<(r.getElevation(T,b,yt,p,"ground")??0)*u+y*ir?"meshUnderground":"mesh"}var er=20,or=1,ir=.1,Qt=O();function Mi(t,e,o,i,r,n){let s="geodesic",c=Ao(o),p=q();return zt(t,e,i,p),p[2]=0,c&&Ot(p,o,p,c)||(s="euclidean",c=o),{mode:s,view:e,elevationInfo:i,hasZ:r,directionMode:n,spatialReference:t.spatialReference,measurementSR:c,origin:p}}function rr(t,e,o){if(e==null||t==null)return;let i=Xe(o.measurementSR);if(i==null)return;let r=kt(t,o);if(r==null)return;let n=pt(e,i);return new Zo(r,n)}function nr(t,e,o,i){if(o==null||t==null)return;let r=kt(t,i);if(r==null)return;let n=B(o),s=10,c=d=>{if(d==null)return;let u=q(),f=Vo(d,"degrees","geographic");return Bo(u,r,i.measurementSR,s,f,i.mode)?new Wo(r,u):void 0},p=()=>{if(e!=null&&t!=null)return B(Te(e,t))};switch(i.directionMode){case j.Absolute:return c(n);case j.Relative:{let d=p();return d==null?void 0:c(d+n)}case j.RelativeBilateral:{let d=p();return d==null?void 0:_e([c(d+n),c(d-n)])}}}function Ci(t,e){let o=te(t,e);return o!=null?new Lo(o):void 0}function Pi(t,e,o){let{context:i,longitude:r,latitude:n,direction:s,distance:c,elevation:p}=o;if(r!=null||n!=null||c!=null||p!=null||s!=null){if(r!=null||n!=null){let d=B(r),u=B(n),f=te(p,i);return new xe(d,u,f)}return sr(t,e,o)}}function sr(t,e,{context:o,direction:i,distance:r,elevation:n}){if(e==null)return Ci(n,o);let{view:s,elevationInfo:c,measurementSR:p}=o,d=zt(e,s,c);if(!p||!Ot(d,e.spatialReference,Oi,p))return;let[u,f]=Oi,x=r!=null?pt(r,"meters"):void 0,h=B(i),w=te(n,o),y=T=>{let b=new No([u,f],p,x,w,T);return x==null||T==null||w==null&&o.hasZ?b:new zo(b.closestTo(d))};if(h==null)return y(void 0);let S=()=>{if(t!=null&&e!=null)return B(Te(t,e))};switch(o.directionMode){case j.Absolute:return y(h);case j.Relative:{let T=S();return T==null?void 0:y(T+h)}case j.RelativeBilateral:{let T=S();return T==null?void 0:_e([y(T+h),y(T-h)])}}}function Ii(t){return t.context.mode==="geodesic"?Pi(null,null,t):Ri(t)}function ki(t,e,o){let{context:i,x:r,y:n,distance:s,direction:c,elevation:p}=o;return i.mode==="geodesic"?Pi(e,t,o):r!=null||n!=null?Ri(o):ar([rr(t,s,i),nr(t,e,c,i),Ci(p,i)])}function Ri({x:t,y:e,elevation:o,context:i}){$t.x=t?.value??0,$t.y=e?.value??0,$t.spatialReference=i.spatialReference;let r=kt($t,i,pr);return new xe(t!=null&&r!=null?r[0]:void 0,e!=null&&r!=null?r[1]:void 0,te(o,i))}function ar(t){let e;for(let o of t)o&&(e=e?.intersect(o)??o);return e}function kt(t,e,o=q()){let{view:i,elevationInfo:r,measurementSR:n,origin:s,mode:c}=e;if(zt(t,i,r,o),Ot(o,t.spatialReference,o,n))return c!=="geodesic"&&Ut(o,o,s),o}function Vi(t,e,o,i){let{view:r,measurementSR:n,spatialReference:s,origin:c,mode:p}=o;if(p==="geodesic"?uo(It,t):st(It,t,c),Ot(It,n,It,s))return Fo(It,r,e,o,i)}function te(t,e){return lr(t,e)?.value??void 0}function lr(t,{view:e,origin:o,elevationInfo:i,hasZ:r,measurementSR:n}){if(t==null||!r)return;let s=Je(n);if(s==null)return;let[c,p]=o,d=pt(t,s),u=e?.type==="3d"?Ft(e,c,p,d,n,i):d;return u!=null?Ht(u,s):void 0}var Oi=q(),pr=q(),It=q(),$t=bt(0,0,0,it.WGS84);var R=class extends C{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Z}get allFields(){return[]}};a([l()],R.prototype,"type",void 0),a([l()],R.prototype,"radius",void 0),a([l()],R.prototype,"xSize",void 0),a([l()],R.prototype,"ySize",void 0),a([l()],R.prototype,"area",void 0),a([l()],R.prototype,"helpMessage",void 0),a([l()],R.prototype,"allFields",null),R=a([_("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],R);var ht=class extends E(C){constructor(t){super(t),this.type="draw-mesh",this.orientation=$o({lockable:!1}),this.scale=ti({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([l()],ht.prototype,"helpMessage",void 0),a([l()],ht.prototype,"allFields",null),ht=a([_("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],ht);var mt=class extends E(C){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],mt.prototype,"helpMessage",void 0),a([l()],mt.prototype,"allFields",null),mt=a([_("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],mt);var ft=class extends E(C){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],ft.prototype,"helpMessage",void 0),a([l()],ft.prototype,"allFields",null),ft=a([_("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ft);var J=class extends E(C){constructor(t){super(t),this.type="draw-polygon",this.direction=Zt(),this.distance=Lt(),this.area=ei(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([l()],J.prototype,"xyMode",void 0),a([l()],J.prototype,"helpMessage",void 0),a([l()],J.prototype,"allFields",null),J=a([_("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],J);var Q=class extends E(C){constructor(t){super(t),this.type="draw-polyline",this.direction=Zt(),this.distance=Lt(),this.totalLength=Qo(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([l()],Q.prototype,"helpMessage",void 0),a([l()],Q.prototype,"xyMode",void 0),a([l()],Q.prototype,"allFields",null),Q=a([_("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Q);var G=class extends C{constructor(t){super(t),this.type="draw-rectangle",this.xSize=A,this.ySize=A,this.area=Z}get allFields(){return[]}};a([l()],G.prototype,"type",void 0),a([l()],G.prototype,"xSize",void 0),a([l()],G.prototype,"ySize",void 0),a([l()],G.prototype,"area",void 0),a([l()],G.prototype,"helpMessage",void 0),a([l()],G.prototype,"allFields",null),G=a([_("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],G);function Ei(t,e){return{point:new ft({sketchOptions:e,viewType:t}),multipoint:new mt({sketchOptions:e,viewType:t}),polyline:new Q({sketchOptions:e,viewType:t}),polygon:new J({sketchOptions:e,viewType:t}),mesh:new ht({sketchOptions:e,viewType:t}),rectangle:new G({sketchOptions:e}),circle:new R({sketchOptions:e})}}function De(t){let{directionOptions:e,geometryType:o,sketchOptions:i,tooltipInfos:r}=t,n=c=>{let p=oe(t).mode,d=r[c].elevation;p==="relative-to-ground"||p==="relative-to-scene"||p==="on-the-ground"?d.lock(Ae(t)):d.unlock()},s=c=>{if(e){let p=r[c].direction;p.committed=e.angle,p.unlockOnVertexPlacement=!1,i.values.directionMode=e.mode}};switch(o){case"polygon":case"polyline":n(o),s(o);break;case"point":case"mesh":n(o)}}function Di(t,e){let{drawOperation:o,view:i}=e,r=ee(e),n=oe(e);if(i.type==="2d"||!t||n.mode!=="absolute-height"||o?.numCommittedVertices!==1||!r||r.type!=="draw-polyline"&&r.type!=="draw-polygon"||r.elevation.locked)return;let[s,c,p]=t,d=xr(s,c,p,n,e);d!=null&&r.elevation.lock(d)}function Ue(t){ee(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function ee({geometryType:t,graphic:e,tooltipInfos:o}){return e?.geometry?.type!==cr[t]?t==="circle"||t==="rectangle"?o[t]:null:o[t]}var cr={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Ui(t,e){switch(t?.type){case"draw-point":dr(t,e);break;case"draw-multipoint":ur(t,e);break;case"draw-polyline":mr(t,e);break;case"draw-polygon":fr(t,e);break;case"draw-rectangle":yr(t,e);break;case"draw-circle":vr(t,e);break;case"draw-mesh":hr(t,e)}}function dr(t,e){let o=e.graphic?.geometry;o?.type==="point"&&(Ge(t,o,e),t.helpMessage=X("point",o,e.drawOperation.drawingMode))}function ur(t,e){let o=e.graphic?.geometry;o?.type==="multipoint"&&(Ge(t,o,e),t.helpMessage=X("multipoint",o,e.drawOperation.drawingMode))}function hr(t,e){let{graphic:o,view:i}=e,r=o?.geometry;i.type!=="3d"||r&&r.type!=="mesh"||(Ge(t,r?.origin,e),r&&Ko(t,r),t.helpMessage=bi(o,i))}function Ge(t,e,o){let{drawOperation:i,view:r,sketchOptions:n}=o,{cursorVertex:s}=i;t.sketchOptions=n,t.viewType=r.type;let c=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(c,gt(o)),Ai(t.elevation,o),!s)return void(i.constraints=void 0);let p=s;i.constraints={context:Li(p,o),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function mr(t,e){let{createOperationGeometry:o,drawOperation:i}=e,r=o!=null?o.full:null;r&&r.type!=="polyline"||(Gi(t,e),t.totalLength.actual=i.lastVertex?(r?ri(r):null)??A:null,t.helpMessage=X("polyline",r,e.drawOperation.drawingMode))}function fr(t,e){let{createOperationGeometry:o,drawOperation:i}=e,r=o!=null?o.full:null;r&&r.type!=="polygon"||(Gi(t,e),t.area.actual=i.lastVertex?(r?be(r):null)??Z:null,t.helpMessage=X("polygon",r,e.drawOperation.drawingMode))}function Gi(t,e){let{drawOperation:o,sketchOptions:i,view:r}=e,{cursorVertex:n,lastVertex:s,secondToLastVertex:c}=o,p=i.values.effectiveDirectionMode;t.sketchOptions=i,t.viewType=r.type;let d=s&&n?Ct(s,n)??A:null;if(t.distance.actual=d,t.distance.readOnly=s==null,t.direction.actual=null,t.direction.readOnly=!0,s&&n&&(p==="absolute"||c)){let x=jo(c,s,n,p);t.direction.actual=x??Eo,t.direction.readOnly=!1}t.setLocationFromPoint(n,gt(e)),Ai(t.elevation,e);let u=gr(s,e);t.xyMode=u,t.direction.visible=u==="direction-distance",t.distance.visible=u==="direction-distance",t.effectiveX.visible=u==="coordinates",t.effectiveY.visible=u==="coordinates";let f=n??s;o.constraints=f?{context:Li(f,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function gr(t,{sketchOptions:e}){let o=e.tooltips.xyMode;return o==="auto"?t?"direction-distance":"coordinates":o}function yr(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Hi(e),t.ySize=zi(e),t.area=Fi(e),t.helpMessage=X("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function vr(t,e){let{forceUniformSize:o,sketchOptions:i}=e;t.sketchOptions=i,t.radius=o?wr(e):null,t.xSize=o?null:Hi(e),t.ySize=o?null:zi(e),t.area=Fi(e),t.helpMessage=X("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Ai(t,e){let{drawOperation:o}=e,i=o?.cursorVertex??o?.lastVertex;t.actual=oi(i)??Ae(e),t.visible=o.hasZ,t.readOnly=!1,t.showAsZ=!0}function Fi(t){let e=t.createOperationGeometry?.full;return e?.type!=="polygon"?Z:be(e)??Z}function Hi(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?Ct(e.left,e.right):null)??A}function zi(t){let e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?Ct(e.top,e.bottom):null)??A}function wr({createOperationGeometry:t}){return(t?.circle?.center!=null&&t.circle.edge!=null?Ct(t.circle.center,t.circle.edge):null)??A}function Zi(t){let{geometryType:e,tooltipInfos:o}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{let i=o[e].elevation.committed;return i?pt(i,"meters")/_t(gt(t)):void 0}default:return}}function xr(t,e,o,i,r){let{view:n,drawOperation:s}=r;if(n.type!=="3d"||!s)return;o??=0;let c=gt(r),p=oe(r),d=Ft(n,t,e,o,c,p,i);return ii(d,c)??Ae(r)}function oe(t){return t.drawOperation.elevationInfo??ko}function gt(t){return t.drawOperation.coordinateHelper.spatialReference}function Ae(t){let e=_t(gt(t));return Ht(t.defaultZ*e,"meters")}function Li(t,e){return Mi(t,e.view,gt(e),oe(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var g=class extends et.EventedMixin(ni){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Me}initialize(){let{view:t}=this;this.internalGraphicsLayer=new Ro({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);let e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Ei(t.type,this.sketchOptions);let o=Yo(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=o,De(this._tooltipsContext),this._coordinateFormatterLoadTask=We(()=>Ho()),this.addHandles([e.on("vertex-add",i=>this.onVertexAdd(i)),e.on("vertex-remove",i=>this.onVertexRemove(i)),e.on("vertex-update",i=>this.onVertexUpdate(i)),e.on("cursor-update",i=>this.onCursorUpdate(i)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",i=>this.onComplete(i)),this._coordinateFormatterLoadTask,o.on("paste",i=>Jo(i,this.activeTooltipInfo)),z(()=>this.cursor,i=>{e.cursor=i},ot),ne(()=>{let{activeTooltipInfo:i,sketchOptions:r}=this;Ui(i,this._tooltipsContext),o.info=r.tooltips.effectiveEnabled?i:null}),ne(()=>{e.constraintZ=Zi(this._tooltipsContext)},Ne)]),this.finishToolCreation()}destroy(){this.drawOperation=H(this.drawOperation),this.tooltip=H(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=H(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){let e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof k?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Xo(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&De(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(I.outline),this.removeHandles(I.regularVertices),this.removeHandles(I.activeVertex),this.removeHandles(I.activeEdge),this.removeHandles(Fe)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;let e=new wo(N(F({},this.graphicProperties),{symbol:this.graphicSymbol}));return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(xt(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),Fe),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:e,view:o,visualizationCursorVertex:i,lastVertex:r,committedVertices:n,geometryIncludingUncommittedVertices:s,numCommittedVertices:c}=this.drawOperation;if(!(c>0||i!=null))return;let p=t.operationComplete?n:s,d=p.length,u=i!=null?e.pointToArray(i):null,f=this._drawSpatialReference,x=o.type==="3d"&&o.viewingMode==="global",h=new Bt;h.committedVertices=n,h.cursorVertex=u;let{geometryType:w}=this;switch(w){case"point":case"mesh":h.full=e.arrayToPoint(p[0]);break;case"multipoint":h.full=d>0?xi(p,f):null;break;case"polyline":case"polygon":d>0&&(h.full=w==="polygon"?ut([p],f,x,!0):Re([p],f,x),h.cursorEdge=u!=null&&r&&!at(i,r)?Re([[u,e.pointToArray(r)]],f,x):null,h.outline=d>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!d)break;let y=wi(o,p[0]),S=p[0],T=y.makeMapPoint(S[0]+_r*o.resolution,S[1]);w==="circle"?d===1&&t.operationComplete?h.circle=Ee([S,T],y,!0):d===2&&(this.forceUniformSize?h.circle=Ee(p,y,this.centered):h.rectangle=Si(p,y,this.centered)):d===1&&t.operationComplete?h.rectangle=Ve([S,T],y,!0):d===2&&(h.rectangle=this.forceUniformSize?Ve(p,y,this.centered):_i(p,y,this.centered)),h.full=h.circle!=null?h.circle.geometry:h.rectangle?.geometry,h.outline=h.full?.type==="polygon"?h.full:null;break}default:return null}return h}initializeGraphic(t){return xt()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){let o=this._getCreateOperationGeometry({operationComplete:!0});o!=null&&(e=this._createOrUpdateGraphic(o.full))}this._createOperationGeometry=null,this.emit("complete",F({graphic:e},t))}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){let{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return xt()}onCursorEdgeChanged(t){return xt()}onVertexAdd(t){Ue(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Di(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Ue(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){let t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),I.activeEdge):this.removeHandles(I.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),I.outline):this.removeHandles(I.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),I.regularVertices):this.removeHandles(I.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),I.activeVertex):this.removeHandles(I.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(Fe)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?ee(this._tooltipsContext):null}};a([l()],g.prototype,"_coordinateFormatterLoadTask",void 0),a([l()],g.prototype,"_createOperationGeometry",void 0),a([l()],g.prototype,"_tooltipsContext",null),a([l({value:!0})],g.prototype,"centered",null),a([l()],g.prototype,"cursor",null),a([l({nonNullable:!0})],g.prototype,"defaultZ",void 0),a([l({constructOnly:!0})],g.prototype,"directionOptions",void 0),a([l()],g.prototype,"drawOperation",void 0),a([l()],g.prototype,"elevationLockOnVertexAddDisabled",void 0),a([l({value:!0})],g.prototype,"enabled",null),a([l({value:!0})],g.prototype,"forceUniformSize",null),a([l({constructOnly:!0})],g.prototype,"geometryType",void 0),a([l()],g.prototype,"graphic",null),a([l({constructOnly:!0})],g.prototype,"graphicProperties",void 0),a([l()],g.prototype,"graphicSymbol",null),a([l({constructOnly:!0})],g.prototype,"hasZ",void 0),a([l({constructOnly:!0})],g.prototype,"geometryToPlace",void 0),a([l()],g.prototype,"mode",null),a([l()],g.prototype,"snappingManager",void 0),a([l()],g.prototype,"snapToScene",void 0),a([l()],g.prototype,"tooltip",void 0),a([l()],g.prototype,"tooltipInfos",void 0),a([l({constructOnly:!0,type:Me})],g.prototype,"sketchOptions",void 0),a([l()],g.prototype,"updating",null),a([l({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0),a([l({constructOnly:!0})],g.prototype,"undoRedo",null),a([l()],g.prototype,"activeTooltipInfo",null),g=a([_("esri.views.draw.DrawGraphicTool")],g);var Fe=Symbol("create-operation-graphic"),I={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function yl(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}var _r=48;var He="click";var ie=class{constructor({consumesClicks:e,grabbableForEvent:o}){this.events=new et,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=o}destroy(){}intersectionDistance(e,o){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var Tr="crosshair",Sr="progress",Wi=Symbol(),Ni=Symbol(),m=class extends et.EventedMixin(tt){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Uo,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Gt,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Se(Ii),this._getPolylineOrPolygonConstraint=Se(ki),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Oe,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Mo(!!t.hasZ))}initialize(){let{geometryType:t,view:e}=this,o=e.spatialReference,i="viewingMode"in e.state?e.state.viewingMode:To.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=si(this.hasZ,this.hasM,o),this._editGeometryOperations=new hi(new li(r,this.coordinateHelper),i),this._snappingOperation=new gi({view:e}),this.addHandles([z(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:p},d)=>{let{snappingOptions:u}=this;if(u&&(u.forceDisabled=p!=null&&qo(p)),d!=null&&c===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,p)=>c.stagedPoint===p.stagedPoint&&Le(c.constraint,p.constraint)}),z(()=>this.view.viewpoint,(c,p)=>{c&&p&&yo(c,p)&&this._onKeyboardBasedChange()})]),this._activeComponent=new ai(o,i),this._editGeometryOperations.data.components.push(this._activeComponent);let n=this.segmentLabels;n!=null&&(n.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(z(()=>this.labelOptions.enabled,c=>{n.visible=c},ot))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{let p=c.vertices.map(h=>({componentIndex:0,vertexIndex:h.index,coordinates:this.coordinateHelper.vectorToArray(h.pos)})),d=p.map(h=>h.coordinates),u=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;at(u,this.firstVertex)||(this.firstVertex=u);let f=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;at(f,this.lastVertex)||(this.lastVertex=f);let x=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(at(x,this.secondToLastVertex)||(this.secondToLastVertex=x),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,N(F({},c),{added:d,vertices:p}));break;case"vertex-update":this.emit(c.type,N(F({},c),{updated:d,vertices:p}));break;case"vertex-remove":this.emit(c.type,N(F({},c),{removed:d,vertices:p}))}}));let s=this._manipulator=new ie({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(s),s.grabbable=t!=="point"&&t!=="multipoint",this.addHandles([s.events.on("immediate-click",c=>this._onImmediateClick(c)),s.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),z(()=>this.drawingMode,()=>{this.removeHandles(Wi),this.addHandles(this._createManipulatorDragPipeline(s),Wi)},ot),z(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{s.cursor=c},ot)]),yi(this,()=>{let c=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(c);if(this.snappingManager!=null){let d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(re(d))}})}destroy(){H(this.segmentLabels),H(this._snappingOperation),this._editGeometryOperations=H(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){let{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??He)}get effectiveCursor(){return this.loading?Sr:this._hideDefaultCursor?null:this.cursor||Tr}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){let{cursorVertex:t,lastVertex:e,firstVertex:o,geometryType:i}=this;return i==="polygon"&&At(t,o)||At(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:t,committableVertex:e,coordinateHelper:o}=this,i=t.slice();return e!=null&&i.push(o.pointToArray(e)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){let e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:o,numCommittedVertices:i}=this,r=o==="multipoint"&&i===0||o==="polyline"&&i<2||o==="polygon"&&i<3;o!=="segment"&&o!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((n,s)=>({componentIndex:0,vertexIndex:s,coordinates:n})),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){let e=wt(this.cursorVertex),o=wt(t),i=o&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(o)??o),r=this._snapToClosingVertex(i),n=this._applyConstraints(r);At(e,n)||(this._set("cursorVertex",n),this.segmentLabels?.set("stagedVertex",n!=null?this.coordinateHelper.pointToVector(n):null),n==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(n)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;let e=this._mapToScreen(t);if(!e)return t;let o=this._activeComponent;return this._vertexWithinPointerDistance(o.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(o.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return Wt(t,(e,o,i,r)=>{let n=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!n)return;let{snappingStep:s,cancelSnapping:c}=fi({predicate:()=>n,snappingManager:this.snappingManager,snappingContext:new Ce({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next(p=>(n&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p)).next(c),o.next(this._screenToMapDragEventStep()).next(p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||n&&!this.numCommittedVertices)&&this.commitStagedVertex()),p)).next(mi(this.view,this.elevationInfo)).next(...s).next(p=>(n&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p)).next(p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p))})}_createManipulatorDragPipelineFreehand(t){return Wt(t,(e,o)=>{this.isCompleted||o.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(i.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return i})})}_createManipulatorDragPipelineHybrid(t){return Wt(t,(e,o)=>{this.isCompleted||o.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Ni),this._processCursor(i.mapStart),this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Ni),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return i})})}get _drawAtFixedElevation(){let{constraintsEnabled:t,constraintZ:e,geometryType:o,numCommittedVertices:i}=this;return t?e!=null||o==="segment"&&i>0:(o==="segment"||o==="polygon")&&i>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:t,coordinateHelper:e,drawSurface:o,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(i==null)return o;if(!this.hasZ)return i.defaultZ=null,i;let n=this.elevationInfo?.mode,s=this.defaultZ,c=t||n==="absolute-height";return r!=null&&(c=r),n==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(s=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),c=!1),c?o:(i.defaultZ=s,i)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{let{drawingMode:e,geometryType:o}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;let i=this._screenToMap(t.screenPoint);if(i==null||i==null||e==="freehand"&&o!=="point"&&o!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(i),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"&&this.geometryType!=="multipoint"||o==="point"||o==="segment"&&this.numCommittedVertices===2||o==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){let e=Vt(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){let o=this._snappingOperation,i=this._screenToMap(t),r=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(i==null)return this._hideDefaultCursor=!0,this._processCursor(null),void o.abort();this._hideDefaultCursor=!1;let n=this.snappingManager;if(n==null)return this._processCursor(i),void o.abort();let s=this._getSnappingContext(e);this._updatingHandles.addPromise(re(o.snap({point:i,scenePoint:r},n,s)))}_applyConstraints(t){let{_constraint:e,constraints:o}=this;if(!t||!o||!e)return t;let{context:i}=o,r=kt(t,i),n=r?e.closestTo(r):void 0;if(!n)return t;let s=Vi(n,t,i),c=this.view.type==="2d"||i.elevationInfo.mode!=="absolute-height";return s!=null&&c&&this.constraintZ!=null&&this.hasZ&&(s.z=this.constraintZ),s}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;let o=this._screenToMap(e.screenEnd);return o!=null?N(F({},e),{mapStart:t,mapEnd:o}):null}}_vertexWithinPointerDistance(t,e){let i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return i!=null&&br(i,e,25)}_getSnappingContext(t){let e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Ce({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function br(t,e,o){let i=t.x-e.x,r=t.y-e.y;return i*i+r*r<=o}a([l()],m.prototype,"_hideDefaultCursor",void 0),a([l()],m.prototype,"_stagedPointerId",void 0),a([l()],m.prototype,"_isDragging",null),a([l()],m.prototype,"_snappingOperation",void 0),a([l()],m.prototype,"_snappingEnabled",null),a([l({constructOnly:!0})],m.prototype,"graphic",void 0),a([l()],m.prototype,"constraintsEnabled",void 0),a([l()],m.prototype,"constraints",void 0),a([l()],m.prototype,"_constraint",null),a([l()],m.prototype,"constraintZ",void 0),a([l()],m.prototype,"defaultZ",void 0),a([l()],m.prototype,"isDraped",void 0),a([l({value:He})],m.prototype,"drawingMode",null),a([l({constructOnly:!0})],m.prototype,"elevationDrawSurface",void 0),a([l({constructOnly:!0})],m.prototype,"elevationInfo",void 0),a([l({constructOnly:!0,type:Oe})],m.prototype,"labelOptions",void 0),a([l({constructOnly:!0})],m.prototype,"geometryType",void 0),a([l({constructOnly:!0})],m.prototype,"hasM",void 0),a([l({constructOnly:!0})],m.prototype,"hasZ",void 0),a([l()],m.prototype,"cursor",void 0),a([l()],m.prototype,"effectiveCursor",null),a([l()],m.prototype,"loading",void 0),a([l({constructOnly:!0})],m.prototype,"manipulators",void 0),a([l({constructOnly:!0})],m.prototype,"drawSurface",void 0),a([l({constructOnly:!0})],m.prototype,"segmentLabels",void 0),a([l({constructOnly:!0})],m.prototype,"snappingManager",void 0),a([l({constructOnly:!0})],m.prototype,"snappingVisualizer",void 0),a([l()],m.prototype,"snapToSceneEnabled",void 0),a([l({readOnly:!0})],m.prototype,"cursorVertex",null),a([l({readOnly:!0})],m.prototype,"visualizationCursorVertex",null),a([l()],m.prototype,"committableVertex",null),a([l()],m.prototype,"firstVertex",void 0),a([l()],m.prototype,"lastVertex",void 0),a([l()],m.prototype,"secondToLastVertex",void 0),a([l()],m.prototype,"updating",null),a([l({constructOnly:!0})],m.prototype,"view",void 0),m=a([_("esri.views.draw.DrawOperation")],m);var qi=class{constructor(e,o,i,r=null){this._elevationInfo=e,this.defaultZ=o,this._view=i,this._excludeGraphics=r}screenToMap(e){let{defaultZ:o,_view:i}=this,r=i.sceneIntersectionHelper.intersectElevationFromScreen(eo(e.x,e.y),this._elevationInfo,o??0,this._excludeGraphics);return o==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let o=bt(e.x,e.y,ve(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(o)}constrainZ(e){let{defaultZ:o}=this;return o!=null&&e.z!==o&&((e=ye(e)).z=o),e}},ji=class{constructor(e,o,i=[]){this.view=e,this.elevationInfo=o,this.exclude=i}screenToMap(e){let o=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return o!=null&&(o.z=Po(o,this.view,this.elevationInfo)),o}mapToScreen(e){let o=e;return this.elevationInfo!=null&&(o=bt(e.x,e.y,ve(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(o)}constrainZ(e){return e}},Bi=class{constructor(e,o=!1,i=0){this.view=e,this.hasZ=o,this.defaultZ=i,this.mapToScreen=r=>e.toScreen(r),this.screenToMap=o?r=>{let n=e.toMap(r);return n.z=i,n}:r=>e.toMap(r)}constrainZ(e){let{defaultZ:o}=this;return this.hasZ&&e.z!==o&&((e=ye(e)).z=o),e}},ze=class t{screenToMap(e){let{x:o,y:i}=e;return new P({x:o,y:i,spatialReference:t.spatialReference})}mapToScreen(e){return Vt(e.x,e.y)}constrainZ(e){return e}};ze.spatialReference=new it;function _p(t,e){return Yi(t,e,!1)}function Tp(t,e){return Yi(t,e,!0)}function Yi(t,e,o){if(t instanceof pi){if(t.operation instanceof ci)return Or(t.operation,e,o),!0;if(t.operation instanceof di)return Mr(t.operation,e,o),!0;if(t.operation instanceof ui)return Cr(t.operation,e,o),!0}return!1}function Or(t,e,o=!1){let i=o?-1:1,r=oo(i*t.dx,i*t.dy,i*t.dz);st(e.origin,e.origin,r),Mt(e)}function Mr(t,e,o=!1){let i=o?-t.angle:t.angle;fe(e.basis1,e.basis1,pe,i),fe(e.basis2,e.basis2,pe,i),Mt(e)}function Cr(t,e,o=!1){let i=o?1/t.factor1:t.factor1,r=o?1/t.factor2:t.factor2;St(e.basis1,e.basis1,i),St(e.basis2,e.basis2,r),he(e.origin,e.origin,t.origin,t.axis1,i),he(e.origin,e.origin,t.origin,t.axis2,r),Mt(e)}function Sp(t,e,o,i,r=!1){i||(i=Oo());let n=nt(lt.get(),t[1],-t[0]),s=nt(lt.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=nt(lt.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=lt.get(),d=e.allVertices;d.forEach(({pos:h})=>{nt(p,ue(t,h),ue(n,h)),po(s,s,p),co(c,c,p)});let u=1e-6,f=nt(lt.get(),c[0]-s[0]<u?o/2:0,c[1]-s[1]<u?o/2:0);lo(s,s,f),ao(c,c,f);let x=r?d.reduce((h,w)=>h+(w.pos[2]??0),0)/d.length:0;return de(i.basis1,t,(c[0]-s[0])/2),de(i.basis2,n,(c[1]-s[1])/2),Dt(i.origin,s[0]*t[0]+s[1]*n[0],s[0]*t[1]+s[1]*n[1],x),st(i.origin,i.origin,i.basis1),st(i.origin,i.origin,i.basis2),Mt(i),i}export{g as a,yl as b,m as c,qi as d,ji as e,Bi as f,_p as g,Tp as h,Sp as i};
