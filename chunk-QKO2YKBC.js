import{a as bt}from"./chunk-MF655E4C.js";import{a as v}from"./chunk-CCTFA5SZ.js";import{c as dt,e as U,f as X,g as k,h as ht,i as xt,j as wt}from"./chunk-E2J2V7JN.js";import{c as gt}from"./chunk-NQWYPF77.js";import{c as ct,d as L}from"./chunk-TOH4K6HW.js";import{c as C,g as E,h as I,r as W}from"./chunk-TPFJWNIU.js";import{a as u,c as pt}from"./chunk-EM35R6FY.js";import{a as lt,b as m,c as ut,d as D,g as A,k as O,m as ft,n as Q,o as mt,p as yt,s as T,y as J}from"./chunk-QXXXCEV5.js";import{c as st}from"./chunk-RSDQHAJX.js";import{f as B}from"./chunk-FENRIY2T.js";import{h as it}from"./chunk-QT6UNBJP.js";import{c as et}from"./chunk-YR2HD3ZC.js";import{m as q}from"./chunk-LFH24RLM.js";import{a as F,n as V}from"./chunk-Z5Q7KLA4.js";import{a as ot}from"./chunk-4XZ6X7MQ.js";import{B as z,ha as at,m as N,n as nt}from"./chunk-KGVXGH6H.js";import{a as rt}from"./chunk-DB3UIQCU.js";import{f as tt}from"./chunk-SG7CQU4O.js";import{H as S}from"./chunk-QHVIRF5H.js";import{I as $}from"./chunk-WZDN6K3C.js";import{a as R}from"./chunk-QGVBCWUY.js";var H,x=H=class extends tt{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new H({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};R([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:_}}}}})],x.prototype,"rotation",void 0),R([rt("rotation")],x.prototype,"castRotation",null),R([S({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:_}}}}})],x.prototype,"scale",void 0),R([S({types:gt,json:{read:B,write:!0,origins:{"web-scene":{read:B,write:{overridePolicy:_}}}}})],x.prototype,"targetGeometry",void 0),R([S({type:bt,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],x.prototype,"camera",void 0),x=H=R([$("esri.Viewpoint")],x);var P=x;function _(){return{enabled:!this.camera}}var Gt=96,St=39.37,zt=180/Math.PI;function At(t){return t.wkid?t:t.spatialReference||ot.WGS84}function K(t,e){return e.type?m(t,e.x,e.y):lt(t,e)}function vt(t){return at(t)}function Mt(t,e,r=0){let n=t.width,a=t.height;if(r!==0){let s=it(r),l=Math.abs(Math.cos(s)),c=Math.abs(Math.sin(s));n=t.width*l+t.height*c,a=t.width*c+t.height*l}let o=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(n/o,a/i)*Et(t.spatialReference)}async function M(t,e,r,n){let a,o;if(!t||Array.isArray(t)&&!t.length)return null;if(et.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){let s=t.every(p=>"attributes"in p),l=t.some(p=>!p.geometry),c=t;if(s&&l&&e&&e.allLayerViews){let p=new Map;for(let f of t){let y=f.layer,G=p.get(y)||[],h=f.attributes[y.objectIdField];h!=null&&G.push(h),p.set(y,G)}let d=[];p.forEach((f,y)=>{let G=e.allLayerViews?.find(h=>h.layer.id===y.id);if(G&&"queryFeatures"in G){let h=y.createQuery();h.objectIds=f,h.returnGeometry=!0,d.push(G.queryFeatures(h))}});let b=await Promise.all(d),g=[];for(let f of b)if(f&&f.features&&f.features.length)for(let y of f.features)y.geometry!=null&&g.push(y.geometry);c=g}for(let p of c)n=await M(p,e,r,n);return n}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")a=new V(t);else if(t instanceof F)a=t;else if("geometry"in t){if(t.geometry)a=t.geometry;else if(t.layer){let s=t.layer,l=e.allLayerViews?.find(c=>c.layer.id===s.id);if(l&&"queryFeatures"in l){let c=s.createQuery();c.objectIds=[t.attributes[s.objectIdField]],c.returnGeometry=!0,a=(await l.queryFeatures(c))?.features?.[0]?.geometry}}}if(a==null)return null;switch(a.type){case"point":o=new q({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=ct(a);break;default:o=a.extent}if(!o)return null;C()||W(o.spatialReference,r)||await E();let i=I(o,r);if(!i)return null;if(n){let s=i.center,l=s.clone();l.x=L(s.x,n.center.x,r),l.x!==s.x&&i.centerAt(l),n=n.union(i)}else n=i;return n}function Ft(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){let e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,r=0;for(let n of t){let a=n.layer;a?.minScale&&a.maxScale&&(e=a.minScale<e?a.minScale:e,r=a.maxScale>r?a.maxScale:r)}return e&&r?{min:e,max:r}:null}}}function Rt(t,e){let r=At(t);return N(r,e)||r.imageCoordinateSystem||e.imageCoordinateSystem?t:I(t,e)}async function xe(t,e){if(!t||!e)return new P({targetGeometry:new V,scale:0,rotation:0});let r=e.spatialReference,{constraints:n,padding:a,viewpoint:o,size:i}=e,s=[a?i[0]-a.left-a.right:i[0],a?i[1]-a.top-a.bottom:i[1]],l=null;t instanceof P?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l?.targetGeometry?c=l.targetGeometry:t instanceof q?c=t:t instanceof F?c=await M(t,e,r):t&&(c=await M(t.center,e,r)||await M(t.target,e,r)||await M(t,e,r)),!c&&o?.targetGeometry?c=o.targetGeometry:!c&&e.extent&&(c=e.extent),r||(r=At(e.spatialReference||e.extent||c)),C()||N(c.spatialReference,r)||W(c.spatialReference,r)||await E();let p=Rt(c,r),d="center"in p?p.center:p;e.pickClosestTarget!==!1&&d.type==="point"&&o.targetGeometry?.type==="point"&&(d.x=L(d.x,o.targetGeometry.x,d.spatialReference));let b=0;l?b=l.rotation:t.hasOwnProperty("rotation")?b=t.rotation:o&&(b=o.rotation);let g=0;g=l?.targetGeometry!=null&&l.targetGeometry.type==="point"?l.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&n&&n.effectiveLODs?n.zoomToScale(t.zoom):Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0?o.scale:Mt(Rt(c.extent,r),s,b);let f=Ft(t.target??t);f&&(f.min&&f.min<g?g=f.min:f.max&&f.max>g&&(g=f.max));let y=new P({targetGeometry:d,scale:g,rotation:b});return n&&(y=n.fit(y),n.constrainByGeometry(y),n.rotationEnabled||(y.rotation=o.rotation)),y}function w(t,e){let r=t.targetGeometry,n=e.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Vt(t,e,r){return r?m(t,.5*(e[0]-r.right+r.left),.5*(e[1]-r.bottom+r.top)):A(t,e,.5)}var we=function(){let t=u();return function(e,r,n){let a=r.targetGeometry;K(t,a);let o=.5*j(r);return e.xmin=t[0]-o*n[0],e.ymin=t[1]-o*n[1],e.xmax=t[0]+o*n[0],e.ymax=t[1]+o*n[1],e.spatialReference=a.spatialReference,e}}();function be(t,e,r,n,a){return Lt(t,e,r.center),t.scale=Mt(r,n),a?.constraints?.constrain(t),t}function qt(t,e,r,n){return kt(t,e,r,n),dt(t,t)}var jt=function(){let t=u();return function(e,r,n){return J(e,It(e,r),Vt(t,r,n))}}(),Bt=function(){let t=v(),e=u();return function(r,n,a,o){let i=j(n),s=Y(n);return m(e,i,i),xt(t,e),U(t,t,s),k(t,t,jt(e,a,o)),k(t,t,[0,o.top-o.bottom]),m(r,t[4],t[5])}}();function j(t){return t.scale*Ct(t.targetGeometry?.spatialReference)}function Ct(t){return z(t)?1/(vt(t)*St*Gt):1}function Y(t){return st(t.rotation)||0}function Et(t){return z(t)?vt(t)*St*Gt:1}function It(t,e){return A(t,e,.5)}var Tt=function(){let t=u(),e=u(),r=u();return function(n,a,o,i,s,l){return ft(t,a),A(e,o,.5*l),m(r,1/i*l,-1/i*l),wt(n,e),s&&U(n,n,s),X(n,n,r),k(n,n,t),n}}(),kt=function(){let t=u();return function(e,r,n,a){let o=j(r),i=Y(r);return K(t,r.targetGeometry),Tt(e,t,n,o,i,a)}}(),Re=function(){let t=u();return function(e,r,n,a){let o=j(r);return K(t,r.targetGeometry),Tt(e,t,n,o,0,a)}}();function Wt(t){let e=nt(t);return e?e.valid[1]-e.valid[0]:0}function Ge(t,e){return Math.round(Wt(t)/e)}var Se=function(){let t=u(),e=u(),r=[0,0,0];return function(n,a,o){D(t,n,a),Q(t,t),D(e,n,o),Q(e,e),yt(r,t,e);let i=Math.acos(mt(t,e)/(O(t)*O(e)))*zt;return r[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),Ae=function(){let t=u();return function(e,r,n,a){let o=e.targetGeometry;return w(e,r),Bt(t,r,n,a),o.x+=t[0],o.y+=t[1],e}}(),Lt=function(t,e,r){w(t,e);let n=t.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,t},ve=function(){let t=u();return function(e,r,n,a,o){o||(o="center"),J(t,n,a),A(t,t,.5);let i=t[0],s=t[1];switch(o){case"center":m(t,0,0);break;case"left":m(t,-i,0);break;case"top":m(t,0,s);break;case"right":m(t,i,0);break;case"bottom":m(t,0,-s);break;case"top-left":m(t,-i,s);break;case"bottom-left":m(t,-i,-s);break;case"top-right":m(t,i,s);break;case"bottom-right":m(t,i,-s)}return Z(e,r,t),e}}();function Me(t,e,r){return w(t,e),t.rotation+=r,t}function je(t,e,r){return w(t,e),t.rotation=r,t}var Dt=function(){let t=u();return function(e,r,n,a,o){return w(e,r),isNaN(n)||n===0||(Pt(t,a,r,o),e.scale=r.scale*n,Nt(t,t,e,o),Z(e,e,m(t,t[0]-a[0],a[1]-t[1]))),e}}();function Te(t,e,r){return w(t,e),t.scale=r,t}var Ot=function(){let t=u();return function(e,r,n,a,o,i){return w(e,r),isNaN(n)||n===0||(Pt(t,o,r,i),e.scale=r.scale*n,e.rotation+=a,Nt(t,t,e,i),Z(e,e,m(t,t[0]-o[0],o[1]-t[1]))),e}}(),ke=function(){let t=u(),e=u();return function(r,n,a,o,i,s,l){return jt(e,s,l),ut(t,i,e),o?Ot(r,n,a,o,t,s):Dt(r,n,a,t,s)}}(),Pt=function(){let t=v();return function(e,r,n,a){return T(e,r,qt(t,n,a,1))}}(),Nt=function(){let t=v();return function(e,r,n,a){return T(e,r,kt(t,n,a,1))}}(),Z=function(){let t=u(),e=v();return function(r,n,a){w(r,n);let o=j(n),i=r.targetGeometry;return ht(e,Y(n)),X(e,e,pt(o,o)),T(t,a,e),i.x+=t[0],i.y+=t[1],r}}();export{P as a,Mt as b,xe as c,w as d,Vt as e,we as f,be as g,jt as h,j as i,Ct as j,Tt as k,kt as l,Re as m,Wt as n,Ge as o,Se as p,Ae as q,Lt as r,ve as s,Me as t,je as u,Te as v,Ot as w,ke as x,Z as y};
