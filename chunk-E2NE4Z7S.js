import{b as re,c as se}from"./chunk-WNVGQG3J.js";import{a as ie}from"./chunk-QW25UBG2.js";import{a as ae,b as O,c as Le}from"./chunk-MWCKNZQZ.js";import"./chunk-TUJMSP4X.js";import"./chunk-4YX5NE4F.js";import"./chunk-FJNBIBDX.js";import"./chunk-F7MBACHV.js";import"./chunk-5ZS2L6U3.js";import"./chunk-LAVD467M.js";import"./chunk-6CUAH7AI.js";import"./chunk-OC2XJJQU.js";import{a as Ie,b as De,c as Pe,d as oe}from"./chunk-FQUEI65G.js";import"./chunk-N5YUEDXE.js";import"./chunk-ZJQOPRYL.js";import"./chunk-WSHRDZWE.js";import"./chunk-563WFO4F.js";import{t as Ue}from"./chunk-T4QAGZWF.js";import"./chunk-7BXTHPPE.js";import"./chunk-Q5KIWWVU.js";import{a as _}from"./chunk-KK722UJA.js";import"./chunk-C27Q2S3P.js";import{f as Ce,g as Ae,h as He,i as Re}from"./chunk-JQITDX7D.js";import"./chunk-56YFAJ3D.js";import{b as xe}from"./chunk-VLG7V3KV.js";import{a as te}from"./chunk-63BBKXWS.js";import"./chunk-ZFRNSCYG.js";import{d as w}from"./chunk-UWWX7VSW.js";import"./chunk-CFF33S4D.js";import"./chunk-JKP7KG6H.js";import{a as K}from"./chunk-CU7VLLP2.js";import"./chunk-3O6GAUHL.js";import{e as Se,g as ke,j as Me}from"./chunk-2XYAAYOE.js";import"./chunk-4X7VNDTG.js";import"./chunk-LXEWGICX.js";import"./chunk-NIYDRLW4.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-DZBH24YT.js";import"./chunk-FXCL7YYQ.js";import"./chunk-5NHJFBCW.js";import"./chunk-AOQ57NDM.js";import"./chunk-VMECOA4F.js";import"./chunk-JPMGMA4B.js";import{i as ve}from"./chunk-YQGS4EZO.js";import"./chunk-3REMXE4W.js";import"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import{B as P,f as Te,v as Ee}from"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import{b as Oe,d as ee}from"./chunk-LYNAYPL3.js";import{d as Ge}from"./chunk-ULANM5YP.js";import"./chunk-KAMRW6HF.js";import"./chunk-6DGDLLNL.js";import"./chunk-DJW5LMRG.js";import"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import{a as B}from"./chunk-DVBZA6ZU.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-JTDXB5TK.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import{c as fe,g as _e,h as be,r as we}from"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-EM35R6FY.js";import"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-NHEQ4TAR.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import{a as X}from"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import{a as R,b as ue,c as J,d as Q,i as ye,j}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import{c as $}from"./chunk-YR2HD3ZC.js";import{a as V}from"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-BUSG3ZOF.js";import"./chunk-XZIOXVVJ.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import{J as ge,m as me}from"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as d,J as de}from"./chunk-QHVIRF5H.js";import{I as H}from"./chunk-WZDN6K3C.js";import{a as h}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{C as ce,E as z,b as A,e as F,l as M,p as he,u as Y}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{r as pe,t as le}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as m,b as S}from"./chunk-N2WTMF3X.js";function Fe(e){return ze(e).result}function ze(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:O.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:O.GEOMETRY_MISSING};if(Me(e.elevationInfo))return{result:O.ELEVATION_MODE_UNSUPPORTED};let t=e.operations.data.type,o=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:O.SUPPORTED,geometry:o}:{result:O.GEOMETRY_TYPE_UNSUPPORTED}}function Ve(e){if(e.layer?.type!=="graphics")return O.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return O.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return O.SUPPORTED;default:return O.GEOMETRY_TYPE_UNSUPPORTED}let t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(o=>o.type==="object")?O.SYMBOL_TYPE_UNSUPPORTED:Se(e)!=="on-the-ground"&&ke(e)?O.ELEVATION_MODE_UNSUPPORTED:O.SUPPORTED}var T=class extends V.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};h([d()],T.prototype,"activeComponent",void 0),h([d()],T.prototype,"cancelled",void 0),h([d()],T.prototype,"history",void 0),h([d()],T.prototype,"tool",null),h([d()],T.prototype,"type",void 0),h([d()],T.prototype,"canUndo",null),h([d()],T.prototype,"canRedo",null),h([d()],T.prototype,"onEnd",void 0),h([d()],T.prototype,"undo",null),h([d()],T.prototype,"redo",null),h([d()],T.prototype,"toggleTool",void 0),h([d()],T.prototype,"addToSelection",void 0),h([d()],T.prototype,"removeFromSelection",void 0),T=h([H("esri.widgets.Sketch.support.OperationHandle")],T);var x=class extends T{};h([d()],x.prototype,"activeComponent",void 0),x=h([H("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],x);var C=class extends T{};h([d()],C.prototype,"activeComponent",void 0),C=h([H("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],C);function Be(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Ke(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var je;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(je||(je={}));var Ne={defaultZ:0},L={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"},v=class extends V.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new B,this._internalGraphicsLayer=new K({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new ee({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Oe({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ge({color:[130,130,130,1],width:2}),this.meshSymbol=new Ee({symbolLayers:new $([new Te])}),this.updateGraphics=new $,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new ee({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new oe,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Ne,this.defaultUpdateOptions=L,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new re}initialize(){this.addHandles([J(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),J(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(let t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),R(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},j),R(()=>this.view,e=>{this._defaultSnappingManager=A(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new se({view:e,options:this.snappingOptions})),e.type==="2d"?import("./chunk-W5VQUOUV.js"):e.type==="3d"&&(import("./chunk-W4EYNXSE.js"),import("./chunk-HVBHXIBY.js")))},j),R(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),Ue(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=A(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:e,destroyed:t}=this,o=!t&&e&&"tooltip"in e?e.tooltip:null;return o?.visible?o:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",m(m({},Ne),e))}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",S(m(m({},L),e),{reshapeOptions:m(m({},L.reshapeOptions),e?.reshapeOptions),highlightOptions:m(m({},L.highlightOptions),e?.highlightOptions)}))}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=A(this._defaultSnappingManager)),this._override("snappingManager",e);else{let{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new se({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){let e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){let t=this._get("view");if(t){let{container:a,map:i}=t;a&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let o="view-ready";this.removeHandles(o),e&&this.addHandles(ue(()=>e.ready,a=>{this.removeHandles(this._viewHandlesKey),a&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},j),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=F(this._moduleLoaderAbortController),this._viewReadyAbortController=F(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){let{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){let{activeTool:o,layer:a}=this,i=t.toArray();a.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:o})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){let e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();let{view:o,layer:a}=this;if(!o||this.state==="disabled")throw a||this._logMissingLayer(),Y();if(o.activeTool!=null&&(o.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");ie(o,this._internalGraphicsLayer);let i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);let r=()=>{if(i===this._operationHandle){let l=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||l==null||a.add(l),this._sketchContinuationFlag=!1,this.emit("create",{graphic:l,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;let{creationMode:p}=this;if(p==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(z(this.create(e,t)))}else p==="update"&&l&&this._updatingHandles.addPromise(z(this.update([l])))}};i.on("complete",r),this._operationHandle=i,o.ready&&o.focus()}async place(e,t){return this.create("mesh",m({mode:"click",hasZ:e.hasZ,geometryToPlace:e},t))}async update(e,t){this.cancel(),await this._waitViewReady();let{layer:o,view:a,state:i}=this;if(!a||i==="disabled")throw o||this._logMissingLayer(),Y();a.activeTool!=null&&(a.activeTool=null);let r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(s=>s.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;let l=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||l==null||G(l)||(ie(a,this._internalGraphicsLayer),this._setUpdateOperationHandle(l,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:l.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){let t=this.view;if(t){e=Array.isArray(e)?e:[e];for(let o of e)o.geometry==null||o.geometry.type==="mesh"||me(o.geometry.spatialReference,t.spatialReference)||(we(o.geometry.spatialReference,t.spatialReference)||fe()||await _e(),o.geometry=be(o.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){let t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){let i=[];t.map.allLayers.forEach(l=>{l.type!=="vector-tile"&&l.type!=="imagery"||i.push(l)});let r=await t.hitTest(e,{exclude:i});return xe(r.results)}let o=[t.map.ground];t.map.allLayers.forEach(i=>{ve(i.type)&&o.push(i)});let a=await t.hitTest(e,{exclude:o});if(a.results.length>0){let i=a.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!a.ground.mapPoint||t.map.ground.opacity<1||a.ground.distance-(i.distance??0)>-Math.min(3*a.ground.distance,t.viewingMode==="global"?ge(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{let o=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!o&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},w.WIDGET)]}async _handleImmediateClick(e){let t=await e.async(()=>this._getFirstHit(te(e))),o=null;if(t!=null){let a=t.graphic;this.updateGraphics.includes(a)||a.layer===this.layer?(e.stopPropagation(),o=a):this.view?.type!=="2d"||this._isComponentGraphic(a)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();o==null||this.updateGraphics.includes(o)||await this.update([o],S(m({},this.defaultUpdateOptions),{reshapeOptions:m({},this.defaultUpdateOptions.reshapeOptions)}))}async _setupCreateOperation(e,t){let o=this.view;if(!o)return this._logMissingView(),null;let a=m(m({hasZ:o.type==="3d"},this.defaultCreateOptions),t),i=await this._setupDrawGraphicTool(e,o,a);return i==null?null:(o.tools.add(i),o.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,o){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;let{cursor:a,defaultZ:i,hasZ:r,geometryToPlace:l,graphicProperties:s,mode:p,preserveAspectRatio:n}=o,u=Be(p,e),g=Ke(e),f=o?.optionsPerTool?.has(e)?o.optionsPerTool.get(e):{},y=f?.preserveAspectRatio??n??e!=="rectangle",c=m({centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:a,defaultZ:i,forceUniformSize:y,graphicProperties:S(m({},s),{attributes:m({},s?.attributes)}),geometryToPlace:l,geometryType:g,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t},f);return t.type==="2d"?this._makeDrawGraphicTool2D(c):this._makeDrawGraphicTool3D(c)}async _makeDrawGraphicTool2D(e){let t=await this._requireModule(import("./chunk-W5VQUOUV.js"));return G(t)||this.destroyed?null:new t.module.DrawGraphicTool2D(S(m({},e),{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Je(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions}))}async _makeDrawGraphicTool3D(e){let t=await this._requireModule(import("./chunk-W4EYNXSE.js"));if(G(t)||this.destroyed)return null;let{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D(S(m({},e),{elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions}))}_setupCreateOperationHandle(e){let t=this.view;if(!t)return this._logMissingView(),null;let o=null,a=e.forceUniformSize,i=e.centered,r=[t.on("key-down",s=>{if(s.key===_.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===_.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==_.vertexAdd||s.repeat)s.key===_.undo?(s.stopPropagation(),l.undo()):s.key===_.redo?(s.stopPropagation(),l.redo()):s.key!==_.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===_.center&&(s.repeat||(e.centered=!i,s.stopPropagation())):(e.forceUniformSize=!a,s.stopPropagation());else{let p=e.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},w.WIDGET),t.on("key-up",s=>{s.key===_.pan?e.enabled=!0:s.key!==_.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===_.center&&(e.centered=i,s.stopPropagation()):(e.forceUniformSize=a,s.stopPropagation())},w.WIDGET),e.on("vertex-add",s=>{switch(o=o==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),o="complete",s.aborted?l&&l.cancel():l&&l.complete()}),R(()=>this._getGraphicSymbolFromTool(e.geometryType),s=>{e.graphicSymbol=s})],l=new x({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{M(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return l}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){let{layer:o,view:a}=this;if(!a)return this._logMissingView(),null;let i=S(m(m({},this.defaultUpdateOptions),t),{reshapeOptions:m(m({},this.defaultUpdateOptions.reshapeOptions),t?.reshapeOptions),highlightOptions:m(m({},this.defaultUpdateOptions.highlightOptions),t?.highlightOptions)}),r=i.tool??L.tool;for(let l of e)o.remove(l),o.add(l);if(a.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,i,a,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],i,a);case"transform":return this._setupGraphicTransform3DOperation(e,i,a)}}switch(r){case"move":return this._setupMove2DOperation(e,i,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,i,a);case"transform":if(e.length===1){let l=e[0].geometry?.type;l!=="point"&&l!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,i,a)}}async _setupMove3DOperation(e,t,o,a,i=!1){let r=await this._requireModule(import("./chunk-W4EYNXSE.js"));if(G(r))return r;let{ManipulatedObject3DGraphic:l,MoveTool3D:s}=r.module,p=new Map,n=()=>{p.forEach(y=>y.destroy()),p.clear()};for(let y of e){let c=new l({view:o,graphic:y}),E=Le(c);if(E!==O.SUPPORTED)return n(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${ae(E)}).`),null;p.set(y,c)}let u=new s({view:o,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(u),u.objects.addMany(Array.from(p.values())),i||this.updateGraphics.addMany(e);let g=[],f=new C({activeComponent:u,tool:a,type:"update",onEnd:()=>{M(g),Z(o,u),n()},undo:()=>{Ze(this.view,u),N(f,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{W(f,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:y=>{this.updateGraphics.push(y);let c=new l({view:o,graphic:y});p.set(y,c),u.objects.push(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{let c=this.updateGraphics.indexOf(y);if(f.history.undo.forEach(k=>k.updates.splice(c,1)),f.history.redo.forEach(k=>k.updates.splice(c,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void f.complete();let E=p.get(y);E&&(u.objects.remove(E),E.destroy(),p.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||a!=="transform")return;let y=this.updateGraphics.at(0),c=await this._setupReshape3DOperation(y,t,o,!0);c&&!G(c)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(c,t))}});return g.push(...this._getHandlesForComponent(f,t),o.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(f,y,t),w.WIDGET),o.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(f,y)},w.WIDGET)),f}_setupGraphicTransform3DOperation(e,t,o,a=!1){if(e.length===1&&Ve(e[0])===O.SUPPORTED){let i=e[0],r=i.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(i,t,o);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(i,t,o,a)}return this._setupMove3DOperation(e,t,o,"transform",a)}async _setupPointTransform3DOperation(e,t,o){let a="transform",{enableRotation:i,enableScaling:r,enableZ:l}=t,s=await this._requireModule(import("./chunk-W4EYNXSE.js"));if(G(s))return s;let{TransformTool3D:p,ManipulatedObject3DGraphic:n}=s.module,u=new n({graphic:e,view:o}),g=new p({object:u,view:o,enableRotation:i,enableScaling:r,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(g),this.updateGraphics.add(e);let f=[],y=new C({activeComponent:g,tool:a,type:"update",onEnd:()=>{M(f),Z(o,g),u.destroy()},undo:()=>{Ze(this.view,g),N(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{W(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async c=>{this.updateGraphics.add(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();let E=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);G(E)||this._setUpdateOperationHandle(E,t)},removeFromSelection:c=>{this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(y,t),o.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(y,c,t),w.WIDGET),o.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(y,c)},w.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,o,a=!1){let i="transform",{enableRotation:r,enableScaling:l,enableZ:s,preserveAspectRatio:p}=t,n=await this._requireModule(import("./chunk-W4EYNXSE.js"));if(G(n))return n;let{ManipulatedObject3DGraphic:u,ExtentTransformTool:g}=n.module,f=this.view?.inputManager?.isModifierKeyDown(_.constraint),y=new u({view:o,graphic:e}),c=new g({object:y,view:o,enableRotation:r,enableScaling:l,enableZ:s,preserveAspectRatio:!!p!=!!f,sketchOptions:this.sketchOptions});o.tools.add(c),a||this.updateGraphics.add(e);let E=[],k=new C({activeComponent:c,tool:i,type:"update",onEnd:()=>{M(E),Z(o,c),y.destroy()},canUndo:()=>!c.destroyed&&c.canUndo,undo:()=>{c.destroyed||(c.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!c.destroyed&&c.canRedo,redo:()=>{c.destroyed||(c.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async b=>{this.updateGraphics.add(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[b],removed:[],type:"selection-change"},type:"update"}),k.onEnd(),k.destroy();let ne=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);G(ne)||this._setUpdateOperationHandle(ne,t)},removeFromSelection:b=>{this.updateGraphics.remove(b),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[b],type:"selection-change"},type:"update"}),k.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;let b=await this._setupReshape3DOperation(e,t,o,!0);b&&!G(b)&&(k.onEnd(),k.destroy(),this._setUpdateOperationHandle(b,t))}});return E.push(...this._getHandlesForComponent(k,t),o.on("immediate-click",b=>this._getCommonUpdateOperationClickHandlers(k,b,t),w.WIDGET),o.on("key-down",b=>this._getCommonUpdateOperationKeyDownHandlers(k,b),w.WIDGET),o.on("key-down",b=>{b.key!==_.constraint||b.repeat||(c.preserveAspectRatio=!c.preserveAspectRatio,b.stopPropagation())},w.WIDGET),o.on("key-up",b=>{b.key===_.constraint&&(c.preserveAspectRatio=!c.preserveAspectRatio,b.stopPropagation())},w.WIDGET)),k}async _setupMove2DOperation(e,t,o){let a="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=await this._getGraphicMover(e,t,o);if(G(i))return i;let r=new C({activeComponent:i,tool:a,type:"update",onEnd:()=>{this._displayDefaultCursor(),M(p),M(s),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let n=this.updateGraphics.toArray();N(r,n),r.refreshComponent(),this._emitUndoEvent({graphics:n,tool:a})},redo:()=>{let n=this.updateGraphics.toArray();W(r,n),r.refreshComponent(),this._emitRedoEvent({graphics:n,tool:a})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{let u=this.updateGraphics.indexOf(n);r.history.undo.forEach(f=>f.updates.splice(u,1)),r.history.redo.forEach(f=>f.updates.splice(u,1)),this.updateGraphics.remove(n);let g=this.updateGraphics.toArray();this.emit("update",{graphics:g,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=g:r.complete()}}),l=!1,s=[o.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(r,n,t),w.WIDGET),o.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(r,n),n.key!==_.constraint||n.repeat||(l=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET),o.on("key-up",n=>{n.key===_.constraint&&l&&(l=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},w.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,o,a=!1){let i="reshape",r=await this._requireModule(import("./chunk-W4EYNXSE.js"));if(G(r))return r;let{ManipulatedObject3DGraphic:l,ReshapeTool3D:s}=r.module,p=new l({view:o,graphic:e}),n=Fe(p);if(n!==O.SUPPORTED)return p.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${ae(n)}).`),null;let u=t.reshapeOptions,g=new s({view:o,object:p,enableZVertex:t.enableZ&&u?.vertexOperation==="move",enableZShape:t.enableZ&&u?.shapeOperation==="move",enableMoveObject:u?.shapeOperation==="move"||u?.shapeOperation==="move-xy",enableMidpoints:u?.edgeOperation==="split",enableEdgeOffset:u?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});o.tools.add(g),a||this.updateGraphics.add(p.graphic);let f=[],y=new C({activeComponent:g,tool:i,type:"update",onEnd:()=>{M(f),Z(o,g),p.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async c=>{this.updateGraphics.add(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();let E=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);G(E)||this._setUpdateOperationHandle(E,t)},removeFromSelection:c=>{this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();let c=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);G(c)||this._setUpdateOperationHandle(c,t)}});return f.push(...this._getHandlesForComponent(y,t),o.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(y,c,t),w.WIDGET),o.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(y,c)},w.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,o,a){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=t==="transform"?await this._getBox(e,o,a):await this._getReshape(e,o,a);if(G(i))return i;let r=new C({activeComponent:i,type:"update",onEnd:()=>{M(s),M(l),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{N(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{W(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async p=>{let n=r.activeComponent;if(n?.type==="reshape"){let u=[...this.updateGraphics,p];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();let g=await this._setupTransformOrReshape2DOperation(u,"transform",o,a);if(G(g))return;this._setUpdateOperationHandle(g,o)}else this.updateGraphics.add(p),n.graphics=this.updateGraphics.toArray(),n.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{let n=this.updateGraphics.indexOf(p);r.history.undo.forEach(g=>g.updates.splice(n,1)),r.history.redo.forEach(g=>g.updates.splice(n,1)),this.updateGraphics.remove(p);let u=this.updateGraphics.toArray();if(u.length===0)r.complete();else{let g=u[0].geometry;u.length!==1||g==null||g.type!=="point"&&g.type!=="multipoint"?r.activeComponent.graphics=u:r.toggleTool()}this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let p=this.updateGraphics.at(0),n=p.geometry;if(n!=null&&(r.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||r.tool==="transform"&&n.type==="extent"))return;let u=null;r.tool==="transform"?u=await this._getReshape([p],o,a):r.tool==="reshape"&&(u=await this._getBox([p],o,a)),G(u)||(r.activeComponent?.destroy(),r.activeComponent=u,r.activeComponent&&(M(s),s=this._getHandlesForComponent(r,o)))}}),l=[a.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,o),w.WIDGET),a.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key===_.constraint&&!p.repeat&&r){let n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET),a.on("key-up",p=>{if(p.key===_.constraint&&r){let n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET)],s=this._getHandlesForComponent(r,o);return r}async _getGraphicMover(e,t,o){let{enableMoveAllGraphics:a,highlightOptions:i}=t,r=await this._requireModule(import("./chunk-QTVKRD4C.js"));return G(r)?r:new r.module.default({enableMoveAllGraphics:a,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:l,dy:s,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:l,dy:s,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:l,dy:s,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:s,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){let{enableRotation:a,enableScaling:i,highlightOptions:r,preserveAspectRatio:l}=t,s=await this._requireModule(import("./chunk-IBAQAGF6.js"));if(G(s))return s;let p=this.view?.inputManager?.isModifierKeyDown(_.constraint);return new s.module.default({graphics:e,enableRotation:a,enableScaling:i,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!l!=!!p,layer:this._internalGraphicsLayer,view:o,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onMove:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onMoveStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onScaleStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onScale:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onScaleStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onRotateStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onRotate:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"}),onRotateStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},n),type:"update"})}})}async _getReshape(e,t,o){let a=t.reshapeOptions?.edgeOperation==="split",i=t.reshapeOptions?.shapeOperation==="move",r=!!t.highlightOptions?.enabled,l=await this._requireModule(import("./chunk-VFT4S4AZ.js"));return G(l)?l:new l.module.default({enableMidpoints:a,enableMovement:i,graphic:e[0],highlightsEnabled:r,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:o,callbacks:{onReshapeStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},s),type:"update"}),onReshape:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:m({},s),type:"update"}),onReshapeStop:({mover:s,type:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s,type:p},type:"update"}),onMoveStart:({dx:s,dy:p,mover:n,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:u},type:"update"}),onMove:({dx:s,dy:p,mover:n,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:u},type:"update"}),onMoveStop:({dx:s,dy:p,mover:n,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:p,mover:n,type:u},type:"update"}),onVertexAdd:({added:s,type:p,vertices:n})=>{let u=s.map(g=>X(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:u,vertices:n,type:p},type:"update"})},onVertexRemove:({removed:s,type:p,vertices:n})=>{let u=s.map(g=>X(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:u,vertices:n,type:p},type:"update"})}}})}_getHandlesForComponent(e,t){let o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",({graphic:a,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(a))}),o.on("graphic-move-start",a=>e.addToHistory(I(a.allGraphics)))];case"box":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(e,t,a)),o.on("move-start",a=>e.addToHistory(I(a.graphics))),o.on("rotate-start",a=>e.addToHistory(I(a.graphics))),o.on("scale-start",a=>e.addToHistory(I(a.graphics)))];case"reshape":return[o.on("graphic-click",a=>this._onTransformOrReshape2DGraphicClick(e,t,a)),o.on("move-start",a=>e.addToHistory(I([a.mover]))),o.on("reshape-start",a=>e.addToHistory(I([a.graphic]))),o.on("vertex-add",a=>e.addToHistory(I([a.oldGraphic]))),o.on("vertex-remove",a=>e.addToHistory(I([a.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",({updates:a})=>{e.addToHistory({updates:a})}),o.events.on("move-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a.dx,dy:a.dy,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:a.objects.length>0?a.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",({updates:a})=>{e.addToHistory({updates:a})}),o.events.on("translate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,dx:a.dxScreen,dy:a.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,angle:a.angle,type:"rotate"},type:"update"})}),o.events.on("scale",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:a.object.graphic,xScale:a.xScale,yScale:a.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:S(m({},a),{mover:a.object.graphic}),type:"update"})}),o.events.on("move",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:S(m({},a),{mover:a.object.graphic}),type:"update"})}),o.events.on("vertex-add",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("vertex-remove",a=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a,type:"update"})}),o.events.on("immediate-click",a=>{a.shiftKey?this._toggleSelection([a.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,o){let{graphic:a,viewEvent:i}=o;return i.native?.shiftKey&&a.layer===this.layer?(i.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;let o=this.view?.map;this._disablePopup(t);let a=()=>{if(e===this._operationHandle){let i=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",a)}async _getCommonUpdateOperationClickHandlers(e,t,o){let a=te(t),i=await t.async(()=>this._getFirstHit(a));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,o))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){let a=!!o.multipleSelectionEnabled;return e.some(i=>i!=null&&!(!a||i.layer!==this.layer)&&(this.updateGraphics.includes(i)?t.removeFromSelection(i):t.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;let o=t.key;o===_.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===_.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===_.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&_.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;let t=this.activeComponent,o=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||o.length===1&&o[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=A(this._internalGraphicsLayer))}_isComponentGraphic(e){let{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,o){pe.getLogger(this).error(new le(e,t,o))}async _requireModule(e){let t=new AbortController;this._moduleLoaderAbortController=t;let o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",S(m({},e),{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",S(m({},e),{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",S(m({},e),{type:"delete"}))}get test(){}wait(){return Q(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){let e=this.view;e?(F(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await ce(Q(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",We("view"))}_logMissingLayer(){this._logError($e,We("layer"))}};h([d()],v.prototype,"_defaultSnappingManager",void 0),h([d()],v.prototype,"updating",null),h([d({readOnly:!0})],v.prototype,"_updatingHandles",void 0),h([d()],v.prototype,"_operationHandle",void 0),h([d({readOnly:!0})],v.prototype,"activeTool",null),h([d({readOnly:!0})],v.prototype,"activeCreateToolDrawMode",null),h([d()],v.prototype,"activeTooltip",null),h([d({types:P})],v.prototype,"activeFillSymbol",void 0),h([d()],v.prototype,"activeLineSymbol",void 0),h([d()],v.prototype,"activeVertexSymbol",void 0),h([d()],v.prototype,"allowDeleteKey",void 0),h([d({readOnly:!0})],v.prototype,"createGraphic",null),h([d()],v.prototype,"defaultCreateOptions",null),h([d()],v.prototype,"defaultUpdateOptions",null),h([d({type:Ie,nonNullable:!0})],v.prototype,"labelOptions",null),h([d()],v.prototype,"layer",void 0),h([d({types:P})],v.prototype,"pointSymbol",void 0),h([d({types:P})],v.prototype,"polygonSymbol",void 0),h([d({types:P})],v.prototype,"polylineSymbol",void 0),h([d()],v.prototype,"meshSymbol",void 0),h([d({type:re,nonNullable:!0})],v.prototype,"snappingOptions",null),h([d()],v.prototype,"snappingManager",null),h([d({readOnly:!0})],v.prototype,"state",null),h([d({type:De,nonNullable:!0})],v.prototype,"tooltipOptions",null),h([d({readOnly:!0})],v.prototype,"updateGraphics",void 0),h([d()],v.prototype,"updateOnGraphicClick",void 0),h([d()],v.prototype,"creationMode",void 0),h([d({type:Pe,nonNullable:!0})],v.prototype,"valueOptions",null),h([d({types:P})],v.prototype,"vertexSymbol",void 0),h([d({value:null})],v.prototype,"view",null),h([d({constructOnly:!0,type:oe})],v.prototype,"sketchOptions",void 0),v=h([H("esri.widgets.Sketch.SketchViewModel")],v);var $e="sketch:missing-property",We=e=>`Property '${e}' is missing on SketchViewModel.`;function Je(e){return e==="polygon"||e==="rectangle"||e==="circle"}function N(e,t){qe("undo",e.history.undo,e.history.redo,t)}function W(e,t){qe("redo",e.history.redo,e.history.undo,t)}function qe(e,t,o,a){let i=t.pop();if(!i)return;let r=i.updates,l=[];a.forEach((s,p)=>{let n=r[p];n!=null&&("geometry"in n&&n.geometry!=null&&(l.push({geometry:s.geometry}),s.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(l.push({symbol:s.symbol}),s.symbol=n.symbol),"undo"in n&&(l.push(n),n[e](s)))}),o.push({updates:l})}function Ze(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function I(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function Z(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function G(e){return"requireError"in e&&e.requireError==="aborted"}var Ye=v;function q(e,t){e.networkFeature=t}function Qe(e){let t=U(e.graphic);return S(m({},e),{networkFeature:t})}function Xe(e){let t=e.graphics.map(o=>U(o));return S(m({},e),{networkFeatures:t})}function U(e){return e.networkFeature}function et(e){return e?.type==="point"||e?.type==="polyline"||e?.type==="polygon"}var D=class extends de{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new K({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new B,this.enabled=!0,this._handleSketchViewModelEvents=async t=>{switch(t.type){case"update":switch(t.state){case"active":case"complete":for(let o of t.graphics)U(o).geometry=et(o.geometry)?o.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(let o of t.graphics){let a=U(o);this._removeNetworkFeature(a)}break;case"create":if(t.graphic&&t.state==="complete"&&this._createMode){let o=t.graphic.geometry?.clone(),a=t.graphic.symbol?.clone();if(!o)break;switch(this._createMode){case"stop":{if(o.type!=="point")break;let{stops:i}=this.layer;if(i.length>0&&i.every(({geometry:l})=>!l)){i.at(0).geometry=o;break}if(i.length>1&&i.filter((l,s)=>s!==0).every(({geometry:l})=>!l)){i.at(1).geometry=o;break}let r=new Re({geometry:o});i.add(r),q(t.graphic,r);break}case"point-barrier":{if(o.type!=="point")break;let i=new Ce({geometry:o,symbol:a});this.layer.pointBarriers.add(i),q(t.graphic,i);break}case"polyline-barrier":{if(o.type!=="polyline")break;let i=new He({geometry:o,symbol:a});this.layer.polylineBarriers.add(i),q(t.graphic,i);break}case"polygon-barrier":{if(o.type!=="polygon")break;let i=new Ae({geometry:o,symbol:a});this.layer.polygonBarriers.add(i),q(t.graphic,i);break}}}}(await this.view.whenLayerView(this.layer)).emit(t.type,t.type==="create"?Qe(t):Xe(t))}}initialize(){this._sketchViewModel=new Ye({layer:this._graphicsLayer,view:this.view}),this.addHandles([R(()=>this.enabled,e=>{e?this._activate():this._deactivate()},ye),R(()=>{let{stops:e,pointBarriers:t,polylineBarriers:o,polygonBarriers:a}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:o,polygonBarriers:a}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),he(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=A(this._graphicsLayer),this._sketchViewModel=A(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>U(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){let t=this._graphicsLayer.graphics.find(o=>U(o)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){let e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(t=>t.toArray().map(o=>{let a=o.toGraphic();return a.networkFeature=o,a}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};h([d()],D.prototype,"enabled",void 0),h([d({constructOnly:!0})],D.prototype,"layer",void 0),h([d({readOnly:!0})],D.prototype,"selectedNetworkFeatures",null),h([d()],D.prototype,"updating",null),h([d({constructOnly:!0})],D.prototype,"view",void 0),D=h([H("esri.views.2d.layers.support.RouteLayerInteraction")],D);export{D as RouteLayerInteraction};
