import{a as V}from"./chunk-ITLSRYM2.js";import{a as $,b as N,m as E}from"./chunk-AFU5KDMG.js";import{a as D,b as U,c as F,d as W}from"./chunk-JAENS3D3.js";import"./chunk-3ATD3H4Q.js";import{b as R}from"./chunk-4YCQZSNI.js";import"./chunk-4D3QHJI2.js";import"./chunk-E2J2V7JN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import{d as C}from"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import{f as j}from"./chunk-77L5NP7A.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import{a as A}from"./chunk-KAMRW6HF.js";import"./chunk-JTDXB5TK.js";import"./chunk-KD27XIJC.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import{a as x}from"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import{f as T,g as O}from"./chunk-SP2CO3KX.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-DCHNVAWJ.js";import"./chunk-64RBIOV3.js";import"./chunk-6Z6LKUG5.js";import"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-XZIOXVVJ.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import"./chunk-QHVIRF5H.js";import"./chunk-WZDN6K3C.js";import"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{t as q}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as z,b as k}from"./chunk-N2WTMF3X.js";var K="picture-fill",X="picture-marker",Y="simple-fill",_="simple-line",tt="simple-marker",et="text",nt="Aa",ot=$.size,P=$.maxSize,at=$.maxOutlineSize,H=$.lineWidth,I=225,it=document.createElement("canvas");function G(e,t,s){if(e.type==="polygon"){let o=e.extent,u=o.width===0?1:o.width,r=o.height===0?1:o.height;e=T({originPosition:"upperLeft",scale:[u/t,r/s],translate:[o.xmin,o.ymax]},{},e);let c="";for(let l=0;l<e.rings.length;l++){let a=e.rings[l];for(let h=0;h<a.length;h++){let p=a[h][0],d=a[h][1],n="";h===0?(n=`M${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n):h===a.length-1?(n=`l${p.toString()} ${d.toString()} Z`,c!==""&&(n=` ${n}`),c+=n):(n=`l${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n)}}return c}if(e.type==="polyline"){let o=e.extent,u=o.width===0?1:o.width,r=o.height===0?1:o.height;e=O({originPosition:"upperLeft",scale:[u/t,r/s],translate:[o.xmin,o.ymax]},{},e);let c="";for(let l=0;l<e.paths.length;l++){let a=e.paths[l];for(let h=0;h<a.length;h++){let p=a[h][0],d=a[h][1],n="";h===0?(n=`M${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n):(n=`l${p.toString()} ${d.toString()}`,c!==""&&(n=` ${n}`),c+=n)}}return c}return""}function Q(e,t){let s=it.getContext("2d"),o=[];t&&(t.weight&&o.push(t.weight),t.size&&o.push(t.size+"px"),t.family&&o.push(t.family)),s.font=o.join(" ");let{width:u,actualBoundingBoxLeft:r,actualBoundingBoxRight:c,actualBoundingBoxAscent:l,actualBoundingBoxDescent:a}=s.measureText(e);return{width:Math.ceil(Math.max(u,r+c)),height:Math.ceil(l+a),x:Math.floor(r),y:Math.floor((l-a)/2)}}function L(e){let t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?x(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?x(t.height):null}}async function lt(e,t){let s=t.fill,o=e.color;if(s?.type==="pattern"&&o&&e.type!==K){let u=await U(s.src,o.toCss(!0));s.src=u,t.fill=s}}async function st(e,t,s,o){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await R(e.font)}catch{}let{width:u,height:r}=L(o);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){let{width:c,height:l,x:a,y:h}=Q(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});s[0]=u??c,s[1]=r??l,t.shape.x=a,t.shape.y=h;let p="angle"in e?e.angle:null;if(o?.rotation!=null&&(p=(p??0)+o.rotation),p){let d=p*(Math.PI/180),n=Math.abs(Math.sin(d)),i=Math.abs(Math.cos(d));s[1]=s[0]*n+s[1]*i}}}function rt(e,t,s,o,u){if(e.haloColor!=null&&e.haloSize!=null){u.masking??=s.map(()=>[]);let r=x(e.haloSize);o[0]+=r,o[1]+=r,s.unshift([k(z({},t),{fill:null,stroke:{color:e.haloColor,width:2*r,join:"round",cap:"round"}})]),u.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*C,height:o[1]+2*C},fill:[255,255,255],stroke:null},k(z({},t),{fill:[0,0,0,0],stroke:null})])}e.backgroundColor==null&&e.borderLineColor==null||(o[0]+=2*C,o[1]+=2*C,s.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:x(e.borderLineSize)}}]),u.masking?.unshift([]))}function J(e,t){return e>t?"dark":"light"}function ht(e,t){let s=typeof t?.size=="number"?t?.size:null,o=s!=null?x(s):null,u=t?.maxSize!=null?x(t.maxSize):null,r="angle"in e?e.angle:null;t?.rotation!=null&&(r=(r??0)+t.rotation);let c=D(e),l=F(e);ct(e,245)!=="dark"||t?.ignoreWhiteSymbols||(l=k(z({width:.75},l),{color:"#bdc3c7"}));let a=null,h={shape:null,fill:c,stroke:l,offset:[0,0]};l?.width&&(l.width=Math.min(l.width,at));let p=l?.width||0,d=t?.size!=null&&(t?.scale==null||t?.scale),n=0,i=0,M=!1;switch(e.type){case tt:{let f=e.style,{width:g,height:m}=L(t),b=g===m&&g!=null?g:o??Math.min(x(e.size),u||P);if(t?.useMarkerSymbolSize===!0&&g!==null&&m!==null){let y=Math.min(x(e.size),u||P);b=y>g&&y>m?Math.min(g,m):y}switch(n=b,i=b,f){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},d||(n+=p,i+=p);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[n,.5*i]},{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,i]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*i]},{command:"L",values:[.5*n,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p),r&&(M=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},d||(n+=p,i+=p),r&&(M=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,i]},{command:"M",values:[n,0]},{command:"L",values:[0,i]}]},r&&(M=!0);break;case"path":h.shape={type:"path",path:e.path||""},d||(n+=p,i+=p),r&&(M=!0),d=!0}break}case _:{let{width:f,height:g}=L(t),m=W(l).reduce((S,v)=>S+v,0),b=m&&Math.ceil(H/m),y=g??o??p,w=f??(m*b||H);if(d=!0,t?.geometry?.type==="polyline"&&t?.geometry?.extent){n=w,i=g??n;let S=1e3,v=.15*S;a=[n,i],i=a[0]>a[1]?S*a[1]/a[0]:S,n=a[0]>a[1]?S:S*a[0]/a[1],l?.width&&(l.width=l.width*S/(a[1]>a[0]?a[1]:a[0]),l.width>v&&(l.width=v)),h.shape={type:"path",path:G(t.geometry,n,i)}}else n=t?.maxSize!=null?Math.min(w,t.maxSize):w,i=y,l&&(l.width=y),h.shape={type:"path",path:[{command:"M",values:[y/2,i/2]},{command:"L",values:[n-y/2,i/2]}]};break}case K:case Y:{let f=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:g,height:m}=L(t);n=!f&&g!==m||g==null?o??ot:g,i=!f&&g!==m||m==null?n:m,d||(n+=p,i+=p),d=!0,t?.geometry?.extent&&t?.geometry?.type==="polygon"?(a=[n,i],i=a[0]>a[1]?1e3*a[1]/a[0]:1e3,n=a[0]>a[1]?1e3:1e3*a[0]/a[1],h.shape={type:"path",path:G(t.geometry,n,i)}):h.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:N.fill[0];break}case X:{let f=Math.min(x(e.width),u||P),g=Math.min(x(e.height),u||P),{width:m,height:b}=L(t),y=m===b&&m!=null?m:o??Math.max(f,g),w=e.width/e.height;n=w<=1?Math.ceil(y*w):y,i=w<=1?y:Math.ceil(y/w),h.shape={type:"image",x:-Math.round(n/2),y:-Math.round(i/2),width:n,height:i,src:e.url||""},r&&(M=!0);break}case et:{let f=e,g=t?.overrideText||f.text||nt,m=f.font,{width:b,height:y}=L(t),w=y??o??Math.min(x(m.size),u||P),{width:S,height:v}=Q(g,{weight:m.weight,size:w,family:m.family}),B=/[\uE600-\uE6FF]/.test(g);n=b??(B?w:S),i=B?w:v;let Z=.5*(B?w:v);B&&(Z+=5),h.shape={type:"text",text:g,x:f.xoffset||0,y:f.yoffset||Z,align:"middle",alignBaseline:f.verticalAlignment,decoration:m&&m.decoration,rotated:f.rotated,kerning:f.kerning},h.font=m&&{size:w,style:m.style,decoration:m.decoration,weight:m.weight,family:m.family};break}}return{shapeDescriptor:h,size:[n,i],outputSize:a,renderOptions:{node:t?.node,scale:d,opacity:t?.opacity,rotations:[r],useRotationSize:M,effectView:t?.effectView,ariaLabel:t?.ariaLabel}}}async function St(e,t){let{shapeDescriptor:s,size:o,renderOptions:u,outputSize:r}=ht(e,t);if(!s.shape)throw new q("symbolPreview: renderPreviewHTML2D","symbol not supported.");await lt(e,s),await st(e,s,o,t);let c=[[s]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){let a=.6*o[0];c.unshift([k(z({},s),{offset:[-a,0],fill:E(s.fill,-.3)})]),c.push([k(z({},s),{offset:[a,0],fill:E(s.fill,.3)})]),o[0]+=2*a,u.scale=!1}e.type==="text"&&rt(e,s,c,o,u);let l=V(c,o,u);if(r&&l){let a=l.nodeName.toLowerCase()==="img"?l:l.firstChild;a.nodeName.toLowerCase()==="svg"&&a.setAttribute("viewBox",`0 0 ${o[0].toString()} ${o[1].toString()}`),a.setAttribute("width",r[0].toString()),a.setAttribute("height",r[1].toString()),r.length>2&&(a.style.setProperty("padding-left",r[2]?.toString()+"px"),a.style.setProperty("padding-right",r[2]?.toString()+"px"),a.style.setProperty("padding-top",r[3]?.toString()+"px"),a.style.setProperty("padding-bottom",r[3]?.toString()+"px"),a.style.setProperty("box-sizing","border-box"))}return l}function ct(e,t=I){let s=D(e),o=F(e),u=!s||"type"in s?null:new A(s),r=o?.color?new A(o?.color):null,c=u?J(j(u),t):null,l=r?J(j(r),t):null;return l?c?c===l?c:t>=I?"light":"dark":l:c}export{ct as getContrastingBackgroundTheme,ht as getRenderSymbolParameters,St as previewSymbol2D};
