import{a as E}from"./chunk-YWEC6MDH.js";import"./chunk-JYUV3HWY.js";import{a as G}from"./chunk-NSWLMJDI.js";import"./chunk-XY4QPRKP.js";import"./chunk-UV6SBQOQ.js";import"./chunk-OWV7FEAY.js";import{d as _}from"./chunk-4X7VNDTG.js";import"./chunk-WIFM6OT5.js";import"./chunk-GI4NW5SA.js";import"./chunk-SU7IJ65K.js";import"./chunk-YSD7LK2L.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import{a as I}from"./chunk-7E723FQO.js";import"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import{a as D}from"./chunk-CUJB6F5L.js";import{a as U}from"./chunk-5NHJFBCW.js";import"./chunk-VMECOA4F.js";import"./chunk-JPMGMA4B.js";import"./chunk-PMVQ5DJK.js";import{a as T,b as J}from"./chunk-L2WNUKLP.js";import"./chunk-ZBX6HJOS.js";import"./chunk-DJW5LMRG.js";import"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-JTDXB5TK.js";import"./chunk-KD27XIJC.js";import{k as H}from"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-EM35R6FY.js";import"./chunk-6B5XFA6F.js";import"./chunk-NHEQ4TAR.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import{b as F,h as b}from"./chunk-QT6UNBJP.js";import{a as x,j as O}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import{c as g}from"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-XZIOXVVJ.js";import"./chunk-SXQPBCOX.js";import{m as C}from"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import{a as q}from"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as s}from"./chunk-QHVIRF5H.js";import{I as v}from"./chunk-WZDN6K3C.js";import{a as t}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";var P=g.ofType(E),l=class extends G{constructor(e){super(e),this.type="viewshed",this._extent=null}initialize(){this.addHandles(x(()=>this._computeExtent(),e=>{e.pending==null&&(this._extent=e.extent)},O))}get viewsheds(){return this._get("viewsheds")||new P}set viewsheds(e){this._set("viewsheds",T(e,this.viewsheds,P))}get spatialReference(){for(let e of this.viewsheds)if(e.observer!=null)return e.observer.spatialReference;return null}get extent(){return this._extent}get requiredPropertiesForEditing(){return this.viewsheds.items.map(({observer:e})=>e)}async waitComputeExtent(){let e=this._computeExtent();e.pending!=null&&await e.pending}_computeExtent(){let{spatialReference:e}=this;if(e==null)return{pending:null,extent:null};let i=this.viewsheds.filter(r=>r.observer!=null),c=i.map(r=>r.observer).toArray(),a=H(c,e);return a.pending!=null?{pending:a.pending,extent:null}:{pending:null,extent:a.geometries.map((r,p)=>{let M=i.at(p);return r!=null&&M!=null?this._computeViewshedExtent(this.viewsheds.at(p),r):null}).filter(r=>r!=null).reduce((r,p)=>Q(r,p),null)}}_computeViewshedExtent(e,i){let{farDistance:c,heading:a,tilt:r,horizontalFieldOfView:p,verticalFieldOfView:M}=e,{spatialReference:S}=i,R=p/2,z=M/2,L=c/S.metersPerUnit,B=[_.normalize(a-R),a,_.normalize(a+R)],u=C.fromPoint(i),f=y=>{let d=B.map(o=>_.normalize(o-y));if(d[0]>d[2]||p===360)return L;let m=d.map(o=>Math.abs(o>180?360-o:o)).reduce((o,w)=>o>w?w:o);return m>90?0:L*Math.cos(b(m))};u.xmax+=f(90),u.xmin-=f(-90),u.ymax+=f(0),u.ymin-=f(180);let h=i.z;if(h!=null){let y=h,d=h,m=r-90,o=F(m+z,-90,90),w=F(m-z,-90,90),A=S?.isGeographic?c:L;y+=A*N(o),d+=A*N(w);let K=k(z)*A,j=N(m)*K*(1-k(R));r<90&&(y-=j),r>90&&(d-=j),u.zmax=Math.max(y,h),u.zmin=Math.min(d,h)}return u}clear(){this.viewsheds.removeAll()}};function Q(e,i){return e==null?i:i==null?e:e.union(i)}function k(e){return Math.cos(b(e))}function N(e){return Math.sin(b(e))}t([s({type:["viewshed"]})],l.prototype,"type",void 0),t([s({cast:J,type:P,nonNullable:!0})],l.prototype,"viewsheds",null),t([s({readOnly:!0})],l.prototype,"spatialReference",null),t([s()],l.prototype,"_extent",void 0),t([s({readOnly:!0})],l.prototype,"extent",null),t([s({readOnly:!0})],l.prototype,"requiredPropertiesForEditing",null),l=t([v("esri.analysis.ViewshedAnalysis")],l);var V=l;var n=class extends I(D(U)){constructor(e){super(e),this.type="viewshed",this.operationalLayerType="ViewshedLayer",this.source=new V,this.opacity=1}initialize(){this.addHandles(x(()=>this.source,(e,i)=>{i!=null&&i.parent===this&&(i.parent=null),e!=null&&(e.parent=this)},O))}async load(){return this.addResolvingPromise(this.source.waitComputeExtent()),this}get spatialReference(){return this.source.spatialReference}get fullExtent(){return this.source.extent}releaseAnalysis(e){this.source===e&&(this.source=new V)}get analysis(){return this.source}set analysis(e){this.source=e}get viewsheds(){return this.source.viewsheds}set viewsheds(e){this.source.viewsheds=e}writeViewsheds(e,i,c,a){i.viewsheds=e.filter(r=>r.isValid()).map(r=>r.toJSON(a)).toJSON()}};t([s({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0),t([s({type:["ViewshedLayer"]})],n.prototype,"operationalLayerType",void 0),t([s({type:V,nonNullable:!0})],n.prototype,"source",void 0),t([s({readOnly:!0})],n.prototype,"spatialReference",null),t([s({readOnly:!0})],n.prototype,"fullExtent",null),t([s({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],n.prototype,"opacity",void 0),t([s({type:["show","hide"]})],n.prototype,"listMode",void 0),t([s({type:g.ofType(E),json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{ignoreOrigin:!0}}}}})],n.prototype,"viewsheds",null),t([q("web-scene","viewsheds")],n.prototype,"writeViewsheds",null),n=t([v("esri.layers.ViewshedLayer")],n);var Me=n;export{Me as default};
