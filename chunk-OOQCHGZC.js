import{a as d,b as T,c as $,d as L,e as ce,f as ue,n as fe,o as pe,p as we,q as de,r as he,s as me,t as ge}from"./chunk-A37JE6NL.js";import"./chunk-KRX2B2DE.js";import{a as ye}from"./chunk-Y62LISEO.js";import"./chunk-2UK4CKB6.js";import"./chunk-WW3SAFCJ.js";import"./chunk-XD6DLQ5C.js";import"./chunk-2VPSOQ3I.js";import"./chunk-Q25BGVIG.js";import{b as Q}from"./chunk-X25AT5DO.js";import"./chunk-W3BAYQCT.js";import{c as v}from"./chunk-N64WAD57.js";import{D as J,G as ie,H as Z,J as N,M as f,P as le,_ as se,a as ae,b as te,c as _,d as K,e as G,h as g,i as U,j as p,k as y,l as O,n as b,r as z,s as H,u as Y,w as E,z as C}from"./chunk-MGSAXUID.js";import"./chunk-OCNYIIP3.js";import"./chunk-M2IX3KDU.js";import"./chunk-WI3QVC6K.js";import{a as i,b as l,e as W}from"./chunk-GPURZ6GA.js";import"./chunk-I7FLOUNH.js";import"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import"./chunk-W26XKMAT.js";import"./chunk-CDP4MSRO.js";import"./chunk-2NP7F5RO.js";import"./chunk-7QY3BMVN.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-4G7UTTZJ.js";import"./chunk-NRBJLISB.js";import"./chunk-FENRIY2T.js";import"./chunk-WDETDPZG.js";import{a as A,c as M,d as w,f as R,g as oe}from"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-XZIOXVVJ.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import{a as j}from"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import{a as V}from"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import"./chunk-QHVIRF5H.js";import"./chunk-WZDN6K3C.js";import"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";async function re(r,e){let n=[];for(let o=0;o<e.arguments.length;o++)n.push(await u(r,e.arguments[o]));return n}async function I(r,e,n){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,await re(r,e))}var ee=class extends te{constructor(e,n){super(),this.definition=null,this.context=null,this.definition=e,this.context=n}createFunction(e){return(...n)=>{let o={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(o.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,null);return X(this.definition,o,n,null)}}call(e,n){return D(e,n,(o,a,t)=>{let s={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(s.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,n);return X(this.definition,s,t,n)})}marshalledCall(e,n,o,a){return a(e,n,async(t,s,c)=>{let x={spatialReference:e.spatialReference,globalScope:o.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return c=c.map(S=>!b(S)||S instanceof G?S:_(S,e,a)),_(await X(this.definition,x,c,n),o,a)})}},k=class extends ae{constructor(e){super(),this.source=e}global(e){let n=this.executingContext.globalScope[d(e)];if(b(n.value)&&!(n.value instanceof G)){let o=new G;o.fn=n.value,o.parameterEvaluator=D,o.context=this.executingContext,n.value=o}return n.value}setGlobal(e,n){if(b(n))throw new l(null,i.AssignModuleFunction,null);this.executingContext.globalScope[d(e)]={value:n}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=d(e)),this.executingContext.exports[e]!==void 0}async loadModule(e){let n=e.spatialReference;n==null&&(n=new V({wkid:102100})),this.moduleScope=Me({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:n,services:e.services,libraryResolver:new T(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??ke,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await ne(this.executingContext,this.source.syntax)}};async function D(r,e,n){return e.preparsed===!0?n(r,null,e.arguments):n(r,e,await re(r,e))}async function u(r,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"UpdateExpression":return await De(r,e);case"AssignmentExpression":return await Ke(r,e);case"TemplateLiteral":return await Ye(r,e);case"Identifier":return P(r,e);case"MemberExpression":return await je(r,e);case"Literal":return e.value;case"CallExpression":return await He(r,e);case"UnaryExpression":return await We(r,e);case"BinaryExpression":return await _e(r,e);case"LogicalExpression":return await ze(r,e);case"ArrayExpression":return await Te(r,e);case"ObjectExpression":return await Ae(r,e);default:throw new l(r,i.Unrecognized,e)}}catch(n){throw W(r,e,n)}}async function m(r,e){e.breakpoint&&await e.breakpoint();try{switch(e.type){case"ImportDeclaration":return await qe(r,e);case"ExportNamedDeclaration":return await Pe(r,e);case"VariableDeclaration":return await xe(r,e,0);case"BlockStatement":return await ne(r,e);case"FunctionDeclaration":return await Le(r,e);case"ReturnStatement":return await Ze(r,e);case"IfStatement":return await Ue(r,e);case"ExpressionStatement":return await Ge(r,e);case"ForStatement":return await Ce(r,e);case"WhileStatement":return await Re(r,e);case"ForInStatement":return await Ee(r,e);case"ForOfStatement":return await Be(r,e);case"BreakStatement":return y;case"EmptyStatement":return p;case"ContinueStatement":return O;default:throw new l(r,i.Unrecognized,e)}}catch(n){throw W(r,e,n)}}async function Ae(r,e){let n=[];for(let s=0;s<e.properties.length;s++){let c=e.properties[s],x=await u(r,c.value),S=c.key.type==="Identifier"?c.key.name:await u(r,c.key);n[s]={key:S,value:x}}let o={},a=new Map;for(let s=0;s<n.length;s++){let c=n[s];if(b(c.value))throw new l(r,i.NoFunctionInDictionary,e);if(w(c.key)===!1)throw new l(r,i.KeyMustBeString,e);let x=c.key.toString(),S=x.toLowerCase();a.has(S)?x=a.get(S):a.set(S,x),c.value===p?o[x]=null:o[x]=c.value}let t=new v(o);return t.immutable=!1,t}async function Re(r,e){let n=await u(r,e.test);if(n===!1)return p;if(n!==!0)throw new l(r,i.BooleanConditionRequired,e);for(;n===!0;){let o=await m(r,e.body);if(o===y)break;if(o instanceof g)return o;if(n=await u(r,e.test),n!==!0&&n!==!1)throw new l(r,i.BooleanConditionRequired,e)}return p}async function Ce(r,e){try{for(e.init!==null&&(e.init.type==="VariableDeclaration"?await m(r,e.init):await u(r,e.init));;){if(e.test!==null){let o=await u(r,e.test);if(r.abortSignal?.aborted===!0)throw new l(r,i.Cancelled,e);if(o===!1)break;if(o!==!0)throw new l(r,i.BooleanConditionRequired,e)}let n=await m(r,e.body);if(n===y)break;if(n instanceof g)return n;e.update!==null&&await u(r,e.update)}return p}catch(n){throw n}}async function q(r,e,n,o,a="i"){let t=n.length;for(let s=0;s<t;s++){if(a==="k"){if(s>=n.length)throw new l(r,i.OutOfBounds,e);o.value=n[s]}else o.value=s;let c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function be(r,e,n,o,a="i"){let t=n.length();for(let s=0;s<t;s++){o.value=a==="k"?n.get(s):s;let c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function ve(r,e,n,o){let a=n.iterator(r.abortSignal),t;for(;(t=await a.next())!=null;){let s=Q.createFromGraphicLikeObject(t.geometry,t.attributes,n,r.timeZone);s._underlyingGraphic=t,o.value=s;let c=await m(r,e.body);if(c===y)break;if(c instanceof g)return c}return p}async function Ne(r,e,n,o){for(let a of n.keys()){let t=n.field(a);o.value=new v({key:a,value:t});let s=await m(r,e.body);if(s===y)break;if(s instanceof g)return s}return p}async function Oe(r,e,n,o){for(let a of $(n)){let t=L(n,a,r,e,1);o.value=new v({key:a,value:t});let s=await m(r,e.body);if(s===y)break;if(s instanceof g)return s}return p}async function Ee(r,e){let n=await u(r,e.right);e.left.type==="VariableDeclaration"&&await m(r,e.left);let o=d(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left),a=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(a=r.localScope[o]),a===null&&r.globalScope[o]!==void 0&&(a=r.globalScope[o]),a===null)throw new l(r,i.InvalidIdentifier,e);return R(n)||w(n)?await q(r,e,n,a):C(n)?await be(r,e,n,a):n instanceof v||E(n)?await q(r,e,n.keys(),a,"k"):Y(n)?await ve(r,e,n,a):z(n)?await q(r,e,$(n),a,"k"):p}async function Be(r,e){let n=await u(r,e.right);e.left.type==="VariableDeclaration"&&await m(r,e.left);let o=d(e.left.type==="VariableDeclaration"?e.left.declarations[0].id:e.left),a=null;if(r.localScope!=null&&r.localScope[o]!==void 0&&(a=r.localScope[o]),a===null&&r.globalScope[o]!==void 0&&(a=r.globalScope[o]),a===null)throw new l(r,i.InvalidIdentifier,e);return R(n)||w(n)?await q(r,e,n,a,"k"):C(n)?await be(r,e,n,a,"k"):n instanceof v||E(n)?await Ne(r,e,n,a):Y(n)?await ve(r,e,n,a):z(n)?await Oe(r,e,n,a):p}async function De(r,e){let n=e.argument;if(n.type==="CallExpression")throw new l(r,i.NeverReach,e);if(n.type==="MemberExpression"){let t=await u(r,n.object),s,c;if(n.computed===!0)s=await u(r,n.property);else{if(n.property.type!=="Identifier")throw new l(r,i.Unrecognized,e);s=n.property.name}if(R(t)){if(!A(s))throw new l(r,i.ArrayAccessorMustBeNumber,e);if(s<0&&(s=t.length+s),s<0||s>=t.length)throw new l(r,i.OutOfBounds,e);c=f(t[s]),t[s]=e.operator==="++"?c+1:c-1}else if(t instanceof v){if(w(s)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(t.hasField(s)!==!0)throw new l(r,i.FieldNotFound,e,{key:s});c=f(t.field(s)),t.setField(s,e.operator==="++"?c+1:c-1)}else if(t instanceof k){if(w(s)===!1)throw new l(r,i.ModuleAccessorMustBeString,e);if(t.hasGlobal(s)!==!0)throw new l(r,i.ModuleExportNotFound,e);c=f(t.global(s)),t.setGlobal(s,e.operator==="++"?c+1:c-1)}else{if(!H(t))throw C(t)?new l(r,i.Immutable,e):new l(r,i.InvalidParameter,e);if(w(s)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(t.hasField(s)!==!0)throw new l(r,i.FieldNotFound,e,{key:s});c=f(t.field(s)),t.setField(s,e.operator==="++"?c+1:c-1)}return e.prefix===!1?c:e.operator==="++"?c+1:c-1}let o=d(n),a;if(r.localScope!=null&&r.localScope[o]!==void 0)return a=f(r.localScope[o].value),r.localScope[o]={value:e.operator==="++"?a+1:a-1},e.prefix===!1?a:e.operator==="++"?a+1:a-1;if(r.globalScope[o]!==void 0)return a=f(r.globalScope[o].value),r.globalScope[o]={value:e.operator==="++"?a+1:a-1},e.prefix===!1?a:e.operator==="++"?a+1:a-1;throw new l(r,i.InvalidIdentifier,e)}function F(r,e,n,o,a){switch(e){case"=":return r===p?null:r;case"/=":return f(n)/f(r);case"*=":return f(n)*f(r);case"-=":return f(n)-f(r);case"+=":return w(n)||w(r)?N(n)+N(r):f(n)+f(r);case"%=":return f(n)%f(r);default:throw new l(a,i.UnsupportedOperator,o)}}async function Ke(r,e){let n=e.left;if(n.type==="MemberExpression"){let a=await u(r,n.object),t;if(n.computed===!0)t=await u(r,n.property);else{if(n.property.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);t=n.property.name}let s=await u(r,e.right);if(R(a)){if(!A(t))throw new l(r,i.ArrayAccessorMustBeNumber,e);if(t<0&&(t=a.length+t),t<0||t>a.length)throw new l(r,i.OutOfBounds,e);if(t===a.length){if(e.operator!=="=")throw new l(r,i.OutOfBounds,e);a[t]=F(s,e.operator,a[t],e,r)}else a[t]=F(s,e.operator,a[t],e,r)}else if(a instanceof v){if(w(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasField(t)===!0)a.setField(t,F(s,e.operator,a.field(t),e,r));else{if(e.operator!=="=")throw new l(r,i.FieldNotFound,e,{key:t});a.setField(t,F(s,e.operator,null,e,r))}}else if(a instanceof k){if(w(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasGlobal(t)!==!0)throw new l(r,i.ModuleExportNotFound,e);a.setGlobal(t,F(s,e.operator,a.global(t),e,r))}else{if(!H(a))throw C(a)?new l(r,i.Immutable,e):new l(r,i.InvalidParameter,e);if(w(t)===!1)throw new l(r,i.KeyAccessorMustBeString,e);if(a.hasField(t)===!0)a.setField(t,F(s,e.operator,a.field(t),e,r));else{if(e.operator!=="=")throw new l(r,i.FieldNotFound,e,{key:t});a.setField(t,F(s,e.operator,null,e,r))}}return p}let o=d(n);if(r.localScope!=null&&r.localScope[o]!==void 0){let a=await u(r,e.right);return r.localScope[o]={value:F(a,e.operator,r.localScope[o].value,e,r)},p}if(r.globalScope[o]!==void 0){let a=await u(r,e.right);return r.globalScope[o]={value:F(a,e.operator,r.globalScope[o].value,e,r)},p}throw new l(r,i.InvalidIdentifier,e)}async function Ge(r,e){let n=await u(r,e.expression);return n===p?p:new U(n)}async function Ue(r,e){let n=await u(r,e.test);if(n===!0)return m(r,e.consequent);if(n===!1)return e.alternate!==null?m(r,e.alternate):p;throw new l(r,i.BooleanConditionRequired,e)}async function ne(r,e){return Se(r,e,0)}async function Se(r,e,n){if(n>=e.body.length)return p;let o=await m(r,e.body[n]);return o instanceof g||o===y||o===O||n===e.body.length-1?o:Se(r,e,n+1)}async function Ze(r,e){if(e.argument===null)return new g(p);let n=await u(r,e.argument);return new g(n)}async function Le(r,e){let n=d(e.id);return r.globalScope[n]={value:new ee(e,r)},p}async function qe(r,e){let n=d(e.specifiers[0].local),o=r.libraryResolver.loadLibrary(n),a;return r.libraryResolver._moduleSingletons?.has(o.uri)?a=r.libraryResolver._moduleSingletons.get(o.uri):(a=new k(o),await a.loadModule(r),r.libraryResolver._moduleSingletons?.set(o.uri,a)),r.globalScope[n]={value:a},p}async function Pe(r,e){if(await m(r,e.declaration),e.declaration.type==="FunctionDeclaration")r.exports[d(e.declaration.id)]="function";else if(e.declaration.type==="VariableDeclaration")for(let n of e.declaration.declarations)r.exports[d(n.id)]="variable";return p}async function xe(r,e,n){return n>=e.declarations.length?p:(await Ve(r,e.declarations[n]),n===e.declarations.length-1||await xe(r,e,n+1),p)}async function Ve(r,e){let n=null;if(n=e.init===null?null:await u(r,e.init),r.localScope!==null){if(n===p&&(n=null),e.id.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);let a=d(e.id);return void(r.localScope!=null&&(r.localScope[a]={value:n}))}if(e.id.type!=="Identifier")throw new l(r,i.InvalidIdentifier,e);let o=d(e.id);n===p&&(n=null),r.globalScope[o]={value:n}}async function je(r,e){let n=await u(r,e.object);if(n===null)throw new l(r,i.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(n instanceof v||E(n))return n.field(e.property.name);if(n instanceof j)return L(n,e.property.name,r,e);if(n instanceof k){if(!n.hasGlobal(e.property.name))throw new l(r,i.InvalidIdentifier,e);return n.global(e.property.name)}throw new l(r,i.InvalidMemberAccessKey,e)}throw new l(r,i.InvalidMemberAccessKey,e)}let o=await u(r,e.property);if(n instanceof v||E(n)){if(w(o))return n.field(o);throw new l(r,i.InvalidMemberAccessKey,e)}if(n instanceof k){if(w(o))return n.global(o);throw new l(r,i.InvalidMemberAccessKey,e)}if(n instanceof j){if(w(o))return L(n,o,r,e);throw new l(r,i.InvalidMemberAccessKey,e)}if(R(n)){if(A(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new l(r,i.OutOfBounds,e);return n[o]}throw new l(r,i.InvalidMemberAccessKey,e)}if(C(n)){if(A(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length()+o),o>=n.length()||o<0)throw new l(r,i.OutOfBounds,e);return n.get(o)}throw new l(r,i.InvalidMemberAccessKey,e)}if(w(n)){if(A(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=n.length+o),o>=n.length||o<0)throw new l(r,i.OutOfBounds,e);return n[o]}throw new l(r,i.InvalidMemberAccessKey,e)}throw new l(r,i.InvalidMemberAccessKey,e)}async function We(r,e){let n=await u(r,e.argument);if(M(n)){if(e.operator==="!")return!n;if(e.operator==="-")return-1*f(n);if(e.operator==="+")return 1*f(n);if(e.operator==="~")return~f(n);throw new l(r,i.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*f(n);if(e.operator==="+")return 1*f(n);if(e.operator==="~")return~f(n);throw new l(r,i.UnsupportedUnaryOperator,e)}async function Te(r,e){let n=[];for(let o=0;o<e.elements.length;o++)n.push(await u(r,e.elements[o]));for(let o=0;o<n.length;o++){if(b(n[o]))throw new l(r,i.NoFunctionInArray,e);n[o]===p&&(n[o]=null)}return n}async function _e(r,e){let n=await u(r,e.left),o=await u(r,e.right);switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return se(f(n),f(o),e.operator);case"==":return Z(n,o);case"!=":return!Z(n,o);case"<":case">":case"<=":case">=":return ie(n,o,e.operator);case"+":return w(n)||w(o)?N(n)+N(o):f(n)+f(o);case"-":return f(n)-f(o);case"*":return f(n)*f(o);case"/":return f(n)/f(o);case"%":return f(n)%f(o);default:throw new l(r,i.UnsupportedOperator,e)}}async function ze(r,e){let n=await u(r,e.left);if(!M(n))throw new l(r,i.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":{if(n===!0)return n;let o=await u(r,e.right);if(M(o))return o;throw new l(r,i.LogicExpressionOrAnd,e)}case"&&":{if(n===!1)return n;let o=await u(r,e.right);if(M(o))return o;throw new l(r,i.LogicExpressionOrAnd,e)}default:throw new l(r,i.LogicExpressionOrAnd,e)}}function P(r,e){let n=d(e);if(r.localScope!=null&&r.localScope[n]!==void 0)return r.localScope[n].value;if(r.globalScope[n]!==void 0)return r.globalScope[n].value;throw new l(r,i.InvalidIdentifier,e)}async function He(r,e){if(e.callee.type==="MemberExpression"){let o=await u(r,e.callee.object);if(!(o instanceof k))throw new l(r,i.FunctionNotFound,e);let a=e.callee.computed===!1?e.callee.property.name:await u(r,e.callee.property);if(!o.hasGlobal(a))throw new l(r,i.FunctionNotFound,e);let t=o.global(a);if(!b(t))throw new l(r,i.CallNonFunction,e);return t.call(r,e)}if(e.callee.type!=="Identifier")throw new l(r,i.FunctionNotFound,e);let n=d(e.callee);if(r.localScope!=null&&r.localScope[n]!==void 0){let o=r.localScope[n];if(b(o.value))return o.value.call(r,e);throw new l(r,i.CallNonFunction,e)}if(r.globalScope[n]!==void 0){let o=r.globalScope[n];if(b(o.value))return o.value.call(r,e);throw new l(r,i.CallNonFunction,e)}throw new l(r,i.FunctionNotFound,e)}async function Ye(r,e){let n="",o=0;for(let a of e.quasis)if(n+=a.value?a.value.cooked:"",a.tail===!1){if(e.expressions[o]){let t=await u(r,e.expressions[o]);if(b(t))throw new l(r,i.NoFunctionInTemplateLiteral,e);n+=N(t)}o++}return n}var h={};async function Fe(r,e,n,o){let a=await u(r,e.arguments[n]);if(Z(a,o))return u(r,e.arguments[n+1]);let t=e.arguments.length-n;return t===1?u(r,e.arguments[n]):t===2?null:t===3?u(r,e.arguments[n+2]):Fe(r,e,n+2,o)}async function Ie(r,e,n,o){if(o===!0)return u(r,e.arguments[n+1]);if(e.arguments.length-n===3)return u(r,e.arguments[n+2]);let a=await u(r,e.arguments[n+2]);if(M(a)===!1)throw new l(r,i.ModuleExportNotFound,e.arguments[n+2]);return Ie(r,e,n+2,a)}async function X(r,e,n,o){let a=r.body;if(n.length!==r.params.length)throw new l(e,i.WrongNumberOfParameters,null);for(let s=0;s<n.length;s++){let c=r.params[s];c.type==="Identifier"&&e.localScope!=null&&(e.localScope[d(c)]={value:n[s]})}let t=await m(e,a);if(t instanceof g)return t.value;if(t===y)throw new l(e,i.UnexpectedToken,o);if(t===O)throw new l(e,i.UnexpectedToken,o);return t instanceof U?t.value:t}pe(h,I),ge(h,I),we(h,I,P),he(h,I),de(h,I),me(h,I),ye({functions:h,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:I,standardFunctionAsync:D}),h.iif=async function(r,e){J(e.arguments===null?[]:e.arguments,3,3,r,e);let n=await u(r,e.arguments[0]);if(M(n)===!1)throw new l(r,i.BooleanConditionRequired,e);return u(r,n?e.arguments[1]:e.arguments[2])},h.defaultvalue=async function(r,e){J(e.arguments===null?[]:e.arguments,2,3,r,e);let n=await u(r,e.arguments[0]);if(e.arguments.length===3){let o=await u(r,e.arguments[1]),a=ce(n,o);return a!=null&&a!==""?a:u(r,e.arguments[2])}return n==null||n===""?u(r,e.arguments[1]):n},h.decode=async function(r,e){if(e.arguments.length<2)throw new l(r,i.WrongNumberOfParameters,e);if(e.arguments.length===2)return u(r,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new l(r,i.WrongNumberOfParameters,e);return Fe(r,e,1,await u(r,e.arguments[0]))},h.when=async function(r,e){if(e.arguments.length<3)throw new l(r,i.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new l(r,i.WrongNumberOfParameters,e);let n=await u(r,e.arguments[0]);if(M(n)===!1)throw new l(r,i.BooleanConditionRequired,e.arguments[0]);return Ie(r,e,0,n)};var Je={fixSpatialReference:le,parseArguments:re,standardFunction:I,standardFunctionAsync:D,evaluateIdentifier:P};for(let r in h)h[r]={value:new K(h[r])};var B=function(){};function Me(r,e,n){let o=new B;r==null&&(r={}),e==null&&(e={});let a=new v({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,o.textformatting={value:a};for(let t in e)o[t]={value:new K(e[t])};for(let t in r)o[t]={value:oe(r[t])?Q.createFromGraphic(r[t],n):r[t]};return o}function ke(r){console.log(r)}B.prototype=h,B.prototype.infinity={value:Number.POSITIVE_INFINITY},B.prototype.pi={value:Math.PI};var br=Je;function $e(r){let e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:I,standardFunctionAsync:D,evaluateIdentifier:P};for(let n=0;n<r.length;n++)r[n].registerFunctions(e);for(let n in e.functions)h[n]={value:new K(e.functions[n])},B.prototype[n]=h[n];for(let n=0;n<e.signatures.length;n++)ue(e.signatures[n],"async")}async function vr(r,e){let n=e.spatialReference;n==null&&(n=new V({wkid:102100}));let o=null;r.usesModules&&(o=new T(new Map,r.loadedModules));let a=Me(e.vars,e.customfunctions,e.timeZone),t={spatialReference:n,services:e.services,exports:{},libraryResolver:o,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:a,console:e.console??ke,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},s=await ne(t,r);if(s instanceof g||s instanceof U){let c=s.value;if(c===p)return null;if(b(c))throw new l(t,i.IllegalResult,null);return c}if(s===p)return null;throw s===y?new l(t,i.IllegalResult,null):s===O?new l(t,i.IllegalResult,null):new l(t,i.NeverReach,null)}$e([fe]);export{vr as executeScript,$e as extend,br as functionHelper};
