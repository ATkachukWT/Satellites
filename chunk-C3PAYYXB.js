import{a as x}from"./chunk-FYZRIMPP.js";import{b as q}from"./chunk-TOH4K6HW.js";import{i as S,r as P,t as Z}from"./chunk-TPFJWNIU.js";import{a as y,d as T,e as g,f as E}from"./chunk-FENRIY2T.js";import{n as k}from"./chunk-B3FO6PT7.js";import{f as h,h as j,i as A}from"./chunk-Z5Q7KLA4.js";import{B as p,C as f,ka as _,m,p as F,u}from"./chunk-KGVXGH6H.js";import{a as B}from"./chunk-SBHKMV3P.js";import{P as M}from"./chunk-CKJ56T2Q.js";import{t as z}from"./chunk-UHRSAPGQ.js";import{w as v}from"./chunk-V76GWARL.js";var d=[0,0];function U(e,i){if(!i)return null;if("x"in i){let n={x:0,y:0};return[n.x,n.y]=e(i.x,i.y,d),i.z!=null&&(n.z=i.z),i.m!=null&&(n.m=i.m),n}if("xmin"in i){let n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(i.xmin,i.ymin,d),[n.xmax,n.ymax]=e(i.xmax,i.ymax,d),i.hasZ&&(n.zmin=i.zmin,n.zmax=i.zmax,n.hasZ=!0),i.hasM&&(n.mmin=i.mmin,n.mmax=i.mmax,n.hasM=!0),n}return"rings"in i?{rings:N(i.rings,e),hasM:i.hasM,hasZ:i.hasZ}:"paths"in i?{paths:N(i.paths,e),hasM:i.hasM,hasZ:i.hasZ}:"points"in i?{points:O(i.points,e),hasM:i.hasM,hasZ:i.hasZ}:null}function N(e,i){let n=[];for(let t of e)n.push(O(t,i));return n}function O(e,i){let n=[];for(let t of e){let r=i(t[0],t[1],[0,0]);n.push(r),t.length>2&&r.push(t[2]),t.length>3&&r.push(t[3])}return n}async function w(e,i){if(!e||!i)return;let n=Array.isArray(e)?e.map(t=>t.geometry!=null?t.geometry.spatialReference:null).filter(v):[e];await Z(n.map(t=>({source:t,dest:i})))}var D=U.bind(null,j),J=U.bind(null,A);function b(e,i,n,t){if(!e)return null;if(n||(n=i,i=e.spatialReference),!p(i)||!p(n)||m(i,n))return e;if(h(i,n)){let r=u(n)?D(e):J(e);return r.spatialReference=n,r}return S(x,[e],i,n,null,t)[0]}var R=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(i,n,t,r){if(!i?.length||!n||!t||m(n,t))return i;let s={geometries:i,inSpatialReference:n,outSpatialReference:t,geographicTransformation:r,resolve:M()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;let i=this._jobs.shift();if(!i)return;let{geometries:n,inSpatialReference:t,outSpatialReference:r,resolve:s,geographicTransformation:o}=i;h(t,r)?u(r)?s(n.map(D)):s(n.map(J)):s(S(x,n,t,r,o,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},Q=new R;function ne(e,i,n,t){return Q.push(e,i,n,t)}var W=new B({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),L=Object.freeze({}),G="frequency";async function he(e,i,n){let t=e.bin;return t.onField&&(t.onField=t.onField.trim()),t.onExpression?.value&&(t.onExpression.value=t.onExpression.value.trim()),t.splitBy&&(t.splitBy.value&&(t.splitBy.value=t.splitBy.value.trim()),t.splitBy.outAlias&&(t.splitBy.outAlias=t.splitBy.outAlias.trim())),t.stackBy&&(t.stackBy.value&&(t.stackBy.value=t.stackBy.value.trim()),t.stackBy.outAlias&&(t.stackBy.outAlias=t.stackBy.outAlias.trim())),"normalizationField"in t.parameters&&t.parameters.normalizationField&&(t.parameters.normalizationField=t.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:G}]),K(e,i,n)}async function K(e,i,n){let{outFields:t,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:o}=e;if(t)for(let a=0;a<t.length;a++)t[a]=t[a].trim();if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),$(e,i,n)}async function $(e,i,n){if(!e)return null;let{where:t}=e;if(e.where=t=t?.trim(),(!t||/^1 *= *1$/.test(t)||i&&i===t)&&(e.where=null),!e.geometry)return e;let r=await V(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){let{spatialReference:s}=e.geometry;r=k(r),r.spatialReference=s}if(r){await w(r.spatialReference,n),r=C(r,n);let s=(await q(E(r)))[0];if(s==null)throw L;let o="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,a=o&&I(r,n)?{densificationStep:8*o}:void 0,l=s.toJSON(),c=b(l,l.spatialReference,n,a);if(!c)throw L;c.spatialReference=n,e.geometry=c}return e}function I(e,i){if(!e)return!1;let n=e.spatialReference;return(y(e)||g(e)||T(e))&&!m(n,i)&&!P(n,i)}function C(e,i){let n=e.spatialReference;return I(e,i)&&y(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function V(e){let{distance:i,units:n}=e,t=e.geometry;if(i==null||"vertexAttributes"in t)return t;let r=t.spatialReference,s=n?W.fromJSON(n):_(r),o=r&&(F(r)||u(r))?t:await w(r,f).then(()=>b(t,f)),a=await import("./chunk-W4FYX4SD.js");await a.load();let l=a.execute(o,i||1,{unit:s})??void 0;if(!l||!g(l)||l.rings.length===0)throw new z("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return l}function ye(e,i){return e==null?null:typeof e=="string"?i?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e}export{w as a,b,ne as c,W as d,L as e,he as f,K as g,$ as h,ye as i};
