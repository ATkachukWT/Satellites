import{m as B,n as W}from"./chunk-53QT4ZXE.js";import{p as A,q as E}from"./chunk-IPR4SOKY.js";import{a as L}from"./chunk-WPZN772I.js";import{a as z,b as F,c as $}from"./chunk-44S2QQS2.js";import{a as H}from"./chunk-JTDXB5TK.js";import{a as q}from"./chunk-NRBJLISB.js";import{m as S}from"./chunk-LFH24RLM.js";import{n as R}from"./chunk-Z5Q7KLA4.js";import{a as k}from"./chunk-4XZ6X7MQ.js";import{E as p}from"./chunk-ETE32IYO.js";import{f as J}from"./chunk-SG7CQU4O.js";import{H as n}from"./chunk-QHVIRF5H.js";import{I as c,x as C}from"./chunk-WZDN6K3C.js";import{a as i}from"./chunk-QGVBCWUY.js";import{a as O,b as j}from"./chunk-N2WTMF3X.js";var l=class extends H.ClonableMixin(J){constructor(t){super(t),this.name=void 0,this.method="none",this.value=void 0,this.bandIds=void 0,this.renderer=void 0}};i([n({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),i([n({type:["raster-function-template","variable","none"],json:{write:{isRequired:!0}}}),q({rasterFunctionTemplate:"raster-function-template",variable:"variable",none:"none"})],l.prototype,"method",void 0),i([n({type:String,json:{write:{isRequired:!0}}})],l.prototype,"value",void 0),i([n({type:[C],json:{write:{isRequired:!0}}})],l.prototype,"bandIds",void 0),i([n({types:B,json:{write:!0,origins:{"web-scene":{types:W,write:{overridePolicy:t=>({enabled:t&&t.type!=="vector-field"&&t.type!=="flow"})}}}}})],l.prototype,"renderer",void 0),l=i([c("esri.renderers.support.RasterPresetRenderer")],l);var X=l;var Ie=t=>{let r=class extends t{constructor(){super(...arguments),this.activePresetRendererName=null,this.presetRenderers=null}};return i([n({type:String,json:{name:"layerDefinition.activePresetRendererName",write:{allowNull:!0}}})],r.prototype,"activePresetRendererName",void 0),i([n({type:[X],json:{name:"layerDefinition.presetRenderers",write:!0}})],r.prototype,"presetRenderers",void 0),r=i([c("esri.layers.mixins.RasterPresetRendererMixin")],r),r};async function Y(t,r,u){let w=F(t),{rasterFunction:f,sourceJSON:_}=r||{},U=f?JSON.stringify(f.rasterFunctionDefinition||f):null,G=$(j(O({},w.query),{renderingRule:U,f:"json"})),m=z(G,u);t=w.path;let e=_||await p(t,m).then(a=>a.data),K=e.hasRasterAttributeTable?p(`${t}/rasterAttributeTable`,m):null,Q=e.hasColormap?p(`${t}/colormap`,m):null,Z=e.hasHistograms?p(`${t}/histograms`,m):null,ee=e.currentVersion>=10.3?p(`${t}/keyProperties`,m):null,te=e.hasMultidimensions?p(`${t}/multidimensionalInfo`,m):null,s=await Promise.allSettled([K,Q,Z,ee,te]),h=null;if(e.minValues&&e.minValues.length===e.bandCount){h=[];for(let a=0;a<e.minValues.length;a++)h.push({min:e.minValues[a],max:e.maxValues[a],avg:e.meanValues[a],stddev:e.stdvValues[a]})}let V=S.fromJSON(e.extent),I=Math.ceil(V.width/e.pixelSizeX-.1),D=Math.ceil(V.height/e.pixelSizeY-.1),y=k.fromJSON(e.spatialReference||e.extent.spatialReference),T=s[0].status==="fulfilled"?s[0].value?.data:null,re=T?.features?.length?L.fromJSON(T):null,M=s[1].status==="fulfilled"?s[1].value?.data.colormap:null,ae=M?.length?M:null,N=s[2].status==="fulfilled"?s[2].value?.data.histograms:null,ie=N?.[0]?.counts?.length?N:null,d=s[3].status==="fulfilled"?s[3].value?.data??{}:{},P=s[4].status==="fulfilled"?s[4].value?.data.multidimensionalInfo:null,v=P?.variables?.length?P:null;v&&v.variables.forEach(a=>{a.statistics?.length&&a.statistics.forEach(o=>{o.avg=o.mean,o.stddev=o.standardDeviation}),a.dimensions?.forEach(o=>{o.name!=="StdTime"||o.recurring||o.unit||(o.unit="ISO8601")})});let{defaultVariable:g,serviceDataType:b}=e;g&&g!==d.DefaultVariable&&(d.DefaultVariable=g),b?.includes("esriImageServiceDataTypeVector")&&!b.includes(d.DataType)&&(d.DataType=b.replace("esriImageServiceDataType",""));let x=e.noDataValue;e.noDataValues?.length&&e.noDataValues.some(a=>a!==x)&&(x=e.noDataValues);let se=e.transposeInfo?new A({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:"lerc",origin:new R({x:e.extent.xmin,y:e.extent.ymax,spatialReference:y}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(I,D))/Math.LN2-8)),transposeInfo:e.transposeInfo}):void 0;return new E({width:I,height:D,bandCount:e.bandCount,extent:S.fromJSON(e.extent),spatialReference:y,pixelSize:new R({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:y}),pixelType:e.pixelType.toLowerCase(),statistics:h,attributeTable:re,colormap:ae,histograms:ie,keyProperties:d,noDataValue:x,multidimensionalInfo:v,storageInfo:se})}function qe(t,r,u){return Y(t,{sourceJSON:r},u)}function ze(t,r,u){return Y(t,{rasterFunction:r},u)}function Fe(t,r){t.attributeTable||(r.hasRasterAttributeTable=!1),t.histograms||(r.hasHistograms=!1),t.colormap||(r.hasColormap=!1),t.multidimensionalInfo||(r.hasMultidimensions=!1)}export{qe as a,ze as b,Fe as c,Ie as d};
