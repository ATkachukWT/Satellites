import{a as de,b as me,c as ue,d as ye,e as fe}from"./chunk-T6GZUL7P.js";import"./chunk-65A5HIL4.js";import{a as le}from"./chunk-4QXRIFQV.js";import"./chunk-KAFWB3JH.js";import"./chunk-WOGTXK7W.js";import{a as V,d as G}from"./chunk-CQUBHG54.js";import"./chunk-K3Z3MI77.js";import{a as ae}from"./chunk-YAZINLP3.js";import{c as te}from"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import{b as ce}from"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import{b as B}from"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import"./chunk-HBMVPT4U.js";import{a as z}from"./chunk-L6ZFUQTH.js";import{a as se}from"./chunk-4MB4OYWM.js";import"./chunk-OVJTX4VC.js";import{c as re}from"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import{b as $,c as ne}from"./chunk-QDXM6RGS.js";import{b as K,c as ee}from"./chunk-E3UR4EIC.js";import{b as oe}from"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import{a as pe}from"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import{a as Z}from"./chunk-R5HXEPJ3.js";import{b as H}from"./chunk-CJM4TC3F.js";import{c as Y}from"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import{a as Q}from"./chunk-DZBH24YT.js";import{a as Se}from"./chunk-7E723FQO.js";import{b as ge,c as we,d as ve,e as Fe,f as be,g as xe,j as Oe}from"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import{a as ie}from"./chunk-WT3XCHGP.js";import{a as X}from"./chunk-CUJB6F5L.js";import{a as Ie}from"./chunk-5NHJFBCW.js";import{a as M}from"./chunk-WPZN772I.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-YQGS4EZO.js";import"./chunk-3REMXE4W.js";import{p as A}from"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import{b as f}from"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import{e as R}from"./chunk-W26XKMAT.js";import{a as y}from"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import"./chunk-JTDXB5TK.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-RZF6KTKU.js";import{e as T,f as he}from"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import{c as U,e as k}from"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import"./chunk-EXJYW3PC.js";import{a as D}from"./chunk-SXQPBCOX.js";import{m as v}from"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import{a as I}from"./chunk-4XZ6X7MQ.js";import{a as W}from"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import{h as J}from"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as r}from"./chunk-QHVIRF5H.js";import{I as w,x as c}from"./chunk-WZDN6K3C.js";import{a as t}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{G as E,O as L}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{i as q,r as N,t as _}from"./chunk-UHRSAPGQ.js";import{a as j}from"./chunk-V76GWARL.js";import{a as g,b as S}from"./chunk-N2WTMF3X.js";var l=class extends D{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=G(!1,!1),this.type="wfs",this.refresh=L(async()=>{await this.load();let e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:i}=await this._workerHandler.refresh(e);return i&&(this.sourceJSON.extent=i),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}})}load(e){let i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker({signal:i})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,i={}){let a=await this.queryFeaturesJSON(e,i);return M.fromJSON(a)}async queryFeaturesJSON(e,i={}){return await this.load(i),this._workerHandler.queryFeatures(e?e.toJSON():void 0,i)}async queryFeatureCount(e,i={}){return await this.load(i),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,i)}async queryObjectIds(e,i={}){return await this.load(i),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,i)}async queryExtent(e,i={}){await this.load(i);let a=await this._workerHandler.queryExtent(e?e.toJSON():void 0,i);return{count:a.count,extent:v.fromJSON(a.extent)}}async querySnapping(e,i={}){return await this.load(i),this._workerHandler.querySnapping(e,i)}async queryAttributeBins(e,i={}){await this.load(i);let a=await this._workerHandler.queryAttributeBins(e?.toJSON(),i);return le.fromJSON(a)}async _createLoadOptions(e){let{url:i,customParameters:a,name:n,namespaceUri:p,fields:s,geometryType:m,maxRecordCount:u,maxPageCount:F,maxTotalRecordCount:b,swapXY:x}=this.layer,h=this.layer.originOf("spatialReference")==="defaults"?void 0:this.layer.spatialReference;if(!i)throw new _("wfs-layer:missing-url","WFSLayer must be created with a url");this.wfsCapabilities||(this.wfsCapabilities=await me(i,g({customParameters:a},e)));let Te=["fields","geometryType","name","namespaceUri","swapXY"].some(O=>this.layer[O]==null),d=Te?await ye(this.wfsCapabilities,n,p,{spatialReference:h,customParameters:a,signal:e?.signal}):S(g({},fe(s??[])),{geometryType:m,name:n,namespaceUri:p,spatialReference:h,swapXY:x}),Ce=ue(this.wfsCapabilities.readFeatureTypes(),d.name,d.namespaceUri),Pe=y.toJSON(d.geometryType),{operations:P}=this.wfsCapabilities,je=P.GetFeature.url,qe=P.GetFeature.outputFormat;return{customParameters:a,featureType:Ce,fields:d.fields?.map(O=>O.toJSON())??[],geometryField:d.geometryField,geometryType:Pe,getFeatureUrl:je,getFeatureOutputFormat:qe,maxRecordCount:u,maxPageCount:F,maxTotalRecordCount:b,objectIdField:d.objectIdField,spatialReference:d.spatialReference?.toJSON(),swapXY:!!d.swapXY}}async _startWorker(e){let[i,a]=await E([this._createLoadOptions(e),ce("WFSSourceWorker",S(g({},e),{strategy:j("feature-layers-workers")?"dedicated":"local",registryTarget:this}))]),n=i.error||a.error||null,p=a.value||null;if(n)throw p&&p.close(),n;let s=i.value;this._connection=a.value,this._workerHandler=this._connection.createInvokeProxy();let m=await this._workerHandler.load(s,e);for(let u of m.warnings)N.getLogger(this.layer).warn("#load()",`${u.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:u});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:U},extent:m.extent,fields:s.fields,geometryType:s.geometryType,objectIdField:s.objectIdField,geometryField:s.geometryField,drawingInfo:V(s.geometryType),name:s.featureType.title,wfsInfo:{name:s.featureType.name,featureUrl:s.getFeatureUrl,maxFeatures:s.maxRecordCount,swapXY:s.swapXY,supportedSpatialReferences:s.featureType.supportedSpatialReferences,version:"2.0.0",wfsNamespace:s.featureType.namespaceUri}}}};t([r()],l.prototype,"capabilities",void 0),t([r({constructOnly:!0})],l.prototype,"layer",void 0),t([r()],l.prototype,"sourceJSON",void 0),t([r()],l.prototype,"type",void 0),t([r()],l.prototype,"wfsCapabilities",void 0),l=t([w("esri.layers.graphics.sources.WFSSource")],l);var C,Re=se(),o=C=class extends re(z(Z(te(B(Y(oe(ae(H(Q(Se(ie(X(Ie))))))))))))){static fromWFSLayerInfo(e){let{customParameters:i,fields:a,geometryField:n,geometryType:p,name:s,namespaceUri:m,objectIdField:u,spatialReference:F,swapXY:b,url:x,wfsCapabilities:h}=e;return new C({customParameters:i,fields:a,geometryField:n,geometryType:p,name:s,namespaceUri:m,objectIdField:u,spatialReference:F,swapXY:b,url:x,wfsCapabilities:h})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="WFS",this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new l({layer:this}),this.spatialReference=I.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title="WFS",this.type="wfs",this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WFS"]},e).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo","spatialReference","name","namespaceUri"],"service"),T(this.renderer,this.fieldsIndex),he(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,i,a){let n=e.filter(p=>p.name!==de);this.geometryField&&n.unshift(new R({name:this.geometryField,alias:this.geometryField,type:"geometry"})),q(a,n.map(p=>p.toJSON()),i)}get parsedUrl(){return J(this.url)}set renderer(e){T(e,this.fieldsIndex),this._set("renderer",e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return pe(this,e)}createQuery(){let e=new f({returnGeometry:!0,outFields:["*"],where:this.definitionExpression||"1=1"}),{timeOffset:i,timeExtent:a}=this;return e.timeExtent=i!=null&&a!=null?a.offset(-i.value,i.unit):a||null,e}getFieldDomain(e,i){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,i){return this.load().then(()=>this.source.queryFeatures(f.from(e)||this.createQuery(),i)).then(a=>{if(a?.features)for(let n of a.features)n.layer=n.sourceLayer=this;return a})}queryObjectIds(e,i){return this.load().then(()=>this.source.queryObjectIds(f.from(e)||this.createQuery(),i))}queryFeatureCount(e,i){return this.load().then(()=>this.source.queryFeatureCount(f.from(e)||this.createQuery(),i))}queryExtent(e,i){return this.load().then(()=>this.source.queryExtent(f.from(e)||this.createQuery(),i))}async hasDataChanged(){try{let{dataChanged:e,updates:i}=await this.source.refresh();return i!=null&&this.read(i,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};t([r({readOnly:!0})],o.prototype,"capabilities",null),t([r({type:String})],o.prototype,"copyright",void 0),t([r({readOnly:!0})],o.prototype,"createQueryVersion",null),t([r({json:{name:"wfsInfo.customParameters",write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],o.prototype,"customParameters",void 0),t([r(k("dateFieldsTimeReference"))],o.prototype,"dateFieldsTimeZone",void 0),t([r({readOnly:!0})],o.prototype,"defaultPopupTemplate",null),t([r({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],o.prototype,"definitionExpression",void 0),t([r({type:String})],o.prototype,"displayField",void 0),t([r(xe)],o.prototype,"elevationInfo",void 0),t([r({type:String,readOnly:!0,json:{name:"wfsInfo.featureUrl",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"featureUrl",void 0),t([r({type:[R],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],o.prototype,"fields",void 0),t([W("fields")],o.prototype,"writeFields",null),t([r(Re.fieldsIndex)],o.prototype,"fieldsIndex",void 0),t([r({type:v,json:{name:"extent"}})],o.prototype,"fullExtent",void 0),t([r()],o.prototype,"geometryField",void 0),t([r({type:String,json:{read:{source:"layerDefinition.geometryType",reader:y.read},write:{target:"layerDefinition.geometryType",writer:y.write,ignoreOrigin:!0},origins:{service:{read:y.read}}}})],o.prototype,"geometryType",void 0),t([r({type:String})],o.prototype,"id",void 0),t([r(ve)],o.prototype,"labelsVisible",void 0),t([r({type:[$],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ne},write:!0}})],o.prototype,"labelingInfo",void 0),t([r(be)],o.prototype,"legendEnabled",void 0),t([r({type:["show","hide"]})],o.prototype,"listMode",void 0),t([r({type:String})],o.prototype,"objectIdField",void 0),t([r({type:["WFS"]})],o.prototype,"operationalLayerType",void 0),t([r({type:c,json:{name:"wfsInfo.maxFeatures",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"maxRecordCount",void 0),t([r({type:c})],o.prototype,"maxPageCount",void 0),t([r({type:c})],o.prototype,"maxTotalRecordCount",void 0),t([r({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],o.prototype,"mode",void 0),t([r({type:String,json:{name:"wfsInfo.name",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"name",void 0),t([r({type:String,json:{name:"wfsInfo.wfsNamespace",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"namespaceUri",void 0),t([r(Oe)],o.prototype,"opacity",void 0),t([r(Re.outFields)],o.prototype,"outFields",void 0),t([r({readOnly:!0})],o.prototype,"parsedUrl",null),t([r(we)],o.prototype,"popupEnabled",void 0),t([r({type:A,json:{name:"popupInfo",write:!0}})],o.prototype,"popupTemplate",void 0),t([r({types:K,json:{origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:ee,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:{ignoreOrigin:!0}}})],o.prototype,"renderer",null),t([r(ge)],o.prototype,"screenSizePerspectiveEnabled",void 0),t([r({readOnly:!0})],o.prototype,"source",void 0),t([r({type:I,json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"extent.spatialReference"}}}})],o.prototype,"spatialReference",void 0),t([r({readOnly:!0,type:[c],json:{name:"wfsInfo.supportedSpatialReferences",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"spatialReferences",void 0),t([r({type:Boolean,value:!1,json:{name:"wfsInfo.swapXY",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"swapXY",void 0),t([r({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"name"}}}})],o.prototype,"title",void 0),t([r({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),t([r(Fe)],o.prototype,"url",void 0),t([r({type:String,readOnly:!0,json:{name:"wfsInfo.version",write:{ignoreOrigin:!0,isRequired:!0}}})],o.prototype,"version",void 0),t([r()],o.prototype,"wfsCapabilities",null),o=C=t([w("esri.layers.WFSLayer")],o);var Ut=o;export{Ut as default};
