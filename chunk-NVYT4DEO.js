import{a as j,b as E,d as I}from"./chunk-IE6LCR36.js";import{d as q}from"./chunk-SCNTWYD2.js";import{a as v,b as d,h as T}from"./chunk-C3PAYYXB.js";import{b as y}from"./chunk-TOH4K6HW.js";import{f}from"./chunk-FENRIY2T.js";import{m as O}from"./chunk-KGVXGH6H.js";import{w as F}from"./chunk-CKJ56T2Q.js";import{b}from"./chunk-UHRSAPGQ.js";import{a as Q,b as S}from"./chunk-N2WTMF3X.js";async function H(e,i,m){let a=F(m),{point:t,distance:r,returnEdge:p,vertexMode:u}=i;if(!p&&u==="none")return{candidates:[]};let s=b(i.query);s=await e.schedule(()=>T(s,e.definitionExpression,e.spatialReference),a),s=await e.reschedule(()=>E(s,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference}),a);let l=!O(t.spatialReference,e.spatialReference);l&&await v(t.spatialReference,e.spatialReference);let c=typeof r=="number"?r:r.x,x=typeof r=="number"?r:r.y,g={xmin:t.x-c,xmax:t.x+c,ymin:t.y-x,ymax:t.y+x,spatialReference:t.spatialReference},n=l?d(g,e.spatialReference):g;if(!n)return{candidates:[]};let R=(await y(f(t),null,{signal:a}))[0],h=(await y(f(n),null,{signal:a}))[0];if(R==null||h==null)return{candidates:[]};let o=new j(await e.reschedule(()=>e.searchFeatures(I(h.toJSON())),a),s,e);await e.reschedule(()=>e.executeObjectIdsQuery(o),a),await e.reschedule(()=>e.executeTimeQuery(o),a),await e.reschedule(()=>e.executeAttributesQuery(o),a),await e.reschedule(()=>N(e,o,a),a);let w=R.toJSON(),M=l?d(w,e.spatialReference):w,J=l?Math.max(n.xmax-n.xmin,n.ymax-n.ymin)/2:r;return o.createSnappingResponse(S(Q({},i),{point:M,distance:J}),t.spatialReference)}async function N(e,i,m){let{query:a}=i,{spatialRel:t}=a;if(!i?.items?.length||!a.geometry||!t)return;let r=await q(t,a.geometry,e.geometryType,e.hasZ,e.hasM),p=await e.runSpatialFilter(i.items,u=>r(u.geometry),m);i.items=p}export{H as a};
