import{a as j}from"./chunk-C3PAYYXB.js";import{c as R,e as b,f as q,g as O,h as x,s as S,t as A,w as V}from"./chunk-2NP7F5RO.js";import{a as m}from"./chunk-BUP3AMMF.js";import{a as G,e as h,g as F}from"./chunk-FENRIY2T.js";import{a as v,b as T,h as w,l as N}from"./chunk-LFH24RLM.js";import{B as I}from"./chunk-KGVXGH6H.js";import{t as g}from"./chunk-UHRSAPGQ.js";var z=new m,D=new m,E=new m,P={esriGeometryPoint:R,esriGeometryPolyline:q,esriGeometryPolygon:O,esriGeometryMultipoint:b};function ot(t,e,r,i=t.hasZ,s=t.hasM){if(e==null)return null;let o=t.hasZ&&i,n=t.hasM&&s;if(r){let l=S(E,e,t.hasZ,t.hasM,"esriGeometryPoint",r,i,s);return R(l,o,n)}return R(e,o,n)}function f(t,e,r,i,s,o,n=e,l=r){let u=e&&n,a=r&&l,p=i!=null?"coords"in i?i:i.geometry:null;if(p==null)return null;if(s){let c=A(D,p,e,r,t,s,n,l);return o&&(c=S(E,c,u,a,t,o)),P[t]?.(c,u,a)??null}if(o){let c=S(E,p,e,r,t,o,n,l);return P[t]?.(c,u,a)??null}return V(z,p,e,r,n,l),P[t]?.(z,u,a)??null}function st(t){return t&&Z in t?JSON.parse(JSON.stringify(t,Y)):t}var Z="_geVersion",Y=(t,e)=>t===Z?void 0:e;function J(t){return t==="mesh"?w:N(t)}function Q(t,e){return t?e?4:3:e?3:2}function U(t,e,r,i){return _(t,e,r,i.coords[0],i.coords[1])}function W(t,e,r,i,s,o){let n=Q(s,o),{coords:l,lengths:u}=i;if(!u)return!1;for(let a=0,p=0;a<u.length;a++,p+=n)if(!_(t,e,r,l[p],l[p+1]))return!1;return!0}function _(t,e,r,i,s){if(!t)return!1;let o=Q(e,r),{coords:n,lengths:l}=t,u=!1,a=0;for(let p of l)u=B(u,n,o,a,p,i,s),a+=p*o;return u}function B(t,e,r,i,s,o,n){let l=t,u=i;for(let a=i,p=i+s*r;a<p;a+=r){u=a+r,u===p&&(u=i);let c=e[a],y=e[a+1],k=e[u],d=e[u+1];(y<n&&d>=n||d<n&&y>=n)&&c+(n-y)/(d-y)*(k-c)<o&&(l=!l)}return l}var M="unsupported-query",C={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function $(t){return t!=null&&C.spatialRelationship[t]===!0}function H(t){return t!=null&&C.queryGeometry[F(t)]===!0}function K(t){return t!=null&&C.layerGeometry[t]===!0}var L={esriSpatialRelIntersects:()=>import("./chunk-PNZHWO5O.js"),esriSpatialRelContains:()=>import("./chunk-FKF2VKYA.js"),esriSpatialRelCrosses:()=>import("./chunk-EM7TKTCW.js"),esriSpatialRelDisjoint:()=>import("./chunk-5GIND32Z.js"),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>import("./chunk-DUU42R44.js"),esriSpatialRelTouches:()=>import("./chunk-4IKWVGY4.js"),esriSpatialRelWithin:()=>import("./chunk-YSXLWPVK.js"),esriSpatialRelRelation:null};function X(t){let e=L[t];if(e==null)throw new Error(`Cannot load unsupported spatial operator: ${t}`);return e()}async function Tt(t,e,r,i,s){if(h(e)){if(r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains")){let n=x(new m,e,!1,!1);return l=>U(n,!1,!1,l)}if(r==="esriGeometryMultipoint"){let n=x(new m,e,!1,!1);if(t==="esriSpatialRelContains")return l=>W(n,!1,!1,l,i,s)}}if(G(e)){if(r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains"))return n=>v(e,f(r,i,s,n));if(r==="esriGeometryMultipoint"&&t==="esriSpatialRelContains")return n=>T(e,f(r,i,s,n));if(t==="esriSpatialRelIntersects"){let n=J(r);return l=>n(e,f(r,i,s,l))}}t==="esriSpatialRelEnvelopeIntersects"&&(t="esriSpatialRelIntersects");let o=await X(t);return n=>o.execute(e,f(r,i,s,n))}async function wt(t,e,r){let{spatialRel:i,geometry:s}=t;if(s){if(!$(i))throw new g(M,"Unsupported query spatial relationship",{query:t});if(I(s.spatialReference)&&I(r)){if(!H(s))throw new g(M,"Unsupported query geometry type",{query:t});if(!K(e))throw new g(M,"Unsupported layer geometry type",{query:t});if(t.outSR)return j(t.geometry?.spatialReference,t.outSR)}}}function Nt(t){if(G(t))return!0;if(h(t)){for(let e of t.rings)if(e.length!==5||e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1;return!0}return!1}async function Ot(t,e){if(!t)return null;let r=e.featureAdapter,{startTimeField:i,endTimeField:s}=t,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(i&&s)await e.forEach(l=>{let u=r.getAttribute(l,i),a=r.getAttribute(l,s);u==null||isNaN(u)||(o=Math.min(o,u)),a==null||isNaN(a)||(n=Math.max(n,a))});else{let l=i||s;await e.forEach(u=>{let a=r.getAttribute(u,l);a==null||isNaN(a)||(o=Math.min(o,a),n=Math.max(n,a))})}return{start:o,end:n}}function At(t,e,r){if(!e||!t)return null;let{startTimeField:i,endTimeField:s}=t;if(!i&&!s)return null;let{start:o,end:n}=e;if(o===null&&n===null)return null;if(o===void 0&&n===void 0)return rt();let l=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return i&&s?tt(l,i,s,o,n):et(l,i||s,o,n)}function tt(t,e,r,i,s){return i!=null&&s!=null?o=>{let n=t(o,e),l=t(o,r);return(n==null||n<=s)&&(l==null||l>=i)}:i!=null?o=>{let n=t(o,r);return n==null||n>=i}:s!=null?o=>{let n=t(o,e);return n==null||n<=s}:void 0}function et(t,e,r,i){return r!=null&&i!=null&&r===i?s=>t(s,e)===r:r!=null&&i!=null?s=>{let o=t(s,e);return o!=null&&o>=r&&o<=i}:r!=null?s=>{let o=t(s,e);return o!=null&&o>=r}:i!=null?s=>{let o=t(s,e);return o!=null&&o<=i}:void 0}function rt(){return()=>!1}export{ot as a,f as b,st as c,Tt as d,wt as e,Nt as f,Ot as g,At as h};
