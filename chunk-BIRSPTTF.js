import{C as g,D as Z,E as $}from"./chunk-HP4LYRR4.js";import{b as F}from"./chunk-4G7UTTZJ.js";import{b as m,c as f,d as h,e as D,f as v}from"./chunk-KJULKTB5.js";import{c,g as T}from"./chunk-LACL4BQ2.js";import{a as l,b as d}from"./chunk-N2WTMF3X.js";var x=",";var I={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},U=new Set(["integer","small-integer"]),p=null;function A(e){return g(e)||Z(e)||$(e)}async function B(e){let{field:n,field2:t,field3:r,normalizationField:i,valueExpression:s}=e,o=[];if(s){if(!p){let{arcadeUtils:a}=await F();p=a}o=p.extractFieldNames(s)}return n&&o.push(n),t&&o.push(t),r&&o.push(r),i&&o.push(i),o}function u(e){return String(e).padStart(2,"0")}function w(e,n,t){let r;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),r=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${u((t?e.getMonth():e.getUTCMonth())+1)}-${u(t?e.getDate():e.getUTCDate())} ${u(t?e.getHours():e.getUTCHours())}:${u(t?e.getMinutes():e.getUTCMinutes())}:${u(t?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function E(e,n,t,r){let{hasQueryEngine:i}=e,s=`(${w(t,S(e,t),i)} - ${w(n,S(e,n),i)})`,o=I[r],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:o===1?s:`(${s} ${a} ${o})`,sqlWhere:null}}function S(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){let t=e.getField(n);if(n.toLowerCase()==="<now>")return;if(g(t))return"field"}}function L(e,n){let t=n&&e.getField(n);return!!t&&U.has(t.type)}function q(e){return`cast(${e} as float)`}function G(e,n){let{format:t,timeZoneOptions:r,fieldType:i}=n??{},s,o;if(r&&({timeZone:s,timeZoneName:o}=T(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,m(t||"short-date-short-time"),i)),typeof e=="string"&&isNaN(Date.parse(i==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(i){case"date-only":{let a=m(t||"short-date");return typeof e=="string"?h(e,l({},a)):f(e,d(l({},a),{timeZone:c}))}case"time-only":{let a=m(t||"short-time");return typeof e=="string"?D(e,a):f(e,d(l({},a),{timeZone:c}))}case"timestamp-offset":{if(!s&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;let a=t||r?m(t||"short-date-short-time"):void 0,y=a?d(l({},a),{timeZone:s,timeZoneName:o}):void 0;return typeof e=="string"?v(e,y):f(e,y)}default:{let a=t||r?m(t||"short-date-short-time"):void 0;return f(typeof e=="string"?new Date(e):e,a?d(l({},a),{timeZone:s,timeZoneName:o}):void 0)}}}export{x as a,A as b,B as c,E as d,L as e,q as f,G as g};
