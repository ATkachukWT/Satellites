import{a as ze,c as Mt}from"./chunk-6NVIER6D.js";import{B as Tt,a as $,m as kt,n as Pt,o as Ae,p as Fe,q as De,r as Ie,s as Ce,v as at,w as Ht,x as bt,y as Xt}from"./chunk-E4MEDSYW.js";import{d as Ee,e as Le}from"./chunk-CUJ2T6EE.js";import{a as k,b as Rt,d as Vt,e as _e,n as be,o as Te,p as ve,w as Ut}from"./chunk-E2PEM77A.js";import{a as Ge,b as Be,c as We}from"./chunk-EQWEJ5AJ.js";import{a as Pe}from"./chunk-4D3QHJI2.js";import{a as Se,e as Me,g as ke}from"./chunk-E2J2V7JN.js";import{a as Yt,c as Ot,k as we}from"./chunk-PGUFA2AC.js";import{G as P,L as j,M as B,W as xe,X as ye,c as me,d as fe,y as de}from"./chunk-X7BNFUFQ.js";import{E as St}from"./chunk-2G3SBK6Q.js";import{a as xt,b as yt,c as gt,r as W,t as _t,y as V}from"./chunk-63B3IOWG.js";import{a as ge}from"./chunk-KAMRW6HF.js";import{a as he}from"./chunk-BUP3AMMF.js";import{h as p}from"./chunk-HM5RIVQC.js";import{s as ot}from"./chunk-QXXXCEV5.js";import{a as x}from"./chunk-OLOKUDVI.js";import{b as ue}from"./chunk-B3FO6PT7.js";import{b as Nt,h as pe}from"./chunk-QT6UNBJP.js";import{r as dt,t as le}from"./chunk-UHRSAPGQ.js";import{a as ce}from"./chunk-V76GWARL.js";import{a as g,b as S}from"./chunk-N2WTMF3X.js";function Ye(e,t,r,i,s,o,a){Qt=0;let n=(i-r)*o,c=s&&s.length,u=c?(s[0]-r)*o:n,l,f,d,h,m,y=Oe(t,r,i,0,u,o,!0);if(y&&y.next!==y.prev){if(c&&(y=Mr(t,r,i,s,y,o)),n>80*o){l=d=t[0+r*o],f=h=t[1+r*o];for(let _=o;_<u;_+=o){let v=t[_+r*o],w=t[_+1+r*o];l=Math.min(l,v),f=Math.min(f,w),d=Math.max(d,v),h=Math.max(h,w)}m=Math.max(d-l,h-f),m=m!==0?1/m:0}ct(y,e,o,l,f,m,a,0)}}function Oe(e,t,r,i,s,o,a){let n;if(a===vr(e,t,r,i,s,o)>0)for(let c=i;c<s;c+=o)n=Ne(c+t*o,e[c+t*o],e[c+1+t*o],n);else for(let c=s-o;c>=i;c-=o)n=Ne(c+t*o,e[c+t*o],e[c+1+t*o],n);return n&&U(n,n.next)&&(lt(n),n=n.next),n}function nt(e,t=e){if(!e)return e;let r,i=e;do if(r=!1,i.steiner||!U(i,i.next)&&b(i.prev,i,i.next)!==0)i=i.next;else{if(lt(i),i=t=i.prev,i===i.next)break;r=!0}while(r||i!==t);return t}function ct(e,t,r,i,s,o,a,n){if(!e)return;!n&&o&&(e=Re(e,i,s,o));let c=e;for(;e.prev!==e.next;){let u=e.prev,l=e.next;if(o?_r(e,i,s,o):gr(e))t.push(u.index/r+a),t.push(e.index/r+a),t.push(l.index/r+a),lt(e),e=l.next,c=l.next;else if((e=l)===c){n?n===1?ct(e=Er(e,t,r,a),t,r,i,s,o,a,2):n===2&&zr(e,t,r,i,s,o,a):ct(nt(e),t,r,i,s,o,a,1);break}}}function gr(e){let t=e.prev,r=e,i=e.next;if(b(t,r,i)>=0)return!1;let s=e.next.next,o=s,a=0;for(;s!==e.prev&&(a===0||s!==o);){if(a++,K(t.x,t.y,r.x,r.y,i.x,i.y,s.x,s.y)&&b(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function _r(e,t,r,i){let s=e.prev,o=e,a=e.next;if(b(s,o,a)>=0)return!1;let n=s.x<o.x?s.x<a.x?s.x:a.x:o.x<a.x?o.x:a.x,c=s.y<o.y?s.y<a.y?s.y:a.y:o.y<a.y?o.y:a.y,u=s.x>o.x?s.x>a.x?s.x:a.x:o.x>a.x?o.x:a.x,l=s.y>o.y?s.y>a.y?s.y:a.y:o.y>a.y?o.y:a.y,f=Zt(n,c,t,r,i),d=Zt(u,l,t,r,i),h=e.prevZ,m=e.nextZ;for(;h&&h.z>=f&&m&&m.z<=d;){if(h!==e.prev&&h!==e.next&&K(s.x,s.y,o.x,o.y,a.x,a.y,h.x,h.y)&&b(h.prev,h,h.next)>=0||(h=h.prevZ,m!==e.prev&&m!==e.next&&K(s.x,s.y,o.x,o.y,a.x,a.y,m.x,m.y)&&b(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;h&&h.z>=f;){if(h!==e.prev&&h!==e.next&&K(s.x,s.y,o.x,o.y,a.x,a.y,h.x,h.y)&&b(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&K(s.x,s.y,o.x,o.y,a.x,a.y,m.x,m.y)&&b(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Ne(e,t,r,i){let s=tt.create(e,t,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function lt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Sr(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Mr(e,t,r,i,s,o){let a=new Array;for(let n=0,c=i.length;n<c;n++){let u=Oe(e,t,r,i[n]*o,n<c-1?i[n+1]*o:r*o,o,!1);u===u.next&&(u.steiner=!0),a.push(Sr(u))}a.sort(wr);for(let n of a)s=kr(n,s);return s}function kr(e,t){let r=Pr(e,t);if(!r)return t;let i=Ue(r,e);return nt(i,i.next),nt(r,r.next)}function Pr(e,t){let r=t,i=e.x,s=e.y,o,a=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let d=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=i&&d>a){if(a=d,d===i){if(s===r.y)return r;if(s===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(i===a)return o.prev;let n=o,c=o.x,u=o.y,l,f=1/0;for(r=o.next;r!==n;)i>=r.x&&r.x>=c&&i!==r.x&&K(s<u?i:a,s,c,u,s<u?a:i,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(i-r.x),(l<f||l===f&&r.x>o.x)&&pt(r,e)&&(o=r,f=l)),r=r.next;return o}function Re(e,t,r,i){let s;for(;s!==e;s=s.next){if(s=s||e,s.z===null&&(s.z=Zt(s.x,s.y,t,r,i)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,Re(e,t,r,i);s.prevZ=s.prev,s.nextZ=s.next}return e.prevZ.nextZ=null,e.prevZ=null,br(e)}function br(e){let t,r=1;for(;;){let i,s=e;e=null,t=null;let o=0;for(;s;){o++,i=s;let a=0;for(;a<r&&i;a++)i=i.nextZ;let n=r;for(;a>0||n>0&&i;){let c;a===0?(c=i,i=i.nextZ,n--):n!==0&&i?s.z<=i.z?(c=s,s=s.nextZ,a--):(c=i,i=i.nextZ,n--):(c=s,s=s.nextZ,a--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}s=i}if(t.nextZ=null,r*=2,o<2)return e}}function b(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ve(e,t,r,i){return!!(U(e,t)&&U(r,i)||U(e,i)&&U(r,t))||b(e,t,r)>0!=b(e,t,i)>0&&b(r,i,e)>0!=b(r,i,t)>0}function Tr(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&Ve(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function vr(e,t,r,i,s,o){let a=0;for(let n=i,c=s-o;n<s;n+=o)a+=(e[c+t*o]-e[n+t*o])*(e[n+1+t*o]+e[c+1+t*o]),c=n;return a}function K(e,t,r,i,s,o,a,n){return(s-a)*(t-n)-(e-a)*(o-n)>=0&&(e-a)*(i-n)-(r-a)*(t-n)>=0&&(r-a)*(o-n)-(s-a)*(i-n)>=0}function pt(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function Zt(e,t,r,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function U(e,t){return e.x===t.x&&e.y===t.y}function wr(e,t){return e.x-t.x}function Er(e,t,r,i){let s=e;do{let o=s.prev,a=s.next.next;!U(o,a)&&Ve(o,s,s.next,a)&&pt(o,a)&&pt(a,o)&&(t.push(o.index/r+i),t.push(s.index/r+i),t.push(a.index/r+i),lt(s),lt(s.next),s=e=a),s=s.next}while(s!==e);return s}function zr(e,t,r,i,s,o,a){let n=e;do{let c=n.next.next;for(;c!==n.prev;){if(n.index!==c.index&&Lr(n,c)){let u=Ue(n,c);return n=nt(n,n.next),u=nt(u,u.next),ct(n,t,r,i,s,o,a,0),void ct(u,t,r,i,s,o,a,0)}c=c.next}n=n.next}while(n!==e)}function Lr(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!Tr(e,t)&&pt(e,t)&&pt(t,e)&&Ar(e,t)}function Ar(e,t){let r=e,i=!1,s=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&s<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function Ue(e,t){let r=tt.create(e.index,e.x,e.y),i=tt.create(t.index,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}var tt=class e{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,r,i){let s=Qt<qt.length?qt[Qt++]:new e;return s.index=t,s.x=r,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}},qt=[],Fr=8096,Qt=0;for(let e=0;e<Fr;e++)qt.push(new tt);var Dr=1e-5,H=new Ot(0,0,0,1,0),Jt=new Ot(0,0,0,1,0);function He(e,t,r){let i=0;for(let s=1;s<r;s++){let o=e[2*(t+s-1)],a=e[2*(t+s-1)+1];i+=(e[2*(t+s)]-o)*(e[2*(t+s)+1]+a)}return i}function Ir(e,t,r,i,s){let o=0,a=2;for(let n=r;n<i;n+=3){let c=(e[n]-s)*a,u=(e[n+1]-s)*a,l=(e[n+2]-s)*a;o+=Math.abs((t[c]-t[l])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[l+1]-t[c+1]))}return o}function Xe(e,t){let{coords:r,lengths:i}=t,s=0,o=e,a=0;for(let n=0;n<i.length;){let c=n,u=i[n],l=He(r,a,u),f=[];for(;++c<i.length;){let y=i[c],_=He(r,a+u,y);if(!(_>0))break;l+=_,f.push(a+u),u+=y}let d=o.length;Ye(o,r,a,a+u,f,2,s);let h=Ir(o,r,d,o.length,s),m=Math.abs(l);if(Math.abs((h-m)/Math.max(1e-7,m))>Dr)return o.length=0,!1;n=c,a+=u}return!0}function Ze(e){let{coords:t,lengths:r}=e,{buffer:i}=Be(t,r);return i}function Cr(e,t,r){let i=0;for(let s=0;s<e.lengths.length;s++){let o=e.lengths[s];for(let a=0;a<o;a++){let n=e.coords[2*(a+i)],c=e.coords[2*(a+i)+1];if(n<t||n>r||c<t||c>r)return!0}i+=o}return!1}function wt(e,t){if(e==null)return null;if(!Cr(e,-128,640))return e;H.setPixelMargin(t),H.reset(Yt.Polygon);let r=0;for(let a=0;a<e.lengths.length;a++){let n=e.lengths[a],c=e.coords[2*(0+r)],u=e.coords[2*(0+r)+1];H.moveTo(c,u);for(let l=1;l<n;l++)c=e.coords[2*(l+r)],u=e.coords[2*(l+r)+1],H.lineTo(c,u);H.close(),r+=n}let i=H.result(!1);if(!i)return null;let s=[],o=[];for(let a of i){let n=0;for(let c of a)o.push(c.x),o.push(c.y),n++;s.push(n)}return new he(s,o)}function qe(e,t){Jt.setPixelMargin(t);let r=Jt,i=-t,s=512+t,o=[],a=!1;if(!e.nextPath())return null;let n=e.pathLength(),c=!0;for(;c;){e.seekPathStart();let u=[];if(!e.pathSize)return null;r.reset(Yt.LineString),e.nextPoint();let l=e.x,f=e.y;if(a)r.moveTo(l,f);else{if(l<i||l>s||f<i||f>s){a=!0;continue}u.push({x:l,y:f})}let d=!1;for(;e.nextPoint();)if(l=e.x,f=e.y,a)r.lineTo(l,f);else{if(l<i||l>s||f<i||f>s){d=!0;break}u.push({x:l,y:f})}if(d)a=!0;else{if(a){let h=r.resultWithStarts();if(h)for(let m of h)o.push(S(g({},m),{pathLength:n}))}else o.push({line:u,start:0,pathLength:n});c=e.nextPath(),n=c?e.pathLength():0,a=!1}}return o=o.filter(u=>u.line.length>1),o.length===0?null:o}H.setExtent(512),Jt.setExtent(512);var Gr=96/72,Et=class{static executeEffects(t,r,i,s,o){let a=Gr,n=Ut(t),c=new Rt(r);for(let u of t){let l=Vt(u);l&&(c=l.execute(c,u,a,i,s,n,o))}return c}static applyEffects(t,r,i){if(!t)return r;let s=Ut(t),o,a=new Rt(k.fromJSONCIM(r));for(let u of t){let l=Vt(u);l&&(a=l.execute(a,u,1,null,i,s,!1))}let n=[],c=null;for(;o=a.next();)n.push(...ue(o)),c=o.geometryType;return n.length===0||c===null?null:c==="esriGeometryPolygon"?{rings:n}:{paths:n}}};var Qe=null;function et(){return Qe}async function Je(){Qe=await import("./chunk-6SESXOXB.js")}function je(e){switch(e){case p.BYTE:case p.UNSIGNED_BYTE:return 1;case p.SHORT:case p.UNSIGNED_SHORT:case p.HALF_FLOAT:return 2;case p.FLOAT:case p.INT:case p.UNSIGNED_INT:return 4}}function Br(e){let t=[],r=[],i=[];for(let s of e){let o=je(s.type)*s.count;switch(o%2||o%4||4){case 4:t.push(s);continue;case 2:r.push(s);continue;case 1:i.push(s);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...r),t.push(...i),t}var zt=class e{static fromVertexSpec(t,r){let{attributes:i,optionalAttributes:s}=t,o,a,n,c=[];for(let y in i){let _=i[y];_.pack==="position"?o=S(g({},_),{name:y,offset:0}):_.pack==="id"?a=S(g({},_),{name:y,offset:4}):y==="bitset"?n=S(g({},_),{name:y,offset:7}):c.push(S(g({},_),{name:y}))}for(let y in s)if(r[y]===!0){let _=s[y];c.push(S(g({},_),{name:y}))}let u=Br(c),l=[],f=8,d=1;for(let y of u)l.push(S(g({},y),{offset:f})),f+=je(y.type)*y.count,y.packAlternating&&(d=Math.max(y.packAlternating.count,d));let h=Uint32Array.BYTES_PER_ELEMENT,m=f%h;return new e(o,a,n,l,f+(m?h-m:0),d)}constructor(t,r,i,s,o,a){this.position=t,this.id=r,this.bitset=i,this.standardAttributes=s,this.stride=o,this.packVertexCount=a,s.push(i),this._attributes=[t,r,i,...s]}get attributeLayout(){if(!this._attributeLayout){let t=ze(this._attributes),r=this._attributes.map(i=>({name:i.name,count:i.count,offset:i.offset,type:i.type,packPrecisionFactor:i.packPrecisionFactor,normalized:i.normalized??!1}));this._attributeLayout={attributes:r,hash:t,stride:this.stride}}return this._attributeLayout}};var Lt=class e{static fromVertexSpec(t,r){let i=zt.fromVertexSpec(t,r);return new e(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,r,i,s,o,a){for(let n=0;n<this._spec.packVertexCount;n++){let c=n*this._spec.stride;this._packPosition(i,s,c),this._packId(r,c);let u=this._spec.bitset;if(a){if(u.packTessellation){let l=u.packTessellation(a,o,i,s);this._pack(l,u,c)}for(let l of this._spec.standardAttributes)if(l.packTessellation!=null){let f=l.packTessellation(a,o,i,s);this._pack(f,l,c)}else if(l.packAlternating?.packTessellation){let f=l.packAlternating.packTessellation(a,o,i,s);for(let d=0;d<this._spec.packVertexCount;d++){let h=f[d];this._pack(h,l,d*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,r){for(let i of this._spec.standardAttributes)if(i.pack&&typeof i.pack!="string"){let s=i.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++)this._pack(s,i,o*this._spec.stride)}else if(i.packAlternating?.pack){let s=i.packAlternating.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++){let a=s[o];this._pack(a,i,o*this._spec.stride)}}}_packPosition(t,r,i){let{offset:s}=this._spec.position,o=this._spec.position.packPrecisionFactor??1,a=Ee(t*o,r*o);this._dataView.setUint32(i+s,a,!0)}_packId(t,r){let i=t*(this._spec.id.packPrecisionFactor??1),s=4278190080&this._dataView.getUint32(r+this._spec.id.offset,!0);this._dataView.setUint32(r+this._spec.id.offset,i|s,!0)}_pack(t,r,i){Le(this._dataView,t,r,i)}};function Wr(e){if(!e)return!1;for(let t of e)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}var T=class{constructor(t,r,i,s){this._instanceId=t,this._evaluator=r,this._enabledOptionalAttributes=i,this._viewParams=s,this._evaluator.evaluator=o=>this.vertexSpec.createComputedParams(o)}get _vertexPack(){if(!this._cachedVertexPack){let t=Lt.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){Wr(this._evaluator.inputMeshParams.effects?.effectInfos)&&await Je()}enqueueRequest(t,r,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,r,i)}write(t,r,i,s,o){this.ensurePacked(r,i,s);let a=this.evaluatedMeshParams.effects;if(!a||a.length===0)return void this._write(t,i,void 0,o);let n=i.readGeometryForDisplay()?.clone();if(!n)return;let c=k.fromOptimizedCIM(n,i.geometryType),u=et();c.invertY();let l=t.id||"",f=Et.executeEffects(a,c,l,u,this._preventEffectClipping),d;for(;d=f.next();)d.invertY(),this._write(t,i,d,o)}ensurePacked(t,r,i){if(!this._evaluator.hasDynamicProperties)return;let s=this._evaluator.evaluateMeshParams(t,r,i);this._vertexPack.pack(s,this._viewParams)}hasArcadeDependency(t){return this._evaluator.hasArcadeDependency(t)}_writeVertex(t,r,i,s,o){let a=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,r,i,s,a,o)}};var Nr=100,Yr=ce("featurelayer-fast-triangulation-enabled"),N=class extends T{async loadDependencies(){await Promise.all([super.loadDependencies(),Ge()])}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),t.recordEnd())}_clip(t){if(!t)return null;let r=this.hasEffects;return wt(t,r?256:8)}_writeGeometry(t,r,i){let s=i.maxLength>Nr,o=[],a=this.createTesselationParams(r);if(!s&&Yr&&Xe(o,i))return void(o.length&&this._writeVertices(t,r,i.coords,a,o));let n=Ze(i);this._writeVertices(t,r,n,a)}_writeVertices(t,r,i,s,o){let a=r.getDisplayId(),n=t.vertexCount(),c=this.hasEffects,u=0;if(o)for(let l of o){let f=i[2*l],d=i[2*l+1];c&&t.recordBounds(f,d,0,0),this._writeVertex(t,a,f,d,s),u++}else for(let l=0;l<i.length;l+=2){let f=Math.round(i[l]),d=Math.round(i[l+1]);c&&t.recordBounds(f,d,0,0),this._writeVertex(t,a,f,d,s),u++}t.indexEnsureSize(u);for(let l=0;l<u;l++)t.indexWrite(l+n)}};var Or={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:p.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}},$e=class extends N{constructor(){super(...arguments),this.vertexSpec=Or}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};var Rr=()=>dt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),Vr=0,Ur=100;function F(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||Vr,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||Ur]}function I(e){return 1<<e}function E(e){let t=0;for(let[r,i]of e)i&&(t|=1<<r);return t}function M(e){let t;if(!e)return[0,0,0,0];if(typeof e=="string"){let a=ge.fromString(e);if(!a)return Rr().errorOnce(new le("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];t=a.toArray()}else t=e;let[r,i,s,o]=t;return[r*(o/255),i*(o/255),s*(o/255),o]}function Ke(e){switch(e){case"butt":case W.Butt:return xt.BUTT;case"round":case W.Round:return xt.ROUND;case"square":case W.Square:return xt.SQUARE}}function tr(e){switch(e){case"bevel":case _t.Bevel:return yt.BEVEL;case"miter":case _t.Miter:return yt.MITER;case"round":case _t.Round:return yt.ROUND}}function At(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))}function ut(e,t){return Math.round(e*t)/t}var X={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:B,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)}}},rt=class extends N{constructor(){super(...arguments),this.vertexSpec=X}createTesselationParams(t){return null}};var C={createComputedParams:e=>e,optionalAttributes:X.optionalAttributes,attributes:S(g({},X.attributes),{tlbr:{count:4,type:p.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P,o=t.y+P;return[s,o,s+r,o+i]}},inverseRasterizationScale:{count:1,type:p.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}})},Ft=class extends rt{constructor(){super(...arguments),this.vertexSpec=C}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let a=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(t,r,o),t.recordEnd()}};function ht(e){let{sprite:t,aspectRatio:r,scaleProportionally:i}=e,s=x(e.height),o=s>0?s:t.height,a=s*r;return a<=0?a=t.width:i&&(a*=t.width/t.height),{width:a,height:o}}function jt(e){let{applyRandomOffset:t,sampleAlphaOnly:r}=e;return E([[Ae,t],[kt,r]])}var $t={createComputedParams:e=>e,optionalAttributes:C.optionalAttributes,attributes:S(g({},C.attributes),{bitset:{count:1,type:p.UNSIGNED_BYTE,pack:jt},width:{count:1,type:p.HALF_FLOAT,pack:e=>ht(e).width},height:{count:1,type:p.HALF_FLOAT,pack:e=>ht(e).height},offset:{count:2,type:p.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),-x(t)]},scale:{count:2,type:p.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:p.UNSIGNED_BYTE,pack:({angle:e})=>we(e)}})},er=class extends Ft{constructor(){super(...arguments),this.vertexSpec=$t}};var Kt=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0,this.pathLength=0}},z={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:B,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:p.UNSIGNED_BYTE,count:1},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)},offset:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[ut(e,16),ut(t,16)]},normal:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[ut(e,16),ut(t,16)]},halfWidth:{type:p.HALF_FLOAT,count:1,pack:({width:e})=>x(.5*e)},referenceHalfWidth:{type:p.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>x(.5*e)}}},te=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}},rr=65535,Y=class extends T{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=z,this._currentWrite=new te,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:rr,textured:!1},this._tessParams=new Kt,this._initializeTessellator()}writeLineVertices(t,r,i){let s=this._getLines(r);s!=null&&this._writeVertices(t,i,s)}_initializeTessellator(){this._lineTessellator=new We(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);s&&this._writeGeometry(t,r,s)}_writeGeometry(t,r,i,s){t.recordStart(this.instanceId,this.attributeLayout,s),this.writeLineVertices(t,i,r),t.recordEnd()}_getLines(t){return qe(t,Mt(this.evaluatedMeshParams))}_writeVertices(t,r,i){let{_currentWrite:s,_tessellationOptions:o,evaluatedMeshParams:a}=this,{width:n,capType:c,joinType:u,miterLimit:l,hasSizeVV:f}=a,d=x(.5*n);o.halfWidth=d,o.capType=Ke(c),o.joinType=tr(u),o.miterLimit=l;let h=!f;s.out=t,s.id=r.getDisplayId(),s.vertexCount=0,s.indexCount=0,s.vertexFrom=t.vertexCount(),s.vertexBounds=h&&d<de?0:1;for(let{line:m,start:y,pathLength:_}of i)o.initialDistance=y%rr,s.pathLength=_,this._lineTessellator.tessellate(m,o,h)}_writeTesselatedVertex(t,r,i,s,o,a,n,c,u,l,f){let{out:d,id:h,vertexBounds:m,pathLength:y}=this._currentWrite;return this.hasEffects&&d.recordBounds(t,r,m,m),this._tessParams.extrusionOffsetX=n,this._tessParams.extrusionOffsetY=c,this._tessParams.normalX=u,this._tessParams.normalY=l,this._tessParams.directionX=o,this._tessParams.directionY=a,this._tessParams.distance=f,this._tessParams.pathLength=y,this._writeVertex(d,h,t,r,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,r,i){let{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(t),s.indexWrite(r),s.indexWrite(i),this._currentWrite.indexCount+=3}};var ee={createComputedParams:e=>e,optionalAttributes:z.optionalAttributes,attributes:S(g({},z.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)}})},mt={createComputedParams:e=>e,optionalAttributes:z.optionalAttributes,attributes:S(g({},z.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>E([[Pt,!0]])},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)}})},Z=class extends Y{constructor(){super(...arguments),this.vertexSpec=mt}},it=class extends rt{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=ee,this._lineMeshWriter=this._createOutlineWriter(t,r,i,s)}_createOutlineWriter(t,r,i,s){return new Z(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd())}_clip(t){return t?wt(t,Mt(this.evaluatedMeshParams)):null}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};var Dt=$t,Hr=mt,Xr={createComputedParams:e=>e,optionalAttributes:Dt.optionalAttributes,attributes:S(g({},Dt.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>jt(e)},aux1:{count:1,type:p.HALF_FLOAT,pack:e=>ht(e).width},aux2:{count:1,type:p.HALF_FLOAT,pack:e=>ht(e).height},aux3:{count:2,type:p.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),x(t)]},aux4:{count:2,type:p.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*at,t*at]}})},Zr={createComputedParams:e=>e,optionalAttributes:Dt.optionalAttributes,attributes:S(g({},Dt.attributes),{color:Hr.attributes.color,bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>E([[Pt,!0]])},aux1:{count:1,type:p.HALF_FLOAT,pack:e=>x(.5*e.width)},aux2:{count:1,type:p.HALF_FLOAT,pack:e=>x(.5*e.referenceWidth)},aux3:{count:2,type:p.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:p.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*at+Ht,t*at+Ht]}})},re=class extends Z{constructor(){super(...arguments),this.vertexSpec=Zr}},ir=class extends it{constructor(){super(...arguments),this.vertexSpec=Xr}_createOutlineWriter(t,r,i,s){return new re(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let a=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};var qr=()=>dt.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper"),ie=class{constructor(t,r){this._size=t,this._sizeUnits=r,this._relativeSize=null}get relativeSize(){return this._relativeSize??=this.calculateRelativeSize(),this._relativeSize}calculateRelativeSize(){if(this._sizeUnits===V.Relative){let t=Math.min(this._size/100,1);return[t,t]}return this.calculateRelativeSizeFromAbsolute()}},ft=class extends ie{constructor(t,r,i,s){super(r,i),this.rotationMatrix00=1,this.rotationMatrix01=0,this.rotationMatrix10=0,this.rotationMatrix11=1,this.bounds={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},this.rotationMatrix00=Math.cos(s),this.rotationMatrix01=-Math.sin(s),this.rotationMatrix10=-this.rotationMatrix01,this.rotationMatrix11=this.rotationMatrix00;let{bounds:o,rotationMatrix00:a,rotationMatrix01:n,rotationMatrix10:c,rotationMatrix11:u}=this;t.forEachVertex((l,f)=>{let d=l*a+f*n,h=l*c+f*u;o.xmin=Math.min(o.xmin,d),o.ymin=Math.min(o.ymin,h),o.xmax=Math.max(o.xmax,d),o.ymax=Math.max(o.ymax,h)}),this.center=[(o.xmin+o.xmax)/2,(o.ymin+o.ymax)/2]}},se=class extends ft{constructor(t,r,i,s){super(t,r,i,s),this.method="linear"}getRelativePosition(t,r){let{rotationMatrix00:i,rotationMatrix01:s,bounds:o}=this,{xmin:a,xmax:n}=o;return[(t*i+r*s-a)/(n-a),0]}calculateRelativeSizeFromAbsolute(){let{_size:t,bounds:r}=this,{xmin:i,xmax:s}=r;return[x(t)/(s-i),0]}},oe=class extends ft{constructor(t,r,i,s){super(t,r,i,s),this.method="rectangular"}getRelativePosition(t,r){let{bounds:i,center:s,rotationMatrix00:o,rotationMatrix01:a,rotationMatrix10:n,rotationMatrix11:c}=this,u=t*n+r*c,l=t*o+r*a-s[0],f=u-s[1];return[l*(2/(i.xmax-i.xmin)),-f*(2/(i.ymax-i.ymin))]}calculateRelativeSizeFromAbsolute(){let{_size:t,bounds:r}=this,{xmin:i,ymin:s,xmax:o,ymax:a}=r;return[x(2*t)/(o-i),x(2*t)/(a-s)]}},ae=class extends ft{constructor(t,r,i){super(t,r,i,0),this.method="circular";let{xmin:s,xmax:o,ymin:a,ymax:n}=this.bounds,c=o-s,u=n-a;this.radius=Math.sqrt(c*c+u*u)/2}getRelativePosition(t,r){let{center:i,radius:s}=this;return[(t-i[0])/s,-((r-i[1])/s)]}calculateRelativeSizeFromAbsolute(){let{_size:t}=this;return[x(t)/this.radius,0]}};function sr(e,t){if(e==null)return null;let r=pe(t.angle),i=t.gradientSize,s=t.gradientSizeUnits;switch(t.gradientMethod.toLowerCase()){case"linear":return new se(e,i,s,r);case"rectangular":return new oe(e,i,s,r);case"circular":return new ae(e,i,s);default:return qr().errorOnce(`Gradient fill method "${t.gradientMethod}" currently unsupported.`),null}}var Qr={createComputedParams:e=>e,optionalAttributes:X.optionalAttributes,attributes:S(g({},X.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:t})=>{let r=0;return e===V.Absolute&&(r|=I(Xt.isAbsolute)),t.toLowerCase()==="discrete"&&(r|=I(Xt.isDiscrete)),r}},tlbr:{count:4,type:p.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P+j,o=t.y+P;return[s,o,s+r-2*j,o+i]}},relativePosition:{count:2,type:p.HALF_FLOAT,packTessellation:({gradientStats:e},t,r,i)=>e?.getRelativePosition(r,i)??[0,0]},relativeGradientSize:{count:2,type:p.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:p.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case"rectangular":return bt.rectangular;case"circular":return bt.circular;default:return bt.linear}}}})},or=class extends N{constructor(){super(...arguments),this.vertexSpec=Qr}get _preventEffectClipping(){return!0}createTesselationParams(t){return{gradientStats:sr(t.readGeometryForDisplay(),this.evaluatedMeshParams)}}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let a=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(t,r,o),t.recordEnd()}};var Jr={optionalAttributes:C.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},C.attributes),ee.attributes)},jr={optionalAttributes:C.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},C.attributes),mt.attributes)},ne=class extends Z{constructor(){super(...arguments),this.vertexSpec=jr}},ar=class extends it{constructor(){super(...arguments),this.vertexSpec=Jr}_createOutlineWriter(t,r,i,s){return new ne(t,r,i,s)}_write(t,r,i){let s=i?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(s);if(!o)return;let a=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,k.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._lineMeshWriter.ensurePacked(t,r,i)}enqueueRequest(t,r,i){super.enqueueRequest(t,r,i),this._lineMeshWriter.enqueueRequest(t,r,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}};var $r={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1},offset:{type:p.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}},nr=class extends T{constructor(){super(...arguments),this.vertexSpec=$r}_write(t,r){t.recordStart(this.instanceId,this.attributeLayout);let i=r.getDisplayId();if(r.geometryType==="esriGeometryPoint"){let s=r.readXForDisplay(),o=r.readYForDisplay();this._writeQuad(t,i,s,o)}else r.geometryType==="esriGeometryMultipoint"&&r.readGeometryForDisplay()?.forEachVertex((o,a)=>{o>=0&&o<=512&&a>=0&&a<=512&&this._writeQuad(t,i,o,a)});t.recordEnd()}_writeQuad(t,r,i,s){let o=t.vertexCount();this._writeVertex(t,r,i,s),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}};var st=class{static getPlacement(t,r,i,s,o,a){let n=_e(i);return n?(r===-1&&t.invertY(),n.execute(t,i,s,o,a)):null}};var cr=96,It=class{constructor(t){let{offsetX:r,offsetY:i,postAngle:s,fontSize:o,haloSize:a,outlineSize:n,scaleFactor:c,transforms:u}=t;if(this.offsetX=r,this.offsetY=i,this.postAngle=s,this.fontSize=Math.min(o,cr),this.haloSize=a??0,this.outlineSize=n??0,this.transforms=u,u&&u.infos.length>1){let l=St(o,s,!1,r,i,u,!1);this.fontSize=Math.min(l.size,cr);let f=l.size/o;this.haloSize*=f,this.outlineSize*=f,this.postAngle=l.rotation,this.offsetX=l.offsetX,this.offsetY=l.offsetY}c&&(this.fontSize*=c,this.offsetX*=c,this.offsetY*=c)}};var Kr=28,O=[4,4],Ct=[16,4],ti={topLeft:Ct,topRight:Ct,bottomLeft:Ct,bottomRight:Ct},Gt=[4,2],L=[4,6],lr={topLeft:Gt,topRight:Gt,bottomLeft:L,bottomRight:L},pr={topLeft:Gt,topRight:L,bottomLeft:Gt,bottomRight:L},ei={topLeft:L,topRight:L,bottomLeft:O,bottomRight:O},ri={topLeft:O,topRight:O,bottomLeft:L,bottomRight:L},ii={topLeft:L,topRight:O,bottomLeft:L,bottomRight:O},si={topLeft:O,topRight:L,bottomLeft:O,bottomRight:L},oi={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:p.UNSIGNED_SHORT,count:2,packPrecisionFactor:B,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||Kr]},clipAngle:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>ai(e||0)},referenceSymbol:{type:p.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{let r=e.isLineLabel||!e.referenceBounds,i=be(r?"center":t.horizontalAlignment),s=Te(r?"middle":t.verticalAlignment),{offsetX:o,offsetY:a,size:n}=r?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[x(o),-x(a),Math.round(x(n)),i+1<<2|s+1]}}},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>E([[Ie,e],[Ce,!!t]])},offset:{type:p.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:i,topRight:s}=e;return[i,s,t,r]}}},textureUV:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:i,topRight:s}=e;return[i,s,t,r]}}},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontSize:{type:p.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e})=>Math.round(x(e))},referenceSize:{type:p.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>Math.round(x(t??e))},outlineColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)},haloColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>M(e)},outlineAndHaloSize:{type:p.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round(x(e)),Math.round(x(t))]}}},ur=class extends T{constructor(){super(...arguments),this.vertexSpec=oi,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,r,i){super.ensurePacked(t,r,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new It(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,r,i){let s=this._getShaping();if(!s)return;let o=r.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(t,r,s,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(t,o,i.x,i.y,s,0);if(r.geometryType==="esriGeometryPolygon"){let c=r.readCentroidForDisplay();if(!c)return;let[u,l]=c.coords;return this._writeGlyphs(t,o,u,l,s,0)}if(r.geometryType==="esriGeometryMultipoint")return void r.readGeometryForDisplay()?.forEachVertex((u,l)=>this._writeGlyphs(t,o,u,l,s,0));let a=r.readXForDisplay(),n=r.readYForDisplay();return this._writeGlyphs(t,o,a,n,s,0)}_writePlacedTextMarkers(t,r,i,s){let o=s??k.fromFeatureSetReaderCIM(r);if(!o)return;let a=-1,n=st.getPlacement(o,a,this.evaluatedMeshParams.placement,x(1),t.id,et());if(!n)return;let c=r.getDisplayId(),u=n.next();for(;u!=null;){let l=u.tx,f=-u.ty,d=-u.getAngle();this._writeGlyphs(t,c,l,f,i,d),u=n.next()}}_getShaping(t){let r=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;let s=x(r.fontSize),o=x(r.offsetX),a=x(r.offsetY),n=Nt(x(i.lineWidth),xe,ye),c=me*Nt(i.lineHeightRatio,.25,4);return ve(i.glyphs,{scale:s/fe,angle:r.postAngle,xOffset:o,yOffset:a,horizontalAlignment:i.horizontalAlignment,verticalAlignment:t||i.verticalAlignment,maxLineWidth:n,lineHeight:c,decoration:i.decoration,borderLineSizePx:x(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,r,i,s,o,a,n,c){let u=this.evaluatedMeshParams,l=this._textMeshTransformProps,f=x(l.fontSize),d=l.haloSize,h=l.outlineSize,m=x(l.offsetX),y=x(l.offsetY),[_,v]=F(u.scaleInfo,this.getTileInfo());a!==0&&o.setRotation(a);let w=o.bounds,R=i+w.x+m,D=s+w.y-y,q=2*(u.minPixelBuffer?u.minPixelBuffer/f:1),A=Math.max(w.width,w.height)*q;o.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,o.glyphs[0].textureBinding),t.recordBounds(R,D,A,A),this._writeTextBox(t,r,i,s,o.textBox,n,c),t.recordEnd());for(let G of o.glyphs){t.recordStart(this.instanceId,this.attributeLayout,G.textureBinding),t.recordBounds(R,D,A,A);let{texcoords:Q,offsets:J}=G;this._writeQuad(t,r,i,s,g({texcoords:Q,offsets:J,fontSize:f,haloSize:d,outlineSize:h,color:M(u.color),isBackground:!1,referenceBounds:n,minZoom:_,maxZoom:v},c)),t.recordEnd()}a!==0&&o.setRotation(-a)}_writeTextBox(t,r,i,s,o,a,n){let c=this.evaluatedMeshParams,{fontSize:u,haloSize:l,outlineSize:f}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:h}=c,m=g({isBackground:!0,fontSize:u,haloSize:l,outlineSize:f,referenceBounds:a},n);d&&(this._writeQuad(t,r,i,s,g({texcoords:ti,offsets:o.main,color:M(d)},m)),h||(this._writeQuad(t,r,i,s,g({texcoords:ei,offsets:o.top,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:ri,offsets:o.bot,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:ii,offsets:o.left,color:M(d)},m)),this._writeQuad(t,r,i,s,g({texcoords:si,offsets:o.right,color:M(d)},m)))),h&&(this._writeQuad(t,r,i,s,g({texcoords:lr,offsets:o.top,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:lr,offsets:o.bot,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:pr,offsets:o.left,color:M(h)},m)),this._writeQuad(t,r,i,s,g({texcoords:pr,offsets:o.right,color:M(h)},m)))}_writeQuad(t,r,i,s,o){let a=t.vertexCount();this._writeVertex(t,r,i,s,o),t.indexWrite(a+0),t.indexWrite(a+1),t.indexWrite(a+2),t.indexWrite(a+1),t.indexWrite(a+3),t.indexWrite(a+2)}},ai=e=>Math.round(e*(254/360));var ni={createComputedParams:e=>e,optionalAttributes:z.optionalAttributes,attributes:S(g({},z.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({gradientMethod:e,gradientSizeUnits:t,gradientType:r})=>E([[Tt.isAlongLine,e.toLowerCase()==="alongline"],[Tt.isAbsoluteSize,t===V.Absolute],[Tt.isDiscrete,r.toLowerCase()==="discrete"]])},tlbr:{type:p.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P+j,o=t.y+P;return[s,o,s+r-2*j,o+i]}},accumulatedDistance:{type:p.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},gradientSize:{type:p.HALF_FLOAT,count:1,pack:({gradientSize:e,gradientSizeUnits:t})=>t===V.Relative?e/100:x(e)},totalLength:{type:p.HALF_FLOAT,count:1,packTessellation:({pathLength:e})=>e},segmentDirection:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}})},hr=class extends Y{get _preventEffectClipping(){return!0}constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=ni,this._tessellationOptions.textured=!0}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);if(!s)return;let{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(t,r,s,o?.textureBinding)}};var ci={createComputedParams:e=>e,optionalAttributes:z.optionalAttributes,attributes:S(g({},z.attributes),{bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:r})=>E([[kt,e],[Fe,t],[De,r]])},tlbr:{type:p.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:r,height:i}=e,s=t.x+P,o=t.y+P;return[s,o,s+r,o+i]}},accumulatedDistance:{type:p.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:p.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:p.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>x(e)},capType:{type:p.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case W.Butt:case"butt":return 0;case W.Square:case"square":return 1;case W.Round:case"round":return 2;default:return 0}}}})},mr=class extends Y{constructor(t,r,i,s){super(t,r,i,s),this.vertexSpec=ci,this._tessellationOptions.textured=!0}_write(t,r,i){let s=i??k.fromFeatureSetReaderCIM(r);if(!s)return;let{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(t,r,s,o?.textureBinding)}};var Bt=class e{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:i,width:s,height:o,angle:a,alignment:n,outlineSize:c,referenceSize:u,sprite:l,overrideOutlineColor:f}=t;return r.rawWidth=x(s),r.rawHeight=x(o),r.angle=a,r.alignment=n,r.outlineSize=x(c),r.referenceSize=x(u),r.overrideOutlineColor=f,r.offsetX=x(t.offsetX),r.offsetY=x(t.offsetY),i!=="simple"||l.sdf||(r.rawWidth=l.width,r.rawHeight=l.height),r._computeSize(t,!1),r}static fromComplexMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{alignment:i,transforms:s,size:o,scaleX:a,anchorX:n,anchorY:c,angle:u,colorLocked:l,frameHeight:f,widthRatio:d,offsetX:h,offsetY:m,outlineSize:y,referenceSize:_,scaleFactor:v,sizeRatio:w,isAbsoluteAnchorPoint:R,rotateClockwise:D,scaleSymbolsProportionally:q,sprite:A}=t;if(s&&s.infos.length>0){let J=St(o,u,D,h,m,s);o=J.size,u=J.rotation,h=J.offsetX,m=J.offsetY,D=!1}v&&(o*=v,h*=v,m*=v);let G=a*(A.width/A.height);r.alignment=i,r.rawHeight=x(o),r.rawWidth=r.rawHeight*G,r.referenceSize=x(_),r.sizeRatio=w,r.sdfDecodeCoeff=(A.sdfDecodeCoeff??1)*w,r.angle=u,r.rotateClockwise=D,r.anchorX=n,r.anchorY=c,r.offsetX=x(h),r.offsetY=x(m),R&&o&&(A.sdf?r.anchorX=n/(o*d):r.anchorX=n/(o*G),r.anchorY=c/o);let Q=q&&f?o/f:1;return r.outlineSize=y===0||isNaN(y)?0:x(y)*Q,r.scaleSymbolsProportionally=q,r.colorLocked=l,r._computeSize(t,!0),r}constructor(t,r,i,s,o,a,n){this.sprite=t,this.color=r,this.outlineColor=i,this.minPixelBuffer=s,this.placement=o,this.scaleInfo=a,this.effects=n,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=gt.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,r){let{sprite:i,hasSizeVV:s}=t,o=!!i.sdf,a=i.sdfPaddingRatio??.5,{rawWidth:n,rawHeight:c,sizeRatio:u,outlineSize:l}=this,f=i.rect,d=n*u,h=c*u,m=0,y=0;if(o){let D=1/(1-a);if(d*=D,h*=D,s)this.computedWidth=d,this.computedHeight=h;else{let q=r&&n>c?d:n,A=c,G=l+2*1;this.computedWidth=Math.min(q+G,d),this.computedHeight=Math.min(A+G,h);let Q=Math.max(i.width,i.height)/Math.max(d,h);m=(this.computedWidth-d)*Q,y=(this.computedHeight-h)*Q}}else this.computedWidth=d*(f.width/i.width),this.computedHeight=h*(f.height/i.height),m=2*P,y=2*P;let _=f.x+P-m/2,v=f.y+P-y/2,w=_+i.width+m,R=v+i.height+y;this.texXmin=fr(_),this.texYmin=fr(v),this.texXmax=dr(w),this.texYmax=dr(R),this.computedWidth*=(this.texXmax-this.texXmin)/(w-_),this.computedHeight*=(this.texYmax-this.texYmin)/(R-v),this.anchorX*=d/this.computedWidth,this.anchorY*=h/this.computedHeight}};function fr(e,t=1e-7){let r=Math.ceil(e);return r-e<t?r:Math.floor(e)}function dr(e,t=1e-7){let r=Math.floor(e);return e-r<t?r:Math.ceil(e)}var li=3.14159265359/180,pi=128/Math.PI;function ui(e,t){return e%=t,Math.abs(e>=0?e:e+t)}function hi(e){return ui(e*pi,256)}function mi(e,t,r,i,s=!1){let o=Pe(),a=s?1:-1;return Se(o),(t||r)&&ke(o,o,[t,-r]),i&&Me(o,o,a*li*-i),o}var fi={createComputedParams:e=>Bt.from(e),optionalAttributes:{zoomRange:{type:p.SHORT,count:2,packPrecisionFactor:B,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{pos:{type:p.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:i,colorLocked:s})=>{let o=0;return e.sdf&&(o|=I($.bitset.isSDF)),t===gt.MAP&&(o|=I($.bitset.isMapAligned)),r&&(o|=I($.bitset.scaleSymbolsProportionally)),i&&(o|=I($.bitset.overrideOutlineColor)),s&&(o|=I($.bitset.colorLocked)),o}},offset:{type:p.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:r,anchorX:i,anchorY:s,offsetX:o,offsetY:a,rotateClockwise:n})=>{let c=mi(0,o,a,-e,n),u=-(.5+i)*t,l=-(.5-s)*r,f=[u,l],d=[u+t,l],h=[u,l+r],m=[u+t,l+r];return ot(f,f,c),ot(d,d,c),ot(h,h,c),ot(m,m,c),[f,d,h,m]}}},textureUV:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:i})=>[[t,i],[e,i],[t,r],[e,r]]}},color:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>M(e)},outlineColor:{type:p.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>M(e)},sizing:{type:p.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:i})=>{let s=Math.max(e,t);return[At(s,128),At(r,128),At(i,128),0]}},placementAngle:{type:p.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>hi(e)},sdfDecodeCoeff:{type:p.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}},xr=class extends T{constructor(){super(...arguments),this.vertexSpec=fi}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,r,i){let s=this.evaluatedMeshParams.sprite?.textureBinding,o=r.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,s);let a=this.evaluatedMeshParams.minPixelBuffer,n=Math.max(this.evaluatedMeshParams.computedWidth,a),c=Math.max(this.evaluatedMeshParams.computedHeight,a),u=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,l=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,f=this.evaluatedMeshParams.offsetX+u,d=-this.evaluatedMeshParams.offsetY+l;if(this.evaluatedMeshParams.placement!=null)this._writePlacedMarkers(t,r,i,n,c);else if(i?.nextPath()){i.nextPoint();let h=i.x,m=i.y;t.recordBounds(h+f,m+d,n,c),this._writeQuad(t,o,h,m)}else if(r.geometryType==="esriGeometryPolygon"){let h=r.readCentroidForDisplay();if(!h)return;let[m,y]=h.coords;t.recordBounds(m+f,y+d,n,c),this._writeQuad(t,o,m,y)}else if(r.geometryType==="esriGeometryPoint"){let h=r.readXForDisplay(),m=r.readYForDisplay();t.recordBounds(h+f,m+d,n,c),this._writeQuad(t,o,h,m)}else r.readGeometryForDisplay()?.forEachVertex((m,y)=>{t.recordBounds(m+f,y+d,n,c),Math.abs(m)>1024||Math.abs(y)>1024||this._writeQuad(t,o,m,y)});t.recordEnd()}_writePlacedMarkers(t,r,i,s,o){let a=i??k.fromFeatureSetReaderCIM(r)?.clone();if(!a)return;let n=-1,c=st.getPlacement(a,n,this.evaluatedMeshParams.placement,x(1),t.id,et());if(!c)return;let u=r.getDisplayId(),l=c.next(),f=this.evaluatedMeshParams.offsetX,d=-this.evaluatedMeshParams.offsetY;for(;l!=null;){let h=l.tx,m=-l.ty;if(Math.abs(h)>1024||Math.abs(m)>1024){l=c.next();continue}let y=-l.getAngle();t.recordBounds(h+f,m+d,s,o),this._writeQuad(t,u,h,m,y),l=c.next()}}_writeQuad(t,r,i,s,o){let a=t.vertexCount(),n=o==null?null:{placementAngle:o};this._writeVertex(t,r,i,s,n),t.indexWrite(a+0),t.indexWrite(a+1),t.indexWrite(a+2),t.indexWrite(a+1),t.indexWrite(a+3),t.indexWrite(a+2)}};var di={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:p.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:p.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:p.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{let t=x(e),r=-t/2,i=-t/2;return[[r,i],[r+t,i],[r,i+t],[r+t,i+t]]}}},texCoords:{type:p.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:p.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:p.UNSIGNED_BYTE,count:1,pack:({size:e})=>x(e)},zoomRange:{type:p.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}}},yr=class extends T{constructor(){super(...arguments),this.vertexSpec=di}_write(t,r){let i=r.getDisplayId(),s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(x(this.evaluatedMeshParams.size),s),a,n;if(r.geometryType==="esriGeometryPoint")a=r.readXForDisplay(),n=r.readYForDisplay();else{let u=r.readCentroidForDisplay();if(!u)return;a=u?.coords[0],n=u?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(a,n,o,o);let c=t.vertexCount();this._writeVertex(t,i,a,n),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}};export{F as a,I as b,M as c,Et as d,T as e,$e as f,rt as g,Ft as h,er as i,Y as j,it as k,ir as l,or as m,ar as n,nr as o,Kr as p,ur as q,hr as r,mr as s,xr as t,yr as u};
