import{c as O}from"./chunk-2I3LIA7G.js";import{a as F}from"./chunk-IDSQ2YJ4.js";import{a as x,c as R}from"./chunk-XY4QPRKP.js";import{b as L}from"./chunk-3TRID6QS.js";import{a as A,b as h,g as j}from"./chunk-GI4NW5SA.js";import{e as y}from"./chunk-T5NHE3SD.js";import{a as v}from"./chunk-MJO3PLZV.js";import{a as S}from"./chunk-LXEWGICX.js";import{i as b}from"./chunk-YQGS4EZO.js";import{a as V}from"./chunk-3REMXE4W.js";import{f as C,i as N}from"./chunk-OLOKUDVI.js";import{a as M}from"./chunk-BOVYXYHK.js";import{n as P}from"./chunk-Z5Q7KLA4.js";import{a as U}from"./chunk-4XZ6X7MQ.js";import{f as D}from"./chunk-QHVIRF5H.js";import{a as E,b as I}from"./chunk-N2WTMF3X.js";async function ce(e,t,n,r){let i=n?k(e,n):r,c=C(t.x,t.y);i.requiresGroundFeedback=!0,i.enableDraped=!0;let o=L(e.state.viewingMode);o.options.selectionMode=!0,o.options.store=h.ALL,e.sceneIntersectionHelper.intersectIntersectorScreen(c,o,i);let d=W(e,o.results.all,i.graphics),s=o.results.ground,a=x(s,e),u=a!=null&&"type"in a&&b(a.type)?a:null,l={screenPoint:t,results:d,ground:{mapPoint:m(e,s),distance:j(s)?s.distanceInRenderSpace:0,layer:u}};return v.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(l.intersector=o),l}function le(e,t,n,r){let i=n?k(e,n):r,c=!(!i.graphics?.include&&!i.graphics?.exclude),o=!(!i.mediaElements?.include&&!i.mediaElements?.exclude),d=N(t);i.enableDraped=i.include&&!i.include.has(y)||i.exclude?.has(y);let s=e.sceneIntersectionHelper,a=L(e.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=c||o?h.ALL:h.MIN,a.options.excludeLabels=n?.excludeLabels??!1,s.intersectIntersectorScreen(d,a,i),c||o){for(let u of a.results.all){let l=R(u,e);if(l==null||c&&(l.type!=="graphic"||G(i.graphics,l.graphic))||o&&(l.type!=="media"||H(i.mediaElements,l.element)))return m(e,u)}return null}return m(e,a.results.min)}function W(e,t,n){let r=new Array,i=null;for(let c=0;c<t.length;c++){let o=t[c],d=x(o,e);if(d!=null&&(d===e.map.ground||"type"in d&&b(d.type)))break;let s=R(o,e);if(s==null)continue;if(s.type==="graphic"){if(i==null&&c!==t.length-1&&(i=new Set),i!=null){let l=w(s.graphic);if(i.has(l))continue;i.add(l)}if(!G(n,s.graphic))continue}let a=m(e,o),u=o.distanceInRenderSpace;if(s.type==="media"){let l=s.element.toSource(a);r.push(I(E({},s),{mapPoint:a,distance:u,sourcePoint:l}))}else r.push(I(E({},s),{mapPoint:a,distance:u}))}return r}function m(e,t,n){return t.getIntersectionPoint(f)?(n=X(e,f,n),t.intersector===A.TERRAIN&&e.basemapTerrain&&(n.z=O(e.basemapTerrain,n)??0),n):null}function w(e){let t=e.sourceLayer,n=e.layer,r=t&&"objectIdField"in t?t:n&&"objectIdField"in n?n:t;if(r){let i=r.objectIdField??F,c=e.attributes?.[i];if(c)return`o-${r.id}-${c}`}return`u-${e.uid}`}function G(e,t){return H(e,w(t))}function H(e,t){return e==null||(e.include==null||e.include.has(t))&&(e.exclude==null||!e.exclude.has(t))}function X(e,t,n){let r=e.spatialReference||U.WGS84;return S(t,e.renderSpatialReference,f,r)?t=f:(r=U.WGS84,S(t,e.renderSpatialReference,f,r)&&(t=f)),n?(n.x=t[0],n.y=t[1],n.z=t[2],n.spatialReference=r):n=new P(t,r),n}function k(e,t){let n=T(e,t.include,g.INCLUDE),r=T(e,t.exclude,g.EXCLUDE);return{include:n.layerUids,exclude:r.layerUids,graphics:{include:n.graphicUids,exclude:r.graphicUids},mediaElements:{include:n.mediaElements,exclude:r.mediaElements}}}function T(e,t,n,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!t)return r;if(t instanceof V)_(r,w(t)),n===g.INCLUDE&&(e.graphicsView!=null&&t.layer===e?p(r,e.graphicsView.processor.layer.id):t.layer&&p(r,t.layer.uid));else if("layer"in t&&"element"in t)$(r,t.element),n===g.INCLUDE&&p(r,t.layer.uid);else if(D(t))for(let i of t)i===e.graphics&&e.graphicsView!=null?p(r,e.graphicsView.processor.layer.id):i===e.map.ground?p(r,y):T(e,i,n,r);else"uid"in t&&p(r,t.uid);return r}function p(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function _(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function $(e,t){e.mediaElements||(e.mediaElements=new Set),e.mediaElements.add(t)}var f=M(),g;(function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"})(g||(g={}));export{ce as a,le as b,X as c};
