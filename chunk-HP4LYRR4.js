import{a as v}from"./chunk-AFC2H4Q3.js";import{b as A}from"./chunk-4G7UTTZJ.js";import{d as a,e as _}from"./chunk-HX2VGIR2.js";import{d as c}from"./chunk-UBFCO3DV.js";import{u as d}from"./chunk-QHVIRF5H.js";import{i as V}from"./chunk-CKJ56T2Q.js";import{h as S,i as N,t as D}from"./chunk-UHRSAPGQ.js";import{a as E,b as h}from"./chunk-N2WTMF3X.js";var J="HH:mm",Q="HH:mm:ss",W="HH:mm:ss.SSS";var Y=[W,Q,J,"TT"],Z="yyyy-MM-dd";function y(e){if(!e||!a(e))return null;let i=c.fromFormat(e,Z);return i.isValid?i:null}function F(e){return e&&a(e)?V(Y,i=>{let n=c.fromFormat(e,i);return n.isValid?n:null})??null:null}function T(e){if(!e||!a(e))return null;let i=c.fromISO(e);return i.isValid?i:null}var o;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(o||(o={}));var O=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function K(e){return e!=null&&O.has(e.type)}function M(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function L(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function R(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}var ee=new Set(["single","double","esriFieldTypeSingle","esriFieldTypeDouble"]),Pe=d(O,ee);function ie(e,i){let n=i??e?.domain;if(!n||n.type!=="range")return;let t="range"in n?n.range[0]:n.minValue,r="range"in n?n.range[1]:n.maxValue,l=K(e);return M(e)||R(e)||L(e)?h(E({},ne(e,r,t)),{isInteger:l}):{min:t!=null&&typeof t=="number"?t:null,max:r!=null&&typeof r=="number"?r:null,rawMin:t,rawMax:r,isInteger:l}}function ne(e,i,n){return M(e)?{min:y(n)?.toMillis(),max:y(i)?.toMillis(),rawMin:n,rawMax:i}:R(e)?{min:F(n)?.toMillis(),max:F(i)?.toMillis(),rawMin:n,rawMax:i}:L(e)?{min:T(n)?.toMillis(),max:T(i)?.toMillis(),rawMin:n,rawMax:i}:{max:null,min:null}}function $(e){if(!e)return;let i=e.match(te);return i?.groups?i.groups.doubleQuoted??i.groups.singleQuoted??i.groups.dotNotation:void 0}var te=/^(\$feature\[(?:"(?<doubleQuoted>[^"]+)"|'(?<singleQuoted>[^']+)')\]|\$feature\.(?<dotNotation>[a-zA-Z_][a-zA-Z0-9_]*))$/i;function ze(e){return e.match(re)?.[1]?.replace(/\\'/g,"'")??null}var re=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var le=/^([0-9_])/,ae=/[^a-z0-9_\u0080-\uffff]+/gi;function Ke(e){return e==null?null:e.trim().replaceAll(ae,"_").replace(le,"F$1")||null}var se=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],oe=["field","normalizationField"];function ei(e,i){if(e!=null&&i!=null){for(let n of Array.isArray(e)?e:[e])if(U(se,n,i),"visualVariables"in n&&n.visualVariables)for(let t of n.visualVariables)U(oe,t,i)}}function U(e,i,n){if(e)for(let t of e){let r=S(t,i),l=r&&typeof r!="function"&&n.get(r);l&&N(t,l.name,i)}}function ii(e,i){if(e!=null&&i?.fields?.length)if("startField"in e){let n=i.get(e.startField),t=i.get(e.endField);e.startField=n?.name??null,e.endField=t?.name??null}else{let n=i.get(e.startTimeField),t=i.get(e.endTimeField);e.startTimeField=n?.name??null,e.endTimeField=t?.name??null}}var I=new Set;function x(e,i){return e&&i?(I.clear(),f(I,e,i),Array.from(I).sort()):[]}function f(e,i,n){if(n)if(i?.fields?.length)if(n.includes("*"))for(let{name:t}of i.fields)e.add(t);else for(let t of n)g(e,i,t);else{if(n.includes("*"))return e.clear(),void e.add("*");for(let t of n)t!=null&&e.add(t)}}function g(e,i,n){if(typeof n=="string")if(i){let t=i.get(n);t&&e.add(t.name)}else e.add(n)}function ni(e,i){return i==null||e==null?[]:i.includes("*")?(e.fields??[]).map(n=>n.name):i}function ti(e,i,n=1){if(!i||!e)return[];if(i.includes("*"))return["*"];let t=x(e,i);return t.length/e.fields.length>=n?["*"]:t}async function u(e,i,n){if(!n)return;let t,r=$(n);if(r)t=[r];else{let{arcadeUtils:l}=await A();t=l.extractFieldNames(n,i?.fields?.map(s=>s.name))}for(let l of t)g(e,i,l)}async function w(e,i,n){if(n&&n!=="1=1"){let t=await v(n,i);if(!t.isStandardized)throw new D("fieldUtils:collectFilterFields","Where clause is not standardized",{where:n});f(e,i,t.fieldNames)}}function ri({displayField:e,fields:i}){return e||(i?.length?b(i,"name-or-title")||b(i,"unique-identifier")||b(i,"type-or-category")||ue(i):null)}function ue(e){for(let i of e){if(!i?.name)continue;let n=i.name.toLowerCase();if(n.includes("name")||n.includes("title"))return i.name}return null}function b(e,i){for(let n of e)if(n?.valueType&&n.valueType===i)return n.name;return null}async function li(e,i){if(!i)return;let n=i.elevationInfo?.featureExpressionInfo;return n?n.collectRequiredFields(e,i.fieldsIndex):void 0}function de(e,i,n){n.onStatisticExpression?u(e,i,n.onStatisticExpression.expression):e.add(n.onStatisticField)}async function ai(e,i,n){if(!i||!n||!("fields"in n))return;let t=[],r=n.popupTemplate;t.push(k(e,i,r)),n.fields&&t.push(...n.fields.map(async l=>de(e,i.fieldsIndex,l))),await Promise.all(t)}async function si(e,i){let{fieldsIndex:n,trackInfo:t}=i;if(!i||!t||!n)return;let r=[t.latestObservations.renderer?.collectRequiredFields(e,n),t.previousObservations.renderer?.collectRequiredFields(e,n),t.trackLines.renderer?.collectRequiredFields(e,n)];t.popupTemplate&&r.push(k(e,i,t.popupTemplate));for(let l of[t.latestObservations.labelingInfo,t.previousObservations.labelingInfo,t.trackLines.labelingInfo])if(l)for(let s of l)r.push(G(e,n,s));await Promise.all(r)}async function k(e,i,n){let t=[];n?.expressionInfos&&t.push(...n.expressionInfos.map(l=>u(e,i.fieldsIndex,l.expression)));let r=n?.content;if(Array.isArray(r))for(let l of r)l.type==="expression"&&l.expressionInfo&&t.push(u(e,i.fieldsIndex,l.expressionInfo.expression));await Promise.all(t)}async function oi(e,i,n){i&&(i.timeInfo&&n?.timeExtent&&f(e,i.fieldsIndex,[i.timeInfo.startField,i.timeInfo.endField]),i.floorInfo&&f(e,i.fieldsIndex,[i.floorInfo.floorField]),n?.where!=null&&await w(e,i.fieldsIndex,n.where))}async function ui(e,i,n){i&&n&&await Promise.all(n.map(t=>ce(e,i,t)))}async function ce(e,i,n){i&&n&&(n.valueExpression?await u(e,i.fieldsIndex,n.valueExpression):n.field&&g(e,i.fieldsIndex,n.field))}function di(e){return e?x(e.fieldsIndex,C(e)):[]}function fe(e){if(!e)return[];let i=e.geometryFieldsInfo;return i?x(e.fieldsIndex,[i.shapeAreaField,i.shapeLengthField]):[]}async function ci(e,i,n){if(!i||!n)return;let t=i.fieldsIndex;await Promise.all(n.filters.map(r=>w(e,t,r.where)))}var me=new Set(["oid","global-id","guid"]),pe=new Set(["oid","global-id"]),ge=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function ye(e){let i=new Set;P(e).forEach(t=>i.add(t)),fe(e).forEach(t=>i.add(t.toLowerCase()));let n=e&&"infoFor3D"in e?e.infoFor3D:void 0;return n&&(Object.values(n.assetMapFieldRoles).forEach(t=>i.add(t.toLowerCase())),Object.values(n.transformFieldRoles).forEach(t=>i.add(t.toLowerCase()))),Array.from(i)}function C(e){if(!e)return[];let i="editFieldsInfo"in e&&e.editFieldsInfo;if(!i)return[];let{creationDateField:n,creatorField:t,editDateField:r,editorField:l}=i;return[n,t,r,l].filter(Boolean)}function P(e){return C(e).map(i=>i.toLowerCase())}function fi(e,i){return e.editable&&!me.has(e.type)&&!P(i).includes(e.name?.toLowerCase()??"")}function mi(e,i){let n=e.name?.toLowerCase()??"";return!(i?.objectIdField!=null&&n===i.objectIdField.toLowerCase()||i?.globalIdField!=null&&n===i.globalIdField.toLowerCase()||ye(i).includes(n)||pe.has(e.type)||ge.some(t=>t.test(n)))}async function pi(e,i){let{labelingInfo:n,fieldsIndex:t}=i;n?.length&&await Promise.all(n.map(r=>G(e,t,r)))}async function G(e,i,n){if(!n)return;let t=n.getLabelExpression(),r=n.where;if(t.type==="arcade")await u(e,i,t.expression);else{let l=t.expression.match(/{[^}]*}/g);l&&l.forEach(s=>{g(e,i,s.slice(1,-1))})}await w(e,i,r)}function gi(e){let i=e.defaultValue;return i!==void 0&&z(e,i)?i:e.nullable?null:void 0}function yi(e){let i=typeof e=="string"?{type:e}:e;return Se(i)?255:i.type==="esriFieldTypeDate"||i.type==="date"?8:void 0}function H(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function Fe(e){return e===null||H(e)}function Te(e){return e===null||Number.isInteger(e)}function Ie(){return!0}function z(e,i){let n;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":n=e.nullable?Te:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":n=e.nullable?Fe:H;break;case"string":case"esriFieldTypeString":n=e.nullable?_:a;break;default:n=Ie}return arguments.length===1?n:n(i)}var X=["integer","small-integer","big-integer"],j=["single","double"],Fi=[...X,...j],be=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],xe=["esriFieldTypeSingle","esriFieldTypeDouble"],q=new Set([...X,...be]),we=new Set([...j,...xe]),Ee=d(q,we);function Ti(e){return e!=null&&q.has(e.type)}function he(e){return e!=null&&Ee.has(e.type)}function Se(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Ii(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function bi(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function xi(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function wi(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function Ei(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function hi(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function Si(e,i){return Ne(e,i)===null}var m,p;function Ni(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function Ne(e,i){return e==null||e.nullable&&i===null?null:z(e,i)?he(e)&&!De(e.type,Number(i))?m.OUT_OF_RANGE:null:p.INVALID_TYPE}function De(e,i){let n=typeof e=="string"?B(e):e;if(!n)return!1;let t=n.min,r=n.max;return n.isInteger?Number.isInteger(i)&&i>=t&&i<=r:i>=t&&i<=r}function B(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return Ve;case"esriFieldTypeInteger":case"integer":return _e;case"esriFieldTypeBigInteger":case"big-integer":return ve;case"esriFieldTypeSingle":case"single":return Ae;case"esriFieldTypeDouble":case"double":return Oe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(m||(m={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(p||(p={}));var Ve={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},_e={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},ve={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Ae={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Oe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Di(e,i,n){switch(e){case o.INVALID_CODED_VALUE:return`Value ${n} is not in the coded domain - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case o.VALUE_OUT_OF_RANGE:return`Value ${n} is out of the range of valid values - field: ${i.name}, domain: ${JSON.stringify(i.domain)}`;case p.INVALID_TYPE:return`Value ${n} is not a valid value for the field type - field: ${i.name}, type: ${i.type}, nullable: ${i.nullable}`;case m.OUT_OF_RANGE:{let{min:t,max:r}=B(i.type);return`Value ${n} is out of range for the number type - field: ${i.name}, type: ${i.type}, value range is ${t} to ${r}`}}}function Vi(e,i){return!Me(e,i,null)}function Me(e,i,n){if(!i?.attributes||!e){if(n!=null)for(let l of e??[])n.add(l);return!0}let t=new Set(Object.keys(i.attributes)),r=!1;for(let l of e)if(!t.has(l)){if(r=!0,n==null)break;n.add(l)}return r}function _i(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(i=>e.toLowerCase().startsWith(i))}function vi(e){let i=e?.match(/{[^}]+}/g);return i?i.map(n=>n.slice(1,-1).split(":")[0].trim()):[]}export{ie as a,$ as b,ze as c,Ke as d,ei as e,ii as f,x as g,f as h,g as i,ni as j,ti as k,u as l,ri as m,li as n,ai as o,si as p,oi as q,ui as r,di as s,ci as t,fi as u,mi as v,pi as w,gi as x,yi as y,Ti as z,he as A,Se as B,Ii as C,bi as D,xi as E,wi as F,Ei as G,hi as H,Si as I,Ni as J,Ne as K,Di as L,Vi as M,Me as N,_i as O,vi as P};
