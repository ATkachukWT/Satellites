import{b as G}from"./chunk-XMOJ4BVW.js";import{c as ot}from"./chunk-2I3LIA7G.js";import{a as Ne}from"./chunk-MF655E4C.js";import{a as Re,b as Jt}from"./chunk-4X7VNDTG.js";import{a as _e,b as rt}from"./chunk-34RMJISL.js";import{b as Bt}from"./chunk-3TRID6QS.js";import{o as Pe}from"./chunk-UBQPWKE4.js";import{a as zt,b as jt,e as kt}from"./chunk-YSD7LK2L.js";import{a as ce}from"./chunk-LXEWGICX.js";import{b as Vt,f as qt,m as Wt}from"./chunk-CAXK5KYB.js";import{c as Oe}from"./chunk-3CCK7BDD.js";import{a as Me}from"./chunk-QCZ3ZIGQ.js";import{I as Lt,K as nt,R as se,S as Gt,T as Ht,o as Ft,u as et,z as tt}from"./chunk-VMECOA4F.js";import{a as ie,b as Ut}from"./chunk-6DGDLLNL.js";import{a as be}from"./chunk-ALWV3RJ2.js";import{h as Ke,q as Ct}from"./chunk-TPFJWNIU.js";import{a as _t,b as $e,c as Nt}from"./chunk-EM35R6FY.js";import{w as It}from"./chunk-QXXXCEV5.js";import{H as Pt,I as Qe,a as S,b as P,c as Dt,d as W,e as B,n as w,o as ye,p as oe,q as Ye,s as bt,u as te,v as C,w as L,x as Ot,y as ae}from"./chunk-6B5XFA6F.js";import{j as Rt,k as St,p as wt,s as vt}from"./chunk-ZTOZWLEE.js";import{a as At}from"./chunk-PTZYZULI.js";import{c as Et,h as xt}from"./chunk-NMLYCCKN.js";import{a as Ze}from"./chunk-RSDQHAJX.js";import{a as f,b as Ie,c as q,i as Xe}from"./chunk-BOVYXYHK.js";import{p as Te}from"./chunk-B3FO6PT7.js";import{i as De}from"./chunk-C4UMJHQC.js";import{q as Mt}from"./chunk-LXFQWIWE.js";import{b as yt,f as Je,h,i as v,k as ge,l as F}from"./chunk-QT6UNBJP.js";import{m as Ce}from"./chunk-LFH24RLM.js";import{j as Tt,n as T}from"./chunk-Z5Q7KLA4.js";import{a as he}from"./chunk-4XZ6X7MQ.js";import{J as N,j as re}from"./chunk-KGVXGH6H.js";import{v as O}from"./chunk-CKJ56T2Q.js";import{r as gt}from"./chunk-UHRSAPGQ.js";import{a as dt,b as ht}from"./chunk-N2WTMF3X.js";var Nn=f(),Ue=f();function Fe(){return{direction:f(),up:f()}}function Le(e,t,n,r,o){let a=te(Nn,e),i=C(a,r),s=i>0;i=Math.abs(i),i>.99&&(i=Math.abs(C(t,r)),i<.99?(P(a,t),s&&w(a,a,-1)):a=null);let c=0;if(a){w(Ue,r,C(r,a)),B(a,a,Ue);let u=C(a,o)/(S(a)*S(o));L(Ue,a,o),c=(C(Ue,r)>0?1:-1)*v(ge(u))}let l=v(ge(-C(r,e)/S(e)));return n?(n.heading=c,n.tilt=l,n):{heading:c,tilt:l}}function Ge(e,t,n,r){B(Xt,n,t),Lt(r,jt(t,Xt),e)||e===n||P(e,n)}var Xt=f();function Vr(e,t,n,r){return e.renderCoordsHelper.fromRenderCoords(t.eye,He,r)!=null&&Mt(n,He)}function Un(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function Yt(e,t,n,r){let o=e.state.camera.clone();t&&n&&r&&(o.eye=t,o.center=n,o.up=r),Fn(e,o.ray,J)||P(J,o.center);let a=e.state.constraints,i=a.minimumPoiDistance;if(Ye(o.eye,J)<i){let s=a.collision.enabled;P(ne,o.viewForward),w(ne,ne,i),s?o.eye=B(He,J,ne):W(J,o.eye,ne);let c=e.renderCoordsHelper,l=c.getAltitude(o.eye),u=a.collision.elevationMargin;s&&l<u&&(B(ne,J,o.eye),o.eye=c.setAltitude(He,u,o.eye),W(J,o.eye,ne))}return o.center=J,o}function Zt(e,t,n){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;let r=Un(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=o.compute(t,n,e.renderDataExtent,r,Gn),i=a*a;return Ye(t,n)>i}function Fn(e,t,n){let r=Kt[e.viewingMode];r||(r=Bt(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Kt[e.viewingMode]=r);let{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,n)||Zt(e,t.origin,n))||!(!e.renderCoordsHelper.intersectManifold(t,0,n)||Zt(e,t.origin,n))||!!o&&Ln(t,n,N(e.spatialReference).radius)}function Ln(e,t,n){let r=C(e.origin,e.origin)-n*n,o=r>0?Math.sqrt(r)/3:1;return w(t,e.direction,o/S(e.direction)),W(t,t,e.origin),!0}var Kt={},He=f(),J=f(),ne=f(),Gn={near:0,far:0};function Qt(e,t){let n=[],r=[];return ze(n,e,t,U.LEFT),ze(r,n,t,U.BOTTOM),ze(n,r,t,U.RIGHT),ze(r,n,t,U.TOP),r}function ze(e,t,n,r){let o=Hn(n,r);if(e.length=0,t.length){o(je,t[0],t[0])===I.INSIDE&&Se(e,t[0]);for(let a=0;a<t.length;a++){let i=t[a===t.length-1?0:a+1];switch(o(je,t[a],i)){case I.INSIDE:Se(e,i);break;case I.INSIDE_OUT:Se(e,$e(je));break;case I.OUTSIDE_IN:Se(e,$e(je)),Se(e,i);case I.OUTSIDE:}}}}function Se(e,t){e.length!==0&&It(e.at(-1),t)||e.push(t)}function Hn(e,t){let n=t===U.LEFT||t===U.RIGHT?0:1,r=e[t],o=t===U.LEFT||t===U.BOTTOM?le.MIN:le.MAX,a=n===0?1:0;return(i,s,c)=>{if(s[n]<r&&c[n]<r)return o===le.MIN?I.OUTSIDE:I.INSIDE;if(s[n]>r&&c[n]>r)return o===le.MIN?I.INSIDE:I.OUTSIDE;let l=(c[a]-s[a])/(c[n]-s[n]),u=s[a]+l*(r-s[n]);return i[n]=r,i[a]=u,(s[n]<r?1:-1)*o>0?I.OUTSIDE_IN:I.INSIDE_OUT}}var le,I,U;(function(e){e[e.MIN=1]="MIN",e[e.MAX=-1]="MAX"})(le||(le={})),function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE_IN=2]="OUTSIDE_IN",e[e.INSIDE_OUT=3]="INSIDE_OUT"}(I||(I={})),function(e){e[e.LEFT=0]="LEFT",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP"}(U||(U={}));var je=_t();var $t=q(0,1,0),en=q(0,0,1),we=be(),H=f(),z=f();function tn(e,t,n,r=Fe()){let{direction:o,up:a}=r;return vt(we,-h(t)),St(we,we,h(n)),ae(o,en,we),w(o,o,-1),ae(a,$t,we),r}function zn(e,t,n,r){return Le(t,n,r,en,$t)}function jn(e,t,n,r){let o=tn(e,n,r),a=f();return w(a,o.direction,-t),W(a,a,e),{up:o.up,eye:a,heading:n,tilt:r}}function kn(e){return v(e)}function Vn(e){return h(e)}function qn(e,t,n,r,o){let a=e.renderSpatialReference,i=e.spatialReference??t.spatialReference;return ie(t,H,a),ie(t,z,a),H[0]-=n/2,z[0]+=n/2,H[1]-=r/2,z[1]+=r/2,ce(H,a,H,i),ce(z,a,z,i),o?(o.xmin=H[0],o.ymin=H[1],o.xmax=z[0],o.ymax=z[1],o.spatialReference=i):o=new Ce(H[0],H[1],z[0],z[1],i),o}function Wn(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=e.state.camera.eye,s=[],c=n.planes[Pe.FAR];for(let l=0;l<4;l++){let u=n.lines[l];r.intersectInfiniteManifold(Oe(u.origin,u.direction),o,_)||Bn(_,n,r,u.endpoint,o),Ge(_,i,_,c),s.push(Nt(_[0],_[1]))}return Jn(Qt(s,r.extent),r,a)}function Bn(e,t,n,r,o){let a=t.lines[G.FAR_LEFT].direction,i=(o-n.getAltitude(r))/a[2];ye(e,r,a,i)}function Jn(e,t,n){let r=e.map(o=>(Dt(_,o[0],o[1],0),t.fromRenderCoords(_,_,n),[_[0],_[1]]));return r.length<=2?new Te({spatialReference:n}):(r.push(r[0].slice()),De(r)||r.reverse(),new Te({rings:[r],spatialReference:n}))}var _=f(),nn=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:zn,eyeForCenterWithHeadingTilt:jn,eyeTiltToLookAtTilt:Vn,headingTiltToDirectionUp:tn,lookAtTiltToEyeTilt:kn,toArea:Wn,toExtent:qn},Symbol.toStringTag,{value:"Module"}));function on(e,t,n){e.worldUpAtPosition(t,rn),B(at,n,t);let r=S(at);return r===0?0:ge(C(at,rn)/r)}var rn=f(),at=f();function an(e,t,n){if(t.longitude==null||t.latitude==null||n.longitude==null||n.latitude==null)throw new Error("Invalid points: no lon/lat");return Xn(e,t.longitude,t.latitude,n.longitude,n.latitude)}function Xn(e,t,n,r,o){let a=h(n),i=h(o),s=a-i,c=h(t)-h(r),l=Math.sin(s/2),u=Math.sin(c/2),m=2*F(Math.sqrt(l*l+Math.cos(a)*Math.cos(i)*u*u))*e;return Math.round(1e4*m)/1e4}function sn(e,t,n){let r=t.spatialReference,o=N(r),a=new T(t.x,e.y,r),i=new T(n.x,e.y,r),s=new T(e.x,t.y,r),c=new T(e.x,n.y,r);return{lon:an(o.radius,a,i),lat:an(o.radius,s,c)}}function cn(e,t,n){let r=t/n,o=h(e),a=Math.sin(r/2),i=Math.cos(o),s=2*F(Math.sqrt(a*a/(i*i)));return v(s)}function Zn(e,t){let n=e/15;return t||(n=Math.round(n)),n}function Mo(e,t){let n=e?.[0];if(n==null)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=Zn(n,!0);let r=t.hours%1;t.hours-=r,t.minutes=60*r;let o=t.minutes%1;return t.minutes-=o,t.seconds=Math.round(60*o),t}var un=q(0,0,1),fn=te(f(),q(1,1,1)),Kn=new Re(-180,180),ve=be(),X=f(),ue=f();function mn(e,t,n,r=Fe()){L(X,e,un),C(X,X)===0&&L(X,e,fn),wt(ve,-h(t),e),Rt(ve,ve,-h(n),X);let{up:o,direction:a}=r;return L(o,X,e),te(o,o),ae(o,o,ve),te(a,e),bt(a,a),ae(a,a,ve),r}function Yn(e,t,n,r){let o=X,a=ue;return te(o,e),L(ue,o,un),C(ue,ue)===0&&L(ue,o,fn),L(a,ue,o),Le(t,n,r,o,a)}function Qn(e,t,n,r){let o={eye:f(),up:null,tilt:r,heading:n},a=X;a[0]=e[0],a[1]=e[2],a[2]=-e[1];let i=t,s=h(n),c=h(r),l=Math.sin(s),u=Math.cos(s),m=Math.sin(c),d=Math.cos(c),g=S(a),p;if(Math.abs(c)<1e-8)p=i+g;else{let xe=g/m,Ae=F(i/xe),Be=Math.PI-c-Ae;p=xe*Math.sin(Be)}let x=d*i,b=i*i*(m*m),D=u*u*b,A=p-x,y=A*A,M=D*(D+y-a[1]*a[1]);if(M<0)return w(o.eye,a,p/g),o.tilt=0,ke(o,e);let Y=Math.sqrt(M),j=a[1]*A,k=D+y,Q;if(Q=u>0?-Y+j:Y+j,Math.abs(k)<1e-8)return g<1e-8?(o.eye[0]=0,o.eye[1]=0,o.eye[2]=i):w(o.eye,a,p/g),o.tilt=0,it(o.eye),ke(o,e);o.eye[1]=Q/k;let R=l*l*b,pe=m*i,We=u*pe*o.eye[1],de=o.eye[1]*o.eye[1],$=1-de,V=Math.sqrt($),ee=D*de+R-2*We*V*A+$*y;return Math.abs(ee)<1e-8?(w(o.eye,a,p/g),o.tilt=0,it(o.eye),ke(o,e)):(o.eye[0]=($*(p*a[0]-x*a[0])-pe*V*(a[0]*o.eye[1]*u+a[2]*l))/ee,o.eye[2]=($*(p*a[2]-x*a[2])-pe*V*(a[2]*o.eye[1]*u-a[0]*l))/ee,w(o.eye,o.eye,p),it(o.eye),ke(o,e))}function it(e){let t=e[1];e[1]=-e[2],e[2]=t}function ke(e,t){let n=mn(t,e.heading,e.tilt);return e.up=n.up,e}function $n(e,t,n){let r=S(t),o=Math.sqrt(n*n+r*r-2*n*r*Math.cos(Math.PI-e)),a=F(n/(o/Math.sin(e)));return v(e-a)}function er(e,t,n){let r=h(e),o=S(t);return F(n/(o/Math.sin(r)))+r}function tr(e,t,n,r,o){let a,i,s,c,l=t.latitude,u=N(e.spatialReference).radius,m=t.longitude,d=cn(l,n,u)/2;a=m-d,i=m+d;let g=h(l),p=(1+Math.sin(g))/(1-Math.sin(g)),x=(p+1)*Math.tan(r/u/2),b=x*x;function D(y){let M=Math.PI/2;return(y=Jt.normalize(y,-M))>M&&(y=Math.PI-y),y}if(s=1.5*Math.PI-2*Math.atan(.5*(x+Math.sqrt(4*p+b))),c=s+r/u,s=D(s),c=D(c),c<s){let y=c;c=s,s=y}if(s=Math.max(v(s),-90),c=Math.min(v(c),90),i=Kn.monotonic(a,i),i-a>180){let y=(i-a-180)/2;a+=y,i-=y}let A=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:he.WGS84;return o?(o.xmin=a,o.ymin=s,o.xmax=i,o.ymax=c,o.spatialReference=A):o=new Ce(a,s,i,c,A),e.spatialReference&&e.spatialReference.isWebMercator&&Tt(o,!1,o),o}function nr(e,t){let n=e.frustum,{renderCoordsHelper:r}=e,o=r.getAltitude(t),a=e.spatialReference,i=r.referenceEllipsoid.radius,s=e.state.camera,c=s.eye,l=1+oe(c,t)/(i+o),u=Math.sqrt(l*l-1),{minCurvature:m,maxCurvature:d,minSamples:g,maxSamples:p}=ir,x=ar(e),b=yt((u-m)/(d-m),0,1),D=Math.round(Je(g,p,b)),A=s.aboveGround,y=n.planes[Pe.FAR],M=[],Y=tt(Xe,sr,et()),j=tt(Xe,cr,et());Et(st,0,0,0,0);let k=R=>{};for(let R=0;R<4;R++){let pe=R===G.NEAR_FAR_BOTTOM_RIGHT&&!A||R===G.NEAR_FAR_TOP_LEFT&&A?1-x:0,We=R===G.NEAR_FAR_BOTTOM_RIGHT&&A||R===G.NEAR_FAR_TOP_LEFT&&!A?x:1,de=n.lines[R],$=n.lines[R===3?0:R+1];for(let V=0;V<D;V++){let ee=V/D,xe=R===G.NEAR_FAR_BOTTOM_RIGHT?1-(1-ee)**2:R===G.NEAR_FAR_TOP_LEFT?ee**2:ee,Ae=V===0?0:Je(pe,We,xe),Be=Ot(ur,de.origin,$.origin,Ae),Pn=Ft(de.direction,$.direction,Ae,lr);r.intersectManifoldClosestSilhouette(Oe(Be,Pn),o,E),Ge(E,c,E,y),M.push(Ie(E)),M.length!==0&&k(Qe(M.at(-1),E));let _n=(nt(Y,E)?1:0)|(nt(j,E)?2:0);st[_n]=1}}M.length>2&&k(Qe(M[0],M.at(-1)));let Q=rr(xt(st)>1?or(pn(M,Y),j):[M],r,a);return new Te({rings:Q,spatialReference:a})}function rr(e,t,n){let r=2*Ze();return e.map(o=>{let a=[],i=!1;for(let s of o)t.fromRenderCoords(s,E,n),Math.abs(s[0])<r&&Math.abs(s[1])<r?(a.push([null,E[1]]),a.push([null,E[1]]),i=!0):a.push([E[0],E[1]]);if(i)for(let s=0;s<a.length;s++){let c=a[s];if(c[0]!=null)continue;let l=a[s+1],u=a.at(s===0?-1:s-1);c[0]=u[0],s++;let m=a.at(s===a.length-1?0:s+1);l[0]=m[0]}return a.push(a[0]),De(a)||a.reverse(),a})}function or(e,t){let n=[];for(let r of e)n.push(...pn(r,t));return n}function pn(e,t){let n=[],r=[],o=Ze();for(let i=0;i<e.length;i++){let s=e[i],c=i===e.length-1?e[0]:e[i+1],l=kt(s,c,fr),u=Gt(t,l.origin,l.vector,Ht.NONE,E);switch(u){case se.INSIDE:n.push(s);break;case se.OUTSIDE:r.push(s);break;case se.INTERSECTS_INSIDE_OUT:case se.INTERSECTS_OUTSIDE_IN:{let[m,d,g]=u===se.INTERSECTS_INSIDE_OUT?[1,n,r]:[-1,r,n],p=t,x=ye(f(),E,p,m*o),b=ye(f(),E,p,m*-o);d.push(s),d.push(x),g.push(b)}}}let a=[];return n.length&&a.push(n),r.length&&a.push(r),a}function ar(e){let{renderCoordsHelper:t,state:{camera:n}}=e,{center:r,eye:o}=n,a=Math.abs(t.getAltitude(r)),i=Math.abs(Math.PI/2-on(t,r,o));return qt(ln,t.referenceEllipsoid.radius+a),Wt(ln,i,n.distance,n.fovY)}var ir={minCurvature:h(5),maxCurvature:h(50),minSamples:1,maxSamples:6},sr=q(1,0,0),cr=q(0,1,0),lr=f(),ur=f(),E=f(),ln=Vt(),fr=zt(),st=At(),dn=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Yn,eyeForCenterWithHeadingTilt:Qn,eyeTiltToLookAtTilt:er,headingTiltToDirectionUp:mn,lookAtTiltToEyeTilt:$n,toArea:nr,toExtent:tr},Symbol.toStringTag,{value:"Module"}));function hn(e,t){return e!=null&&(t==null||(t===Me.Local?!e.isGeographic||e.isWGS84||e.wkid===re.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===re.CGCS2000||e.wkid===re.GCSMARS2000||e.wkid===re.GCSMARS2000_SPHERE||e.wkid===re.GCSMOON2000))}var ut=()=>gt.getLogger("esri.views.3d.support.cameraUtils"),Tn=96*39.37,ct=1,mr=8,pr=5,yn=1,dr={heading:0,tilt:0},Ee=f(),hr=new Re(-20037508342788905e-9,20037508342788905e-9),gr=new Re(-180,180),Z;function me(e){return e.spatialReference??he.WGS84}function K({state:e}){return e.isGlobal?dn:nn}function ya(e,t,n,r,o){return K(e).headingTiltToDirectionUp(t,n,r,o)}function Tr(e,t){if(t==null)return null;let n=e.renderSpatialReference,r=K(e).headingTiltToDirectionUp,o=f();if(!ie(t.position,o,n))return null;let a=r(o,t.heading,t.tilt);w(a.direction,a.direction,e.state.camera.distance),W(a.direction,a.direction,o);let i=Yt(e,o,a.direction,a.up);return i.fov=h(t.fov),i.row=t.layout.row,i.rows=t.layout.rows,i.column=t.layout.column,i.columns=t.layout.columns,i}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(Z||(Z={}));var fe=f();function Ma(e,t,n){let r=e.renderSpatialReference,o=ft(e,t.eye,t.viewForward,t.up,dr),a=me(e);return ce(t.eye,r,fe,a)||(a=he.WGS84,ce(t.eye,r,fe,a)),n==null?n=new Ne(new T(fe,a),o.heading,o.tilt,v(t.fov)):(n.position.x=fe[0],n.position.y=fe[1],n.position.z=fe[2],n.position.spatialReference=a,n.heading=o.heading,n.tilt=o.tilt,n.fov=v(t.fov)),n.layout.row=t.row,n.layout.rows=t.rows,n.layout.column=t.column,n.layout.columns=t.columns,n}function lt(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper;return t/=r,n.width/2/n.pixelRatio/(Tn/t)/Math.tan(n.fovX/2)}function yr(e,t){let{camera:n}=e.state,{unitInMeters:r}=e.renderCoordsHelper,o=t*Math.tan(n.fovX/2),a=n.width/2/n.pixelRatio;return Tn/(a/o)*r}function Mr(e,t,n,r){let o=r.levelAtScale(t),a=Mn(ft(e,n.eye,n.viewForward,n.up).tilt),i=Math.max(o-a,0);return r.scaleAtLevel(i)}function gn(e,t,n){let r=n.levelAtScale(e),o=Mn(t);return n.scaleAtLevel(r+o)}function Mn(e){return 2*((e>90?180-e:e)/90)**2}function Rr(e,t,n=0){let r=e.basemapTerrain?.tilingScheme;if(!r)return 0;let o=N(e.spatialReference).radius,a=e.state.viewingMode===Me.Local?t.eye[2]:S(t.eye)-o;return Mr(e,yr(e,Math.abs(a-n)),t,r)}function Sr(e,t,n=0){let r=Tr(e,t);return r?Rr(e,r,n):0}var wr=1,vr=100;function Ra(e,t,n,r,o){if(t===0)return 0;let a=oe(n.eye,r),i=e.basemapTerrain?.tilingScheme;if(!i)return ut().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),a;let s=a,c=ft(e,n.eye,n.viewForward,n.up),l=c.tilt>90;if(e.state.isLocal){let p=(lt(e,gn(t,c.tilt,i))-Math.abs(n.eye[2]-o[2]))/Math.cos(h(c.tilt));return s=l?s-p:s+p,s}let u=1/0,m=0,d=Ve(e,c.heading,c.tilt,r,a,Z.ADJUST);if(!d)return s;let g=S(o);for(;u>wr&&m<vr;){let p=S(d.eye),x=l?180-d.tilt:d.tilt,b=h(x),D=Math.sin(b)*p,A=Math.cos(b)*p,y=lt(e,gn(t,d.tilt,i)),M=l?g-y:g+y,Y=F(D/M),j=Math.cos(Y)*M-A,k=oe(d.eye,r);s=l?k-j:k+j,d=Ve(e,c.heading,c.tilt,r,s,Z.ADJUST);let Q=pt(e,d,v(n.fov));if(!d||!Q)return s;let R=Sr(e,Q,g-N(e.spatialReference).radius);u=Math.abs(t-R),++m}return s}async function Sa(e,t,n,r,o,a){return Er(e,t,lt(e,n),r,o,a)}function wa(e,t,n,r,o,a){return pt(e,Ve(e,r.heading,r.tilt,t,n,o),r.fov,a)}async function Er(e,t,n,r,o,a){let i=await Sn(e,r.heading,r.tilt,t,n,o,a);return O(a),On(e,i,r.fov,a)}function ft(e,t,n,r,o){return K(e).directionToHeadingTilt(t,n,r,o)}function Rn(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Ee,e.spatialReference)&&e.elevationProvider&&(ot(e.elevationProvider,Ee)??0)>Ee[2]-yn)}async function xr(e,t,n){if(Rn(e,t))return!0;let{elevationProvider:r,spatialReference:o,renderCoordsHelper:a}=e;if(r==null||!a.fromRenderCoords(t,Ee,o))return!1;let[i,s,c]=Ee,l=await r.queryElevation(i,s,c,o,"ground",n)??0;return O(n),l>c-yn}async function Ar(e,t,n){let r=f();if(t==null)return P(r,e.state.camera.center);if(t instanceof T){let{renderSpatialReference:o,basemapTerrain:a,elevationProvider:i}=e,s=t.spatialReference;if(await Ut(t,r,o,0,{signal:n}),O(n),t.z==null&&a!=null&&i!=null){let c=await i.queryElevation(t.x,t.y,t.z??0,s,"ground",n);O(n),c!=null&&e.renderCoordsHelper.setAltitude(r,c)}return r}return P(r,t)}function Cr(e,t){let n=f();if(t==null)return P(n,e.state.camera.center);if(t instanceof T){if(!ie(t,n,e.renderSpatialReference))return null;let{basemapTerrain:r,elevationProvider:o}=e;if(t.z==null&&r!=null&&o!=null){let a=ot(o,t);a!=null&&e.renderCoordsHelper.setAltitude(n,a)}return n}return P(n,t)}function Ve(e,t,n,r,o,a){return wn(e,t,n,r instanceof T?r:null,Cr(e,r),o,a)}async function Sn(e,t,n,r,o,a,i){let s=r instanceof T?r:null,c=await Ar(e,r,i);return O(i),vn(e,t,n,s,c,o,a,i)}function wn(e,t,n,r,o,a,i){if(o==null||!r&&(r=new T({spatialReference:me(e)}),!_e(o,e.renderSpatialReference,r)))return null;let s=En(e,t,n,o,a,i);if(xn(e,n,i)&&Rn(e,s.eye)){let{tilt:c,mode:l}=An(e,n,o,a);return wn(e,t,c,r,o,a,l)}return Cn(s,o)}async function vn(e,t,n,r,o,a,i,s){r||(r=new T({spatialReference:me(e)}),await rt(o,e.renderSpatialReference,r,{signal:s})||(r=null)),O(s);let c=En(e,t,n,o,a,i);if(xn(e,n,i)&&await xr(e,c.eye,s)){O(s);let{tilt:l,mode:u}=An(e,n,o,a);return vn(e,t,l,r,o,a,u,s)}return Cn(c,o)}function En(e,t,n,r,o,a){let i=Dr(e,t,n,r,o=Math.max(o,e.state.constraints.minimumPoiDistance),a);return(0,K(e).eyeForCenterWithHeadingTilt)(r,o,i.heading,i.tilt)}function xn(e,t,n){let r=e.map.ground.navigationConstraint;return n===Z.ADJUST&&e.state.isGlobal&&t>0&&(r==null||r.type==="stay-above")}function An(e,t,n,r){let o=bn(e,n,r,Or(e,r,t,n));return{tilt:o,mode:t-o<1?Z.LOCKED:Z.ADJUST}}function Cn(e,t){return ht(dt({},e),{center:Ie(t)})}function In(e,t){let{state:n,spatialReference:r}=e,o=t.spatialReference;return n.isGlobal&&hn(o,Me.Global)||n.isLocal&&r.equals(o)}function Dn(e,t){let n,r,o;if(e.state.isGlobal){let u=new T(t.xmin,t.ymin,t.spatialReference),m=new T(t.xmax,t.ymax,t.spatialReference),d=t.spatialReference.isGeographic?gr:hr;n=new T({x:d.center(u.x,m.x),y:(m.y+u.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});let g=N(t.spatialReference),p=sn(n,u,m);r=p.lon,o=p.lat,d.diff(u.x,m.x)>d.range/2&&(r+=g.halfCircumference),r=Math.min(r,g.halfCircumference),o=Math.min(o,g.halfCircumference)}else{let u=e.renderSpatialReference??t.spatialReference;u.equals(t.spatialReference)||(t=Ke(t,u)),r=t.xmax-t.xmin,o=t.ymax-t.ymin;let m=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;n=new T({x:t.xmin+.5*r,y:t.ymin+.5*o,z:m,spatialReference:u})}let a=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,i=e.state.camera,s=1/Math.tan(i.fovX/2),c=1/Math.tan(i.fovY/2),l=1/Math.tan(i.fov/2);return{center:n,distance:Math.max(.5*r*s,.5*o*c,.5*a*l)/ct}}async function va(e,t,n,r,o,a){let i=In(e,t)?t:await Ct(t,e.spatialReference,{signal:a});O(a);let{center:s,distance:c}=Dn(e,i),l=await Sn(e,n,r,s,c,o,a);return O(a),On(e,l,e.camera.fov,a)}function Ea(e,t,n,r,o,a){let i;try{i=In(e,t)?t:Ke(t,e.spatialReference)}catch{return null}let{center:s,distance:c}=Dn(e,i),l=Ve(e,n,r,s,c,o);return l==null?null:pt(e,l,e.camera.fov,a)}function xa(e,t,n){let r=e.renderSpatialReference,o=new T({spatialReference:me(e)});if(!_e(n,r,o))return null;let a=Math.tan(t.fovX/2),i=Math.tan(t.fovY/2),s=Pt(t.eye,n),c=2*s*a*ct,l=2*s*i*ct;return K(e).toExtent(e,o,c,l)}function Aa(e,t){return K(e).toArea(e,t)}function Ir(e,t,n){let r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(n/r)/Math.LN2>mr)return!0;let o=t,a=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return oe(o,a)/(Math.tan(.5*e.state.camera.fov)*r)>pr}function Dr(e,t,n,r,o,a){let i=0;return a===Z.ADJUST&&Ir(e,r,o)?(t=0,i=br(e,o,n,r)):i=mt(e,r,o,n),i=e.state.constraints.clampTilt(o,i),{heading:t,tilt:n=bn(e,r,o,i)}}var qe=.7;function br(e,t,n,r){let o=mt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);a.max=Math.min(a.max,.5*Math.PI);let i=a.min*(1-qe)+a.max*qe;return Math.min(o,i)}function Or(e,t,n,r){let o=mt(e,r,t,n);if(!e.state.constraints.tilt)return o;let a=e.state.constraints.tilt(t);return o=Math.min(o,.5*Math.PI),a.min*(1-qe)+o*qe}function bn(e,t,n,r){return K(e).lookAtTiltToEyeTilt(r,t,n)}function mt(e,t,n,r){return K(e).eyeTiltToLookAtTilt(r,t,n)}function pt(e,t,n,r){if(t==null)return null;let o=e.renderSpatialReference,a=new T({spatialReference:me(e)});return _e(t.eye,o,a)?(r??=new Ne,r.position=a,r.heading=t.heading,r.tilt=t.tilt,r.fov=n,r):null}async function On(e,t,n,r){let o=e.renderSpatialReference,a=new T({spatialReference:me(e)});return await rt(t.eye,o,a,{signal:r}),O(r),new Ne(a,t.heading,t.tilt,n)}function Ca(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.levelAtScale(t);ut().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Ia(e,t){let n=e.basemapTerrain?.tilingScheme;if(n)return n.scaleAtLevel(t);ut().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}export{Vr as a,Un as b,Yt as c,Fe as d,on as e,Mo as f,hn as g,Z as h,me as i,ya as j,Tr as k,Ma as l,lt as m,yr as n,Mr as o,Ra as p,Sa as q,wa as r,Er as s,ft as t,Ve as u,va as v,Ea as w,xa as x,Aa as y,Ca as z,Ia as A};
