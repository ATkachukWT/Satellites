import{a as fe,c as ie,d as pe}from"./chunk-R3QN3IUS.js";import{a as me}from"./chunk-FZC5IFYI.js";import{b as ce}from"./chunk-3NX4GRTL.js";import{a as se}from"./chunk-ZXZLAXND.js";import{a as ae}from"./chunk-RA7QAC4Z.js";import"./chunk-ZNPIBNGZ.js";import{a as re,b as oe,d as ne}from"./chunk-CQKWED7J.js";import{o as te}from"./chunk-FREYJJN5.js";import{a as Z,c as ee,d as E}from"./chunk-4RW2T2TW.js";import{b as le}from"./chunk-EZUSHT3W.js";import{a as ue}from"./chunk-VIFXPONX.js";import"./chunk-AOQ57NDM.js";import"./chunk-ONYJLWAD.js";import"./chunk-4RMBQ2W6.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import{a as O}from"./chunk-KAMRW6HF.js";import{a as J,c as X,e as A,h as Y}from"./chunk-XIZXEWWA.js";import"./chunk-6DGDLLNL.js";import"./chunk-UWWWQ44M.js";import"./chunk-BHB4UQZT.js";import{a as W,q as H}from"./chunk-DJW5LMRG.js";import{e as _}from"./chunk-SEJXLJ5V.js";import"./chunk-MPAJA3DL.js";import"./chunk-ALWV3RJ2.js";import{a as R}from"./chunk-DEH76MSI.js";import"./chunk-JTDXB5TK.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-Y6YEAKJ5.js";import{a as Q}from"./chunk-2NH7HOKA.js";import{l as w}from"./chunk-HM5RIVQC.js";import{b as q,c as S,d as V,k as N,o as M,p as C,s as k,t as K}from"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-ZTOZWLEE.js";import{f as D}from"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import{c as U}from"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import{c as G}from"./chunk-BOVYXYHK.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import{i as L,u as b}from"./chunk-QT6UNBJP.js";import"./chunk-JRCKELO6.js";import"./chunk-XZIOXVVJ.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import{E as z}from"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import"./chunk-QHVIRF5H.js";import{i as h}from"./chunk-WZDN6K3C.js";import"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{t as P}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as I,b as j}from"./chunk-N2WTMF3X.js";function ge(e,t,r){let a=e.typedBuffer,f=e.typedBufferStride,i=t.typedBuffer,l=t.typedBufferStride,o=r?r.count:t.count,n=(r?.dstIndex??0)*f,c=(r?.srcIndex??0)*l;for(let u=0;u<o;++u){for(let s=0;s<9;++s)a[n+s]=i[c+s];n+=f,c+=l}}var ye=Object.freeze(Object.defineProperty({__proto__:null,copy:ge},Symbol.toStringTag,{value:"Module"}));function Te(e,t,r){let a=e.typedBuffer,f=e.typedBufferStride,i=t.typedBuffer,l=t.typedBufferStride,o=r?r.count:t.count,n=(r?.dstIndex??0)*f,c=(r?.srcIndex??0)*l;for(let u=0;u<o;++u){for(let s=0;s<16;++s)a[n+s]=i[c+s];n+=f,c+=l}}var ve=Object.freeze(Object.defineProperty({__proto__:null,copy:Te},Symbol.toStringTag,{value:"Module"}));function we(e,t){de(e.typedBuffer,t,e.typedBufferStride)}function de(e,t,r=4){let a=t.typedBuffer,f=t.typedBufferStride,i=t.count,l=0,o=0;for(let n=0;n<i;++n)e[l]=a[o],e[l+1]=a[o+1],e[l+2]=a[o+2],e[l+3]=a[o+3],l+=r,o+=f}function T(e,t,r,a,f,i){let l=e.typedBuffer,o=e.typedBufferStride,n=i?.count??e.count,c=(i?.dstIndex??0)*o;for(let u=0;u<n;++u)l[c]=t,l[c+1]=r,l[c+2]=a,l[c+3]=f,c+=o}var Be=Object.freeze(Object.defineProperty({__proto__:null,copy:de,copyView:we,fill:T},Symbol.toStringTag,{value:"Module"}));function x(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Q(e.ElementType)))}async function ht(e,t,r){let a=new ue(he(r)),f=(await me(a,t,r,!0)).model,i=f.lods.shift(),l=new Map,o=new Map;f.textures.forEach((y,B)=>l.set(B,Ve(y))),f.materials.forEach((y,B)=>o.set(B,Me(y,l)));let n=Se(i);for(let y of n.parts)Ce(n,y,o);let{position:c,normal:u,tangent:s,color:m,texCoord0:p}=n.vertexAttributes,d=_(e,r),$=e.spatialReference.isGeographic?_(e):d,F=te({vertexAttributes:{position:c.typedBuffer,normal:u?.typedBuffer,tangent:s?.typedBuffer},vertexSpace:$,spatialReference:e.spatialReference},d,{allowBufferReuse:!0,sourceUnit:r?.unitConversionDisabled?void 0:"meters"});if(!F)throw new P("load-gltf-mesh:vertex-space-projection",`Failed to load mesh from glTF because we could not convert the vertex space from ${$.type} to ${d.type}`);return{transform:null,vertexSpace:d,components:n.components,spatialReference:e.spatialReference,vertexAttributes:new ae(j(I({},F),{color:m?.typedBuffer,uv:p?.typedBuffer}))}}function he(e){let t=e?.resolveFile;return t?{busy:!1,request:async(r,a,f)=>{let i=t?.(r)??r;return(await z(i,{responseType:a==="image"?"image":a==="binary"||a==="image+type"?"array-buffer":"json",signal:f?.signal,timeout:0})).data}}:null}function v(e,t){if(e==null)return"-";let r=e.typedBuffer;return`${h(t,r.buffer,()=>t.size)}/${r.byteOffset}/${r.byteLength}`}function be(e){return e!=null?e.toString():"-"}function Se(e){let t=0,r={color:!1,tangent:!1,normal:!1,texCoord0:!1},a=new Map,f=new Map,i=[];for(let l of e.parts){let{position:o,normal:n,color:c,tangent:u,texCoord0:s}=l.attributes,m=`
      ${v(o,a)}/
      ${v(n,a)}/
      ${v(c,a)}/
      ${v(u,a)}/
      ${v(s,a)}/
      ${be(l.transform)}
    `,p=!1,d=h(f,m,()=>(p=!0,{start:t,length:o.count}));p&&(t+=o.count),n&&(r.normal=!0),c&&(r.color=!0),u&&(r.tangent=!0),s&&(r.texCoord0=!0),i.push({gltf:l,writeVertices:p,region:d})}return{vertexAttributes:{position:x(N,t),normal:r.normal?x(S,t):null,tangent:r.tangent?x(V,t):null,color:r.color?x(C,t):null,texCoord0:r.texCoord0?x(q,t):null},parts:i,components:[]}}function Ve(e){return new re({data:(ce(e.data),e.data),wrap:Ae(e.parameters.wrap)})}function Me(e,t){let r=new O(Ee(e.color,e.opacity)),a=e.emissiveFactor?new O(Oe(e.emissiveFactor)):null,f=i=>i?new oe({scale:i.scale?[i.scale[0],i.scale[1]]:[1,1],rotation:L(i.rotation??0),offset:i.offset?[i.offset[0],i.offset[1]]:[0,0]}):null;return new ne({color:r,colorTexture:t.get(e.colorTexture),normalTexture:t.get(e.normalTexture),emissiveColor:a,emissiveTexture:t.get(e.emissiveTexture),occlusionTexture:t.get(e.occlusionTexture),alphaMode:_e(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:t.get(e.metallicRoughnessTexture),colorTextureTransform:f(e.colorTextureTransform),normalTextureTransform:f(e.normalTextureTransform),occlusionTextureTransform:f(e.occlusionTextureTransform),emissiveTextureTransform:f(e.emissiveTextureTransform),metallicRoughnessTextureTransform:f(e.metallicRoughnessTextureTransform)})}function Ce(e,t,r){t.writeVertices&&Re(e,t);let{indices:a,attributes:f,primitiveType:i,material:l}=t.gltf,o=pe(a||f.position.count,i),n=t.region.start;if(n){let c=new Uint32Array(o);for(let u=0;u<o.length;u++)c[u]+=n;o=c}e.components.push(new se({name:t.gltf.name,faces:o,material:r.get(l),shading:f.normal?"source":"flat",trustSourceNormals:!0}))}function Re(e,t){let{position:r,normal:a,tangent:f,color:i,texCoord0:l}=e.vertexAttributes,o=t.region.start,{attributes:n,transform:c}=t.gltf,u=n.position.count;if(J(r.slice(o,u),n.position,c),n.normal!=null&&a!=null){let s=H(R(),c),m=a.slice(o,u);X(m,n.normal,s),b(s)&&Y(m,m)}else a!=null&&le(a,0,0,1,{dstIndex:o,count:u});if(n.tangent!=null&&f!=null){let s=W(R(),c),m=f.slice(o,u);Z(m,n.tangent,s),b(s)&&ee(m,m)}else f!=null&&T(f,0,0,1,1,{dstIndex:o,count:u});if(n.texCoord0!=null&&l!=null?fe(l.slice(o,u),n.texCoord0):l!=null&&ie(l,0,0,{dstIndex:o,count:u}),n.color!=null&&i!=null){let s=n.color,m=i.slice(o,u);if(s.elementCount===4)s instanceof V?E(m,s,1,255):(s instanceof C||s instanceof K)&&E(m,s,1/255,255);else{T(m,255,255,255,255);let p=M.fromTypedArray(m.typedBuffer,m.typedBufferStride);s instanceof S?A(p,s,1,255):(s instanceof M||s instanceof k)&&A(p,s,1/255,255)}}else i!=null&&T(i.slice(o,u),255,255,255,255)}function _e(e){switch(e){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function Ae(e){return{horizontal:xe(e.s),vertical:xe(e.t)}}function xe(e){switch(e){case w.CLAMP_TO_EDGE:return"clamp";case w.MIRRORED_REPEAT:return"mirror";case w.REPEAT:return"repeat"}}function g(e){return e**(1/D)*255}function Ee(e,t){return U(g(e[0]),g(e[1]),g(e[2]),t)}function Oe(e){return G(g(e[0]),g(e[1]),g(e[2]))}export{ht as loadGLTFMesh};
