import{a as ge}from"./chunk-W277N2SJ.js";import{a as ue}from"./chunk-MWT6DXAH.js";import{a as _e}from"./chunk-2U44WK2Y.js";import"./chunk-WNVGQG3J.js";import{a as pe}from"./chunk-RDYCHQ7J.js";import"./chunk-TUEWINUL.js";import"./chunk-KBHP2G24.js";import"./chunk-EHI7Z2KP.js";import{a as de}from"./chunk-D5CVC3OW.js";import"./chunk-TUJMSP4X.js";import"./chunk-4YX5NE4F.js";import"./chunk-FJNBIBDX.js";import"./chunk-F7MBACHV.js";import"./chunk-5ZS2L6U3.js";import"./chunk-LAVD467M.js";import"./chunk-6CUAH7AI.js";import"./chunk-OC2XJJQU.js";import"./chunk-2CQRLDTB.js";import"./chunk-N5YUEDXE.js";import"./chunk-WSHRDZWE.js";import"./chunk-563WFO4F.js";import"./chunk-T4QAGZWF.js";import"./chunk-7BXTHPPE.js";import"./chunk-Q5KIWWVU.js";import{d as l,e as le}from"./chunk-KK722UJA.js";import{a as ae}from"./chunk-JUMM5VTE.js";import"./chunk-C27Q2S3P.js";import{a as se}from"./chunk-YYQRGXAE.js";import{b as oe}from"./chunk-5BRKCXYS.js";import"./chunk-DB752BXH.js";import"./chunk-GPDZGV7G.js";import{m as f}from"./chunk-7GENY6TF.js";import"./chunk-2L3Q5NER.js";import"./chunk-XCJ4FRLL.js";import{a as C,b as R,c as ce}from"./chunk-JNJTT3PL.js";import"./chunk-53FQLWMN.js";import"./chunk-PGFEC2N6.js";import"./chunk-5KY2RG7F.js";import"./chunk-XQ4DD6H6.js";import"./chunk-IQA3CVAZ.js";import{a as he}from"./chunk-2DH3L3DZ.js";import"./chunk-2VR3WADU.js";import"./chunk-5QOQFLF6.js";import{a as me}from"./chunk-5DVGZXEZ.js";import"./chunk-AGQUA5I4.js";import"./chunk-VC6GZ45F.js";import"./chunk-BENEV3E6.js";import"./chunk-R3G2IXBO.js";import"./chunk-2M72FQ5L.js";import"./chunk-SBYRP3FT.js";import"./chunk-N3W77OHB.js";import"./chunk-D4EX42XK.js";import"./chunk-HMAWCT6U.js";import"./chunk-7PDWRJ35.js";import"./chunk-ALHY5HFC.js";import"./chunk-ZFRNSCYG.js";import{d as P}from"./chunk-UWWX7VSW.js";import"./chunk-CFF33S4D.js";import{a as ne}from"./chunk-CCTFA5SZ.js";import"./chunk-NOHUHVCW.js";import"./chunk-2XYAAYOE.js";import"./chunk-54P55TN4.js";import"./chunk-BVDJBTNQ.js";import"./chunk-LSUWBOLF.js";import"./chunk-XACQ2RJ5.js";import"./chunk-WUXNV6ZW.js";import{h as ee}from"./chunk-KE2U7ENE.js";import"./chunk-PSFZFYFC.js";import{c as re}from"./chunk-SWCOPTUX.js";import{a as ie}from"./chunk-7EWNVUY7.js";import"./chunk-SXYHD4V6.js";import"./chunk-FSW536RM.js";import"./chunk-YNDA4ZZB.js";import"./chunk-JAN3FVXP.js";import"./chunk-F4HA2HQL.js";import"./chunk-BSKAVVQS.js";import{b as te}from"./chunk-AEU2INWT.js";import"./chunk-Z4UBZ6W2.js";import"./chunk-CMKJEBQJ.js";import"./chunk-AQMR24IC.js";import"./chunk-3J3Q4LMA.js";import"./chunk-PSNQ2KG3.js";import"./chunk-JXRFF2VE.js";import"./chunk-7WCQBAQY.js";import"./chunk-V4ZQZTCB.js";import"./chunk-PEYNLMWW.js";import"./chunk-FQIIIJGL.js";import"./chunk-SZTSN5BD.js";import"./chunk-VAOSSSLB.js";import"./chunk-6L543SC5.js";import"./chunk-6FI5AY7X.js";import"./chunk-ZCAR53EN.js";import"./chunk-DH67ILIV.js";import"./chunk-7GUYYJRR.js";import"./chunk-WS4AMEGN.js";import"./chunk-CU7FHMWW.js";import"./chunk-CSFAHB4Y.js";import"./chunk-AMISFAT3.js";import"./chunk-PTXLSCMJ.js";import"./chunk-NRRX2M6N.js";import"./chunk-PMLKCTEJ.js";import"./chunk-MYO2G5ZH.js";import"./chunk-EG2DTURK.js";import"./chunk-4XEE5PE3.js";import"./chunk-XWEUR6F7.js";import"./chunk-O2J7LFYY.js";import"./chunk-422PSKZ7.js";import"./chunk-SFANISLX.js";import"./chunk-5L4CW2H2.js";import"./chunk-UJ7KVQR6.js";import"./chunk-B74L7AUE.js";import"./chunk-MJO3PLZV.js";import{b as j}from"./chunk-YU3IFRYW.js";import"./chunk-XKFJ6GWH.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import"./chunk-EM2AEAFS.js";import"./chunk-VGAXEXH3.js";import"./chunk-YEPHAEAY.js";import"./chunk-76X7RFM4.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import"./chunk-L7NOU4T2.js";import"./chunk-SU7IJ65K.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-HUUJBVXR.js";import"./chunk-4LDVFWME.js";import"./chunk-A45BLB26.js";import"./chunk-DFYW3Y3B.js";import"./chunk-UBQPWKE4.js";import"./chunk-YSD7LK2L.js";import{d as $}from"./chunk-BPX3YT3K.js";import"./chunk-NIYDRLW4.js";import"./chunk-4K47EN3B.js";import"./chunk-FSWSNKJD.js";import"./chunk-MVDZB4AK.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FGEB67EG.js";import"./chunk-YEXMIDOT.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import{h as X}from"./chunk-E2J2V7JN.js";import"./chunk-VYZHOYXV.js";import"./chunk-K7YQAHQ7.js";import{b as H}from"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-KBDKZSTB.js";import"./chunk-AOQ57NDM.js";import"./chunk-ONYJLWAD.js";import"./chunk-VMECOA4F.js";import"./chunk-KOUNUVF6.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-PMVQ5DJK.js";import"./chunk-KAMRW6HF.js";import"./chunk-BHB4UQZT.js";import"./chunk-DJW5LMRG.js";import"./chunk-ALWV3RJ2.js";import{a as J}from"./chunk-DEH76MSI.js";import{a as Q}from"./chunk-DVBZA6ZU.js";import"./chunk-VTGWQ7AP.js";import"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-KRAKR4MK.js";import"./chunk-MCO7DSFO.js";import"./chunk-D7WE3OBT.js";import"./chunk-UP6FLASM.js";import"./chunk-JTDXB5TK.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-Y6YEAKJ5.js";import"./chunk-U4TLMQTY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import{a as y}from"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import{l as G}from"./chunk-HM5RIVQC.js";import{a as Z}from"./chunk-EM35R6FY.js";import"./chunk-2ZFXOJDB.js";import{b as B,s as Y}from"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-NHEQ4TAR.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-HX2VGIR2.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import{f as F}from"./chunk-LXFQWIWE.js";import{h as q}from"./chunk-QT6UNBJP.js";import{a as b,c as A,i as O,j as D}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-BUSG3ZOF.js";import"./chunk-XZIOXVVJ.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import{ha as x}from"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as d,J as N,f as k}from"./chunk-QHVIRF5H.js";import{I as w}from"./chunk-WZDN6K3C.js";import{a}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{M as K,O as T,b as U,e as S,j as _,m as W,p as E}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{t as V}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";var ye=Symbol(),fe=Symbol(),ve=1,De=10,h=class extends N{get editSourcePoints(){return!!this.options?.reshapeOptions.editSourcePoints!==this._isEditSourcePointsToggled}get updating(){return this._updatingHandles.updating}get _preferredInteractionTool(){return this.options?.tool??"transform"}get _toolType(){switch(this._preferredInteractionTool){case"transform":return"transform-3d";case"reshape":return"reshape-3d"}}get _validatedSelectedElement(){let e=this.selectedElement;if(!e)return null;let{layer:{source:t}}=this;return t?"hasElement"in t?t.hasElement(e)?e:null:t===e?e:null:null}constructor(e){super(e),this.enabled=!1,this._isEditSourcePointsToggled=!1,this._updatingHandles=new Q,this._isOpacityToggled=!1,this._factor=ve,this._tool=null,this._object=null,this._createToolAbortController=null,this._onPointerMove=T(async t=>{let i=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(t));this.destroyed||(this.removeHandles(fe),i&&i!==this.selectedElement&&(this.view.cursor="pointer",this.addHandles(_(()=>this.view.cursor=null),fe)))}),this._tmpMat2=ne(),this._tmpVec2=Z()}destroy(){this._createToolAbortController=S(this._createToolAbortController)}initialize(){this.addHandles([E(this._updatingHandles),this._updatingHandles.add(()=>this.enabled,e=>this._enableDisable(e),O),this._updatingHandles.add(()=>this._preferredInteractionTool,e=>this._preferredInteractionToolChanged(e))])}_enableDisable(e){if(!e)return void this.removeHandles(ye);this._dynamicImports();let{view:t}=this,i=new le;i.add(l.undo,()=>{this._object?.operations?.undo(),this._object?.emit("modified-externally")}),i.add(l.redo,()=>{this._object?.operations?.redo(),this._object?.emit("modified-externally")}),i.addToggle(l.preserveAspectRatio,r=>{this._tool?.type==="transform-3d"&&(this._tool.preserveAspectRatio=r.type==="key-down")}),i.addToggle(l.editSourcePoints,r=>{this._tool?.type==="reshape-3d"&&(this._isEditSourcePointsToggled=r.type==="key-down")}),i.addToggle(l.rotateIncrements,r=>{this._tool?.type==="transform-3d"&&(this._tool.snapRotation=r.type==="key-down")}),i.add(l.toggleOpacity,()=>{let r=this._object?.element;r&&(r.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),i.add(l.moveUp,()=>this._move(0,this._factor)),i.add(l.moveDown,()=>this._move(0,-this._factor)),i.add(l.moveRight,()=>this._move(this._factor,0)),i.add(l.moveLeft,()=>this._move(-this._factor,0)),i.addToggle(l.factorModifier,r=>this._factor=r.type==="key-down"?De:ve),this._isOpacityToggled=!1,this.addHandles([i.register(t,P.TOOL),_(()=>{this._isOpacityToggled&&this.selectedElement&&(this.selectedElement.opacity*=2,this._isOpacityToggled=!1)}),t.on("immediate-click",r=>this._onClick(r),P.TOOL),t.on("pointer-move",r=>this._onPointerMove(r).catch(()=>{}),P.TOOL),this._updatingHandles.add(()=>this._validatedSelectedElement,(r,o)=>{o&&r!==o&&this._isOpacityToggled&&(o.opacity*=2,this._isOpacityToggled=!1),this._selectedElementChanged(r)},O),_(()=>{t.cursor=null,this._removeTool()})],ye)}async _onClick(e){await this._updatingHandles.addPromise(e.async(async()=>{let t=await this._findElementAtScreenPoint(e);this.destroyed||(t&&e.stopPropagation(),this.selectedElement=t,this.selectedElement&&(this.view.cursor=null))}))}async _selectedElementChanged(e){e?.georeference?this._object?.element!==e&&await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}async _recreateTool(){this._createToolAbortController=S(this._createToolAbortController),this._removeTool();let e=this._validatedSelectedElement;if(!e)return;let t=new AbortController;this._createToolAbortController=t;let{ManipulatedObject3DMediaElement:i,ExtentTransformTool:r,ReshapeTool3D:o}=await this._dynamicImports();if(t.signal.aborted)return;let{view:s,layer:n,_toolType:m}=this;switch(this._object=new i({view:s,layer:n,element:e,tool:this._preferredInteractionTool}),m){case"transform-3d":{this._tool=new r({view:s,object:this._object});let c=s.inputManager;c.isModifierKeyDown(l.rotateIncrements.key)&&(this._tool.snapRotation=!0),c.isModifierKeyDown(l.preserveAspectRatio.key)&&(this._tool.preserveAspectRatio=!0)}break;case"reshape-3d":{let c=ue(s),{snappingManager:p}=c;this._tool=new o({view:s,object:this._object,enableMidpoints:!1,enableZShape:!1,snappingManager:p,enableMoveObject:!1,autoHideManipulators:!0,enableDeleteVertices:!1,sketchOptions:{tooltips:{enabled:!0,inputEnabled:!0,visibleElements:{area:!1}}}}),this.addHandles([c,b(()=>({editSourcePoints:this.editSourcePoints,operations:this._object?.operations}),g=>{g.operations instanceof ge&&(g.operations.editSourcePoints=g.editSourcePoints)},D)],this._tool)}}this.addHandles([_(()=>{this._object=U(this._object),this._tool&&(s.tools.remove(this._tool),this._tool=null)})],this._tool),s.addAndActivateTool(this._tool)}_preferredInteractionToolChanged(e){let{_tool:t}=this;if(!t)return;if(this._toolType!==t.type)return void this._updatingHandles.addPromise(this._recreateTool());let{_object:i}=this;i&&(i.tool=e)}async _dynamicImports(){let[{ManipulatedObject3DMediaElement:e},{ExtentTransformTool:t,ReshapeTool3D:i}]=await Promise.all([import("./chunk-HLV74QAB.js"),import("./chunk-W4EYNXSE.js")]);return{ManipulatedObject3DMediaElement:e,ExtentTransformTool:t,ReshapeTool3D:i}}async _findElementAtScreenPoint(e){let t=(await this.view.hitTest(e,{include:[this.layer]})).results[0];return t?.type==="media"?t.element:null}_removeTool(){this._tool&&this.removeHandles(this._tool)}_move(e,t){let{view:i,_object:r}=this,o=r?.operations;if(!o)return;let s=i.overlayPixelSizeInMapUnits(i.pointsOfInterest.focus.location)*x(i.spatialReference)/x(o.data.spatialReference),{_tmpMat2:n,_tmpVec2:m}=this,c=X(n,q(360-this.view.camera.heading)),p=B(m,s*e,s*t);Y(p,p,c),o.move(p[0],p[1],0),r.emit("modified-externally")}};a([d({constructOnly:!0})],h.prototype,"view",void 0),a([d({constructOnly:!0})],h.prototype,"layer",void 0),a([d()],h.prototype,"selectedElement",void 0),a([d()],h.prototype,"enabled",void 0),a([d()],h.prototype,"options",void 0),a([d()],h.prototype,"editSourcePoints",null),a([d()],h.prototype,"_isEditSourcePointsToggled",void 0),a([d()],h.prototype,"updating",null),a([d()],h.prototype,"_preferredInteractionTool",null),a([d()],h.prototype,"_validatedSelectedElement",null),h=a([w("esri.views.3d.layers.support.MediaLayerInteraction")],h);var u=class extends _e(de(ae)){get interactive(){return this._interaction.enabled}set interactive(e){this._interaction&&(this._interaction.enabled=e)}get selectedElement(){return this._interaction.selectedElement}set selectedElement(e){this._interaction&&(this._interaction.selectedElement=e)}get visibleAtCurrentScale(){return $(this.layer.effectiveScaleRange,this.view.scale)}constructor(e){super(e),this.type="media-3d",this.drapeSourceType=he.Features,this.updatePolicy=me.SYNC,this._uidToElement=new Map,this._highlightedElements=new Map,this._elementsInHighlightedId=new Map,this._renderElements=new Map,this._lastDrapingExtent=null,this._update=T(async(r,o,s)=>{let n=await this._collectMediaElements(r,o,s);this._synchronizeRenderElements(n)},0);let{view:t,layer:i}=e;this._interaction=new h({view:t,layer:i}),this.addHandles(b(()=>this.interactionOptions,r=>this._interaction.options=r,D))}initialize(){let{view:e,layer:t}=this;this._renderer=e.basemapTerrain.overlayManager.registerGeometryDrapeSource(this);let i=()=>this._updateWithLastDrapingExtent();this.addHandles([_(()=>e.basemapTerrain.overlayManager.unregisterDrapeSource(this)),A(()=>t.effectiveSource,"change",i),A(()=>t.effectiveSource,"refresh",i)]),this._updatingHandles.add(()=>this.suspended,i)}setDrapingExtent(e,t){this._lastDrapingExtent={overlays:e,spatialReference:t},this._updateWithLastDrapingExtent()}getHit(e){let t=this._uidToElement.get(e);return t?{type:"media",element:t,layer:this.layer}:null}highlight(e,t){let i=new ie(t?.name??ee),r=k(e)?Array.from(e):[e];this._elementsInHighlightedId.set(i,r);for(let o of r){let s=this._highlightedElements.get(o);s?s.add(i):this._highlightedElements.set(o,new Set([i]));let n=this._renderElements.get(o)?.getRenderData();n&&(n.renderGeometry.geometry.addHighlight(i),this._renderer.modifyGeometries([n.renderGeometry],R.HIGHLIGHT))}return _(()=>{let o=this._elementsInHighlightedId.get(i);if(o){for(let s of o){let n=this._highlightedElements.get(s);if(!n)continue;n.delete(i);let m=this._renderElements.get(s)?.getRenderData();m&&(m.renderGeometry.geometry.removeHighlight(i),this._renderer.modifyGeometries([m.renderGeometry],R.HIGHLIGHT)),n.size===0&&this._highlightedElements.delete(s)}this._elementsInHighlightedId.delete(i)}})}isUpdating(){return super.isUpdating()||this._interaction.updating}_updateWithLastDrapingExtent(){if(this._lastDrapingExtent==null||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));let{overlays:e,spatialReference:t}=this._lastDrapingExtent;this._updatingHandles.addPromise(this._update(e,t).catch(()=>{}))}async _collectMediaElements(e,t,i){let r=this.layer.effectiveSource;return r==null?new Set:new Set((await Promise.all(e.map(o=>r.queryElements(F(o.extent,t),{signal:i})))).flat())}_synchronizeRenderElements(e){this._synchronizeRenderElementsRemove(e),this._synchronizeRenderElementsAdd(e)}_synchronizeRenderElementsRemove(e){this._renderElements.forEach((t,i)=>{e.has(i)||(this._removeElement(i,t),this.emit("element-render-changed",{element:i}))})}_synchronizeRenderElementsAdd(e){for(let t of e)this._renderElements.has(t)||this._createRenderElement(t)}_removeElement(e,t){this._destroyRenderData(e,t),this._renderElements.delete(e),this._uidToElement.delete(e.uid),t.handle.remove()}_createRenderElement(e){let t=new se({spatialReference:this.view.spatialReference,element:e}),i=new L(W([this._updatingHandles.add(()=>e.opacity,r=>i.getRenderData()?.material.setParameters({opacity:r})),this._updatingHandles.add(()=>t.coords,()=>{i.data?this._updateGeometry(t,i):this._initializeRenderData(t,i)}),this._updatingHandles.add(()=>e.content,()=>this._initializeRenderData(t,i)),E(t)]));this._renderElements.set(e,i),this._uidToElement.set(e.uid,e),this._updatingHandles.addPromise(e.load().catch(()=>{})),this._initializeRenderData(t,i)}_initializeRenderData(e,t){let{coords:i,element:r}=e,{contentWidth:o,contentHeight:s}=r;if(i==null||r.content==null)return void this._destroyRenderData(r,t);if(t.data)return;let n=this._createTexture(r.content),m=n.load(this.view._stage.renderView.renderingContext),c=()=>{this.view._stage.add(n);let p=new pe({textureId:n.id,opacity:r.opacity,perspectiveInterpolation:!0}),g=this._getPositionAttributeArray(i),Ee=[0,0,1,0,1,1,0,1],Te=this._getPerspectiveDivideAttributeArray(g,o,s),I=[0,1,2,0,2,3],we=new re(p,[[y.POSITION,new H(g,I,3,!0)],[y.UV0,new H(Ee,I,2,!0)],[y.PERSPECTIVEDIVIDE,new H(Te,I,1,!0)]]),M=new ce(we,{layerUid:this.layer.uid,graphicUid:r.uid});this._highlightedElements.get(r)?.forEach(be=>M.geometry.addHighlight(be)),this._renderer.addGeometries([M],C.ADD),t.data=new z(M,n,p),this.emit("element-render-changed",{element:r})};K(m)?(t.data=n,this._updatingHandles.addPromise(m),m.then(c).catch(()=>n.dispose())):c()}_updateGeometry(e,t){let{coords:i,element:r}=e;if(i==null||r.content==null)return void this._destroyRenderData(r,t);let o=t.getRenderData();if(!o)return;let s=this._getPositionAttributeArray(i);o.renderGeometry.geometry.setAttributeData(y.POSITION,s);let n=this._getPerspectiveDivideAttributeArray(s,r.contentWidth,r.contentHeight);o.renderGeometry.geometry.setAttributeData(y.PERSPECTIVEDIVIDE,n),o.renderGeometry.geometry.invalidateBoundingInfo(),this._renderer.modifyGeometries([o.renderGeometry],R.GEOMETRY),this.emit("element-render-changed",{element:r})}_getPositionAttributeArray(e){let[t,i,r,o]=e.rings[0];return[t[0],t[1],f,o[0],o[1],f,r[0],r[1],f,i[0],i[1],f]}_getPerspectiveDivideAttributeArray(e,t,i){oe(v,[0,0,t,0,t,i,0,i],[e[0],e[1],e[3],e[4],e[6],e[7],e[9],e[10]]);let r=v[6]/v[8]*t,o=v[7]/v[8]*i;return[1,1+r,1+r+o,1+o]}_destroyRenderData(e,t){let i=t.data;if(i==null)return;if(t.data=null,i?.type===j.Texture)return void i.dispose();let r=i.texture;r.unload(),this.view._stage.remove(r),this._renderer.removeGeometries([i.renderGeometry],C.REMOVE),this.emit("element-render-changed",{element:e})}_createTexture(e){let t=e instanceof HTMLImageElement?e.naturalWidth:e.width,i=e instanceof HTMLImageElement?e.naturalHeight:e.height;if("getFrame"in e)throw new V("media-layer-view-3d","animation is not supported");return new te(e,{wrap:{s:G.CLAMP_TO_EDGE,t:G.CLAMP_TO_EDGE},preMultiplyAlpha:!0,width:t,height:i,mipmap:!0,updateCallback:()=>this.view.basemapTerrain.overlayManager.requestRender()})}get test(){}};a([d({readOnly:!0})],u.prototype,"type",void 0),a([d()],u.prototype,"layer",void 0),a([d()],u.prototype,"interactive",null),a([d()],u.prototype,"selectedElement",null),a([d({readOnly:!0})],u.prototype,"visibleAtCurrentScale",null),u=a([w("esri.views.3d.layers.MediaLayerView3D")],u);var v=J(),L=class{constructor(t){this.handle=t}getRenderData(){return this.data?.type===j.Texture?null:this.data}},z=class{constructor(t,i,r){this.renderGeometry=t,this.texture=i,this.material=r,this.type="RenderData"}},St=u;export{St as default};
