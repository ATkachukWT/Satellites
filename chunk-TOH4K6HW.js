import{a as J,b as w,c as X,d as q}from"./chunk-UP6FLASM.js";import{a as K,b as Q}from"./chunk-DGBDFGKO.js";import{b as H}from"./chunk-44S2QQS2.js";import{f as B,g as F}from"./chunk-FENRIY2T.js";import{p as C,q as D}from"./chunk-B3FO6PT7.js";import{j as O,k as _}from"./chunk-Z5Q7KLA4.js";import{n as v,o as I}from"./chunk-KGVXGH6H.js";import{E as G}from"./chunk-ETE32IYO.js";import{h as W}from"./chunk-ONUGDWDK.js";import{k,r as E,t as V}from"./chunk-UHRSAPGQ.js";import{a as z,b as N}from"./chunk-N2WTMF3X.js";async function Y(e,n,a,o){let t=H(e),i=n[0].spatialReference,r=N(z({},o),{responseType:"json",query:N(z({},t.query),{f:"json",sr:I(i),target:JSON.stringify({geometryType:F(n[0]),geometries:n}),cutter:JSON.stringify(a)})}),s=await G(t.path+"/cut",r),{cutIndexes:l,geometries:c=[]}=s.data;return{cutIndexes:l,geometries:c.map(p=>{let g=B(p);return g.spatialReference=i,g})}}async function Z(e,n,a){let o=typeof e=="string"?W(e):e,t=n[0].spatialReference,i=F(n[0]),r=N(z({},a),{query:N(z({},o.query),{f:"json",sr:I(t),geometries:JSON.stringify(K(n))})}),{data:s}=await G(o.path+"/simplify",r);return Q(s.geometries,i,t)}var ne=()=>E.getLogger("esri.geometry.support.normalizeUtils");function oe(e){return e.type==="polygon"}function se(e){return e[0].type==="polygon"}function re(e){return e[0].type==="polyline"}function $(e){let n=[],a=0,o=0;for(let t=0;t<e.length;t++){let i=e[t],r=null;for(let s=0;s<i.length;s++)r=i[s],n.push(r),s===0?(a=r[0],o=a):(a=Math.min(a,r[0]),o=Math.max(o,r[0]));r&&n.push([(a+o)/2,0])}return n}function ie(e,n){if(!(e instanceof D||e instanceof C)){let t="straightLineDensify: the input geometry is neither polyline nor polygon";throw ne().error(t),new V(t)}let a=q(e),o=[];for(let t of a){let i=[];o.push(i),i.push([t[0][0],t[0][1]]);for(let r=0;r<t.length-1;r++){let s=t[r][0],l=t[r][1],c=t[r+1][0],p=t[r+1][1],g=Math.sqrt((c-s)*(c-s)+(p-l)*(p-l)),u=(p-l)/g,d=(c-s)/g,h=g/n;if(h>1){for(let T=1;T<=h-1;T++){let P=T*n,f=d*P+s,m=u*P+l;i.push([f,m])}let b=(g+Math.floor(h-1)*n)/2,S=d*b+s,U=u*b+l;i.push([S,U])}i.push([c,p])}}return oe(e)?new C({rings:o,spatialReference:e.spatialReference}):new D({paths:o,spatialReference:e.spatialReference})}function ee(e,n,a){if(n){let o=ie(e,1e6);e=_(o,!0)}return a&&(e=X(e,a)),e}function te(e,n,a){if(Array.isArray(e)){let o=e[0];if(o>n){let t=w(o,n);e[0]=o+t*(-2*n)}else if(o<a){let t=w(o,a);e[0]=o+t*(-2*a)}}else{let o=e.x;if(o>n){let t=w(o,n);e=e.clone().offset(t*(-2*n),0)}else if(o<a){let t=w(o,a);e=e.clone().offset(t*(-2*a),0)}}return e}function ae(e,n){let a=-1;for(let o=0;o<n.cutIndexes.length;o++){let t=n.cutIndexes[o],i=n.geometries[o],r=q(i);for(let s=0;s<r.length;s++){let l=r[s];l.some(c=>{if(c[0]<180)return!0;{let p=0;for(let u=0;u<l.length;u++){let d=l[u][0];p=d>p?d:p}p=Number(p.toFixed(9));let g=-360*w(p,180);for(let u=0;u<l.length;u++){let d=i.getPoint(s,u);i.setPoint(s,u,d.clone().offset(g,0))}return!0}})}if(t===a){if(se(e))for(let s of q(i))e[t]=e[t].addRing(s);else if(re(e))for(let s of q(i))e[t]=e[t].addPath(s)}else a=t,e[t]=i}return e}async function le(e,n,a){if(!Array.isArray(e))return le([e],n);n&&typeof n!="string"&&ne().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");let o=typeof n=="string"?n:n?.url??k.geometryServiceUrl,t,i,r,s,l,c,p,g,u=0,d=[],h=[];for(let f of e)if(f!=null)if(t||(t=f.spatialReference,i=v(t),r=t.isWebMercator,c=r?102100:4326,s=J[c].maxX,l=J[c].minX,p=J[c].plus180Line,g=J[c].minus180Line),i)if(f.type==="mesh")h.push(f);else if(f.type==="point")h.push(te(f.clone(),s,l));else if(f.type==="multipoint"){let m=f.clone();m.points=m.points.map(x=>te(x,s,l)),h.push(m)}else if(f.type==="extent"){let m=f.clone()._normalize(!1,!1,i);h.push(m.rings?new C(m):m)}else if(f.extent){let m=f.extent,x=w(m.xmin,l)*(2*s),M=x===0?f.clone():X(f.clone(),x);m.offset(x,0);let{xmin:R,xmax:y}=m;R=Number(R.toFixed(9)),y=Number(y.toFixed(9)),m.intersects(p)&&y!==s?(u=y>u?y:u,M=ee(M,r),d.push(M),h.push("cut")):m.intersects(g)&&R!==l?(u=y*(2*s)>u?y*(2*s):u,M=ee(M,r,360),d.push(M),h.push("cut")):h.push(M)}else h.push(f.clone());else h.push(f);else h.push(f);let b=w(u,s),S=-90,U=b,T=new D;for(;b>0;){let f=360*b-180;T.addPath([[f,S],[f,-1*S]]),S*=-1,b--}if(d.length>0&&U>0){let f=ae(d,await Y(o,d,T,a)),m=[],x=[];for(let y=0;y<h.length;y++){let L=h[y];if(L!=="cut")x.push(L);else{let A=f.shift(),j=e[y];j!=null&&j.type==="polygon"&&j.rings&&j.rings.length>1&&A.rings.length>=j.rings.length?(m.push(A),x.push("simplify")):x.push(r?O(A):A)}}if(!m.length)return x;let M=await Z(o,m,a),R=[];for(let y=0;y<x.length;y++){let L=x[y];L!=="simplify"?R.push(L):R.push(r?O(M.shift()):M.shift())}return R}let P=[];for(let f=0;f<h.length;f++){let m=h[f];if(m!=="cut")P.push(m);else{let x=d.shift();P.push(r===!0?O(x):x)}}return P}function qe(e){if(!e)return null;let n=e.extent;if(!n)return null;let a=e.spatialReference&&v(e.spatialReference);if(!a)return n;let[o,t]=a.valid,i=2*t,{width:r}=n,s,{xmin:l,xmax:c}=n;if([l,c]=[c,l],e.type==="extent"||r===0||r<=t||r>i||l<o||c>t)return n;switch(e.type){case"polygon":if(!(e.rings.length>1))return n;s=$(e.rings);break;case"polyline":if(!(e.paths.length>1))return n;s=$(e.paths);break;case"multipoint":s=e.points}let p=n.clone();for(let g=0;g<s.length;g++){let u=s[g][0];u<0?(u+=t,c=Math.max(u,c)):(u-=t,l=Math.min(u,l))}return p.xmin=l,p.xmax=c,p.width<r?(p.xmin-=t,p.xmax-=t,p):n}function Ae(e,n,a){let o=v(a);if(o==null)return e;let[t,i]=o.valid,r=2*i,s=0,l=0;n>i?s=Math.ceil(Math.abs(n-i)/r):n<t&&(s=-Math.ceil(Math.abs(n-t)/r)),e>i?l=Math.ceil(Math.abs(e-i)/r):e<t&&(l=-Math.ceil(Math.abs(e-t)/r));let c=e+(s-l)*r,p=c-n;return p>i?c-=r:p<t&&(c+=r),c}function Ge(e,n){let a=v(n);if(a){let[o,t]=a.valid,i=t-o;if(e<o)for(;e<o;)e+=i;if(e>t)for(;e>t;)e-=i}return e}export{ie as a,le as b,qe as c,Ae as d,Ge as e};
