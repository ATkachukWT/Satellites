import{b as W}from"./chunk-XHEYQWRE.js";import{a as Z}from"./chunk-3A3BGKXB.js";import{b as Q}from"./chunk-BGOXHRAZ.js";import{a as je,b as _,c as Ie,d as Ee,f as Re,g as O,j as De}from"./chunk-SXNHGK6A.js";import{a as Ve}from"./chunk-ZJWWZWMH.js";import{a as Pe}from"./chunk-AOQ57NDM.js";import{a as _e}from"./chunk-I4Q2S2XA.js";import{b as Se,d as B}from"./chunk-LYNAYPL3.js";import{d as q}from"./chunk-ULANM5YP.js";import{J as ve,L as xe}from"./chunk-2G3SBK6Q.js";import{a as u}from"./chunk-KAMRW6HF.js";import{a as he}from"./chunk-CDP4MSRO.js";import{a as L}from"./chunk-JTDXB5TK.js";import{a as ge,b as be,c as we}from"./chunk-M67YQAIX.js";import{i as Te,l as M}from"./chunk-HP4LYRR4.js";import{c as z}from"./chunk-OLOKUDVI.js";import{b as Me,e as Ce}from"./chunk-4G7UTTZJ.js";import{a as N}from"./chunk-NRBJLISB.js";import{d as de,e as fe}from"./chunk-FENRIY2T.js";import{a as ye}from"./chunk-5HJY3X5Y.js";import{a as G}from"./chunk-WLHY3MMA.js";import{a as ce}from"./chunk-DB3UIQCU.js";import{E as K}from"./chunk-ETE32IYO.js";import{f as R}from"./chunk-SG7CQU4O.js";import{H as i}from"./chunk-QHVIRF5H.js";import{I as m,k as ue,x as me}from"./chunk-WZDN6K3C.js";import{a as t}from"./chunk-QGVBCWUY.js";import{D as pe}from"./chunk-CKJ56T2Q.js";import{b as a,r as V,t as ae}from"./chunk-UHRSAPGQ.js";import{w as le}from"./chunk-V76GWARL.js";import{a as $,b as se,c as ne}from"./chunk-N2WTMF3X.js";var Ne="esri.renderers.support.DictionaryLoader",ke={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},A=class{constructor(r,o,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new ye(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=r,this.config=o,this.fieldMap=s}getSymbolFields(){return this._symbolFields}async getSymbolAsync(r,o){let s;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(o));try{s=await this._dictionaryPromise}catch(d){if(pe(d))return this._dictionaryPromise=null,null}let y=this._dictionaryVersion?.greaterEqual(4,0),l={};if(this.fieldMap)for(let d of this._symbolFields){let f=xe(this.fieldMap[d],this._fieldIndex);if(f){let n=r.attributes[f];l[d]=y?n:n!=null?""+r.attributes[f]:""}else l[d]=""}let p=null;try{p=s?.(l,o)}catch{return null}if(!p||typeof p!="string"||p==="invalid")return null;let x=p.split(";"),S=[],w=[];for(let d=0;d<x.length;d++){let f=x[d];if(f){if(f.includes("po:")){let n=f.slice(3).split("|");if(n.length===3){let I=n[0],E=n[1],b=n[2],F="countrylabel";if(I===F&&E==="TextString"){if(this.fieldMap!=null){let v=this.fieldMap[F];v==null&&(v=F,this.fieldMap[v]=v),r.attributes[v]=b}continue}if(E==="DashTemplate")b=b.split(" ").map(v=>Number(v));else if(E==="Color"){let v=new u(b).toRgba();b=[v[0],v[1],v[2],255*v[3]]}else b=Number(b);w.push({primitiveName:I,propertyName:E,value:b,defaultValue:null})}}else if(f.includes("|")){for(let n of f.split("|"))if(this._itemNames.has(n)){S.push(n);break}}else if(this._itemNames.has(f))S.push(f);else if(d===0){S.length=0;let n="Invalid_P";r.geometry!=null&&(fe(r.geometry)?n="Invalid_A":de(r.geometry)&&(n="Invalid_L")),S.push(n);break}}}let D=r.geometry==null||!r.geometry.hasZ&&r.geometry.type==="point";return this._cimPartsToCIMSymbol(r,S,w,D,o)}async fetchResources(r){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void V.getLogger(Ne).error("no valid URL!");let o=K(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:r!=null?r.signal:null}),[{data:s}]=await Promise.all([o,Me()]);if(!s)throw this._dictionaryPromise=null,new ae("esri.renderers.DictionaryRenderer","Bad dictionary data!");let{authoringInfo:y,dictionary_version:l,expression:p,itemsNames:x}=s,S=p,w=!1;l&&(this._dictionaryVersion=Pe.parse(l),w=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+s.cimRefTemplateUrl,this._itemNames=new Set(x),this._symbolFields=y.symbol;let D={};if(this.config){let n=this.config;for(let I in n)D[I]=n[I]}if(y.configuration)for(let n of y.configuration)D.hasOwnProperty(n.name)||(D[n.name]=n.value);let d=[];if(r?.fields&&this.fieldMap)for(let n in this.fieldMap){let I=this.fieldMap[n],E=r.fields.filter(b=>b.name.toLowerCase()===I?.toLowerCase());E.length>0&&d.push(se($({},E[0]),{type:w?E[0].type:"esriFieldTypeString"}))}d.length>0&&(this._fieldIndex=new he(d));let f=Ce(S,r!=null?r.spatialReference:null,d,D).then(n=>{let I={scale:0};return(E,b)=>{if(n==null)return null;let F=n.repurposeFeature({geometry:null,attributes:E});return I.scale=b!=null?b.scale??void 0:void 0,n.evaluate({$feature:F,$view:I},n.services)}}).catch(n=>(V.getLogger(Ne).error("Creating dictionary expression failed:",n),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(r,o,s,y,l){let p=new Array(o.length);for(let w=0;w<o.length;w++)p[w]=this._getSymbolPart(o[w],l);let x=await Promise.all(p),S=this.fieldMap;if(S&&x.length>0){let{OverrideHelper:w}=await import("./chunk-GJVHHSS2.js");x=a(x);for(let D of x)w.applyDictionaryTextOverrides(D,r,S,this._fieldIndex,ve(D))}return new _e({data:He(x,s,y)})}async _getSymbolPart(r,o){let s=this._symbolCache.get(r);if(s)return s;if(this._ongoingRequests.has(r))return this._ongoingRequests.get(r).then(p=>p.data);let y=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,r),l=K(y,$({responseType:"json",query:{f:"json"}},o));this._ongoingRequests.set(r,l),l.finally(()=>this._ongoingRequests.delete(r));try{let p=await l;return this._symbolCache.put(r,p.data),p.data}catch(p){throw p}}};function He(e,r,o){if(!e||e.length===0)return null;let s=$({},e[0]);if(e.length>1){s.effects=null,s.symbolLayers=[];for(let y of e){let l=y;if(l.effects!=null)for(let p of l.symbolLayers)p.effects==null?p.effects=l.effects:p.effects.unshift(...l.effects);s.symbolLayers.unshift(...l.symbolLayers)}}return o&&(s.callout=ke),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}var X,j=X=class extends O(_){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new A(this.url,this.config,this.fieldMap)}writeData(e,r){e&&(r.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,r,o,s){s?.origin||super.writeVisualVariables(e,r,o,s)}clone(){return new X({config:a(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:a(this.fieldMap),url:a(this.url),visualVariables:a(this.visualVariables)})}async getSymbolAsync(e,r){return this._loader.getSymbolAsync(e,r)}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r),this.scaleExpression&&await M(e,r,this.scaleExpression);for(let o in this.fieldMap){let s=this.fieldMap[o];r.has(s)&&e.add(s)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((e,r)=>e+r.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};t([i({type:A})],j.prototype,"_loader",null),t([i({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],j.prototype,"config",void 0),t([i({type:Object,json:{write:!0}})],j.prototype,"fieldMap",void 0),t([i({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],j.prototype,"scaleExpression",void 0),t([G("scaleExpression")],j.prototype,"writeData",null),t([i({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],j.prototype,"scaleExpressionTitle",void 0),t([i({type:String,json:{write:!0}})],j.prototype,"url",void 0),t([G("visualVariables")],j.prototype,"writeVisualVariables",null),j=X=t([m("esri.renderers.DictionaryRenderer")],j);var Le=j;var Y,P=Y=class extends R{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(V.getLogger(this).error(".field: field must be a string value"),null):ue(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Y({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};t([i({type:u,json:{type:[Number],write:!0}})],P.prototype,"color",void 0),t([i({type:String,json:{write:!0}})],P.prototype,"field",void 0),t([ce("field")],P.prototype,"castField",null),t([i({type:String,json:{write:!0}})],P.prototype,"label",void 0),t([i({type:String,json:{write:!0}})],P.prototype,"valueExpression",void 0),t([i({type:String,json:{write:!0}})],P.prototype,"valueExpressionTitle",void 0),P=Y=t([m("esri.renderers.support.AttributeColorInfo")],P);var J=P;var ee,U=ee=class extends R{constructor(){super(...arguments),this.unit=null}clone(){return new ee({unit:this.unit})}};t([i({type:String,json:{write:!0}})],U.prototype,"unit",void 0),U=ee=t([m("esri.renderers.support.DotDensityLegendOptions")],U);var Oe=U;var te,h=te=class extends O(_){constructor(e){super(e),this.attributes=null,this.backgroundColor=new u([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new q,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;let r=e/this.referenceScale*this.dotValue;return r<1?1:r}getSymbol(){return new Se({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,r)=>e+r.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new te({attributes:a(this.attributes),backgroundColor:a(this.backgroundColor),dotBlendingEnabled:a(this.dotBlendingEnabled),dotShape:a(this.dotShape),dotSize:a(this.dotSize),dotValue:a(this.dotValue),legendOptions:a(this.legendOptions),outline:a(this.outline),referenceScale:a(this.referenceScale),seed:a(this.seed),visualVariables:a(this.visualVariables),authoringInfo:a(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(let o of this.attributes??[])o.valueExpression&&await M(e,r,o.valueExpression),o.field&&e.add(o.field)}};t([i({type:[J],json:{write:!0}})],h.prototype,"attributes",void 0),t([i({type:u,json:{write:!0}})],h.prototype,"backgroundColor",void 0),t([i({type:Boolean,json:{write:!0}})],h.prototype,"dotBlendingEnabled",void 0),t([i({type:String,json:{write:!1}})],h.prototype,"dotShape",void 0),t([i({type:Number,json:{write:!0}})],h.prototype,"dotSize",void 0),t([i({type:Oe,json:{write:!0}})],h.prototype,"legendOptions",void 0),t([i({type:q,json:{default:null,write:!0}})],h.prototype,"outline",void 0),t([i({type:Number,json:{write:!0}})],h.prototype,"dotValue",void 0),t([i({type:Number,json:{write:!0}})],h.prototype,"referenceScale",void 0),t([i({type:Number,json:{write:!0}})],h.prototype,"seed",void 0),t([N({dotDensity:"dot-density"})],h.prototype,"type",void 0),h=te=t([m("esri.renderers.DotDensityRenderer")],h);var Fe=h;var re,k=re=class extends R{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new re({color:this.color&&this.color.clone(),ratio:this.ratio})}};t([i({type:u,json:{type:[me],default:null,write:{isRequired:!0}}})],k.prototype,"color",void 0),t([i({type:Number,json:{write:{isRequired:!0}}})],k.prototype,"ratio",void 0),k=re=t([m("esri.renderers.support.HeatmapColorStop")],k);var H=k;var T=class extends L.ClonableMixin(R){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};t([i({type:String,json:{write:!0}})],T.prototype,"minLabel",void 0),t([i({type:String,json:{write:!0}})],T.prototype,"maxLabel",void 0),t([i({type:String,json:{write:!0}})],T.prototype,"title",void 0),T=t([m("esri.renderers.support.HeatmapLegendOptions")],T);var ie;function qe(e){if(e!=null){let{maxDensity:o,minDensity:s,radius:y}=e;if(o!=null||s!=null||y!=null){let r=e,{blurRadius:l,maxPixelIntensity:p,minPixelIntensity:x}=r;return ne(r,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}var c=ie=class extends _{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new H({ratio:0,color:new u("rgba(255, 140, 0, 0)")}),new H({ratio:.75,color:new u("rgba(255, 140, 0, 1)")}),new H({ratio:.9,color:new u("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return qe(e)}get blurRadius(){return we(this.radius)}set blurRadius(e){let r=this.maxPixelIntensity,o=this.minPixelIntensity;this._set("radius",be(e)),this._set("maxDensity",r*this._pixelIntensityToDensity),this._set("minDensity",o*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(ge**2*this.blurRadius**4)}read(e,r){e=qe(e),super.read(e,r)}getSymbol(){return new B}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,r){let o=this.field,s=this.valueExpression;o&&typeof o=="string"&&Te(e,r,o),s&&typeof s=="string"&&await M(e,r,s)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new ie({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:a(this.colorStops),field:this.field,legendOptions:a(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};t([i({type:je,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],c.prototype,"authoringInfo",void 0),t([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],c.prototype,"blurRadius",null),t([i({type:[H],json:{write:{isRequired:!0}}})],c.prototype,"colorStops",void 0),t([i({type:String,json:{write:!0}})],c.prototype,"field",void 0),t([i({type:T,json:{write:!0}})],c.prototype,"legendOptions",void 0),t([i({type:Number,json:{write:!0}})],c.prototype,"maxDensity",void 0),t([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],c.prototype,"maxPixelIntensity",null),t([i({type:Number,json:{write:!0}})],c.prototype,"minDensity",void 0),t([i({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],c.prototype,"minPixelIntensity",null),t([i({type:Number,cast:z,json:{write:!0}})],c.prototype,"radius",void 0),t([i({type:Number,range:{min:0},json:{default:0,write:!0}})],c.prototype,"referenceScale",void 0),t([N({heatmap:"heatmap"})],c.prototype,"type",void 0),t([i({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],c.prototype,"valueExpression",void 0),t([i({type:String})],c.prototype,"valueExpressionTitle",void 0),t([i({readOnly:!0})],c.prototype,"_pixelIntensityToDensity",null),c=ie=t([m("esri.renderers.HeatmapRenderer")],c);var oe=c;var C=class extends L.ClonableMixin(R){constructor(){super(...arguments),this.color=new u([0,0,0,0]),this.label=null,this.threshold=0}};t([i({type:u,json:{write:!0}})],C.prototype,"color",void 0),t([i({type:String,json:{write:!0}})],C.prototype,"label",void 0),t([i({type:Number,range:{min:0,max:1},json:{write:!0}})],C.prototype,"threshold",void 0),C=t([m("esri.renderers.support.OthersCategory")],C);var $e={base:Ie,key:"type",typeMap:{size:Re,opacity:Ee}},g=class extends O(L.ClonableMixin(_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new u([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new C,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new B({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(le)}getAttributeHash(){return this.visualVariables?.reduce((e,r)=>e+r.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(let o of this.attributes)o.valueExpression&&await M(e,r,o.valueExpression),o.field&&e.add(o.field)}};t([i({type:[J],json:{write:!0}})],g.prototype,"attributes",void 0),t([i(De)],g.prototype,"backgroundFillSymbol",void 0),t([i({type:u,json:{write:!0}})],g.prototype,"defaultColor",void 0),t([i({type:String,json:{write:!0}})],g.prototype,"defaultLabel",void 0),t([i({type:Number,range:{min:0,max:1},json:{write:!0}})],g.prototype,"holePercentage",void 0),t([i({type:C,json:{write:!0}})],g.prototype,"othersCategory",void 0),t([i({type:Ve,json:{write:!0}})],g.prototype,"legendOptions",void 0),t([i({type:q,json:{default:null,write:!0}})],g.prototype,"outline",void 0),t([i({type:Number,cast:z,json:{write:!0}})],g.prototype,"size",void 0),t([N({pieChart:"pie-chart"})],g.prototype,"type",void 0),t([i({types:[$e]})],g.prototype,"visualVariables",void 0),g=t([m("esri.renderers.PieChartRenderer")],g);var Ae=g;var Li={key:"type",base:_,typeMap:{heatmap:oe,simple:Z,"unique-value":Q,"class-breaks":W,"dot-density":Fe,dictionary:Le,"pie-chart":Ae},errorContext:"renderer"},Oi={key:"type",base:_,typeMap:{simple:Z,"unique-value":Q,"class-breaks":W,heatmap:oe},errorContext:"renderer",validate:ze};function ze(e){switch(e.type){case"simple":return Be(e);case"unique-value":return Je(e);case"class-breaks":return Ue(e);case"heatmap":return e}}function Be(e){if(e.symbol)return e;V.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function Je(e){let r=e.uniqueValueInfos,o=r?.filter(({symbol:s,label:y},l)=>(s||V.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${l}] ${y}) without a symbol from web scene.`),!!s));return o?.length!==r?.length&&(e.uniqueValueInfos=o),e}function Ue(e){let r=e.classBreakInfos,o=r?.filter(({symbol:s,label:y},l)=>(s||V.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${l}] ${y}) without a symbol from web scene.`),!!s));return o?.length!==r?.length&&(e.classBreakInfos=o),e}export{H as a,Li as b,Oi as c};
