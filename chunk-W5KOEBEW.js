import{a as F,b as l}from"./chunk-3S7MXQDG.js";import{N as m,j as f}from"./chunk-HP4LYRR4.js";import{I as y}from"./chunk-WZDN6K3C.js";import{a as d}from"./chunk-QGVBCWUY.js";import{t as c}from"./chunk-UHRSAPGQ.js";var M=w=>{let a=class extends w{_validateFetchPopupFeatures(t){let{layer:s}=this,{popupEnabled:p}=s;if(!p)throw new c("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!l(s,t))throw new c("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,s){if(this._validateFetchPopupFeatures(s),t.length===0)return[];let p=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer,i=[];"fieldsIndex"in this.layer&&(i=f(this.layer.fieldsIndex,await F(p,l(this.layer,s)))),await this.prepareFetchPopupFeatures(i);let u=new Set,o=[],r=[];for(let e of t)m(i,e,u)?r.push(e):o.push(e);if(r.length===0)return o;let n=new Map;for(let e=0;e<t.length;e++)n.set(t[e].getObjectId()??0,e);let h=await this.whenGraphicAttributes(r,[...u]).catch(()=>r).then(e=>o.concat(e));return h.sort((e,g)=>{let P=e.getObjectId()??0,b=n.get(P)??0,v=g.getObjectId()??0;return b-(n.get(v)??0)}),h}};return a=d([y("esri.views.3d.layers.support.PopupSceneLayerView")],a),a};export{M as a};
