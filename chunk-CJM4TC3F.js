import{a as v}from"./chunk-FXCL7YYQ.js";import{h as y}from"./chunk-MWSXMSWY.js";import{c as d}from"./chunk-YR2HD3ZC.js";import{a as g}from"./chunk-DB3UIQCU.js";import{D as p,H as i}from"./chunk-QHVIRF5H.js";import{I as u}from"./chunk-WZDN6K3C.js";import{a}from"./chunk-QGVBCWUY.js";import{E as m,O as c}from"./chunk-CKJ56T2Q.js";import{r as l}from"./chunk-UHRSAPGQ.js";var n=new d,o=new WeakMap;function b(e){R(e)&&n.push(new WeakRef(e))}function I(e){let r=n.find(s=>s.deref()===e);r&&n.remove(r)}function R(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function w(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:w(r,e%r):0}var h=0,f=0;function T(){let e=Date.now(),r=!1;for(let s of n){let t=s.deref();t?t.refreshInterval&&e-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,e),t.refresh(e)):r=!0}if(r)for(let s=n.length-1;s>=0;s--)n.at(s).deref()||n.removeAt(s)}p(()=>{let e=Date.now(),r=0;for(let s of n){let t=s.deref();t&&(r=w(Math.round(6e4*t.refreshInterval),r),t.refreshInterval?o.get(t)||o.set(t,e):o.delete(t))}if(r!==f){if(f=r,clearInterval(h),f===0)return void(h=0);h=setInterval(T,f)}},y);function E(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}var L=.1,q=e=>{let r=class extends e{constructor(...s){super(...s),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=c(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||b(this)},()=>{})}destroy(){I(this)}castRefreshInterval(s){return s>=L?s:s<=0?0:L}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(s=Date.now()){m(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",s),this.emit("refresh",{dataChanged:t})},t=>{l.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})})}async hasDataChanged(){return!0}get test(){}};return a([i({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:v}}}}})],r.prototype,"refreshInterval",void 0),a([g("refreshInterval")],r.prototype,"castRefreshInterval",null),a([i({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),a([i({readOnly:!0})],r.prototype,"refreshParameters",null),r=a([u("esri.layers.mixins.RefreshableLayer")],r),r};export{E as a,q as b};
