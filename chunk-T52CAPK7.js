import{a as M}from"./chunk-T4UFXW3U.js";import{a as T}from"./chunk-OOXOZUTM.js";import{a as x}from"./chunk-L2WNUKLP.js";import{a as k,b as D}from"./chunk-7EMOONQX.js";import{c as J}from"./chunk-ZVCMULXF.js";import{c as b}from"./chunk-YR2HD3ZC.js";import{a as j}from"./chunk-5RAXVJQI.js";import{c as U}from"./chunk-EXJYW3PC.js";import{a as N}from"./chunk-SXQPBCOX.js";import{a as P}from"./chunk-4XZ6X7MQ.js";import{a as K}from"./chunk-WLHY3MMA.js";import{a as A}from"./chunk-FTDD7QBB.js";import{E as _}from"./chunk-ETE32IYO.js";import{H as S,h as v}from"./chunk-ONUGDWDK.js";import{f as B}from"./chunk-SG7CQU4O.js";import{H as i,J as $}from"./chunk-QHVIRF5H.js";import{I as f}from"./chunk-WZDN6K3C.js";import{a as o}from"./chunk-QGVBCWUY.js";import{b as R,v as I}from"./chunk-CKJ56T2Q.js";import{b as O,d as g,r as L}from"./chunk-UHRSAPGQ.js";import{a as h,b as w}from"./chunk-N2WTMF3X.js";var c=class extends ${constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){let e=this.language,t=e==="local"||e==="global"?e:J(e??A())??"global";return t=t==="no"?"nb":t,t}};o([i()],c.prototype,"apiKey",void 0),o([i()],c.prototype,"id",void 0),o([i()],c.prototype,"language",void 0),o([i()],c.prototype,"places",void 0),o([i()],c.prototype,"serviceUrl",void 0),o([i()],c.prototype,"worldview",void 0),c=o([f("esri.support.BasemapStyle")],c);var C=c;var d,W=0,n=d=class extends B.JSONSupportMixin(N){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+W++,this.baseLayers=new b,this.referenceLayers=new b;let t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&L.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},s=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>s(r.item)),this.referenceLayers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{L.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.baseLayers.toArray();for(let s of e)s.destroy();let t=this.referenceLayers.toArray();for(let s of t)s.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=R(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=h({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",x(e,this._get("baseLayers")))}_writeBaseLayers(e,t,s){let r=[];e&&(s=w(h({},s),{layerContainerType:"basemap"}),this.baseLayers.forEach(a=>{let l=M(a,s.webmap?s.webmap.getLayerJSONFromResourceInfo(a):null,s);l!=null&&r.push(l)}),this.referenceLayers.forEach(a=>{let l=M(a,s.webmap?s.webmap.getLayerJSONFromResourceInfo(a):null,s);l!=null&&(a.type!=="scene"&&(l.isReference=!0),r.push(l))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",x(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return T(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){let e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(t=>g(t)?t.clone():t),referenceLayers:this.referenceLayers.map(t=>g(t)?t.clone():t)};return this.loaded&&(e.loadStatus="loaded"),new d({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t=h({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(s=>{let r=O(s);return r.url&&S(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&S(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){let{resourceInfo:t,portalItem:s,style:r}=this;I(e);let a=[];if(t){let l=t.context?t.context.url:null;if(a.push(this._loadLayersFromJSON(t.data,l,e)),t.data.id&&!t.data.title){let m=t.data.id;a.push(k(m).then(p=>{p&&this.read({title:p},t.context)}))}}else s?a.push(this._loadFromItem(s,e)):r&&a.push(this._loadFromStylesService(r,e));await Promise.all(a)}async _loadLayersFromJSON(e,t,s){let r=this.resourceInfo?.context,a=this.portalItem?.portal||r?.portal||null,l=G[r?.origin||""]??"web-map",{populateOperationalLayers:m}=await import("./chunk-MUUZ75J7.js"),p=[];if(I(s),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){let y={context:w(h({},r),{origin:l,url:t,portal:a,layerContainerType:"basemap"}),defaultLayerType:"DefaultTileLayer"},F=u=>l==="web-scene"&&u.layerType==="ArcGISSceneServiceLayer"||u.isReference,q=m(this.baseLayers,e.baseMapLayers.filter(u=>!F(u)),y);p.push(q);let z=m(this.referenceLayers,e.baseMapLayers.filter(F),y);p.push(z)}await Promise.allSettled(p)}async _loadFromItem(e,t){let s=await e.load(t),r=await s.fetchData("json",t),a=v(e.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:E[e.type||""]??"web-map",portal:e.portal||U.getDefault(),url:a}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||U.getDefault(),url:a}),this._loadLayersFromJSON(this.resourceInfo.data,a,t)}async _loadFromStylesService(e,t){let s=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,r=`${s}/styles/${e.id}/self`,a=`${s}/webmaps/${e.id}`,[l,m]=await Promise.all([(await _(r,{query:{token:e.apiKey},signal:t?.signal})).data,(await _(a,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data]);this.thumbnailUrl??=l.thumbnailUrl;let p=v(a);if(this._set("resourceInfo",{data:m.baseMap??{},context:{origin:"web-map",url:p}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:m.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,p,t),e.apiKey)for(let y of[...this.baseLayers,...this.referenceLayers])"apiKey"in y&&(y.apiKey=e.apiKey)}static fromId(e){let t=D[e];return t?t.itemId?new d({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):d.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};o([i({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,s,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:b}},writer(e,t,s,r){this._writeBaseLayers(e,t,r)}}}}}})],n.prototype,"baseLayers",null),o([i({type:String,json:{origins:{"web-scene":{write:!0}}}})],n.prototype,"id",void 0),o([i({type:j})],n.prototype,"portalItem",void 0),o([i()],n.prototype,"referenceLayers",null),o([i({readOnly:!0})],n.prototype,"resourceInfo",void 0),o([i({type:P})],n.prototype,"spatialReference",void 0),o([i({type:C})],n.prototype,"style",void 0),o([i()],n.prototype,"thumbnailUrl",void 0),o([i({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],n.prototype,"title",void 0),o([K("title")],n.prototype,"writeTitle",null),n=d=o([f("esri.Basemap")],n);var E={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},G={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},Fe=n;export{Fe as a};
