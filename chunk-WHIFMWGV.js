import{a as V}from"./chunk-75L4O5ME.js";import{a as I,c as s,l as S}from"./chunk-4PDI5FRK.js";import{b}from"./chunk-3S7MXQDG.js";import{c as T,e as R,o as p}from"./chunk-KMLF2ICK.js";import{a as F}from"./chunk-3REMXE4W.js";import{H as n}from"./chunk-QHVIRF5H.js";import{I as w}from"./chunk-WZDN6K3C.js";import{a}from"./chunk-QGVBCWUY.js";import{t as E}from"./chunk-UHRSAPGQ.js";var U=P=>{let t=class extends P{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return V(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?T(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(o){try{return!this.layer.loaded||!!p(this.layer.serviceRasterInfo,o)}catch{return!1}}async fetchPopupFeaturesAtLocation(o,f){let{layer:e}=this;if(!o)throw new E("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});let{popupEnabled:j}=e,D=b(e,f);if(!j||D==null)return[];let y=[],{value:u,magdirValue:d,processedValue:L}=await e.identify(o,{timeExtent:this.timeExtent,signal:f?.signal}),c="";if(u?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&u[0]!=null?u.map(l=>e.getStandardTimeValue(l)).join(", "):u.join(", ");let r={ObjectId:0};r[s.servicePixelValue]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?L?.join(", "):c,r[s.rawServicePixelValue]=c;let h=e.raster?.rasterInfo??e.serviceRasterInfo,g=h?.attributeTable;if(g!=null){let{fields:l,features:_}=g,v=l.find(({name:i})=>i.toLowerCase()==="value"),A=r[s.servicePixelValue],m=v?_.find(i=>String(i.attributes[v.name])===A):null;if(m)for(let i in m.attributes)m.attributes.hasOwnProperty(i)&&(r[I+i]=m.attributes[i])}let x=h?.dataType;if(x!=="vector-magdir"&&x!=="vector-uv"||(r[s.magnitude]=d?.[0],r[s.direction]=d?.[1]),e.type==="imagery-tile"){let{multidimensionalDefinition:l}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});S(e.rasterFields,r,l)}let O=new F({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});y.push(O)}return y}async getSourceScale(){return await this.layer.load(),R(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return p(this.layer.serviceRasterInfo,this.view.spatialReference)}};return a([n()],t.prototype,"fullExtent",null),a([n()],t.prototype,"layer",void 0),a([n({readOnly:!0})],t.prototype,"timeExtent",null),a([n()],t.prototype,"tileInfo",void 0),a([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),a([n()],t.prototype,"datumTransformation",null),t=a([w("esri.views.layers.ImageryTileLayerView")],t),t};export{U as a};
