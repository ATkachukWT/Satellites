import{f as h,h as v}from"./chunk-BNH7YXHY.js";import{a as y}from"./chunk-SLAWDKDA.js";import{G as g,I as S,v as I}from"./chunk-CKJ56T2Q.js";import{t as d}from"./chunk-UHRSAPGQ.js";async function T(s,t,o){let r=await R(s,t,o);await U(r,t,o)}async function x(s,t,o,r,a){let c=await R(o,r,a);await s.update({data:t}),await U(c,r,a)}async function R(s,t,o){if(!t?.resources)return;let r=t.portalItem===s.portalItem?new Set(s.paths):new Set;s.paths.length=0,s.portalItem=t.portalItem;let a=new Set(t.resources.toKeep.map(e=>e.resource.path)),c=new Set,f=[];a.forEach(e=>{r.delete(e),s.paths.push(e)});let u=[],i=[],p=[];for(let e of t.resources.toUpdate)if(r.delete(e.resource.path),a.has(e.resource.path)||c.has(e.resource.path)){let{resource:n,content:b,finish:w}=e,m=v(n,y());s.paths.push(m.path),u.push({resource:m,content:await h(b),compress:e.compress}),w&&p.push(()=>w(m))}else{s.paths.push(e.resource.path),i.push({resource:e.resource,content:await h(e.content),compress:e.compress});let n=e.finish;n&&p.push(()=>n(e.resource)),c.add(e.resource.path)}for(let e of t.resources.toAdd)if(s.paths.push(e.resource.path),r.has(e.resource.path))r.delete(e.resource.path);else{u.push({resource:e.resource,content:await h(e.content),compress:e.compress});let n=e.finish;n&&p.push(()=>n(e.resource))}if(u.length||i.length){let{addOrUpdateResources:e}=await import("./chunk-DNMOMF2U.js");await e(t.portalItem,u,"add",o),await e(t.portalItem,i,"update",o)}if(p.forEach(e=>e()),f.length===0)return r;let l=await S(f);if(I(o),l.length>0)throw new d("save:resources","Failed to save one or more resources",{errors:l});return r}async function U(s,t,o){if(!s||!t.portalItem)return;let r=[];for(let a of s){let c=t.portalItem.resourceFromPath(a);r.push(c.portalItem.removeResource(c,o))}await g(r)}export{T as a,x as b};
