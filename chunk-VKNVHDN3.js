import{a as A,b as Z,c as X,d as he,e as Le,f as ee}from"./chunk-WGX2RQVH.js";import{a as Ne,b as Ue,c as Ce,i as J,m as Gt}from"./chunk-ZQGDHXJX.js";import{a as H}from"./chunk-DD4REJYH.js";import{a as Ge,d as gt}from"./chunk-CQUBHG54.js";import{a as ht}from"./chunk-L25QECEE.js";import{c as ft}from"./chunk-IE6LCR36.js";import{k as ze}from"./chunk-JAENS3D3.js";import{b as Mt,c as St}from"./chunk-IFPD4DIO.js";import{a as $e}from"./chunk-NLZLCUU5.js";import{h as Pt}from"./chunk-76O2P2CB.js";import{a as _t,b as Nt}from"./chunk-BAZL6DXF.js";import{a as wt,b as It,c as Et}from"./chunk-L6ZFUQTH.js";import{a as At}from"./chunk-4MB4OYWM.js";import{b as Ft,c as Dt}from"./chunk-55SQMRMH.js";import{a as de,b as V,c as xt}from"./chunk-QDXM6RGS.js";import{b as Lt}from"./chunk-E3UR4EIC.js";import{a as vt,b as kt}from"./chunk-4Y623NMU.js";import{c as Rt}from"./chunk-PTAJ247D.js";import{a as Ot}from"./chunk-O4MHA7YC.js";import{b as ct}from"./chunk-CJM4TC3F.js";import{a as lt,b as pt,c as dt}from"./chunk-J5PZXDWN.js";import{a as ut}from"./chunk-DZBH24YT.js";import{c as $t,f as Ut,i as zt,m as Ht,n as Bt}from"./chunk-SVJ5AK5B.js";import{a as Ct}from"./chunk-3A3BGKXB.js";import{a as st}from"./chunk-CUJB6F5L.js";import{a as Wt}from"./chunk-5NHJFBCW.js";import{a as Tt}from"./chunk-WPZN772I.js";import{p as bt}from"./chunk-4ABKPPKG.js";import{a as je}from"./chunk-I4Q2S2XA.js";import{f as K}from"./chunk-BSMAMABT.js";import{a as qe}from"./chunk-KAMRW6HF.js";import{b as Q}from"./chunk-TBA3OZMJ.js";import{e as ye}from"./chunk-W26XKMAT.js";import{a as pe}from"./chunk-NQWYPF77.js";import{m as Pe}from"./chunk-2NP7F5RO.js";import{b as Oe}from"./chunk-XEZTJAR4.js";import{a as mt}from"./chunk-BUP3AMMF.js";import{h as le,t as fe}from"./chunk-TPFJWNIU.js";import{e as qt,f as jt}from"./chunk-HP4LYRR4.js";import{a as Ae}from"./chunk-AFC2H4Q3.js";import{f as yt}from"./chunk-FENRIY2T.js";import{p as me,q as xe}from"./chunk-B3FO6PT7.js";import{m as se}from"./chunk-LFH24RLM.js";import{n as ke}from"./chunk-Z5Q7KLA4.js";import{a as _e}from"./chunk-4XZ6X7MQ.js";import{a as at}from"./chunk-WLHY3MMA.js";import{C as z}from"./chunk-KGVXGH6H.js";import{b as Re}from"./chunk-SBHKMV3P.js";import{b as nt}from"./chunk-R4A63S45.js";import{E as ve}from"./chunk-ETE32IYO.js";import{H as f,J as ot,k as rt}from"./chunk-QHVIRF5H.js";import{I as ae,i as q}from"./chunk-WZDN6K3C.js";import{a as m}from"./chunk-QGVBCWUY.js";import{u as it}from"./chunk-CKJ56T2Q.js";import{b as k,r as Ee,t as P}from"./chunk-UHRSAPGQ.js";import{a as G,b as Y,c as tt}from"./chunk-N2WTMF3X.js";var Me=class{constructor(){this.version="",this.queryResult=new He}},He=class{constructor(){this.featureResult=new Be}},Be=class{constructor(){this.objectIdFieldName="",this.uniqueIdField=new We,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new Qe,this.geometryType=null,this.spatialReference=new _e,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new ge,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}},We=class{constructor(){this.name="",this.isSystemMaintained=!1}},Qe=class{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}},ge=class{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new Ve,this.translate=new Je}},Ve=class{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}},Je=class{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}},Se=class{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}},Fe=class{constructor(){this.attributes=[],this.compressedGeometry=new ce,this.centroid=new ce,this.aggregateGeometries=[]}},ce=class{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}};var te;(function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"})(te||(te={}));var Qt=[te.ELEMENTUID,te.TYPENAME],Ye,Ke;(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"})(Ye||(Ye={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(Ke||(Ke={}));var Vt,be,Te,re;(function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"})(Vt||(Vt={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(be||(be={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(Te||(Te={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(re||(re={}));function Jt(e){let t=new Me;t.version=e.version;let i=e.get_query_result();if(i.results_type.value!==0)throw new Error("Got a non-feature collection type");let r=i.get_feature_result(),o=t.queryResult.featureResult;o.objectIdFieldName=r.objectid_field_name,o.exceededTransferLimit=r.exceeded_transfer_limit,o.hasM=r.has_m,o.hasZ=r.has_z,o.geometryType=Ce[r.geometry_type.value],o.globalIdFieldName=r.globalid_field_name,o.geohashFieldName=r.geohash_field_name;let n=o.uniqueIdField,l=r.unique_id_field;n.name=l.name,n.isSystemMaintained=l.isSystemMaintained;let s=o.geometryProperties,y=r.geometry_properties;s.shapeAreaFieldName=y.shapeAreaFieldName,s.shapeLengthFieldName=y.shapeLengthFieldName,s.units=y.units;let a=o.spatialReference,p=r.spatial_reference;a.wkid=p.wkid,a.latestWkid=p.latestWkid,a.vcsWkid=p.vcsWkid,a.latestVcsWkid=p.latestVcsWkid,a.wkt=p.wkt,o.transform=Fr(r.transform);let c=o.fields,d=o.fieldNameToAttributeIndexMap,u=r.fields,h=u.size();for(let T=0;T<h;T++){let M=u.get(T),F=Yt(M);c.push(F),d[F.name]=T,M.delete()}u.delete();let b=o.values,L=r.values_count();for(let T=0;T<L;T++)b.push(r.get_value_at(T));let C=o.features,N=r.features,_=N.size();if(_>0){for(let T of Qt)if(d[T]===void 0)throw new Error(`Feature collection missing required attribute: ${T}`)}for(let T=0;T<_;T++){let M=new Fe,F=N.get(T),$=M.attributes,U=F.attributes_count();for(let D=0;D<U;D++)$.push(F.get_attribute_at(D));let v=F.get_compressed_geometry();v&&(M.compressedGeometry=Ze(v),M.centroid=Ze(F.get_centroid()));let x=M.aggregateGeometries,R=F.aggregate_geometries,W=R.size();for(let D=0;D<W;D++){let ne=R.get(D),ue=Ze(ne);x.push(ue),ne.delete()}R.delete(),C.push(M),F.delete()}N.delete();let S=o.geometryFields,I=r.geometry_fields,g=I.size();for(let T=0;T<g;T++){let M=I.get(T),F=Sr(M);S.push(F),M.delete()}return I.delete(),t}function Ze(e){let t=new ce;t.geometryType=Ce[e.geometry_type.value];let i=[],r=[];for(let o=0;o<e.lengths.length;o++)i.push(e.lengths[o]);for(let o=0;o<e.coords.length;o++)r.push(e.coords[o]);return t.lengths=i,t.coords=r,t}function Yt(e){let t=new Se;return t.name=e.name,t.alias=e.alias,t.fieldType=Ue[e.field_type.value],t.sqlType=Te[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function Sr(e){let t=Yt(e);return t.geometryType=Ce[e.geometry_type.value],t}function Fr(e){let t=new ge;t.quantizeOriginPosition=be[e.quantizeOriginPosition.value];let i=t.scale,r=e.scale;i.xScale=r.xScale,i.yScale=r.yScale,i.mScale=r.mScale,i.zScale=r.zScale;let o=t.translate,n=e.translate;return o.xTranslate=n.xTranslate,o.yTranslate=n.yTranslate,o.mTranslate=n.mTranslate,o.zTranslate=n.zTranslate,t}async function Dr(e){let t=[],i={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(Kt(e.entitiesUrl).then(r=>{Zt(r,i)})),e.relationshipsUrl&&t.push(Kt(e.relationshipsUrl).then(r=>{Zt(r,i)})),await Promise.all(t),i}async function ai(e,t){t??=!1;let i={generateAllSublayers:t,namedTypeDefinitions:new Map};return await kr(e).then(r=>{xr(r,i)}),i}async function si(e){let t=await Ne(),i=new t.MapOfObjectIdentifierSets;Rr(i,t,e);let r=new t.MapOfObjectIdentifierSetsEncoder;try{r.set_map_of_identifier_sets(i),r.encode();let o=r.get_encoding_result();if(o.error.error_code!==0)throw new P("knowledge-graph:layer-support-utils",o.error.error_message);let n=structuredClone(o.get_byte_buffer());return r.delete(),n}finally{i.delete()}}function Rr(e,t,i){for(let[r,o]of i.namedTypeDefinitions){if(!o.members||o.useAllData)continue;let n=o.members.keys(),l=!1,s=!0,y=new t.ObjectIdArray,a=new t.StringArray,p=new t.GlobalIdArray,c=new t.IdentifierArray,d=new t.ObjectIdentifierSet;for(let u of n)s&&(l=!isNaN(Number(u)),s=!1),l?y.add_objectid(Number(u)):(a.add_string(u),p.add_globalid(u)),c.add_identifier(u);d.set_oid_array(y),d.set_string_array(a),d.set_globalid_array(p),d.set_identifier_array(c),y.delete(),a.delete(),p.delete(),c.delete(),e.put_identifier_set(r,d),d.delete()}return e}async function Kt(e){let t=await ve(e,{responseType:"array-buffer"});return vr(await t.data)}async function vr(e){let t=new(await Ne()).FeatureCollectionDecoder,i=t.decode(new Uint8Array(e));if(i.error_code!==0)throw new P("knowledge-graph:layer-support-utils",i.error_message);let r=t.get_feature_collection(),o=Jt(r);return t.delete(),o}async function kr(e){let t=await ve(e,{responseType:"array-buffer"}),i=await t.data;return Ar(new Uint8Array(i))}async function Ar(e){let t=new(await Ne()).MapOfObjectIdentifierSetsDecoder,i=t.decode(new Uint8Array(e)),r=new Map;if(i.error_code!==0)throw new P("knowledge-graph:layer-support-utils",i.error_message);let o=t.get_map_of_identifier_sets(),n=o.keys,l=n.size();for(let s=0;s<l;s++){let y=n.get(s),a=o.query_identifier_set(y),p=[];if(a.id_array_type.value===re.GLOBALID_ARRAY){let c=a.get_globalid_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_globalid_at(u))}else if(a.id_array_type.value===re.IDENTIFIER_ARRAY){let c=a.get_identifier_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_identifier_at(u).toString())}else if(a.id_array_type.value===re.STRING_ARRAY){let c=a.get_string_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_string_at(u))}else{if(a.id_array_type.value!==re.OID_ARRAY)throw new P("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{let c=a.get_oid_array(),d=c.count();for(let u=0;u<d;u++)p.push(c.get_objectid_at(u).toString())}}r.set(y,p)}return t.delete(),r}function Zt(e,t){if(!e?.queryResult?.featureResult)return t;let i=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(let r of e.queryResult.featureResult.features){let o=r.attributes[i[te.TYPENAME]],n=q(t.namedTypeDefinitions,o,()=>({useAllData:!1,members:new Map})),l=r.attributes[i[te.ELEMENTUID]];if(r.compressedGeometry?.coords?.length>0){let s=r.compressedGeometry.lengths;r.compressedGeometry.geometryType==="esriGeometryPoint"&&(s=[]),n.members.set(l,{id:l,linkChartLocation:new mt(s,r.compressedGeometry.coords)})}else n.members.set(l,{id:l})}return t}function xr(e,t){for(let[i,r]of e){let o=q(t.namedTypeDefinitions,i,()=>({useAllData:!1,members:new Map}));for(let n of r)o.members.has(n)||o.members.set(n,{id:n})}return t}var li={fetchAndConvertSerializedLinkChart:e=>Dr(e)};var ie=class e{constructor(){this._featureLookup=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}static resetInstance(){e.instance&&(e.instance=null)}deleteFromStore(t){t.forEach(i=>{this._featureLookup.delete(i)})}readFromStoreByList(t){let i=[];return t.forEach(r=>{let o=this.readFromStoreById(r);o&&i.push(o)}),i}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,i,r){let o=[];return t.forEach(n=>{if(!n?.id)return;n.properties||(n.properties=[]);let l,s=null;if(r&&n.properties[r]&&(s=Pe(n.properties[r])),"originId"in n&&"destinationId"in n&&(n.properties[Z]=n.originId,n.properties[X]=n.destinationId),n.properties[i]=n.id,n.id&&this._featureLookup.has(n.id)&&this._featureLookup.get(n.id).attributes){let y=this._featureLookup.get(n.id),a=JSON.parse(JSON.stringify(Object.assign(y.attributes,n.properties)));r&&n.properties[r]&&(a[r]=yt(n.properties[r])),l=new Oe(s?JSON.parse(JSON.stringify(s)):y?.geometry?JSON.parse(JSON.stringify(y.geometry)):null,a,null,n.properties[i])}else l=new Oe(s?JSON.parse(JSON.stringify(s)):null,n.properties,null,n.properties[i]);this._featureLookup.set(`${n.typeName?`${n.typeName}__${n.id}`:n.id}`,l),o.push(l)}),o}};var Xe,E=null;function hi(){return Xe||(Xe=import("./chunk-MD3XBAMW.js").then(e=>e.l).then(({default:e})=>e({locateFile:t=>nt(`esri/libs/linkchartlayout/${t}`)})).then(e=>{Or(e)}),Xe)}function Or(e){E=e}var Xt,B,er,we;(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"})(Xt||(Xt={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(B||(B={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(er||(er={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(we||(we={}));var tr={none:0,"start-only":1,"start-and-end":2};function Pr(e){let t=Y(G({timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0},e?.toJSON()??{}),{eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"});return Y(G({},t),{timeDirection:{value:we[t.timeDirection]??we.right},eventsTicksVisualization:{value:tr[t.eventsTicksVisualization]??tr["start-and-end"]}})}function oe(e,t,i,r,o,n){let l=i.length,s=o.length,y=Float64Array.BYTES_PER_ELEMENT,a=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,c=16,d=c+l*(p+2*y)+s*(2*a),u=E._malloc(d);try{let h=u+c-u%c,b=h+l*y,L=b+l*y,C=L+s*a,N=C+s*a,_=()=>[E.HEAPF64.subarray(h>>3,(h>>3)+l),E.HEAPF64.subarray(b>>3,(b>>3)+l),E.HEAPU32.subarray(L>>2,(L>>2)+s),E.HEAPU32.subarray(C>>2,(C>>2)+s),E.HEAPU8.subarray(N,N+l)],[S,I,g,T,M]=_();S.set(i),I.set(r),g.set(o),T.set(n),M.set(t);let F=e(l,N,h,b,s,L,C),$=null,U=null;if(F.value===B.Success){let ne=E.getLayoutLinksTypes(),ue=E.getLayoutLinksVerticesEndIndices(),De=E.getLayoutLinksVertices(),et=E.countLayoutLinksVertices();!s||ne&&ue?et&&!De?F.value=B.Error:($={types:new Uint8Array(E.HEAPU8.subarray(ne,ne+s)),vertexEndIndex:new Uint32Array(E.HEAPU32.subarray(ue>>2,(ue>>2)+s)),vertices:new Float64Array(E.HEAPF64.subarray(De>>3,(De>>3)+2*et))},U=E.getAuxiliaryGraphicElements()):F.value=B.Error}let[v,x,R,W,D]=_();return i.set(v),r.set(x),o.set(R),n.set(W),t.set(D),{status:F.value,links:$,graphics:U}}finally{E._free(u),E.cleanupLayout()}}var rr=2,ir=1,or=-1,nr,ar,sr,lr,pr,dr,cr,ur,yr;(function(e){function t(){return E.getMinIdealEdgeLength()}function i(r,o,n,l,s,y,a=rr,p=ir,c=or){return oe((d,u,h,b,L,C,N)=>E.applyForceDirectedLayout(r,d,u,h,b,L,C,N,a,p,c),o,n,l,s,y)}e.getMinIdealEdgeLength=t,e.apply=i})(nr||(nr={})),function(e){function t(i,r,o,n,l,s,y=rr,a=ir,p=or){return oe((c,d,u,h,b,L,C)=>E.applyCommunityLayout(i,c,d,u,h,b,L,C,y,a,p),r,o,n,l,s)}e.apply=t}(ar||(ar={})),function(e){function t(i,r,o,n,l,s){return oe((y,a,p,c,d,u,h)=>E.applySimpleLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(sr||(sr={})),function(e){function t(i,r,o,n,l,s){return oe((y,a,p,c,d,u,h)=>E.applyHierarchicalLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(lr||(lr={})),function(e){function t(i,r,o,n,l,s){return oe((y,a,p,c,d,u,h)=>E.applyRadialTreeLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(pr||(pr={})),function(e){function t(i,r,o,n,l,s){return oe((y,a,p,c,d,u,h)=>E.applySmartTreeLayout(i,y,a,p,c,d,u,h),r,o,n,l,s)}e.apply=t}(dr||(dr={})),function(e){function t(i,r,o,n,l,s,y,a,p,c,d,u){return oe((h,b,L,C,N,_,S)=>{if(l.length!==h)return{value:B.Error};if(s.length!==h)return{value:B.Error};if(p.length!==N)return{value:B.Error};if(c.length!==N)return{value:B.Error};let I=Float64Array.BYTES_PER_ELEMENT,g=16,T=E._malloc(g+h*I),M=E._malloc(g+h*I),F=E._malloc(g+N*I),$=E._malloc(g+N*I),U=T+g-T%g,v=M+g-M%g,x=F+g-F%g,R=$+g-$%g;try{return E.HEAPF64.subarray(U>>3,(U>>3)+h).set(l),E.HEAPF64.subarray(v>>3,(v>>3)+h).set(s),E.HEAPF64.subarray(x>>3,(x>>3)+N).set(p),E.HEAPF64.subarray(R>>3,(R>>3)+N).set(c),E.applyChronologicalLayout(i,h,b,L,C,U,v,N,_,S,x,R,d,Pr(u))}finally{E._free(T),E._free(M),E._free(F),E._free($)}},r,o,n,y,a)}e.apply=t}(cr||(cr={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(ur||(ur={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(yr||(yr={}));var wi=Re()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),Ii=Re()({absoluteValue:"absolute-value",multiplier:"multiplier"});var mr=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);function Gr(e,t){let i=new Map;if(t.dataModel?.relationshipTypes)for(let r of t.dataModel.relationshipTypes)r.name&&i.set(r.name,[]);for(let r of e)i.has(r.typeName)&&i.get(r.typeName)?.push(r.id);return i}async function $i(e,t,i){let r=[],o=Gr(e,t),n={},l=[];for(let[p,c]of o){if(c.length<1)continue;let d=`${p}_ids`;n[d]=c,l.push(`MATCH (n)-[r:${p}]->(m) WHERE id(r) in $${d} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(l.length===0)return[];let s=l.join(" UNION "),y=new H({openCypherQuery:s,bindParameters:n}),a=(await J(t,y,i?.requestOptions)).resultRowsStream.getReader();for(;;){let{done:p,value:c}=await a.read();if(p)break;for(let d of c)r.push({id:d[0],typeName:d[1]}),r.push({id:d[2],typeName:d[3]})}return r}var Ui=e=>mr.get(e)??"radial-root-centric";function fr(e){if(!e.spatialReference.isWGS84)throw new P("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]])}var j=class extends ot{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;let t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach(r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach(r=>{r.geometryType&&r.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:r.name??"",geometryType:r.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((i,r)=>{if(t.get(r)==="entity")this.entityTypeNames.add(r);else{if(t.get(r)!=="relationship")return Ee.getLogger(this).warn(`A named type, ${r}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(r);this.relationshipTypeNames.add(r)}let o=new Map;i.members?.forEach(n=>{q(this.memberIdTypeLookup,n.id,()=>new Set).add(r);let l=this.getById(n.id);l&&o.set(n.id,l)}),this.sublayerCaches.set(r,o)})}addToLayer(e){e.forEach(({typeName:t,id:i})=>{if(!this.inclusionModeDefinition)throw new P("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){let r=this.inclusionModeDefinition.namedTypeDefinitions.get(t);r.members||(r.members=new Map),r.members.set(i,{id:i}),q(this.memberIdTypeLookup,i,()=>new Set).add(t)}}else{let r=new Map;r.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:r}),q(this.memberIdTypeLookup,i,()=>new Set).add(t)}})}getById(e){return ie.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let r;if(r=e||new Q({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){let o=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(t.objectType.name??""),l=r.outFields;l&&l.length===1&&l[0]===A&&r.where==="1=1"||await Promise.all(n??[]);let s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],y=[];return s.forEach(a=>{if(this.relationshipTypeNames.has(t.objectType.name)){a.geometry=o.relationshipLinkChartDiagramLookup.get(a.attributes[t.objectIdField]);let p=this.memberIdTypeLookup.get(a.attributes[Z]),c=this.memberIdTypeLookup.get(a.attributes[X]),d=this._isEndEntitySpatial(p,a,Z),u=this._isEndEntitySpatial(c,a,X);a.attributes[ee]=Number(d&&u)}else{a.geometry=o.entityLinkChartDiagramLookup.get(a.attributes[t.objectIdField]);let p=this.geographicLookup.get(t.objectType.name);p&&a.attributes[p.name]?a.attributes[ee]=1:a.attributes[ee]=0}a.attributes[he]=a.geometry,y.push(a)}),y}return this.retrieveDataFromService(r,t,i)}async getConnectedRecordIds(e,t,i){let r=[],o="",n=this._getNamedTypeIdMapFromNodeIds(e);if(t&&t?.length!==0){for(let p of t)o=o+p+"|";o=o.slice(0,-1)}let l={},s=[];for(let[p,c]of n){let d=`${p}_ids`;l[d]=c,t&&t?.length!==0?s.push(`MATCH (n:${p}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r:${o}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):s.push(`MATCH (n:${p}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!s.length)return r;let y=s.join(" UNION "),a=(await J(this.knowledgeGraph,new H({openCypherQuery:y,bindParameters:l}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){let{done:p,value:c}=await a.read();if(p)break;for(let d=0;d<c.length;d++){let u=c[d];r.push({id:u[0],typeName:u[1]}),r.push({id:u[2],typeName:u[3]})}}return r}async getRelationshipsBetweenNodes(e,t,i){let r=this._getNamedTypeIdMapFromNodeIds(e);if(r.size===0)return[];let o={relationshipExclusionIds:t,possibleConnectionEntityIds:e},n=[];for(let[a,p]of r.entries()){let c=`${a}_ids`;o[c]=p,n.push(`MATCH (n:${a}) WHERE id(n) IN $${c} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let l=n.join(" UNION "),s=[],y=(await J(this.knowledgeGraph,new H({openCypherQuery:l,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){let{done:a,value:p}=await y.read();if(a)break;for(let c=0;c<p.length;c++){let d=p[c];s.push({id:d[0],typeName:d[1]})}}return s}async getRelationshipsFromNodes(e,t,i,r){let o=this._getNamedTypeIdMapFromNodeIds(e);if(o.size===0||t.length===0)return[];let n={relationshipExclusionIds:i,possibleConnectionEntityIds:t},l=[];for(let[c,d]of o.entries()){let u=`${c}_ids`;n[u]=d,l.push(`MATCH (n:${c}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let s=l.join(" UNION "),y=new Map,a=(await J(this.knowledgeGraph,new H({openCypherQuery:s,bindParameters:n}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){let{done:c,value:d}=await a.read();if(c)break;for(let u=0;u<d.length;u++){let h=d[u],b=y.get(h[1]);b||(b=new Set,y.set(h[1],b)),b.add(h[0])}}let p=[];for(let[c,d]of y)for(let u of d)p.push({id:u,typeName:c});return p}async refreshCacheContent(e,t,i,r=!0,o){let n=ie.getInstance(),l=[],s=new Map,y=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&y.set(a.name,a)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(a=>{a.name&&y.set(a.name,a)}),e||this.inclusionModeDefinition?e?e.forEach(a=>{if(this.memberIdTypeLookup.has(a))for(let p of this.memberIdTypeLookup.get(a))s.has(p)?s.get(p)?.push(a):s.set(p,[a])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((a,p)=>{a.useAllData?s.set(p,null):a.members&&a.members.forEach(c=>{s.has(p)&&s.get(p)!==null?s.get(p)?.push(c.id):s.set(p,[c.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&s.set(a.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&s.set(a.name,null)}));for(let[a,p]of s){let c=new Set(p),d=new Promise((u,h)=>{(async()=>{let L=new Set,C=[],N,_="",S=!1;if(t||y.get(a)?.properties?.forEach(T=>{T.name&&L.add(T.name)}),i&&this.geographicLookup.has(a)){let T=this.geographicLookup.get(a)?.name;T&&L.add(T)}if(this.entityTypeNames.has(a))_=`MATCH (n:${a}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,L.forEach(T=>{_+=`, n.${T}`,C.push(T)});else{if(!this.relationshipTypeNames.has(a))throw new P("knowledge-graph:layer-data-manager",`The graph type of ${a} could not be determined. Was this type set in the KG data model and inclusion definition?`);S=!0,_=`MATCH ()-[n:${a}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,L.forEach(T=>{_+=`, n.${T}`,C.push(T)})}N=new H(p?{openCypherQuery:_,bindParameters:{ids:p}}:{openCypherQuery:_});let I=(await J(this.knowledgeGraph,N,{signal:o?.signal})).resultRowsStream.getReader();for(;;){let{done:T,value:M}=await I.read();if(T)break;let F=[];for(let v=0;v<M.length;v++){let x=M[v],R=0,W=0,D={properties:{}};for(D.id=x[R],R++,W++,S&&(D.originId=x[R],R++,W++,D.destinationId=x[R],R++,W++,q(this.nodeConnectionsLookup,D.originId,()=>new Set).add(D.id),q(this.nodeConnectionsLookup,D.destinationId,()=>new Set).add(D.id),q(this.relationshipConnectionsLookup,D.id,()=>[D.originId,D.destinationId]));R<x.length;R++)D.properties[C[R-W]]=x[R];c.delete(D.id),F.push(D)}let $=n.writeToStore(F,A,this.geographicLookup.get(a)?.name);this.sublayerCaches.has(a)||this.sublayerCaches.set(a,new Map),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(a)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(a,{useAllData:!1,members:new Map}),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(a).members=new Map);let U=this.sublayerCaches.get(a);$.forEach(v=>{U?.set(v.attributes[A],v),r&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members.has(v.attributes[A])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(a).members.set(v.attributes[A],{id:v.attributes[A]}),q(this.memberIdTypeLookup,v.attributes[A],()=>new Set).add(a))})}let g=this.inclusionModeDefinition?.namedTypeDefinitions.get(a);if(g)for(let T of c)g.members?.delete(T)})().then(()=>{u(null)}).catch(L=>{L.name==="AbortError"?u(null):h(L)})});l.push(d),this._processingCacheUpdatesLookup.get(a)?.push(d)}if(await Promise.all(l),o?.signal?.aborted)throw it()}removeFromLayer(e){let t=new Set,i=new Set(e.map(r=>r.id));for(let r of e)t.add(r.typeName),this.memberIdTypeLookup.get(r.id)?.size===1?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,n)=>{n===r.typeName&&o.members?.has(r.id)&&o.members.delete(r.id)});t.forEach(r=>{this.sublayerCaches.get(r)?.forEach((o,n)=>{i.has(n)&&this.sublayerCaches.get(r)?.delete(n)})})}async retrieveDataFromService(e,t,i){let r=ie.getInstance(),o=new Set,n=[],l,s="",y=[],a=t.graphType==="relationship",p=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,c=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name),d=!p&&c?Array.from(c).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&e.objectIds!=null&&(d=e.objectIds);else if(e.objectIds!=null&&d&&d.length>0){let h=e.objectIds;e.objectIds=d.filter(b=>h.includes(b))}else if(e.objectIds!=null)d=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=d}if(e.outFields!=null){let h=e.outFields;h.includes("*")?t.fields.forEach(b=>{o.add(b.name)}):h.forEach(b=>{b!==A&&b!==t.geometryFieldName&&o.add(b)})}if(e.geometry!=null){let h=e.geometry,b,L=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,C=L?.spatialReference,N=L?.serviceCapabilities?.geometryCapabilities,_=N?.geometryMaxBoundingRectangleSizeX,S=N?.geometryMaxBoundingRectangleSizeY;if(h.type==="point"){let I=h;I.spatialReference?.isWGS84||(await fe(I.spatialReference,z),I=le(I,z)),b=new se({spatialReference:z,xmin:I.x-1e-4,ymin:I.y-1e-4,xmax:I.x+1e-4,ymax:I.y+1e-4})}else h?.extent?.spatialReference&&!h.spatialReference?.isWGS84?(await fe(h.extent.spatialReference,z),b=le(h.extent,z)):b=h.extent;if(_&&S&&C){if(C.wkid!==4326){let I=new se({spatialReference:C,xmax:_,ymax:S}),g=le(I,z);_=g.xmax,S=g.ymax}if(b.xmax-b.xmin>_)throw new P("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}\xB0 latitude, limit exceeded`);if(b.ymax-b.ymin>S)throw new P("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${S}\xB0 longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){let I=await Ae(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(g=>{I.fieldNames.includes(g.name)&&o.add(g.name)})}s=a?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(I=>{s+=`, n.${I}`,n.push(I)}),l=new H({openCypherQuery:s,bindParameters:{param_filter_geom:new me({rings:fr(b)})}})}else{let h="";if(e.where!=null&&e.where!=="1=1"){let C=await Ae(e.where,t.fieldsIndex);t.fields.forEach(g=>{C.fieldNames.includes(g.name)&&o.add(g.name)});let N=new Set(["column-reference","string","number","binary-expression"]),_=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),S=!1,I=g=>{if(g.type==="column-reference")return`n.${g.column}`;if(g.type==="string")return`'${g.value}'`;if(g.type==="number")return`${g.value}`;if(g.type==="binary-expression"&&N.has(g.left.type)&&N.has(g.right.type)&&_.has(g.operator))return`${I(g.left)} ${g.operator} ${I(g.right)}`;if(g.type==="binary-expression"&&g.operator==="LIKE"){let T="";if(g.left.type==="function"&&g.left.args.value[0].type==="column-reference")T+=`lower(n.${g.left.args.value[0].column})`;else{if(g.left.type!=="column-reference")return S=!0,"";T+=`lower(n.${g.left.column})`}if(T+=" CONTAINS (",g.right.type!=="string")return S=!0,"";{let M=g.right.value;M.charAt(0)==="%"&&(M=M.slice(1)),M.charAt(M.length-1)==="%"&&(M=M.slice(0,-1)),T+=`'${M.toLowerCase()}')`}return T}return S=!0,""};h=I(C.parseTree),S&&(h="")}let b="";b=a?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let L=!1;d&&(L=!0,b+=" WHERE ID(n) IN $ids"),h&&(b+=L?" AND":" WHERE",b+=` ${h}`),b+=" return ID(n)",a&&(b+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(C=>{b+=`, n.${C}`,n.push(C)}),l=new H(d?{openCypherQuery:b,bindParameters:{ids:d}}:{openCypherQuery:b})}let u=(await J(t.parentCompositeLayer.dataManager.knowledgeGraph,l,i)).resultRowsStream.getReader();for(;;){let{done:h,value:b}=await u.read();if(h)break;let L=[];for(let C=0;C<b.length;C++){let N=b[C],_=0,S=0,I={properties:{}};for(I.id=N[_],_++,S++,a&&(I.originId=N[_],_++,S++,I.destinationId=N[_],_++,S++);_<N.length;_++)I.properties[n[_-S]]=N[_];L.push(I)}y=y.concat(r.writeToStore(L,A,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return y}_isEndEntitySpatial(e,t,i){for(let r of e??[])if(this.entityTypeNames.has(r)){let o=this.geographicLookup.get(r),n=o&&this.sublayerCaches.get(r)?.get(t.attributes[i]);if(o&&n?.attributes[o.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){let t=new Map;return e.forEach(i=>{if(this.memberIdTypeLookup.has(i))for(let r of this.memberIdTypeLookup.get(i)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(i):t.set(r,[i])}}),t}};m([f()],j.prototype,"knowledgeGraph",void 0),m([f()],j.prototype,"inclusionModeDefinition",void 0),m([f()],j.prototype,"entityTypeNames",void 0),m([f()],j.prototype,"relationshipTypeNames",void 0),m([f()],j.prototype,"geographicLookup",void 0),m([f()],j.prototype,"sublayerCaches",void 0),m([f()],j.prototype,"nodeConnectionsLookup",void 0),m([f()],j.prototype,"relationshipConnectionsLookup",void 0),m([f()],j.prototype,"memberIdTypeLookup",void 0),j=m([ae("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],j);var qr={initializeLayersFromClientData:async(e,t,i)=>{if(t||(t=[...e.layers,...e.tables].map(n=>n.graphTypeName)),t?.length===0)return;let r=new Map;for(let n of t)r.set(n,hr(e,n));let o=await Gt(e.dataManager.knowledgeGraph,Array.from(r.values()),{requestOptions:{signal:i?.signal}});for(let n of[...e.layers,...e.tables]){let l=n.objectType.name;if(l==null)continue;let s=o.get(hr(e,l));if(s){let y=JSON.parse(s);y===null||typeof y!="object"||y.hasOwnProperty("showLabels")||(y.showLabels=!1),n.read(y,{origin:"service"})}}}},hr=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function wo(e,t,i){return qr.initializeLayersFromClientData(e,t,i)}var gr=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],jr="#8f8f82";function br(e){return e<0||e>=gr.length?new qe(jr):new qe(gr[e])}function Tr(e){let t=e.toArray();return new je({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function wr(e){let t="ESRI__ID",i=4;for(let r of e)if(r.name){if(r.name.toLowerCase()==="name"){t=r.name;break}r.name.toLowerCase().includes("name")?(t=r.name,i=2):r.fieldType==="esriFieldTypeString"&&i>3&&(t=r.name,i=3)}return t}function Ir(e,t,i){let r={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},o=new V({labelExpressionInfo:new de({expression:i==="ESRI__ID"?`${t}`:`$feature.${i}`}),labelPlacement:"above-center",symbol:new K(r)}),n=new V({labelExpressionInfo:new de({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new K(Y(G({},r),{yoffset:"12px"}))});return e==="entity"?[o]:[n]}function Er(e,t,i){let r={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},o=i==="ESRI__ID"?`${e}`:`$feature.${i}`;return t==="point"?[new V({labelExpressionInfo:new de({expression:o}),labelPlacement:"above-center",symbol:new K(r)})]:t==="polyline"?[new V({labelExpressionInfo:new de({expression:o}),labelPlacement:"center-along",repeatLabel:!0,symbol:new K(r)})]:t==="polygon"?[new V({labelExpressionInfo:new de({expression:o}),labelPlacement:"always-horizontal",symbol:new K(r)})]:null}var _r=At(),Nr=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return m([f(_r.fields)],t.prototype,"fields",void 0),m([f(_r.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=m([ae("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};function O(e){if(!e.json)return e;e.json.write=Cr(e.json.write);let t=e.json.origins;if(!t)return e;let i;for(i in t){let r=t[i];r&&(r.write=Cr(r.write))}return e}function Cr(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=$r(e)),e):e===!0?Ie():e}function $r(e){let n=e,{target:t,writer:i,overridePolicy:r}=n,o=tt(n,["target","writer","overridePolicy"]);return function(l,s){let y=Lr.call(this,l,s);return y.enabled?G(G({},o),y):y}}function Ie(){return{overridePolicy:Lr}}function Lr(e,t){let i=!!this.geometryType,r={enabled:i};return i&&(r=G(G({},r),Mr.call(this,e,t))),r}function Mr(e,t){return{ignoreOrigin:this.originIdOf(t)>rt.DEFAULTS}}var w=class extends Nr(wt(St(Nt(dt(Dt(kt(ut(ct(st(Wt)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=gt(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=A,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{let t=new MessageChannel;return new Pt(t.port1,{channel:t,client:{queryFeatures:(i,r={})=>{let o=Q.fromJSON(i);return this.queryFeaturesJSON(o,r)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){let t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){let e=[];return this.objectType?.properties?.forEach(t=>{let i=t.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":t.fieldType;e.push(ye.fromJSON({name:t.name,type:i,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(ye.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),ye.fromJSON({name:Le,type:"esriFieldTypeInteger",alias:Le,editable:!1}),ye.fromJSON({name:ee,type:"esriFieldTypeInteger",alias:ee,editable:!1})),e}get geometryType(){if(this.parentCompositeLayer?.type==="link-chart")return this.graphType==="relationship"?"polyline":"point";let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&t!=="esriGeometryNull"?pe.fromJSON(t):null}get geometryFieldName(){return this.parentCompositeLayer?.type==="link-chart"?he:this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasM??!1}get hasZ(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name;return(t?this.objectType?.properties?.[t]:null)?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");let e=this.objectType.properties?wr(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?Ir(this.graphType,this.graphTypeName,e):Er(this.graphTypeName,this.geometryType,e)}set renderer(e){qt(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");let e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(o=>o.name).indexOf(this.graphTypeName),i=br(t);if(this.parentCompositeLayer?.type==="link-chart"){if(this.graphType==="relationship")return new Ct({type:"simple",symbol:Tr(i)});let o=$e(Ge(pe.toJSON("point")).renderer);return ze(o.symbol,i),o}let r=$e(Ge(pe.toJSON(this.geometryType)).renderer);return ze(r.symbol,i),r}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??_e.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return Ot(this,e)}createQuery(){return new Q({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();let{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e),o=Tt.fromJSON(await r.executeQuery(i.toJSON(),t?.signal));return o.features.forEach(n=>{n.sourceLayer=this}),o}async queryFeaturesJSON(e,t){await this.load();let{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e);return await r.executeQuery(i.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();let{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(e);return r.executeQueryForCount(i.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();let i=Y(G({},e),{returnGeometry:!0}),{resolvedQuery:r,queryEngine:o}=await this._setupQueryObjects(i),n=await o.executeQueryForExtent(r.toJSON(),t?.signal),l;return l=n.extent?.xmin!=null&&n.extent?.xmax!=null&&n.extent?.ymin!=null&&n.extent?.ymax!=null?new se(n.extent):new se,{count:n.count,extent:l}}async queryObjectIds(e,t){await this.load();let i=Q.from(e),r;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let o=await this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(o)}return await r.executeQueryForIds(i.toJSON(),t?.signal)}loadQueryEngine(e){let t=new ht({geometryType:pe.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new ft({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:pe.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return i.featureStore.addMany(e),i}async refreshCachedQueryEngine(){let e=await this.parentCompositeLayer.dataManager.getData(new Q({where:"1=1",outFields:[A]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>jt(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){let i=Q.from(e),r=i.geometry;if(r&&!r.spatialReference?.isWGS84&&(await fe(r.spatialReference,z),i.geometry=le(r instanceof me||r instanceof xe||r instanceof ke?r:r.extent,z)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:i,queryEngine:this._cachedQueryEngine};let o=await this.parentCompositeLayer.dataManager.getData(i,this,t);return{resolvedQuery:i,queryEngine:this.loadQueryEngine(o)}}};m([f(O(k(lt)))],w.prototype,"blendMode",void 0),m([f()],w.prototype,"capabilities",void 0),m([f({json:{origins:{"web-scene":{write:!1}},write:Ie()}})],w.prototype,"charts",void 0),m([f({readOnly:!0})],w.prototype,"defaultPopupTemplate",null),m([f({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],w.prototype,"definitionExpression",void 0),m([f()],w.prototype,"displayField",void 0),m([f(O(k(It)))],w.prototype,"displayFilterEnabled",void 0),m([f(O(k(Et)))],w.prototype,"displayFilterInfo",void 0),m([f(O(k(pt)))],w.prototype,"effect",void 0),m([f()],w.prototype,"elevationInfo",void 0),m([f(O(k(_t)))],w.prototype,"featureEffect",void 0),m([f(O(k(Mt)))],w.prototype,"featureReduction",null),m([f()],w.prototype,"fields",null),m([f()],w.prototype,"geometryType",null),m([f()],w.prototype,"geometryFieldName",null),m([f({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphType",void 0),m([f({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],w.prototype,"graphTypeName",null),m([f()],w.prototype,"hasM",null),m([f()],w.prototype,"hasZ",null),m([f({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],w.prototype,"id",void 0),m([f({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],w.prototype,"labelsVisible",void 0),m([f({type:[V],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Ur,write:Ie()}})],w.prototype,"labelingInfo",null),m([f({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"layerType",void 0),m([f(O(k(Ut)))],w.prototype,"legendEnabled",void 0),m([f(O(k(Bt)))],w.prototype,"maxScale",void 0),m([f(O(k(Ht)))],w.prototype,"minScale",void 0),m([f()],w.prototype,"objectIdField",void 0),m([f()],w.prototype,"objectType",void 0),m([f(O(k(zt)))],w.prototype,"opacity",void 0),m([f(O(k(Ft)))],w.prototype,"orderBy",void 0),m([f({clonable:!1})],w.prototype,"parent",void 0),m([f()],w.prototype,"parentCompositeLayer",void 0),m([f(O(k($t)))],w.prototype,"popupEnabled",void 0),m([f({type:bt,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],w.prototype,"popupTemplate",void 0),m([f({type:Number,json:{write:{overridePolicy:Mr}}})],w.prototype,"refreshInterval",void 0),m([f({types:Lt,json:{name:"layerDefinition.drawingInfo.renderer",write:Ie()}})],w.prototype,"renderer",null),m([f()],w.prototype,"source",void 0),m([f()],w.prototype,"spatialReference",null),m([f({type:Rt,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],w.prototype,"timeInfo",null),m([f({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],w.prototype,"title",null),m([at("title")],w.prototype,"writeTitle",null),m([f({json:{read:!1}})],w.prototype,"type",void 0),m([f(O(k(vt)))],w.prototype,"useViewTime",void 0),m([f({type:Boolean,json:{name:"visibility",write:Ie()}})],w.prototype,"visible",void 0),w=m([ae("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],w);var Sn=w;function Ur(e,t,i){let r=[["ESRI__AGGREGATION_COUNT",Le],["ESRI__ORIGIN_ID",Z],["ESRI__DESTINATION_ID",X],["ESRI__LAYOUT_GEOMETRY",he]];try{for(let o of e)for(let[n,l]of r)o.labelExpression=o.labelExpression?.replaceAll(n,l),o.labelExpressionInfo?.expression&&(o.labelExpressionInfo.expression=o.labelExpressionInfo.expression.replaceAll(n,l))}catch(o){Ee.getLogger(this).warn("Error updating labelingInfo",o)}return xt(e,t,i)}export{ai as a,si as b,li as c,ie as d,hi as e,Xt as f,B as g,er as h,nr as i,ar as j,sr as k,lr as l,pr as m,dr as n,cr as o,$i as p,Ui as q,j as r,wo as s,Sn as t};
