import{a as x,b as be,c as we,d as Fe,e as _e}from"./chunk-NZVRA3ED.js";import{d as Ee,e as ve}from"./chunk-CQPPG6BL.js";import{a as me,b as fe,d as ge}from"./chunk-B44Y56KQ.js";import"./chunk-4A4W2HKR.js";import"./chunk-55A3JRI3.js";import"./chunk-RJZWYGCE.js";import"./chunk-322WAKKC.js";import"./chunk-NTZN6TGL.js";import{a as he,c as v}from"./chunk-ZIK4TOX5.js";import{a as de}from"./chunk-2U44WK2Y.js";import"./chunk-75L4O5ME.js";import{a as pe}from"./chunk-JUMM5VTE.js";import"./chunk-4ZBUTOIE.js";import"./chunk-33CLQ4QA.js";import"./chunk-R7MBZ4JV.js";import"./chunk-DSVUPQIZ.js";import"./chunk-CQPDHCMH.js";import"./chunk-F5QAIQ3J.js";import{a as le,b as Q,c as ue}from"./chunk-3S7MXQDG.js";import"./chunk-N52QLLCJ.js";import"./chunk-WTFHZZK4.js";import"./chunk-ZGGQ3WAU.js";import"./chunk-SUP7IXR3.js";import"./chunk-YMDW3G4U.js";import{i as se,m as oe,o as ae}from"./chunk-I775TR7R.js";import"./chunk-KLXERNY4.js";import"./chunk-VCEKZDML.js";import"./chunk-3NX4GRTL.js";import"./chunk-JX3MPN3R.js";import"./chunk-IE6LCR36.js";import"./chunk-SCNTWYD2.js";import"./chunk-K3Z3MI77.js";import"./chunk-35XAFVAL.js";import"./chunk-C3PAYYXB.js";import"./chunk-3CWCNPAI.js";import"./chunk-UCYOLKZK.js";import"./chunk-WTZT4FKW.js";import"./chunk-6FDNNAVT.js";import"./chunk-FYZRIMPP.js";import"./chunk-VYI3HIPB.js";import{e as J}from"./chunk-WI3QVC6K.js";import"./chunk-SNUEOKCP.js";import"./chunk-ZQCWKCV6.js";import"./chunk-Q7U5SZXR.js";import"./chunk-W5TVDNWG.js";import"./chunk-IPMZUQ2D.js";import{b as ce}from"./chunk-QGGZPZNN.js";import"./chunk-LC2PQWW4.js";import"./chunk-UZ3LPMUO.js";import"./chunk-YAHHW2G4.js";import"./chunk-BCDNNCF4.js";import"./chunk-NPWEUFES.js";import"./chunk-PQNOJ4XM.js";import{a as ye}from"./chunk-26JWDTE3.js";import"./chunk-GPDZGV7G.js";import"./chunk-LG7DXNE4.js";import"./chunk-2VR3WADU.js";import"./chunk-7S2234XQ.js";import"./chunk-5QOQFLF6.js";import"./chunk-2I3LIA7G.js";import"./chunk-5DVGZXEZ.js";import"./chunk-QCAQAWPU.js";import"./chunk-BENEV3E6.js";import"./chunk-R3G2IXBO.js";import"./chunk-ZFRNSCYG.js";import"./chunk-IDSQ2YJ4.js";import"./chunk-IZXGUN7P.js";import"./chunk-CFF33S4D.js";import"./chunk-OWV7FEAY.js";import"./chunk-2XYAAYOE.js";import"./chunk-OOXOZUTM.js";import"./chunk-SPPN4AOM.js";import"./chunk-TY4DYZZJ.js";import"./chunk-LHI3UGTZ.js";import"./chunk-6SGUOKGX.js";import"./chunk-LCFWGHLF.js";import"./chunk-XACQ2RJ5.js";import"./chunk-3TRID6QS.js";import"./chunk-VUJT53YX.js";import"./chunk-WUXNV6ZW.js";import"./chunk-PM3EZWDJ.js";import"./chunk-KE2U7ENE.js";import"./chunk-WIFM6OT5.js";import"./chunk-GI4NW5SA.js";import"./chunk-F4FOXK2P.js";import"./chunk-T5NHE3SD.js";import"./chunk-SWCOPTUX.js";import"./chunk-7EWNVUY7.js";import"./chunk-SXYHD4V6.js";import"./chunk-FSW536RM.js";import"./chunk-YNDA4ZZB.js";import"./chunk-JAN3FVXP.js";import"./chunk-F4HA2HQL.js";import"./chunk-BSKAVVQS.js";import"./chunk-AEU2INWT.js";import"./chunk-Z4UBZ6W2.js";import"./chunk-CMKJEBQJ.js";import"./chunk-AQMR24IC.js";import"./chunk-3J3Q4LMA.js";import"./chunk-PSNQ2KG3.js";import"./chunk-LIKQ6DPU.js";import"./chunk-H6LI7TZP.js";import"./chunk-2IWALBQY.js";import"./chunk-IVHM64W3.js";import"./chunk-QQ5W5TEP.js";import"./chunk-YQHQQW4I.js";import"./chunk-7V6BRQYE.js";import"./chunk-IZU6TNEP.js";import"./chunk-DNN7JJKY.js";import"./chunk-Y7XG5IWW.js";import"./chunk-X5NPIY3C.js";import"./chunk-JXRFF2VE.js";import"./chunk-7WCQBAQY.js";import"./chunk-V4ZQZTCB.js";import"./chunk-PEYNLMWW.js";import"./chunk-FQIIIJGL.js";import"./chunk-SZTSN5BD.js";import"./chunk-VAOSSSLB.js";import"./chunk-6L543SC5.js";import"./chunk-CUV3BSEW.js";import"./chunk-6FI5AY7X.js";import"./chunk-ZCAR53EN.js";import"./chunk-DH67ILIV.js";import"./chunk-7GUYYJRR.js";import"./chunk-WS4AMEGN.js";import"./chunk-CU7FHMWW.js";import"./chunk-CSFAHB4Y.js";import"./chunk-AMISFAT3.js";import"./chunk-PTXLSCMJ.js";import"./chunk-NRRX2M6N.js";import"./chunk-PMLKCTEJ.js";import"./chunk-MYO2G5ZH.js";import"./chunk-MTUYS77G.js";import"./chunk-EG2DTURK.js";import"./chunk-57FV5BVL.js";import"./chunk-YVCKQBWT.js";import"./chunk-4XEE5PE3.js";import"./chunk-MBNZK2RR.js";import"./chunk-DV6KBPBR.js";import"./chunk-XWEUR6F7.js";import"./chunk-KALTBP5D.js";import"./chunk-O2J7LFYY.js";import"./chunk-422PSKZ7.js";import"./chunk-SFANISLX.js";import"./chunk-5L4CW2H2.js";import"./chunk-UJ7KVQR6.js";import"./chunk-B74L7AUE.js";import"./chunk-MJO3PLZV.js";import"./chunk-YU3IFRYW.js";import"./chunk-XKFJ6GWH.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import"./chunk-EM2AEAFS.js";import"./chunk-VGAXEXH3.js";import"./chunk-YEPHAEAY.js";import"./chunk-76X7RFM4.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import"./chunk-L7NOU4T2.js";import"./chunk-SU7IJ65K.js";import"./chunk-WOZSH7YY.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-HUUJBVXR.js";import"./chunk-4LDVFWME.js";import"./chunk-A45BLB26.js";import"./chunk-DFYW3Y3B.js";import"./chunk-UBQPWKE4.js";import"./chunk-YSD7LK2L.js";import"./chunk-CTVZOIWY.js";import"./chunk-BSSTF6JG.js";import{c as ie}from"./chunk-7JW7DYCQ.js";import"./chunk-UP67O2XH.js";import"./chunk-6CO4643W.js";import"./chunk-TMY7UIU7.js";import{d as _}from"./chunk-BPX3YT3K.js";import"./chunk-LXEWGICX.js";import"./chunk-NIYDRLW4.js";import"./chunk-4K47EN3B.js";import{a as te}from"./chunk-FGY3YBPM.js";import"./chunk-EDOVNTC7.js";import"./chunk-FSWSNKJD.js";import"./chunk-MVDZB4AK.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FGEB67EG.js";import"./chunk-YEXMIDOT.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-2T2QPZOS.js";import"./chunk-4YCQZSNI.js";import"./chunk-37H4LYIE.js";import"./chunk-VYZHOYXV.js";import"./chunk-K7YQAHQ7.js";import"./chunk-XAHD7XBV.js";import"./chunk-J6YGDWJF.js";import"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import"./chunk-IKCK67OG.js";import"./chunk-C4ERY4CA.js";import"./chunk-WDTJILD4.js";import"./chunk-YAZINLP3.js";import"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import"./chunk-WV5CXXQQ.js";import"./chunk-KBDKZSTB.js";import"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import{a as re}from"./chunk-HBMVPT4U.js";import"./chunk-L6ZFUQTH.js";import"./chunk-4MB4OYWM.js";import"./chunk-XG5NROZE.js";import"./chunk-7OTP74QG.js";import"./chunk-ZU53JDRS.js";import"./chunk-KQEHVUTS.js";import"./chunk-7LUXMWRM.js";import"./chunk-TO337MWO.js";import"./chunk-WKYBGWI5.js";import"./chunk-62PJ3MJN.js";import"./chunk-OVJTX4VC.js";import"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import"./chunk-QDXM6RGS.js";import"./chunk-E3UR4EIC.js";import"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import"./chunk-R5HXEPJ3.js";import"./chunk-CJM4TC3F.js";import"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-DZBH24YT.js";import"./chunk-7E723FQO.js";import"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-NFARB7KW.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import"./chunk-WT3XCHGP.js";import"./chunk-CUJB6F5L.js";import"./chunk-5NHJFBCW.js";import"./chunk-WPZN772I.js";import"./chunk-AZ7O5NEQ.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-ONYJLWAD.js";import"./chunk-VMECOA4F.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-YHWE4TIZ.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-ZPQDV27Y.js";import"./chunk-SIMI7FRM.js";import"./chunk-YQGS4EZO.js";import{a as ee}from"./chunk-3REMXE4W.js";import"./chunk-4ABKPPKG.js";import{a as z}from"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-77L5NP7A.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-XIZXEWWA.js";import"./chunk-6DGDLLNL.js";import"./chunk-UWWWQ44M.js";import"./chunk-BHB4UQZT.js";import"./chunk-DJW5LMRG.js";import"./chunk-SEJXLJ5V.js";import"./chunk-MPAJA3DL.js";import"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import"./chunk-YW3L7OMP.js";import"./chunk-DVBZA6ZU.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import{b as R}from"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-IRI7XXYY.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-DTU6MHUX.js";import"./chunk-NFXNGFHZ.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-G27DRLGO.js";import{d as Z}from"./chunk-KRAKR4MK.js";import"./chunk-MCO7DSFO.js";import"./chunk-D7WE3OBT.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import"./chunk-TOH4K6HW.js";import"./chunk-UP6FLASM.js";import"./chunk-DGBDFGKO.js";import"./chunk-44S2QQS2.js";import"./chunk-DQOFEB5P.js";import"./chunk-JTDXB5TK.js";import"./chunk-2NP7F5RO.js";import"./chunk-7QY3BMVN.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-G7TP3ZYQ.js";import"./chunk-Y6YEAKJ5.js";import"./chunk-S52JRLJC.js";import"./chunk-U4TLMQTY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-HM5RIVQC.js";import"./chunk-EM35R6FY.js";import"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import"./chunk-6B5XFA6F.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-BIRSPTTF.js";import"./chunk-IZLELRQR.js";import"./chunk-7EMOONQX.js";import"./chunk-RZF6KTKU.js";import{N as ne,g as E,j as L}from"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-SP2CO3KX.js";import"./chunk-NRBJLISB.js";import{b as K}from"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-WDETDPZG.js";import{a as X,g as $,h as Y}from"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import{a as I,i as C,j as b}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import{c as W}from"./chunk-YR2HD3ZC.js";import{a as j}from"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-BUSG3ZOF.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import{a as k}from"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import"./chunk-SG7CQU4O.js";import{H as a,J as F}from"./chunk-QHVIRF5H.js";import{I as f,i as U}from"./chunk-WZDN6K3C.js";import{a as o}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{D as H,H as N,P as D,b as O,e as B,m as T,v as w,y as G}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{r as c,t as M}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as P,b as q}from"./chunk-N2WTMF3X.js";var S=(e,r)=>{let t=class extends k.EsriPromiseMixin(z.IdentifiableMixin(j.EventedMixin(e))){constructor(i){super(i),this.sublayer=null,this.parent=null,this.view=null}initialize(){}get suspended(){return!this.canResume()}get updating(){return!this.suspended&&this.isUpdating()}get visible(){return!!this.sublayer?.visible}set visible(i){this._overrideIfSome("visible",i)}get fullOpacity(){let i=s=>s??1;return i(this.sublayer?.opacity)*i(this.parent?.fullOpacity)}canResume(){return!this.parent?.suspended&&this.view?.ready&&this.visible||!1}isUpdating(){return!1}};return o([a()],t.prototype,"sublayer",void 0),o([a()],t.prototype,"parent",void 0),o([a({readOnly:!0})],t.prototype,"suspended",null),o([a({type:Boolean,readOnly:!0})],t.prototype,"updating",null),o([a()],t.prototype,"view",void 0),o([a()],t.prototype,"visible",null),o([a()],t.prototype,"fullOpacity",null),t=o([f("esri.views.3d.layers.BuildingSublayerView3D")],t),t};var h;(function(e){e[e.Solid=0]="Solid",e[e.WireFrame=1]="WireFrame",e[e.XRay=2]="XRay"})(h||(h={}));var xe=.15,Me=.5*xe;function Se(e){switch(e.filterMode.type){case"solid":return{mode:h.Solid};case"wire-frame":return{mode:h.WireFrame,edgeMaterial:ie(e.filterMode.edges,{})};case"x-ray":return{mode:h.XRay}}}function A(e,r){if(r==null)return e.color[3]=0,void(e.edgeMaterial=null);switch(r.mode){case h.Solid:return;case h.WireFrame:return e.color[3]=0,void(e.edgeMaterial=r.edgeMaterial);case h.XRay:return e.color[0]=1,e.color[1]=1,e.color[2]=1,e.color[3]*=xe,e.colorMixMode=te.Replace,e.castShadows=!1,e.pickable=!1,void(e.edgeMaterial=Ie(e.edgeMaterial))}}function Ie(e){return e==null?null:(V.lastMaterial!==e&&(V.cachedMaterial=Ce(e),V.lastMaterial=e),V.cachedMaterial)}function Ce(e){let r=K(e.color);return r[3]*=Me,q(P({},e),{color:r})}var V={cachedMaterial:null,lastMaterial:null};var m=class extends F{constructor(){super(...arguments),this.sublayer=null}get updating(){return!1}get suspended(){return!1}get availableFields(){return[]}get filter(){return null}set filter(r){throw new Error("Not implemented")}queryFeatures(r,t){throw new Error("Not implemented")}queryObjectIds(r,t){throw new Error("Not implemented")}queryFeatureCount(r,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(r,t){throw new Error("Not implemented")}highlight(r){throw new Error("Not implemented")}};o([a()],m.prototype,"sublayer",void 0),o([a()],m.prototype,"availableFields",null),o([a()],m.prototype,"filter",null);var p=class extends ve(Ee(ge(S(m)))){constructor(){super(...arguments),this.type="building-component-sublayer-3d",this.layerView=null,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!1,this.requiredFields=[],this.progressiveLoadFactor=1,this._queryEngine=null}get i3slayer(){return this.sublayer}get layerUid(){return this.sublayer.layer.uid}get sublayerUid(){return this.sublayer.uid}get layerId(){return this.sublayer.layer.id}get sublayerId(){return this.sublayer.id}get layerPopupEnabledAndHasTemplate(){return this.sublayer.popupEnabled&&ue(this.sublayer,this.layerView?.view.popup?.defaultPopupTemplateEnabled)}initialize(){this._updatingHandles.add(()=>this.mergedFilter,r=>{r!=null&&x.checkSupport(r)?this._i3sFilter==null?this._i3sFilter=new x({viewFilter:r,layerFieldsIndex:this.sublayer.fieldsIndex,loadAsyncModule:t=>this._loadAsyncModule(t),addSqlFilter:(t,i)=>this.addSqlFilter(t,i,this.logError),addTimeFilter:(t,i)=>this.addTimeFilter(t,i)}):this._i3sFilter.viewFilter=r:this._i3sFilter=O(this._i3sFilter)},b),this._updatingHandles.add(()=>[this.sublayer.renderer,this.definitionExpressionFields,this.filterExpressionFields],()=>this._updateRequiredFields()),this._updatingHandles.add(()=>this.sublayer.renderer,r=>this._rendererChange(r),C);let e=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,e),this._updatingHandles.add(()=>this._i3sFilter?.sortedObjectIds,e),this._updatingHandles.add(()=>this._i3sFilter?.parsedWhereClause,e),this._updatingHandles.add(()=>this.getTimeFilterDependencies(),e),this._updatingHandles.add(()=>this.mergedFilter,e),this._updatingHandles.add(()=>[this._i3sFilter?.parsedGeometry,this.filter?.spatialRelationship],()=>this._geometryFilterChange()),this._updatingHandles.add(()=>this.parsedFilterExpressions,()=>this._updateSymbologyOverride(),C),this.addResolvingPromise(this._updateRequiredFields())}get lodFactor(){return this.view.qualitySettings.sceneService.object.lodFactor}get parsedFilterExpressions(){return this.sublayer.modelName!=="Overview"&&this.layerView?this.layerView.filterExpressions.map(([e,r])=>{let t;try{t=J.create(e,{fieldsIndex:this.sublayer.fieldsIndex})}catch(n){return c.getLogger(this).error("Failed to parse filterExpression: "+n),null}if(!t.isStandardized)return c.getLogger(this).error("filterExpression is using non standard function"),null;let i=[],s=t.fieldNames;return se(s,this.sublayer.fields,{missingFields:i}),i.length>0?(c.getLogger(this).error(`filterExpression references unknown fields: ${i.join(", ")}`),null):[t,r]}).filter(e=>e!=null):[]}get filter(){return this._get("filter")}set filter(e){this._set("filter",x.checkSupport(e)?e:null)}isUpdating(){return super.isUpdating()||(this._i3sFilter?.updating??!1)}_updateSymbologyOverride(){let e=this.parsedFilterExpressions;e.length>0?this._setSymbologyOverride((r,t)=>{for(let[i,s]of e)try{if(i.testFeature(r))return A(t,s)}catch(n){this.logError(n)}return A(t,null)},this.filterExpressionFields):this._setSymbologyOverride(null,null)}get filterExpressionFields(){return E(this.sublayer.fieldsIndex,this.parsedFilterExpressions.reduce((e,[r])=>e.concat(r.fieldNames),new Array))}get availableFields(){let e=this.sublayer,r=e.fieldsIndex,t=this.requiredFields;if(e.outFields||e.layer.outFields){let i=[...e.outFields||[],...e.layer.outFields||[]];t=[...L(r,i),...t]}return E(r,t)}_createLayerGraphic(e){return new ee({attributes:e,layer:this.sublayer.layer,sourceLayer:this.sublayer})}canResume(){return super.canResume()&&_(this.i3slayer.effectiveScaleRange,this.view.scale)&&(!this._controller||this._controller.rootNodeVisible)}async fetchPopupFeaturesFromGraphics(e,r){let t=this._validateFetchPopupFeatures(r);if(t)throw t;if(e.length===0)return[];let i=[],s=[],n=this.sublayer.associatedLayer!=null?await this.sublayer.associatedLayer.load(r):this.sublayer,l=L(this.sublayer.fieldsIndex,await le(n,Q(this.sublayer,r)));w(r);let u=new Set;for(let y of e)ne(l,y,u)?s.push(y):i.push(y);return s.length===0?i:(this.sublayer.associatedLayer!=null&&await this.sublayer.associatedLayer.load().catch(()=>c.getLogger(this).warn("Failed to load associated feature layer. Displaying popup attributes from cached attributes.")),this.whenGraphicAttributes(s,Array.from(u)).catch(y=>(G(y),s)).then(y=>i.concat(y)))}async _updateRequiredFields(){let e=E(this.sublayer.fieldsIndex,[...this.sublayer.renderer?await this.sublayer.renderer.getRequiredFields(this.sublayer.fieldsIndex):[],...this.definitionExpressionFields,...this.filterExpressionFields]);this._set("requiredFields",e)}_validateFetchPopupFeatures(e){let{sublayer:r}=this,{popupEnabled:t}=r;return t?Q(r,e)?void 0:new M("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{sublayer:r}):new M("buildingscenelayerview3d:fetchPopupFeatures","Popups are disabled",{sublayer:r})}getFilters(){let e=super.getFilters();return this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),this._i3sFilter?.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}createQuery(){let e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return this.filter!=null?this.filter.createQuery(e):new R(e)}queryExtent(e,r){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),r?.signal)}queryFeatureCount(e,r){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),r?.signal)}queryFeatures(e,r){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),r?.signal).then(t=>{if(!t?.features)return t;let i=this.sublayer,s=i.layer;for(let n of t.features)n.layer=s,n.sourceLayer=i;return t})}async queryObjectIds(e,r){return(await this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),r?.signal)).filter(X)}_ensureQueryEngine(){return this._queryEngine??=this._createQueryEngine(),this._queryEngine}_createQueryEngine(){let e=me(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new be({layerView:this,priority:Z.FEATURE_QUERY_ENGINE,spatialIndex:new _e({featureAdapter:new we({objectIdField:this.sublayer.objectIdField,attributeStorageInfo:this.sublayer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(r,t)=>this._forAllFeatures((i,s,n)=>r(new Fe(i,s,n)),t,fe.QUERYABLE),getFeatureExtent:e,sourceSpatialReference:oe(this.sublayer),viewSpatialReference:this.view.spatialReference})})}_ensureQuery(e){return this._addDefinitionExpressionToQuery(e==null?this.createQuery():R.from(e))}};o([a()],p.prototype,"i3slayer",null),o([a()],p.prototype,"layerView",void 0),o([a()],p.prototype,"lodFactor",null),o([a({readOnly:!0})],p.prototype,"parsedFilterExpressions",null),o([a({type:re})],p.prototype,"filter",null),o([a()],p.prototype,"_i3sFilter",void 0),o([a({type:[String],readOnly:!0})],p.prototype,"filterExpressionFields",null),o([a({type:[String],readOnly:!0})],p.prototype,"requiredFields",void 0),o([a({type:[String],readOnly:!0})],p.prototype,"availableFields",null),p=o([f("esri.views.3d.layers.BuildingComponentSublayerView3D")],p);var Ve=p;var g=class extends pe{constructor(r){super(r),this.layer=null,this.sublayerViews=null}highlight(r){throw new Error("Not implemented")}};o([a()],g.prototype,"layer",void 0),o([a()],g.prototype,"sublayerViews",void 0);var Re=S(F),d=class extends de(g){constructor(e){super(e),this.type="building-scene-3d",this.sublayerViews=new W,this._abortController=new AbortController,this._loadingComponents=0,this._pendingWhenSublayerViews=new Map,this.ignoresMemoryFactor=!1}get filterExpression(){let e=this.layer.activeFilterId,r=e!=null?this.layer.filters.find(i=>i.id===e):null,t=r!=null?r.filterBlocks?.find(i=>i.filterMode.type==="solid"):null;return t?t.filterExpression:null}get filterExpressions(){let e=this.layer.activeFilterId,r=e!=null?this.layer.filters.find(t=>t.id===e):null;return r?.filterBlocks?r.filterBlocks.toArray().map(t=>[t.filterExpression??"",Se(t)]):[]}get updatingProgressValue(){let e=this.sublayerViews,r=this._loadingComponents+(e?e.length:0);return e.reduce((t,i)=>t+i.updatingProgress,0)/r}get visibleAtCurrentScale(){return _(this.layer.effectiveScaleRange,this.view.scale)}isUpdating(){return this._loadingComponents>0||this.sublayerViews&&this.sublayerViews.some(e=>e.updating)}initialize(){ae(this.layer.spatialReference,this.view.spatialReference,this.view.viewingMode),this._initializeSubLayerViews(this.layer.sublayers,this)}destroy(){this.sublayerViews&&(this.sublayerViews.forEach(e=>e.destroy()),this.sublayerViews=null),this._abortController=B(this._abortController)}_initializeSubLayerViews(e,r){let t=this,i=this.view;e.forEach(s=>{if(!s.isEmpty)if(s.type==="building-group"){let n=new Re({sublayer:s,view:i,parent:r});this._initializeSubLayerViews(s.sublayers,n)}else s.geometryType==="mesh"&&(this._loadingComponents++,s.load({signal:this._abortController.signal}).then(()=>{let n=new Ve({sublayer:s,layerView:t,view:i,parent:r});this.sublayerViews.push(n);let l=this._pendingWhenSublayerViews.get(s);if(l){for(let u of l)u.resolve(n);this._pendingWhenSublayerViews.delete(s)}this.addHandles([I(()=>n.updating,()=>this.notifyChange("updating"),b),I(()=>n.updatingProgress,()=>this.notifyChange("updatingProgressValue"),b)])}).catch(n=>{H(n)||c.getLogger(this).error(`Error while creating view for sublayer ${s.id}
Layer: ${this.layer.url}
`,n)}).then(()=>{this._loadingComponents--,this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}))})}getGraphicFromIntersectorTarget(e){for(let r of this.sublayerViews.items)if(r.sublayer.uid===e.sublayerUid)return r.getGraphicFromIntersectorTarget(e);return null}async fetchPopupFeaturesFromGraphics(e,r){if(e.length===0)return[];let t=Le(e,n=>n.sourceLayer),i=[];for(let[n,l]of t){let u=this._findComponent(n);u!=null&&i.push(u.fetchPopupFeaturesFromGraphics(l,r))}let s=await N(i);return w(r),s.flat()}whenGraphicBounds(e){let r=this._findComponent(e.sourceLayer);return r==null?Promise.reject():r.whenGraphicBounds(e)}getAABBFromIntersectorTarget(e){for(let r of this.sublayerViews.items)if(r.sublayer.uid===e.sublayerUid)return r.getAABBFromIntersectorTarget(e);return null}async whenSublayerView(e){let r=this._findComponent(e);if(r!=null)return r;let t=this._pendingWhenSublayerViews.get(e),i=D();return t?t.push(i):this._pendingWhenSublayerViews.set(e,[i]),i.promise}_findComponent(e){return this.sublayerViews.find(r=>e===r.sublayer)}highlight(e,r){if(Y(e))return v;let t=he(e);if(t.length===0)return v;if($(t[0])){let i=t,s=new Map;for(let l of i)U(s,l.sourceLayer,()=>[]).push(l);let n=[];return this.sublayerViews.forEach(l=>{let u=s.get(l.sublayer);u&&n.push(l.highlight(u,r))}),T(n)}return v}get usedMemory(){return this.sublayerViews.reduce((e,r)=>e+r.usedMemory,0)}get unloadedMemory(){return this.sublayerViews.reduce((e,r)=>e+r.unloadedMemory,0)}get performanceInfo(){return new ye(this.usedMemory)}};function Le(e,r){let t=new Map,i=e.length;for(let s=0;s<i;s++){let n=e[s],l=r(n,s,e),u=t.get(l);u?u.push(n):t.set(l,[n])}return t}o([a()],d.prototype,"sublayerViews",void 0),o([a({readOnly:!0})],d.prototype,"filterExpression",null),o([a({readOnly:!0})],d.prototype,"filterExpressions",null),o([a(ce)],d.prototype,"updatingProgress",void 0),o([a({readOnly:!0,dependsOn:[]})],d.prototype,"updatingProgressValue",null),o([a({readOnly:!0})],d.prototype,"visibleAtCurrentScale",null),d=o([f("esri.views.3d.layers.BuildingSceneLayerView3D")],d);var vt=d;export{vt as default};
