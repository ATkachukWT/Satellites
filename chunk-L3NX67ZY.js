import{a as ce}from"./chunk-WW3SAFCJ.js";import{a as _e}from"./chunk-XD6DLQ5C.js";import{a as Ke}from"./chunk-2VPSOQ3I.js";import{a as de,b as ue,c as re,d as Xe,e as G,f as $,g as et,h as tt,i as it,j as rt,l as ot,m as oe,n as at,o as st,r as lt,s as Ne}from"./chunk-PLNKZWB3.js";import"./chunk-Q25BGVIG.js";import{r as Te,v as nt}from"./chunk-66CRL4W4.js";import{b as He}from"./chunk-X25AT5DO.js";import"./chunk-W3BAYQCT.js";import{c as U}from"./chunk-N64WAD57.js";import{A as he,B as le,C as Je,D,J as S,M as Q,N as Ge,O as B,Y as We,ga as be,m as ne,n as ze,p as j,s as ie,u as C,x as Ie,z as J}from"./chunk-MGSAXUID.js";import{a as Oe}from"./chunk-OCNYIIP3.js";import"./chunk-M2IX3KDU.js";import{e as N}from"./chunk-WI3QVC6K.js";import{a as p,b as y}from"./chunk-GPURZ6GA.js";import{a as O}from"./chunk-F7NFZM65.js";import{c as se,q as ge}from"./chunk-I7FLOUNH.js";import{a as Fe}from"./chunk-IKCK67OG.js";import"./chunk-C4ERY4CA.js";import"./chunk-WDTJILD4.js";import"./chunk-YAZINLP3.js";import"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import"./chunk-WV5CXXQQ.js";import"./chunk-KBDKZSTB.js";import"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import"./chunk-HBMVPT4U.js";import"./chunk-L6ZFUQTH.js";import"./chunk-4MB4OYWM.js";import"./chunk-XG5NROZE.js";import"./chunk-7OTP74QG.js";import"./chunk-ZU53JDRS.js";import"./chunk-KQEHVUTS.js";import"./chunk-7LUXMWRM.js";import"./chunk-TO337MWO.js";import"./chunk-WKYBGWI5.js";import"./chunk-62PJ3MJN.js";import"./chunk-OVJTX4VC.js";import"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import"./chunk-QDXM6RGS.js";import"./chunk-E3UR4EIC.js";import"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import"./chunk-R5HXEPJ3.js";import"./chunk-CJM4TC3F.js";import"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-DZBH24YT.js";import"./chunk-7E723FQO.js";import"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-NFARB7KW.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import"./chunk-WT3XCHGP.js";import"./chunk-CUJB6F5L.js";import"./chunk-5NHJFBCW.js";import"./chunk-WPZN772I.js";import"./chunk-AZ7O5NEQ.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-ZPQDV27Y.js";import"./chunk-SIMI7FRM.js";import"./chunk-YQGS4EZO.js";import{a as Ye}from"./chunk-3REMXE4W.js";import"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-IRI7XXYY.js";import"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import{e as Z}from"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import{a as qe,b as Qe,c as Be}from"./chunk-44S2QQS2.js";import"./chunk-JTDXB5TK.js";import"./chunk-2NP7F5RO.js";import"./chunk-7QY3BMVN.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-WDETDPZG.js";import{b as Me,d as R,f as A}from"./chunk-HX2VGIR2.js";import{d as Ue}from"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import{q as Ve}from"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-NI7FJV5X.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import{c as ve}from"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import"./chunk-Z5Q7KLA4.js";import{a as we}from"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import{a as ye}from"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import{a as ae}from"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import{E as Re}from"./chunk-ETE32IYO.js";import"./chunk-ONUGDWDK.js";import{f as X}from"./chunk-SG7CQU4O.js";import{H as E,a as Ze}from"./chunk-QHVIRF5H.js";import{I as Y,o as Pe}from"./chunk-WZDN6K3C.js";import{a as b}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{M as $e}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{r as Le}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as q,b as pe}from"./chunk-N2WTMF3X.js";var ct;(function(n){n[n.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",n[n.RTContainment=2]="RTContainment",n[n.RTAttachment=3]="RTAttachment",n[n.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",n[n.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(ct||(ct={}));var vt=new ae({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),P=new ae({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});var Et=new ae({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});var k=class extends X{constructor(n){super(n),this.globalId=null,this.associationType=null,this.fromNetworkElement=null,this.toNetworkElement=null,this.geometry=null,this.errorMessage=null,this.percentAlong=null,this.errorCode=null,this.isContentVisible=null,this.status=null}readFromNetworkElement(n,t){return new O({globalId:t.fromGlobalId,networkSourceId:t.fromNetworkSourceId,terminalId:t.fromTerminalId})}writeFromNetworkElement(n,t){n&&(t.fromGlobalId=n.globalId,t.fromNetworkSourceId=n.networkSourceId,t.fromTerminalId=n.terminalId)}readToNetworkElement(n,t){return new O({globalId:t.toGlobalId,networkSourceId:t.toNetworkSourceId,terminalId:t.toTerminalId})}writeToNetworkElement(n,t){n&&(t.toGlobalId=n.globalId,t.toNetworkSourceId=n.networkSourceId,t.toTerminalId=n.terminalId)}};b([E({type:String,json:{write:!0}})],k.prototype,"globalId",void 0),b([E({type:P.apiValues,json:{type:P.jsonValues,read:P.read,write:P.write}})],k.prototype,"associationType",void 0),b([E({type:O,json:{write:{target:{fromGlobalId:{type:String},fromNetworkSourceId:{type:Number},fromTerminalId:{type:Number}}},read:{source:["fromGlobalId","fromNetworkSourceId","fromTerminalId"]}}})],k.prototype,"fromNetworkElement",void 0),b([we("fromNetworkElement")],k.prototype,"readFromNetworkElement",null),b([ye("fromNetworkElement")],k.prototype,"writeFromNetworkElement",null),b([E({type:O,json:{write:{target:{toGlobalId:{type:String},toNetworkSourceId:{type:Number},toTerminalId:{type:Number}}},read:{source:["toGlobalId","toNetworkSourceId","toTerminalId"]}}})],k.prototype,"toNetworkElement",void 0),b([we("toNetworkElement")],k.prototype,"readToNetworkElement",null),b([ye("toNetworkElement")],k.prototype,"writeToNetworkElement",null),b([E({type:Ve,json:{write:!0}})],k.prototype,"geometry",void 0),b([E({type:String,json:{write:!0}})],k.prototype,"errorMessage",void 0),b([E({type:Number,json:{write:!0}})],k.prototype,"percentAlong",void 0),b([E({type:Number,json:{write:!0}})],k.prototype,"errorCode",void 0),b([E({type:Boolean,json:{write:!0}})],k.prototype,"isContentVisible",void 0),b([E({type:Number,json:{write:!0}})],k.prototype,"status",void 0),k=b([Y("esri.rest.networks.support.Association")],k);var dt=k;var fe=class extends X{constructor(n){super(n),this.associations=[]}};b([E({type:[dt],json:{write:!0}})],fe.prototype,"associations",void 0),fe=b([Y("esri.rest.networks.support.QueryAssociationsResult")],fe);var ut=fe;function It(n){let{returnDeletes:t,elements:r,gdbVersion:w,moment:I}=n.toJSON();return{returnDeletes:t,elements:JSON.stringify(r.map(e=>({globalId:e.globalId,networkSourceId:e.networkSourceId,terminalId:e.terminalId}))),types:JSON.stringify(n.types.map(e=>P.toJSON(e))).replaceAll('"connectivity"','"junctionJunctionConnectivity"'),gdbVersion:w,moment:I}}async function ft(n,t,r){let w=Qe(n),I=pe(q({},It(t)),{f:"json"}),e=Be(q(q({},w.query),I)),i=qe(e,pe(q({},r),{method:"post"})),a=`${w.path}/associations/query`,{data:l}=await Re(a,i),m=ut.fromJSON(l);return t.types.includes("connectivity")&&Ze(Le.getLogger("esri/rest/networks/support/QueryAssociationsParameters"),"types",{replacement:"Please use 'junction-junction-connectivity' instead of 'connectivity'.",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-rest-networks-support-QueryAssociationsParameters.html#types",version:"4.29",warnOnce:!0}),m}var Ee,W=Ee=class extends X{static from(n){return Pe(Ee,n)}constructor(n){super(n),this.returnDeletes=!1,this.elements=[],this.types=[],this.gdbVersion=null,this.moment=null}};b([E({type:Boolean,json:{write:!0}})],W.prototype,"returnDeletes",void 0),b([E({type:[O],json:{write:!0}})],W.prototype,"elements",void 0),b([E({type:[P.apiValues],json:{type:P.jsonValues,read:P.read,write:P.write}})],W.prototype,"types",void 0),b([E({type:String,json:{write:!0}})],W.prototype,"gdbVersion",void 0),b([E({type:Date,json:{type:Number,write:{writer:(n,t)=>{t.moment=n?.getTime()}}}})],W.prototype,"moment",void 0),W=Ee=b([Y("esri.rest.networks.support.QueryAssociationsParameters")],W);var mt=W;function ht(n){if(n.length===1){if(A(n[0]))return ce("distinct",n[0],-1);if(J(n[0]))return ce("distinct",n[0].toArray(),-1)}return ce("distinct",n,-1)}function De(n,t,r){let w=n.getVariables();if(w.length>0){let I={};for(let e of w)I[e]=t.evaluateIdentifier(r,{name:e});n.parameters=I}return n}function f(n,t,r=null){for(let w in n)if(w.toLowerCase()===t.toLowerCase())return n[w];return r}function pt(n){if(n===null)return null;let t={type:f(n,"type",""),name:f(n,"name","")};if(t.type==="range")t.range=f(n,"range",[]);else{t.codedValues=[];for(let r of f(n,"codedValues",[]))t.codedValues.push({name:f(r,"name",""),code:f(r,"code",null)})}return t}function Se(n){if(n===null)return null;let t={},r=f(n,"wkt");r!==null&&(t.wkt=r);let w=f(n,"wkid");return w!==null&&(t.wkid=w),t}function yt(n){if(n===null)return null;let t={hasZ:f(n,"hasz",!1),hasM:f(n,"hasm",!1)},r=f(n,"spatialreference");r!=null&&(t.spatialReference=Se(r));let w=f(n,"x",null);if(w!==null)return t.x=w,t.y=f(n,"y",null),t.hasZ&&(t.z=f(n,"z",null)),t.hasM&&(t.m=f(n,"m",null)),t;let I=f(n,"rings",null);if(I!==null)return t.rings=I,t;let e=f(n,"paths",null);if(e!==null)return t.paths=e,t;let i=f(n,"points",null);if(i!==null)return t.points=i,t;for(let a of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let l=f(n,a,null);l!==null&&(t[a]=l)}return t}function bt(n,t){for(let r of t)if(r===n)return!0;return!1}function Ft(n){return!!n.layerDefinition&&!!n.featureSet&&bt(n.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(n.layerDefinition.fields)!==!1&&A(n.featureSet.features)!==!1}function ee(n){return n?.toLowerCase()==="utc"?"UTC":n?.toLowerCase()==="unknown"?"Unknown":n}async function Tt(n,t,r,w,I,e,i){let a=await n.getFeatureSetInfo();if((a?.layerId??null)===null||!I.layerIdLookup.get(a.layerId))return null;let l=n.serviceUrl().replace(/\/FeatureServer/i,"/UtilityNetworkServer"),m=[];switch(r){case"connected":m.push("connectivity"),m.push("junction-edge-from-connectivity"),m.push("junction-edge-to-connectivity"),m.push("junction-edge-midspan-connectivity"),m.push("junction-junction-connectivity");break;case"container":case"content":m.push("containment");break;case"structure":case"attached":m.push("attachment");break;case"junctionedge":m.push("junction-edge-from-connectivity"),m.push("junction-edge-to-connectivity");break;case"midspan":m.push("junction-edge-midspan-connectivity");break;default:throw new y(e,p.InvalidParameter,i)}let d=null,s=!1;if(w!==null&&w!==""&&w!==void 0){for(let u of I.terminals)u.terminalName===w&&(d=u.terminalId);d===null&&(s=!0)}let o=[];if(!s){let u=new O(q({globalId:t.field(n.globalIdField),networkSourceId:I.layerIdLookup.get(a.layerId).sourceId},d?{terminalId:d}:"")),x=await ft(l,new mt({types:m,elements:[u]})),v=0;for(let g of x.associations){let T=null,H="",M="";if(g.fromNetworkElement?.globalId===u.globalId?(T=g.toNetworkElement,M="to"):g.toNetworkElement?.globalId===u.globalId&&(T=g.fromNetworkElement,M="from"),!T)continue;switch(r){case"attached":if(g.associationType!=="attachment"||M!=="to")continue;break;case"structure":if(g.associationType!=="attachment"||M!=="from")continue;break;case"container":if(g.associationType!=="containment"||M!=="from")continue;break;case"content":if(g.associationType!=="containment"||M!=="to")continue;break;case"connected":break;case"junctionedge":g.associationType==="junction-edge-to-connectivity"?H="to":g.associationType==="junction-edge-from-connectivity"&&(H="from");break;case"midspan":if(g.associationType!=="junction-edge-midspan-connectivity")continue}let K=I.sourceIdLookup.get(T.networkSourceId)?.className??"";o.push(new Ye({geometry:null,attributes:{objectId:v++,globalId:T.globalId,percentAlong:g.percentAlong??0,isContentVisible:g.isContentVisible?0:1,className:K,side:H}}))}}let c=new Fe({source:o,geometryType:null,objectIdField:"objectId",globalIdField:"globalId",fields:[new Z({name:"objectId",alias:"objectId",type:"oid"}),new Z({name:"globalId",alias:"globalId",type:"global-id"}),new Z({name:"percentAlong",alias:"percentAlong",type:"double"}),new Z({name:"side",alias:"side",type:"string"}),new Z({name:"isContentVisible",alias:"isContentVisible",type:"integer"}),new Z({name:"className",alias:"className",type:"string"})]});return oe(c)}function Hn(n){n.mode==="async"&&(n.functions.timezone=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,1,2,t,r),Je(e[0])||le(e[0]))return"Unknown";if(C(e[0])){if(await e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?ee("unknown"):ee(e[0].dateFieldsTimeZone);if(!(e[1]instanceof U)||e[1].hasField("type")===!1)throw new y(t,p.InvalidParameter,r);let l=e[1].field("type");if(R(l)===!1)throw new y(t,p.InvalidParameter,r);switch(S(l).toLowerCase()){case"preferredtimezone":return ee(e[0].preferredTimeZone);case"editfieldsinfo":return ee(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return ee(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&R(e[1].field("fieldname")))return ee(e[0].fieldTimeZone(S(e[1].field("fieldname"))))}throw new y(t,p.InvalidParameter,r)}let i=Ge(e[0],be(t));if(i===null)return null;let a=i.timeZone;return a==="system"?Ue.systemTimeZoneCanonicalName:a.toLowerCase()==="utc"?"UTC":a.toLowerCase()==="unknown"?"Unknown":a})},n.functions.sqltimestamp=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{D(e,1,3,t,r);let i=e[0];if(he(i)){if(e.length===1)return i.toSQLWithKeyword();if(e.length===2)return i.changeTimeZone(S(e[1])).toSQLWithKeyword();throw new y(t,p.InvalidParameter,r)}if(le(i))return i.toSQLWithKeyword();if(C(i)){if(e.length!==3)throw new y(t,p.InvalidParameter,r);await i.load();let a=S(e[1]);if(le(e[2]))return e[2].toSQLWithKeyword();if(he(e[2])===!1)throw new y(t,p.InvalidParameter,r);let l=i.fieldTimeZone(a);return l==null?e[2].toSQLWithKeyword():e[2].changeTimeZone(l).toSQLWithKeyword()}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"sqltimestamp",min:2,max:4}),n.functions.featuresetbyid=function(t,r){return n.standardFunctionAsync(t,r,(w,I,e)=>{if(D(e,2,4,t,r),Ie(e[0])){let i=S(e[1]),a=j(e[2],null),l=B(j(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new y(t,p.InvalidParameter,r);return e[0].featureSetById(i,l,a)}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"featuresetbyid",min:2,max:4}),n.functions.getfeatureset=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,1,2,t,r),ie(e[0])){let i=j(e[1],"datasource");return i===null&&(i="datasource"),i=S(i).toLowerCase(),lt(e[0].fullSchema(),i,t.lrucache,t.interceptor,t.spatialReference??null)}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"getfeatureset",min:1,max:2}),n.functions.featuresetbyportalitem=function(t,r){return n.standardFunctionAsync(t,r,(w,I,e)=>{if(D(e,2,5,t,r),e[0]===null)throw new y(t,p.PortalRequired,r);if(e[0]instanceof Ke){let d=S(e[1]),s=S(e[2]),o=j(e[3],null),c=B(j(e[4],!0));if(o===null&&(o=["*"]),A(o)===!1)throw new y(t,p.InvalidParameter,r);let u;return u=t.services?.portal?t.services.portal:ve.getDefault(),u=_e(e[0],u),Ne(d,s,t.spatialReference??null,o,c,u,t.lrucache,t.interceptor)}if(R(e[0])===!1)throw new y(t,p.PortalRequired,r);let i=S(e[0]),a=S(e[1]),l=j(e[2],null),m=B(j(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new y(t,p.InvalidParameter,r);return Ne(i,a,t.spatialReference??null,l,m,t.services?.portal??ve.getDefault(),t.lrucache,t.interceptor)})},n.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),n.functions.featuresetbyname=function(t,r){return n.standardFunctionAsync(t,r,(w,I,e)=>{if(D(e,2,4,t,r),Ie(e[0])){let i=S(e[1]),a=j(e[2],null),l=B(j(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new y(t,p.InvalidParameter,r);return e[0].featureSetByName(i,l,a)}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"featuresetbyname",min:2,max:4}),n.functions.featureset=function(t,r){return n.standardFunction(t,r,(w,I,e)=>{D(e,1,1,t,r);let i={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(R(e[0])){let a=JSON.parse(e[0]);a.layerDefinition!==void 0?(i.layerDefinition=a.layerDefinition,i.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(i.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(i.featureSet.features=a.features,i.featureSet.geometryType=a.geometryType,i.layerDefinition.geometryType=i.featureSet.geometryType,i.layerDefinition.objectIdField=a.objectIdFieldName??"",i.layerDefinition.typeIdField=a.typeIdFieldName,i.layerDefinition.globalIdField=a.globalIdFieldName,i.layerDefinition.fields=a.fields,a.spatialReference&&(i.layerDefinition.spatialReference=a.spatialReference))}else{if(!(e[0]instanceof U))throw new y(t,p.InvalidParameter,r);{let a=JSON.parse(e[0].castToText(!0)),l=f(a,"layerdefinition");if(l!==null){i.layerDefinition.geometryType=f(l,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.globalIdField=f(l,"globalidfield",""),i.layerDefinition.objectIdField=f(l,"objectidfield",""),i.layerDefinition.typeIdField=f(l,"typeidfield",""),i.layerDefinition.hasZ=f(l,"hasz",!1)===!0,i.layerDefinition.hasM=f(l,"hasm",!1)===!0;let m=f(l,"spatialreference");m&&(i.layerDefinition.spatialReference=Se(m));let d=[];for(let o of f(l,"fields",[])){let c={name:f(o,"name",""),alias:f(o,"alias",""),type:f(o,"type",""),nullable:f(o,"nullable",!0),editable:f(o,"editable",!0),length:f(o,"length",null),domain:pt(f(o,"domain"))};d.push(c)}i.layerDefinition.fields=d;let s=f(a,"featureset");if(s){let o={};for(let c of d)o[c.name.toLowerCase()]=c.name;for(let c of f(s,"features",[])){let u={},x=f(c,"attributes",{});for(let v in x)u[o[v.toLowerCase()]]=x[v];i.featureSet.features.push({attributes:u,geometry:yt(f(c,"geometry"))})}}}else{i.layerDefinition.hasZ=f(a,"hasz",!1)===!0,i.layerDefinition.hasM=f(a,"hasm",!1)===!0,i.layerDefinition.geometryType=f(a,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.objectIdField=f(a,"objectidfieldname",""),i.layerDefinition.typeIdField=f(a,"typeidfieldname","");let m=f(a,"spatialreference");m&&(i.layerDefinition.spatialReference=Se(m));let d=[],s=f(a,"fields",null);if(!A(s))throw new y(t,p.InvalidParameter,r);for(let u of s){let x={name:f(u,"name",""),alias:f(u,"alias",""),type:f(u,"type",""),nullable:f(u,"nullable",!0),editable:f(u,"editable",!0),length:f(u,"length",null),domain:pt(f(u,"domain"))};d.push(x)}i.layerDefinition.fields=d;let o={};for(let u of d)o[u.name.toLowerCase()]=u.name;let c=f(a,"features",null);if(A(c))for(let u of c){let x={},v=f(u,"attributes",{});for(let g in v)x[o[g.toLowerCase()]]=v[g];i.featureSet.features.push({attributes:x,geometry:yt(f(u,"geometry",null))})}else c=null,i.featureSet.features=c}}}if(Ft(i)===!1)throw new y(t,p.InvalidParameter,r);return i.layerDefinition.geometryType||(i.layerDefinition.geometryType="esriGeometryNull"),rt.create(i,t.spatialReference)})},n.signatures.push({name:"featureset",min:1,max:1}),n.functions.filter=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,2,2,t,r),A(e[0])||J(e[0])){let i=[],a,l=e[0];if(l instanceof Oe&&(l=l.toArray()),!ze(e[1]))throw new y(t,p.InvalidParameter,r);a=e[1].createFunction(t);for(let m of l){let d=a(m);$e(d)?await d===!0&&i.push(m):d===!0&&i.push(m)}return i}if(C(e[0])){let i=await e[0].load(),a=N.create(e[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),l=a.getVariables();if(l.length>0){let m={};for(let d of l)m[d]=n.evaluateIdentifier(t,{name:d});a.parameters=m}return new de({parentfeatureset:e[0],whereclause:a})}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"filter",min:2,max:2}),n.functions.orderby=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,2,2,t,r),C(e[0])){let i=new et(e[1]);return new tt({parentfeatureset:e[0],orderbyclause:i})}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"orderby",min:2,max:2}),n.functions.top=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,2,2,t,r),C(e[0]))return new it({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return Q(e[1])>=e[0].length?e[0].slice():e[0].slice(0,Q(e[1]));if(J(e[0]))return Q(e[1])>=e[0].length()?e[0].slice():e[0].slice(0,Q(e[1]));throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"top",min:2,max:2}),n.functions.first=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,1,1,t,r),C(e[0])){let i=await e[0].first(w.abortSignal);if(i!==null){let a=He.createFromGraphicLikeObject(i.geometry,i.attributes,e[0],t.timeZone);return a._underlyingGraphic=i,a}return i}return A(e[0])?e[0].length===0?null:e[0][0]:J(e[0])?e[0].length()===0?null:e[0].get(0):null})},n.signatures.push({name:"first",min:1,max:1}),n.functions.attachments=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{D(e,1,2,t,r);let i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof U){if(e[1].hasField("minsize")&&(i.minsize=Q(e[1].field("minsize"))),e[1].hasField("metadata")&&(i.returnMetadata=B(e[1].field("metadata"))),e[1].hasField("maxsize")&&(i.maxsize=Q(e[1].field("maxsize"))),e[1].hasField("types")){let a=We(e[1].field("types"),!1);a.length>0&&(i.types=a)}}else if(e[1]!==null)throw new y(t,p.InvalidParameter,r)}if(ie(e[0])){let a=e[0]._layer,l;if(C(a))l=a;else{if(a==null||!ge(a))return[];l=oe(a,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)}return await l.load(),l.queryAttachments(e[0].field(l.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata)}if(e[0]===null)return[];throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"attachments",min:1,max:2}),n.functions.featuresetbyrelationshipname=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{D(e,2,4,t,r);let i=e[0],a=S(e[1]),l=j(e[2],null),m=B(j(e[3],!0));if(l===null&&(l=["*"]),A(l)===!1)throw new y(t,p.InvalidParameter,r);if(e[0]===null)return null;if(!ie(e[0]))throw new y(t,p.InvalidParameter,r);let d=i._layer,s;if(C(d))s=d;else{if(d==null||!ge(d))return null;s=oe(d,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)}s=await s.load();let o=s.relationshipMetaData().filter(g=>g.name===a);if(o.length===0)return null;if(o[0].relationshipTableId!==void 0&&o[0].relationshipTableId!==null&&o[0].relationshipTableId>-1)return st(s,o[0],i.field(s.objectIdField),s.spatialReference,l,m,t.lrucache,t.interceptor);let c=s.serviceUrl();if(!c)return null;c=c.charAt(c.length-1)==="/"?c+o[0].relatedTableId.toString():c+"/"+o[0].relatedTableId.toString();let u=await ot(c,s.spatialReference,l,m,t.lrucache,t.interceptor);await u.load();let x=u.relationshipMetaData();if(x=x.filter(g=>g.id===o[0].id),i.hasField(o[0].keyField)===!1||i.field(o[0].keyField)===null){let g=await s.getFeatureByObjectId(i.field(s.objectIdField),[o[0].keyField]);if(g){let T=N.create(x[0].keyField+"= @id",{fieldsIndex:u.getFieldsIndex(),timeZone:u.dateFieldsTimeZoneDefaultUTC});return T.parameters={id:g.attributes[o[0].keyField]},u.filter(T)}return new nt({parentfeatureset:u})}let v=N.create(x[0].keyField+"= @id",{fieldsIndex:u.getFieldsIndex(),timeZone:u.dateFieldsTimeZoneDefaultUTC});return v.parameters={id:i.field(o[0].keyField)},u.filter(v)})},n.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),n.functions.featuresetbyassociation=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{D(e,2,3,t,r);let i=e[0],a=S(j(e[1],"")).toLowerCase(),l=R(e[2])?S(e[2]):null;if(e[0]===null)return null;if(!ie(e[0]))throw new y(t,p.InvalidParameter,r);let m=i._layer;if(m instanceof Fe&&(m=oe(m,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),m===null||C(m)===!1)return null;await m.load();let d=m.serviceUrl(),s=await at(d,t.spatialReference,!0);if(s.unVersion>=8)return await Tt(m,i,a,l,s,t,r);let o=s.associations,c=null,u=null,x=!1;if(l!==null&&l!==""&&l!==void 0){for(let F of s.terminals)F.terminalName===l&&(u=F.terminalId);u===null&&(x=!0)}let v=o.getFieldsIndex(),g=v.get("TOGLOBALID").name,T=v.get("FROMGLOBALID").name,H=v.get("TOTERMINALID").name,M=v.get("FROMTERMINALID").name,K=v.get("FROMNETWORKSOURCEID").name,te=v.get("TONETWORKSOURCEID").name,_=v.get("ASSOCIATIONTYPE").name,wt=v.get("ISCONTENTVISIBLE").name,gt=v.get("OBJECTID").name;for(let F of m.fields)if(F.type==="global-id"){c=i.field(F.name);break}let V=null,xe=new G(new Z({name:"percentalong",alias:"percentalong",type:"double"}),N.create("0",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),Ae=new G(new Z({name:"side",alias:"side",type:"string"}),N.create("''",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),L="globalid",ke="globalId",Ce={};for(let F in s.lkp)Ce[F]=s.lkp[F].sourceId;let z=new Xe(new Z({name:"classname",alias:"classname",type:"string"}),null,Ce),h="";switch(a){case"midspan":{h=`((${g}='${c}') OR ( ${T}='${c}')) AND (${_} IN (5))`,z.codefield=N.create(`CASE WHEN (${g}='${c}') THEN ${K} ELSE ${te} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});let F=se($.findField(o.fields,T));F.name=L,F.alias=L,V=new G(F,N.create(`CASE WHEN (${T}='${c}') THEN ${g} ELSE ${T} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),xe=s.unVersion>=4?new ue($.findField(o.fields,v.get("PERCENTALONG").name)):new G(new Z({name:"percentalong",alias:"percentalong",type:"double"}),N.create("0",{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"junctionedge":{h=`((${g}='${c}') OR ( ${T}='${c}')) AND (${_} IN (4,6))`,z.codefield=N.create(`CASE WHEN (${g}='${c}') THEN ${K} ELSE ${te} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});let F=se($.findField(o.fields,T));F.name=L,F.alias=L,V=new G(F,N.create(`CASE WHEN (${T}='${c}') THEN ${g} ELSE ${T} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC})),Ae=new G(new Z({name:"side",alias:"side",type:"string"}),N.create(`CASE WHEN (${_}=4) THEN 'from' ELSE 'to' END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"connected":{let F=`${g}='@T'`,je=`${T}='@T'`;u!==null&&(F+=` AND ${H}=@A`,je+=` AND ${M}=@A`),h="(("+F+") OR ("+je+"))",h=ne(h,"@T",c??""),F=ne(F,"@T",c??""),u!==null&&(F=ne(F,"@A",u.toString()),h=ne(h,"@A",u.toString())),z.codefield=N.create("CASE WHEN "+F+` THEN ${K} ELSE ${te} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC});let me=se($.findField(o.fields,T));me.name=L,me.alias=L,V=new G(me,N.create("CASE WHEN "+F+` THEN ${T} ELSE ${g} END`,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}));break}case"container":h=`${g}='${c}' AND ${_} = 2`,u!==null&&(h+=` AND ${H} = `+u.toString()),z.codefield=K,h="( "+h+" )",V=new re($.findField(o.fields,T),L,L);break;case"content":h=`(${T}='${c}' AND ${_} = 2)`,u!==null&&(h+=` AND ${M} = `+u.toString()),z.codefield=te,h="( "+h+" )",V=new re($.findField(o.fields,g),L,L);break;case"structure":h=`(${g}='${c}' AND ${_} = 3)`,u!==null&&(h+=` AND ${H} = `+u.toString()),z.codefield=K,h="( "+h+" )",V=new re($.findField(o.fields,T),L,ke);break;case"attached":h=`(${T}='${c}' AND ${_} = 3)`,u!==null&&(h+=` AND ${M} = `+u.toString()),z.codefield=te,h="( "+h+" )",V=new re($.findField(o.fields,g),L,ke);break;default:throw new y(t,p.InvalidParameter,r)}return x&&(h="1 <> 1"),new $({parentfeatureset:o,adaptedFields:[new ue($.findField(o.fields,gt)),new ue($.findField(o.fields,wt)),V,Ae,z,xe],extraFilter:h?N.create(h,{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}):null})})},n.signatures.push({name:"featuresetbyassociation",min:2,max:6}),n.functions.groupby=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,3,3,t,r),!C(e[0]))throw new y(t,p.InvalidParameter,r);let i=await e[0].load(),a=[],l=[],m=!1,d=[];if(R(e[1]))d.push(e[1]);else if(e[1]instanceof U)d.push(e[1]);else if(A(e[1]))d=e[1];else{if(!J(e[1]))throw new y(t,p.InvalidParameter,r);d=e[1].toArray()}for(let s of d)if(R(s)){let o=N.create(S(s),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),c=Te(o)===!0?S(s):"%%%%FIELDNAME";a.push({name:c,expression:o}),c==="%%%%FIELDNAME"&&(m=!0)}else{if(!(s instanceof U))throw new y(t,p.InvalidParameter,r);{let o=s.hasField("name")?s.field("name"):"%%%%FIELDNAME",c=s.hasField("expression")?s.field("expression"):"";if(o==="%%%%FIELDNAME"&&(m=!0),!o)throw new y(t,p.InvalidParameter,r);a.push({name:o,expression:N.create(c||o,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(d=[],R(e[2]))d.push(e[2]);else if(A(e[2]))d=e[2];else if(J(e[2]))d=e[2].toArray();else{if(!(e[2]instanceof U))throw new y(t,p.InvalidParameter,r);d.push(e[2])}for(let s of d){if(!(s instanceof U))throw new y(t,p.InvalidParameter,r);{let o=s.hasField("name")?s.field("name"):"",c=s.hasField("statistic")?s.field("statistic"):"",u=s.hasField("expression")?s.field("expression"):"";if(!o||!c||!u)throw new y(t,p.InvalidParameter,r);l.push({name:o,statistic:c.toLowerCase(),expression:N.create(u,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(m){let s={};for(let c of i.fields)s[c.name.toLowerCase()]=1;for(let c of a)c.name!=="%%%%FIELDNAME"&&(s[c.name.toLowerCase()]=1);for(let c of l)c.name!=="%%%%FIELDNAME"&&(s[c.name.toLowerCase()]=1);let o=0;for(let c of a)if(c.name==="%%%%FIELDNAME"){for(;s["field_"+o.toString()]===1;)o++;s["field_"+o.toString()]=1,c.name="FIELD_"+o.toString()}}for(let s of a)De(s.expression,n,t);for(let s of l)De(s.expression,n,t);return e[0].groupby(a,l)})},n.signatures.push({name:"groupby",min:3,max:3}),n.functions.distinct=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(C(e[0])){D(e,2,2,t,r);let i=await e[0].load(),a=[],l=[];if(R(e[1]))l.push(e[1]);else if(e[1]instanceof U)l.push(e[1]);else if(A(e[1]))l=e[1];else{if(!J(e[1]))throw new y(t,p.InvalidParameter,r);l=e[1].toArray()}let m=!1;for(let d of l)if(R(d)){let s=N.create(S(d),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o=Te(s)===!0?S(d):"%%%%FIELDNAME";a.push({name:o,expression:s}),o==="%%%%FIELDNAME"&&(m=!0)}else{if(!(d instanceof U))throw new y(t,p.InvalidParameter,r);{let s=d.hasField("name")?d.field("name"):"%%%%FIELDNAME",o=d.hasField("expression")?d.field("expression"):"";if(s==="%%%%FIELDNAME"&&(m=!0),!s)throw new y(t,p.InvalidParameter,r);a.push({name:s,expression:N.create(o||s,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(m){let d={};for(let o of i.fields)d[o.name.toLowerCase()]=1;for(let o of a)o.name!=="%%%%FIELDNAME"&&(d[o.name.toLowerCase()]=1);let s=0;for(let o of a)if(o.name==="%%%%FIELDNAME"){for(;d["field_"+s.toString()]===1;)s++;d["field_"+s.toString()]=1,o.name="FIELD_"+s.toString()}}for(let d of a)De(d.expression,n,t);return e[0].groupby(a,[])}return ht(e)})},n.functions.getfeaturesetinfo=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,1,1,t,r),!C(e[0]))return null;let i=await e[0].getFeatureSetInfo();return i?U.convertObjectToArcadeDictionary({layerId:i.layerId,layerName:i.layerName,itemId:i.itemId,serviceLayerUrl:i.serviceLayerUrl,webMapLayerId:i.webMapLayerId??null,webMapLayerTitle:i.webMapLayerTitle??null,className:null,objectClassId:null},be(t),!1,!1):null})},n.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),n.functions.filterbysubtypecode=function(t,r){return n.standardFunctionAsync(t,r,async(w,I,e)=>{if(D(e,2,2,t,r),C(e[0])){let i=await e[0].load(),a=e[1];if(!Me(a))throw new y(t,p.InvalidParameter,r);if(i.subtypeField){let m=N.create(`${i.subtypeField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new de({parentfeatureset:e[0],whereclause:m})}if(i.typeIdField===null||i.typeIdField==="")throw new y(t,p.FeatureSetDoesNotHaveSubtypes,r);let l=N.create(`${i.typeIdField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new de({parentfeatureset:e[0],whereclause:l})}throw new y(t,p.InvalidParameter,r)})},n.signatures.push({name:"filterbysubtypecode",min:2,max:2}))}export{Hn as registerFunctions};
