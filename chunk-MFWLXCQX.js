import{a as at}from"./chunk-R7MBZ4JV.js";import"./chunk-DSVUPQIZ.js";import{a as tt,b as rt}from"./chunk-3S7MXQDG.js";import{b as Be}from"./chunk-N52QLLCJ.js";import{a as K,b as Xe,c as Ye,d as et}from"./chunk-WTFHZZK4.js";import{a as it,b as W}from"./chunk-BINXAYMP.js";import"./chunk-ZGGQ3WAU.js";import{a as nt}from"./chunk-W3ZNQXQB.js";import"./chunk-QO4VV4M2.js";import{k as Qe}from"./chunk-I775TR7R.js";import"./chunk-FQTXYWH5.js";import"./chunk-KLXERNY4.js";import"./chunk-GWZ4F32U.js";import"./chunk-VCEKZDML.js";import{j as Ge,k as Ve,l as ke}from"./chunk-NEHEP3WK.js";import{a as de}from"./chunk-OBYVOHC5.js";import"./chunk-UO5Q6C3A.js";import"./chunk-IRO4K544.js";import"./chunk-BNH7YXHY.js";import{s as st,t as ot,u as H}from"./chunk-2XYAAYOE.js";import"./chunk-7JW7DYCQ.js";import"./chunk-UP67O2XH.js";import"./chunk-6CO4643W.js";import"./chunk-TMY7UIU7.js";import"./chunk-BPX3YT3K.js";import"./chunk-LXEWGICX.js";import"./chunk-NIYDRLW4.js";import"./chunk-4K47EN3B.js";import"./chunk-FGY3YBPM.js";import"./chunk-EDOVNTC7.js";import"./chunk-FSWSNKJD.js";import"./chunk-MVDZB4AK.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FGEB67EG.js";import"./chunk-YEXMIDOT.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-K7YQAHQ7.js";import"./chunk-J6YGDWJF.js";import"./chunk-YQNUGDFH.js";import"./chunk-QCZ3ZIGQ.js";import{a as Ae,b as Re}from"./chunk-KBSNSGCC.js";import"./chunk-RZU6EEB3.js";import"./chunk-KBDKZSTB.js";import{a as Ce}from"./chunk-4MB4OYWM.js";import{a as _e}from"./chunk-KQEHVUTS.js";import{a as be}from"./chunk-TO337MWO.js";import{a as Ie}from"./chunk-WKYBGWI5.js";import{b as je,c as z}from"./chunk-QDXM6RGS.js";import{c as Pe}from"./chunk-E3UR4EIC.js";import{a as Ue}from"./chunk-4Y623NMU.js";import{b as Ne,c as Q}from"./chunk-PTAJ247D.js";import{a as Me}from"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import{a as Se}from"./chunk-R5HXEPJ3.js";import{a as ue}from"./chunk-DZBH24YT.js";import{a as Ze}from"./chunk-7E723FQO.js";import{b as $e,c as Je,d as Ke,f as We,g as He}from"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-HUKD3ORH.js";import{A as Oe,D as Ee,t as xe}from"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import{a as qe}from"./chunk-WT3XCHGP.js";import{a as pe}from"./chunk-CUJB6F5L.js";import{a as lt}from"./chunk-5NHJFBCW.js";import{a as De}from"./chunk-AZ7O5NEQ.js";import"./chunk-K27EVVBH.js";import"./chunk-AOQ57NDM.js";import"./chunk-VMECOA4F.js";import"./chunk-KOUNUVF6.js";import"./chunk-PHODKV66.js";import"./chunk-JPMGMA4B.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import{g as Le}from"./chunk-ZPQDV27Y.js";import{a as Fe,b as Te}from"./chunk-SIMI7FRM.js";import"./chunk-YQGS4EZO.js";import{a as we}from"./chunk-3REMXE4W.js";import{p as ge}from"./chunk-4ABKPPKG.js";import"./chunk-PMVQ5DJK.js";import"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import"./chunk-L2WNUKLP.js";import"./chunk-XITT4JU2.js";import{b as ve}from"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import"./chunk-KAMRW6HF.js";import"./chunk-6DGDLLNL.js";import"./chunk-UWWWQ44M.js";import"./chunk-BHB4UQZT.js";import"./chunk-DJW5LMRG.js";import"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import{b as he}from"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import{a as k}from"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import{a as ce}from"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import{a as fe}from"./chunk-JTDXB5TK.js";import"./chunk-CWUY5SXW.js";import"./chunk-KD27XIJC.js";import{r as ye,y as me}from"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import"./chunk-RWCIDBNQ.js";import"./chunk-EM35R6FY.js";import"./chunk-6B5XFA6F.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import{e as $,f as J,j as ze}from"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-NRBJLISB.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import"./chunk-6RZAM42M.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import"./chunk-JGEVVXD4.js";import{p as P}from"./chunk-B3FO6PT7.js";import"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import"./chunk-LXFQWIWE.js";import"./chunk-QT6UNBJP.js";import"./chunk-SLAWDKDA.js";import{c as oe,d as ae,h as ne}from"./chunk-MWSXMSWY.js";import"./chunk-JRCKELO6.js";import"./chunk-KJULKTB5.js";import"./chunk-LACL4BQ2.js";import{c as T}from"./chunk-YR2HD3ZC.js";import"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import"./chunk-EXJYW3PC.js";import"./chunk-SXQPBCOX.js";import"./chunk-LFH24RLM.js";import{n as le}from"./chunk-Z5Q7KLA4.js";import{a as S}from"./chunk-X4LNX4BR.js";import"./chunk-4XZ6X7MQ.js";import"./chunk-WLHY3MMA.js";import"./chunk-KGVXGH6H.js";import"./chunk-ARRCN5K3.js";import"./chunk-LXQPIAN7.js";import"./chunk-FTDD7QBB.js";import"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import"./chunk-R4A63S45.js";import{E as j,h as se,w as V}from"./chunk-ETE32IYO.js";import{w as ie}from"./chunk-ONUGDWDK.js";import{f as I}from"./chunk-SG7CQU4O.js";import{H as s,k as A}from"./chunk-QHVIRF5H.js";import{C as G,I as m}from"./chunk-WZDN6K3C.js";import{a as i}from"./chunk-QGVBCWUY.js";import"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import{a as M}from"./chunk-IYZFKXJ6.js";import{D as re,b as ee,y as te}from"./chunk-CKJ56T2Q.js";import"./chunk-SNFOAZZQ.js";import"./chunk-F6JAWRPN.js";import{b as Y,r as v,t as d}from"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import{a as h,b as g}from"./chunk-N2WTMF3X.js";function R({associatedLayer:e,serviceUpdateTimeStamp:t}){let r=e?.editingInfo?.lastEditDate,a=e?.serverGens,n=r!=null,l=t!=null,p=n&&l&&t.lastUpdate!==r.getTime();return n&&(p||!l&&a?.minServerGen!==a?.serverGen)}var pt=e=>{let t=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){let r=this.associatedLayer?.timeInfo;if(r==null)return null;let a=r.clone();return J(a,this.fieldsIndex),a}set timeInfo(r){J(r,this.fieldsIndex),this._override("timeInfo",r)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(r){this._override("timeExtent",r)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(r){this._override("timeOffset",r)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(r){this._override("datesInUnknownTimezone",r)}async loadTimeInfoFromService(r){let{serviceTimeInfo:a}=this;if(a==null)return;let{startTimeField:n,endTimeField:l}=a;if(n==null&&l==null||R({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;let p=async b=>{let c=null;try{c=(await this.fetchStatistics?.(b,r))?.stats}catch{}if(c==null)return null;let{minTimeStr:L,min:q,maxTimeStr:N,max:U}=c,E=b===n?L??q:N??U;return E!=null?new Date(E):null},[u,y]=await Promise.all([p(n),p(l)]);if(n!=null&&u==null||l!=null&&y==null)return;let f=new k({start:u,end:y});this.setAtOrigin("timeInfo",new Q({endField:l,startField:n,fullTimeExtent:f}),"service")}};return i([s({type:Q,json:{read:!1,write:!1}})],t.prototype,"timeInfo",null),i([s({type:k,json:{read:!1,write:!1}})],t.prototype,"timeExtent",null),i([s({type:Ne,json:{read:!1,write:!1}})],t.prototype,"timeOffset",null),i([s({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"datesInUnknownTimezone",null),i([s({type:x,readOnly:!0,json:{read:{source:"timeInfo"}}})],t.prototype,"serviceTimeInfo",void 0),t=i([m("esri.layers.mixins.TemporalSceneLayer")],t),t},x=class extends I{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};i([s({type:String})],x.prototype,"endTimeField",void 0),i([s({type:String})],x.prototype,"startTimeField",void 0),x=i([m("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],x);var w=class extends I{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};i([s({type:String,json:{read:!0,write:{isRequired:!0}}})],w.prototype,"name",void 0),i([s({type:String,json:{read:!0,write:{isRequired:!0}}})],w.prototype,"field",void 0),i([s({type:[Number],json:{read:!0,write:!0}})],w.prototype,"currentRangeExtent",void 0),i([s({type:[Number],json:{read:!0,write:!0}})],w.prototype,"fullRangeExtent",void 0),i([s({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),w=i([m("esri.layers.support.RangeInfo")],w);var D,Z=D=class extends I.JSONSupportMixin(T.ofType(P)){constructor(e){super(e)}clone(){return new D(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){let t=e?.layer?.spatialReference;return t?this.toArray().map(r=>{if(!t.equals(r.spatialReference)){if(!ye(r.spatialReference,t))return e?.messages?.push(new G("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;let n=new P;me(r,n,t),r=n}let a=r.toJSON(e);return delete a.spatialReference,a}).filter(r=>r!=null):(e?.messages?.push(new G("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(r=>r.toJSON(e)))}static fromJSON(e,t){let r=new D;return e.forEach(a=>r.add(P.fromJSON(a,t))),r}};Z=D=i([m("esri.layers.support.PolygonCollection")],Z);var O=Z;var B,F=B=class extends I{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new O,this._geometriesSource=null}initialize(){this.addHandles(oe(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,ne))}readGeometries(e,t,r){Array.isArray(e)?this.geometries=O.fromJSON(e,r):this._geometriesSource={url:se(e,r),context:r}}async loadGeometries(e,t){if(this._geometriesSource==null)return;let{url:r,context:a}=this._geometriesSource,n=await j(r,{responseType:"json",signal:t?.signal}),l=e.toJSON(),p=n.data.map(u=>g(h({},u),{spatialReference:l}));this.geometries=O.fromJSON(p,a),this._geometriesSource=null}clone(){let e=new B({geometries:Y(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};i([s({type:["disjoint","contains"],nonNullable:!0,json:{write:{isRequired:!0}}})],F.prototype,"spatialRelationship",void 0),i([s({type:O,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),at({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],F.prototype,"geometries",void 0),i([S(["web-scene","portal-item"],"geometries")],F.prototype,"readGeometries",null),F=B=i([m("esri.layers.support.SceneFilter")],F);var dt=F;async function ut({fieldName:e,statisticsInfo:t,errorContext:r,fieldsIndex:a,path:n,customParameters:l,apiKey:p,signal:u}){if(t==null)throw new d(`${r}:no-cached-statistics`,"Cached statistics are not available for this layer");let y=a.get(e);if(y==null)throw new d(`${r}:field-unexisting`,`Field '${e}' does not exist on the layer`);let f=t.find(L=>L.name===y.name);if(f==null)throw new d(`${r}:no-cached-statistics`,"Cached statistics for this attribute are not available");let b=ie(n,f.href),{data:c}=await j(b,{query:g(h({f:"json"},l),{token:p}),responseType:"json",signal:u});return c}async function ct(e){let t=[];for(let r of e)r.name.toLowerCase().endsWith(".zip")?t.push(ht(r)):t.push(Promise.resolve(r));return(await Promise.all(t)).flat()}async function ht(e){let{BlobReader:t,ZipReader:r,BlobWriter:a}=await import("./chunk-TRG6HH25.js"),n=[];return(await new r(new t(e)).getEntries()).forEach(p=>{if(p.directory||/^__MACOS/i.test(p.filename))return;let u=new a,y=p.getData?.(u).then(f=>new File([f],p.filename));y&&n.push(y)}),Promise.all(n)}var gt=new Set(["3DObject","Point"]),yt=Ce(),o=class extends pt(Le(it(Ie(Ze(qe(ue(pe(Se(be(fe.ClonableMixin(lt))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new T,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e=="string"?h({url:e},t):e}destroy(){this._set("renderer",null),this.associatedLayer=ee(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let r=this.getField(e)?.domain??null;return this.associatedLayer?xe(this.associatedLayer,e,t,r):r}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get attributeTableTemplate(){return this.associatedLayer?.attributeTableTemplate??null}get fieldsIndex(){return new ce(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:K.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&Oe(this.associatedLayer)}get geometryType(){return vt[this.profile]||"mesh"}set renderer(e){$(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e=e??Be;let{query:t,queryRelated:r,editing:{supportsGlobalId:a,supportsRollbackOnFailure:n,supportsUploadWithItemId:l,supportsGeometryUpdate:p,supportsReturnServiceEditsInSourceSpatialReference:u},data:{supportsZ:y,supportsM:f,isVersioned:b,supportsAttachment:c},operations:{supportsEditing:L,supportsAdd:q,supportsUpdate:N,supportsDelete:U,supportsQuery:E,supportsQueryAttachments:X,supportsAsyncConvert3D:ft}}=e,_=e.operations.supportsChangeTracking,C=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:r,editing:{supportsGlobalId:a,supportsReturnServiceEditsInSourceSpatialReference:u,supportsRollbackOnFailure:n,supportsGeometryUpdate:C&&p,supportsUploadWithItemId:l},data:{supportsAttachment:c,supportsZ:y,supportsM:f,isVersioned:b},operations:{supportsQuery:E,supportsQueryAttachments:X,supportsEditing:L&&_,supportsAdd:C&&q&&_,supportsDelete:C&&U&&_,supportsUpdate:N&&_,supportsAsyncConvert3D:ft}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){let r=t.store.profile;return r!=null&&mt[r]?mt[r]:(v.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){let t=e!=null?e.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(te),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await De(this,{origin:"service"},t),$(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){v.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){let e=new he;return this.geometryType==="mesh"?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r?.features)for(let a of r.features)a.layer=this,a.sourceLayer=this;return r})}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new d("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new d("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){let r=ze(this.fieldsIndex,await tt(this,rt(this)));return Qe(this.parsedUrl?.path??"",this.attributeStorageInfo??[],e,t,r,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){let r=await this.queryCachedAttributes(e,[t]);if(!r||r.length===0)throw new d("scenelayer:feature-not-in-cached-data","Feature not found in cached data");let a=new we;return a.attributes=r[0],a.layer=this,a.sourceLayer=this,a}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){let t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(v.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return Me(this,e)}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new d("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new d("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(W.SAVE_AS,g(h({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"}),e)}async save(){let e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(W.SAVE,e)}async applyEdits(e,t){let{applyEdits:r}=await import("./chunk-MSQRR7WO.js"),a=t;await this.load();let n=this.associatedLayer;if(!n)throw new d(`${this.type}-layer:not-editable`,"Service is not editable");await n.load();let{globalIdField:l}=n,p=!!n.infoFor3D,u=a?.globalIdUsed??!0;if(p&&l==null)throw new d(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(p&&!u)throw new d(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return V(n.url)&&p&&e.deleteFeatures!=null&&l!=null&&(a=g(h({},a),{globalIdToObjectId:await Ee(n,e.deleteFeatures,l)})),r(this,n.source,e,a)}async uploadAssets(e,t){if(await this.load(),this.associatedLayer==null)throw new d(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}on(e,t){return super.on(e,t)}async convertMesh(e,t){t??={};let r=c=>{throw v.getLogger(this).error(".convertMesh()",c.message),c};await this.load(),this.infoFor3D||r(new d("invalid:layer","SceneLayer has no capability for mesh conversion"));let a=await this.extractAndFilterFiles(e),n=a.reduce((c,L)=>Te(this.infoFor3D,L)?c+1:c,0);n===0&&r(new Ge),n>1&&r(new Ve);let l=this.spatialReference,p=t.location??new le({x:0,y:0,z:0,spatialReference:l}),u=p.spatialReference.isGeographic?"local":"georeferenced",{default:y}=await import("./chunk-46L2ODG3.js"),f=y.createWithExternalSource(p,a,{vertexSpace:u,transform:ke(p.spatialReference),unitConversionDisabled:!0}),[b]=await this.uploadAssets([f],g(h({},t),{useAssetOrigin:!t.location}));return b}async extractAndFilterFiles(e){await this.load();let t=this.infoFor3D;return t?(await ct(e)).filter(r=>Fe(t,r)):e}validateLayer(e){if(e.layerType&&!gt.has(e.layerType))throw new d("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new d("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new d("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,a){let n=!1,l=!1;if(r==null)n=!0,l=!0;else{let p=a&&a.isGeographic;switch(r){case"east-north-up":case"earth-centered":n=!0,l=p;break;case"vertex-reference-frame":n=!0,l=!p;break;default:n=!1}}if(!n)throw new d("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!l)throw new d("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){let e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new d("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(let e of this.fields){let t=!!this.attributeStorageInfo?.some(n=>n.name===e.name),r=!!this.associatedLayer?.fields?.some(n=>n&&e.name===n.name),a={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||r,supportsLayerQuery:r};this._fieldUsageInfo[e.name]=a}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(let t of this.associatedLayer.fields){let r=this.getField(t.name);r?(!r.domain&&t.domain&&(r.domain=t.domain.clone()),r.editable=t.editable,r.nullable=t.nullable,r.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;let e=["popupTemplate","popupEnabled"],t=M(this);for(let r=0;r<e.length;r++){let a=e[r],n=this.originIdOf(a),l=this.associatedLayer.originIdOf(a);n<l&&(l===A.SERVICE||l===A.PORTAL_ITEM)&&t.setAtOrigin(a,this.associatedLayer[a],l)}}_applyAssociatedLayerExtentOverride(){let e=this.associatedLayer?.getAtOrigin("fullExtent","service");this.associatedLayer?.infoFor3D==null||!e||!V(this.associatedLayer?.url)||!R(this)||M(this).setAtOrigin("fullExtent",e.clone(),A.SERVICE)}_applyAssociatedLayerPrivileges(){let e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if(["mesh-pyramids","points"].includes(this.profile))try{let{serverUrl:t,layerId:r,portalItem:a}=await de(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e}),n=await nt.FeatureLayer();this.associatedLayer=new n({url:t,customParameters:this.customParameters,layerId:r,portalItem:a}),await this.associatedLayer.load()}catch(t){re(t)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await ae(()=>this.popupEnabled&&this.popupTemplate!=null);let e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?v.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):v.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){let e=this.elevationInfo;this.profile==="mesh-pyramids"&&H(v.getLogger(this),st("Mesh scene layers","relative-to-scene",e)),H(v.getLogger(this),ot("Scene layers",e))}async fetchStatistics(e,t){return await ut({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??"",customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};i([s({types:{key:"type",base:Ae,typeMap:{selection:Re}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],o.prototype,"featureReduction",void 0),i([s({type:[w],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],o.prototype,"rangeInfos",void 0),i([s({json:{read:!1}})],o.prototype,"associatedLayer",void 0),i([s({type:["show","hide"]})],o.prototype,"listMode",void 0),i([s({type:["ArcGISSceneServiceLayer"]})],o.prototype,"operationalLayerType",void 0),i([s({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),i([s(g(h({},yt.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],o.prototype,"fields",void 0),i([s()],o.prototype,"types",null),i([s()],o.prototype,"typeIdField",null),i([s()],o.prototype,"templates",null),i([s()],o.prototype,"formTemplate",null),i([s()],o.prototype,"attributeTableTemplate",null),i([s({readOnly:!0,clonable:!1})],o.prototype,"fieldsIndex",null),i([s({type:_e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],o.prototype,"floorInfo",void 0),i([s(yt.outFields)],o.prototype,"outFields",void 0),i([s({type:K,readOnly:!0,json:{read:!1}})],o.prototype,"nodePages",void 0),i([S("service","nodePages",["nodePages","pointNodePages"])],o.prototype,"readNodePages",null),i([s({type:[Xe],readOnly:!0})],o.prototype,"materialDefinitions",void 0),i([s({type:[Ye],readOnly:!0})],o.prototype,"textureSetDefinitions",void 0),i([s({type:[et],readOnly:!0})],o.prototype,"geometryDefinitions",void 0),i([s({readOnly:!0})],o.prototype,"serviceUpdateTimeStamp",void 0),i([s({readOnly:!0})],o.prototype,"attributeStorageInfo",void 0),i([s({readOnly:!0})],o.prototype,"statisticsInfo",void 0),i([s({type:T.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],o.prototype,"excludeObjectIds",void 0),i([s({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],o.prototype,"definitionExpression",void 0),i([s({type:dt,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],o.prototype,"filter",void 0),i([s({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],o.prototype,"path",void 0),i([s(He)],o.prototype,"elevationInfo",null),i([s({readOnly:!0,json:{read:!1}})],o.prototype,"effectiveCapabilities",null),i([s({readOnly:!0})],o.prototype,"effectiveEditingEnabled",null),i([s({type:String})],o.prototype,"geometryType",null),i([s(Ke)],o.prototype,"labelsVisible",void 0),i([s({type:[je],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:z},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:z},write:!0}})],o.prototype,"labelingInfo",void 0),i([s(We)],o.prototype,"legendEnabled",void 0),i([s({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){if(typeof e=="number"&&e>=0&&e<=1)return e;let r=t.layerDefinition?.drawingInfo?.transparency;return r!==void 0?ve(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],o.prototype,"opacity",void 0),i([s({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"priority",void 0),i([s({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"semantic",void 0),i([s({types:Pe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],o.prototype,"renderer",null),i([s({json:{read:!1}})],o.prototype,"cachedDrawingInfo",void 0),i([S("service","cachedDrawingInfo")],o.prototype,"readCachedDrawingInfo",null),i([s({readOnly:!0,json:{read:!1}})],o.prototype,"capabilities",null),i([s({type:Boolean,json:{read:!1}})],o.prototype,"editingEnabled",null),i([s({readOnly:!0,json:{write:!1,read:!1}})],o.prototype,"infoFor3D",null),i([s({readOnly:!0,json:{write:!1,read:!1}})],o.prototype,"relationships",null),i([s(Je)],o.prototype,"popupEnabled",void 0),i([s({type:ge,json:{name:"popupInfo",write:!0}})],o.prototype,"popupTemplate",void 0),i([s({readOnly:!0,json:{read:!1}})],o.prototype,"defaultPopupTemplate",null),i([s({type:String,json:{read:!1}})],o.prototype,"objectIdField",void 0),i([S("service","objectIdField",["objectIdField","fields"])],o.prototype,"readObjectIdField",null),i([s({type:String,json:{read:!1}})],o.prototype,"globalIdField",void 0),i([S("service","globalIdField",["globalIdField","fields"])],o.prototype,"readGlobalIdField",null),i([s({readOnly:!0,type:String,json:{read:!1}})],o.prototype,"displayField",null),i([s({type:String,json:{read:!1}})],o.prototype,"profile",void 0),i([S("service","profile",["store.profile"])],o.prototype,"readProfile",null),i([s({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],o.prototype,"normalReferenceFrame",void 0),i([s($e)],o.prototype,"screenSizePerspectiveEnabled",void 0),i([s({json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"serviceItemId",void 0),i([s(Ue)],o.prototype,"useViewTime",null),o=i([m("esri.layers.SceneLayer")],o);var mt={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},vt={"mesh-pyramids":"mesh",points:"point"},Pi=o;export{Pi as default};
