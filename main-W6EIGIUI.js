import{a as PH,b as OH,d as NH}from"./chunk-T2JBGIMX.js";import{a as AH,c as RH}from"./chunk-BYYGFX6P.js";import{a as fH}from"./chunk-43SQECBA.js";import{a as wH,c as bH}from"./chunk-SY264W3E.js";import{b as CH}from"./chunk-YH5BTWVE.js";import{b as TH}from"./chunk-Z6R3XWAW.js";import{b as EH}from"./chunk-WLZYWV3C.js";import{b as DH}from"./chunk-7H5EID2H.js";import{a as xH,c as MH}from"./chunk-Z7TOIN4H.js";import{a as SH,c as IH}from"./chunk-4JQDLFOH.js";import{b as lH}from"./chunk-KGDMQD77.js";import{a as cH,c as uH}from"./chunk-KWHX7JZR.js";import{b as dH}from"./chunk-5HC2BF3R.js";import{a as hH,c as pH}from"./chunk-3QU4Z27K.js";import{a as _u,b as jw,c as zw,f as mH}from"./chunk-OJHTSCVF.js";import{a as gH,c as _H}from"./chunk-WF2YY3ZP.js";import{b as yH}from"./chunk-QKJ5OVCV.js";import{a as fm,b as BM,c as Uw}from"./chunk-ODNMA3LJ.js";import"./chunk-ASTIHUEJ.js";import{b as vH}from"./chunk-6FFLB6O7.js";import"./chunk-B7E6TWPE.js";import{a as da,b as X3,c as J3,d as Hw,f as eH}from"./chunk-VYGAHRQ5.js";import"./chunk-P5PR77YK.js";import{a as mm,b as Bw,c as tH,e as iH}from"./chunk-X6ZOF2KC.js";import{d as Vw}from"./chunk-KVXZQWKR.js";import{a as HM,b as rH,d as nH}from"./chunk-RZAQQBUH.js";import{a as yn,b as gu,c as sH,e as oH}from"./chunk-GYDPJHV2.js";import{a as gm,c as aH}from"./chunk-OCXV64J3.js";import{b as Xl}from"./chunk-V5V6AIWH.js";import{a as VM,b as pm,g as K3}from"./chunk-TP3CYP2E.js";import"./chunk-YHVPPOYO.js";import{a as Q3,c as fu,d as a_,e as Y3,f as _n,g as Pr,h as ua}from"./chunk-DNRMZMJ3.js";import"./chunk-OX3SXBYL.js";import{a as $3,b as Z3,c as FM}from"./chunk-HKZ53RXG.js";import{A as Pw,a as Sw,b as nm,c as cu,d as e3,e as la,f as bM,g as CM,h as as,i as TM,j as t3,k as vo,l as uu,m as EM,n as du,o as i3,p as r3,q as n3,r as s3,s as Aw,t as DM,u as o3,v as xM,w as sm,x as Rw,y as a3,z as l3}from"./chunk-TYMNCBDR.js";import{a as bo,b as kM}from"./chunk-B6M6RVA3.js";import{a as Iw}from"./chunk-XMOJ4BVW.js";import{b as JV,d as j3,e as G3,f as hm,g as q3,h as W3}from"./chunk-KDKEWJOG.js";import{a as z3}from"./chunk-KYSTRHK2.js";import"./chunk-JNLUD3YZ.js";import{a as tV,b as uw}from"./chunk-KRDCB7BJ.js";import{a as NM,b as Lw,c as o_,d as Fw,e as N3,f as ca,g as L3,h as wo,i as F3,j as k3,k as V3,l as H3,m as B3,o as gn,p as kw,q as mu,r as LM,s as U3}from"./chunk-RU2T46FC.js";import{$ as OM,A as lm,B as MM,C as cm,D as hu,E as SM,F as n_,G as b3,H as C3,I as T3,J as E3,K as D3,L as pu,N as x3,O as zd,R as IM,S as Ka,T as Vn,U as um,V as dm,W as M3,X as S3,Y as AM,Z as RM,_ as PM,a as Ud,aa as Hn,b as t_,ba as Gd,c as jd,d as c3,e as i_,f as Ow,g as u3,h as d3,i as h3,j as p3,k as Gi,l as ii,m as om,n as f3,o as g3,p as am,q as _3,r as y3,s as rr,t as Ki,u as r_,v as v3,w as w3,x as te,y as Nw}from"./chunk-3HPBQSX2.js";import{a as P3}from"./chunk-SNUEOKCP.js";import{a as R3}from"./chunk-ZQCWKCV6.js";import{a as s_,b as I3,c as A3}from"./chunk-Q7U5SZXR.js";import{b as O3}from"./chunk-W5TVDNWG.js";import"./chunk-IPMZUQ2D.js";import{b as m3}from"./chunk-QGGZPZNN.js";import{a as ZV,b as QV,c as YV,d as KV}from"./chunk-EW6GNI53.js";import{a as WV,e as $V}from"./chunk-YTT63T5C.js";import{a as XV}from"./chunk-LC2PQWW4.js";import{j as jV}from"./chunk-QTJ73VES.js";import"./chunk-UZ3LPMUO.js";import{b as GV}from"./chunk-24PMLB7F.js";import{b as UV,c as lu,d as Ya}from"./chunk-YAHHW2G4.js";import{b as Mw}from"./chunk-BCDNNCF4.js";import{a as zV}from"./chunk-NPWEUFES.js";import{a as xw}from"./chunk-PQNOJ4XM.js";import{b as qV}from"./chunk-26JWDTE3.js";import{b as rV,c as nV}from"./chunk-GPDZGV7G.js";import"./chunk-R2HHW4XT.js";import"./chunk-LG7DXNE4.js";import{a as BV}from"./chunk-2CZ6E3KR.js";import"./chunk-2TGLTRKB.js";import{a as rm,b as ww}from"./chunk-MOHGYSPI.js";import{b as Ew,d as Qa,e as Dw}from"./chunk-KT2IZTJQ.js";import{b as SV,d as IV,e as AV,f as RV,g as bw,h as FV,i as Cw,j as kV,k as yM,l as VV,n as wM}from"./chunk-7GENY6TF.js";import{a as vM,b as Tw}from"./chunk-2L3Q5NER.js";import{a as au,b as Kl,c as _M}from"./chunk-XCJ4FRLL.js";import{a as zi,b as Za,c as HV}from"./chunk-JNJTT3PL.js";import"./chunk-53FQLWMN.js";import{a as DV,b as xV,c as MV,d as Jg}from"./chunk-PGFEC2N6.js";import"./chunk-5KY2RG7F.js";import"./chunk-XQ4DD6H6.js";import{a as Bd,b as Xg}from"./chunk-IQA3CVAZ.js";import"./chunk-2DH3L3DZ.js";import{a as EV,c as LV}from"./chunk-2VR3WADU.js";import"./chunk-7S2234XQ.js";import{c as im}from"./chunk-5QOQFLF6.js";import{c as e_}from"./chunk-2I3LIA7G.js";import{a as vw}from"./chunk-5DVGZXEZ.js";import"./chunk-QCAQAWPU.js";import"./chunk-MM2DY7NJ.js";import"./chunk-IDCT5OYA.js";import"./chunk-MH7FV4OG.js";import"./chunk-AGQUA5I4.js";import"./chunk-VC6GZ45F.js";import{a as PV,b as OV}from"./chunk-BENEV3E6.js";import{i as NV}from"./chunk-R3G2IXBO.js";import"./chunk-2M72FQ5L.js";import"./chunk-SBYRP3FT.js";import{a as aa,b as yo,c as di}from"./chunk-N3W77OHB.js";import{a as Yl,b as CV,c as TV}from"./chunk-PXDIM3V6.js";import"./chunk-D4EX42XK.js";import"./chunk-HMAWCT6U.js";import"./chunk-7PDWRJ35.js";import"./chunk-ALHY5HFC.js";import{a as bV}from"./chunk-VLG7V3KV.js";import{a as Wa,c as iV,d as Vd,e as Hd}from"./chunk-63BBKXWS.js";import{a as Kg}from"./chunk-62UTK67Z.js";import{a as yw}from"./chunk-ZFRNSCYG.js";import{a as vV,b as wV}from"./chunk-NGQW42AK.js";import{a as Jk,b as eV}from"./chunk-EZCOACUK.js";import"./chunk-IDSQ2YJ4.js";import"./chunk-IZXGUN7P.js";import{c as uV,d as dV,f as hV,g as pV,h as mV}from"./chunk-TZFNHKBC.js";import{a as aV,b as gM,c as yV}from"./chunk-Q4TV4JSK.js";import{a as lV,b as cV}from"./chunk-4ZHOYO2J.js";import{a as gV,b as mw,c as _V,d as fw,e as gw,f as _w}from"./chunk-HMRMWMHT.js";import{a as oV}from"./chunk-QW4SS6UN.js";import{b as rt,c as ow,d as qa}from"./chunk-UWWX7VSW.js";import{a as kn}from"./chunk-CFF33S4D.js";import{e as pw}from"./chunk-M6OVPXT3.js";import"./chunk-UPU3OYP4.js";import{c as hw}from"./chunk-FLXA3YE2.js";import{a as _o,t as fV}from"./chunk-BFOAQMH4.js";import"./chunk-OWY34DUP.js";import{a as em}from"./chunk-4TIUXNXO.js";import"./chunk-G5XYZLZF.js";import{a as dw,b as sV,c as $a,d as tm}from"./chunk-CEAEFIX3.js";import"./chunk-ULWS5HLW.js";import"./chunk-OE4VWDFD.js";import"./chunk-ITLSRYM2.js";import"./chunk-AFU5KDMG.js";import{d as Fk}from"./chunk-2DZZ5W27.js";import{a as aw}from"./chunk-UXLLQMI3.js";import{b as Nk,n as Lk}from"./chunk-724E6NM3.js";import"./chunk-JKP7KG6H.js";import{a as os}from"./chunk-QW5LN4Z5.js";import{a as Si,b as cw,c as kk,d as go,f as Vk,g as Hk,i as Bk,j as Uk,k as jk,l as zk,m as Gk,n as qk,o as Wk,p as $k,q as Zk,r as mM,s as Qk,u as Yk,v as fM,w as Kk,y as Xk}from"./chunk-QKO2YKBC.js";import{a as Fn}from"./chunk-MF655E4C.js";import{a as lw}from"./chunk-CCTFA5SZ.js";import{a as Jp}from"./chunk-T52CAPK7.js";import"./chunk-EVFVSJN5.js";import"./chunk-3OYKXCYJ.js";import{b as Pk,c as Ok}from"./chunk-ZORXOOFY.js";import{b as Ak}from"./chunk-HUWVQAJL.js";import"./chunk-XY4QPRKP.js";import"./chunk-UV6SBQOQ.js";import"./chunk-OWV7FEAY.js";import{a as Yg}from"./chunk-CU7VLLP2.js";import{a as Ik,b as Qg,c as pM}from"./chunk-3O6GAUHL.js";import{a as Dk,b as sw,c as xk,d as Mk}from"./chunk-QCOPOX22.js";import"./chunk-T4UFXW3U.js";import{a as Sk}from"./chunk-IDJEFLWC.js";import{a as Zg}from"./chunk-NOHUHVCW.js";import"./chunk-JAENS3D3.js";import"./chunk-3ATD3H4Q.js";import{v as Ek}from"./chunk-2XYAAYOE.js";import{a as dM,c as oa,d as hM}from"./chunk-4X7VNDTG.js";import{a as T2}from"./chunk-OOXOZUTM.js";import{a as Ql}from"./chunk-WQZ56BSL.js";import"./chunk-F7NFZM65.js";import"./chunk-I7FLOUNH.js";import{a as VF}from"./chunk-SDA472RA.js";import{a as qr}from"./chunk-LXYWEX2U.js";import"./chunk-IBSCSNYA.js";import"./chunk-SPPN4AOM.js";import"./chunk-TY4DYZZJ.js";import{a as uM,b as rw,c as Ck,d as Tk}from"./chunk-JVF2DMWU.js";import{a as cM}from"./chunk-34RMJISL.js";import{a as LF,b as FF,c as qp}from"./chunk-54P55TN4.js";import{a as sM,b as ra,c as en,d as HF,e as Rt}from"./chunk-BVDJBTNQ.js";import{a as ns}from"./chunk-LSUWBOLF.js";import{a as vk,b as iw}from"./chunk-LHI3UGTZ.js";import"./chunk-6SGUOKGX.js";import"./chunk-LCFWGHLF.js";import"./chunk-XACQ2RJ5.js";import{a as Kp,b as tn,c as hk}from"./chunk-3TRID6QS.js";import{f as bk}from"./chunk-VUJT53YX.js";import"./chunk-WUXNV6ZW.js";import"./chunk-PM3EZWDJ.js";import{d as nk,e as sk,f as ok,h as kd,i as ak,j as lk,k as ck}from"./chunk-KE2U7ENE.js";import{a as wr,b as jF}from"./chunk-PSFZFYFC.js";import"./chunk-WIFM6OT5.js";import{a as na,b as fo,g as uk,h as aM}from"./chunk-GI4NW5SA.js";import"./chunk-F4FOXK2P.js";import{c as lM,d as dk,e as Zl}from"./chunk-T5NHE3SD.js";import{a as wk}from"./chunk-SWCOPTUX.js";import"./chunk-7EWNVUY7.js";import"./chunk-SXYHD4V6.js";import{a as me}from"./chunk-FSW536RM.js";import{a as Xp,c as mk,d as ew,f as fk,g as gk,h as _k,i as tw}from"./chunk-YNDA4ZZB.js";import"./chunk-JAN3FVXP.js";import{e as YF}from"./chunk-F4HA2HQL.js";import{a as yk}from"./chunk-BSKAVVQS.js";import{b as pk}from"./chunk-AEU2INWT.js";import{a as su}from"./chunk-Z4UBZ6W2.js";import{a as ou,b as Zt}from"./chunk-CMKJEBQJ.js";import"./chunk-AQMR24IC.js";import{a as nu}from"./chunk-3J3Q4LMA.js";import"./chunk-PSNQ2KG3.js";import"./chunk-LIKQ6DPU.js";import"./chunk-H6LI7TZP.js";import"./chunk-2IWALBQY.js";import"./chunk-IVHM64W3.js";import"./chunk-QQ5W5TEP.js";import{b as kF}from"./chunk-YQHQQW4I.js";import"./chunk-7V6BRQYE.js";import{b as ek}from"./chunk-IZU6TNEP.js";import"./chunk-DNN7JJKY.js";import{a as J0}from"./chunk-Y7XG5IWW.js";import"./chunk-X5NPIY3C.js";import{a as tk,b as ik,c as rk}from"./chunk-JXRFF2VE.js";import{a as Pi,b as br}from"./chunk-7WCQBAQY.js";import{a as ti,b as Oe,c as ss}from"./chunk-V4ZQZTCB.js";import{a as mt,b as ft}from"./chunk-PEYNLMWW.js";import"./chunk-FQIIIJGL.js";import{f as Yp}from"./chunk-SZTSN5BD.js";import"./chunk-VAOSSSLB.js";import"./chunk-6L543SC5.js";import"./chunk-CUV3BSEW.js";import"./chunk-6FI5AY7X.js";import"./chunk-ZCAR53EN.js";import"./chunk-DH67ILIV.js";import"./chunk-7GUYYJRR.js";import{a as KF}from"./chunk-WS4AMEGN.js";import"./chunk-CU7FHMWW.js";import"./chunk-CSFAHB4Y.js";import"./chunk-AMISFAT3.js";import"./chunk-PTXLSCMJ.js";import{a as $p,b as za,d as Zp,e as ZF,f as Qp,g as Ga,h as K0,k as QF,l as St,m as Tt}from"./chunk-NRRX2M6N.js";import{a as XF,b as vi,c as JF,e as Di}from"./chunk-PMLKCTEJ.js";import{a as oM,f as sa,g as BF,h as UF}from"./chunk-MYO2G5ZH.js";import"./chunk-MTUYS77G.js";import"./chunk-EG2DTURK.js";import"./chunk-57FV5BVL.js";import"./chunk-YVCKQBWT.js";import"./chunk-4XEE5PE3.js";import"./chunk-MBNZK2RR.js";import"./chunk-DV6KBPBR.js";import{a as Ln}from"./chunk-XWEUR6F7.js";import"./chunk-KALTBP5D.js";import"./chunk-O2J7LFYY.js";import"./chunk-422PSKZ7.js";import"./chunk-SFANISLX.js";import"./chunk-5L4CW2H2.js";import"./chunk-UJ7KVQR6.js";import{a as Y0,b as WF,e as $F,j as hr}from"./chunk-B74L7AUE.js";import{a as dr}from"./chunk-MJO3PLZV.js";import{b as X0}from"./chunk-YU3IFRYW.js";import{a as ja}from"./chunk-XKFJ6GWH.js";import"./chunk-GSXOR3JU.js";import"./chunk-55OTJIMU.js";import{a as Ns}from"./chunk-EM2AEAFS.js";import"./chunk-VGAXEXH3.js";import"./chunk-YEPHAEAY.js";import"./chunk-76X7RFM4.js";import"./chunk-HMNTGQTR.js";import"./chunk-ZLIWNUFM.js";import"./chunk-GVSOJUIP.js";import"./chunk-GWSX6PRO.js";import"./chunk-ELCBU4NP.js";import"./chunk-GMZFCQJQ.js";import"./chunk-5WDH2LXO.js";import{a as ru}from"./chunk-L7NOU4T2.js";import{a as zF,b as $g,c as Wp,j as GF,k as qF}from"./chunk-SU7IJ65K.js";import"./chunk-WOZSH7YY.js";import"./chunk-2PJRHNJW.js";import"./chunk-B2RVSTL3.js";import"./chunk-2CKJLDTO.js";import"./chunk-F6TN7E7K.js";import"./chunk-HUUJBVXR.js";import"./chunk-4LDVFWME.js";import"./chunk-A45BLB26.js";import{a as tu}from"./chunk-DFYW3Y3B.js";import{e as rM,g as nM,j as qg,n as Ld,o as eu,r as MF}from"./chunk-UBQPWKE4.js";import"./chunk-YSD7LK2L.js";import{a as Gp}from"./chunk-CTVZOIWY.js";import{a as SF}from"./chunk-BSSTF6JG.js";import"./chunk-7JW7DYCQ.js";import{a as Fd}from"./chunk-UP67O2XH.js";import"./chunk-6CO4643W.js";import{c as AF}from"./chunk-TMY7UIU7.js";import{b as PF}from"./chunk-BPX3YT3K.js";import{a as Ua}from"./chunk-LXEWGICX.js";import"./chunk-NIYDRLW4.js";import{a as iu}from"./chunk-4K47EN3B.js";import{a as Z0,c as IF}from"./chunk-FGY3YBPM.js";import{b as RF}from"./chunk-EDOVNTC7.js";import"./chunk-FSWSNKJD.js";import"./chunk-MVDZB4AK.js";import"./chunk-ESSDCWGF.js";import"./chunk-WVKBXQWE.js";import"./chunk-FGEB67EG.js";import{a as oe,h as Q0}from"./chunk-YEXMIDOT.js";import"./chunk-GV3ZFCVD.js";import"./chunk-SOEEM7Z7.js";import"./chunk-T7PUQGWM.js";import"./chunk-44A27HB7.js";import"./chunk-47NSYSFY.js";import"./chunk-QXNVQZT7.js";import{b as ur,d as TF,e as EF,f as jp,g as DF,i as Xc,l as Jc,o as xF,r as zp}from"./chunk-CAXK5KYB.js";import{a as Os,c as ia,f as CF}from"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-BYXBJQAS.js";import{b as Wg}from"./chunk-THX6XNHV.js";import"./chunk-AKKUUEQK.js";import{a as OF,b as NF}from"./chunk-JLWYDAJB.js";import{b as iM}from"./chunk-4QYMI4ZX.js";import"./chunk-ZH7647AP.js";import{a as ZL,b as QL}from"./chunk-MKPAHACK.js";import{a as iF}from"./chunk-3QCWBHPT.js";import"./chunk-2T2QPZOS.js";import"./chunk-4YCQZSNI.js";import{a as tF}from"./chunk-4D3QHJI2.js";import{c as KL,e as XL,g as JL,j as eF}from"./chunk-E2J2V7JN.js";import{a as k0}from"./chunk-G7RYJIRW.js";import{b as Jx}from"./chunk-37H4LYIE.js";import"./chunk-VYZHOYXV.js";import{b as YL}from"./chunk-K7YQAHQ7.js";import"./chunk-PGUFA2AC.js";import"./chunk-X7BNFUFQ.js";import{c as ta}from"./chunk-XAHD7XBV.js";import{c as bF}from"./chunk-J6YGDWJF.js";import{a as wF}from"./chunk-YQNUGDFH.js";import{a as Se,b as Gg,c as $0}from"./chunk-QCZ3ZIGQ.js";import"./chunk-CUJN6GMF.js";import{a as vF}from"./chunk-IKCK67OG.js";import"./chunk-C4ERY4CA.js";import"./chunk-WDTJILD4.js";import"./chunk-YAZINLP3.js";import"./chunk-IFPD4DIO.js";import"./chunk-KBSNSGCC.js";import"./chunk-NLZLCUU5.js";import"./chunk-RZU6EEB3.js";import{a as nw}from"./chunk-NNX76JDG.js";import"./chunk-76O2P2CB.js";import"./chunk-WV5CXXQQ.js";import{a as g0}from"./chunk-KBDKZSTB.js";import"./chunk-BAZL6DXF.js";import"./chunk-HPPVXWXI.js";import"./chunk-HBMVPT4U.js";import"./chunk-L6ZFUQTH.js";import"./chunk-4MB4OYWM.js";import"./chunk-XG5NROZE.js";import"./chunk-7OTP74QG.js";import"./chunk-ZU53JDRS.js";import"./chunk-KQEHVUTS.js";import"./chunk-7LUXMWRM.js";import"./chunk-TO337MWO.js";import"./chunk-WKYBGWI5.js";import"./chunk-62PJ3MJN.js";import{b as cF,c as uF}from"./chunk-OVJTX4VC.js";import"./chunk-55SQMRMH.js";import"./chunk-CQD6CYSR.js";import"./chunk-QDXM6RGS.js";import"./chunk-E3UR4EIC.js";import"./chunk-4Y623NMU.js";import"./chunk-PTAJ247D.js";import"./chunk-O4MHA7YC.js";import"./chunk-XHEYQWRE.js";import"./chunk-R5HXEPJ3.js";import"./chunk-CJM4TC3F.js";import"./chunk-J5PZXDWN.js";import"./chunk-ME2B26KJ.js";import"./chunk-U7PX7SHO.js";import"./chunk-DZBH24YT.js";import"./chunk-7E723FQO.js";import"./chunk-SVJ5AK5B.js";import"./chunk-FXCL7YYQ.js";import"./chunk-NK3VUQOP.js";import"./chunk-HUKD3ORH.js";import"./chunk-NFARB7KW.js";import"./chunk-M7AB4SQK.js";import"./chunk-XN6KHUVJ.js";import"./chunk-3A3BGKXB.js";import"./chunk-BGOXHRAZ.js";import"./chunk-SXNHGK6A.js";import"./chunk-TMZQBNSB.js";import"./chunk-PFSX77NO.js";import"./chunk-ZJWWZWMH.js";import"./chunk-W45QYQK6.js";import"./chunk-I5V562B6.js";import"./chunk-WT3XCHGP.js";import"./chunk-CUJB6F5L.js";import{a as Rk}from"./chunk-5NHJFBCW.js";import"./chunk-GQVERT3D.js";import"./chunk-WPZN772I.js";import"./chunk-AZ7O5NEQ.js";import"./chunk-K27EVVBH.js";import"./chunk-2JKSIF4Q.js";import{a as _F}from"./chunk-EZUSHT3W.js";import{a as yF}from"./chunk-VIFXPONX.js";import"./chunk-AOQ57NDM.js";import{c as Pe,d as tM,e as W0}from"./chunk-ONYJLWAD.js";import"./chunk-QWLNRA4Y.js";import"./chunk-HBZAOVHW.js";import{D as eM,E as gF,H as q0,Q as $l,c as U0,d as hF,f as fi,g as pF,h as mF,j as j0,n as zg,o as fF,q as Bp,r as Up,u as Wl,x as Nd,y as z0,z as G0}from"./chunk-VMECOA4F.js";import"./chunk-KOUNUVF6.js";import{a as B0}from"./chunk-4RMBQ2W6.js";import{e as dF}from"./chunk-PHODKV66.js";import{a as jg}from"./chunk-JPMGMA4B.js";import"./chunk-A2OWKKGL.js";import"./chunk-YHWE4TIZ.js";import"./chunk-QSMPW36A.js";import"./chunk-JGU5JAYW.js";import"./chunk-LCMPSAU3.js";import"./chunk-CRJDOM7J.js";import"./chunk-BCFGKQ2N.js";import"./chunk-G7BT6VC5.js";import"./chunk-ZPQDV27Y.js";import"./chunk-SIMI7FRM.js";import{b as L2,c as zc,d as Gc,e as qc,h as F2,i as Og,j as kx,k as Vx,l as Mp,r as k2,s as V2}from"./chunk-YQGS4EZO.js";import{a as rs}from"./chunk-3REMXE4W.js";import{p as V0}from"./chunk-4ABKPPKG.js";import{a as xp}from"./chunk-PMVQ5DJK.js";import{b as sF,i as oF,l as aF,w as lF}from"./chunk-I4Q2S2XA.js";import"./chunk-V774RJYN.js";import{a as Ep}from"./chunk-L2WNUKLP.js";import{c as H0}from"./chunk-XITT4JU2.js";import{a as rF,b as nF}from"./chunk-ZBX6HJOS.js";import"./chunk-BSMAMABT.js";import{d as Vp}from"./chunk-LYNAYPL3.js";import"./chunk-ULANM5YP.js";import{l as Hp}from"./chunk-77L5NP7A.js";import"./chunk-2G3SBK6Q.js";import"./chunk-VOB6IBIW.js";import"./chunk-63B3IOWG.js";import{a as fn}from"./chunk-KAMRW6HF.js";import{c as qL}from"./chunk-XIZXEWWA.js";import{a as Kc,b as F0}from"./chunk-6DGDLLNL.js";import{a as UL,b as jL,d as zL}from"./chunk-UWWWQ44M.js";import{b as GL}from"./chunk-BHB4UQZT.js";import{a as Lp,b as P0,c as Fp,d as Qc,e as O0,h as N0,i as ql,j as kp,k as L0,o as BL}from"./chunk-DJW5LMRG.js";import"./chunk-SEJXLJ5V.js";import"./chunk-MPAJA3DL.js";import{a as $t,c as Kx,d as Yc}from"./chunk-ALWV3RJ2.js";import{a as Nn}from"./chunk-DEH76MSI.js";import{a as $L}from"./chunk-YW3L7OMP.js";import{a as mo}from"./chunk-DVBZA6ZU.js";import{a as sL,b as oL}from"./chunk-6YRWGF73.js";import"./chunk-V2JYXY4D.js";import"./chunk-KWBPUP6A.js";import"./chunk-LAVV77UH.js";import"./chunk-VTGWQ7AP.js";import{b as Xx}from"./chunk-TBA3OZMJ.js";import"./chunk-S4QV2MGO.js";import"./chunk-IRI7XXYY.js";import"./chunk-DDZ3KR2Q.js";import{a as WL}from"./chunk-USMAJP2P.js";import"./chunk-PHNFWHVF.js";import"./chunk-4N5OXIEM.js";import"./chunk-DTU6MHUX.js";import"./chunk-NFXNGFHZ.js";import"./chunk-RROJCQBD.js";import"./chunk-3CDCI3XM.js";import"./chunk-W26XKMAT.js";import"./chunk-NQWYPF77.js";import"./chunk-6KRFVLII.js";import"./chunk-G27DRLGO.js";import{a as Ui,c as D0,d as Xt,e as Jn,f as xd}from"./chunk-KRAKR4MK.js";import{a as pi}from"./chunk-MCO7DSFO.js";import"./chunk-D7WE3OBT.js";import"./chunk-CDP4MSRO.js";import"./chunk-BCSLWH5H.js";import{d as AL}from"./chunk-TOH4K6HW.js";import"./chunk-UP6FLASM.js";import"./chunk-DGBDFGKO.js";import"./chunk-44S2QQS2.js";import"./chunk-DQOFEB5P.js";import{a as Ha}from"./chunk-JTDXB5TK.js";import"./chunk-2NP7F5RO.js";import"./chunk-7QY3BMVN.js";import"./chunk-XEZTJAR4.js";import"./chunk-BUP3AMMF.js";import"./chunk-XCIPBOI4.js";import"./chunk-CWUY5SXW.js";import{E as gL,F as zl,G as _L,K as yL,M as vL,a as uL,d as Wc,e as Wx,j as dL,l as C0,p as hL,q as pL,r as mL,t as fL}from"./chunk-KD27XIJC.js";import{c as xL,e as Va,f as ML,g as SL,h as Gl,p as Zx,q as Dd,r as E0,u as IL}from"./chunk-TPFJWNIU.js";import"./chunk-P25RU3X5.js";import{c as Hg,f as EL,k as DL}from"./chunk-XRRQM4E2.js";import"./chunk-GWBRHLNH.js";import{a as Od,d as HL}from"./chunk-QCRXBE6I.js";import{a as R0}from"./chunk-G7TP3ZYQ.js";import"./chunk-SBVUMOLF.js";import{a as A0,d as kL,f as VL}from"./chunk-Y6YEAKJ5.js";import{a as is}from"./chunk-S52JRLJC.js";import{b as Ps}from"./chunk-U4TLMQTY.js";import{a as Xr,e as Yx}from"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import{a as yi}from"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import{a as Ti,b as Jt,c as ei,d as LL,h as Rd,i as Ei,j as S0,k as On,l as ji,m as Ug,n as mi,o as Zc,p as Ba,q as I0,r as Jr,w as cr,x as FL,y as Pd}from"./chunk-HM5RIVQC.js";import{a as Hi,b as OL,c as Bg,e as NL,f as Ad}from"./chunk-EM35R6FY.js";import{c as PL,p as Qx}from"./chunk-2ZFXOJDB.js";import{a as Yi,b as es,d as x0,i as ea,q as Md,s as Sd,w as M0}from"./chunk-QXXXCEV5.js";import{A as RL,D as Op,E as $c,F as Np,G as ai,H as Rr,J as vr,a as xe,b as ee,c as Te,d as he,e as ve,n as X,o as Id,p as ui,q as po,r as Ar,s as Rs,u as ne,v as ae,w as At,x as ni,y as si,z as ts}from"./chunk-6B5XFA6F.js";import"./chunk-M67YQAIX.js";import"./chunk-NHEQ4TAR.js";import"./chunk-BIRSPTTF.js";import"./chunk-IZLELRQR.js";import{b as $x}from"./chunk-7EMOONQX.js";import"./chunk-RZF6KTKU.js";import"./chunk-HP4LYRR4.js";import"./chunk-AFC2H4Q3.js";import{d as Zi,f as Kt,g as W2,h as Td,i as Xo}from"./chunk-OLOKUDVI.js";import"./chunk-4G7UTTZJ.js";import{B as tL,C as iL,D as rL,E as nL,a as Ap,c as Ed,d as J2,f as jx,g as lo,h as zx,j as co,k as Gx,l as eL,m as kg,p as uo}from"./chunk-ZTOZWLEE.js";import"./chunk-RJWOVI3M.js";import"./chunk-SP2CO3KX.js";import{a as b0}from"./chunk-NRBJLISB.js";import{a as Qi,b as TL,c as pn,f as mn}from"./chunk-PTZYZULI.js";import{a as Pp,c as ho,d as wL,e as T0,k as bL,l as Vg,m as CL}from"./chunk-NMLYCCKN.js";import{a as w0,c as Ip}from"./chunk-RSDQHAJX.js";import{a as w,b as hn,c as yt,d as Fg,e as $2,f as Z2,h as Q2,i as Jo,k as Y2,l as K2,m as X2}from"./chunk-BOVYXYHK.js";import"./chunk-FENRIY2T.js";import"./chunk-5HJY3X5Y.js";import{b as aL,c as qx}from"./chunk-6RZAM42M.js";import"./chunk-WDETDPZG.js";import"./chunk-HX2VGIR2.js";import"./chunk-64QN2VGD.js";import{a as lL}from"./chunk-JGEVVXD4.js";import{p as Rp}from"./chunk-B3FO6PT7.js";import{c as cL}from"./chunk-C4UMJHQC.js";import"./chunk-BCREO4Q5.js";import{A as v0,B as Yo,C as G2,D as Ko,F as q2,a as Yt,c as Ng,d as H2,e as B2,f as _0,g as U2,h as ka,j as Hx,k as ao,l as Ul,o as y0,r as Bx,u as j2,v as jl,x as Ux,y as Lg,z as z2}from"./chunk-LXFQWIWE.js";import{b as q,c as Cd,f as Xe,h as Vt,i as Hl,k as oo,l as Sp,t as Bl}from"./chunk-QT6UNBJP.js";import{c as b2}from"./chunk-MDSLION2.js";import{a as Cp,b as Px,c as Tp,d as La,e as Qo}from"./chunk-I2UM4WSJ.js";import{e as $i}from"./chunk-DCHNVAWJ.js";import{b as Nx}from"./chunk-64RBIOV3.js";import{f as v2,k as w2}from"./chunk-6Z6LKUG5.js";import"./chunk-V2GNNIXD.js";import"./chunk-NSYL2RQJ.js";import"./chunk-SLAWDKDA.js";import{a as S,b as Wi,c as ir,d as Zo,h as Fe,i as Re,j as Ce}from"./chunk-MWSXMSWY.js";import{c as Ag,f as un}from"./chunk-JRCKELO6.js";import"./chunk-ZVCMULXF.js";import"./chunk-KJULKTB5.js";import{a as g2,h as _2}from"./chunk-LACL4BQ2.js";import{a as Ox,c as ct}from"./chunk-YR2HD3ZC.js";import{a as oi}from"./chunk-GJASVPF6.js";import"./chunk-UBFCO3DV.js";import{a as C2}from"./chunk-NMRTZBDM.js";import"./chunk-NI7FJV5X.js";import{a as Pn}from"./chunk-BUSG3ZOF.js";import"./chunk-XZIOXVVJ.js";import"./chunk-5RAXVJQI.js";import"./chunk-EXJYW3PC.js";import{a as Rg}from"./chunk-SXQPBCOX.js";import{a as f0,e as O2,f as N2,m as Vi}from"./chunk-LFH24RLM.js";import{a as S2,e as I2,g as A2,j as R2,l as P2,n as pt}from"./chunk-Z5Q7KLA4.js";import{a as Fx}from"./chunk-X4LNX4BR.js";import{a as Qt}from"./chunk-4XZ6X7MQ.js";import{a as Dp}from"./chunk-WLHY3MMA.js";import{J as _t,a as E2,fa as M2,ha as Pg,j as Lx,m as Fa,n as D2,q as x2,v as h0,x as p0,z as m0}from"./chunk-KGVXGH6H.js";import{a as dn}from"./chunk-ARRCN5K3.js";import{a as d0}from"./chunk-LXQPIAN7.js";import{a as m2,c as f2}from"./chunk-FTDD7QBB.js";import{a as Ir}from"./chunk-DB3UIQCU.js";import"./chunk-SBHKMV3P.js";import{a as y2,b as Rx}from"./chunk-R4A63S45.js";import{E as jc}from"./chunk-ETE32IYO.js";import{P as u0}from"./chunk-ONUGDWDK.js";import{f as cn}from"./chunk-SG7CQU4O.js";import{A as u2,B as d2,E as h2,H as d,J as P,a as e2,e as t2,f as Ex,g as Pa,i as i0,k as Mx,p as Sg,z as c2}from"./chunk-QHVIRF5H.js";import{C as Ax,I as C,f as no,g as l0,i as wp,o as c0,p as bp,w as p2,x as Ix}from"./chunk-WZDN6K3C.js";import{a as u}from"./chunk-QGVBCWUY.js";import{a as Ig,b as a0,c as Kr,d as l2}from"./chunk-OJQ73TPF.js";import"./chunk-354SCPDU.js";import"./chunk-OVHPPCBL.js";import{a as xx}from"./chunk-IYZFKXJ6.js";import{A as so,C as n0,D as Gr,E as Sx,H as s2,J as o2,L as a2,M as Na,P as As,a as i2,b as G,c as We,d as kt,e as Mr,f as ki,h as Dx,j as yr,p as r2,q as Oa,s as r0,u as Sr,v as Bt,x as Vl,y as n2}from"./chunk-CKJ56T2Q.js";import{a as s0,b as o0}from"./chunk-SNFOAZZQ.js";import{a as Nt}from"./chunk-F6JAWRPN.js";import{b as ro,k as JN,r as W,t as Be}from"./chunk-UHRSAPGQ.js";import{I as XN,a as Ct,b as QN,d as YN,h as e0,i as KN,j as Mg,p as t0,w as bd}from"./chunk-V76GWARL.js";import"./chunk-L4EKTZIP.js";import{a as ie,b as be}from"./chunk-N2WTMF3X.js";var UM;function jM(){return UM}function Jl(e){let t=UM;return UM=e,t}var QW=Symbol("NotFound"),Gw=class extends Error{name="\u0275NotFound";constructor(t){super(t)}};function _m(e){return e===QW||e?.name==="\u0275NotFound"}function Qw(e,t){return Object.is(e,t)}var Or=null,qw=!1,zM=1,YW=null,ls=Symbol("SIGNAL");function Et(e){let t=Or;return Or=e,t}function Yw(){return Or}var qd={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Kw(e){if(qw)throw new Error("");if(Or===null)return;Or.consumerOnSignalRead(e);let t=Or.nextProducerIndex++;if(ib(Or),t<Or.producerNode.length&&Or.producerNode[t]!==e&&c_(Or)){let i=Or.producerNode[t];tb(i,Or.producerIndexOfThis[t])}Or.producerNode[t]!==e&&(Or.producerNode[t]=e,Or.producerIndexOfThis[t]=c_(Or)?FH(e,Or,t):0),Or.producerLastReadVersion[t]=e.version}function LH(){zM++}function Xw(e){if(!(c_(e)&&!e.dirty)&&!(!e.dirty&&e.lastCleanEpoch===zM)){if(!e.producerMustRecompute(e)&&!Jw(e)){Zw(e);return}e.producerRecomputeValue(e),Zw(e)}}function GM(e){if(e.liveConsumerNode===void 0)return;let t=qw;qw=!0;try{for(let i of e.liveConsumerNode)i.dirty||KW(i)}finally{qw=t}}function qM(){return Or?.consumerAllowSignalWrites!==!1}function KW(e){e.dirty=!0,GM(e),e.consumerMarkedDirty?.(e)}function Zw(e){e.dirty=!1,e.lastCleanEpoch=zM}function ym(e){return e&&(e.nextProducerIndex=0),Et(e)}function u_(e,t){if(Et(t),!(!e||e.producerNode===void 0||e.producerIndexOfThis===void 0||e.producerLastReadVersion===void 0)){if(c_(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)tb(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Jw(e){ib(e);for(let t=0;t<e.producerNode.length;t++){let i=e.producerNode[t],r=e.producerLastReadVersion[t];if(r!==i.version||(Xw(i),r!==i.version))return!0}return!1}function eb(e){if(ib(e),c_(e))for(let t=0;t<e.producerNode.length;t++)tb(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function FH(e,t,i){if(kH(e),e.liveConsumerNode.length===0&&VH(e))for(let r=0;r<e.producerNode.length;r++)e.producerIndexOfThis[r]=FH(e.producerNode[r],e,r);return e.liveConsumerIndexOfThis.push(i),e.liveConsumerNode.push(t)-1}function tb(e,t){if(kH(e),e.liveConsumerNode.length===1&&VH(e))for(let r=0;r<e.producerNode.length;r++)tb(e.producerNode[r],e.producerIndexOfThis[r]);let i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){let r=e.liveConsumerIndexOfThis[t],n=e.liveConsumerNode[t];ib(n),n.producerIndexOfThis[r]=t}}function c_(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function ib(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function kH(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function VH(e){return e.producerNode!==void 0}function rb(e){YW?.(e)}function nb(e,t){let i=Object.create(XW);i.computation=e,t!==void 0&&(i.equal=t);let r=()=>{if(Xw(i),Kw(i),i.value===l_)throw i.error;return i.value};return r[ls]=i,rb(i),r}var Ww=Symbol("UNSET"),$w=Symbol("COMPUTING"),l_=Symbol("ERRORED"),XW=be(ie({},qd),{value:Ww,dirty:!0,error:null,equal:Qw,kind:"computed",producerMustRecompute(e){return e.value===Ww||e.value===$w},producerRecomputeValue(e){if(e.value===$w)throw new Error("");let t=e.value;e.value=$w;let i=ym(e),r,n=!1;try{r=e.computation(),Et(null),n=t!==Ww&&t!==l_&&r!==l_&&e.equal(t,r)}catch(s){r=l_,e.error=s}finally{u_(e,i)}if(n){e.value=t;return}e.value=r,e.version++}});function JW(){throw new Error}var HH=JW;function BH(e){HH(e)}function WM(e){HH=e}var e9=null;function $M(e,t){let i=Object.create(jH);i.value=e,t!==void 0&&(i.equal=t);let r=()=>UH(i);return r[ls]=i,rb(i),[r,o=>sb(i,o),o=>ZM(i,o)]}function UH(e){return Kw(e),e.value}function sb(e,t){qM()||BH(e),e.equal(e.value,t)||(e.value=t,t9(e))}function ZM(e,t){qM()||BH(e),sb(e,t(e.value))}var jH=be(ie({},qd),{equal:Qw,value:void 0,kind:"signal"});function t9(e){e.version++,LH(),GM(e),e9?.(e)}function qt(e){return typeof e=="function"}function ob(e){let i=e(r=>{Error.call(r),r.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var ab=ob(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((r,n)=>`${n+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function d_(e,t){if(e){let i=e.indexOf(t);0<=i&&e.splice(i,1)}}var Bn=class e{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let s of i)s.remove(this);else i.remove(this);let{initialTeardown:r}=this;if(qt(r))try{r()}catch(s){t=s instanceof ab?s.errors:[s]}let{_finalizers:n}=this;if(n){this._finalizers=null;for(let s of n)try{zH(s)}catch(o){t=t??[],o instanceof ab?t=[...t,...o.errors]:t.push(o)}}if(t)throw new ab(t)}}add(t){var i;if(t&&t!==this)if(this.closed)zH(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(t)}}_hasParent(t){let{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){let{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&d_(i,t)}remove(t){let{_finalizers:i}=this;i&&d_(i,t),t instanceof e&&t._removeParent(this)}};Bn.EMPTY=(()=>{let e=new Bn;return e.closed=!0,e})();var QM=Bn.EMPTY;function lb(e){return e instanceof Bn||e&&"closed"in e&&qt(e.remove)&&qt(e.add)&&qt(e.unsubscribe)}function zH(e){qt(e)?e():e.unsubscribe()}var ha={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var vm={setTimeout(e,t,...i){let{delegate:r}=vm;return r?.setTimeout?r.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){let{delegate:t}=vm;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function cb(e){vm.setTimeout(()=>{let{onUnhandledError:t}=ha;if(t)t(e);else throw e})}function YM(){}var GH=KM("C",void 0,void 0);function qH(e){return KM("E",void 0,e)}function WH(e){return KM("N",e,void 0)}function KM(e,t,i){return{kind:e,value:t,error:i}}var Wd=null;function wm(e){if(ha.useDeprecatedSynchronousErrorHandling){let t=!Wd;if(t&&(Wd={errorThrown:!1,error:null}),e(),t){let{errorThrown:i,error:r}=Wd;if(Wd=null,i)throw r}}else e()}function $H(e){ha.useDeprecatedSynchronousErrorHandling&&Wd&&(Wd.errorThrown=!0,Wd.error=e)}var $d=class extends Bn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,lb(t)&&t.add(this)):this.destination=n9}static create(t,i,r){return new bm(t,i,r)}next(t){this.isStopped?JM(WH(t),this):this._next(t)}error(t){this.isStopped?JM(qH(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?JM(GH,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},i9=Function.prototype.bind;function XM(e,t){return i9.call(e,t)}var eS=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(r){ub(r)}}error(t){let{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(r){ub(r)}else ub(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){ub(i)}}},bm=class extends $d{constructor(t,i,r){super();let n;if(qt(t)||!t)n={next:t??void 0,error:i??void 0,complete:r??void 0};else{let s;this&&ha.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),n={next:t.next&&XM(t.next,s),error:t.error&&XM(t.error,s),complete:t.complete&&XM(t.complete,s)}):n=t}this.destination=new eS(n)}};function ub(e){ha.useDeprecatedSynchronousErrorHandling?$H(e):cb(e)}function r9(e){throw e}function JM(e,t){let{onStoppedNotification:i}=ha;i&&vm.setTimeout(()=>i(e,t))}var n9={closed:!0,next:YM,error:r9,complete:YM};var Cm=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ZH(e){return e}function QH(e){return e.length===0?ZH:e.length===1?e[0]:function(i){return e.reduce((r,n)=>n(r),i)}}var Xi=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){let r=new e;return r.source=this,r.operator=i,r}subscribe(i,r,n){let s=o9(i)?i:new bm(i,r,n);return wm(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(r){i.error(r)}}forEach(i,r){return r=YH(r),new r((n,s)=>{let o=new bm({next:a=>{try{i(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:n});this.subscribe(o)})}_subscribe(i){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(i)}[Cm](){return this}pipe(...i){return QH(i)(this)}toPromise(i){return i=YH(i),new i((r,n)=>{let s;this.subscribe(o=>s=o,o=>n(o),()=>r(s))})}}return e.create=t=>new e(t),e})();function YH(e){var t;return(t=e??ha.Promise)!==null&&t!==void 0?t:Promise}function s9(e){return e&&qt(e.next)&&qt(e.error)&&qt(e.complete)}function o9(e){return e&&e instanceof $d||s9(e)&&lb(e)}function a9(e){return qt(e?.lift)}function cs(e){return t=>{if(a9(t))return t.lift(function(i){try{return e(i,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function us(e,t,i,r,n){return new tS(e,t,i,r,n)}var tS=class extends $d{constructor(t,i,r,n,s,o){super(t),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=i?function(a){try{i(a)}catch(l){t.error(l)}}:super._next,this._error=n?function(a){try{n(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};var KH=ob(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Xa=(()=>{class e extends Xi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let r=new db(this,this);return r.operator=i,r}_throwIfClosed(){if(this.closed)throw new KH}next(i){wm(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(i)}})}error(i){wm(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:r}=this;for(;r.length;)r.shift().error(i)}})}complete(){wm(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:r,isStopped:n,observers:s}=this;return r||n?QM:(this.currentObservers=null,s.push(i),new Bn(()=>{this.currentObservers=null,d_(s,i)}))}_checkFinalizedStatuses(i){let{hasError:r,thrownError:n,isStopped:s}=this;r?i.error(n):s&&i.complete()}asObservable(){let i=new Xi;return i.source=this,i}}return e.create=(t,i)=>new db(t,i),e})(),db=class extends Xa{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)}error(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)}complete(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)}_subscribe(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:QM}};var ec=class extends Xa{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){let{hasError:t,thrownError:i,_value:r}=this;if(t)throw i;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}};function XH(e){return e&&qt(e.schedule)}function JH(e){return e[e.length-1]}function eB(e){return qt(JH(e))?e.pop():void 0}function tB(e){return XH(JH(e))?e.pop():void 0}function rB(e,t,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(h){try{c(r.next(h))}catch(p){o(p)}}function l(h){try{c(r.throw(h))}catch(p){o(p)}}function c(h){h.done?s(h.value):n(h.value).then(a,l)}c((r=r.apply(e,t||[])).next())})}function iB(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zd(e){return this instanceof Zd?(this.v=e,this):new Zd(e)}function nB(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(e,t||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(f){return function(g){return Promise.resolve(g).then(f,p)}}function a(f,g){r[f]&&(n[f]=function(_){return new Promise(function(v,b){s.push([f,_,v,b])>1||l(f,_)})},g&&(n[f]=g(n[f])))}function l(f,g){try{c(r[f](g))}catch(_){m(s[0][3],_)}}function c(f){f.value instanceof Zd?Promise.resolve(f.value.v).then(h,p):m(s[0][2],f)}function h(f){l("next",f)}function p(f){l("throw",f)}function m(f,g){f(g),s.shift(),s.length&&l(s[0][0],s[0][1])}}function sB(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof iB=="function"?iB(e):e[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(s){i[s]=e[s]&&function(o){return new Promise(function(a,l){o=e[s](o),n(a,l,o.done,o.value)})}}function n(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var hb=e=>e&&typeof e.length=="number"&&typeof e!="function";function pb(e){return qt(e?.then)}function mb(e){return qt(e[Cm])}function fb(e){return Symbol.asyncIterator&&qt(e?.[Symbol.asyncIterator])}function gb(e){return new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function l9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var _b=l9();function yb(e){return qt(e?.[_b])}function vb(e){return nB(this,arguments,function*(){let i=e.getReader();try{for(;;){let{value:r,done:n}=yield Zd(i.read());if(n)return yield Zd(void 0);yield yield Zd(r)}}finally{i.releaseLock()}})}function wb(e){return qt(e?.getReader)}function ds(e){if(e instanceof Xi)return e;if(e!=null){if(mb(e))return c9(e);if(hb(e))return u9(e);if(pb(e))return d9(e);if(fb(e))return oB(e);if(yb(e))return h9(e);if(wb(e))return p9(e)}throw gb(e)}function c9(e){return new Xi(t=>{let i=e[Cm]();if(qt(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function u9(e){return new Xi(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}function d9(e){return new Xi(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,cb)})}function h9(e){return new Xi(t=>{for(let i of e)if(t.next(i),t.closed)return;t.complete()})}function oB(e){return new Xi(t=>{m9(e,t).catch(i=>t.error(i))})}function p9(e){return oB(vb(e))}function m9(e,t){var i,r,n,s;return rB(this,void 0,void 0,function*(){try{for(i=sB(e);r=yield i.next(),!r.done;){let o=r.value;if(t.next(o),t.closed)return}}catch(o){n={error:o}}finally{try{r&&!r.done&&(s=i.return)&&(yield s.call(i))}finally{if(n)throw n.error}}t.complete()})}function Co(e,t,i,r=0,n=!1){let s=t.schedule(function(){i(),n?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!n)return s}function bb(e,t=0){return cs((i,r)=>{i.subscribe(us(r,n=>Co(r,e,()=>r.next(n),t),()=>Co(r,e,()=>r.complete(),t),n=>Co(r,e,()=>r.error(n),t)))})}function Cb(e,t=0){return cs((i,r)=>{r.add(e.schedule(()=>i.subscribe(r),t))})}function aB(e,t){return ds(e).pipe(Cb(t),bb(t))}function lB(e,t){return ds(e).pipe(Cb(t),bb(t))}function cB(e,t){return new Xi(i=>{let r=0;return t.schedule(function(){r===e.length?i.complete():(i.next(e[r++]),i.closed||this.schedule())})})}function uB(e,t){return new Xi(i=>{let r;return Co(i,t,()=>{r=e[_b](),Co(i,t,()=>{let n,s;try{({value:n,done:s}=r.next())}catch(o){i.error(o);return}s?i.complete():i.next(n)},0,!0)}),()=>qt(r?.return)&&r.return()})}function Tb(e,t){if(!e)throw new Error("Iterable cannot be null");return new Xi(i=>{Co(i,t,()=>{let r=e[Symbol.asyncIterator]();Co(i,t,()=>{r.next().then(n=>{n.done?i.complete():i.next(n.value)})},0,!0)})})}function dB(e,t){return Tb(vb(e),t)}function hB(e,t){if(e!=null){if(mb(e))return aB(e,t);if(hb(e))return cB(e,t);if(pb(e))return lB(e,t);if(fb(e))return Tb(e,t);if(yb(e))return uB(e,t);if(wb(e))return dB(e,t)}throw gb(e)}function Qd(e,t){return t?hB(e,t):ds(e)}function Eb(...e){let t=tB(e);return Qd(e,t)}function hs(e,t){return cs((i,r)=>{let n=0;i.subscribe(us(r,s=>{r.next(e.call(t,s,n++))}))})}var{isArray:f9}=Array;function g9(e,t){return f9(t)?e(...t):e(t)}function pB(e){return hs(t=>g9(e,t))}var{isArray:_9}=Array,{getPrototypeOf:y9,prototype:v9,keys:w9}=Object;function mB(e){if(e.length===1){let t=e[0];if(_9(t))return{args:t,keys:null};if(b9(t)){let i=w9(t);return{args:i.map(r=>t[r]),keys:i}}}return{args:e,keys:null}}function b9(e){return e&&typeof e=="object"&&y9(e)===v9}function fB(e,t){return e.reduce((i,r,n)=>(i[r]=t[n],i),{})}function gB(e,t,i,r,n,s,o,a){let l=[],c=0,h=0,p=!1,m=()=>{p&&!l.length&&!c&&t.complete()},f=_=>c<r?g(_):l.push(_),g=_=>{s&&t.next(_),c++;let v=!1;ds(i(_,h++)).subscribe(us(t,b=>{n?.(b),s?f(b):t.next(b)},()=>{v=!0},void 0,()=>{if(v)try{for(c--;l.length&&c<r;){let b=l.shift();o?Co(t,o,()=>g(b)):g(b)}m()}catch(b){t.error(b)}}))};return e.subscribe(us(t,f,()=>{p=!0,m()})),()=>{a?.()}}function Db(e,t,i=1/0){return qt(t)?Db((r,n)=>hs((s,o)=>t(r,s,n,o))(ds(e(r,n))),i):(typeof t=="number"&&(i=t),cs((r,n)=>gB(r,n,e,i)))}function iS(...e){let t=eB(e),{args:i,keys:r}=mB(e),n=new Xi(s=>{let{length:o}=i;if(!o){s.complete();return}let a=new Array(o),l=o,c=o;for(let h=0;h<o;h++){let p=!1;ds(i[h]).subscribe(us(s,m=>{p||(p=!0,c--),a[h]=m},()=>l--,void 0,()=>{(!l||!p)&&(c||s.next(r?fB(r,a):a),s.complete())}))}});return t?n.pipe(pB(t)):n}function rS(e,t){return cs((i,r)=>{let n=0;i.subscribe(us(r,s=>e.call(t,s,n++)&&r.next(s)))})}function nS(e,t){return qt(t)?Db(e,t,1):Db(e,1)}function sS(e){return cs((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}function oS(e,t){return cs((i,r)=>{let n=null,s=0,o=!1,a=()=>o&&!n&&r.complete();i.subscribe(us(r,l=>{n?.unsubscribe();let c=0,h=s++;ds(e(l,h)).subscribe(n=us(r,p=>r.next(t?t(l,p,h,c++):p),()=>{n=null,a()}))},()=>{o=!0,a()}))})}function _B(e){let t=Et(null);try{return e()}finally{Et(t)}}var vS="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",lt=class extends Error{code;constructor(t,i){super(wS(t,i)),this.code=t}};function C9(e){return`NG0${Math.abs(e)}`}function wS(e,t){return`${C9(e)}${t?": "+t:""}`}var el=globalThis;function nr(e){for(let t in e)if(e[t]===nr)return t;throw Error("")}function bB(e,t){for(let i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function Fs(e){if(typeof e=="string")return e;if(Array.isArray(e))return`[${e.map(Fs).join(", ")}]`;if(e==null)return""+e;let t=e.overriddenName||e.name;if(t)return`${t}`;let i=e.toString();if(i==null)return""+i;let r=i.indexOf(`
`);return r>=0?i.slice(0,r):i}function bS(e,t){return e?t?`${e} ${t}`:e:t||""}var T9=nr({__forward_ref__:nr});function rc(e){return e.__forward_ref__=rc,e.toString=function(){return Fs(this())},e}function rn(e){return CS(e)?e():e}function CS(e){return typeof e=="function"&&e.hasOwnProperty(T9)&&e.__forward_ref__===rc}function CB(e,t,i,r){throw new Error(`ASSERTION ERROR: ${e}`+(r==null?"":` [Expected=> ${i} ${r} ${t} <=Actual]`))}function jt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function pa(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ab(e){return E9(e,Rb)}function E9(e,t){return e.hasOwnProperty(t)&&e[t]||null}function D9(e){let t=e?.[Rb]??null;return t||null}function lS(e){return e&&e.hasOwnProperty(Mb)?e[Mb]:null}var Rb=nr({\u0275prov:nr}),Mb=nr({\u0275inj:nr}),ut=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,i){this._desc=t,this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=jt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function TS(e){return e&&!!e.\u0275providers}var ES=nr({\u0275cmp:nr}),DS=nr({\u0275dir:nr}),xS=nr({\u0275pipe:nr});var p_=nr({\u0275fac:nr}),th=nr({__NG_ELEMENT_ID__:nr}),yB=nr({__NG_ENV_ID__:nr});function Pb(e){return typeof e=="string"?e:e==null?"":String(e)}function TB(e){return typeof e=="function"?e.name||e.toString():typeof e=="object"&&e!=null&&typeof e.type=="function"?e.type.name||e.type.toString():Pb(e)}function MS(e,t){throw new lt(-200,e)}function Ob(e,t){throw new lt(-201,!1)}var cS;function EB(){return cS}function Ls(e){let t=cS;return cS=e,t}function SS(e,t,i){let r=Ab(e);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(i&8)return null;if(t!==void 0)return t;Ob(e,"Injector")}var x9={},Yd=x9,uS="__NG_DI_FLAG__",dS=class{injector;constructor(t){this.injector=t}retrieve(t,i){let r=Kd(i)||0;try{return this.injector.get(t,r&8?null:Yd,r)}catch(n){if(_m(n))return n;throw n}}},Sb="ngTempTokenPath",M9="ngTokenPath",S9=/\n/gm,I9="\u0275",vB="__source";function A9(e,t=0){let i=jM();if(i===void 0)throw new lt(-203,!1);if(i===null)return SS(e,void 0,t);{let r=R9(t),n=i.retrieve(e,r);if(_m(n)){if(r.optional)return null;throw n}return n}}function It(e,t=0){return(EB()||A9)(rn(e),t)}function ot(e,t){return It(e,Kd(t))}function Kd(e){return typeof e>"u"||typeof e=="number"?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function R9(e){return{optional:!!(e&8),host:!!(e&1),self:!!(e&2),skipSelf:!!(e&4)}}function hS(e){let t=[];for(let i=0;i<e.length;i++){let r=rn(e[i]);if(Array.isArray(r)){if(r.length===0)throw new lt(900,!1);let n,s=0;for(let o=0;o<r.length;o++){let a=r[o],l=P9(a);typeof l=="number"?l===-1?n=a.token:s|=l:n=a}t.push(It(n,s))}else t.push(It(r))}return t}function IS(e,t){return e[uS]=t,e.prototype[uS]=t,e}function P9(e){return e[uS]}function O9(e,t,i,r){let n=e[Sb];throw t[vB]&&n.unshift(t[vB]),e.message=N9(`
`+e.message,n,i,r),e[M9]=n,e[Sb]=null,e}function N9(e,t,i,r=null){e=e&&e.charAt(0)===`
`&&e.charAt(1)==I9?e.slice(2):e;let n=Fs(t);if(Array.isArray(t))n=t.map(Fs).join(" -> ");else if(typeof t=="object"){let s=[];for(let o in t)if(t.hasOwnProperty(o)){let a=t[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):Fs(a)))}n=`{${s.join(", ")}}`}return`${i}${r?"("+r+")":""}[${n}]: ${e.replace(S9,`
  `)}`}function Xd(e,t){let i=e.hasOwnProperty(p_);return i?e[p_]:null}function DB(e,t,i){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],s=t[r];if(i&&(n=i(n),s=i(s)),s!==n)return!1}return!0}function xB(e){return e.flat(Number.POSITIVE_INFINITY)}function Nb(e,t){e.forEach(i=>Array.isArray(i)?Nb(i,t):t(i))}function AS(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function f_(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function MB(e,t,i,r){let n=e.length;if(n==t)e.push(i,r);else if(n===1)e.push(r,e[0]),e[0]=i;else{for(n--,e.push(e[n-1],e[n]);n>t;){let s=n-2;e[n]=e[s],n--}e[t]=i,e[t+1]=r}}function SB(e,t,i){let r=Em(e,t);return r>=0?e[r|1]=i:(r=~r,MB(e,r,t,i)),r}function Lb(e,t){let i=Em(e,t);if(i>=0)return e[i|1]}function Em(e,t){return L9(e,t,1)}function L9(e,t,i){let r=0,n=e.length>>i;for(;n!==r;){let s=r+(n-r>>1),o=e[s<<i];if(t===o)return s<<i;o>t?n=s:r=s+1}return~(n<<i)}var wu={},ks=[],bu=new ut(""),RS=new ut("",-1),PS=new ut(""),m_=class{get(t,i=Yd){if(i===Yd)throw new Gw(`NullInjectorError: No provider for ${Fs(t)}!`);return i}};function ih(e){return e[ES]||null}function OS(e){return e[DS]||null}function IB(e){return e[xS]||null}function rh(e){return{\u0275providers:e}}function AB(e){return rh([{provide:bu,multi:!0,useValue:e}])}function RB(...e){return{\u0275providers:NS(!0,e),\u0275fromNgModule:!0}}function NS(e,...t){let i=[],r=new Set,n,s=o=>{i.push(o)};return Nb(t,o=>{let a=o;Ib(a,s,[],r)&&(n||=[],n.push(a))}),n!==void 0&&PB(n,s),i}function PB(e,t){for(let i=0;i<e.length;i++){let{ngModule:r,providers:n}=e[i];LS(n,s=>{t(s,r)})}}function Ib(e,t,i,r){if(e=rn(e),!e)return!1;let n=null,s=lS(e),o=!s&&ih(e);if(!s&&!o){let l=e.ngModule;if(s=lS(l),s)n=l;else return!1}else{if(o&&!o.standalone)return!1;n=e}let a=r.has(n);if(o){if(a)return!1;if(r.add(n),o.dependencies){let l=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let c of l)Ib(c,t,i,r)}}else if(s){if(s.imports!=null&&!a){r.add(n);let c;try{Nb(s.imports,h=>{Ib(h,t,i,r)&&(c||=[],c.push(h))})}finally{}c!==void 0&&PB(c,t)}if(!a){let c=Xd(n)||(()=>new n);t({provide:n,useFactory:c,deps:ks},n),t({provide:PS,useValue:n,multi:!0},n),t({provide:bu,useValue:()=>It(n),multi:!0},n)}let l=s.providers;if(l!=null&&!a){let c=e;LS(l,h=>{t(h,c)})}}else return!1;return n!==e&&e.providers!==void 0}function LS(e,t){for(let i of e)TS(i)&&(i=i.\u0275providers),Array.isArray(i)?LS(i,t):t(i)}var F9=nr({provide:String,useValue:nr});function OB(e){return e!==null&&typeof e=="object"&&F9 in e}function k9(e){return!!(e&&e.useExisting)}function V9(e){return!!(e&&e.useFactory)}function Jd(e){return typeof e=="function"}function NB(e){return!!e.useClass}var g_=new ut(""),xb={},wB={},aS;function __(){return aS===void 0&&(aS=new m_),aS}var ps=class{},eh=class extends ps{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,i,r,n){super(),this.parent=i,this.source=r,this.scopes=n,mS(t,o=>this.processProvider(o)),this.records.set(RS,Tm(void 0,this)),n.has("environment")&&this.records.set(ps,Tm(void 0,this));let s=this.records.get(g_);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(PS,ks,{self:!0}))}retrieve(t,i){let r=Kd(i)||0;try{return this.get(t,Yd,r)}catch(n){if(_m(n))return n;throw n}}destroy(){h_(this),this._destroyed=!0;let t=Et(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of i)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Et(t)}}onDestroy(t){return h_(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){h_(this);let i=Jl(this),r=Ls(void 0),n;try{return t()}finally{Jl(i),Ls(r)}}get(t,i=Yd,r){if(h_(this),t.hasOwnProperty(yB))return t[yB](this);let n=Kd(r),s,o=Jl(this),a=Ls(void 0);try{if(!(n&4)){let c=this.records.get(t);if(c===void 0){let h=z9(t)&&Ab(t);h&&this.injectableDefInScope(h)?c=Tm(pS(t),xb):c=null,this.records.set(t,c)}if(c!=null)return this.hydrate(t,c)}let l=n&2?__():this.parent;return i=n&8&&i===Yd?null:i,l.get(t,i)}catch(l){if(_m(l)){if((l[Sb]=l[Sb]||[]).unshift(Fs(t)),o)throw l;return O9(l,t,"R3InjectorError",this.source)}else throw l}finally{Ls(a),Jl(o)}}resolveInjectorInitializers(){let t=Et(null),i=Jl(this),r=Ls(void 0),n;try{let s=this.get(bu,ks,{self:!0});for(let o of s)o()}finally{Jl(i),Ls(r),Et(t)}}toString(){let t=[],i=this.records;for(let r of i.keys())t.push(Fs(r));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=rn(t);let i=Jd(t)?t:rn(t&&t.provide),r=B9(t);if(!Jd(t)&&t.multi===!0){let n=this.records.get(i);n||(n=Tm(void 0,xb,!0),n.factory=()=>hS(n.multi),this.records.set(i,n)),i=t,n.multi.push(t)}this.records.set(i,r)}hydrate(t,i){let r=Et(null);try{return i.value===wB?MS(Fs(t)):i.value===xb&&(i.value=wB,i.value=i.factory()),typeof i.value=="object"&&i.value&&j9(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{Et(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let i=rn(t.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){let i=this._onDestroyHooks.indexOf(t);i!==-1&&this._onDestroyHooks.splice(i,1)}};function pS(e){let t=Ab(e),i=t!==null?t.factory:Xd(e);if(i!==null)return i;if(e instanceof ut)throw new lt(204,!1);if(e instanceof Function)return H9(e);throw new lt(204,!1)}function H9(e){if(e.length>0)throw new lt(204,!1);let i=D9(e);return i!==null?()=>i.factory(e):()=>new e}function B9(e){if(OB(e))return Tm(void 0,e.useValue);{let t=FS(e);return Tm(t,xb)}}function FS(e,t,i){let r;if(Jd(e)){let n=rn(e);return Xd(n)||pS(n)}else if(OB(e))r=()=>rn(e.useValue);else if(V9(e))r=()=>e.useFactory(...hS(e.deps||[]));else if(k9(e))r=()=>It(rn(e.useExisting));else{let n=rn(e&&(e.useClass||e.provide));if(U9(e))r=()=>new n(...hS(e.deps));else return Xd(n)||pS(n)}return r}function h_(e){if(e.destroyed)throw new lt(205,!1)}function Tm(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function U9(e){return!!e.deps}function j9(e){return e!==null&&typeof e=="object"&&typeof e.ngOnDestroy=="function"}function z9(e){return typeof e=="function"||typeof e=="object"&&e.ngMetadataName==="InjectionToken"}function mS(e,t){for(let i of e)Array.isArray(i)?mS(i,t):i&&TS(i)?mS(i.\u0275providers,t):t(i)}function Dm(e,t){let i;e instanceof eh?(h_(e),i=e):i=new dS(e);let r,n=Jl(i),s=Ls(void 0);try{return t()}finally{Jl(n),Ls(s)}}function kS(){return EB()!==void 0||jM()!=null}var ma=0,Dt=1,vt=2,Wr=3,To=4,Eo=5,y_=6,xm=7,nn=8,nh=9,nc=10,pr=11,Mm=12,VS=13,sh=14,Do=15,Cu=16,oh=17,tl=18,v_=19,HS=20,tc=21,Fb=22,w_=23,Vs=24,kb=25,Hs=26,LB=1;var Tu=7,b_=8,ah=9,vn=10;function il(e){return Array.isArray(e)&&typeof e[LB]=="object"}function fa(e){return Array.isArray(e)&&e[LB]===!0}function BS(e){return(e.flags&4)!==0}function Eu(e){return e.componentOffset>-1}function Vb(e){return(e.flags&1)===1}function rl(e){return!!e.template}function Sm(e){return(e[vt]&512)!==0}function lh(e){return(e[vt]&256)===256}var FB="svg",kB="math";function xo(e){for(;Array.isArray(e);)e=e[ma];return e}function US(e,t){return xo(t[e])}function ga(e,t){return xo(t[e.index])}function C_(e,t){return e.data[t]}function Mo(e,t){let i=t[e];return il(i)?i:i[ma]}function VB(e){return(e[vt]&4)===4}function Hb(e){return(e[vt]&128)===128}function HB(e){return fa(e[Wr])}function ch(e,t){return t==null?null:e[t]}function jS(e){e[oh]=0}function zS(e){e[vt]&1024||(e[vt]|=1024,Hb(e)&&E_(e))}function BB(e,t){for(;e>0;)t=t[sh],e--;return t}function T_(e){return!!(e[vt]&9216||e[Vs]?.dirty)}function Bb(e){e[nc].changeDetectionScheduler?.notify(8),e[vt]&64&&(e[vt]|=1024),T_(e)&&E_(e)}function E_(e){e[nc].changeDetectionScheduler?.notify(0);let t=yu(e);for(;t!==null&&!(t[vt]&8192||(t[vt]|=8192,!Hb(t)));)t=yu(t)}function GS(e,t){if(lh(e))throw new lt(911,!1);e[tc]===null&&(e[tc]=[]),e[tc].push(t)}function UB(e,t){if(e[tc]===null)return;let i=e[tc].indexOf(t);i!==-1&&e[tc].splice(i,1)}function yu(e){let t=e[Wr];return fa(t)?t[Wr]:t}function qS(e){return e[xm]??=[]}function WS(e){return e.cleanup??=[]}function jB(e,t,i,r){let n=qS(t);n.push(i),e.firstCreatePass&&WS(e).push(r,n.length-1)}var Ut={lFrame:nU(null),bindingsEnabled:!0,skipHydrationRootTNode:null},D_=function(e){return e[e.Off=0]="Off",e[e.Exhaustive=1]="Exhaustive",e[e.OnlyDirtyViews=2]="OnlyDirtyViews",e}(D_||{}),G9=0,fS=!1;function zB(){return Ut.lFrame.elementDepthCount}function GB(){Ut.lFrame.elementDepthCount++}function qB(){Ut.lFrame.elementDepthCount--}function $S(){return Ut.bindingsEnabled}function WB(){return Ut.skipHydrationRootTNode!==null}function $B(e){return Ut.skipHydrationRootTNode===e}function ZB(){Ut.skipHydrationRootTNode=null}function hi(){return Ut.lFrame.lView}function $r(){return Ut.lFrame.tView}function Im(e){return Ut.lFrame.contextLView=e,e[nn]}function Am(e){return Ut.lFrame.contextLView=null,e}function ms(){let e=ZS();for(;e!==null&&e.type===64;)e=e.parent;return e}function ZS(){return Ut.lFrame.currentTNode}function QB(){let e=Ut.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Rm(e,t){let i=Ut.lFrame;i.currentTNode=e,i.isParent=t}function QS(){return Ut.lFrame.isParent}function YB(){Ut.lFrame.isParent=!1}function YS(e){CB("Must never be called in production mode"),G9=e}function KS(){return fS}function XS(e){let t=fS;return fS=e,t}function KB(e){return Ut.lFrame.bindingIndex=e}function Pm(){return Ut.lFrame.bindingIndex++}function XB(e){let t=Ut.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function JB(){return Ut.lFrame.inI18n}function eU(e,t){let i=Ut.lFrame;i.bindingIndex=i.bindingRootIndex=e,Ub(t)}function tU(){return Ut.lFrame.currentDirectiveIndex}function Ub(e){Ut.lFrame.currentDirectiveIndex=e}function iU(e){let t=Ut.lFrame.currentDirectiveIndex;return t===-1?null:e[t]}function JS(){return Ut.lFrame.currentQueryIndex}function jb(e){Ut.lFrame.currentQueryIndex=e}function q9(e){let t=e[Dt];return t.type===2?t.declTNode:t.type===1?e[Eo]:null}function eI(e,t,i){if(i&4){let n=t,s=e;for(;n=n.parent,n===null&&!(i&1);)if(n=q9(s),n===null||(s=s[sh],n.type&10))break;if(n===null)return!1;t=n,e=s}let r=Ut.lFrame=rU();return r.currentTNode=t,r.lView=e,!0}function zb(e){let t=rU(),i=e[Dt];Ut.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function rU(){let e=Ut.lFrame,t=e===null?null:e.child;return t===null?nU(e):t}function nU(e){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return e!==null&&(e.child=t),t}function sU(){let e=Ut.lFrame;return Ut.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var tI=sU;function Gb(){let e=sU();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function oU(e){return(Ut.lFrame.contextLView=BB(e,Ut.lFrame.contextLView))[nn]}function uh(){return Ut.lFrame.selectedIndex}function Du(e){Ut.lFrame.selectedIndex=e}function qb(){let e=Ut.lFrame;return C_(e.tView,e.selectedIndex)}function aU(){return Ut.lFrame.currentNamespace}var lU=!0;function Wb(){return lU}function $b(e){lU=e}function gS(e,t=null,i=null,r){let n=cU(e,t,i,r);return n.resolveInjectorInitializers(),n}function cU(e,t=null,i=null,r,n=new Set){let s=[i||ks,RB(e)];return r=r||(typeof e=="object"?void 0:Fs(e)),new eh(s,t||__(),r||null,n)}var vu=class e{static THROW_IF_NOT_FOUND=Yd;static NULL=new m_;static create(t,i){if(Array.isArray(t))return gS({name:""},i,t,"");{let r=t.name??"";return gS({name:r},t.parent,t.providers,r)}}static \u0275prov=jt({token:e,providedIn:"any",factory:()=>It(RS)});static __NG_ELEMENT_ID__=-1},fs=new ut(""),dh=(()=>{class e{static __NG_ELEMENT_ID__=W9;static __NG_ENV_ID__=i=>i}return e})(),_S=class extends dh{_lView;constructor(t){super(),this._lView=t}get destroyed(){return lh(this._lView)}onDestroy(t){let i=this._lView;return GS(i,t),()=>UB(i,t)}};function W9(){return new _S(hi())}var Ja=class{_console=console;handleError(t){this._console.error("ERROR",t)}},nl=new ut("",{providedIn:"root",factory:()=>{let e=ot(ps),t;return i=>{t??=e.get(Ja),t.handleError(i)}}}),uU={provide:bu,useValue:()=>void ot(Ja),multi:!0},$9=new ut("",{providedIn:"root",factory:()=>{let e=ot(fs).defaultView;if(!e)return;let t=ot(nl),i=s=>{t(s.reason),s.preventDefault()},r=s=>{t(s.error),s.preventDefault()},n=()=>{e.addEventListener("unhandledrejection",i),e.addEventListener("error",r)};typeof Zone<"u"?Zone.root.run(n):n(),ot(dh).onDestroy(()=>{e.removeEventListener("error",r),e.removeEventListener("unhandledrejection",i)})}});function iI(){return rh([AB(()=>void ot($9))])}function rI(e){return typeof e=="function"&&e[ls]!==void 0}function hh(e,t){let[i,r,n]=$M(e,t?.equal),s=i,o=s[ls];return s.set=r,s.update=n,s.asReadonly=dU.bind(s),s}function dU(){let e=this[ls];if(e.readonlyFn===void 0){let t=()=>this();t[ls]=e,e.readonlyFn=t}return e.readonlyFn}function nI(e){return rI(e)&&typeof e.set=="function"}var ic=class{},x_=new ut("",{providedIn:"root",factory:()=>!1});var sI=new ut(""),Zb=new ut("");var ph=(()=>{class e{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new ec(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Xi(i=>{i.next(!1),i.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let i=this.taskId++;return this.pendingTasks.add(i),i}has(i){return this.pendingTasks.has(i)}remove(i){this.pendingTasks.delete(i),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=jt({token:e,providedIn:"root",factory:()=>new e})}return e})(),Qb=(()=>{class e{internalPendingTasks=ot(ph);scheduler=ot(ic);errorHandler=ot(nl);add(){let i=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(i)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(i))}}run(i){let r=this.add();i().catch(this.errorHandler).finally(r)}static \u0275prov=jt({token:e,providedIn:"root",factory:()=>new e})}return e})();function M_(...e){}var oI=(()=>{class e{static \u0275prov=jt({token:e,providedIn:"root",factory:()=>new yS})}return e})(),yS=class{dirtyEffectCount=0;queues=new Map;add(t){this.enqueue(t),this.schedule(t)}schedule(t){t.dirty&&this.dirtyEffectCount++}remove(t){let i=t.zone,r=this.queues.get(i);r.has(t)&&(r.delete(t),t.dirty&&this.dirtyEffectCount--)}enqueue(t){let i=t.zone;this.queues.has(i)||this.queues.set(i,new Set);let r=this.queues.get(i);r.has(t)||r.add(t)}flush(){for(;this.dirtyEffectCount>0;){let t=!1;for(let[i,r]of this.queues)i===null?t||=this.flushQueue(r):t||=i.run(()=>this.flushQueue(r));t||(this.dirtyEffectCount=0)}}flushQueue(t){let i=!1;for(let r of t)r.dirty&&(this.dirtyEffectCount--,i=!0,r.run());return i}};function Fm(e){return{toString:e}.toString()}var Yb="__parameters__";function o7(e){return function(...i){if(e){let r=e(...i);for(let n in r)this[n]=r[n]}}}function UU(e,t,i){return Fm(()=>{let r=o7(t);function n(...s){if(this instanceof n)return r.apply(this,s),this;let o=new n(...s);return a.annotation=o,a;function a(l,c,h){let p=l.hasOwnProperty(Yb)?l[Yb]:Object.defineProperty(l,Yb,{value:[]})[Yb];for(;p.length<=h;)p.push(null);return(p[h]=p[h]||[]).push(o),l}}return n.prototype.ngMetadataName=e,n.annotationCls=n,n})}var jU=IS(UU("Optional"),8);var zU=IS(UU("SkipSelf"),4);function a7(e){return typeof e=="function"}var iC=class{previousValue;currentValue;firstChange;constructor(t,i,r){this.previousValue=t,this.currentValue=i,this.firstChange=r}isFirstChange(){return this.firstChange}};function GU(e,t,i,r){t!==null?t.applyValueToInputSignal(t,r):e[i]=r}var ac=(()=>{let e=()=>qU;return e.ngInherit=!0,e})();function qU(e){return e.type.prototype.ngOnChanges&&(e.setInput=c7),l7}function l7(){let e=$U(this),t=e?.current;if(t){let i=e.previous;if(i===wu)e.previous=t;else for(let r in t)i[r]=t[r];e.current=null,this.ngOnChanges(t)}}function c7(e,t,i,r,n){let s=this.declaredInputs[r],o=$U(e)||u7(e,{previous:wu,current:null}),a=o.current||(o.current={}),l=o.previous,c=l[s];a[s]=new iC(c&&c.currentValue,i,l===wu),GU(e,t,n,i)}var WU="__ngSimpleChanges__";function $U(e){return e[WU]||null}function u7(e,t){return e[WU]=t}var hU=[];var Ii=function(e,t=null,i){for(let r=0;r<hU.length;r++){let n=hU[r];n(e,t,i)}};function d7(e,t,i){let{ngOnChanges:r,ngOnInit:n,ngDoCheck:s}=t.type.prototype;if(r){let o=qU(t);(i.preOrderHooks??=[]).push(e,o),(i.preOrderCheckHooks??=[]).push(e,o)}n&&(i.preOrderHooks??=[]).push(0-e,n),s&&((i.preOrderHooks??=[]).push(e,s),(i.preOrderCheckHooks??=[]).push(e,s))}function ZU(e,t){for(let i=t.directiveStart,r=t.directiveEnd;i<r;i++){let s=e.data[i].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:h}=s;o&&(e.contentHooks??=[]).push(-i,o),a&&((e.contentHooks??=[]).push(i,a),(e.contentCheckHooks??=[]).push(i,a)),l&&(e.viewHooks??=[]).push(-i,l),c&&((e.viewHooks??=[]).push(i,c),(e.viewCheckHooks??=[]).push(i,c)),h!=null&&(e.destroyHooks??=[]).push(i,h)}}function Xb(e,t,i){QU(e,t,3,i)}function Jb(e,t,i,r){(e[vt]&3)===i&&QU(e,t,i,r)}function aI(e,t){let i=e[vt];(i&3)===t&&(i&=16383,i+=1,e[vt]=i)}function QU(e,t,i,r){let n=r!==void 0?e[oh]&65535:0,s=r??-1,o=t.length-1,a=0;for(let l=n;l<o;l++)if(typeof t[l+1]=="number"){if(a=t[l],r!=null&&a>=r)break}else t[l]<0&&(e[oh]+=65536),(a<s||s==-1)&&(h7(e,i,t,l),e[oh]=(e[oh]&4294901760)+l+2),l++}function pU(e,t){Ii(4,e,t);let i=Et(null);try{t.call(e)}finally{Et(i),Ii(5,e,t)}}function h7(e,t,i,r){let n=i[r]<0,s=i[r+1],o=n?-i[r]:i[r],a=e[o];n?e[vt]>>14<e[oh]>>16&&(e[vt]&3)===t&&(e[vt]+=16384,pU(a,s)):pU(a,s)}var Nm=-1,fh=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,i,r){this.factory=t,this.canSeeViewProviders=i,this.injectImpl=r}};function p7(e){return(e.flags&8)!==0}function m7(e){return(e.flags&16)!==0}function f7(e,t,i){let r=0;for(;r<i.length;){let n=i[r];if(typeof n=="number"){if(n!==0)break;r++;let s=i[r++],o=i[r++],a=i[r++];e.setAttribute(t,o,a,s)}else{let s=n,o=i[++r];_7(s)?e.setProperty(t,s,o):e.setAttribute(t,s,o),r++}}return r}function g7(e){return e===3||e===4||e===6}function _7(e){return e.charCodeAt(0)===64}function A_(e,t){if(!(t===null||t.length===0))if(e===null||e.length===0)e=t.slice();else{let i=-1;for(let r=0;r<t.length;r++){let n=t[r];typeof n=="number"?i=n:i===0||(i===-1||i===2?mU(e,i,n,null,t[++r]):mU(e,i,n,null,null))}}return e}function mU(e,t,i,r,n){let s=0,o=e.length;if(t===-1)o=-1;else for(;s<e.length;){let a=e[s++];if(typeof a=="number"){if(a===t){o=-1;break}else if(a>t){o=s-1;break}}}for(;s<e.length;){let a=e[s];if(typeof a=="number")break;if(a===i){n!==null&&(e[s+1]=n);return}s++,n!==null&&s++}o!==-1&&(e.splice(o,0,t),s=o+1),e.splice(s++,0,i),n!==null&&e.splice(s++,0,n)}function YU(e){return e!==Nm}function rC(e){return e&32767}function y7(e){return e>>16}function nC(e,t){let i=y7(e),r=t;for(;i>0;)r=r[sh],i--;return r}var _I=!0;function fU(e){let t=_I;return _I=e,t}var v7=256,KU=v7-1,XU=5,w7=0,sl={};function b7(e,t,i){let r;typeof i=="string"?r=i.charCodeAt(0)||0:i.hasOwnProperty(th)&&(r=i[th]),r==null&&(r=i[th]=w7++);let n=r&KU,s=1<<n;t.data[e+(n>>XU)]|=s}function sC(e,t){let i=JU(e,t);if(i!==-1)return i;let r=t[Dt];r.firstCreatePass&&(e.injectorIndex=t.length,lI(r.data,e),lI(t,null),lI(r.blueprint,null));let n=GI(e,t),s=e.injectorIndex;if(YU(n)){let o=rC(n),a=nC(n,t),l=a[Dt].data;for(let c=0;c<8;c++)t[s+c]=a[o+c]|l[o+c]}return t[s+8]=n,s}function lI(e,t){e.push(0,0,0,0,0,0,0,0,t)}function JU(e,t){return e.injectorIndex===-1||e.parent&&e.parent.injectorIndex===e.injectorIndex||t[e.injectorIndex+8]===null?-1:e.injectorIndex}function GI(e,t){if(e.parent&&e.parent.injectorIndex!==-1)return e.parent.injectorIndex;let i=0,r=null,n=t;for(;n!==null;){if(r=n5(n),r===null)return Nm;if(i++,n=n[sh],r.injectorIndex!==-1)return r.injectorIndex|i<<16}return Nm}function yI(e,t,i){b7(e,t,i)}function e5(e,t,i){if(i&8||e!==void 0)return e;Ob(t,"NodeInjector")}function t5(e,t,i,r){if(i&8&&r===void 0&&(r=null),(i&3)===0){let n=e[nh],s=Ls(void 0);try{return n?n.get(t,r,i&8):SS(t,r,i&8)}finally{Ls(s)}}return e5(r,t,i)}function i5(e,t,i,r=0,n){if(e!==null){if(t[vt]&2048&&!(r&2)){let o=D7(e,t,i,r,sl);if(o!==sl)return o}let s=r5(e,t,i,r,sl);if(s!==sl)return s}return t5(t,i,r,n)}function r5(e,t,i,r,n){let s=T7(i);if(typeof s=="function"){if(!eI(t,e,r))return r&1?e5(n,i,r):t5(t,i,r,n);try{let o;if(o=s(r),o==null&&!(r&8))Ob(i);else return o}finally{tI()}}else if(typeof s=="number"){let o=null,a=JU(e,t),l=Nm,c=r&1?t[Do][Eo]:null;for((a===-1||r&4)&&(l=a===-1?GI(e,t):t[a+8],l===Nm||!_U(r,!1)?a=-1:(o=t[Dt],a=rC(l),t=nC(l,t)));a!==-1;){let h=t[Dt];if(gU(s,a,h.data)){let p=C7(a,t,i,o,r,c);if(p!==sl)return p}l=t[a+8],l!==Nm&&_U(r,t[Dt].data[a+8]===c)&&gU(s,a,t)?(o=h,a=rC(l),t=nC(l,t)):a=-1}}return n}function C7(e,t,i,r,n,s){let o=t[Dt],a=o.data[e+8],l=r==null?Eu(a)&&_I:r!=o&&(a.type&3)!==0,c=n&1&&s===a,h=eC(a,o,i,l,c);return h!==null?R_(t,o,h,a):sl}function eC(e,t,i,r,n){let s=e.providerIndexes,o=t.data,a=s&1048575,l=e.directiveStart,c=e.directiveEnd,h=s>>20,p=r?a:a+h,m=n?a+h:c;for(let f=p;f<m;f++){let g=o[f];if(f<l&&i===g||f>=l&&g.type===i)return f}if(n){let f=o[l];if(f&&rl(f)&&f.type===i)return l}return null}function R_(e,t,i,r){let n=e[i],s=t.data;if(n instanceof fh){let o=n;o.resolving&&MS(TB(s[i]));let a=fU(o.canSeeViewProviders);o.resolving=!0;let l=s[i].type||s[i],c,h=o.injectImpl?Ls(o.injectImpl):null,p=eI(e,r,0);try{n=e[i]=o.factory(void 0,s,e,r),t.firstCreatePass&&i>=r.directiveStart&&d7(i,s[i],t)}finally{h!==null&&Ls(h),fU(a),o.resolving=!1,tI()}}return n}function T7(e){if(typeof e=="string")return e.charCodeAt(0)||0;let t=e.hasOwnProperty(th)?e[th]:void 0;return typeof t=="number"?t>=0?t&KU:E7:t}function gU(e,t,i){let r=1<<e;return!!(i[t+(e>>XU)]&r)}function _U(e,t){return!(e&2)&&!(e&1&&t)}var mh=class{_tNode;_lView;constructor(t,i){this._tNode=t,this._lView=i}get(t,i,r){return i5(this._tNode,this._lView,t,Kd(r),i)}};function E7(){return new mh(ms(),hi())}function pC(e){return Fm(()=>{let t=e.prototype.constructor,i=t[p_]||vI(t),r=Object.prototype,n=Object.getPrototypeOf(e.prototype).constructor;for(;n&&n!==r;){let s=n[p_]||vI(n);if(s&&s!==i)return s;n=Object.getPrototypeOf(n)}return s=>new s})}function vI(e){return CS(e)?()=>{let t=vI(rn(e));return t&&t()}:Xd(e)}function D7(e,t,i,r,n){let s=e,o=t;for(;s!==null&&o!==null&&o[vt]&2048&&!Sm(o);){let a=r5(s,o,i,r|2,sl);if(a!==sl)return a;let l=s.parent;if(!l){let c=o[HS];if(c){let h=c.get(i,sl,r);if(h!==sl)return h}l=n5(o),o=o[sh]}s=l}return n}function n5(e){let t=e[Dt],i=t.type;return i===2?t.declTNode:i===1?e[Eo]:null}function x7(){return km(ms(),hi())}function km(e,t){return new lc(ga(e,t))}var lc=(()=>{class e{nativeElement;constructor(i){this.nativeElement=i}static __NG_ELEMENT_ID__=x7}return e})();function M7(e){return e instanceof lc?e.nativeElement:e}function S7(){return this._results[Symbol.iterator]()}var oC=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Xa}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){this.dirty=!1;let r=xB(t);(this._changesDetected=!DB(this._results,r,i))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=S7};function s5(e){return(e.flags&128)===128}var qI=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(qI||{}),o5=new Map,I7=0;function A7(){return I7++}function R7(e){o5.set(e[v_],e)}function wI(e){o5.delete(e[v_])}var yU="__ngContext__";function k_(e,t){il(t)?(e[yU]=t[v_],R7(t)):e[yU]=t}function a5(e){return c5(e[Mm])}function l5(e){return c5(e[To])}function c5(e){for(;e!==null&&!fa(e);)e=e[To];return e}var bI;function WI(e){bI=e}function u5(){if(bI!==void 0)return bI;if(typeof document<"u")return document;throw new lt(210,!1)}var mC=new ut("",{providedIn:"root",factory:()=>P7}),P7="ng",fC=new ut(""),Vm=new ut("",{providedIn:"platform",factory:()=>"unknown"});var gC=new ut("",{providedIn:"root",factory:()=>u5().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var O7="h",N7="b";var d5=!1,h5=new ut("",{providedIn:"root",factory:()=>d5});var L7=(e,t,i,r)=>{};function F7(e,t,i,r){L7(e,t,i,r)}var k7=()=>null;function p5(e,t,i=!1){return k7(e,t,i)}function m5(e,t){let i=e.contentQueries;if(i!==null){let r=Et(null);try{for(let n=0;n<i.length;n+=2){let s=i[n],o=i[n+1];if(o!==-1){let a=e.data[o];jb(s),a.contentQueries(2,t[o],o)}}}finally{Et(r)}}}function CI(e,t,i){jb(0);let r=Et(null);try{t(e,i)}finally{Et(r)}}function f5(e,t,i){if(BS(t)){let r=Et(null);try{let n=t.directiveStart,s=t.directiveEnd;for(let o=n;o<s;o++){let a=e.data[o];if(a.contentQueries){let l=i[o];a.contentQueries(1,l,o)}}}finally{Et(r)}}}var sc=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(sc||{});var TI=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${vS})`}};function g5(e){return e instanceof TI?e.changingThisBreaksApplicationSecurity:e}function V7(e,t,i){let r=e.length;for(;;){let n=e.indexOf(t,i);if(n===-1)return n;if(n===0||e.charCodeAt(n-1)<=32){let s=t.length;if(n+s===r||e.charCodeAt(n+s)<=32)return n}i=n+1}}var _5="ng-template";function H7(e,t,i,r){let n=0;if(r){for(;n<t.length&&typeof t[n]=="string";n+=2)if(t[n]==="class"&&V7(t[n+1].toLowerCase(),i,0)!==-1)return!0}else if($I(e))return!1;if(n=t.indexOf(1,n),n>-1){let s;for(;++n<t.length&&typeof(s=t[n])=="string";)if(s.toLowerCase()===i)return!0}return!1}function $I(e){return e.type===4&&e.value!==_5}function B7(e,t,i){let r=e.type===4&&!i?_5:e.value;return t===r}function U7(e,t,i){let r=4,n=e.attrs,s=n!==null?G7(n):0,o=!1;for(let a=0;a<t.length;a++){let l=t[a];if(typeof l=="number"){if(!o&&!_a(r)&&!_a(l))return!1;if(o&&_a(l))continue;o=!1,r=l|r&1;continue}if(!o)if(r&4){if(r=2|r&1,l!==""&&!B7(e,l,i)||l===""&&t.length===1){if(_a(r))return!1;o=!0}}else if(r&8){if(n===null||!H7(e,n,l,i)){if(_a(r))return!1;o=!0}}else{let c=t[++a],h=j7(l,n,$I(e),i);if(h===-1){if(_a(r))return!1;o=!0;continue}if(c!==""){let p;if(h>s?p="":p=n[h+1].toLowerCase(),r&2&&c!==p){if(_a(r))return!1;o=!0}}}}return _a(r)||o}function _a(e){return(e&1)===0}function j7(e,t,i,r){if(t===null)return-1;let n=0;if(r||!i){let s=!1;for(;n<t.length;){let o=t[n];if(o===e)return n;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=t[++n];for(;typeof a=="string";)a=t[++n];continue}else{if(o===4)break;if(o===0){n+=4;continue}}n+=s?1:2}return-1}else return q7(t,e)}function z7(e,t,i=!1){for(let r=0;r<t.length;r++)if(U7(e,t[r],i))return!0;return!1}function G7(e){for(let t=0;t<e.length;t++){let i=e[t];if(g7(i))return t}return e.length}function q7(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){let r=e[i];if(typeof r=="number")return-1;if(r===t)return i;i++}return-1}function vU(e,t){return e?":not("+t.trim()+")":t}function W7(e){let t=e[0],i=1,r=2,n="",s=!1;for(;i<e.length;){let o=e[i];if(typeof o=="string")if(r&2){let a=e[++i];n+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else r&8?n+="."+o:r&4&&(n+=" "+o);else n!==""&&!_a(o)&&(t+=vU(s,n),n=""),r=o,s=s||!_a(r);i++}return n!==""&&(t+=vU(s,n)),t}function $7(e){return e.map(W7).join(",")}function Z7(e){let t=[],i=[],r=1,n=2;for(;r<e.length;){let s=e[r];if(typeof s=="string")n===2?s!==""&&t.push(s,e[++r]):n===8&&i.push(s);else{if(!_a(n))break;n=s}r++}return i.length&&t.push(1,...i),t}var cc={};function Q7(e,t){return e.createText(t)}function Y7(e,t,i){e.setValue(t,i)}function y5(e,t,i){return e.createElement(t,i)}function aC(e,t,i,r,n){e.insertBefore(t,i,r,n)}function v5(e,t,i){e.appendChild(t,i)}function wU(e,t,i,r,n){r!==null?aC(e,t,i,r,n):v5(e,t,i)}function K7(e,t,i){e.removeChild(null,t,i)}function X7(e,t,i){e.setAttribute(t,"style",i)}function J7(e,t,i){i===""?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function w5(e,t,i){let{mergedAttrs:r,classes:n,styles:s}=i;r!==null&&f7(e,t,r),n!==null&&J7(e,t,n),s!==null&&X7(e,t,s)}function ZI(e,t,i,r,n,s,o,a,l,c,h){let p=Hs+r,m=p+n,f=e$(p,m),g=typeof c=="function"?c():c;return f[Dt]={type:e,blueprint:f,template:i,queries:null,viewQuery:a,declTNode:t,data:f.slice().fill(null,p),bindingStartIndex:p,expandoStartIndex:m,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:l,consts:g,incompleteFirstPass:!1,ssrId:h}}function e$(e,t){let i=[];for(let r=0;r<t;r++)i.push(r<e?null:cc);return i}function t$(e){let t=e.tView;return t===null||t.incompleteFirstPass?e.tView=ZI(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function QI(e,t,i,r,n,s,o,a,l,c,h){let p=t.blueprint.slice();return p[ma]=n,p[vt]=r|4|128|8|64|1024,(c!==null||e&&e[vt]&2048)&&(p[vt]|=2048),jS(p),p[Wr]=p[sh]=e,p[nn]=i,p[nc]=o||e&&e[nc],p[pr]=a||e&&e[pr],p[nh]=l||e&&e[nh]||null,p[Eo]=s,p[v_]=A7(),p[y_]=h,p[HS]=c,p[Do]=t.type==2?e[Do]:p,p}function i$(e,t,i){let r=ga(t,e),n=t$(i),s=e[nc].rendererFactory,o=YI(e,QI(e,n,null,b5(i),r,t,null,s.createRenderer(r,i),null,null,null));return e[t.index]=o}function b5(e){let t=16;return e.signals?t=4096:e.onPush&&(t=64),t}function C5(e,t,i,r){if(i===0)return-1;let n=t.length;for(let s=0;s<i;s++)t.push(r),e.blueprint.push(r),e.data.push(null);return n}function YI(e,t){return e[Mm]?e[VS][To]=t:e[Mm]=t,e[VS]=t,t}function Nr(e=1){T5($r(),hi(),uh()+e,!1)}function T5(e,t,i,r){if(!r)if((t[vt]&3)===3){let s=e.preOrderCheckHooks;s!==null&&Xb(t,s,i)}else{let s=e.preOrderHooks;s!==null&&Jb(t,s,0,i)}Du(i)}var _C=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(_C||{});function EI(e,t,i,r){let n=Et(null);try{let[s,o,a]=e.inputs[i],l=null;(o&_C.SignalBased)!==0&&(l=t[s][ls]),l!==null&&l.transformFn!==void 0?r=l.transformFn(r):a!==null&&(r=a.call(t,r)),e.setInput!==null?e.setInput(t,l,r,i,s):GU(t,l,s,r)}finally{Et(n)}}function E5(e,t,i,r,n){let s=uh(),o=r&2;try{Du(-1),o&&t.length>Hs&&T5(e,t,Hs,!1),Ii(o?2:0,n,i),i(r,n)}finally{Du(s),Ii(o?3:1,n,i)}}function KI(e,t,i){c$(e,t,i),(i.flags&64)===64&&u$(e,t,i)}function D5(e,t,i=ga){let r=t.localNames;if(r!==null){let n=t.index+1;for(let s=0;s<r.length;s+=2){let o=r[s+1],a=o===-1?i(t,e):e[o];e[n++]=a}}}function r$(e,t,i,r){let s=r.get(h5,d5)||i===sc.ShadowDom,o=e.selectRootElement(t,s);return n$(o),o}function n$(e){s$(e)}var s$=()=>null;function o$(e){return e==="class"?"className":e==="for"?"htmlFor":e==="formaction"?"formAction":e==="innerHtml"?"innerHTML":e==="readonly"?"readOnly":e==="tabindex"?"tabIndex":e}function x5(e,t,i,r,n,s){let o=t[Dt];if(XI(e,o,t,i,r)){Eu(e)&&l$(t,e.index);return}a$(e,t,i,r,n,s)}function a$(e,t,i,r,n,s){if(e.type&3){let o=ga(e,t);i=o$(i),r=s!=null?s(r,e.value||"",i):r,n.setProperty(o,i,r)}else e.type&12}function l$(e,t){let i=Mo(t,e);i[vt]&16||(i[vt]|=64)}function c$(e,t,i){let r=i.directiveStart,n=i.directiveEnd;Eu(i)&&i$(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||sC(i,t);let s=i.initialInputs;for(let o=r;o<n;o++){let a=e.data[o],l=R_(t,e,o,i);if(k_(l,t),s!==null&&m$(t,o-r,l,a,i,s),rl(a)){let c=Mo(i.index,t);c[nn]=R_(t,e,o,i)}}}function u$(e,t,i){let r=i.directiveStart,n=i.directiveEnd,s=i.index,o=tU();try{Du(s);for(let a=r;a<n;a++){let l=e.data[a],c=t[a];Ub(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&d$(l,c)}}finally{Du(-1),Ub(o)}}function d$(e,t){e.hostBindings!==null&&e.hostBindings(1,t)}function M5(e,t){let i=e.directiveRegistry,r=null;if(i)for(let n=0;n<i.length;n++){let s=i[n];z7(t,s.selectors,!1)&&(r??=[],rl(s)?r.unshift(s):r.push(s))}return r}function h$(e,t,i,r,n,s){let o=ga(e,t);p$(t[pr],o,s,e.value,i,r,n)}function p$(e,t,i,r,n,s,o){if(s==null)e.removeAttribute(t,n,i);else{let a=o==null?Pb(s):o(s,r||"",n);e.setAttribute(t,n,a,i)}}function m$(e,t,i,r,n,s){let o=s[t];if(o!==null)for(let a=0;a<o.length;a+=2){let l=o[a],c=o[a+1];EI(r,i,l,c)}}function f$(e,t){let i=e[nh];if(!i)return;i.get(nl,null)?.(t)}function XI(e,t,i,r,n){let s=e.inputs?.[r],o=e.hostDirectiveInputs?.[r],a=!1;if(o)for(let l=0;l<o.length;l+=2){let c=o[l],h=o[l+1],p=t.data[c];EI(p,i[c],h,n),a=!0}if(s)for(let l of s){let c=i[l],h=t.data[l];EI(h,c,r,n),a=!0}return a}function g$(e,t){let i=Mo(t,e),r=i[Dt];_$(r,i);let n=i[ma];n!==null&&i[y_]===null&&(i[y_]=p5(n,i[nh])),Ii(18),JI(r,i,i[nn]),Ii(19,i[nn])}function _$(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}function JI(e,t,i){zb(t);try{let r=e.viewQuery;r!==null&&CI(1,r,i);let n=e.template;n!==null&&E5(e,t,n,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),t[tl]?.finishViewCreation(e),e.staticContentQueries&&m5(e,t),e.staticViewQueries&&CI(2,e.viewQuery,i);let s=e.components;s!==null&&y$(t,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[vt]&=-5,Gb()}}function y$(e,t){for(let i=0;i<t.length;i++)g$(e,t[i])}function S5(e,t,i,r){let n=Et(null);try{let s=t.tView,a=e[vt]&4096?4096:16,l=QI(e,s,i,a,null,t,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=e[t.index];l[Cu]=c;let h=e[tl];return h!==null&&(l[tl]=h.createEmbeddedView(s)),JI(s,l,i),l}finally{Et(n)}}function DI(e,t){return!t||t.firstChild===null||s5(e)}var bU=!1,v$=new ut(""),w$;function eA(e,t){return w$(e,t)}var oc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(oc||{});function tA(e){return(e.flags&32)===32}function Om(e,t,i,r,n){if(r!=null){let s,o=!1;fa(r)?s=r:il(r)&&(o=!0,r=r[ma]);let a=xo(r);e===0&&i!==null?n==null?v5(t,i,a):aC(t,i,a,n||null,!0):e===1&&i!==null?aC(t,i,a,n||null,!0):e===2?K7(t,a,o):e===3&&t.destroyNode(a),s!=null&&P$(t,e,s,i,n)}}function b$(e,t){I5(e,t),t[ma]=null,t[Eo]=null}function C$(e,t,i,r,n,s){r[ma]=n,r[Eo]=t,yC(e,r,i,1,n,s)}function I5(e,t){t[nc].changeDetectionScheduler?.notify(9),yC(e,t,t[pr],2,null,null)}function T$(e){let t=e[Mm];if(!t)return cI(e[Dt],e);for(;t;){let i=null;if(il(t))i=t[Mm];else{let r=t[vn];r&&(i=r)}if(!i){for(;t&&!t[To]&&t!==e;)il(t)&&cI(t[Dt],t),t=t[Wr];t===null&&(t=e),il(t)&&cI(t[Dt],t),i=t&&t[To]}t=i}}function iA(e,t){let i=e[ah],r=i.indexOf(t);i.splice(r,1)}function rA(e,t){if(lh(t))return;let i=t[pr];i.destroyNode&&yC(e,t,i,3,null,null),T$(t)}function cI(e,t){if(lh(t))return;let i=Et(null);try{t[vt]&=-129,t[vt]|=256,t[Vs]&&eb(t[Vs]),D$(e,t),E$(e,t),t[Dt].type===1&&t[pr].destroy();let r=t[Cu];if(r!==null&&fa(t[Wr])){r!==t[Wr]&&iA(r,t);let n=t[tl];n!==null&&n.detachView(e)}wI(t)}finally{Et(i)}}function E$(e,t){let i=e.cleanup,r=t[xm];if(i!==null)for(let o=0;o<i.length-1;o+=2)if(typeof i[o]=="string"){let a=i[o+3];a>=0?r[a]():r[-a].unsubscribe(),o+=2}else{let a=r[i[o+1]];i[o].call(a)}r!==null&&(t[xm]=null);let n=t[tc];if(n!==null){t[tc]=null;for(let o=0;o<n.length;o++){let a=n[o];a()}}let s=t[w_];if(s!==null){t[w_]=null;for(let o of s)o.destroy()}}function D$(e,t){let i;if(e!=null&&(i=e.destroyHooks)!=null)for(let r=0;r<i.length;r+=2){let n=t[i[r]];if(!(n instanceof fh)){let s=i[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=n[s[o]],l=s[o+1];Ii(4,a,l);try{l.call(a)}finally{Ii(5,a,l)}}else{Ii(4,n,s);try{s.call(n)}finally{Ii(5,n,s)}}}}}function x$(e,t,i){return M$(e,t.parent,i)}function M$(e,t,i){let r=t;for(;r!==null&&r.type&168;)t=r,r=t.parent;if(r===null)return i[ma];if(Eu(r)){let{encapsulation:n}=e.data[r.directiveStart+r.componentOffset];if(n===sc.None||n===sc.Emulated)return null}return ga(r,i)}function S$(e,t,i){return A$(e,t,i)}function I$(e,t,i){return e.type&40?ga(e,i):null}var A$=I$,CU;function nA(e,t,i,r){let n=x$(e,r,t),s=t[pr],o=r.parent||t[Eo],a=S$(o,r,t);if(n!=null)if(Array.isArray(i))for(let l=0;l<i.length;l++)wU(s,n,i[l],a,!1);else wU(s,n,i,a,!1);CU!==void 0&&CU(s,r,t,i,n)}function S_(e,t){if(t!==null){let i=t.type;if(i&3)return ga(t,e);if(i&4)return xI(-1,e[t.index]);if(i&8){let r=t.child;if(r!==null)return S_(e,r);{let n=e[t.index];return fa(n)?xI(-1,n):xo(n)}}else{if(i&128)return S_(e,t.next);if(i&32)return eA(t,e)()||xo(e[t.index]);{let r=A5(e,t);if(r!==null){if(Array.isArray(r))return r[0];let n=yu(e[Do]);return S_(n,r)}else return S_(e,t.next)}}}return null}function A5(e,t){if(t!==null){let r=e[Do][Eo],n=t.projection;return r.projection[n]}return null}function xI(e,t){let i=vn+e+1;if(i<t.length){let r=t[i],n=r[Dt].firstChild;if(n!==null)return S_(r,n)}return t[Tu]}function sA(e,t,i,r,n,s,o){for(;i!=null;){if(i.type===128){i=i.next;continue}let a=r[i.index],l=i.type;if(o&&t===0&&(a&&k_(xo(a),r),i.flags|=2),!tA(i))if(l&8)sA(e,t,i.child,r,n,s,!1),Om(t,e,n,a,s);else if(l&32){let c=eA(i,r),h;for(;h=c();)Om(t,e,n,h,s);Om(t,e,n,a,s)}else l&16?R$(e,t,r,i,n,s):Om(t,e,n,a,s);i=o?i.projectionNext:i.next}}function yC(e,t,i,r,n,s){sA(i,r,e.firstChild,t,n,s,!1)}function R$(e,t,i,r,n,s){let o=i[Do],l=o[Eo].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let h=l[c];Om(t,e,n,h,s)}else{let c=l,h=o[Wr];s5(r)&&(c.flags|=128),sA(e,t,c,h,n,s,!0)}}function P$(e,t,i,r,n){let s=i[Tu],o=xo(i);s!==o&&Om(t,e,r,s,n);for(let a=vn;a<i.length;a++){let l=i[a];yC(l[Dt],l,e,t,r,s)}}function O$(e,t,i,r,n){if(t)n?e.addClass(i,r):e.removeClass(i,r);else{let s=r.indexOf("-")===-1?void 0:oc.DashCase;n==null?e.removeStyle(i,r,s):(typeof n=="string"&&n.endsWith("!important")&&(n=n.slice(0,-10),s|=oc.Important),e.setStyle(i,r,n,s))}}function P_(e,t,i,r,n=!1){for(;i!==null;){if(i.type===128){i=n?i.projectionNext:i.next;continue}let s=t[i.index];s!==null&&r.push(xo(s)),fa(s)&&R5(s,r);let o=i.type;if(o&8)P_(e,t,i.child,r);else if(o&32){let a=eA(i,t),l;for(;l=a();)r.push(l)}else if(o&16){let a=A5(t,i);if(Array.isArray(a))r.push(...a);else{let l=yu(t[Do]);P_(l[Dt],l,a,r,!0)}}i=n?i.projectionNext:i.next}return r}function R5(e,t){for(let i=vn;i<e.length;i++){let r=e[i],n=r[Dt].firstChild;n!==null&&P_(r[Dt],r,n,t)}e[Tu]!==e[ma]&&t.push(e[Tu])}function P5(e){if(e[kb]!==null){for(let t of e[kb])t.impl.addSequence(t);e[kb].length=0}}var O5=[];function N$(e){return e[Vs]??L$(e)}function L$(e){let t=O5.pop()??Object.create(k$);return t.lView=e,t}function F$(e){e.lView[Vs]!==e&&(e.lView=null,O5.push(e))}var k$=be(ie({},qd),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{E_(e.lView)},consumerOnSignalRead(){this.lView[Vs]=this}});function V$(e){let t=e[Vs]??Object.create(H$);return t.lView=e,t}var H$=be(ie({},qd),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{let t=yu(e.lView);for(;t&&!N5(t[Dt]);)t=yu(t);t&&zS(t)},consumerOnSignalRead(){this.lView[Vs]=this}});function N5(e){return e.type!==2}function L5(e){if(e[w_]===null)return;let t=!0;for(;t;){let i=!1;for(let r of e[w_])r.dirty&&(i=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));t=i&&!!(e[vt]&8192)}}var B$=100;function oA(e,t=0){let r=e[nc].rendererFactory,n=!1;n||r.begin?.();try{U$(e,t)}finally{n||r.end?.()}}function U$(e,t){let i=KS();try{XS(!0),MI(e,t);let r=0;for(;T_(e);){if(r===B$)throw new lt(103,!1);r++,MI(e,1)}}finally{XS(i)}}function F5(e,t){YS(t?D_.Exhaustive:D_.OnlyDirtyViews);try{oA(e)}finally{YS(D_.Off)}}function j$(e,t,i,r){if(lh(t))return;let n=t[vt],s=!1,o=!1;zb(t);let a=!0,l=null,c=null;s||(N5(e)?(c=N$(t),l=ym(c)):Yw()===null?(a=!1,c=V$(t),l=ym(c)):t[Vs]&&(eb(t[Vs]),t[Vs]=null));try{jS(t),KB(e.bindingStartIndex),i!==null&&E5(e,t,i,2,r);let h=(n&3)===3;if(!s)if(h){let f=e.preOrderCheckHooks;f!==null&&Xb(t,f,null)}else{let f=e.preOrderHooks;f!==null&&Jb(t,f,0,null),aI(t,0)}if(o||z$(t),L5(t),k5(t,0),e.contentQueries!==null&&m5(e,t),!s)if(h){let f=e.contentCheckHooks;f!==null&&Xb(t,f)}else{let f=e.contentHooks;f!==null&&Jb(t,f,1),aI(t,1)}q$(e,t);let p=e.components;p!==null&&H5(t,p,0);let m=e.viewQuery;if(m!==null&&CI(2,m,r),!s)if(h){let f=e.viewCheckHooks;f!==null&&Xb(t,f)}else{let f=e.viewHooks;f!==null&&Jb(t,f,2),aI(t,2)}if(e.firstUpdatePass===!0&&(e.firstUpdatePass=!1),t[Fb]){for(let f of t[Fb])f();t[Fb]=null}s||(P5(t),t[vt]&=-73)}catch(h){throw s||E_(t),h}finally{c!==null&&(u_(c,l),a&&F$(c)),Gb()}}function k5(e,t){for(let i=a5(e);i!==null;i=l5(i))for(let r=vn;r<i.length;r++){let n=i[r];V5(n,t)}}function z$(e){for(let t=a5(e);t!==null;t=l5(t)){if(!(t[vt]&2))continue;let i=t[ah];for(let r=0;r<i.length;r++){let n=i[r];zS(n)}}}function G$(e,t,i){Ii(18);let r=Mo(t,e);V5(r,i),Ii(19,r[nn])}function V5(e,t){Hb(e)&&MI(e,t)}function MI(e,t){let r=e[Dt],n=e[vt],s=e[Vs],o=!!(t===0&&n&16);if(o||=!!(n&64&&t===0),o||=!!(n&1024),o||=!!(s?.dirty&&Jw(s)),o||=!1,s&&(s.dirty=!1),e[vt]&=-9217,o)j$(r,e,r.template,e[nn]);else if(n&8192){let a=Et(null);try{L5(e),k5(e,1);let l=r.components;l!==null&&H5(e,l,1),P5(e)}finally{Et(a)}}}function H5(e,t,i){for(let r=0;r<t.length;r++)G$(e,t[r],i)}function q$(e,t){let i=e.hostBindingOpCodes;if(i!==null)try{for(let r=0;r<i.length;r++){let n=i[r];if(n<0)Du(~n);else{let s=n,o=i[++r],a=i[++r];eU(o,s);let l=t[s];Ii(24,l),a(2,l),Ii(25,l)}}}finally{Du(-1)}}function aA(e,t){let i=KS()?64:1088;for(e[nc].changeDetectionScheduler?.notify(t);e;){e[vt]|=i;let r=yu(e);if(Sm(e)&&!r)return e;e=r}return null}function B5(e,t,i,r){return[e,!0,0,t,null,r,null,i,null,null]}function W$(e,t){let i=vn+t;if(i<e.length)return e[i]}function U5(e,t,i,r=!0){let n=t[Dt];if(Z$(n,t,e,i),r){let o=xI(i,e),a=t[pr],l=a.parentNode(e[Tu]);l!==null&&C$(n,e[Eo],a,t,l,o)}let s=t[y_];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function $$(e,t){let i=lC(e,t);return i!==void 0&&rA(i[Dt],i),i}function lC(e,t){if(e.length<=vn)return;let i=vn+t,r=e[i];if(r){let n=r[Cu];n!==null&&n!==e&&iA(n,r),t>0&&(e[i-1][To]=r[To]);let s=f_(e,vn+t);b$(r[Dt],r);let o=s[tl];o!==null&&o.detachView(s[Dt]),r[Wr]=null,r[To]=null,r[vt]&=-129}return r}function Z$(e,t,i,r){let n=vn+r,s=i.length;r>0&&(i[n-1][To]=t),r<s-vn?(t[To]=i[n],AS(i,vn+r,t)):(i.push(t),t[To]=null),t[Wr]=i;let o=t[Cu];o!==null&&i!==o&&j5(o,t);let a=t[tl];a!==null&&a.insertView(e),Bb(t),t[vt]|=128}function j5(e,t){let i=e[ah],r=t[Wr];if(il(r))e[vt]|=2;else{let n=r[Wr][Do];t[Do]!==n&&(e[vt]|=2)}i===null?e[ah]=[t]:i.push(t)}var xu=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let t=this._lView,i=t[Dt];return P_(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i}get context(){return this._lView[nn]}set context(t){this._lView[nn]=t}get destroyed(){return lh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[Wr];if(fa(t)){let i=t[b_],r=i?i.indexOf(this):-1;r>-1&&(lC(t,r),f_(i,r))}this._attachedToViewContainer=!1}rA(this._lView[Dt],this._lView)}onDestroy(t){GS(this._lView,t)}markForCheck(){aA(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[vt]&=-129}reattach(){Bb(this._lView),this._lView[vt]|=128}detectChanges(){this._lView[vt]|=1024,oA(this._lView)}checkNoChanges(){return;try{this.exhaustive??=this._lView[nh].get(v$,bU)}catch{this.exhaustive=bU}}attachToViewContainerRef(){if(this._appRef)throw new lt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=Sm(this._lView),i=this._lView[Cu];i!==null&&!t&&iA(i,this._lView),I5(this._lView[Dt],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new lt(902,!1);this._appRef=t;let i=Sm(this._lView),r=this._lView[Cu];r!==null&&!i&&j5(r,this._lView),Bb(this._lView)}};var gh=(()=>{class e{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=Q$;constructor(i,r,n){this._declarationLView=i,this._declarationTContainer=r,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,r){return this.createEmbeddedViewImpl(i,r)}createEmbeddedViewImpl(i,r,n){let s=S5(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:r,dehydratedView:n});return new xu(s)}}return e})();function Q$(){return lA(ms(),hi())}function lA(e,t){return e.type&4?new gh(t,e,km(e,t)):null}function cA(e,t,i,r,n){let s=e.data[t];if(s===null)s=Y$(e,t,i,r,n),JB()&&(s.flags|=32);else if(s.type&64){s.type=i,s.value=r,s.attrs=n;let o=QB();s.injectorIndex=o===null?-1:o.injectorIndex}return Rm(s,!0),s}function Y$(e,t,i,r,n){let s=ZS(),o=QS(),a=o?s:s&&s.parent,l=e.data[t]=X$(e,a,i,t,r,n);return K$(e,l,s,o),l}function K$(e,t,i,r){e.firstChild===null&&(e.firstChild=t),i!==null&&(r?i.child==null&&t.parent!==null&&(i.child=t):i.next===null&&(i.next=t,t.prev=i))}function X$(e,t,i,r,n,s){let o=t?t.injectorIndex:-1,a=0;return WB()&&(a|=128),{type:i,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:n,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var Kce=new RegExp(`^(\\d+)*(${N7}|${O7})*(.*)`);var J$=()=>null,eZ=()=>null;function TU(e,t){return J$(e,t)}function tZ(e,t,i){return eZ(e,t,i)}var z5=class{},vC=class{},SI=class{resolveComponentFactory(t){throw new lt(917,!1)}},wC=class{static NULL=new SI},_h=class{},V_=(()=>{class e{destroyNode=null;static __NG_ELEMENT_ID__=()=>iZ()}return e})();function iZ(){let e=hi(),t=ms(),i=Mo(t.index,e);return(il(i)?i:e)[pr]}var G5=(()=>{class e{static \u0275prov=jt({token:e,providedIn:"root",factory:()=>null})}return e})();var tC={},II=class{injector;parentInjector;constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,r){let n=this.injector.get(t,tC,r);return n!==tC||i===tC?n:this.parentInjector.get(t,i,r)}};function EU(e,t,i){let r=i?e.styles:null,n=i?e.classes:null,s=0;if(t!==null)for(let o=0;o<t.length;o++){let a=t[o];if(typeof a=="number")s=a;else if(s==1)n=bS(n,a);else if(s==2){let l=a,c=t[++o];r=bS(r,l+": "+c+";")}}i?e.styles=r:e.stylesWithoutHost=r,i?e.classes=n:e.classesWithoutHost=n}function Lt(e,t=0){let i=hi();if(i===null)return It(e,t);let r=ms();return i5(r,i,rn(e),t)}function q5(e,t,i,r,n){let s=r===null?null:{"":-1},o=n(e,i);if(o!==null){let a=o,l=null,c=null;for(let h of o)if(h.resolveHostDirectives!==null){[a,l,c]=h.resolveHostDirectives(o);break}sZ(e,t,i,a,s,l,c)}s!==null&&r!==null&&rZ(i,r,s)}function rZ(e,t,i){let r=e.localNames=[];for(let n=0;n<t.length;n+=2){let s=i[t[n+1]];if(s==null)throw new lt(-301,!1);r.push(t[n],s)}}function nZ(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function sZ(e,t,i,r,n,s,o){let a=r.length,l=!1;for(let m=0;m<a;m++){let f=r[m];!l&&rl(f)&&(l=!0,nZ(e,i,m)),yI(sC(i,t),e,f.type)}dZ(i,e.data.length,a);for(let m=0;m<a;m++){let f=r[m];f.providersResolver&&f.providersResolver(f)}let c=!1,h=!1,p=C5(e,t,a,null);a>0&&(i.directiveToIndex=new Map);for(let m=0;m<a;m++){let f=r[m];if(i.mergedAttrs=A_(i.mergedAttrs,f.hostAttrs),aZ(e,i,t,p,f),uZ(p,f,n),o!==null&&o.has(f)){let[_,v]=o.get(f);i.directiveToIndex.set(f.type,[p,_+i.directiveStart,v+i.directiveStart])}else(s===null||!s.has(f))&&i.directiveToIndex.set(f.type,p);f.contentQueries!==null&&(i.flags|=4),(f.hostBindings!==null||f.hostAttrs!==null||f.hostVars!==0)&&(i.flags|=64);let g=f.type.prototype;!c&&(g.ngOnChanges||g.ngOnInit||g.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),c=!0),!h&&(g.ngOnChanges||g.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),h=!0),p++}oZ(e,i,s)}function oZ(e,t,i){for(let r=t.directiveStart;r<t.directiveEnd;r++){let n=e.data[r];if(i===null||!i.has(n))DU(0,t,n,r),DU(1,t,n,r),MU(t,r,!1);else{let s=i.get(n);xU(0,t,s,r),xU(1,t,s,r),MU(t,r,!0)}}}function DU(e,t,i,r){let n=e===0?i.inputs:i.outputs;for(let s in n)if(n.hasOwnProperty(s)){let o;e===0?o=t.inputs??={}:o=t.outputs??={},o[s]??=[],o[s].push(r),W5(t,s)}}function xU(e,t,i,r){let n=e===0?i.inputs:i.outputs;for(let s in n)if(n.hasOwnProperty(s)){let o=n[s],a;e===0?a=t.hostDirectiveInputs??={}:a=t.hostDirectiveOutputs??={},a[o]??=[],a[o].push(r,s),W5(t,o)}}function W5(e,t){t==="class"?e.flags|=8:t==="style"&&(e.flags|=16)}function MU(e,t,i){let{attrs:r,inputs:n,hostDirectiveInputs:s}=e;if(r===null||!i&&n===null||i&&s===null||$I(e)){e.initialInputs??=[],e.initialInputs.push(null);return}let o=null,a=0;for(;a<r.length;){let l=r[a];if(l===0){a+=4;continue}else if(l===5){a+=2;continue}else if(typeof l=="number")break;if(!i&&n.hasOwnProperty(l)){let c=n[l];for(let h of c)if(h===t){o??=[],o.push(l,r[a+1]);break}}else if(i&&s.hasOwnProperty(l)){let c=s[l];for(let h=0;h<c.length;h+=2)if(c[h]===t){o??=[],o.push(c[h+1],r[a+1]);break}}a+=2}e.initialInputs??=[],e.initialInputs.push(o)}function aZ(e,t,i,r,n){e.data[r]=n;let s=n.factory||(n.factory=Xd(n.type,!0)),o=new fh(s,rl(n),Lt);e.blueprint[r]=o,i[r]=o,lZ(e,t,r,C5(e,i,n.hostVars,cc),n)}function lZ(e,t,i,r,n){let s=n.hostBindings;if(s){let o=e.hostBindingOpCodes;o===null&&(o=e.hostBindingOpCodes=[]);let a=~t.index;cZ(o)!=a&&o.push(a),o.push(i,r,s)}}function cZ(e){let t=e.length;for(;t>0;){let i=e[--t];if(typeof i=="number"&&i<0)return i}return 0}function uZ(e,t,i){if(i){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)i[t.exportAs[r]]=e;rl(t)&&(i[""]=e)}}function dZ(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}function $5(e,t,i,r,n,s,o,a){let l=t.consts,c=ch(l,o),h=cA(t,e,2,r,c);return s&&q5(t,i,h,ch(l,a),n),h.mergedAttrs=A_(h.mergedAttrs,h.attrs),h.attrs!==null&&EU(h,h.attrs,!1),h.mergedAttrs!==null&&EU(h,h.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,h),h}function Z5(e,t){ZU(e,t),BS(t)&&e.queries.elementEnd(t)}function uA(e){return Y5(e)?Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e:!1}function Q5(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{let i=e[Symbol.iterator](),r;for(;!(r=i.next()).done;)t(r.value)}}function Y5(e){return e!==null&&(typeof e=="function"||typeof e=="object")}function Hm(e,t,i){if(i===cc)return!1;let r=e[t];return Object.is(r,i)?!1:(e[t]=i,!0)}function uI(e,t,i){return function r(n){let s=Eu(e)?Mo(e.index,t):t;aA(s,5);let o=t[nn],a=SU(t,o,i,n),l=r.__ngNextListenerFn__;for(;l;)a=SU(t,o,l,n)&&a,l=l.__ngNextListenerFn__;return a}}function SU(e,t,i,r){let n=Et(null);try{return Ii(6,t,i),i(r)!==!1}catch(s){return f$(e,s),!1}finally{Ii(7,t,i),Et(n)}}function hZ(e,t,i,r,n,s,o,a){let l=Vb(e),c=!1,h=null;if(!r&&l&&(h=pZ(t,i,s,e.index)),h!==null){let p=h.__ngLastListenerFn__||h;p.__ngNextListenerFn__=o,h.__ngLastListenerFn__=o,c=!0}else{let p=ga(e,i),m=r?r(p):p;F7(i,m,s,a);let f=n.listen(m,s,a),g=r?_=>r(xo(_[e.index])):e.index;K5(g,t,i,s,a,f,!1)}return c}function pZ(e,t,i,r){let n=e.cleanup;if(n!=null)for(let s=0;s<n.length-1;s+=2){let o=n[s];if(o===i&&n[s+1]===r){let a=t[xm],l=n[s+2];return a&&a.length>l?a[l]:null}typeof o=="string"&&(s+=2)}return null}function K5(e,t,i,r,n,s,o){let a=t.firstCreatePass?WS(t):null,l=qS(i),c=l.length;l.push(n,s),a&&a.push(r,e,c,(c+1)*(o?-1:1))}function IU(e,t,i,r,n,s){let o=t[i],a=t[Dt],c=a.data[i].outputs[r],p=o[c].subscribe(s);K5(e.index,a,t,n,s,p,!0)}var AI=Symbol("BINDING");var RI=class extends wC{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let i=ih(t);return new O_(i,this.ngModule)}};function mZ(e){return Object.keys(e).map(t=>{let[i,r,n]=e[t],s={propName:i,templateName:t,isSignal:(r&_C.SignalBased)!==0};return n&&(s.transform=n),s})}function fZ(e){return Object.keys(e).map(t=>({propName:e[t],templateName:t}))}function gZ(e,t,i){let r=t instanceof ps?t:t?.injector;return r&&e.getStandaloneInjector!==null&&(r=e.getStandaloneInjector(r)||r),r?new II(i,r):i}function _Z(e){let t=e.get(_h,null);if(t===null)throw new lt(407,!1);let i=e.get(G5,null),r=e.get(ic,null);return{rendererFactory:t,sanitizer:i,changeDetectionScheduler:r,ngReflect:!1}}function yZ(e,t){let i=(e.selectors[0][0]||"div").toLowerCase();return y5(t,i,i==="svg"?FB:i==="math"?kB:null)}var O_=class extends vC{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=mZ(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=fZ(this.componentDef.outputs),this.cachedOutputs}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=$7(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!i}create(t,i,r,n,s,o){Ii(22);let a=Et(null);try{let l=this.componentDef,c=vZ(r,l,o,s),h=gZ(l,n||this.ngModule,t),p=_Z(h),m=p.rendererFactory.createRenderer(null,l),f=r?r$(m,r,l.encapsulation,h):yZ(l,m),g=o?.some(AU)||s?.some(b=>typeof b!="function"&&b.bindings.some(AU)),_=QI(null,c,null,512|b5(l),null,null,p,m,h,null,p5(f,h,!0));_[Hs]=f,zb(_);let v=null;try{let b=$5(Hs,c,_,"#host",()=>c.directiveRegistry,!0,0);f&&(w5(m,f,b),k_(f,_)),KI(c,_,b),f5(c,b,_),Z5(c,b),i!==void 0&&bZ(b,this.ngContentSelectors,i),v=Mo(b.index,_),_[nn]=v[nn],JI(c,_,null)}catch(b){throw v!==null&&wI(v),wI(_),b}finally{Ii(23),Gb()}return new cC(this.componentType,_,!!g)}finally{Et(a)}}};function vZ(e,t,i,r){let n=e?["ng-version","20.0.2"]:Z7(t.selectors[0]),s=null,o=null,a=0;if(i)for(let h of i)a+=h[AI].requiredVars,h.create&&(h.targetIdx=0,(s??=[]).push(h)),h.update&&(h.targetIdx=0,(o??=[]).push(h));if(r)for(let h=0;h<r.length;h++){let p=r[h];if(typeof p!="function")for(let m of p.bindings){a+=m[AI].requiredVars;let f=h+1;m.create&&(m.targetIdx=f,(s??=[]).push(m)),m.update&&(m.targetIdx=f,(o??=[]).push(m))}}let l=[t];if(r)for(let h of r){let p=typeof h=="function"?h:h.type,m=OS(p);l.push(m)}return ZI(0,null,wZ(s,o),1,a,l,null,null,null,[n],null)}function wZ(e,t){return!e&&!t?null:i=>{if(i&1&&e)for(let r of e)r.create();if(i&2&&t)for(let r of t)r.update()}}function AU(e){let t=e[AI].kind;return t==="input"||t==="twoWay"}var cC=class extends z5{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,i,r){super(),this._rootLView=i,this._hasInputBindings=r,this._tNode=C_(i[Dt],Hs),this.location=km(this._tNode,i),this.instance=Mo(this._tNode.index,i)[nn],this.hostView=this.changeDetectorRef=new xu(i,void 0),this.componentType=t}setInput(t,i){this._hasInputBindings;let r=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;let n=this._rootLView,s=XI(r,n[Dt],n,t,i);this.previousInputValues.set(t,i);let o=Mo(r.index,n);aA(o,1)}get injector(){return new mh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function bZ(e,t,i){let r=e.projection=[];for(let n=0;n<t.length;n++){let s=i[n];r.push(s!=null&&s.length?Array.from(s):null)}}var Bm=(()=>{class e{static __NG_ELEMENT_ID__=CZ}return e})();function CZ(){let e=ms();return J5(e,hi())}var TZ=Bm,X5=class extends TZ{_lContainer;_hostTNode;_hostLView;constructor(t,i,r){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=r}get element(){return km(this._hostTNode,this._hostLView)}get injector(){return new mh(this._hostTNode,this._hostLView)}get parentInjector(){let t=GI(this._hostTNode,this._hostLView);if(YU(t)){let i=nC(t,this._hostLView),r=rC(t),n=i[Dt].data[r+8];return new mh(n,i)}else return new mh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let i=RU(this._lContainer);return i!==null&&i[t]||null}get length(){return this._lContainer.length-vn}createEmbeddedView(t,i,r){let n,s;typeof r=="number"?n=r:r!=null&&(n=r.index,s=r.injector);let o=TU(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(i||{},s,o);return this.insertImpl(a,n,DI(this._hostTNode,o)),a}createComponent(t,i,r,n,s,o,a){let l=t&&!a7(t),c;if(l)c=i;else{let v=i||{};c=v.index,r=v.injector,n=v.projectableNodes,s=v.environmentInjector||v.ngModuleRef,o=v.directives,a=v.bindings}let h=l?t:new O_(ih(t)),p=r||this.parentInjector;if(!s&&h.ngModule==null){let b=(l?p:this.parentInjector).get(ps,null);b&&(s=b)}let m=ih(h.componentType??{}),f=TU(this._lContainer,m?.id??null),g=f?.firstChild??null,_=h.create(p,n,g,s,o,a);return this.insertImpl(_.hostView,c,DI(this._hostTNode,f)),_}insert(t,i){return this.insertImpl(t,i,!0)}insertImpl(t,i,r){let n=t._lView;if(HB(n)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let l=n[Wr],c=new X5(l,l[Eo],l[Wr]);c.detach(c.indexOf(t))}}let s=this._adjustIndex(i),o=this._lContainer;return U5(o,n,s,r),t.attachToViewContainerRef(),AS(dI(o),s,t),t}move(t,i){return this.insert(t,i)}indexOf(t){let i=RU(this._lContainer);return i!==null?i.indexOf(t):-1}remove(t){let i=this._adjustIndex(t,-1),r=lC(this._lContainer,i);r&&(f_(dI(this._lContainer),i),rA(r[Dt],r))}detach(t){let i=this._adjustIndex(t,-1),r=lC(this._lContainer,i);return r&&f_(dI(this._lContainer),i)!=null?new xu(r):null}_adjustIndex(t,i=0){return t??this.length+i}};function RU(e){return e[b_]}function dI(e){return e[b_]||(e[b_]=[])}function J5(e,t){let i,r=t[e.index];return fa(r)?i=r:(i=B5(r,t,null,e),t[e.index]=i,YI(t,i)),DZ(i,t,e,r),new X5(i,e,t)}function EZ(e,t){let i=e[pr],r=i.createComment(""),n=ga(t,e),s=i.parentNode(n);return aC(i,s,r,i.nextSibling(n),!1),r}var DZ=SZ,xZ=()=>!1;function MZ(e,t,i){return xZ(e,t,i)}function SZ(e,t,i,r){if(e[Tu])return;let n;i.type&8?n=xo(r):n=EZ(t,i),e[Tu]=n}var PI=class e{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new e(this.queryList)}setDirty(){this.queryList.setDirty()}},OI=class e{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let i=t.queries;if(i!==null){let r=t.contentQueries!==null?t.contentQueries[0]:i.length,n=[];for(let s=0;s<r;s++){let o=i.getByIndex(s),a=this.queries[o.indexInDeclarationView];n.push(a.clone())}return new e(n)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)dA(t,i).matches!==null&&this.queries[i].setDirty()}},NI=class{flags;read;predicate;constructor(t,i,r=null){this.flags=i,this.read=r,typeof t=="string"?this.predicate=FZ(t):this.predicate=t}},LI=class e{queries;constructor(t=[]){this.queries=t}elementStart(t,i){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let r=0;r<this.length;r++){let n=i!==null?i.length:0,s=this.getByIndex(r).embeddedTView(t,n);s&&(s.indexInDeclarationView=r,i!==null?i.push(s):i=[s])}return i!==null?new e(i):null}template(t,i){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},FI=class e{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,i=-1){this.metadata=t,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new e(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,r=t.parent;for(;r!==null&&r.type&8&&r.index!==i;)r=r.parent;return i===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(t,i){let r=this.metadata.predicate;if(Array.isArray(r))for(let n=0;n<r.length;n++){let s=r[n];this.matchTNodeWithReadOption(t,i,IZ(i,s)),this.matchTNodeWithReadOption(t,i,eC(i,t,s,!1,!1))}else r===gh?i.type&4&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,eC(i,t,r,!1,!1))}matchTNodeWithReadOption(t,i,r){if(r!==null){let n=this.metadata.read;if(n!==null)if(n===lc||n===Bm||n===gh&&i.type&4)this.addMatch(i.index,-2);else{let s=eC(i,t,n,!1,!1);s!==null&&this.addMatch(i.index,s)}else this.addMatch(i.index,r)}}addMatch(t,i){this.matches===null?this.matches=[t,i]:this.matches.push(t,i)}};function IZ(e,t){let i=e.localNames;if(i!==null){for(let r=0;r<i.length;r+=2)if(i[r]===t)return i[r+1]}return null}function AZ(e,t){return e.type&11?km(e,t):e.type&4?lA(e,t):null}function RZ(e,t,i,r){return i===-1?AZ(t,e):i===-2?PZ(e,t,r):R_(e,e[Dt],i,t)}function PZ(e,t,i){if(i===lc)return km(t,e);if(i===gh)return lA(t,e);if(i===Bm)return J5(t,e)}function ej(e,t,i,r){let n=t[tl].queries[r];if(n.matches===null){let s=e.data,o=i.matches,a=[];for(let l=0;o!==null&&l<o.length;l+=2){let c=o[l];if(c<0)a.push(null);else{let h=s[c];a.push(RZ(t,h,o[l+1],i.metadata.read))}}n.matches=a}return n.matches}function kI(e,t,i,r){let n=e.queries.getByIndex(i),s=n.matches;if(s!==null){let o=ej(e,t,n,i);for(let a=0;a<s.length;a+=2){let l=s[a];if(l>0)r.push(o[a/2]);else{let c=s[a+1],h=t[-l];for(let p=vn;p<h.length;p++){let m=h[p];m[Cu]===m[Wr]&&kI(m[Dt],m,c,r)}if(h[ah]!==null){let p=h[ah];for(let m=0;m<p.length;m++){let f=p[m];kI(f[Dt],f,c,r)}}}}}return r}function OZ(e,t){return e[tl].queries[t].queryList}function NZ(e,t,i){let r=new oC((i&4)===4);return jB(e,t,r,r.destroy),(t[tl]??=new OI).queries.push(new PI(r))-1}function LZ(e,t,i){let r=$r();return r.firstCreatePass&&(kZ(r,new NI(e,t,i),-1),(t&2)===2&&(r.staticViewQueries=!0)),NZ(r,hi(),t)}function FZ(e){return e.split(",").map(t=>t.trim())}function kZ(e,t,i){e.queries===null&&(e.queries=new LI),e.queries.track(new FI(t,i))}function dA(e,t){return e.queries.getByIndex(t)}function VZ(e,t){let i=e[Dt],r=dA(i,t);return r.crossesNgTemplate?kI(i,e,t,[]):ej(i,e,r,t)}var PU=new Set;function Um(e){PU.has(e)||(PU.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}var uC=class{};var N_=class extends uC{injector;componentFactoryResolver=new RI(this);instance=null;constructor(t){super();let i=new eh([...t.providers,{provide:uC,useValue:this},{provide:wC,useValue:this.componentFactoryResolver}],t.parent||__(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function tj(e,t,i=null){return new N_({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}var HZ=(()=>{class e{_injector;cachedInjectors=new Map;constructor(i){this._injector=i}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){let r=NS(!1,i.type),n=r.length>0?tj([r],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,n)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=jt({token:e,providedIn:"environment",factory:()=>new e(It(ps))})}return e})();function Bs(e){return Fm(()=>{let t=ij(e),i=be(ie({},t),{decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===qI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:t.standalone?n=>n.get(HZ).getOrCreateStandaloneInjector(i):null,getExternalStyles:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||sc.Emulated,styles:e.styles||ks,_:null,schemas:e.schemas||null,tView:null,id:""});t.standalone&&Um("NgStandalone"),rj(i);let r=e.dependencies;return i.directiveDefs=OU(r,!1),i.pipeDefs=OU(r,!0),i.id=GZ(i),i})}function BZ(e){return ih(e)||OS(e)}function UZ(e){return e!==null}function ol(e){return Fm(()=>({type:e.type,bootstrap:e.bootstrap||ks,declarations:e.declarations||ks,imports:e.imports||ks,exports:e.exports||ks,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function jZ(e,t){if(e==null)return wu;let i={};for(let r in e)if(e.hasOwnProperty(r)){let n=e[r],s,o,a,l;Array.isArray(n)?(a=n[0],s=n[1],o=n[2]??s,l=n[3]||null):(s=n,o=n,a=_C.None,l=null),i[s]=[r,a,l],t[s]=o}return i}function zZ(e){if(e==null)return wu;let t={};for(let i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function gs(e){return Fm(()=>{let t=ij(e);return rj(t),t})}function ij(e){let t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputConfig:e.inputs||wu,exportAs:e.exportAs||null,standalone:e.standalone??!0,signals:e.signals===!0,selectors:e.selectors||ks,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:jZ(e.inputs,t),outputs:zZ(e.outputs),debugInfo:null}}function rj(e){e.features?.forEach(t=>t(e))}function OU(e,t){if(!e)return null;let i=t?IB:BZ;return()=>(typeof e=="function"?e():e).map(r=>i(r)).filter(UZ)}function GZ(e){let t=0,i=typeof e.consts=="function"?"":e.consts,r=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,i,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery];for(let s of r.join("|"))t=Math.imul(31,t)+s.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function qZ(e){return Object.getPrototypeOf(e.prototype).constructor}function al(e){let t=qZ(e.type),i=!0,r=[e];for(;t;){let n;if(rl(e))n=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new lt(903,!1);n=t.\u0275dir}if(n){if(i){r.push(n);let o=e;o.inputs=hI(e.inputs),o.declaredInputs=hI(e.declaredInputs),o.outputs=hI(e.outputs);let a=n.hostBindings;a&&YZ(e,a);let l=n.viewQuery,c=n.contentQueries;if(l&&ZZ(e,l),c&&QZ(e,c),WZ(e,n),bB(e.outputs,n.outputs),rl(n)&&n.data.animation){let h=e.data;h.animation=(h.animation||[]).concat(n.data.animation)}}let s=n.features;if(s)for(let o=0;o<s.length;o++){let a=s[o];a&&a.ngInherit&&a(e),a===al&&(i=!1)}}t=Object.getPrototypeOf(t)}$Z(r)}function WZ(e,t){for(let i in t.inputs){if(!t.inputs.hasOwnProperty(i)||e.inputs.hasOwnProperty(i))continue;let r=t.inputs[i];r!==void 0&&(e.inputs[i]=r,e.declaredInputs[i]=t.declaredInputs[i])}}function $Z(e){let t=0,i=null;for(let r=e.length-1;r>=0;r--){let n=e[r];n.hostVars=t+=n.hostVars,n.hostAttrs=A_(n.hostAttrs,i=A_(i,n.hostAttrs))}}function hI(e){return e===wu?{}:e===ks?[]:e}function ZZ(e,t){let i=e.viewQuery;i?e.viewQuery=(r,n)=>{t(r,n),i(r,n)}:e.viewQuery=t}function QZ(e,t){let i=e.contentQueries;i?e.contentQueries=(r,n,s)=>{t(r,n,s),i(r,n,s)}:e.contentQueries=t}function YZ(e,t){let i=e.hostBindings;i?e.hostBindings=(r,n)=>{t(r,n),i(r,n)}:e.hostBindings=t}function KZ(e,t,i,r,n,s,o,a,l){let c=t.consts,h=cA(t,e,4,o||null,a||null);$S()&&q5(t,i,h,ch(c,l),M5),h.mergedAttrs=A_(h.mergedAttrs,h.attrs),ZU(t,h);let p=h.tView=ZI(2,h,r,n,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return t.queries!==null&&(t.queries.template(t,h),p.queries=t.queries.embeddedTView(h)),h}function hA(e,t,i,r,n,s,o,a,l,c,h){let p=i+Hs,m=t.firstCreatePass?KZ(p,t,e,r,n,s,o,a,c):t.data[p];l&&(m.flags|=l),Rm(m,!1);let f=XZ(t,e,m,i);Wb()&&nA(t,e,f,m),k_(f,e);let g=B5(f,e,f,m);return e[p]=g,YI(e,g),MZ(g,m,e),Vb(m)&&KI(t,e,m),c!=null&&D5(e,m,h),m}function bC(e,t,i,r,n,s,o,a){let l=hi(),c=$r(),h=ch(c.consts,s);return hA(l,c,e,t,i,r,n,h,void 0,o,a),bC}var XZ=JZ;function JZ(e,t,i,r){return $b(!0),t[pr].createComment("")}var pA=function(e){return e[e.CHANGE_DETECTION=0]="CHANGE_DETECTION",e[e.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",e}(pA||{}),H_=new ut(""),nj=!1,VI=class extends Xa{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,kS()&&(this.destroyRef=ot(dh,{optional:!0})??void 0,this.pendingTasks=ot(ph,{optional:!0})??void 0)}emit(t){let i=Et(null);try{super.next(t)}finally{Et(i)}}subscribe(t,i,r){let n=t,s=i||(()=>null),o=r;if(t&&typeof t=="object"){let l=t;n=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=this.wrapInTimeout(s),n&&(n=this.wrapInTimeout(n)),o&&(o=this.wrapInTimeout(o)));let a=super.subscribe({next:n,error:s,complete:o});return t instanceof Bn&&t.add(a),a}wrapInTimeout(t){return i=>{let r=this.pendingTasks?.add();setTimeout(()=>{try{t(i)}finally{r!==void 0&&this.pendingTasks?.remove(r)}})}}},wn=VI;function sj(e){let t,i;function r(){e=M_;try{i!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(i),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{e(),r()}),typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(()=>{e(),r()})),()=>r()}function NU(e){return queueMicrotask(()=>e()),()=>{e=M_}}var mA="isAngularZone",dC=mA+"_ID",eQ=0,Ji=class e{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new wn(!1);onMicrotaskEmpty=new wn(!1);onStable=new wn(!1);onError=new wn(!1);constructor(t){let{enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:n=!1,scheduleInRootZone:s=nj}=t;if(typeof Zone>"u")throw new lt(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!n&&r,o.shouldCoalesceRunChangeDetection=n,o.callbackScheduled=!1,o.scheduleInRootZone=s,rQ(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(mA)===!0}static assertInAngularZone(){if(!e.isInAngularZone())throw new lt(909,!1)}static assertNotInAngularZone(){if(e.isInAngularZone())throw new lt(909,!1)}run(t,i,r){return this._inner.run(t,i,r)}runTask(t,i,r,n){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+n,t,tQ,M_,M_);try{return s.runTask(o,i,r)}finally{s.cancelTask(o)}}runGuarded(t,i,r){return this._inner.runGuarded(t,i,r)}runOutsideAngular(t){return this._outer.run(t)}},tQ={};function fA(e){if(e._nesting==0&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function iQ(e){if(e.isCheckStableRunning||e.callbackScheduled)return;e.callbackScheduled=!0;function t(){sj(()=>{e.callbackScheduled=!1,HI(e),e.isCheckStableRunning=!0,fA(e),e.isCheckStableRunning=!1})}e.scheduleInRootZone?Zone.root.run(()=>{t()}):e._outer.run(()=>{t()}),HI(e)}function rQ(e){let t=()=>{iQ(e)},i=eQ++;e._inner=e._inner.fork({name:"angular",properties:{[mA]:!0,[dC]:i,[dC+i]:!0},onInvokeTask:(r,n,s,o,a,l)=>{if(nQ(l))return r.invokeTask(s,o,a,l);try{return LU(e),r.invokeTask(s,o,a,l)}finally{(e.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||e.shouldCoalesceRunChangeDetection)&&t(),FU(e)}},onInvoke:(r,n,s,o,a,l,c)=>{try{return LU(e),r.invoke(s,o,a,l,c)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!sQ(l)&&t(),FU(e)}},onHasTask:(r,n,s,o)=>{r.hasTask(s,o),n===s&&(o.change=="microTask"?(e._hasPendingMicrotasks=o.microTask,HI(e),fA(e)):o.change=="macroTask"&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:(r,n,s,o)=>(r.handleError(s,o),e.runOutsideAngular(()=>e.onError.emit(o)),!1)})}function HI(e){e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&e.callbackScheduled===!0?e.hasPendingMicrotasks=!0:e.hasPendingMicrotasks=!1}function LU(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function FU(e){e._nesting--,fA(e)}var L_=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new wn;onMicrotaskEmpty=new wn;onStable=new wn;onError=new wn;run(t,i,r){return t.apply(i,r)}runGuarded(t,i,r){return t.apply(i,r)}runOutsideAngular(t){return t()}runTask(t,i,r,n){return t.apply(i,r)}};function nQ(e){return oj(e,"__ignore_ng_zone__")}function sQ(e){return oj(e,"__scheduler_tick__")}function oj(e,t){return!Array.isArray(e)||e.length!==1?!1:e[0]?.data?.[t]===!0}var aj=(()=>{class e{impl=null;execute(){this.impl?.execute()}static \u0275prov=jt({token:e,providedIn:"root",factory:()=>new e})}return e})();var CC=new ut(""),jm=new ut(""),B_=(()=>{class e{_ngZone;registry;_isZoneStable=!0;_callbacks=[];_taskTrackingZone=null;_destroyRef;constructor(i,r,n){this._ngZone=i,this.registry=r,kS()&&(this._destroyRef=ot(dh,{optional:!0})??void 0),gA||(lj(n),n.addToWindow(r)),this._watchAngularEvents(),i.run(()=>{this._taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){let i=this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),r=this._ngZone.runOutsideAngular(()=>this._ngZone.onStable.subscribe({next:()=>{Ji.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}}));this._destroyRef?.onDestroy(()=>{i.unsubscribe(),r.unsubscribe()})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb()}});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>r.updateCb&&r.updateCb(i)?(clearTimeout(r.timeoutId),!1):!0)}}getPendingTasks(){return this._taskTrackingZone?this._taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,r,n){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),i()},r)),this._callbacks.push({doneCb:i,timeoutId:s,updateCb:n})}whenStable(i,r,n){if(n&&!this._taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,r,n),this._runCallbacksIfReady()}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,r,n){return[]}static \u0275fac=function(r){return new(r||e)(It(Ji),It(U_),It(jm))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),U_=(()=>{class e{_applications=new Map;registerApplication(i,r){this._applications.set(i,r)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,r=!0){return gA?.findTestabilityInTree(this,i,r)??null}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function lj(e){gA=e}var gA;function j_(e){return!!e&&typeof e.then=="function"}function cj(e){return!!e&&typeof e.subscribe=="function"}var uj=new ut("");var _A=(()=>{class e{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r});appInits=ot(uj,{optional:!0})??[];injector=ot(vu);constructor(){}runInitializers(){if(this.initialized)return;let i=[];for(let n of this.appInits){let s=Dm(this.injector,n);if(j_(s))i.push(s);else if(cj(s)){let o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});i.push(o)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{r()}).catch(n=>{this.reject(n)}),i.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),dj=new ut("");function hj(){WM(()=>{let e="";throw new lt(600,e)})}function pj(e){return e.isBoundToModule}var oQ=10;var zm=(()=>{class e{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ot(nl);afterRenderManager=ot(aj);zonelessEnabled=ot(x_);rootEffectScheduler=ot(oI);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new Xa;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=ot(ph);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(hs(i=>!i))}constructor(){ot(H_,{optional:!0})}whenStable(){let i;return new Promise(r=>{i=this.isStable.subscribe({next:n=>{n&&r()}})}).finally(()=>{i.unsubscribe()})}_injector=ot(ps);_rendererFactory=null;get injector(){return this._injector}bootstrap(i,r){return this.bootstrapImpl(i,r)}bootstrapImpl(i,r,n=vu.NULL){return this._injector.get(Ji).run(()=>{Ii(10);let o=i instanceof vC;if(!this._injector.get(_A).done){let g="";throw new lt(405,g)}let l;o?l=i:l=this._injector.get(wC).resolveComponentFactory(i),this.componentTypes.push(l.componentType);let c=pj(l)?void 0:this._injector.get(uC),h=r||l.selector,p=l.create(n,[],h,c),m=p.location.nativeElement,f=p.injector.get(CC,null);return f?.registerApplication(m),p.onDestroy(()=>{this.detachView(p.hostView),I_(this.components,p),f?.unregisterApplication(m)}),this._loadComponent(p),Ii(11,p),p})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Ii(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(pA.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new lt(101,!1);let i=Et(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Et(i),this.afterTick.next(),Ii(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(_h,null,{optional:!0}));let i=0;for(;this.dirtyFlags!==0&&i++<oQ;)Ii(14),this.synchronizeOnce(),Ii(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let i=!1;if(this.dirtyFlags&7){let r=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:n}of this.allViews){if(!r&&!T_(n))continue;let s=r&&!this.zonelessEnabled?0:1;oA(n,s),i=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}i||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:i})=>T_(i))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(i){let r=i;this._views.push(r),r.attachToAppRef(this)}detachView(i){let r=i;I_(this._views,r),r.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView);try{this.tick()}catch(n){this.internalErrorHandler(n)}this.components.push(i),this._injector.get(dj,[]).forEach(n=>n(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>I_(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new lt(406,!1);let i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function I_(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}function TC(e,t,i,r){let n=hi(),s=Pm();if(Hm(n,s,t)){let o=$r(),a=qb();h$(a,n,e,t,i,r)}return TC}function vh(e,t,i,r,n,s,o,a){Um("NgControlFlow");let l=hi(),c=$r(),h=ch(c.consts,s);return hA(l,c,e,t,i,r,n,h,256,o,a),yA}function yA(e,t,i,r,n,s,o,a){Um("NgControlFlow");let l=hi(),c=$r(),h=ch(c.consts,s);return hA(l,c,e,t,i,r,n,h,512,o,a),yA}function wh(e,t){Um("NgControlFlow");let i=hi(),r=Pm(),n=i[r]!==cc?i[r]:-1,s=n!==-1?kU(i,Hs+n):void 0,o=0;if(Hm(i,r,e)){let a=Et(null);try{if(s!==void 0&&$$(s,o),e!==-1){let l=Hs+e,c=kU(i,l),h=aQ(i[Dt],l),p=tZ(c,h,i),m=S5(i,h,t,{dehydratedView:p});U5(c,m,o,DI(h,p))}}finally{Et(a)}}else if(s!==void 0){let a=W$(s,o);a!==void 0&&(a[nn]=t)}}function kU(e,t){return e[t]}function aQ(e,t){return C_(e,t)}function bh(e,t,i){let r=hi(),n=Pm();if(Hm(r,n,t)){let s=$r(),o=qb();x5(o,r,e,t,r[pr],i)}return bh}function VU(e,t,i,r,n){XI(t,e,i,n?"class":"style",r)}function Ai(e,t,i,r){let n=hi(),s=$r(),o=Hs+e,a=n[pr],l=s.firstCreatePass?$5(o,s,n,t,M5,$S(),i,r):s.data[o],c=lQ(s,n,l,a,t,e);n[o]=c;let h=Vb(l);return Rm(l,!0),w5(a,c,l),!tA(l)&&Wb()&&nA(s,n,c,l),(zB()===0||h)&&k_(c,n),GB(),h&&(KI(s,n,l),f5(s,l,n)),r!==null&&D5(n,l),Ai}function mr(){let e=ms();QS()?YB():(e=e.parent,Rm(e,!1));let t=e;$B(t)&&ZB(),qB();let i=$r();return i.firstCreatePass&&Z5(i,t),t.classesWithoutHost!=null&&p7(t)&&VU(i,t,hi(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&m7(t)&&VU(i,t,hi(),t.stylesWithoutHost,!1),mr}function Un(e,t,i,r){return Ai(e,t,i,r),mr(),Un}var lQ=(e,t,i,r,n,s)=>($b(!0),y5(r,n,aU()));function z_(){return hi()}var G_="en-US";var cQ=G_;function mj(e){typeof e=="string"&&(cQ=e.toLowerCase().replace(/_/g,"-"))}function _s(e,t,i){let r=hi(),n=$r(),s=ms();return fj(n,r,r[pr],s,e,t,i),_s}function fj(e,t,i,r,n,s,o){let a=!0,l=null;if((r.type&3||o)&&(l??=uI(r,t,s),hZ(r,e,t,o,i,n,s,l)&&(a=!1)),a){let c=r.outputs?.[n],h=r.hostDirectiveOutputs?.[n];if(h&&h.length)for(let p=0;p<h.length;p+=2){let m=h[p],f=h[p+1];l??=uI(r,t,s),IU(r,t,m,f,n,l)}if(c&&c.length)for(let p of c)l??=uI(r,t,s),IU(r,t,p,n,n,l)}}function Ch(e=1){return oU(e)}function vA(e,t,i){LZ(e,t,i)}function wA(e){let t=hi(),i=$r(),r=JS();jb(r+1);let n=dA(i,r);if(e.dirty&&VB(t)===((n.metadata.flags&2)===2)){if(n.matches===null)e.reset([]);else{let s=VZ(t,r);e.reset(s,M7),e.notifyOnChanges()}return!0}return!1}function bA(){return OZ(hi(),JS())}function Kb(e,t){return e<<17|t<<2}function yh(e){return e>>17&32767}function uQ(e){return(e&2)==2}function dQ(e,t){return e&131071|t<<17}function BI(e){return e|2}function Lm(e){return(e&131068)>>2}function pI(e,t){return e&-131069|t<<2}function hQ(e){return(e&1)===1}function UI(e){return e|1}function pQ(e,t,i,r,n,s){let o=s?t.classBindings:t.styleBindings,a=yh(o),l=Lm(o);e[r]=i;let c=!1,h;if(Array.isArray(i)){let p=i;h=p[1],(h===null||Em(p,h)>0)&&(c=!0)}else h=i;if(n)if(l!==0){let m=yh(e[a+1]);e[r+1]=Kb(m,a),m!==0&&(e[m+1]=pI(e[m+1],r)),e[a+1]=dQ(e[a+1],r)}else e[r+1]=Kb(a,0),a!==0&&(e[a+1]=pI(e[a+1],r)),a=r;else e[r+1]=Kb(l,0),a===0?a=r:e[l+1]=pI(e[l+1],r),l=r;c&&(e[r+1]=BI(e[r+1])),HU(e,h,r,!0),HU(e,h,r,!1),mQ(t,h,e,r,s),o=Kb(a,l),s?t.classBindings=o:t.styleBindings=o}function mQ(e,t,i,r,n){let s=n?e.residualClasses:e.residualStyles;s!=null&&typeof t=="string"&&Em(s,t)>=0&&(i[r+1]=UI(i[r+1]))}function HU(e,t,i,r){let n=e[i+1],s=t===null,o=r?yh(n):Lm(n),a=!1;for(;o!==0&&(a===!1||s);){let l=e[o],c=e[o+1];fQ(l,t)&&(a=!0,e[o+1]=r?UI(c):BI(c)),o=r?yh(c):Lm(c)}a&&(e[i+1]=r?BI(n):UI(n))}function fQ(e,t){return e===null||t==null||(Array.isArray(e)?e[1]:e)===t?!0:Array.isArray(e)&&typeof t=="string"?Em(e,t)>=0:!1}function ya(e,t){return gQ(e,t,null,!0),ya}function gQ(e,t,i,r){let n=hi(),s=$r(),o=XB(2);if(s.firstUpdatePass&&yQ(s,e,o,r),t!==cc&&Hm(n,o,t)){let a=s.data[uh()];TQ(s,a,n,n[pr],e,n[o+1]=EQ(t,i),r,o)}}function _Q(e,t){return t>=e.expandoStartIndex}function yQ(e,t,i,r){let n=e.data;if(n[i+1]===null){let s=n[uh()],o=_Q(e,i);DQ(s,r)&&t===null&&!o&&(t=!1),t=vQ(n,s,t,r),pQ(n,s,t,i,o,r)}}function vQ(e,t,i,r){let n=iU(e),s=r?t.residualClasses:t.residualStyles;if(n===null)(r?t.classBindings:t.styleBindings)===0&&(i=mI(null,e,t,i,r),i=F_(i,t.attrs,r),s=null);else{let o=t.directiveStylingLast;if(o===-1||e[o]!==n)if(i=mI(n,e,t,i,r),s===null){let l=wQ(e,t,r);l!==void 0&&Array.isArray(l)&&(l=mI(null,e,t,l[1],r),l=F_(l,t.attrs,r),bQ(e,t,r,l))}else s=CQ(e,t,r)}return s!==void 0&&(r?t.residualClasses=s:t.residualStyles=s),i}function wQ(e,t,i){let r=i?t.classBindings:t.styleBindings;if(Lm(r)!==0)return e[yh(r)]}function bQ(e,t,i,r){let n=i?t.classBindings:t.styleBindings;e[yh(n)]=r}function CQ(e,t,i){let r,n=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<n;s++){let o=e[s].hostAttrs;r=F_(r,o,i)}return F_(r,t.attrs,i)}function mI(e,t,i,r,n){let s=null,o=i.directiveEnd,a=i.directiveStylingLast;for(a===-1?a=i.directiveStart:a++;a<o&&(s=t[a],r=F_(r,s.hostAttrs,n),s!==e);)a++;return e!==null&&(i.directiveStylingLast=a),r}function F_(e,t,i){let r=i?1:2,n=-1;if(t!==null)for(let s=0;s<t.length;s++){let o=t[s];typeof o=="number"?n=o:n===r&&(Array.isArray(e)||(e=e===void 0?[]:["",e]),SB(e,o,i?!0:t[++s]))}return e===void 0?null:e}function TQ(e,t,i,r,n,s,o,a){if(!(t.type&3))return;let l=e.data,c=l[a+1],h=hQ(c)?BU(l,t,i,n,Lm(c),o):void 0;if(!hC(h)){hC(s)||uQ(c)&&(s=BU(l,null,i,n,a,o));let p=US(uh(),i);O$(r,o,p,n,s)}}function BU(e,t,i,r,n,s){let o=t===null,a;for(;n>0;){let l=e[n],c=Array.isArray(l),h=c?l[1]:l,p=h===null,m=i[n+1];m===cc&&(m=p?ks:void 0);let f=p?Lb(m,r):h===r?m:void 0;if(c&&!hC(f)&&(f=Lb(l,r)),hC(f)&&(a=f,o))return a;let g=e[n+1];n=o?yh(g):Lm(g)}if(t!==null){let l=s?t.residualClasses:t.residualStyles;l!=null&&(a=Lb(l,r))}return a}function hC(e){return e!==void 0}function EQ(e,t){return e==null||e===""||(typeof t=="string"?e=e+t:typeof e=="object"&&(e=Fs(g5(e)))),e}function DQ(e,t){return(e.flags&(t?8:16))!==0}function jn(e,t=""){let i=hi(),r=$r(),n=e+Hs,s=r.firstCreatePass?cA(r,n,1,t,null):r.data[n],o=xQ(r,i,s,t,e);i[n]=o,Wb()&&nA(r,i,o,s),Rm(s,!1)}var xQ=(e,t,i,r,n)=>($b(!0),Q7(t[pr],r));function MQ(e,t,i,r=""){return Hm(e,Pm(),i)?t+Pb(i)+r:cc}function Gm(e){return CA("",e),Gm}function CA(e,t,i){let r=hi(),n=MQ(r,e,t,i);return n!==cc&&SQ(r,uh(),n),CA}function SQ(e,t,i){let r=US(t,e);Y7(e[pr],r,i)}function qm(e,t,i){nI(t)&&(t=t());let r=hi(),n=Pm();if(Hm(r,n,t)){let s=$r(),o=qb();x5(o,r,e,t,r[pr],i)}return qm}function q_(e,t){let i=nI(e);return i&&e.set(t),i}function Wm(e,t){let i=hi(),r=$r(),n=ms();return fj(r,i,i[pr],n,e,t),Wm}function IQ(e,t,i){let r=$r();if(r.firstCreatePass){let n=rl(e);jI(i,r.data,r.blueprint,n,!0),jI(t,r.data,r.blueprint,n,!1)}}function jI(e,t,i,r,n){if(e=rn(e),Array.isArray(e))for(let s=0;s<e.length;s++)jI(e[s],t,i,r,n);else{let s=$r(),o=hi(),a=ms(),l=Jd(e)?e:rn(e.provide),c=FS(e),h=a.providerIndexes&1048575,p=a.directiveStart,m=a.providerIndexes>>20;if(Jd(e)||!e.multi){let f=new fh(c,n,Lt),g=gI(l,t,n?h:h+m,p);g===-1?(yI(sC(a,o),s,l),fI(s,e,t.length),t.push(l),a.directiveStart++,a.directiveEnd++,n&&(a.providerIndexes+=1048576),i.push(f),o.push(f)):(i[g]=f,o[g]=f)}else{let f=gI(l,t,h+m,p),g=gI(l,t,h,h+m),_=f>=0&&i[f],v=g>=0&&i[g];if(n&&!v||!n&&!_){yI(sC(a,o),s,l);let b=PQ(n?RQ:AQ,i.length,n,r,c);!n&&v&&(i[g].providerFactory=b),fI(s,e,t.length,0),t.push(l),a.directiveStart++,a.directiveEnd++,n&&(a.providerIndexes+=1048576),i.push(b),o.push(b)}else{let b=gj(i[n?g:f],c,!n&&r);fI(s,e,f>-1?f:g,b)}!n&&r&&v&&i[g].componentProviders++}}}function fI(e,t,i,r){let n=Jd(t),s=NB(t);if(n||s){let l=(s?rn(t.useClass):t).prototype.ngOnDestroy;if(l){let c=e.destroyHooks||(e.destroyHooks=[]);if(!n&&t.multi){let h=c.indexOf(i);h===-1?c.push(i,[r,l]):c[h+1].push(r,l)}else c.push(i,l)}}}function gj(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function gI(e,t,i,r){for(let n=i;n<r;n++)if(t[n]===e)return n;return-1}function AQ(e,t,i,r){return zI(this.multi,[])}function RQ(e,t,i,r){let n=this.multi,s;if(this.providerFactory){let o=this.providerFactory.componentProviders,a=R_(i,i[Dt],this.providerFactory.index,r);s=a.slice(0,o),zI(n,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],zI(n,s);return s}function zI(e,t){for(let i=0;i<e.length;i++){let r=e[i];t.push(r())}return t}function PQ(e,t,i,r,n){let s=new fh(e,i,Lt);return s.multi=[],s.index=t,s.componentProviders=0,gj(s,n,r&&!i),s}function $m(e,t=[]){return i=>{i.providersResolver=(r,n)=>IQ(r,n?n(e):e,t)}}var OQ=(()=>{class e{zone=ot(Ji);changeDetectionScheduler=ot(ic);applicationRef=ot(zm);applicationErrorHandler=ot(nl);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(i){this.applicationErrorHandler(i)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function _j({ngZoneFactory:e,ignoreChangesOutsideZone:t,scheduleInRootZone:i}){return e??=()=>new Ji(be(ie({},yj()),{scheduleInRootZone:i})),[{provide:Ji,useFactory:e},{provide:bu,multi:!0,useFactory:()=>{let r=ot(OQ,{optional:!0});return()=>r.initialize()}},{provide:bu,multi:!0,useFactory:()=>{let r=ot(NQ);return()=>{r.initialize()}}},t===!0?{provide:sI,useValue:!0}:[],{provide:Zb,useValue:i??nj},{provide:nl,useFactory:()=>{let r=ot(Ji),n=ot(ps),s;return o=>{s??=n.get(Ja),r.runOutsideAngular(()=>s.handleError(o))}}}]}function yj(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}var NQ=(()=>{class e{subscription=new Bn;initialized=!1;zone=ot(Ji);pendingTasks=ot(ph);initialize(){if(this.initialized)return;this.initialized=!0;let i=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(i=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ji.assertNotInAngularZone(),queueMicrotask(()=>{i!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(i),i=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ji.assertInAngularZone(),i??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var TA=(()=>{class e{applicationErrorHandler=ot(nl);appRef=ot(zm);taskService=ot(ph);ngZone=ot(Ji);zonelessEnabled=ot(x_);tracing=ot(H_,{optional:!0});disableScheduling=ot(sI,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Bn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(dC):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ot(Zb,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof L_||!this.zoneIsDefined)}notify(i){if(!this.zonelessEnabled&&i===5)return;let r=!1;switch(i){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{this.appRef.dirtyFlags|=16,r=!0;break}case 13:{this.appRef.dirtyFlags|=2,r=!0;break}case 11:{r=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let n=this.useMicrotaskScheduler?NU:sj;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>n(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>n(()=>this.tick()))}shouldScheduleTick(i){return!(this.disableScheduling&&!i||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(dC+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let i=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){this.taskService.remove(i),this.applicationErrorHandler(r)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,NU(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(i)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let i=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(i)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function EA(){return Um("NgZoneless"),rh([{provide:ic,useExisting:TA},{provide:Ji,useClass:L_},{provide:x_,useValue:!0},{provide:Zb,useValue:!1},[]])}function LQ(){return typeof $localize<"u"&&$localize.locale||G_}var DA=new ut("",{providedIn:"root",factory:()=>ot(DA,{optional:!0,skipSelf:!0})||LQ()});function uc(e){return _B(e)}function Zm(e,t){return nb(e,t?.equal)}var vj=class{[ls];constructor(t){this[ls]=t}destroy(){this[ls].destroy()}};var BQ=new ut("");BQ.__NG_ELEMENT_ID__=e=>{let t=ms();if(t===null)throw new lt(204,!1);if(t.type&2)return t.value;if(e&8)return null;throw new lt(204,!1)};var xA=new ut(""),UQ=new ut("");function W_(e){return!e.moduleRef}function jQ(e){let t=W_(e)?e.r3Injector:e.moduleRef.injector,i=t.get(Ji);return i.run(()=>{W_(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();let r=t.get(nl),n;if(i.runOutsideAngular(()=>{n=i.onError.subscribe({next:r})}),W_(e)){let s=()=>t.destroy(),o=e.platformInjector.get(xA);o.add(s),t.onDestroy(()=>{n.unsubscribe(),o.delete(s)})}else{let s=()=>e.moduleRef.destroy(),o=e.platformInjector.get(xA);o.add(s),e.moduleRef.onDestroy(()=>{I_(e.allPlatformModules,e.moduleRef),n.unsubscribe(),o.delete(s)})}return GQ(r,i,()=>{let s=t.get(_A);return s.runInitializers(),s.donePromise.then(()=>{let o=t.get(DA,G_);if(mj(o||G_),!t.get(UQ,!0))return W_(e)?t.get(zm):(e.allPlatformModules.push(e.moduleRef),e.moduleRef);if(W_(e)){let l=t.get(zm);return e.rootComponent!==void 0&&l.bootstrap(e.rootComponent),l}else return zQ?.(e.moduleRef,e.allPlatformModules),e.moduleRef})})})}var zQ;function GQ(e,t,i){try{let r=i();return j_(r)?r.catch(n=>{throw t.runOutsideAngular(()=>e(n)),n}):r}catch(r){throw t.runOutsideAngular(()=>e(r)),r}}var EC=null;function qQ(e=[],t){return vu.create({name:t,providers:[{provide:g_,useValue:"platform"},{provide:xA,useValue:new Set([()=>EC=null])},...e]})}function WQ(e=[]){if(EC)return EC;let t=qQ(e);return EC=t,hj(),$Q(t),t}function $Q(e){let t=e.get(fC,null);Dm(e,()=>{t?.forEach(i=>i())})}var dc=(()=>{class e{static __NG_ELEMENT_ID__=ZQ}return e})();function ZQ(e){return QQ(ms(),hi(),(e&16)===16)}function QQ(e,t,i){if(Eu(e)&&!i){let r=Mo(e.index,t);return new xu(r,r)}else if(e.type&175){let r=t[Do];return new xu(r,t)}return null}var MA=class{constructor(){}supports(t){return uA(t)}create(t){return new SA(t)}},YQ=(e,t)=>t,SA=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||YQ}forEachItem(t){let i;for(i=this._itHead;i!==null;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,r=this._removalsHead,n=0,s=null;for(;i||r;){let o=!r||i&&i.currentIndex<wj(r,n,s)?i:r,a=wj(o,n,s),l=o.currentIndex;if(o===r)n--,r=r._nextRemoved;else if(i=i._next,o.previousIndex==null)n++;else{s||(s=[]);let c=a-n,h=l-n;if(c!=h){for(let m=0;m<c;m++){let f=m<s.length?s[m]:s[m]=0,g=f+m;h<=g&&g<c&&(s[m]=f+1)}let p=o.previousIndex;s[p]=h-c}}a!==l&&t(o,a,l)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;i!==null;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;i!==null;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;i!==null;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;i!==null;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;i!==null;i=i._nextIdentityChange)t(i)}diff(t){if(t==null&&(t=[]),!uA(t))throw new lt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._itHead,r=!1,n,s,o;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)s=t[a],o=this._trackByFn(a,s),i===null||!Object.is(i.trackById,o)?(i=this._mismatch(i,s,o,a),r=!0):(r&&(i=this._verifyReinsertion(i,s,o,a)),Object.is(i.item,s)||this._addIdentityChange(i,s)),i=i._next}else n=0,Q5(t,a=>{o=this._trackByFn(n,a),i===null||!Object.is(i.trackById,o)?(i=this._mismatch(i,a,o,n),r=!0):(r&&(i=this._verifyReinsertion(i,a,o,n)),Object.is(i.item,a)||this._addIdentityChange(i,a)),i=i._next,n++}),this.length=n;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,r,n){let s;return t===null?s=this._itTail:(s=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,s,n)):(t=this._linkedRecords===null?null:this._linkedRecords.get(r,n),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,s,n)):t=this._addAfter(new IA(i,r),s,n)),t}_verifyReinsertion(t,i,r,n){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return s!==null?t=this._reinsertAfter(s,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n,this._addToMoves(t,n)),t}_truncate(t){for(;t!==null;){let i=t._next;this._addToRemovals(this._unlink(t)),t=i}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let n=t._prevRemoved,s=t._nextRemoved;return n===null?this._removalsHead=s:n._nextRemoved=s,s===null?this._removalsTail=n:s._prevRemoved=n,this._insertAfter(t,i,r),this._addToMoves(t,r),t}_moveAfter(t,i,r){return this._unlink(t),this._insertAfter(t,i,r),this._addToMoves(t,r),t}_addAfter(t,i,r){return this._insertAfter(t,i,r),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,i,r){let n=i===null?this._itHead:i._next;return t._next=n,t._prev=i,n===null?this._itTail=t:n._prev=t,i===null?this._itHead=t:i._next=t,this._linkedRecords===null&&(this._linkedRecords=new DC),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let i=t._prev,r=t._next;return i===null?this._itHead=r:i._next=r,r===null?this._itTail=i:r._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new DC),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},IA=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,i){this.item=t,this.trackById=i}},AA=class{_head=null;_tail=null;add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let r;for(r=this._head;r!==null;r=r._nextDup)if((i===null||i<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){let i=t._prevDup,r=t._nextDup;return i===null?this._head=r:i._nextDup=r,r===null?this._tail=i:r._prevDup=i,this._head===null}},DC=class{map=new Map;put(t){let i=t.trackById,r=this.map.get(i);r||(r=new AA,this.map.set(i,r)),r.add(t)}get(t,i){let r=t,n=this.map.get(r);return n?n.get(t,i):null}remove(t){let i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function wj(e,t,i){let r=e.previousIndex;if(r===null)return r;let n=0;return i&&r<i.length&&(n=i[r]),r+t+n}function bj(){return new RA([new MA])}var RA=(()=>{class e{factories;static \u0275prov=jt({token:e,providedIn:"root",factory:bj});constructor(i){this.factories=i}static create(i,r){if(r!=null){let n=r.factories.slice();i=i.concat(n)}return new e(i)}static extend(i){return{provide:e,useFactory:r=>e.create(i,r||bj()),deps:[[e,new zU,new jU]]}}find(i){let r=this.factories.find(n=>n.supports(i));if(r!=null)return r;throw new lt(901,!1)}}return e})();var Cj=(()=>{class e{constructor(i){}static \u0275fac=function(r){return new(r||e)(It(zm))};static \u0275mod=ol({type:e});static \u0275inj=pa({})}return e})();function Tj(e){Ii(8);try{let{rootComponent:t,appProviders:i,platformProviders:r}=e,n=WQ(r),s=[_j({}),{provide:ic,useExisting:TA},uU,...i||[]],o=new N_({providers:s,parent:n,debugName:"",runEnvironmentInitializers:!1});return jQ({r3Injector:o.injector,platformInjector:n,rootComponent:t})}catch(t){return Promise.reject(t)}finally{Ii(9)}}function PA(e){return typeof e=="boolean"?e:e!=null&&e!=="false"}var Ej=null;function hc(){return Ej}function OA(e){Ej??=e}var $_=class{};var xC=class{$implicit;ngForOf;index;count;constructor(t,i,r,n){this.$implicit=t,this.ngForOf=i,this.index=r,this.count=n}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},MC=(()=>{class e{_viewContainer;_template;_differs;set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(i,r,n){this._viewContainer=i,this._template=r,this._differs=n}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){let i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){let r=this._viewContainer;i.forEachOperation((n,s,o)=>{if(n.previousIndex==null)r.createEmbeddedView(this._template,new xC(n.item,this._ngForOf,-1,-1),o===null?void 0:o);else if(o==null)r.remove(s===null?void 0:s);else if(s!==null){let a=r.get(s);r.move(a,o),Dj(a,n)}});for(let n=0,s=r.length;n<s;n++){let a=r.get(n).context;a.index=n,a.count=s,a.ngForOf=this._ngForOf}i.forEachIdentityChange(n=>{let s=r.get(n.currentIndex);Dj(s,n)})}static ngTemplateContextGuard(i,r){return!0}static \u0275fac=function(r){return new(r||e)(Lt(Bm),Lt(gh),Lt(RA))};static \u0275dir=gs({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return e})();function Dj(e,t){e.context.$implicit=t.item}var Z_=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ol({type:e});static \u0275inj=pa({})}return e})();function Q_(e,t){t=encodeURIComponent(t);for(let i of e.split(";")){let r=i.indexOf("="),[n,s]=r==-1?[i,""]:[i.slice(0,r),i.slice(r+1)];if(n.trim()===t)return decodeURIComponent(s)}return null}var Th=class{};var xj="browser",KQ="server";function Mj(e){return e===KQ}var AC=new ut(""),kA=(()=>{class e{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,r){this._zone=r,i.forEach(n=>{n.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,r,n,s){return this._findPluginFor(r).addEventListener(i,r,n,s)}getZone(){return this._zone}_findPluginFor(i){let r=this._eventNameToPlugin.get(i);if(r)return r;if(r=this._plugins.find(s=>s.supports(i)),!r)throw new lt(5101,!1);return this._eventNameToPlugin.set(i,r),r}static \u0275fac=function(r){return new(r||e)(It(AC),It(Ji))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),Y_=class{_doc;constructor(t){this._doc=t}manager},SC="ng-app-id";function Sj(e){for(let t of e)t.remove()}function Ij(e,t){let i=t.createElement("style");return i.textContent=e,i}function JQ(e,t,i,r){let n=e.head?.querySelectorAll(`style[${SC}="${t}"],link[${SC}="${t}"]`);if(n)for(let s of n)s.removeAttribute(SC),s instanceof HTMLLinkElement?r.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&i.set(s.textContent,{usage:0,elements:[s]})}function LA(e,t){let i=t.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",e),i}var VA=(()=>{class e{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(i,r,n,s={}){this.doc=i,this.appId=r,this.nonce=n,this.isServer=Mj(s),JQ(i,r,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,r){for(let n of i)this.addUsage(n,this.inline,Ij);r?.forEach(n=>this.addUsage(n,this.external,LA))}removeStyles(i,r){for(let n of i)this.removeUsage(n,this.inline);r?.forEach(n=>this.removeUsage(n,this.external))}addUsage(i,r,n){let s=r.get(i);s?s.usage++:r.set(i,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,n(i,this.doc)))})}removeUsage(i,r){let n=r.get(i);n&&(n.usage--,n.usage<=0&&(Sj(n.elements),r.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])Sj(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[r,{elements:n}]of this.inline)n.push(this.addElement(i,Ij(r,this.doc)));for(let[r,{elements:n}]of this.external)n.push(this.addElement(i,LA(r,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(SC,this.appId),i.appendChild(r)}static \u0275fac=function(r){return new(r||e)(It(fs),It(mC),It(gC,8),It(Vm))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),NA={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},HA=/%COMP%/g;var Rj="%COMP%",eY=`_nghost-${Rj}`,tY=`_ngcontent-${Rj}`,iY=!0,rY=new ut("",{providedIn:"root",factory:()=>iY});function nY(e){return tY.replace(HA,e)}function sY(e){return eY.replace(HA,e)}function Pj(e,t){return t.map(i=>i.replace(HA,e))}var BA=(()=>{class e{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,r,n,s,o,a,l,c=null,h=null){this.eventManager=i,this.sharedStylesHost=r,this.appId=n,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=h,this.platformIsServer=!1,this.defaultRenderer=new K_(i,o,l,this.platformIsServer,this.tracingService)}createRenderer(i,r){if(!i||!r)return this.defaultRenderer;let n=this.getOrCreateRenderer(i,r);return n instanceof IC?n.applyToHost(i):n instanceof X_&&n.applyStyles(),n}getOrCreateRenderer(i,r){let n=this.rendererByCompId,s=n.get(r.id);if(!s){let o=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,p=this.platformIsServer,m=this.tracingService;switch(r.encapsulation){case sc.Emulated:s=new IC(l,c,r,this.appId,h,o,a,p,m);break;case sc.ShadowDom:return new FA(l,c,i,r,o,a,this.nonce,p,m);default:s=new X_(l,c,r,h,o,a,p,m);break}n.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.delete(i)}static \u0275fac=function(r){return new(r||e)(It(kA),It(VA),It(mC),It(rY),It(fs),It(Vm),It(Ji),It(gC),It(H_,8))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),K_=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,i,r,n,s){this.eventManager=t,this.doc=i,this.ngZone=r,this.platformIsServer=n,this.tracingService=s}destroy(){}destroyNode=null;createElement(t,i){return i?this.doc.createElementNS(NA[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(Aj(t)?t.content:t).appendChild(i)}insertBefore(t,i,r){t&&(Aj(t)?t.content:t).insertBefore(i,r)}removeChild(t,i){i.remove()}selectRootElement(t,i){let r=typeof t=="string"?this.doc.querySelector(t):t;if(!r)throw new lt(-5104,!1);return i||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,r,n){if(n){i=n+":"+i;let s=NA[n];s?t.setAttributeNS(s,i,r):t.setAttribute(i,r)}else t.setAttribute(i,r)}removeAttribute(t,i,r){if(r){let n=NA[r];n?t.removeAttributeNS(n,i):t.removeAttribute(`${r}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,r,n){n&(oc.DashCase|oc.Important)?t.style.setProperty(i,r,n&oc.Important?"important":""):t.style[i]=r}removeStyle(t,i,r){r&oc.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,r){t!=null&&(t[i]=r)}setValue(t,i){t.nodeValue=i}listen(t,i,r,n){if(typeof t=="string"&&(t=hc().getGlobalEventTarget(this.doc,t),!t))throw new lt(5102,!1);let s=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(t,i,s)),this.eventManager.addEventListener(t,i,s,n)}decoratePreventDefault(t){return i=>{if(i==="__ngUnwrap__")return t;t(i)===!1&&i.preventDefault()}}};function Aj(e){return e.tagName==="TEMPLATE"&&e.content!==void 0}var FA=class extends K_{sharedStylesHost;hostEl;shadowRoot;constructor(t,i,r,n,s,o,a,l,c){super(t,s,o,l,c),this.sharedStylesHost=i,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=n.styles;h=Pj(n.id,h);for(let m of h){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=m,this.shadowRoot.appendChild(f)}let p=n.getExternalStyles?.();if(p)for(let m of p){let f=LA(m,s);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,r){return super.insertBefore(this.nodeOrShadowRoot(t),i,r)}removeChild(t,i){return super.removeChild(null,i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},X_=class extends K_{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,i,r,n,s,o,a,l,c){super(t,s,o,a,l),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=n;let h=r.styles;this.styles=c?Pj(c,h):h,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},IC=class extends X_{contentAttr;hostAttr;constructor(t,i,r,n,s,o,a,l,c){let h=n+"-"+r.id;super(t,i,r,s,o,a,l,c,h),this.contentAttr=nY(h),this.hostAttr=sY(h)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){let r=super.createElement(t,i);return super.setAttribute(r,this.contentAttr,""),r}};var RC=class e extends $_{supportsDOMEvents=!0;static makeCurrent(){OA(new e)}onAndCancel(t,i,r,n){return t.addEventListener(i,r,n),()=>{t.removeEventListener(i,r,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.remove()}createElement(t,i){return i=i||this.getDefaultDocument(),i.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return i==="window"?window:i==="document"?t:i==="body"?t.body:null}getBaseHref(t){let i=oY();return i==null?null:aY(i)}resetBaseElement(){J_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Q_(document.cookie,t)}},J_=null;function oY(){return J_=J_||document.head.querySelector("base"),J_?J_.getAttribute("href"):null}function aY(e){return new URL(e,document.baseURI).pathname}var PC=class{addToWindow(t){el.getAngularTestability=(r,n=!0)=>{let s=t.findTestabilityInTree(r,n);if(s==null)throw new lt(5103,!1);return s},el.getAllAngularTestabilities=()=>t.getAllTestabilities(),el.getAllAngularRootElements=()=>t.getAllRootElements();let i=r=>{let n=el.getAllAngularTestabilities(),s=n.length,o=function(){s--,s==0&&r()};n.forEach(a=>{a.whenStable(o)})};el.frameworkStabilizers||(el.frameworkStabilizers=[]),el.frameworkStabilizers.push(i)}findTestabilityInTree(t,i,r){if(i==null)return null;let n=t.getTestability(i);return n??(r?hc().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},lY=(()=>{class e{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),Nj=(()=>{class e extends Y_{constructor(i){super(i)}supports(i){return!0}addEventListener(i,r,n,s){return i.addEventListener(r,n,s),()=>this.removeEventListener(i,r,n,s)}removeEventListener(i,r,n,s){return i.removeEventListener(r,n,s)}static \u0275fac=function(r){return new(r||e)(It(fs))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),Oj=["alt","control","meta","shift"],cY={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},uY={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey},Lj=(()=>{class e extends Y_{constructor(i){super(i)}supports(i){return e.parseEventName(i)!=null}addEventListener(i,r,n,s){let o=e.parseEventName(r),a=e.eventCallback(o.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hc().onAndCancel(i,o.domEventName,a,s))}static parseEventName(i){let r=i.toLowerCase().split("."),n=r.shift();if(r.length===0||!(n==="keydown"||n==="keyup"))return null;let s=e._normalizeKey(r.pop()),o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),Oj.forEach(c=>{let h=r.indexOf(c);h>-1&&(r.splice(h,1),o+=c+".")}),o+=s,r.length!=0||s.length===0)return null;let l={};return l.domEventName=n,l.fullKey=o,l}static matchEventFullKeyCode(i,r){let n=cY[i.key]||i.key,s="";return r.indexOf("code.")>-1&&(n=i.code,s="code."),n==null||!n?!1:(n=n.toLowerCase(),n===" "?n="space":n==="."&&(n="dot"),Oj.forEach(o=>{if(o!==n){let a=uY[o];a(i)&&(s+=o+".")}}),s+=n,s===r)}static eventCallback(i,r,n){return s=>{e.matchEventFullKeyCode(s,i)&&n.runGuarded(()=>r(s))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(r){return new(r||e)(It(fs))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})();function UA(e,t){return Tj(ie({rootComponent:e},dY(t)))}function dY(e){return{appProviders:[...Fj,...e?.providers??[]],platformProviders:fY}}function hY(){RC.makeCurrent()}function pY(){return new Ja}function mY(){return WI(document),document}var fY=[{provide:Vm,useValue:xj},{provide:fC,useValue:hY,multi:!0},{provide:fs,useFactory:mY}];var gY=[{provide:jm,useClass:PC},{provide:CC,useClass:B_,deps:[Ji,U_,jm]},{provide:B_,useClass:B_,deps:[Ji,U_,jm]}],Fj=[{provide:g_,useValue:"root"},{provide:Ja,useFactory:pY},{provide:AC,useClass:Nj,multi:!0,deps:[fs]},{provide:AC,useClass:Lj,multi:!0,deps:[fs]},BA,VA,kA,{provide:_h,useExisting:BA},{provide:Th,useClass:lY},[]],jA=(()=>{class e{constructor(){}static \u0275fac=function(r){return new(r||e)};static \u0275mod=ol({type:e});static \u0275inj=pa({providers:[...Fj,...gY],imports:[Z_,Cj]})}return e})();var Km=class{},ey=class{},Mu=class e{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(i=>{let r=i.indexOf(":");if(r>0){let n=i.slice(0,r),s=i.slice(r+1).trim();this.addHeaderEntry(n,s)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,r)=>{this.addHeaderEntry(r,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,r])=>{this.setHeaderEntries(i,r)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){let i=new e;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){let i=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(t.name,i);let n=(t.op==="a"?this.headers.get(i):void 0)||[];n.push(...r),this.headers.set(i,n);break;case"d":let s=t.value;if(!s)this.headers.delete(i),this.normalizedNames.delete(i);else{let o=this.headers.get(i);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,o)}break}}addHeaderEntry(t,i){let r=t.toLowerCase();this.maybeSetNormalizedName(t,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}setHeaderEntries(t,i){let r=(Array.isArray(i)?i:[i]).map(s=>s.toString()),n=t.toLowerCase();this.headers.set(n,r),this.maybeSetNormalizedName(t,n)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}};var NC=class{encodeKey(t){return kj(t)}encodeValue(t){return kj(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function _Y(e,t){let i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(n=>{let s=n.indexOf("="),[o,a]=s==-1?[t.decodeKey(n),""]:[t.decodeKey(n.slice(0,s)),t.decodeValue(n.slice(s+1))],l=i.get(o)||[];l.push(a),i.set(o,l)}),i}var yY=/%(\d[a-f0-9])/gi,vY={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function kj(e){return encodeURIComponent(e).replace(yY,(t,i)=>vY[i]??t)}function OC(e){return`${e}`}var pc=class e{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new NC,t.fromString){if(t.fromObject)throw new lt(2805,!1);this.map=_Y(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{let r=t.fromObject[i],n=Array.isArray(r)?r.map(OC):[OC(r)];this.map.set(i,n)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){let i=[];return Object.keys(t).forEach(r=>{let n=t[r];Array.isArray(n)?n.forEach(s=>{i.push({param:r,value:s,op:"a"})}):i.push({param:r,value:n,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let i=this.encoder.encodeKey(t);return this.map.get(t).map(r=>i+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let i=new e({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let i=(t.op==="a"?this.map.get(t.param):void 0)||[];i.push(OC(t.value)),this.map.set(t.param,i);break;case"d":if(t.value!==void 0){let r=this.map.get(t.param)||[],n=r.indexOf(OC(t.value));n!==-1&&r.splice(n,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var LC=class{map=new Map;set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function wY(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Vj(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function Hj(e){return typeof Blob<"u"&&e instanceof Blob}function Bj(e){return typeof FormData<"u"&&e instanceof FormData}function bY(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}var Uj="Content-Type",jj="Accept",zj="X-Request-URL",Gj="text/plain",qj="application/json",CY=`${qj}, ${Gj}, */*`,Ym=class e{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;keepalive=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,i,r,n){this.url=i,this.method=t.toUpperCase();let s;if(wY(this.method)||n?(this.body=r!==void 0?r:null,s=n):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,this.keepalive=!!s.keepalive,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Mu,this.context??=new LC,!this.params)this.params=new pc,this.urlWithParams=i;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=i;else{let a=i.indexOf("?"),l=a===-1?"?":a<i.length-1?"&":"";this.urlWithParams=i+l+o}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||Vj(this.body)||Hj(this.body)||Bj(this.body)||bY(this.body)?this.body:this.body instanceof pc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Bj(this.body)?null:Hj(this.body)?this.body.type||null:Vj(this.body)?null:typeof this.body=="string"?Gj:this.body instanceof pc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?qj:null}clone(t={}){let i=t.method||this.method,r=t.url||this.url,n=t.responseType||this.responseType,s=t.keepalive??this.keepalive,o=t.transferCache??this.transferCache,a=t.body!==void 0?t.body:this.body,l=t.withCredentials??this.withCredentials,c=t.reportProgress??this.reportProgress,h=t.headers||this.headers,p=t.params||this.params,m=t.context??this.context;return t.setHeaders!==void 0&&(h=Object.keys(t.setHeaders).reduce((f,g)=>f.set(g,t.setHeaders[g]),h)),t.setParams&&(p=Object.keys(t.setParams).reduce((f,g)=>f.set(g,t.setParams[g]),p)),new e(i,r,a,{params:p,headers:h,context:m,reportProgress:c,responseType:n,withCredentials:l,transferCache:o,keepalive:s})}},Eh=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Eh||{}),Xm=class{headers;status;statusText;url;ok;type;constructor(t,i=200,r="OK"){this.headers=t.headers||new Mu,this.status=t.status!==void 0?t.status:i,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}},FC=class e extends Xm{constructor(t={}){super(t)}type=Eh.ResponseHeader;clone(t={}){return new e({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},ty=class e extends Xm{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=Eh.Response;clone(t={}){return new e({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},iy=class extends Xm{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},TY=200,EY=204;function zA(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache,keepalive:e.keepalive}}var VC=(()=>{class e{handler;constructor(i){this.handler=i}request(i,r,n={}){let s;if(i instanceof Ym)s=i;else{let l;n.headers instanceof Mu?l=n.headers:l=new Mu(n.headers);let c;n.params&&(n.params instanceof pc?c=n.params:c=new pc({fromObject:n.params})),s=new Ym(i,r,n.body!==void 0?n.body:null,{headers:l,context:n.context,params:c,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials,transferCache:n.transferCache,keepalive:n.keepalive})}let o=Eb(s).pipe(nS(l=>this.handler.handle(l)));if(i instanceof Ym||n.observe==="events")return o;let a=o.pipe(rS(l=>l instanceof ty));switch(n.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return a.pipe(hs(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new lt(2806,!1);return l.body}));case"blob":return a.pipe(hs(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new lt(2807,!1);return l.body}));case"text":return a.pipe(hs(l=>{if(l.body!==null&&typeof l.body!="string")throw new lt(2808,!1);return l.body}));case"json":default:return a.pipe(hs(l=>l.body))}case"response":return a;default:throw new lt(2809,!1)}}delete(i,r={}){return this.request("DELETE",i,r)}get(i,r={}){return this.request("GET",i,r)}head(i,r={}){return this.request("HEAD",i,r)}jsonp(i,r){return this.request("JSONP",i,{params:new pc().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,r={}){return this.request("OPTIONS",i,r)}patch(i,r,n={}){return this.request("PATCH",i,zA(n,r))}post(i,r,n={}){return this.request("POST",i,zA(n,r))}put(i,r,n={}){return this.request("PUT",i,zA(n,r))}static \u0275fac=function(r){return new(r||e)(It(Km))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})();var DY=new ut("");function xY(e,t){return t(e)}function MY(e,t,i){return(r,n)=>Dm(i,()=>t(r,s=>e(s,n)))}var Wj=new ut(""),$j=new ut(""),Zj=new ut("",{providedIn:"root",factory:()=>!0});var kC=(()=>{class e extends Km{backend;injector;chain=null;pendingTasks=ot(Qb);contributeToStability=ot(Zj);constructor(i,r){super(),this.backend=i,this.injector=r}handle(i){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(Wj),...this.injector.get($j,[])]));this.chain=r.reduceRight((n,s)=>MY(n,s,this.injector),xY)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(i,n=>this.backend.handle(n)).pipe(sS(r))}else return this.chain(i,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||e)(It(ey),It(ps))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})();var SY=/^\)\]\}',?\n/,IY=RegExp(`^${zj}:`,"m");function AY(e){return"responseURL"in e&&e.responseURL?e.responseURL:IY.test(e.getAllResponseHeaders())?e.getResponseHeader(zj):null}var GA=(()=>{class e{xhrFactory;constructor(i){this.xhrFactory=i}handle(i){if(i.method==="JSONP")throw new lt(-2800,!1);i.keepalive;let r=this.xhrFactory;return(r.\u0275loadImpl?Qd(r.\u0275loadImpl()):Eb(null)).pipe(oS(()=>new Xi(s=>{let o=r.build();if(o.open(i.method,i.urlWithParams),i.withCredentials&&(o.withCredentials=!0),i.headers.forEach((_,v)=>o.setRequestHeader(_,v.join(","))),i.headers.has(jj)||o.setRequestHeader(jj,CY),!i.headers.has(Uj)){let _=i.detectContentTypeHeader();_!==null&&o.setRequestHeader(Uj,_)}if(i.responseType){let _=i.responseType.toLowerCase();o.responseType=_!=="json"?_:"text"}let a=i.serializeBody(),l=null,c=()=>{if(l!==null)return l;let _=o.statusText||"OK",v=new Mu(o.getAllResponseHeaders()),b=AY(o)||i.url;return l=new FC({headers:v,status:o.status,statusText:_,url:b}),l},h=()=>{let{headers:_,status:v,statusText:b,url:x}=c(),E=null;v!==EY&&(E=typeof o.response>"u"?o.responseText:o.response),v===0&&(v=E?TY:0);let D=v>=200&&v<300;if(i.responseType==="json"&&typeof E=="string"){let M=E;E=E.replace(SY,"");try{E=E!==""?JSON.parse(E):null}catch(T){E=M,D&&(D=!1,E={error:T,text:E})}}D?(s.next(new ty({body:E,headers:_,status:v,statusText:b,url:x||void 0})),s.complete()):s.error(new iy({error:E,headers:_,status:v,statusText:b,url:x||void 0}))},p=_=>{let{url:v}=c(),b=new iy({error:_,status:o.status||0,statusText:o.statusText||"Unknown Error",url:v||void 0});s.error(b)},m=!1,f=_=>{m||(s.next(c()),m=!0);let v={type:Eh.DownloadProgress,loaded:_.loaded};_.lengthComputable&&(v.total=_.total),i.responseType==="text"&&o.responseText&&(v.partialText=o.responseText),s.next(v)},g=_=>{let v={type:Eh.UploadProgress,loaded:_.loaded};_.lengthComputable&&(v.total=_.total),s.next(v)};return o.addEventListener("load",h),o.addEventListener("error",p),o.addEventListener("timeout",p),o.addEventListener("abort",p),i.reportProgress&&(o.addEventListener("progress",f),a!==null&&o.upload&&o.upload.addEventListener("progress",g)),o.send(a),s.next({type:Eh.Sent}),()=>{o.removeEventListener("error",p),o.removeEventListener("abort",p),o.removeEventListener("load",h),o.removeEventListener("timeout",p),i.reportProgress&&(o.removeEventListener("progress",f),a!==null&&o.upload&&o.upload.removeEventListener("progress",g)),o.readyState!==o.DONE&&o.abort()}})))}static \u0275fac=function(r){return new(r||e)(It(Th))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})(),Qj=new ut(""),RY="XSRF-TOKEN",PY=new ut("",{providedIn:"root",factory:()=>RY}),OY="X-XSRF-TOKEN",NY=new ut("",{providedIn:"root",factory:()=>OY}),ry=class{},LY=(()=>{class e{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(i,r){this.doc=i,this.cookieName=r}getToken(){let i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=Q_(i,this.cookieName),this.lastCookieString=i),this.lastToken}static \u0275fac=function(r){return new(r||e)(It(fs),It(PY))};static \u0275prov=jt({token:e,factory:e.\u0275fac})}return e})();function FY(e,t){let i=e.url.toLowerCase();if(!ot(Qj)||e.method==="GET"||e.method==="HEAD"||i.startsWith("http://")||i.startsWith("https://"))return t(e);let r=ot(ry).getToken(),n=ot(NY);return r!=null&&!e.headers.has(n)&&(e=e.clone({headers:e.headers.set(n,r)})),t(e)}function qA(...e){let t=[VC,GA,kC,{provide:Km,useExisting:kC},{provide:ey,useFactory:()=>ot(DY,{optional:!0})??ot(GA)},{provide:Wj,useValue:FY,multi:!0},{provide:Qj,useValue:!0},{provide:ry,useClass:LY}];for(let i of e)t.push(...i.\u0275providers);return rh(t)}var Yj={providers:[iI(),EA(),qA()]};var ll=class e{_positions=new ec([]);getPositions(){return this._positions.asObservable()}updatePositions(t){let r=[be(ie({},t),{time:this.formatDate(t.time)}),...this._positions.getValue()];console.log("Updated positions:",r),this._positions.next(r)}formatDate(t){return t.toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}static \u0275fac=function(i){return new(i||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})};function VY(e,t){if(e&1){let i=z_();Ai(0,"tr",2),_s("mouseenter",function(){let n=Im(i).$implicit,s=Ch();return Am(s.onMouseEnter(n))}),Ai(1,"td"),Un(2,"img",3),mr(),Ai(3,"td"),jn(4),mr(),Ai(5,"td"),jn(6),mr(),Ai(7,"td"),jn(8),mr()()}if(e&2){let i=t.$implicit,r=t.index;ya("highlight",i.i===r),Nr(4),Gm(i.latitude),Nr(2),Gm(i.longitude),Nr(2),Gm(i.time)}}var BC=class e{constructor(t,i){this.positionService=t;this.cdRef=i}positions=[];highlight=new wn;ngOnInit(){this.positionService.getPositions().subscribe(t=>{this.positions=[...t],this.cdRef.detectChanges()})}onMouseEnter(t){this.highlight.emit(t)}onMouseOut(t){}static \u0275fac=function(i){return new(i||e)(Lt(ll),Lt(dc))};static \u0275cmp=Bs({type:e,selectors:[["app-history"]],outputs:{highlight:"highlight"},decls:3,vars:1,consts:[[1,"history"],[3,"highlight","mouseenter",4,"ngFor","ngForOf"],[3,"mouseenter"],["src","/satellite.svg","width","16"]],template:function(i,r){i&1&&(Ai(0,"div",0)(1,"table"),bC(2,VY,9,5,"tr",1),mr()()),i&2&&(Nr(2),bh("ngForOf",r.positions))},dependencies:[Z_,MC],styles:[".history[_ngcontent-%COMP%]{width:100%;height:100%;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}tr[_ngcontent-%COMP%]:hover{background-color:#ff0}"]})};var WA,ny=WA=class extends cn{constructor(e){super(e),this.type="none"}clone(){return new WA({type:this.type})}};u([b0({none:"none",stayAbove:"stay-above"}),d({json:{write:{isRequired:!0}}})],ny.prototype,"type",void 0),ny=WA=u([C("esri.ground.NavigationConstraint")],ny);var Kj=Symbol("GroundInstance");var Jj,$A,mc=$A=class extends cn.JSONSupportMixin(Rg){constructor(e){super(e),this[Jj]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ct;let t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&W.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(e=>{Gr(e)||W.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.layers.removeAll();for(let t of e)G(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=ie({},e)).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",Ep(e,this._get("layers")))}writeLayers(e,t,i,r){let n=[];e&&(r=be(ie({},r),{layerContainerType:"ground"}),e.forEach(s=>{if("write"in s){let o={};QN(s)().write(o,r)&&n.push(o)}else r?.messages&&r.messages.push(new Be("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return T2(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});let{ElevationQuery:i}=await import("./chunk-FYJYETJV.js");Bt(t);let r=new i,n=this.layers.filter(Xj).toArray();return r.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});let{ElevationQuery:i}=await import("./chunk-FYJYETJV.js");Bt(t);let r=new i,n=this.layers.filter(Xj).toArray();return r.createSamplerAll(n,e,t)}clone(){let e={opacity:this.opacity,surfaceColor:ro(this.surfaceColor),navigationConstraint:ro(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new $A({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){let t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,i){let r=t?.origin||"web-scene",n=t?.portal||null,s=t?.url||null,{populateOperationalLayers:o}=await import("./chunk-MUUZ75J7.js");Bt(i);let a=[];if(e.layers&&Array.isArray(e.layers)){let l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}await Promise.allSettled(a)}};function HY(e){return e&&"createElevationSampler"in e}function Xj(e){return e.type==="elevation"||HY(e)}Jj=Kj,u([d({json:{read:!1,write:{isRequired:!0}}})],mc.prototype,"layers",null),u([Dp("layers")],mc.prototype,"writeLayers",null),u([d({readOnly:!0})],mc.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ix,read:{reader:nF,source:"transparency"},write:{writer:(e,t)=>{t.transparency=rF(e)},target:"transparency"}}})],mc.prototype,"opacity",void 0),u([d({type:fn,json:{type:[Ix],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],mc.prototype,"surfaceColor",void 0),u([d({type:ny,json:{write:!0}})],mc.prototype,"navigationConstraint",void 0),mc=$A=u([C("esri.Ground")],mc);var Jm=mc;var UC=new WeakMap;function ZA(e){return!e.destroyed&&(UC.has(e)||e.addHandles([S(()=>{let t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||ZA(t))},t=>UC.set(e,t),Ce),yr(()=>UC.delete(e))]),UC.get(e))}function BY(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function ez(e){return!(!BY(e)||!k2(e)?.operations?.supportsEditing||"editingEnabled"in e&&!V2(e)||ZA(e))}var QA=()=>W.getLogger("esri.support.basemapUtils");function tz(){return{}}function iz(e){for(let t in e){let i=e[t];G(i),delete e[t]}}function rz(e,t){let i;if(typeof e=="string"){let r=e in $x,n=!r&&e.includes("/");if(!r&&!n){if(JN.apiKey)QA().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{let s=Object.entries($x).filter(([o,a])=>a.classic||a.is3d).map(([o])=>`"${o}"`).sort().join(", ");QA().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${s}`)}return null}t&&(i=t[e]),i||(i=r?Jp.fromId(e):new Jp({style:{id:e}}),t&&(t[e]=i))}else i=bp(Jp,e);return i?.destroyed&&(QA().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}var nz={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function sz(e){let t=null;if(typeof e=="string")if(e in nz){let i=nz[e];t=new Jm({resourceInfo:{data:{layers:[i]}}})}else W.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=bp(Jm,e);return t}var va=class extends Mk(xk(oi.EventedMixin(P))){constructor(e){super(e),this.allLayers=new Ql({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Dk(this),this.basemap=null,this.editableLayers=new Ql({getCollections:()=>[this.allLayers],itemFilterFunction:ez}),this.ground=new Jm,this._basemapCache=tz()}destroy(){iz(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=G(this.basemap),G(this.ground),this._set("ground",null)}castBasemap(e){return rz(e,this._basemapCache)}castGround(e){return sz(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],va.prototype,"allLayers",void 0),u([d({readOnly:!0})],va.prototype,"allTables",void 0),u([d({type:Jp,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],va.prototype,"basemap",void 0),u([Ir("basemap")],va.prototype,"castBasemap",null),u([d({readOnly:!0})],va.prototype,"editableLayers",void 0),u([d({type:Jm,nonNullable:!0})],va.prototype,"ground",void 0),u([Ir("ground")],va.prototype,"castGround",null),u([d()],va.prototype,"undoRedo",void 0),va=u([C("esri.Map")],va);var Su=va;var jC={widthBreakpoint:{getValue(e){let t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){let t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){let t=e.viewSize,i=t[0],r=t[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},YA={xsmall:544,small:768,medium:992,large:1200};function UY(e){let t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function KA(e,t){return t?jC[e].valueToClassName[t].split(" "):[]}var zC=e=>{let t=class extends e{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=YA}initialize(){this.addHandles(S(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Re))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!UY(i)){let r=JSON.stringify(YA,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=YA}this._set("breakpoints",ie({},i))}}_updateClassNames(){if(!this.container)return;let i=Sg.acquire(),r=Sg.acquire(),n,s=!1;for(n in jC){let o=this[n],a=jC[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,KA(n,o).forEach(l=>r.push(l)),KA(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),Sg.release(i),Sg.release(r))}_applyClassNameChanges(i,r){let n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){let i=this.container;if(!i)return;let r;for(r in jC)KA(r,this[r]).forEach(n=>i.classList.remove(n))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([C("esri.views.BreakpointsOwner")],t),t};var Iu=class extends P{constructor(){super(...arguments),this.items=new ct,this._watchUpdatingTracking=new mo,this._callbacks=new Map,this._projector=Nx(),this._hiddenProjector=Nx()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){let e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(let i of t.added){let r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(let i of t.removed){let r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){let t=this._hiddenSurface,i=this._hiddenProjector,r,n=()=>(r=e.render(),r);i.append(t,n),i.renderNow();let s={left:0,top:0,right:0,bottom:0};if(r?.domNode){let o=r.domNode.getBoundingClientRect();s.left=o.left,s.top=o.top,s.right=o.right,s.bottom=o.bottom}for(i.detach(n);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){let i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,t){let i=!!t?.disableDecorations;if(!this.items.some(n=>n.visible&&!(i&&n.isDecoration)))return;let r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(n=>{i&&n.isDecoration||(r.save(),n.renderCanvas(r),r.restore())}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],Iu.prototype,"surface",void 0),u([d({readOnly:!0})],Iu.prototype,"items",void 0),u([d({readOnly:!0})],Iu.prototype,"needsRender",null),u([d({readOnly:!0})],Iu.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Iu.prototype,"updating",null),Iu=u([C("esri.views.overlay.ViewOverlay")],Iu);var XA=Iu;var JA=[0,0];function jY(e){let t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return JA[0]=i.left+(t?.pageXOffset??0),JA[1]=i.top+(t?.pageYOffset??0),JA}function oz(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}function zY(e){let t=document.createElement("div");return e.appendChild(t),t}var ef=16,sy=750,GY=512,qY=2,GC=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:ef,time:sy},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([S(()=>this.cursor,r=>{let{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),S(()=>this.navigating,r=>{let{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([S(()=>this.ui,(i,r)=>this._handleUIChange(i,r),Re),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){let r=this._get("container"),n=Cp(i);if(n||typeof i!="string"||W.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(oz(this.root),this._set("root",null)),this.userContent&&(Px(this.userContent,r),oz(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");let s=document.createElement("div");s.className="esri-view-user-storage",Px(n,s),n.appendChild(s),this._set("userContent",s);let o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);let a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);let l=new XA;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(S(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Kr({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=kt(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){let i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,r,n){let s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){let s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(S(()=>this.root,n=>{i.container=n?zY(n):null},Re),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){let i=this._freqInfo;i.freq=ef,i.time=sy;let r=Kr({prepare:o=>{let a=this._measure(),l=this._freqInfo;if(l.time+=o.deltaTime,a&&(l.freq=ef,this._get("resizing")||this._set("resizing",!0)),l.time<l.freq)return;l.time=0;let c=this._position();l.freq=c||a?ef:Math.min(sy,l.freq*qY),!a&&l.freq>=GY&&(r.pause(),this._get("resizing")&&this._set("resizing",!1))}}),n=new ResizeObserver(o=>{i.freq=ef,i.time=sy,r.resume()});this.container!=null&&n.observe(this.container);let s=yr(()=>n.disconnect());this.addHandles([r0(window,"resize",()=>{i.freq=ef,i.time=sy,r.resume()}),s,r],"measuring"),this._measure(),this._position()}_measure(){let i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;let s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){let i=this.container,r=this.position,n=i&&jY(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d()],t.prototype,"messagesCommon",void 0),u([d({type:XA})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d({nonNullable:!0})],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([C("esri.views.DOMContainer")],t),t};function Au(e){return e!=null&&"open"in e&&"declaredClass"in e}function az(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}var qC=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([S(()=>[this.ui,this.popup],([i,r],n)=>{let s="popup",o="manual";if(n){let[a,l]=n;a&&Au(l)&&(l.view=null,az(l)&&a.remove(l,s))}i&&Au(r)&&(r.view=this,az(r)&&i.add(r,{key:s,position:o,internal:!0}))},Re),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Au(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Au(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},qa.WIDGET)]),Zo(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{import("./chunk-3QYOZGHH.js")})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(Au(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void W.getLogger(this).error(new Be("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),Au(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Au(this.popup))return this._popupSetupTask=un(async i=>{let{default:r}=await import("./chunk-3QYOZGHH.js");if(Bt(i),!this.popup||Au(this.popup))return;let n=this.popup;delete n.open,delete n.close,this.popup=new r(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},n){let s=[],o=[],a=!1,l=a2(n,Ct("popup-view-fetch-timeout")??WY),c=m=>{let f=new eR(m);return o.push(f),s.push(f.promise),f},h=m=>{let f=o.at(-1);return f&&f.layerView===m&&!a?f:c(m)};for(let m of r)"graphic"in m?(h(m.layerView).graphics.push(m.graphic),a=!1):(s.push(m.layerView.fetchPopupFeaturesAtLocation(m.mapPoint,l)),a=!0);o.map(m=>m.resolve(l));let p=s2(s).then(m=>m.filter(f=>!!f).flat());return{pendingFeatures:s,allGraphicsPromise:p,location:i}}async _getPopupHits(i,r){let{hits:n,location:s}=await this.popupHitTest(i);Bt(r);let o=[];for(let a of n)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){let l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:s}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return u([d()],t.prototype,"popup",void 0),u([d()],t.prototype,"popupEnabled",void 0),t=u([C("esri.views.PopupView")],t),t},eR=class{constructor(t){this.layerView=t,this._resolver=As(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(t){let{layerView:i,graphics:r,_resolver:n}=this;if(!i)return n.resolve(r),n.promise;let s;return i.fetchPopupFeaturesFromGraphics(r,t).catch(o=>(s=o,null)).then(o=>{o?n.resolve(o):n.reject(s)}),n.promise}},WY=5e3;var Ru=class extends Ik{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(W.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Ru=u([C("esri.support.AnalysesCollection")],Ru);var Pu=class extends P{constructor(e){super(e),this.view=null,this.baseLayerViews=new ct,this.referenceLayerViews=new ct,this._loadingHandle=S(()=>this.view?.map?.basemap,t=>{t&&t.load().catch(()=>{})},Re)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(let e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(let e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return this.view?.suspended??!0}get updating(){return this.view?.suspended?!1:!!this.view?.map?.basemap?.loaded&&(this.baseLayerViews.some(t=>t.updating)||this.referenceLayerViews.some(t=>t.updating))}};u([d({constructOnly:!0})],Pu.prototype,"view",void 0),u([d({readOnly:!0})],Pu.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],Pu.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],Pu.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],Pu.prototype,"updating",null),Pu=u([C("esri.views.BasemapView")],Pu);var lz=Pu;function $Y(e){return"tryRecycleWith"in e}function ZY(e){return e!=null&&typeof e=="object"&&"layerViews"in e}var tR=class{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=As(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,so(this._controller.signal,()=>{let n=new Be("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(n)})}tryRecycle(t){if(!this.done||!this.layerView||!$Y(this.layerView))return null;let i=this.layer.type,r=this._controller.signal;for(let n=0;n<t.length;n++){let s=t[n];if(s.type!==i)continue;let o=this.layerView.tryRecycleWith(s,{signal:r});if(o){t.splice(n,1),this.layer=s;let a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Bt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>so(this._controller.signal,()=>h(Sr())))]),this.promise}}return null}destroy(){this._controller.abort();let{layerView:t}=this;if(t){let{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;let{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let n,s;if(await i.load({signal:t}),i.prefetchResources&&await i.prefetchResources({signal:t}),QY(i))n=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new Be("layer:view-not-supported","No layerview implementation was found");let l=await this.layerViewImporter.importLayerView(i);Bt(t),n="default"in l?new l.default({layer:i,view:r}):new l({layer:i,view:r})}let o=()=>{s=kt(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=so(t,o),Bt(t);try{await n.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(i))return o(),void this._deferred.reject(new Be("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=n,i.emit("layerview-create",{view:r,layerView:n}),r.emit("layerview-create",{layer:i,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(n){i.emit("layerview-create-error",{view:r,error:n}),r.emit("layerview-create-error",{layer:i,error:n}),this.done=!0,this._deferred.reject(new Be("layerview:create-error","layerview creation failed",{layer:i,error:n}))}}},So=class extends P{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new mo,this.supportsGround=!0,this._preloadLayerViewModules=()=>{let t=this.view.map?.allLayers;if(t)for(let i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=As(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(a0(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;let t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");let i=new Set,r=[],n=this.view.ready,s=a=>{if(a!=null){for(let l of a)if(l){i.add(l);let c=this._layerLayerViewInfoMap.get(l);c&&n?c.start():c||this._recyclingInfoMap.has(l)||r.push(l),"layers"in l&&l.layers&&s(l.layers)}}};for(let a of this._rootCollectionNames)s(i0(this,a));for(let[a,l]of this._layerLayerViewInfoMap)if(!i.has(a)){this._layerLayerViewInfoMap.delete(l.layer);let c=l.tryRecycle(r);c?(this.notifyChange("updating"),this._recyclingInfoMap.set(l.layer,l),c.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),this._layerLayerViewInfoMap.set(l.layer,l),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy(),this._reschedule()})):l.destroy()}for(let[a,l]of this._recyclingInfoMap)i.has(a)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy());for(let a of r)this._createLayerView(a);this._refreshCollections();let o=[t?.ground?.layers,t?.basemap?.baseLayers,t?.basemap?.referenceLayers,t?.layers].filter(a=>!!a);i.forEach(a=>"layers"in a&&o.push(a.layers)),this.addHandles(o.map(a=>this._watchUpdatingTracking.addOnCollectionChange(()=>a,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([ir(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),S(()=>{let e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]},()=>this._reschedule(),Ce)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),sw(this._recyclingInfoMap),sw(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Sr()),this._workPromise=null)}get _layersToLayerViews(){let e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||l0(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(let t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(sw(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new Be("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");let i=this._layerLayerViewInfoMap.get(e);if(!i?.done)return!0;let r=i.layerView;return!(!r||!t||r.parent===t)||!!(i.done&&r&&"layers"in e&&e.layers?.length)&&e.layers.some(n=>this.isCreatingLayerViewsForLayer(n,r))}_refreshCollections(){for(let[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(i0(this,e),i0(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(let n of e){let s=this._layerLayerViewInfoMap.get(n);if(!s?.layerView)continue;let o=s.layerView;o.layer=n,o.parent=i,t.at(r)!==o&&t.splice(r,0,o),"layers"in n&&ZY(o)&&this._populateLayerViewsOwners(n.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);let t=new tR(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{i&&(Gr(i)||i.name==="cancelled:layerview-create")||W.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],So.prototype,"_workPromise",void 0),u([d({readOnly:!0})],So.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],So.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],So.prototype,"_rootCollectionNames",null),u([d()],So.prototype,"layerViewImporter",void 0),u([d()],So.prototype,"supportsGround",void 0),u([d({readOnly:!0})],So.prototype,"updating",null),u([d({readOnly:!0})],So.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],So.prototype,"view",void 0),So=u([C("esri.views.LayerViewManager")],So);var cz=So;function QY(e){return e.createLayerView!==Rk.prototype.createLayerView}var js=class extends P{constructor(e){super(e),this.factor=1.5,this.offset=Zi(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],js.prototype,"factor",void 0),u([d({nonNullable:!0})],js.prototype,"offset",void 0),u([d()],js.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],js.prototype,"size",void 0),u([d()],js.prototype,"maskUrl",void 0),u([d()],js.prototype,"maskEnabled",void 0),u([d()],js.prototype,"overlayUrl",void 0),u([d()],js.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],js.prototype,"version",null),u([d({type:Boolean})],js.prototype,"visible",void 0),js=u([C("esri.views.Magnifier")],js);var iR=js;function oy(e){return!!(e!=null&&typeof e=="object"&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}var cl=class extends oi.EventedAccessor{constructor(e){super(e),this._selectionMap=new C2,this._sources=new ct,this._trashCan=[],this._layerEditHandles=new ct,this._vizTaskId=0,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([S(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),ir(()=>this.sources,"change",t=>{let i=this._selectionMap;for(let r of t.removed)i.delete(r);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);let e=new ct;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(oy(t)&&!L2(t)||zc(t))&&e.add(t)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(kt)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{let[t,i]=e;return{layer:t,selection:[...i.selection]}})}get count(){let e=0;for(let t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){Ep(e,this._sources)}async getSelectedFeatures(e,t={},i="layerView"){let{view:r,selections:n}=this,s=(e!==void 0?n.filter(o=>e.includes(o.layer)):n).filter(o=>o.selection.length>0).map(async o=>{let{layer:a,selection:l}=o,c=zc(a)?a.parent:a;if(c==null||!dz(c))return null;if(i==="layer")return hz(c,l,t);if(uz(c))return null;let h=await r.whenLayerView(c).catch(()=>null);return h?hz(h,l,t):null});return(await Promise.all(s)).filter(o=>o!=null)}updateSelection(e){let t=new Map;for(let[n,s]of this._selectionMap)t.set(n,[...s.selection]);let i=!1,r=e.current.concat(e.added);for(let n of r){let s=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(s)&&(oy(s)||zc(s))&&o!==null){let a=wp(t,s,()=>[]);a.includes(o)||(a.push(o),i=!0)}}for(let n of e.removed){let s=n.sourceLayer,o=n.getObjectId();if(this.sources.includes(s)&&(oy(s)||zc(s))&&o!==null){let a=t.get(s),l=a?.indexOf(o);l!==void 0&&l>=0&&(a?.splice(l,1),i=!0)}}if(i){let{_selectionMap:n,_trashCan:s}=this,o=[];for(let[a,l]of t){let c=n.get(a);c!==void 0&&s.push(c),n.set(a,{selection:l}),o.push(ie({layer:a,selection:l},Mg(c!==void 0?c.selection:[],l)))}this._onSelectionChange(o)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,t){let i=this._selectionMap.get(e),r=i!==void 0?[...i.selection]:[];for(let n of t)r.includes(n)||r.push(n);this._setSelection(e,r)}removeFromSelection(e,t){let i=this._selectionMap.get(e);if(!i)return;let r=[];for(let n of i.selection)t.includes(n)||r.push(n);this._setSelection(e,r)}toggleInSelection(e,t){let i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,t);let r=new Set(i.selection),n=new Set(t),s=c2(r,n);this._setSelection(e,Array.from(s))}clear(){let e=this._selectionMap.values();this._trashCan.push(...e);let t=[];for(let[i,r]of this._selectionMap.entries())t.push({layer:i,added:[],removed:[...r.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();let{sources:e,view:t,_selectionMap:i,showHighlight:r}=this,n=this._vizTaskId;for(let s of e){let o=i.get(s),a=zc(s)?s.parent:s;if(a!=null&&dz(a)){if(uz(a))continue;t.whenLayerView(a).then(l=>{o?.highlightHandle?.remove(),o!=null&&r&&n===this._vizTaskId&&"highlight"in l&&typeof l.highlight=="function"&&o.selection.length>0&&(o.highlightHandle=l.highlight(o.selection,this.highlightName))}).catch(()=>{o?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(kt);for(let e of this.sources){let t=zc(e)?e.parent:e;if(t!=null&&oy(t)){let i=t.on("edits",r=>{this._handleEditChanges(r,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){let i=e.deletedFeatures.filter(r=>r.error==null).map(r=>r.objectId).filter(bd);this.removeFromSelection(t,i)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);let i=this._selectionMap.get(e);if(i===void 0||!KY(i,{selection:t})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...t]});let r=ie({layer:e,selection:[...t]},Mg(i!==void 0?i.selection:[],t));this._onSelectionChange([r])}}};u([d({readOnly:!0,nonNullable:!0})],cl.prototype,"selections",null),u([d({readOnly:!0,nonNullable:!0})],cl.prototype,"count",null),u([d({constructOnly:!0,nonNullable:!0})],cl.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],cl.prototype,"hasSelection",null),u([d()],cl.prototype,"showHighlight",void 0),u([d()],cl.prototype,"sources",null),u([d()],cl.prototype,"highlightName",void 0),cl=u([C("esri.views.SelectionManager")],cl);var uz=e=>zc(e)?e.parent?.isTable===!0:e.isTable,YY=e=>e.layer!==void 0,dz=e=>e?.when!==void 0,KY=(e,t)=>{if(e==null&&t==null)return!0;if(e!=null&&t==null||e==null&&t!=null)return!1;if(e!=null&&t!=null&&e.selection!=null&&t.selection!=null){let i=[...e.selection],r=[...t.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let n=0;n<i.length;n++)if(i[n]!==r[n])return!1}return!0},hz=async(e,t,i={})=>{let r;if(YY(e)){let n=e;r=n===void 0?null:await n.queryFeatures(new Xx(be(ie({},i),{objectIds:t}))).then(s=>({data:s,layer:e.layer}))}else{let n=e;r=n===void 0?null:await n.queryFeatures(new Xx(be(ie({},i),{objectIds:t}))).then(s=>({data:s,layer:n}))}return r},pz=cl;var ay=class extends Ha.ClonableMixin(P){constructor(e){super(e),this.accentColor=new fn([255,127,0]),this.textColor=new fn([255,255,255])}};u([d({type:fn,nonNullable:!0})],ay.prototype,"accentColor",void 0),u([d({type:fn,nonNullable:!0})],ay.prototype,"textColor",void 0),ay=u([C("esri.views.Theme")],ay);var WC=ay;function mz(e){return[e.on("before-add",t=>{let i=t.item;if(i==null||e.includes(i))return W.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{let i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function ly(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(Kg.USER)&&e.getEditableFlag(Kg.MANAGER)}var $C=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(t,i){let r=()=>t.stopPropagation();switch(t.type){case"pointer-move":gz(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:t.action==="start"?this._externallyDragging=!0:t.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!_z(t))break;let n=Wa(t),s=tf(n,t.pointerType,i.forEachTool);if(s==null)break;let o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,t,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:n,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!_z(t))break;let n=this._grabbedManipulators.get(t.pointerId),s=n?.manipulator,o=n?.tool;if(s==null||o==null)break;let a=Wa(t);a.x=q(a.x,0,i.view.width),a.y=q(a.y,0,i.view.height);let l=n.start,c=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{let n=Wa(t),s=tf(n,t.pointerType,i.forEachTool);if(XY(t)||i.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;let{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());let l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r}),rR(o,r);break}case"click":{let n=Wa(t),s=tf(n,t.pointerType,i.forEachTool),o=s?.manipulator;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{let n=Wa(t),s=tf(n,t.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r}),rR(o,r);break}case"immediate-double-click":{let n=Wa(t),s=tf(n,t.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;let a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r}),t.pointerType==="mouse"&&rR(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Wa(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===t&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(t,i){let r=this._grabbedManipulators.get(t.pointerId)?.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Wa(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=fz(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=fz(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){let i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),t(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);let s=this._grabbedManipulators.values(),o=t2(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(t,{forEachTool:i,setActiveTool:r},n=!0,s){let o=(a,l)=>a===t&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Zi(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){let r=t.type;r!=="pointer-up"&&r!=="immediate-click"&&r!=="pointer-move"||!gz(t.pointerType)||(r!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(t.pointerId):this._updateHoveredStateForPointerAtScreenPosition(Wa(t),t.pointerId,t.pointerType,i))}_updateHoveredStateForPointerAtScreenPosition(t,i,r,n){let s=tf(t,r,n),o=this._hoveredManipulators.get(i)?.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorRelease(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(t){this._hoveredManipulators.forEach(({manipulator:i},r)=>{t===r&&(this._hoveredManipulators.delete(t),i.hovering=!1)})}};function fz(e){for(let{manipulator:t}of e.values())if(t!=null&&t.interactive){if(t.grabbing&&t.grabCursor)return t.grabCursor;if(t.cursor)return t.cursor}return null}function tf(e,t,i){let r=null;return i(n=>{if(n.manipulators==null||!ly(n))return!1;let s=n.manipulators.intersect(e,t);return s!=null&&(r={tool:n,manipulator:s},!0)}),r}function gz(e){return e==="mouse"}function _z(e){return e.pointerType!=="mouse"||e.button===0}function XY(e){return!!e.native.shiftKey}function rR(e,t){e?.consumesClicks&&t()}var yz="attached",nR="tools",JY=1e3,wa=class extends P{constructor(e){super(e),this._updatingHandles=new mo,this._clock=Oa,this._manipulatorState=new $C,this.tools=new ct,this.cursor=null,this._interacting=!1,this._interactingTimeout=JY,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(let i of this.tools.items)if(t(i))return}}initialize(){this.addHandles([this.view.on(tV,e=>{this._handleInputEvent(e)},qa.TOOL),...mz(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void W.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;let t=this.activeTool;this._set("activeTool",e),t?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(let i of this.tools){this._updateToolEditableFlag(i);let r=ly(i);this.activeTool!=null&&r||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!r)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=kt(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([S(()=>{let{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(t=>t.onElevationChange(e)))],yz):this.addHandles(S(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(yz),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1,i=be(ie({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(nR),this._forEachTool(e=>{if(e instanceof P){let t=S(()=>[e.cursor,e.visible,e.editable],()=>{ly(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,nR)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],nR)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(Kg.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){}};u([d({constructOnly:!0,nonNullable:!0})],wa.prototype,"view",void 0),u([d({value:null})],wa.prototype,"activeTool",null),u([d({readOnly:!0,type:ct})],wa.prototype,"tools",void 0),u([d({readOnly:!0})],wa.prototype,"cursor",void 0),u([d({readOnly:!0})],wa.prototype,"updating",null),u([d()],wa.prototype,"_interacting",void 0),u([d({readOnly:!0})],wa.prototype,"interacting",null),wa=u([C("esri.views.ToolViewManager")],wa);function vz(){return new(ct.ofType(_o))([new _o({name:kd}),new _o({name:ak,color:lk})])}var rf=class extends P{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":eK.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){let e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return tK[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],rf.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],rf.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],rf.prototype,"axisThreshold",null),rf=u([C("esri.views.input.gamepad.GamepadInputDevice")],rf);var nf=rf,eK=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),tK={standard:.15,spacemouse:.025,unknown:0};var cy=class extends P{constructor(...e){super(...e),this.devices=new ct,this.enabledFocusMode="document"}};u([d({type:ct.ofType(nf),readOnly:!0})],cy.prototype,"devices",void 0),u([d({type:["document","view","none"]})],cy.prototype,"enabledFocusMode",void 0),cy=u([C("esri.views.input.gamepad.GamepadSettings")],cy);var wz=cy;var ZC=class extends P{constructor(){super(...arguments),this.gamepad=new wz}};u([d({readOnly:!0})],ZC.prototype,"gamepad",void 0),ZC=u([C("esri.views.input.Input")],ZC);var bz=ZC;var sR=()=>d({type:["pan","rotate","zoom","none"],nonNullable:!0}),Dh=class extends P{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};u([sR()],Dh.prototype,"dragPrimary",void 0),u([sR()],Dh.prototype,"dragSecondary",void 0),u([sR()],Dh.prototype,"dragTertiary",void 0),u([d({type:["zoom","none"],nonNullable:!0})],Dh.prototype,"mouseWheel",void 0),Dh=u([C("esri.views.navigation.NavigationActionMap")],Dh);var uy=Dh;var Ou=class extends P{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],Ou.prototype,"enabled",void 0),u([d({type:nf})],Ou.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],Ou.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],Ou.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],Ou.prototype,"velocityFactor",void 0),Ou=u([C("esri.views.navigation.gamepad.GamepadSettings")],Ou);var oR=Ou;var Nu=class extends P{constructor(e){super(e),this.actionMap=new uy,this.browserTouchPanEnabled=!0,this.gamepad=new oR,this.momentumEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!aw()}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){e2(W.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};u([d({type:uy,nonNullable:!0})],Nu.prototype,"actionMap",void 0),u([d({type:Boolean})],Nu.prototype,"browserTouchPanEnabled",void 0),u([d({type:oR,nonNullable:!0})],Nu.prototype,"gamepad",void 0),u([d({type:Boolean})],Nu.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],Nu.prototype,"mouseWheelZoomEnabled",null),Nu=u([C("esri.views.navigation.Navigation")],Nu);var sf=Nu;var lR,aR=null;async function iK(e){aR||(aR=import("./chunk-BCQE4SZA.js").then(t=>lR=t)),await aR,Bt(e)}async function cR(e,t,i,r){if(!e)return null;let n=e.spatialReference;return xL()||E0(n,t)?Gl(e,t):lR?lR.projectGeometry(e,t,i,r):(await Promise.race([iK(r),SL(r)]),cR(e,t,i,r))}var wi=class extends P{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Mr(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){let e=this.map?.(),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,i=>{let r=this._getSupportedSpatialReferences(i);if(r.length>0){let n=this._narrowDownSpatialReferenceCandidates(e,r);n!=null&&(e=n)}return e?.length===1})&&e?.length!==1)return{updating:!0};let t=this._pickSpatialReferenceCandidate(e);return{spatialReference:t?.spatialReference??null,viewingMode:t?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};let e=this.map?.(),t=this.spatialReference;if(!t)return{updating:this._spatialReferenceTask.updating};let i,r=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers}],n=>!(!("tileInfo"in n)||!n.tileInfo?.spatialReference.equals(t))&&(i=n,!0),n=>"tileInfo"in n);return i?{tileInfo:i.tileInfo,updating:!1}:{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={},t=this._collectLayers(this.mapCollections,i=>{let r=rV(i);return!!r&&(e={heightModelInfo:r,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid},!0)},i=>nV(i));return be(ie({},e),{updating:t})}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let e=[],t=this._collectLayers(this.mapCollections,i=>{let r="fullExtents"in i&&i.fullExtents||(i.fullExtent!=null?[i.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:r[0],s=r.find(o=>o.spatialReference.equals(this.spatialReference))??n;if(s)return e.push({extent:s,layer:i}),!0;if(this._getSupportedSpatialReferences(i).length>0)for(let o of r)e.push({extent:o,layer:i});return!1});return{candidates:e,updating:t}}get _extentTask(){let{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Mr(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:un(async n=>{try{let s=await cR(i.extent,r,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask=be(ie({},this._projectExtentTask),{task:null,output:s})}catch{if(Vl(n))return;this._projectExtentTask=be(ie({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;let i=new Array;for(let r of e)for(let n of t){if(!r.spatialReference.equals(n.spatialReference))continue;let s=rK(r.viewingMode,n.viewingMode);if(s!==!1){i.push({spatialReference:r.spatialReference,viewingMode:s});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){let t=this.defaultSpatialReference;return e==null||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Se.Local)&&(e=e.filter(({viewingMode:i})=>i!==Se.Local)),e[0])}_getSupportedSpatialReferences(e){let t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];let i=[];for(let r of t){let n=this.getSpatialReferenceSupport(r,e);if(n!=null){let s=n.constraints??[{spatialReference:r,viewingMode:null}];for(let{spatialReference:o,viewingMode:a}of s)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){let t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e,t,i=()=>!0){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}let r=new uR(i,t);for(let n of e)if(this._collectCollection(n,r),r.done||r.preloading===this.sourcePreloadCount)break;return r.updating}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(let i of e.layers)if(t.layerFilter(i)){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":if(t.updating||(t.done=t.pushLayer(i)),t.done||t.preloading===this.sourcePreloadCount)break;"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.done||t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{Gr(t)}),"loading"):e.loadStatus:"loaded"}};u([d()],wi.prototype,"required",void 0),u([d({constructOnly:!0})],wi.prototype,"map",void 0),u([d({constructOnly:!0})],wi.prototype,"getSpatialReferenceSupport",void 0),u([d()],wi.prototype,"defaultSpatialReference",void 0),u([d()],wi.prototype,"userSpatialReference",void 0),u([d()],wi.prototype,"sourcePreloadCount",void 0),u([d()],wi.prototype,"priorityCollection",void 0),u([d()],wi.prototype,"requiresExtentInSpatialReference",void 0),u([d()],wi.prototype,"suspended",void 0),u([d({readOnly:!0})],wi.prototype,"ready",null),u([d({readOnly:!0})],wi.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],wi.prototype,"spatialReference",null),u([d({readOnly:!0})],wi.prototype,"extent",null),u([d({readOnly:!0})],wi.prototype,"heightModelInfo",null),u([d({readOnly:!0})],wi.prototype,"vcsWkid",null),u([d({readOnly:!0})],wi.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],wi.prototype,"viewingMode",null),u([d({readOnly:!0})],wi.prototype,"tileInfo",null),u([d({readOnly:!0})],wi.prototype,"mapCollections",null),u([d({readOnly:!0})],wi.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],wi.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],wi.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],wi.prototype,"_extentCandidatesTask",null),u([d()],wi.prototype,"_extentTask",null),u([d()],wi.prototype,"_projectExtentTask",void 0),wi=u([C("esri.views.support.DefaultsFromMap")],wi);var uR=class{constructor(t,i){this.layerFilter=t,this.pushLayer=i,this.preloading=-1,this.updating=!1,this.done=!1}};function rK(e,t){return e!=null?t!=null?e===t&&e:e:t}var of=class extends P{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};u([d()],of.prototype,"featureTitleFields",void 0),u([d()],of.prototype,"utilityNetworkFields",void 0),u([d()],of.prototype,"globalIdField",void 0),of=u([C("esri.views.support.RequiredFieldsOptions")],of);var Cz=of;var dy,ke=dy=class extends oi.EventedMixin(d0.EsriPromiseMixin(P)){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new Pa,this.updatingHandles=new mo,this.allLayerViews=new Ql({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:nK}),this.groundView=null,this.basemapView=null,this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new pM,this.analyses=new Ru,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ct,this.magnifier=new iR,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new bz,this.navigation=new sf,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new uw(this),this.persistableViewModels=new ct,this.requiredFieldsOptions=new Cz,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(S(()=>this.preconditionsReady,t=>{let i=this.ready;if(t?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,dy.views.add(this)):(this._lockedSpatialReference=null,dy.views.remove(this)),this.notifyChange("spatialReference"),!t&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(t&&!i){try{this._startup()}catch(r){return void queueMicrotask(()=>{this.fatalError=new Be("startup-error",null,r)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Fe))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Zo(()=>this.ready)))),this.basemapView=new lz({view:this}),this.layerViewManager=new cz({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new wa({view:this}),this.selectionManager=new pz({view:this}),this.addHandles([Wi(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{W.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),S(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=be(ie({},this.defaultsFromMap.required),{extent:e}),Ce),S(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},Fe),S(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},Ce)])}destroy(){this.destroyed||(dy.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=G(this.graphics),this.analyses=G(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),G(this.analysisViewManager),this.toolViewManager=G(this.toolViewManager),this.layerViewManager=G(this.layerViewManager),this.selectionManager=G(this.selectionManager),this.basemapView=G(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=G(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return W.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new wi(ie({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t)},this.defaultsFromMapSettings))}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??vz()}set highlights(e){this._set("highlights",Ep(e,this._get("highlights"),ct.ofType(_o)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Rg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(W.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),Rg.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((this.defaultsFromMap?.ready??!1)&&!this.spatialReference){let e=!("loaded"in this.map)||this.map.loaded,t=this.map.ground.loaded,i=this.map.basemap?.loaded??!0;return e&&i&&t&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=un(r=>o2(Ct("view-readyState-waiting-delay"),null,r)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=Mr(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){let e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){let t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){let t=!Fa(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??g2}set timeZone(e){this._userTimeZone=e,_2(e)||W.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new WC}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(e){throw new Be("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,t){return this.isResolved()&&!this.ready&&W.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Wi(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};ke.views=new ct,u([d()],ke.prototype,"_userSpatialReference",void 0),u([d()],ke.prototype,"activeTool",null),u([d({readOnly:!0})],ke.prototype,"allLayerViews",void 0),u([d()],ke.prototype,"groundView",void 0),u([d()],ke.prototype,"animation",null),u([d()],ke.prototype,"basemapView",void 0),u([d()],ke.prototype,"center",null),u([d()],ke.prototype,"defaultsFromMapSettings",null),u([d()],ke.prototype,"defaultsFromMap",null),u([d()],ke.prototype,"displayFilterEnabled",void 0),u([d()],ke.prototype,"fatalError",void 0),u([d({type:Vi})],ke.prototype,"extent",null),u([d(Qg(pM,"graphics"))],ke.prototype,"graphics",void 0),u([d(Qg(Ru,"analyses"))],ke.prototype,"analyses",void 0),u([d({readOnly:!0,type:g0})],ke.prototype,"heightModelInfo",null),u([d({type:ct.ofType(_o)})],ke.prototype,"highlights",null),u([d({readOnly:!0})],ke.prototype,"interacting",null),u([d({readOnly:!0})],ke.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],ke.prototype,"preconditionsReady",null),u([d({readOnly:!0})],ke.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ct,readOnly:!0})],ke.prototype,"layerViews",void 0),u([d()],ke.prototype,"resolution",null),u([d({type:iR})],ke.prototype,"magnifier",void 0),u([d({value:null,type:Su})],ke.prototype,"map",null),u([d()],ke.prototype,"padding",void 0),u([d({readOnly:!0})],ke.prototype,"ready",void 0),u([d()],ke.prototype,"_readyStateWaitingTask",void 0),u([d({readOnly:!0})],ke.prototype,"readyState",null),u([d({type:Qt})],ke.prototype,"spatialReference",null),u([d()],ke.prototype,"stationary",null),u([d({readOnly:!0})],ke.prototype,"supportsGround",void 0),u([d({type:WL})],ke.prototype,"timeExtent",null),u([d({type:String,nonNullable:!0})],ke.prototype,"timeZone",null),u([d()],ke.prototype,"tools",null),u([d()],ke.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],ke.prototype,"type",void 0),u([d({type:Number})],ke.prototype,"scale",void 0),u([d({readOnly:!0})],ke.prototype,"updating",void 0),u([d({readOnly:!0})],ke.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],ke.prototype,"initialExtent",null),u([d()],ke.prototype,"cursor",null),u([d({readOnly:!0})],ke.prototype,"input",void 0),u([d({type:sf,nonNullable:!0})],ke.prototype,"navigation",void 0),u([d()],ke.prototype,"layerViewManager",void 0),u([d()],ke.prototype,"analysisViewManager",void 0),u([d()],ke.prototype,"selectionManager",void 0),u([d()],ke.prototype,"width",void 0),u([d()],ke.prototype,"height",void 0),u([d({readOnly:!0})],ke.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],ke.prototype,"size",null),u([d({readOnly:!0})],ke.prototype,"suspended",void 0),u([d({readOnly:!0})],ke.prototype,"viewEvents",void 0),u([d({readOnly:!0})],ke.prototype,"persistableViewModels",void 0),u([d()],ke.prototype,"_isValid",void 0),u([d()],ke.prototype,"_readyCycleForced",void 0),u([d()],ke.prototype,"_lockedSpatialReference",void 0),u([d()],ke.prototype,"_userTimeZone",void 0),u([d()],ke.prototype,"_lockedTimeZone",void 0),u([d()],ke.prototype,"_userTimeExtent",void 0),u([d()],ke.prototype,"_lockedTimeExtent",void 0),u([d({type:WC})],ke.prototype,"theme",void 0),u([d({readOnly:!0,type:WC})],ke.prototype,"effectiveTheme",null),ke=dy=u([C("esri.views.View")],ke);var dR=globalThis.$arcgis;dR&&!dR.views&&Object.defineProperty(dR,"views",{configurable:!1,enumerable:!0,writable:!1,value:ke.views});var QC=ke;function nK(e){return e.layerViews}function sK(e){return e instanceof Float32Array&&e.length>=2}function oK(e){return Array.isArray(e)&&e.length>=2}function YC(e){return sK(e)||oK(e)}var hR,fc=[0,0],gc=hR=class extends cn{constructor(e){super(e),this._viewpoint2D={center:Hi(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Vi,this.id=0,this.inverseTransform=lw(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=lw(),this.transformNoRotation=lw(),this.displayMat3=em(),this.displayViewMat3=em(),this.viewMat3=em(),this.viewMat2d=tF(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){let t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}get visibleArea(){let[e,t]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,t),this.toMap([0,0],e,t),this.toMap([0,0],e,0)]}copy(e){let t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=go(i,e.viewpoint),this._set("size",Yi(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new hR({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return YC(t)?Sd(e,t,this.inverseTransform):(fc[0]=t,fc[1]=i,Sd(e,fc,this.inverseTransform))}toScreen(e,t,i){return YC(t)?Sd(e,t,this.transform):(fc[0]=t,fc[1]=i,Sd(e,fc,this.transform))}toScreenNoRotation(e,t,i){return YC(t)?Sd(e,t,this.transformNoRotation):(fc[0]=t,fc[1]=i,Sd(e,fc,this.transformNoRotation))}wrapMapCoordinate(e,t){Yi(e,t);let[i]=t,[r]=this.center,{extent:n,spatialReference:s}=this,{xmin:o,xmax:a}=n;if(s.isWrappable){let l=qk(s)/2;o=Math.max(o,r-l),a=Math.min(a,r+l)}return(i<o||i>a)&&(e[0]=AL(i,r,s)),e}getScreenTransform(e,t){let{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return jk(e,i,n,t,0,r),e}_update(){let{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new Si({targetGeometry:new pt(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!t||!i)return;this.resolution=Bk(o),this.rotation=r,this.scale=i,this.spatialReference=t,Yi(this.center,e);let a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;P0(this.displayMat3,a,0,0,0,l,0,-1,1,1);let c=Fp(this.viewMat3),h=Jx(s[0]/2,s[1]/2),p=Jx(-s[0]/2,-s[1]/2),m=Ip(r);ql(c,c,h),kp(c,c,m),ql(c,c,p),N0(this.displayViewMat3,this.displayMat3,c);let f=eF(this.viewMat2d,h);return XL(f,f,m),JL(f,f,p),Vk(this.extent,o,s),zk(this.transform,o,s,n),KL(this.inverseTransform,this.transform),Gk(this.transformNoRotation,o,s,n),this.worldScreenWidth=Wk(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};u([d({readOnly:!0})],gc.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],gc.prototype,"pixelRatio",null),u([d({json:{write:!0}})],gc.prototype,"size",null),u([d()],gc.prototype,"spatialReference",void 0),u([d({type:Si,json:{write:!0}})],gc.prototype,"viewpoint",null),u([d({readOnly:!0})],gc.prototype,"visibleArea",null),gc=hR=u([C("esri.views.2d.ViewState")],gc);var pR=gc;var mR,fR,_c=mR=class extends P{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new mR({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([d()],_c.prototype,"left",void 0),u([d()],_c.prototype,"top",void 0),u([d()],_c.prototype,"right",void 0),u([d()],_c.prototype,"bottom",void 0),_c=mR=u([C("esri.views.2d.PaddedViewState.Padding")],_c);var af=fR=class extends pR{constructor(...e){super(...e),this.paddedViewState=new pR,this._updateContent=(()=>{let t=Hi();return()=>{let i=this._get("size"),r=this._get("padding");if(!i||!r)return;let n=this.paddedViewState;es(t,r.left+r.right,r.top+r.bottom),x0(t,i,t),Yi(n.size,t);let s=n.viewpoint;s&&(this.viewpoint=s)}})(),this.addHandles(S(()=>[this.size,this.padding],()=>this._updateContent(),Fe)),this.padding=new _c,this.size=[0,0]}set padding(e){this._set("padding",e||new _c)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=e,i=this._get("padding");i&&(t=Zk(e.clone(),e,this._get("size"),i));let{targetGeometry:r,rotation:n,scale:s}=t,{x:o,y:a,spatialReference:l}=r,c=this._viewpoint2D;c.center[0]=o,c.center[1]=a,c.rotation=n,c.scale=s,c.spatialReference=l,this._update()}}clone(){return new fR({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([d()],af.prototype,"paddedViewState",void 0),u([d({type:_c})],af.prototype,"padding",null),u([d()],af.prototype,"viewpoint",null),af=fR=u([C("esri.views.2d.PaddedViewState")],af);var lf=af;var KC=class{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=D0(),this._schedulerHandle=Wi(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||Na(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=i=>{if(this._updateRequested=!1,this.view?.destroyed)return;let{allLayerViews:r,graphicsView:n,labelManager:s,state:{id:o}}=this.view;r?.forEach(this._updateLayerView,this),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=pi.ANIMATING:this.view.interacting?this._scheduler.state=pi.INTERACTING:this._scheduler.state=pi.IDLE,this._scheduler.frame(i)||this._updateRequested||this._scheduler.state!==pi.IDLE||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;let t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,targetState:new lf,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=S(()=>t.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=Kr(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){if(!t.attached)return void this.requestUpdate();let i=this.view.state,r=t.lastUpdateId;r!=null&&(this.stationary||t.moving)||(t.moving=!0),r!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews?.forEach(this._updateLayerView,this)}};var Lu=class extends d0{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=As(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new Be("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=Na(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],Lu.prototype,"done",null),u([d({readOnly:!0,type:String})],Lu.prototype,"state",void 0),u([d()],Lu.prototype,"target",void 0),Lu=u([C("esri.views.ViewAnimation")],Lu),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Lu||(Lu={}));var bn=Lu;var hy=class extends P{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void W.getLogger(this).error("#goTo()","target cannot be null or undefined");let i=new bn;this.view.animation=i,await Zo(()=>this.view.ready,t);let r=be(ie({},t),{animate:t?.animate??!aw(),animationMode:t?.animationMode??"auto"}),{extent:n,spatialReference:s,size:o,viewpoint:a,constraints:l,padding:c,allLayerViews:h}=this.view,p=kk(e,{extent:n,spatialReference:s,size:o,viewpoint:a,constraints:l,padding:c,allLayerViews:h,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(p),this._gotoTask={},r.animate?this._gotoAnimated(p,r):this._gotoImmediate(p,r)}_gotoImmediate(e,t){let i=this._gotoTask,r=this.view.animation,n=e.then(s=>{if(Bt(t),i!==this._gotoTask)throw new Be("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=r.target=s,r.finish()});return this._cancellableGoTo(i,r,n,t)}_gotoAnimated(e,t){let i=this._gotoTask,r=this.view.animation;if(!r)return Promise.resolve();let n=e.then(s=>{if(Bt(t),i!==this._gotoTask)throw new Be("view:goto-interrupted","Goto was interrupted");return r.update(s),this.view.animationManager.animate(r,this.view.viewpoint,t),r.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,r,n,t)}_cancellableGoTo(e,t,i,r){let n=()=>e===this._gotoTask;return n0(i,r).finally(()=>{n()&&(t.done||t.stop())})}};u([d({constructOnly:!0})],hy.prototype,"view",void 0),hy=u([C("esri.views.2d.GoToManager")],hy);function Tz(e,t){let{spatialReference:i}=t,r=[t.x,t.y],n,s,o,a,l=[0,0],c=aK(e);for(let m=0;m<c.length;m++){let f=c[m];for(let g=0;g<f.length-1;g++){cL(l,r,f,g);let _=ea(r,l);(n==null||_<n)&&(n=_,s=[...l],o=m,a=g)}}if(n==null||!s||o==null||a==null)throw new Be("nearest-coordinate:failed","Failed to find the nearest coordinate");let[h,p]=s;return{coordinate:new pt({x:h,y:p,spatialReference:i}),distance:n}}function aK(e){switch(e.type){case"extent":return[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]];case"polygon":return e.rings;case"polyline":return e.paths}}var gR,Fu=gR=class extends xp.NumericIdentifiableMixin(P){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Gl(this.geometry,this.spatialReference)}catch(e){return W.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;let i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?f0(this.normalizedGeometry,i):N2(this.normalizedGeometry,i))return e;let{coordinate:r}=Tz(this.normalizedGeometry,i);return r&&(e.targetGeometry=r),e}clone(){return new gR({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};u([d({constructOnly:!0})],Fu.prototype,"geometry",void 0),u([d({readOnly:!0})],Fu.prototype,"normalizedGeometry",null),u([d({constructOnly:!0})],Fu.prototype,"spatialReference",void 0),Fu=gR=u([C("esri.views.2d.constraints.GeometryConstraint")],Fu);var _R,py=_R=class extends xp.NumericIdentifiableMixin(P){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new _R({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([d()],py.prototype,"enabled",void 0),u([d()],py.prototype,"rotationEnabled",void 0),py=_R=u([C("esri.views.2d.constraints.RotationConstraint")],py);var yR=py;var vR,ys=vR=class extends xp.NumericIdentifiableMixin(P){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:r,minZoom:n,maxZoom:s}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);t=t.map(h=>h.clone()),t.sort((h,p)=>p.scale-h.scale),t.forEach((h,p)=>h.level=p);for(let h of t)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=e?e.level:-1,c=!0),e=h;n===-1&&(n=i===0?0:o),s===-1&&(s=r===0?t.length-1:a),n=Math.max(n,0),n=Math.min(n,t.length-1),s=Math.max(s,0),s=Math.min(s,t.length-1),n>s&&([n,s]=[s,n]),i=t[n].scale,r=t[s].scale,t.splice(0,n),t.splice(s-n+1,t.length),t.forEach((h,p)=>{this._lodByScale[h.scale]=h,this._scales[p]=h.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",s),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(e,t){if(t&&e.scale===t.scale)return e;let i=this.effectiveMinScale,r=this.effectiveMaxScale,n=e.targetGeometry,s=t&&t.targetGeometry,o=r!==0&&e.scale<r,a=i!==0&&e.scale>i;if(o||a){let l=a?i:r;if(t&&s){let c=(l-t.scale)/(e.scale-t.scale);n.x=s.x+(n.x-s.x)*c,n.y=s.y+(n.y-s.y)*c}e.scale=l}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);let t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);let t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];let i=Math.floor(e),r=Math.ceil(e);return t[i]+(e-i)*(t[r]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;let t=this._scales,i,r;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let n=0;n<t.length-1;n++){if(i=t[n],r=t[n+1],r===e)return n+this.effectiveMinZoom+1;if(i>e&&r<e)return n+this.effectiveMinZoom+1-(e-r)/(i-r)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;let t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new vR({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};u([d({readOnly:!0})],ys.prototype,"effectiveLODs",void 0),u([d({readOnly:!0})],ys.prototype,"effectiveMinZoom",void 0),u([d({readOnly:!0})],ys.prototype,"effectiveMaxZoom",void 0),u([d({readOnly:!0})],ys.prototype,"effectiveMinScale",void 0),u([d({readOnly:!0})],ys.prototype,"effectiveMaxScale",void 0),u([d()],ys.prototype,"lods",void 0),u([d()],ys.prototype,"minZoom",void 0),u([d()],ys.prototype,"maxZoom",void 0),u([d()],ys.prototype,"minScale",void 0),u([d()],ys.prototype,"maxScale",void 0),u([d()],ys.prototype,"snapToZoom",void 0),ys=vR=u([C("esri.views.2d.constraints.ZoomConstraint")],ys);var wR=ys;var lK={base:null,key:"type",typeMap:{extent:Vi,polygon:Rp}},sr=class extends P{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new ct}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){let e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new Fu({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new yR({rotationEnabled:this.rotationEnabled})}get _zoom(){let e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,r=this.maxZoom,n=this.minScale,s=this.maxScale,o=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===r&&e.minScale===n&&e.maxScale===s&&e.snapToZoom===o?e:new wR({lods:t,minZoom:i,maxZoom:r,minScale:n,maxScale:s,snapToZoom:o})}canZoomInTo(e){let t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){let t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(i=>i.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>t.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([d({readOnly:!0})],sr.prototype,"effectiveLODs",null),u([d({readOnly:!0})],sr.prototype,"effectiveMinScale",null),u([d({readOnly:!0})],sr.prototype,"effectiveMaxScale",null),u([d({readOnly:!0})],sr.prototype,"effectiveMinZoom",null),u([d({readOnly:!0})],sr.prototype,"effectiveMaxZoom",null),u([d({types:lK,value:null})],sr.prototype,"geometry",null),u([d({type:[sL]})],sr.prototype,"lods",void 0),u([d()],sr.prototype,"minScale",void 0),u([d()],sr.prototype,"maxScale",void 0),u([d()],sr.prototype,"minZoom",void 0),u([d()],sr.prototype,"maxZoom",void 0),u([d()],sr.prototype,"rotationEnabled",void 0),u([d()],sr.prototype,"snapToZoom",void 0),u([d({type:ct})],sr.prototype,"customConstraints",void 0),u([d()],sr.prototype,"view",void 0),u([d({readOnly:!0})],sr.prototype,"version",null),u([d({type:Fu,readOnly:!0})],sr.prototype,"_geometry",null),u([d({type:yR})],sr.prototype,"_rotation",null),u([d({readOnly:!0,type:wR})],sr.prototype,"_zoom",null),sr=u([C("esri.views.2d.MapViewConstraints")],sr);var bR=sr;var sn=class extends P{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([S(()=>this.constraints?.version,t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Fe)])}get center(){if(!this.ready)return this._get("center");let{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new pt({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(r){return void W.getLogger(this).error(new Be("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:r}))}let i=this.viewpoint;mM(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void W.getLogger(this).error(new Be("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(r){return void W.getLogger(this).error(new Be("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:r}))}let i=this.viewpoint;Hk(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);let t=this.viewpoint;Yk(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);let i=this._get("extent");return void(i&&(this._set("extent",void 0),this._set("center",i.center)))}let t=this.viewpoint;fM(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new Be("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(i=new Be("mapview:invalid-viewpoint","geometry not defined"))}catch(n){i=new Be("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:n})}if(i)return void W.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;let r=new Si({targetGeometry:new pt,scale:0,rotation:0});go(r,t),this.constraints?.constrain(r,this.state.paddedViewState.viewpoint),this.state.viewpoint=r,this._set("viewpoint",r)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);let r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}let t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);let i=this.viewpoint;fM(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};let{padding:t,constraints:i}=this,r=this._get("center"),n=this._get("extent"),s=this._get("scale"),o=this._get("rotation"),a=this._get("viewpoint"),l=this._get("zoom"),c=l!=null&&i!=null&&i.zoomToScale(l)||void 0,h,p,m,f=a?.rotation,g=a?.targetGeometry;g?.type==="extent"?h=g:g?.type==="point"&&(p=g,m=a?.scale);let _=n??h;return{center:r??p??_?.center,rotation:o??f,scale:(s??c??m??(_&&cw(_,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,r){let n=e.targetGeometry;try{this._project(e,i)}catch(s){W.getLogger(this).warn(new Ax("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:i,error:s})),e.targetGeometry=r||new pt({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new lf({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);let{center:[e,t],spatialReference:i,rotation:r,scale:n}=this.state.paddedViewState,s=new pt({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",s),this._set("zoom",-1),this._set("rotation",r),this._set("scale",n),this._set("state",null)}changeSpatialReference(e){let t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{let a=t.viewpoint.clone();a.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=a}let i=t.clone(),[r,n]=t.center,s=null;try{s=this._project(new pt({x:r,y:n,spatialReference:t.spatialReference}),e)}catch(a){E2()||W.getLogger(this).warn(new Ax("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:s?.toJSON(),spatialReference:e,error:a}))}s||(s=new pt({x:0,y:0,spatialReference:e}));let o=mM(new Si({targetGeometry:new pt,scale:0,rotation:0}),t.viewpoint,s);i.viewpoint=o;try{let l=[t.size[0]/2,t.size[1]/2],c=[l[0]+20,l[1]],h=t.toMap([0,0],c),{x:p,y:m}=this._project(new pt({x:h[0],y:h[1],spatialReference:t.spatialReference}),e);h[0]=p,h[1]=m,i.toScreen(h,h);let f=$k(l,h,c),g=Math.hypot(h[0]-l[0],h[1]-l[1])/20;!Number.isFinite(g)||Math.abs(g)>4?(o.rotation=0,o.targetGeometry=new pt({x:0,y:0,spatialReference:e})):(o.scale*=g,o.scale>Ct("mapview-srswitch-adjust-rotation-scale-threshold")?o.rotation=0:o.rotation+=Number.isFinite(f)?f:0)}catch{}this._get("constraints")?.constrain(o,void 0),this._get("state").viewpoint=o}resize(e,t){if(!this.ready)return;let i=this.state,r=this.state.paddedViewState.viewpoint,n=this.state.paddedViewState.size.slice();i.size=[e,t],Qk(r,r,n,this.state.paddedViewState.size,this.resizeAlign),r=this.constraints?.constrain(r,void 0)??r,this.state.viewpoint=r}toMap(e){if(!this.ready)return null;let t=[0,0],[i,r]=this.state.toMap(t,[e.x,e.y]),n=this.state.spatialReference;return new pt({x:i,y:r,spatialReference:n})}toScreen(e,t){if(!this.ready)return null;let i=this._project(e,this.state.spatialReference),r=[i.x,i.y];return t?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(r,r),this.state.toScreen(r,r),Zi(r[0],r[1])}_project(e,t){let i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem||Fa(t,i.spatialReference))return e;let r=Gl(i,t);if(!r)throw new Be("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return cK(e)?(e.targetGeometry=r,e):r}};function cK(e){return e?.declaredClass==="esri.Viewpoint"}u([d({type:pt})],sn.prototype,"center",null),u([d()],sn.prototype,"constraints",void 0),u([d({type:Vi})],sn.prototype,"extent",null),u([d({value:{top:0,right:0,bottom:0,left:0},cast:e=>ie({top:0,right:0,bottom:0,left:0},e)})],sn.prototype,"padding",null),u([d()],sn.prototype,"ready",void 0),u([d()],sn.prototype,"resizeAlign",void 0),u([d({readOnly:!0})],sn.prototype,"resolution",null),u([d({type:Number})],sn.prototype,"rotation",null),u([d({type:Number})],sn.prototype,"scale",null),u([d({readOnly:!0})],sn.prototype,"state",void 0),u([d({type:Si})],sn.prototype,"viewpoint",null),u([d({readOnly:!0})],sn.prototype,"visibleArea",null),u([d()],sn.prototype,"zoom",null),sn=u([C("esri.views.2d.ViewStateManager")],sn);function my(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function XC(e,t){return t.some(i=>my(e,i))}function cf(e,t){let{button:i,pointerType:r}=e;return r!=="touch"&&t.some(n=>n==="primary"&&i===0||n==="secondary"&&i===2||n==="tertiary"&&i===1)}function xh(e,{dragPrimary:t,dragSecondary:i,dragTertiary:r}){return[{key:"primary",value:t},{key:"secondary",value:i},{key:"tertiary",value:r}].filter(n=>n.value===e).map(n=>n.key)}var fy=class extends rt{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(t,i){my(t.data,"primary")&&(t.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}};var JC=class extends rt{constructor(t,i,r){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",r,n=>this._handleDoubleTapDrag(n))}_handleDoubleTapDrag(t){let{data:i}=t,{pointerType:r}=i;if(r!==this.pointerType)return;t.stopPropagation();let{action:n,delta:s}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(n){case"begin":{let{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=s,a.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;let l=1.015**s.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{let{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();let p=l.snapScale(this._currentScale),m=(s.y>0?Math.max(p,l.snapToPreviousScale(this._startScale)):Math.min(p,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(m).then(()=>{a.end()});break}}}};var Io=class{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){let i=t.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){this._startEvent=t,this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}};var eT=class extends rt{constructor(t,i,r){super(!0),this.view=t,this.pointerActions=i,this.registerIncoming("drag",r,n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(t){super.onInstall(t),this._dragEventSeparator=new Io({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&XC(r.data,this.pointerActions)})}_handleDrag(t){let i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}};var tT=class extends rt{constructor(t,i,r){super(!0),this._view=t,this.pointerActions=i;let n=this._view.mapViewNavigation;this._dragEventSeparator=new Io({start:(s,o)=>{n.rotate.begin(this._view,o.data),o.stopPropagation()},update:(s,o)=>{n.rotate.update(this._view,o.data),o.stopPropagation()},end:(s,o)=>{n.rotate.end(),o.stopPropagation()},condition:(s,o)=>s===1&&XC(o.data,this.pointerActions)}),this.registerIncoming("drag",r,s=>this._dragEventSeparator.handle(s))}};function ba(e){let t=e*e;return e<0&&(t*=-1),t}function Ez(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function gy(e,t,i){let r=i,n=e.state,s=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=ba(n.axes[0]),r.translation[1]=ba(n.axes[1]),r.translation[2]=ba(n.buttons[7])-ba(n.buttons[6]),r.heading=ba(n.axes[2]),r.tilt=ba(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*ba(n.axes[0]),r.translation[1]=1.2*ba(n.axes[1]),r.translation[2]=2*-ba(n.axes[2]),r.heading=1.2*ba(n.axes[5]),r.tilt=1.2*ba(n.axes[3])),r.tilt*=o,X(r.translation,r.translation,a),r}function CR(e,t){let i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function uf(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}var iT=class extends rt{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new Pa,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([S(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=Kr({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Re)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){let i=this._view.navigation.gamepad.device;i&&t.data.device!==i||this._currentDevice&&this._currentDevice!==t.data.device||(t.data.action==="end"?(this._currentDevice=null,Ez(this._transformation)):(this._currentDevice=t.data.device,gy(t.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(t){let i=this._transformation;if(uf(i))return void this._frameTask?.pause();let r=this._view.viewpoint.clone(),n=this._view.navigation.gamepad.velocityFactor,s=dK*n*t;Xk(r,r,[i.translation[0]*s,-i.translation[1]*s]);let o=1+i.translation[2]*hK*t,a=this._view.constraints.rotationEnabled?-i.heading*uK*t:0,l=this._view.size,c=[l[0]/2,l[1]];Kk(r,r,o,a,c,l);let h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}},uK=.06,dK=.7,hK=6e-4;function df(e){let t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),yr(()=>document.removeEventListener("visibilitychange",t))}var rT=class extends rt{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=n=>{let s=this._keyMap[n.data.key];if(n.modifiers.has("Meta")||n.modifiers.has("Control"))return void this._stopMovement();if(s==null)return;n.stopPropagation(),n.preventDefault();let o=n.type==="key-down";if(this._pressedKeys[o?"add":"delete"](s),o){if(this._direction===s)return;this._direction=s,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{let a=this._timeout===void 0,l=this._pressedKeys.size>0;a||l?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=df(n=>n?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(t){let i=this._currentDirection!=null;if(t!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=t===void 0?void 0:setTimeout(()=>{this._timeout=void 0,t()},this._stickyKeyDuration)}};var nT=class extends rt{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(i),this.registerIncoming("key-down",r,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",r,n=>this._handleKeyUp(n)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=df(n=>n?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(t){this._addKeyMapping(t.clockwise,"clockwise"),this._addKeyMapping(t.counterClockwise,"counterClockwise"),this._addKeyMapping(t.reset,"reset")}_addKeyMapping(t,i){for(let r of t)this._keyToDirection.set(r,i)}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){let r=t.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;let n=this._keyToDirection.get(t.data.key);if(this._pressed=n!=null,this._pressed){if(t.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}};var hf;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(hf||(hf={}));var sT=class extends rt{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,n=>this._handleKeyDown(n)),i.zoomIn.forEach(n=>this._keysToZoomAction[n]=hf.IN),i.zoomOut.forEach(n=>this._keysToZoomAction[n]=hf.OUT)}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){let i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;let{key:r}=t.data;if(!(r in this._keysToZoomAction))return;let n=this._keysToZoomAction[r],{mapViewNavigation:s}=this.view,o=null;switch(n){case hf.IN:o=s.zoomIn();break;case hf.OUT:o=s.zoomOut();break;default:return}s.begin(),o.then(()=>s.end()),t.stopPropagation()}};var pK=.6,oT=class extends rt{constructor(t,i){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(t.preventDefault(),t.stopPropagation(),!this._canZoom))return;let i=this._view.mapViewNavigation,{x:r,y:n,deltaY:s}=t.data,o=1/pK**(1/60*s),a=i.zoom(o,[r,n]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}};var aT=class extends rt{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());let i=this.view.mapViewNavigation;this._dragEventSeparator=new Io({start:(r,n)=>{i.pinch.begin(this.view,n.data),n.stopPropagation()},update:(r,n)=>{i.pinch.update(this.view,n.data),n.stopPropagation()},end:(r,n)=>{i.pinch.end(this.view),n.stopPropagation()},condition:r=>r>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function TR(e){let t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>mK(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Dz(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function xz(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function mK(e,t){let i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}var lT=class{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{let o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,TR(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;let r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(Mz(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){let i=new nf(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Kr({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){let t=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;Mz(n=>{let s=this._inputDevices[n.index];if(!s)return;let o=this._latestUpdate[n.index],a=TR(s),l=r||xz(a);o&&(o.timestamp===n.timestamp||!o.active&&l||Dz(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_emitGamepadEvent(t,i,r){let n=this._latestUpdate[t.index],s=n&&n.active;if(!s&&!r)return;let o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:o})}};function fK(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function Mz(e){for(let t of navigator.getGamepads())fK(t)&&e(t)}var Sz=Ct("edge"),gK=Ct("chrome"),_K=Ct("ff"),yK=Ct("safari"),Iz="esri-view-surface",pf={touchNone:`${Iz}--touch-none`,touchPan:`${Iz}--touch-pan`},cT=(()=>{class e{constructor(i,r){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=i,i.getAttribute("tabindex")||i.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new lT(i,r),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(i=>this._releasePointerCaptureSafe(i)),this._activePointerCaptures.clear(),this._gamepadSource=G(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(i){this._browserTouchPanningEnabled=i,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(i){this._callback=i}set activeEvents(i){for(let r in this._active)if(!i||!i.has(r)){let n=this._active[r];this._element.removeEventListener(ER[r],n),delete this._active[r]}i&&i.forEach(r=>{if(!this._active[r]&&ER[r]){let n=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(ER[r],n),this._active[r]=n}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=i?.has("gamepad")??!1)}setPointerCapture(i,r){r?this._setPointerCaptureSafe(i.pointerId):(this._releasePointerCaptureSafe(i.pointerId),this._activePointerCaptures.delete(i.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?pf.touchNone:pf.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?pf.touchPan:pf.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(pf.touchNone),this._element.classList.remove(pf.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(i){try{this._element.setPointerCapture(i),this._activePointerCaptures.add(i)}catch{}}_releasePointerCaptureSafe(i){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(i))return;this._element.releasePointerCapture(i)}catch{}}_updateNormalizedPointerLikeEvent(i,r){let n=iV(this._element,i);return e.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),r.x=n.x,r.y=n.y,r}_handleKey(i,r){let{key:n}=r;n&&i==="key-up"&&this._keyDownState.delete(n);let s={native:r,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&i==="key-down"&&this._keyDownState.add(s.key),this._callback(i,s)}_handlePointer(i,r){let n=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(i,n)}_handlePointerPreventDefault(i,r){let n=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(i,n)}_getDeltaFromTrackpadOrMouseWheel(i){return i.shiftKey&&Ct("mac")&&i.deltaY===0?i.deltaX:i.deltaY}_handleMouseWheel(i,r){let n=this._getDeltaFromTrackpadOrMouseWheel(r);switch(r.deltaMode){case 0:Sz&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}Sz?n*=.7:gK||yK?n*=.6:_K&&(n*=1.375);let s=100,o=Math.abs(n);o>s&&(n=n/o*200/(1+Math.exp(-.02*(o-s))));let a=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:n});this._callback(i,a)}_handlePointerCaptureLost(i,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(i,r)}_handleDefault(i,r){let n={native:r};r.preventDefault(),this._callback(i,n)}_preventAltKeyDefault(i){i.key==="Alt"&&i.preventDefault()}_preventMultiTouchPanning(i){i.touches.length>1&&i.preventDefault()}}return e.test={disableSubpixelCoordinates:!1},e})(),ER={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};var mf=class extends rt{constructor(){super(!0),this.registerIncoming("context-menu",t=>t.data.native.preventDefault())}};var fr={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Mh(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Az(e,t){let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function Rz(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Zi()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){let[E,D]=e,[M,T]=[D.x-E.x,D.y-E.y];return t.radius=Math.sqrt(M*M+T*T)/2,t.center.x=(E.x+D.x)/2,t.center.y=(E.y+D.y)/2,t}let i=0,r=0;for(let E=0;E<e.length;E++)i+=e[E].x,r+=e[E].y;i/=e.length,r/=e.length;let n=e.map(E=>E.x-i),s=e.map(E=>E.y-r),o=0,a=0,l=0,c=0,h=0,p=0,m=0;for(let E=0;E<n.length;E++){let D=n[E],M=s[E],T=D*D,I=M*M;o+=T,a+=I,l+=D*M,c+=T*D,h+=I*M,p+=D*I,m+=M*T}let f=.5*(c+p),g=.5*(h+m),_=o*a-l*l,v=(f*a-g*l)/_,b=(o*g-l*f)/_,x=Zi(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/e.length),center:x}}function ul(e){let{native:t}=e,{pointerId:i,button:r,pointerType:n}=t;return n==="mouse"?`${i}:${r}`:`${n}`}var uT=class extends rt{constructor(t=fr.maximumDoubleClickDelay,i=fr.maximumDoubleClickDistance,r=fr.maximumDoubleTouchDelay,n=fr.maximumDoubleTouchDistance,s=Oa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=Zi(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Io({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=kt(t.doubleTapTimeout)})}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(t){let i=this._pointerState.get(t);i&&(i.doubleTapTimeout=kt(i.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,i){if(!this._doubleTapDragReady||t!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;let{data:r,modifiers:n}=i,{center:s}=r;this._dragStartCenter=s;let o=DR("begin",Zi(0,0),r);this._doubleTapDrag.emit(o,void 0,n),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:r}=t,{center:n}=i,s=DR("update",Zi(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(s,void 0,r),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:r}=t,{center:n}=i,s=DR("end",Zi(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(s,void 0,r),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){let{data:i}=t,r=ul(i),n=this._pointerState.get(r),{pointerType:s}=i.native;if(n){let o=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),Mh(n.event.data,i)>o?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){let{data:i}=t,{pointerType:r}=i.native,n=ul(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(n),s);this._pointerState.set(n,{event:t,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};function DR(e,t,i){let{button:r,buttons:n,pointer:s,pointers:o,pointerType:a,timestamp:l}=i;return{action:e,delta:t,button:r,buttons:n,pointer:s,pointers:o,pointerType:a,timestamp:l}}var ff=class extends rt{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,n){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:vK(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){let i=t.native.pointerId,r=dT(this._activePointerMap).angle,n={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);let s=hT(n,Oz(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;let i=t.native.pointerId,r=this._activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){let i=dT(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){let i=dT(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=hT(r,i)-t,r.lastAngle=hT(r,i)-t})}_emitEvent(t,i,r){let n=dT(this._activePointerMap);this._drag.emit(this._createPayload(t,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){let i=t.data.native.pointerId,r=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){let i=t.data,r=i.currentEvent,n=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Oz(e){let t=[];return e.forEach(i=>{t.push(Zi(i.event.x,i.event.y))}),Rz(t)}function dT(e){let t=Oz(e),i=0;return e.forEach(r=>{let n=hT(r,t),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;let o=n-r.initialAngle;i+=o}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function vK(e){let t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function hT(e,t){let i=e.event,r=i.x-t.center.x,n=i.y-t.center.y;return Math.atan2(n,r)}var Pz;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(Pz||(Pz={}));var gf=class extends rt{constructor(t=fr.maximumDoubleClickDelay,i=fr.maximumDoubleClickDistance,r=fr.maximumDoubleTouchDelay,n=fr.maximumDoubleTouchDistance,s=Oa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){let i=t.data,r=ul(i);if(!this._pointerState.has(r)){let n={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(t){let i=t.data,r=ul(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){let s=n.immediateDoubleClick,o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),Mh(s,t.data)>o?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,s.modifiers),this._removeState(i))):Mh(n,t.data)>o?this._removeState(i):this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){let r=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_removeState(t){let i=ul(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}};var _f=class extends rt{constructor(t=fr.maximumClickDelay,i=fr.movementUntilMouseDrag,r=fr.movementUntilPenDrag,n=fr.movementUntilTouchDrag,s=fr.holdDelay,o=Oa){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=kt(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){let i=t.data,r=i.native.pointerId,n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{let o=this._pointerState.get(r);if(o){if(!o.isDragging){let a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));let s={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_handlePointerMove(t){let i=t.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(pT("update",n,i),void 0,n.modifiers):Az(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),n.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){let i=t.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=t.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(pT("start",n,i)):this._pointerDrag.emit(pT("start",n,n.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){let r=t.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(pT("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&t.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function pT(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}var yf=class extends rt{constructor(t=fr.maximumDoubleClickDelay,i=fr.maximumDoubleClickDistance,r=fr.maximumDoubleTouchDelay,n=fr.maximumDoubleTouchDistance,s=Oa){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=kt(t.doubleClickTimer))}get hasPendingInputs(){for(let t of this._pointerState.values())if(t.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(t,i){let r=this._pointerState.get(t);r&&(r.doubleClickTimer=kt(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){let i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_handleImmediateClick(t){let i=t.data,{pointerType:r}=i.native,n=wK(i);if(!this._pointerState.has(n))return void this._startClick(t);let s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Mh(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(t)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){let i=ul(t.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(t){let{data:i}=t,{native:{pointerType:r}}=i,n=ul(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s);this._pointerState.set(n,{event:t,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function wK(e){let{pointerId:t,pointerType:i,button:r}=e.native;return i==="mouse"?`${t}:${r}`:`${i}`}var mT={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},Nz=Symbol("handles"),Sh=class extends P{initialize(){let e=()=>this.view?.ready;this.addHandles([Wi(()=>!e(),()=>this._disconnect()),Wi(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(Nz),this._inputManager=G(this._inputManager)}_connect(){let e=this.view.surface,t=new cT(e,this.view.input),i=[new gf,new _f,new yf,new ff(this.view.navigation),new uT],r=new ow({eventSource:t,recognizers:i}),n=new eT(this.view,["primary"]),s=new tT(this.view,["secondary"]);r.installHandlers("prevent-context-menu",[new mf],qa.INTERNAL),r.installHandlers("navigation",[new aT(this.view),new iT(this.view),new oT(this.view),new fy(this.view),new fy(this.view,[mT.counter]),n,new rT(this.view,mT.pan),new sT(this.view,mT.zoom),new nT(this.view,mT.rotate),s,new JC(this.view,"touch")],qa.INTERNAL),this.view.viewEvents.connect(r),this._source=t,this._inputManager=r,this.addHandles([S(()=>this.view?.navigation?.browserTouchPanEnabled,o=>{this._source&&(this._source.browserTouchPanningEnabled=!o)},Re),S(()=>{let{actionMap:o}=this.view.navigation;return{panActions:xh("pan",o),rotateActions:xh("rotate",o)}},({panActions:o,rotateActions:a})=>{n.pointerActions=o,s.pointerActions=a},Ce)],Nz)}get test(){}};u([d()],Sh.prototype,"view",void 0),u([d()],Sh.prototype,"latestPointerType",null),u([d()],Sh.prototype,"latestPointerLocation",null),u([d()],Sh.prototype,"multiTouchActive",null),Sh=u([C("esri.views.2d.input.MapViewInputManager")],Sh);var Lz=Sh;var Fz=160,vf=class extends P{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=Fz&&this.clear()},Fz))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};u([d()],vf.prototype,"_timer",void 0),u([d()],vf.prototype,"stationary",null),vf=u([C("esri.views.2d.support.StationaryManager")],vf);var kz=e=>{let t=class extends e{constructor(...i){super(...i),this.fullOpacity=1,this.stateManager=new sn({constraints:new bR({view:this})}),this.goToManager=new hy({view:this}),this.stationaryManager=new vf,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new KC(this),this.inputManager=new Lz({view:this}),this.viewEvents=new uw(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([S(()=>this.viewpoint,()=>this.stationaryManager.flip(),Fe),this.on("resize",r=>this.stateManager.resize(r.width,r.height))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(i){this.stateManager.extent=i}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(i){let r=this._get("animation");if(i===r)return;if(r&&r.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return void this._set("animation",null);this._set("animation",i);let n=()=>{this.destroyed||i===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};i.when(n,n)}get constraints(){return this.stateManager?.constraints}set constraints(i){i.view=this;let r=this.stateManager.constraints;this.stateManager.constraints=i,r?.destroy()}get padding(){return this.stateManager?.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get rotation(){return this.stateManager.rotation??0}set rotation(i){let{rotationEnabled:r}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=r}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}on(i,r,n,s){return this.inputManager&&this.viewEvents.on(i,r,n,s)||super.on(i,r)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}goTo(i,r){return this.goToManager.goTo(i,r)}};return u([d({readOnly:!0})],t.prototype,"animationManager",void 0),u([d({readOnly:!0})],t.prototype,"fullOpacity",void 0),u([d()],t.prototype,"stateManager",void 0),u([d()],t.prototype,"constraintsInfo",null),u([d()],t.prototype,"extent",null),u([d()],t.prototype,"goToManager",void 0),u([d({readOnly:!0})],t.prototype,"state",null),u([d({readOnly:!0})],t.prototype,"mapViewNavigation",void 0),u([d()],t.prototype,"renderingOptions",void 0),u([d({readOnly:!0})],t.prototype,"interacting",null),u([d()],t.prototype,"stationary",null),u([d()],t.prototype,"animation",null),u([d({type:bR})],t.prototype,"constraints",null),u([d({readOnly:!0})],t.prototype,"inputManager",void 0),u([d()],t.prototype,"padding",null),u([d()],t.prototype,"resizeAlign",null),u([d()],t.prototype,"rotation",null),u([d({readOnly:!0})],t.prototype,"viewEvents",void 0),u([d({type:Si})],t.prototype,"viewpoint",null),t=u([C("esri.views.Viewport2DMixin")],t),t};var _y=class{constructor(t){this._view=t,this.viewpoint=new Si({targetGeometry:new pt,scale:0,rotation:0})}get view(){return this._view}get size(){let[t,i]=this._view.size;return Math.sqrt(t*t+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return Uk(this.center.spatialReference)}pixelsPerPanAtZoom(t){return 1/(t*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(t){return 1/(t*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(t,i){i.pan=P2(this.center,t.center);let r=Math.abs(t.rotation-this.rotation);r=r>=180?360-r:r,i.rotate=Vt(r),i.sourceZoom=this.scale,i.targetZoom=t.scale}interpolate(t,i,r){let{pan:n,rotate:s,zoom:o,zoomOffset:a}=r,{center:l}=this;l.spatialReference=t.center.spatialReference,l.x=Xe(t.center.x,i.center.x,n),l.y=Xe(t.center.y,i.center.y,n),this.viewpoint.scale=Xe(t.scale,i.scale+a,o);let c=t.rotation,h=i.rotation;Math.abs(h-c)>=180&&(c+=360*(c<h?1:-1)),this.viewpoint.rotation=Xe(c,h,s)}copyFrom(t){go(this.viewpoint,t.viewpoint),this._view=t.view}};var bK=e=>e,yy=e=>e*e,fT=e=>1-yy(1-e),CK=e=>e<.5?yy(2*e)/2:(fT(2*(e-.5))+1)/2,xR=e=>e*e*e,Vz=e=>1-xR(1-e),MR=e=>e<.5?xR(2*e)/2:(Vz(2*(e-.5))+1)/2,SR=e=>e*e*e*e,Hz=e=>1-SR(1-e),TK=e=>e<.5?SR(2*e)/2:(Hz(2*(e-.5))+1)/2,IR=e=>e*e*e*e*e,Bz=e=>1-IR(1-e),EK=e=>e<.5?IR(2*e)/2:(Bz(2*(e-.5))+1)/2,AR=e=>1-Math.cos(e*Math.PI/2),Uz=e=>1-AR(1-e),DK=e=>e<.5?AR(2*e)/2:(Uz(2*(e-.5))+1)/2,RR=e=>2**(10*(e-1)),ku=e=>1-RR(1-e),xK=e=>e<.5?RR(2*e)/2:(ku(2*(e-.5))+1)/2,PR=e=>-(Math.sqrt(1-e*e)-1),jz=e=>1-PR(1-e),MK=e=>e<.5?PR(2*e)/2:(jz(2*(e-.5))+1)/2;function Ao(e){let t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function Ro(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}var SK=Ro(Ao(1),1),IK=Ro(Ao(1),0),gT=Ro(Ao(1),.5),AK=Ro(Ao(2),1),RK=Ro(Ao(2),0),PK=Ro(Ao(2),.5),OK=Ro(Ao(3),1),NK=Ro(Ao(3),0),LK=Ro(Ao(3),.5),FK=Ro(Ao(4),1),kK=Ro(Ao(4),0),VK=Ro(Ao(4),.5),vy={linear:bK,"in-quad":yy,"out-quad":fT,"in-out-quad":CK,"in-coast-quad":SK,"out-coast-quad":IK,"in-out-coast-quad":gT,"in-cubic":xR,"out-cubic":Vz,"in-out-cubic":MR,"in-coast-cubic":AK,"out-coast-cubic":RK,"in-out-coast-cubic":PK,"in-quart":SR,"out-quart":Hz,"in-out-quart":TK,"in-coast-quart":OK,"out-coast-quart":NK,"in-out-coast-quart":LK,"in-quint":IR,"out-quint":Bz,"in-out-quint":EK,"in-coast-quint":FK,"out-coast-quint":kK,"in-out-coast-quint":VK,"in-sine":AR,"out-sine":Uz,"in-out-sine":DK,"in-expo":RR,"out-expo":ku,"in-out-expo":xK,"in-circ":PR,"out-circ":jz,"in-out-circ":MK,ease:e=>Wg.ease(e),"ease-in":e=>Wg.easeIn(e),"ease-out":e=>Wg.easeOut(e),"ease-in-out":e=>Wg.easeInOut(e)};var _T=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};var Ih={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},OR=be(ie({},Ih),{maxDuration:4e3});var yT=class e{constructor(t){this._createCamera=t,this.compared=new _T,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:Ih.desiredScreenFlow},this.source=t(),this.target=t()}clone(){let t=new e(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow??Ih.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){let i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>w0()}get hasFov(){return Math.abs(this.compared.fov)>w0()}get hasRotate(){return this.compared.rotate>w0()}};var vT=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};var Gz=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0,n=this.definition,s=this.segments.reduce((o,a)=>o||a.definition.hasZoom,!1);for(let o=0;o<this.segments.length;o++){let a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,t),n.hasPan&&!isNaN(t.pan)&&isFinite(n.compared.pan)?t.pan=(i+l.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate&&!isNaN(t.rotate)&&isFinite(n.compared.rotate)?t.rotate=(r+l.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1,s&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){let{sourceZoom:c,targetZoom:h}=l.compared,p=t.zoom*(h-c)+c,m=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,g=Math.abs(h-m)>Math.abs(c-m)?h:c;t.zoomOffset=g-f,t.zoom=(p-m)/(g-m)}else t.zoom=1;return t}e-=a.time,i+=l.compared.pan,r+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}};var wf=class{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){let t=this.definition,i=t.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);let s=(t.source.pixelsPerRotate()+t.target.pixelsPerRotate())/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){let t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition,o=0,a=0;r&&(n&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;let l=this.definition.desiredPixelFlow;if(r&&n&&s){let c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){let c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){let c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){let c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);if(this._time=Math.max(this.rotateTime,this.zoomTime,this.panTime),this.fovTime>this._time){let c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/HK:0}get panTime(){if(!this.definition.hasPan)return 0;if(this.definition.hasZoom){let t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){let i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsFov(t){if(t===0)return this.definition.segmentStart;if(t===1)return this.definition.segmentEnd;if(this.definition.hasFov){let{segmentStart:i,segmentEnd:r}=this.definition;return i+t*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){let i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),i.zoom=this._interpolateComponentsZoom(t),i.pan=this._interpolateComponentsPan(t),i.rotate=this._interpolateComponentsRotate(t),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(t)}},HK=Vt(45);function qz(e,t,i){let r=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function Wz(e,t,i){let r=1/t,n=Math.log(e.compared.sourceZoom*r),s=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*s*o*l*c-e.halfWindowSize*n*s*o*l+e.halfWindowSize*n*s*o*c/(a*a)}function $z(e,t,i){let r=t-e.compared.sourceZoom,n=1/r,s=1/t,o=Math.log(e.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Zz(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function Qz(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Yz(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Kz(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function Xz(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function Jz(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function e4(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function t4(e,t,i){let r=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,s=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*n*s*a+e.halfWindowSize*r*n*s*l/(o*o)+e.halfWindowSize*n*s*a*l/t}function i4(e,t,i){let r=t-e.compared.targetZoom,n=1/r,s=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function r4(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function n4(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function s4(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function o4(e){let t=e.compared.sourceZoom-e.compared.targetZoom;if(t===0)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));let i=Math.LN2*e.compared.pan,r=t,n=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*n);return e.compared.sourceZoom<=e.compared.targetZoom?s*(i-n):s*(i+n)}function a4(e,t){let i=BK(e,t),r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?Zz:qz,a=n?Qz:Wz,l=n?Yz:$z,c=s?r4:e4,h=s?n4:t4,p=s?s4:i4,m=D=>o(e,D,r)+Kz(e,D,r)+c(e,D,r),f=D=>a(e,D,r)+Xz(e,D,r)+h(e,D,r),g=D=>l(e,D,r)+Jz(e,D,r)+p(e,D,r),_=m(i),v=o4(e),b,x=t.maximumIterations||20,E=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<x;b++){let D=t.desiredSlope??1e-6,M=f(i);Math.abs(M)>D&&(M+=D);let T=M/g(i);if(isNaN(T)||i>=E&&T<0){if(!isFinite(E))return null;i=E,_=m(i);break}if(i-=T,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;let I=m(i);if(Math.abs(I-_)/_<=.005)break;_=I}return _>v*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function BK(e,t){let i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}var wT=class extends Gz{constructor(t,i){super(),this._preallocSegments=[new wf,new wf,new wf],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=i?.apex?a4(t,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(t,i,r){t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=fT(r.zoom):t===this._descensionSegment&&(r.zoom=yy(r.zoom))}_updateWithApex(t,i){let[r,n,s]=this._preallocSegments,o=i?.ascensionFactor??.5,a=Math.min(1-o,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=t,n.definition.compared.targetZoom=t,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.definition.segmentStart=r.definition.segmentEnd,n.definition.segmentEnd=r.definition.segmentEnd+l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=t,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.definition.segmentStart=o+l,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){let[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}};var UK=new vT,bT=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=gT,this.definition=new yT(e),this.path=new wT}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(s0(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?gT:ku)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);let i=this.path.interpolateComponentsAt(e,UK);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){let t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){let i=t.speedFactor!=null?t.speedFactor:1,r=t.minDuration??Ih.minDuration/i,n=t.maxDuration??Ih.maxDuration/i;return e=t.duration!=null?t.duration:Math.min(Math.max(e/i,r),n)}};var jK=2e3,zK=64,NR=class{constructor(t){this._view=t,this._animation=new bT(()=>new _y(this._view)),this._current=new _y(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(t,i,r={}){go(this._current.viewpoint,t),go(this._source.viewpoint,t),go(this._target.viewpoint,i),this._animation.update(this._source,this._target,r)}applyRatio(t,i){this._animation.cameraAt(i,this._current),go(t,this._current.viewpoint)}},bf=class extends P{constructor(e){super(e),this._animation=null,this._destinationViewState=new lf,this.updateFunction=null,this.easing=vy.ease,this.viewpoint=new Si({targetGeometry:new pt,scale:0,rotation:0}),this._updateTask=Kr({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new NR(e.view)}destroy(){this._updateTask=kt(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();let r=this.viewpoint;go(r,t);let n=e.target;this._transition.update(this.viewpoint,n,{apex:{maximumDistance:Math.min(Math.min(t.scale,n.scale)*zK,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:i?.animationMode==="auto"?1/0:i?.maxDuration??OR.maxDuration,speedFactor:i?.speedFactor,easing:(typeof i?.easing=="string"?vy[i.easing]:i?.easing)||this.easing}),i?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=n,GK(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,n,{duration:0}));let s=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;let i=new bn({target:e.clone()}),r=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){let t=this.animation;if(t&&t.state!==bn.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{let i=performance.now()-this._startTime,r=this._transition.duration,n=r>0?i/r:1,s=n>=1;this._transition.applyRatio(this.viewpoint,n),s&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function GK(e,t,i,r){if(t?.duration!=null)return!0;let{time:n,isLinear:s}=e,o=t?.speedFactor||1;if(n>(t?.maxDuration??OR.maxDuration/o))return!1;if(s){let l=Hi(),c=Zi(...r.toScreen(l,...i.center)),h=Zi(...i.toScreen(l,...r.center)),p=h!=null&&h.x>-1*i.size[0]&&h.x<(1.5+.5)*i.size[0]&&h.y>-1*i.size[1]&&h.y<(1.5+.5)*i.size[1],m=c!=null&&c.x>-1*r.size[0]&&c.x<(1.5+.5)*r.size[0]&&c.y>-1*r.size[1]&&c.y<(1.5+.5)*r.size[1];if(n>jK/o&&!p&&!m)return!1}return!0}u([d()],bf.prototype,"easing",void 0),u([d()],bf.prototype,"view",void 0),u([d()],bf.prototype,"viewpoint",void 0),bf=u([C("esri.views.2d.AnimationManager")],bf);var l4=bf;function Oi(){return Promise.all([import("./chunk-KNLVA5SZ.js"),import("./chunk-2K6JY746.js")])}var wy=()=>Oi().then(()=>import("./chunk-4QUOG5O4.js")),Ah=()=>Oi().then(()=>import("./chunk-FRN2ZXE6.js")),c4={"base-dynamic":()=>Oi().then(()=>import("./chunk-PY6IBGHY.js")),"base-tile":wy,"bing-maps":wy,catalog:()=>Oi().then(()=>import("./chunk-UXRKY3CE.js")),"catalog-dynamic-group":()=>Oi().then(()=>import("./chunk-WEYYXRKO.js")),"catalog-footprint":()=>Oi().then(()=>import("./chunk-DEVWNJ5E.js")),csv:Ah,"geo-rss":()=>Oi().then(()=>import("./chunk-GKSWWYIB.js")),feature:Ah,geojson:Ah,parquet:Ah,graphics:()=>Oi().then(()=>import("./chunk-56VS4PUY.js")),group:()=>Oi().then(()=>import("./chunk-Z7EW2RGL.js")),imagery:()=>Oi().then(()=>import("./chunk-QUM2FGVT.js")),"imagery-tile":()=>Oi().then(()=>import("./chunk-6I3Z6LZR.js")),kml:()=>Oi().then(()=>import("./chunk-AWHWCJ7R.js")),"knowledge-graph":()=>Oi().then(()=>import("./chunk-YH3W7XBG.js")),"link-chart":()=>Oi().then(()=>import("./chunk-YH3W7XBG.js")),"knowledge-graph-sublayer":Ah,"map-image":()=>Oi().then(()=>import("./chunk-WHEKUNVF.js")),"map-notes":()=>Oi().then(()=>import("./chunk-SQTCCJH3.js")),media:()=>Oi().then(()=>import("./chunk-3K57EZNW.js")),"ogc-feature":()=>Oi().then(()=>import("./chunk-VJRU2QAJ.js")),"open-street-map":wy,"oriented-imagery":Ah,route:()=>Oi().then(()=>import("./chunk-DJBEDGAS.js")),stream:()=>Oi().then(()=>import("./chunk-SQTNHM3B.js")),"subtype-group":()=>Oi().then(()=>import("./chunk-TO7GLMHP.js")),tile:wy,"vector-tile":()=>Oi().then(()=>import("./chunk-GTBJVJQN.js")),video:()=>Oi().then(()=>import("./chunk-5BC4N56B.js")),wcs:()=>Oi().then(()=>import("./chunk-6I3Z6LZR.js")),"web-tile":wy,wfs:Ah,wms:()=>Oi().then(()=>import("./chunk-MUU5RLHZ.js")),wmts:()=>Oi().then(()=>import("./chunk-P3U77DLP.js")),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function qK(e){let t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Be(`${i}:view-not-supported`,`${t} is not supported in 2D`)}var LR={hasLayerViewModule:e=>c4[e.type]!=null,importLayerView:e=>{let t=c4[e.type];if(t==null)throw qK(e);return t(e)}};var Rh={added:[],removed:[]},FR=new Set,WK=new k0(0,0,0,0);function $K(e,t){let i=D2(t);if(!i)return null;let[r,n]=i.valid;return e[2]>n?[Yt([e[0],e[1],n,e[3]]),Yt([r,e[1],r+e[2]-n,e[3]])]:e[0]<r?[Yt([r,e[1],e[2],e[3]]),Yt([n-(r-e[0]),e[1],n,e[3]])]:null}var CT=class extends oi{constructor(t){super(),this._tiles=new Map,this._index=iF(9,Ct("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}getIntersectingTiles(t){if(!t||ao(t)===0||Ul(t)===0)return[];let i=$K(t,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){let i={added:[],removed:[]};for(let r of t.added)if(!this.has(r)){let n=new iM(this.tileScheme,r);this._tiles.set(r,n),this._index.insert(n),i.added.push(n)}for(let r of t.removed)if(this.has(r)){let n=this.get(r);this._tiles.delete(r),this._index.remove(n),i.removed.push(n)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(t){let i=this.tileScheme.getTileCoverage(t,0);if(!i)return;let{spans:r,lodInfo:n}=i,{level:s}=n;if(r.length>0)for(let{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){let h=WK.set(s,o,n.normalizeCol(c),n.getWorldForColumn(c)).id;if(FR.add(h),!this.has(h)){let p=new iM(this.tileScheme,h);this._tiles.set(h,p),this._index.insert(p),this.tiles.push(p),Rh.added.push(p)}}for(let o=this.tiles.length-1;o>=0;o--){let a=this.tiles[o];FR.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),Rh.removed.push(a))}(Rh.added.length||Rh.removed.length)&&this.emit("update",Rh),ZL.pool.release(i),FR.clear(),Rh.added.length=0,Rh.removed.length=0}};async function h4(e,t,i){let r=Hd(t)?Vd(e,t):t;if(!e.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let n=new Set,s=new Set,o=!1,a=null,l=null;i?.include?d4(i.include,u4(e,m=>{n.add(m),kR(m,f=>s.add(f))},(m,f)=>{s.add(m),n.add(f)},m=>{a||(a=new Set),a.add(m)},m=>n.add(m),()=>o=!0)):(o=!0,n=new Set(e.allLayerViews),n.forEach(m=>{kR(m,f=>s.add(f))})),i?.exclude&&d4(i.exclude,u4(e,m=>{n.delete(m),kR(m,f=>s.delete(f))},m=>s.delete(m),m=>{l||(l=new Set),l.add(m)}));let c=e.toMap(r),h=e.allLayerViews.filter(m=>!m.suspended&&n.has(m)&&m.clips.every(f=>pw(e,f,r,c))).reverse(),p=[...o?e.graphicsView.hitTest(c).map(m=>({type:"graphic",graphic:m,layer:null,mapPoint:c})):[],...await Promise.all(h.map(m=>m.hitTest(c,r)).toArray())].filter(bd).flat().filter(bd);return p=p.filter(m=>m.type!=="graphic"||m.layer?.type!=="subtype-group"||s.has(m.graphic.layer)),a&&(p=p.filter(m=>!("graphic"in m)||!m.graphic||a?.has(VR(m.graphic)))),l&&(p=p.filter(m=>!("graphic"in m)||!m.graphic||!l?.has(VR(m.graphic)))),{screenPoint:r,results:p}}function u4(e,t,i,r,n,s){return o=>{if(o instanceof rs){if(o.layer===e)s?.();else{let a=e.allLayerViews.find(l=>l.layer===o.layer);a&&n?.(a)}r(VR(o))}else if(!("layer"in o&&"element"in o))if(o.type==="subtype-sublayer"){let a=e.allLayerViews.find(l=>l.layer===o.parent);a&&i(o,a)}else{let a=e.allLayerViews.find(l=>l.layer===o);a&&t(a)}}}function d4(e,t){if(e)if(Ex(e))for(let i of e)if(Ex(i))for(let r of i)t(r);else t(i);else t(e)}function VR(e){let t=e.getObjectId();return t?`${e.layer?.uid??e.sourceLayer?.uid??"MapView"}/${t}`:`"MapView/${e.uid}`}function kR({layer:e},t){e?.type==="subtype-group"&&e.sublayers.forEach(i=>{t(i)})}var p4={flipY:!0,premultipliedAlpha:!0};async function m4(e,t){let i=await g4(e,t),{format:r,quality:n}=hV(t?.format,t?.quality);return uV(i,{format:r,quality:n},p4)}async function f4(e,t){let i=await g4(e,t);return dV(i,p4)}function g4(e,t){let i=YK(t||{},QK(e.stage,e.size),e.size,e.padding),r=ZK(t,e.allLayerViews);return e.stage.takeScreenshot(i,r,e.backgroundColor,t?.rotation)}function ZK(e={},t){if(!e.layers)return;let i=[];return e.layers.forEach(r=>{let n=t.find(s=>s.layer.id===r.id);n?.container&&i.push(n.container)}),i}function QK(e,t){return Math.min(4,pV(t,Math.min(4096,e.context.parameters.maxTextureSize)))}function YK(e,t,i,r){e.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let n=null;e.width!=null&&e.height!=null?n=[e.width,e.height]:e.width==null&&e.height!=null?n=[e.height,e.height]:e.width!=null&&e.height==null?n=[e.width,e.width]:e.width==null&&e.height==null&&(n=null);let s=i[0]-(r.left+r.right),o=i[1]-(r.top+r.bottom),a,l,c=e.area||{x:0,y:0,width:s,height:o};if(n){let h=s/o,p=n[0]/n[1];if(p>h){let m=c.width/p;c={x:c.x,y:Math.round(c.y+(c.height-m)/2),width:c.width,height:Math.round(m)}}else{let m=c.height*p;c={x:Math.round(c.x+(c.width-m)/2),y:c.y,width:Math.round(m),height:c.height}}}else n=[c.width,c.height];return n[0]>c.width?(a=Math.min(n[0]/c.width,t),l=n[0]/c.width/a):(a=1,l=n[0]/c.width),{cropArea:{x:Math.round((c.x+r.left)*a),y:Math.round((c.y+r.top)*a),width:Math.round(c.width*a),height:Math.round(c.height*a)},outputScale:l,resolutionScale:a}}function TT(e){let t=Ak();return t.available?e==="3d"&&t.majorPerformanceCaveat?new Be("webgl:major-performance-caveat-detected",`Your WebGL implementation (${t.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new Be("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new Be("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new Be("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function KK(e){return e&&"nodeType"in e}function XK(e){return e&&typeof e.render=="function"}var _4={component:"esri-component"},Ph=class extends P{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){let t=this._get("node");e!==t&&(e&&e.classList.add(_4.component),t&&t.classList.remove(_4.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||KK(e)?(this._set("widget",null),Cp(e)):(XK(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d()],Ph.prototype,"id",null),u([d()],Ph.prototype,"node",null),u([Ir("node")],Ph.prototype,"castNode",null),u([d({readOnly:!0})],Ph.prototype,"widget",void 0),Ph=u([C("esri.views.ui.Component")],Ph);var Vu=Ph;var JK={left:0,top:0,bottom:0,right:0},y4={bottom:30,top:15,right:15,left:15},yc="esri-ui",vs={ui:yc,corner:`${yc}-corner`,innerContainer:`${yc}-inner-container`,manualContainer:`${yc}-manual-container`,cornerContainer:`${yc}-corner-container`,topLeft:`${yc}-top-left`,topRight:`${yc}-top-right`,bottomLeft:`${yc}-bottom-left`,bottomRight:`${yc}-bottom-right`};function eX(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function ET(e){return e===0?"0":`${e}px`}function HR(e){let t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function BR(e,{top:t,bottom:i,left:r,right:n}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=n}var dl=class extends oi.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=m2(),this.view=null,this._applyViewPadding=()=>{let t=this.container;t&&BR(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{let t=this._innerContainer;t&&BR(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([S(()=>[this.view?.padding,this.container],this._applyViewPadding,Re),S(()=>this.padding,this._applyUIPadding,Re),S(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},Re),f2(e=>{this._locale=e})])}destroy(){this.container=null;for(let e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){let t=this._get("container");e!==t&&(e&&(e.classList.add(vs.ui),b2(e),this._attachContainers(e)),t&&(t.classList.remove(vs.ui),BR(t,{top:"",bottom:"",left:"",right:""}),t.textContent=""),this._set("container",e))}get height(){let e=this.view?.height??0;if(e===0)return e;let t=this._getViewPadding(),{top:i,bottom:r}=t;return Math.max(e-i-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:ie(ie({},y4),e)}get width(){let e=this.view?.width??0;if(e===0)return e;let t=this._getViewPadding(),{left:i,right:r}=t;return Math.max(e-i-r,0)}add(e,t){let i,r,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,t));let s=HR(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t,internal:n}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r,n)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));let i=this._find(e);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==t)return;let r=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),i.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(r,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(let n of e)this.empty(n,t);return}let i=this._positionNameToContainerLookup[e??"manual"],r=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||t.removeInternal);for(let n of r)this.remove(n)}move(e,t){if(Array.isArray(e)&&e.forEach(s=>this.move(s,t)),!e)return;let i,r=HR(e)||HR(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;let n=this.remove(e);n&&this.add(n,{position:t,index:i})}find(e){if(!e)return null;let t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,t)):this._getComponentsAtPosition(e,t):this._components.filter(i=>t.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:r})=>i??r)}getPosition(e){for(let t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r,n){e instanceof Vu||(e=new Vu({node:e}));let{widget:s}=e;s!=null&&s instanceof P&&s.addHandles(yr(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:r,internal:n})}_find(e){return e?e instanceof Vu?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??JK}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){let e=document.createElement("div");e.classList.add(vs.innerContainer,vs.cornerContainer);let t=document.createElement("div");t.classList.add(vs.innerContainer,vs.manualContainer);let i=document.createElement("div");i.classList.add(vs.topLeft,vs.corner),e.appendChild(i);let r=document.createElement("div");r.classList.add(vs.topRight,vs.corner),e.appendChild(r);let n=document.createElement("div");n.classList.add(vs.bottomLeft,vs.corner),e.appendChild(n);let s=document.createElement("div");s.classList.add(vs.bottomRight,vs.corner),e.appendChild(s),this._innerContainer=e,this._manualContainer=t;let o=v2();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":n,"bottom-right":s,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?s:n,"bottom-trailing":o?n:s},this._positionNameToContainerLookup=ie({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){let t=e.position??"manual",{component:i,index:r}=e,n=this._positionNameToContainerLookup[t],s=r!=null&&r>-1;if(eX(i.widget)&&i.widget.startup(),!s)return void n.appendChild(i.node);let o=Array.from(n.children);if(r===0){let{firstChild:l}=n;return void(l?l.parentNode?.insertBefore(i.node,l):n.appendChild(i.node))}if(r>=o.length)return void n.appendChild(i.node);let a=o[r];a.parentNode?.insertBefore(i.node,a)}_toPixelPosition(e){return{top:ET(e.top),left:ET(e.left),right:ET(e.right),bottom:ET(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){let i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(r=>this._findByNode(r)).filter(bd).filter(r=>t.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:n})=>r??n)}};u([d()],dl.prototype,"_locale",void 0),u([d()],dl.prototype,"container",null),u([d()],dl.prototype,"height",null),u([d({value:y4})],dl.prototype,"padding",null),u([Ir("padding")],dl.prototype,"castPadding",null),u([d()],dl.prototype,"view",void 0),u([d()],dl.prototype,"width",null),dl=u([C("esri.views.ui.UI")],dl);var v4=dl;function w4(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function tX(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function by(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function iX(e){return e.type==="bing-maps"}var vc=[],Cf=class extends P{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ct,this.view=null,this._allLayerViewsChange=t=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");let i=this.view?.allLayerViews;i&&(this.addHandles(i.map(r=>S(()=>[r.suspended,r.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(r=>{r.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(r.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),t?.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.addHandles([ir(()=>this.view?.allLayerViews,"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Wi(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){let e=this.view,t=e?.allLayerViews;if(vc.length=0,!e||!t)return void this._clear();t.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;let n=r.layer;if(w4(n,"user"))return void by(vc,r,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(r)){let o=this._fetchedAttributionData.get(r);return void(o?by(vc,r,this._getDynamicAttribution(o,e,n)):w4(n)&&by(vc,r,n.copyright))}return void this._fetchAttributionData(r)}let s="portalItem"in n?n.portalItem?.accessInformation:void 0;by(vc,r,s||n.copyright)});let i=t.find(r=>r.layer?.type==="integrated-mesh-3dtiles");if(this.view&&i){let r=JV(this.view);if(r){let n=r.getAttributionText();for(let s=0;s<n.length;++s)by(vc,i,n[s])}}tX(this.items,vc)&&(this.items.removeAll(),this.items.addMany(vc)),vc.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);let t=await Ag(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){let i=t.ok?this._createContributionIndex(t.value,iX(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){let i=e.contributors,r={};if(!i)return r;for(let n=0;n<i.length;n++){let s=i[n],o=s.coverageAreas;if(!o)return;for(let a of o){let l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p=new Vi({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Qt.WGS84}),m={extent:R2(p),attribution:s.attribution||"",score:a.score!=null?a.score:100,id:n};for(let f=c;f<=h;f++)r[f]??=[],r[f].push(m)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){let{extent:r,scale:n}=t,s=i.tileInfo?.scaleToZoom(n)??0;if(s=Math.min(e.maxKey??0,Math.round(s)),!r||s==null||s<=-1)return"";let o=e[s],a=A2(r.center.clone().normalize(),Qt.WebMercator),l=new Set;return o?o.filter(c=>{let h=c.id,p=!l.has(h)&&a&&c.extent&&f0(c.extent,a);return p&&l.add(h),p}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:ct})],Cf.prototype,"items",void 0),u([d({readOnly:!0})],Cf.prototype,"state",null),u([d()],Cf.prototype,"view",void 0),Cf=u([C("esri.widgets.Attribution.AttributionViewModel")],Cf);var UR=Cf;var Tf="esri-attribution",Ef={base:Tf,poweredBy:`${Tf}__powered-by`,sources:`${Tf}__sources`,open:`${Tf}--open`,sourcesOpen:`${Tf}__sources--open`,link:`${Tf}__link`},zn=class extends La{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new UR}initialize(){this.addHandles(ir(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e={[Ef.open]:this._isOpen};return $i("div",{bind:this,class:this.classes(Ef.base,os.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return $i("div",{class:Ef.poweredBy},"Powered by"," ",$i("a",{class:Ef.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){let e=this._isOpen,t=this._isInteractive,i=t?0:void 0,{attributionText:r}=this,n={[Ef.sourcesOpen]:e,[os.interactive]:t};return $i("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Ef.sources,n),innerHTML:r,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1,{clientHeight:i,clientWidth:r,scrollWidth:n}=e,s=n>r,o=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,o&&(t=!0),this._isOpen){let a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],zn.prototype,"_isOpen",void 0),u([d()],zn.prototype,"_isInteractive",null),u([d()],zn.prototype,"_attributionTextOverflowed",void 0),u([d()],zn.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],zn.prototype,"attributionText",null),u([d()],zn.prototype,"icon",null),u([d()],zn.prototype,"itemDelimiter",void 0),u([d()],zn.prototype,"label",null),u([d(),Qo("esri/widgets/Attribution/t9n/Attribution")],zn.prototype,"messages",void 0),u([d()],zn.prototype,"view",null),u([d({type:UR})],zn.prototype,"viewModel",void 0),u([Fk()],zn.prototype,"_toggleState",null),zn=u([C("esri.widgets.Attribution")],zn);var b4=zn;function C4(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}var Oh=class extends Jk(P){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(Re)}destroy(){this.view=null}get canShowNorth(){return C4(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:gV()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;let t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?S(()=>e?.rotation,this._updateForRotation,Re):S(()=>e?.camera,this._updateForCamera,Re))}_watchForView(e){this.addHandles(S(()=>this.view,this._updateRotationWatcher,e))}};u([d({readOnly:!0})],Oh.prototype,"canShowNorth",null),u([d({readOnly:!0})],Oh.prototype,"orientation",void 0),u([d({readOnly:!0})],Oh.prototype,"state",null),u([d()],Oh.prototype,"view",void 0),Oh=u([C("esri.widgets.Compass.CompassViewModel")],Oh);var jR=Oh;var T4="esri-compass",zR={base:T4,iconContainer:`${T4}__icon-container`};var wc=class extends La{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new jR,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return Tp({button:()=>import("./chunk-B2M6LCNQ.js"),icon:()=>import("./chunk-A7SCRTXK.js")})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){let{orientation:e,state:t}=this.viewModel,{messages:i}=this;return $i("div",{class:this.classes(zR.base,os.widget)},$i("calcite-button",{class:os.widgetButton,disabled:t==="disabled",kind:"neutral",label:i.reset,onclick:this._reset,round:!0,scale:"s",title:i.reset},$i("div",{"aria-hidden":"true",class:zR.iconContainer,title:i.reset},$i("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};u([d()],wc.prototype,"goToOverride",null),u([d()],wc.prototype,"icon",null),u([d()],wc.prototype,"label",null),u([d(),Qo("esri/widgets/Compass/t9n/Compass")],wc.prototype,"messages",void 0),u([d()],wc.prototype,"view",null),u([d({type:jR})],wc.prototype,"viewModel",void 0),wc=u([C("esri.widgets.Compass")],wc);var E4=wc;var D4="esri-navigation-toggle",GR={base:D4,isLayoutHorizontal:`${D4}--horizontal`};var Df=class extends P{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(Wi(()=>this.view?.navigation?.actionMap,()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){let e=this.view?.navigation?.actionMap;if(!e)return;let t=this._navigationMode==="pan";e.dragPrimary=t?"pan":"rotate",e.dragSecondary=t?"rotate":"pan"}};u([d({readOnly:!0})],Df.prototype,"state",null),u([d()],Df.prototype,"_navigationMode",void 0),u([d()],Df.prototype,"view",void 0),Df=u([C("esri.widgets.NavigationToggle.NavigationToggleViewModel")],Df);var qR=Df;var bc=class extends La{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new qR,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{let i=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;w2(i),this.toggle()}}loadDependencies(){return Tp({button:()=>import("./chunk-B2M6LCNQ.js")})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e=this.viewModel?.state==="disabled",t=this.viewModel?.navigationMode==="pan",i=this.messages.toggle;return $i("div",{class:this.classes(GR.base,os.widget,{[GR.isLayoutHorizontal]:this.layout==="horizontal"})},$i("calcite-button",{afterCreate:r=>{this._panButton=r},appearance:t?"outline-fill":"solid",class:os.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?void 0:-1,title:i}),$i("calcite-button",{afterCreate:r=>{this._rotateButton=r},appearance:t?"solid":"outline-fill",class:os.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?-1:void 0,title:i}))}};u([d()],bc.prototype,"icon",null),u([d()],bc.prototype,"label",null),u([d({value:"vertical"})],bc.prototype,"layout",null),u([d(),Qo("esri/widgets/NavigationToggle/t9n/NavigationToggle")],bc.prototype,"messages",void 0),u([d()],bc.prototype,"view",null),u([d({type:qR})],bc.prototype,"viewModel",void 0),bc=u([C("esri.widgets.NavigationToggle")],bc);var x4=bc;var Nh=class extends P{get canZoomIn(){if(!this.view?.ready)return!1;let t=this.view?.constraints?.effectiveMaxScale;return t===0||this._scale>t}get canZoomOut(){let{view:e}=this;if(!e?.ready)return!1;let i=e.constraints?.effectiveMinScale;return i===0||this._scale<i}get _scale(){let e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};u([d({readOnly:!0})],Nh.prototype,"canZoomIn",null),u([d({readOnly:!0})],Nh.prototype,"canZoomOut",null),u([d()],Nh.prototype,"view",void 0),u([d()],Nh.prototype,"_scale",null),Nh=u([C("esri.widgets.Zoom.ZoomConditions2D")],Nh);var M4=Nh;var xf=class extends P{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],xf.prototype,"canZoomIn",null),u([d({readOnly:!0})],xf.prototype,"canZoomOut",null),u([d()],xf.prototype,"view",void 0),xf=u([C("esri.widgets.Zoom.ZoomConditions3D")],xf);var S4=xf;var Hu=class extends P{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new M4({view:e}):e.type==="3d"&&(this._zoomConditions=new S4({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){let e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():Sx(e.goTo({zoomFactor:2})))}zoomOut(){let e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():Sx(e.goTo({zoomFactor:.5})))}};u([d()],Hu.prototype,"_zoomConditions",void 0),u([d()],Hu.prototype,"canZoomIn",null),u([d()],Hu.prototype,"canZoomOut",null),u([d({readOnly:!0})],Hu.prototype,"state",null),u([d()],Hu.prototype,"view",null),Hu=u([C("esri.widgets.Zoom.ZoomViewModel")],Hu);var WR=Hu;var I4={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"},Cc=class extends La{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new WR,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Tp({button:()=>import("./chunk-B2M6LCNQ.js")})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){let e={[I4.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:i}=this.viewModel,{zoomIn:r,zoomOut:n}=this.messages;return $i("div",{class:this.classes(I4.base,os.widget,e)},$i("calcite-button",{class:os.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:r,onclick:this.zoomIn,title:r}),$i("calcite-button",{class:os.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};u([d()],Cc.prototype,"icon",null),u([d()],Cc.prototype,"label",null),u([d({value:"vertical"})],Cc.prototype,"layout",null),u([d(),Qo("esri/widgets/Zoom/t9n/Zoom")],Cc.prototype,"messages",void 0),u([d()],Cc.prototype,"view",null),u([d({type:WR})],Cc.prototype,"viewModel",void 0),Cc=u([C("esri.widgets.Zoom")],Cc);var A4=Cc;function rX(e){return e?.view!==void 0}var DT=class extends v4{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(i=>{let r=this._find(i),n=r?.widget;rX(n)&&(n.view=t)})},this._componentsWatcher=(t,i)=>{this._removeComponents(i),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([S(()=>this.components,this._componentsWatcher,Re),S(()=>this.view,this._updateViewAwareWidgets,Re)])}_add(e,t,i,r,n){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,t,i,r,n)}_removeComponents(e){e.forEach(t=>{let i=this._find(t);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){let{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){let t=this._createWidget(e);return new Vu({id:e,node:t})}_createWidget(e){let t=this.view;switch(e){case"attribution":return new b4({view:t});case"compass":return new E4({view:t});case"navigation-toggle":return new x4({view:t});case"zoom":return new A4({view:t})}}};u([d()],DT.prototype,"components",void 0),DT=u([C("esri.views.ui.DefaultUI")],DT);var Bu=DT;var xT=class extends Bu{constructor(e){super(e),this.components=["attribution","zoom"]}};u([d()],xT.prototype,"components",void 0),xT=u([C("esri.views.ui.2d.DefaultUI2D")],xT);var $R=xT;var ZR,MT=ZR=class extends cn{constructor(e){super(e),this.color=new fn([0,0,0,1])}clone(){return new ZR(ro({color:this.color}))}};u([d({type:fn,json:{write:!0}})],MT.prototype,"color",void 0),MT=ZR=u([C("esri.webmap.background.ColorBackground")],MT);var R4=MT;var P4,O4,N4,L4,F4,k4,V4;async function nX(){let[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:n,GridView2D:s,Stage:o}]=await Promise.all([import("./chunk-KNLVA5SZ.js"),import("./chunk-2K6JY746.js")]);O4=e,N4=t,L4=i,F4=r,k4=n,V4=s,P4=o}var Ft=class extends kz(zC(qC(GC(QC)))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Ql({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new sf({actionMap:new uy({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new ct,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new gM,this.type="2d",this.view2dType=null,this.ui=new $R,this.test={takeScreenshot:async t=>f4(this._getScreenshotView(t),t)},this.padding={top:0,right:0,bottom:0,left:0},nw()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=G(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new CT(this.featuresTilingScheme)}get constraintsInfo(){let e=this.defaultsFromMap?.tileInfo,t=this.spatialReference;return{lods:e?.spatialReference?.equals(t)?e.lods:null,spatialReference:t}}get initialExtentRequired(){if(!this.stateManager)return!1;let{scale:e,constraints:t,center:i,viewpoint:r,extent:n}=this,s=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!n&&(t?.effectiveLODs||(s=-1),(!i||e===0&&s===-1)&&(r?.targetGeometry==null||r.targetGeometry.type!=="extent"&&!r.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){let e=this._getDefaultViewpoint();if(!e)return!1;let t=e.targetGeometry,i=this.spatialReference;return Va(t.spatialReference,i)}get background(){return yw(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get highlightOptions(){return vV(this)}set highlightOptions(e){wV(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resolution(){return this.stateManager.resolution??0}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){let e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(i=>!i.destroyed&&!("layerViews"in i)&&i.updating===!0)||e);if(Ct("esri-2d-log-updating")){let i=this.allLayerViews.reduce((r,n)=>be(ie({},r),{[`${n.layer.id}(${n.layer.type})`]:!n.destroyed&&!("layerViews"in n)&&n.updating}),{});console.log(`Updating MapView: ${t}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(i)}
-> updatingMagnifier: ${e}
`)}return t}get visibleArea(){let e=this.stateManager.visibleArea;return e&&new Rp({rings:[e.map(t=>[t[0],t[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(e,t){return h4(this,e,t)}async takeScreenshot(e){return m4(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;let t=Hd(e)?Vd(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return yw(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return yw(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return LR.hasLayerViewModule(e)}importLayerView(e){return LR.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(W.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){let t=this.toMap(e),i=await this.hitTest(e),r=this.allLayerViews.toArray().filter(l=>l.clips.every(c=>pw(this,c,e,t))).reverse(),n=new globalThis.Map(r.map(l=>[l.layer.uid,l])),s=[],o=0,a=0;for(;o<i.results.length||a<r.length;){let l=i.results.at(o);if(l&&l.type!=="graphic"){++o;continue}let c=n.get((l?.layer??l?.graphic.layer)?.uid);if((!l||c)&&a<r.length&&r.at(a)!==c){let h=r.at(a);"fetchPopupFeaturesAtLocation"in h&&s.push({mapPoint:t,layerView:h}),++a}else l&&(s.push({graphic:l.graphic,layerView:c}),++o)}return{hits:s,location:t}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=TT(this.type);if(Ct("safari")&&Ct("safari")<9&&(e=new Be("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Ct("safari")})),e!=null)throw W.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return nX()}_getDefaultViewpoint(){let{constraints:e,initialExtent:t,map:i,padding:r,size:n}=this;if(!e)return null;let s=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,o=this.stateManager.getUserStartupOptions(this.size),a=s?.viewpoint,l=a?.targetGeometry?.extent??t,c=l?.center,h=a?.rotation??0,p=a?.scale||l&&cw(l,[n[0]-r.left-r.right,n[1]-r.top-r.bottom]),m=o.center??c,f=o.rotation??h,g=o.scale??p;return m&&g?new Si({targetGeometry:m,scale:g,rotation:f}):null}_startup(){this.timeline.begin("MapView Startup");let e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;let t=new P4(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new k4,this._magnifierView.magnifier=this.magnifier,this._gridView=new V4;let i=new L4({view:this});this._set("labelManager",i);let r=new l4({view:this});this._set("animationManager",r);let n=new F4({view:this,animationManager:r});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),t.on("webgl-error",o=>this.fatalError=o.error),S(()=>this.stationary,o=>t.stationary=o,Ce),S(()=>this.background,o=>{t.backgroundColor=o?.color,this._magnifierView.backgroundColor=o?.color},Ce),S(()=>this.magnifier,o=>this._magnifierView.magnifier=o,Ce),S(()=>this.grid,o=>this._gridView.grid=o,Ce),S(()=>this.renderingOptions,o=>t.renderingOptions=o,Ce),S(()=>this.highlights.items.map(o=>({name:o.name,options:{fillColor:o.color,haloColor:o.haloColor,fillOpacity:o.fillOpacity,haloOpacity:o.haloOpacity,haloWidth:o.haloWidth,haloBlur:o.haloBlur}})),()=>{t.highlightGradient=fV(t.highlightGradient,this.highlights.items)},Ce),S(()=>this.state.id,()=>t.state=this.state,Ce)],"map-view"),this._updateStageChildren();let s=this._resolveWhenReady;this._resolveWhenReady=[],s.forEach(o=>o(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});let e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){let e=new QL(oL.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);let t=new O4({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new N4(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){let e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){let{allLayerViews:t,padding:i,size:r,stage:n}=this;return{allLayerViews:t,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:i,size:r,stage:n}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(let t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(let t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};Ft.type="2d",u([d({constructOnly:!0})],Ft.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],Ft.prototype,"debugWebGLExtensions",void 0),u([d({readOnly:!0})],Ft.prototype,"featuresTilingScheme",void 0),u([d({readOnly:!0})],Ft.prototype,"graphicsTileStore",null),u([d()],Ft.prototype,"graphicsView",void 0),u([d()],Ft.prototype,"constraintsInfo",null),u([d()],Ft.prototype,"initialExtentRequired",null),u([d()],Ft.prototype,"labelManager",void 0),u([d({type:sf,nonNullable:!0})],Ft.prototype,"navigation",void 0),u([d({constructOnly:!0})],Ft.prototype,"renderCanvas",void 0),u([d()],Ft.prototype,"renderingOptions",void 0),u([d({constructOnly:!0})],Ft.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],Ft.prototype,"supportsGround",void 0),u([d()],Ft.prototype,"defaultsFromMapSettings",null),u([d({readOnly:!0})],Ft.prototype,"typeSpecificPreconditionsReady",null),u([d({type:R4})],Ft.prototype,"background",null),u([d()],Ft.prototype,"center",null),u([d({type:ct})],Ft.prototype,"floors",void 0),u([d()],Ft.prototype,"grid",void 0),u([d({type:_o})],Ft.prototype,"highlightOptions",null),u([d()],Ft.prototype,"map",void 0),u([d()],Ft.prototype,"padding",null),u([d({readOnly:!0})],Ft.prototype,"rendering",null),u([d({readOnly:!0})],Ft.prototype,"resolution",null),u([d()],Ft.prototype,"scale",null),u([d({constructOnly:!0})],Ft.prototype,"spatialReferenceLocked",void 0),u([d({readOnly:!0})],Ft.prototype,"tileInfo",null),u([d({type:gM,readOnly:!0})],Ft.prototype,"timeline",void 0),u([d({readOnly:!0})],Ft.prototype,"type",void 0),u([d({readOnly:!0})],Ft.prototype,"updating",null),u([d({readOnly:!0})],Ft.prototype,"view2dType",void 0),u([d({readOnly:!0})],Ft.prototype,"visibleArea",null),u([d()],Ft.prototype,"zoom",null),u([d({readOnly:!0})],Ft.prototype,"navigating",null),u([d(),Ir(e=>e instanceof Bu?e:c0($R,e))],Ft.prototype,"ui",void 0),Ft=u([C("esri.views.View2D")],Ft);var H4=Ft;var ST=class extends H4{constructor(e){super(e),this.view2dType="map"}};u([d({readOnly:!0})],ST.prototype,"view2dType",void 0),ST=u([C("esri.views.MapView")],ST);var IT=ST;var AT=class e{constructor(t,i){this.positionService=t;this.cdRef=i}positions=[];highlighted=null;view=null;graphicsLayer=new Yg;ngOnInit(){let t=new Su({basemap:"satellite",layers:[this.graphicsLayer]});this.view=new IT({container:"viewDiv",map:t,center:[0,0],zoom:2,popupEnabled:!0}),this.positionService.getPositions().subscribe(i=>{this.positions=[...i],this.cdRef.detectChanges(),this.updateGraphics()})}ngOnChanges(t){t.highlighted&&this.positions?.length>0&&(console.log("ngOnChanges called",t),this.updateGraphics())}updateGraphics(){this.graphicsLayer.removeAll(),this.positions.forEach((i,r)=>{let n=new pt({longitude:parseFloat(i.longitude),latitude:parseFloat(i.latitude)}),s=this.highlighted===i,o=r===0,a;s?a=new Vp({color:[255,255,0],size:"14px",outline:{color:[255,255,255],width:2}}):o?a=new H0({url:"https://developers.arcgis.com/javascript/latest/sample-code/satellites-3d/live/satellite.png",width:"36px",height:"36px"}):a=new Vp({color:[0,122,255],size:"10px",outline:{color:[255,255,255],width:1}});let l=new V0({title:`ISS Position ${o?"(Latest)":`#${r+1}`}`,content:`
          <div style="padding: 10px;">
            <p><strong>Posizione:</strong></p>
            <p>Latitudine: ${i.latitude}\xB0</p>
            <p>Longitudine: ${i.longitude}\xB0</p>
            <p><strong>Data:</strong> ${i.time}</p>
            ${o?"<p><em>Posizione pi\xF9 recente</em></p>":""}
          </div>
        `}),c=new rs({geometry:n,symbol:a,popupTemplate:l,attributes:{index:r,isLatest:o}});this.graphicsLayer.add(c)});let t=this.positions[0];t&&this.view?.goTo({center:[parseFloat(t.longitude),parseFloat(t.latitude)],zoom:3}).catch(i=>console.error("GoTo error:",i))}static \u0275fac=function(i){return new(i||e)(Lt(ll),Lt(dc))};static \u0275cmp=Bs({type:e,selectors:[["app-map"]],inputs:{highlighted:"highlighted"},features:[ac],decls:1,vars:0,consts:[["id","viewDiv"]],template:function(i,r){i&1&&Un(0,"div",0)},styles:["#viewDiv[_ngcontent-%COMP%]{width:100%;height:100%}"]})};var RT=class e{constructor(t,i){this.positionService=t;this.cdRef=i}positions=[];map=null;highlighted=null;view=null;featureLayer=null;ngOnInit(){this.initializeMap(),this.loadPositions()}ngOnChanges(t){t.highlighted&&this.positions?.length>0&&this.updateGraphics()}initializeMap(){this.map=new Su({basemap:"satellite"}),this.view=new IT({container:"viewDiv",map:this.map,center:[0,0],zoom:2,popupEnabled:!0})}loadPositions(){this.positionService.getPositions().subscribe(t=>{this.positions=[...t],this.cdRef.detectChanges(),this.createFeatureLayer()})}createFeatureLayer(){this.featureLayer&&this.map?.remove(this.featureLayer);let t=this.createGraphicsFromPositions(),i=[{name:"ObjectID",alias:"ID",type:"oid"},{name:"latitude",alias:"Latitude",type:"double"},{name:"longitude",alias:"Longitude",type:"double"},{name:"formatted",alias:"Date",type:"string"},{name:"symbolType",alias:"Symbol Type",type:"string"}];this.featureLayer=new vF({source:t,fields:i,objectIdField:"ObjectID",geometryType:"point",spatialReference:{wkid:4326},title:"ISS Positions",renderer:{type:"unique-value",field:"symbolType",uniqueValueInfos:[{value:"latest",symbol:new H0({url:"/satellite.svg",width:"24px",height:"24px"})},{value:"highlighted",symbol:new Vp({color:[255,255,0],size:"14px",outline:{color:[255,255,255],width:2}})},{value:"normal",symbol:new Vp({color:[0,122,255],size:"10px",outline:{color:[255,255,255],width:1}})}]},popupTemplate:new V0({title:"ISS Position",content:`
          <div style="padding: 10px;">
            <p><strong>Latitude:</strong> {latitude}&#176;</p>
            <p><strong>Longitude:</strong> {longitude}&#176;</p>
            <p><strong>Date:</strong> {formatted}</p>
          </div>
        `})}),this.map?.add(this.featureLayer),this.goToLatestPosition()}createGraphicsFromPositions(){return this.positions.map((t,i)=>{let r=new pt({longitude:parseFloat(t.longitude),latitude:parseFloat(t.latitude)}),n=i===0,s=this.highlighted?.time===t.time,o="normal";return n&&(o="latest"),s&&(o="highlighted"),new rs({geometry:r,attributes:{ObjectID:i+1,latitude:parseFloat(t.latitude),longitude:parseFloat(t.longitude),formatted:t.time,symbolType:o}})})}updateGraphics(){if(!this.featureLayer||!this.positions.length)return;let t=this.createGraphicsFromPositions();this.featureLayer.applyEdits({deleteFeatures:this.featureLayer.source.toArray(),addFeatures:t}).catch(i=>console.error("ApplyEdits error:",i))}goToLatestPosition(){let t=this.positions[0];t&&this.view&&this.view.goTo({center:[parseFloat(t.longitude),parseFloat(t.latitude)],zoom:3}).catch(i=>console.error("GoTo error:",i))}highlightPosition(t){this.highlighted=t,this.updateGraphics(),t&&this.view&&this.view.goTo({center:[parseFloat(t.longitude),parseFloat(t.latitude)],zoom:5}).catch(i=>console.error("GoTo error:",i))}clearHighlight(){this.highlighted=null,this.updateGraphics()}static \u0275fac=function(i){return new(i||e)(Lt(ll),Lt(dc))};static \u0275cmp=Bs({type:e,selectors:[["app-map-feature"]],inputs:{highlighted:"highlighted"},features:[ac],decls:1,vars:0,consts:[["id","viewDiv"]],template:function(i,r){i&1&&Un(0,"div",0)},styles:["#viewDiv[_ngcontent-%COMP%]{width:100%;height:100%}"]})};function QR(e,t){let i=xx(e),r=xx(t),n=i.store,s=r.store,o=r.metadata;for(let a in o){let l=o[a],c=n.originOf(a),h=s.originOf(a);if(!l.readOnly&&h!==Mx.DEFAULTS)if(c===Mx.DEFAULTS)e.set(a,s.get(a));else{let p=n.get(a),m=s.get(a);p&&m&&m instanceof P&&p instanceof P&&p instanceof m.constructor&&QR(p,m)}}}var Uu=class extends oi.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=i_}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){let e=this.view.basemapTerrain;if(e?.extent==null||e.spatialReference==null)return null;let t=_0(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Qt.WGS84}elevationAt(e,t){if(this.extent==null||!O2(this.extent,e,t)){let i=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return W.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,t,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return Pk(e.clone(),this)}};u([d({readOnly:!0})],Uu.prototype,"demResolution",void 0),u([d({readOnly:!0})],Uu.prototype,"extent",null),u([d({readOnly:!0})],Uu.prototype,"noDataValue",void 0),u([d()],Uu.prototype,"spatialReference",null),u([d({constructOnly:!0})],Uu.prototype,"view",void 0),Uu=u([C("esri.views.support.GroundViewElevationSampler")],Uu);var B4=Uu;var Tc=class extends P{constructor(e){super(e),this.view=null,this.layerViews=new ct}initialize(){this.addHandles(Wi(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(let e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new B4({view:this.view}):null:null}get extent(){let e=this.view;return e&&e.type!=="2d"&&e.ready?Rw(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return this.view?.suspended??!0}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>S(()=>e.updating,()=>this._updateUpdating(),Fe)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],Tc.prototype,"elevationSampler",null),u([d({readOnly:!0})],Tc.prototype,"extent",null),u([d({type:Boolean,readOnly:!0})],Tc.prototype,"updating",null),u([d({constructOnly:!0})],Tc.prototype,"view",void 0),u([d({type:ct,readOnly:!0})],Tc.prototype,"layerViews",void 0),u([d({readOnly:!0})],Tc.prototype,"suspended",null),Tc=u([C("esri.views.GroundView")],Tc);var U4=Tc;var Cy=()=>import("./chunk-26P46EUC.js"),j4=()=>import("./chunk-X5ZWBC5P.js"),z4={"base-dynamic":()=>import("./chunk-KTODZOYW.js"),"base-elevation":j4,"base-tile":Cy,"bing-maps":Cy,"building-scene":()=>import("./chunk-7XKCMY2Y.js"),catalog:()=>import("./chunk-335EF7QR.js"),"catalog-dynamic-group":()=>import("./chunk-53P6Y2AF.js"),"catalog-footprint":()=>import("./chunk-BSIHNVUL.js"),csv:()=>import("./chunk-4OYQLV3Z.js"),dimension:()=>import("./chunk-V4I3ODWE.js"),elevation:j4,feature:()=>import("./chunk-5XK6PHJE.js"),geojson:()=>import("./chunk-O3ZSLQIQ.js"),graphics:()=>import("./chunk-HVBHXIBY.js"),group:()=>import("./chunk-D2FOSHOX.js"),imagery:()=>import("./chunk-2EU3PE5F.js"),"integrated-mesh":()=>import("./chunk-PNDDH7U4.js"),"integrated-mesh-3dtiles":()=>import("./chunk-N7LMND5Z.js"),"line-of-sight":()=>import("./chunk-Z4RILFQ6.js"),"map-image":()=>import("./chunk-Z5F4T2DQ.js"),media:()=>import("./chunk-KOY3LJ4N.js"),"ogc-feature":()=>import("./chunk-Z6WGCQC4.js"),"open-street-map":Cy,"oriented-imagery":()=>import("./chunk-5XK6PHJE.js"),"point-cloud":()=>import("./chunk-UKR4IQWW.js"),viewshed:()=>import("./chunk-EHCFNQV3.js"),voxel:()=>import("./chunk-SV7P5JOQ.js"),route:()=>import("./chunk-ITKNZC66.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./chunk-U6PV7FZZ.js"):import("./chunk-UXSBHYRX.js"),stream:()=>import("./chunk-RP3WMVLV.js"),tile:Cy,"imagery-tile":()=>import("./chunk-LVGOHIOJ.js"),"vector-tile":()=>import("./chunk-QKW2AF5F.js"),wcs:()=>import("./chunk-LVGOHIOJ.js"),"web-tile":Cy,wfs:()=>import("./chunk-ETEFQMCC.js"),wms:()=>import("./chunk-NSGUGUXJ.js"),wmts:()=>import("./chunk-TEGY3VX3.js"),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function sX(e){let t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Be(`${i}:view-not-supported`,`${t} is not supported in 3D`)}var YR={hasLayerViewModule:e=>z4[e.type]!=null,importLayerView:e=>{let t=z4[e.type];if(t==null)throw sX(e);return t(e)}};var G4="analyses-owner-handles",Mf,Fh;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(Mf||(Mf={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Fh||(Fh={}));var Lh=class extends P{constructor(e){super(e),this._allAnalysisViews=new ct,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=q4(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Sr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Sr()),this._attachedToViewResolver=q4()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;let t=this._items.get(e);if(t==null||t.state.list===Fh.REMOVED)throw new Be("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),G4)}_disconnectOwners(){this.removeHandles(G4),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(let r of e)this._addAnalysis(r);let t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return yr(()=>{t.remove(),i.remove();for(let r of e)this._removeAnalysis(r)})}_addAnalysis(e){let t=this._items.get(e);if(t==null){let i={state:{view:Mf.PENDING,list:Fh.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=un(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=Fh.ADDED}_removeAnalysis(e){let t=this._items.get(e);t!=null?(t.state.list=Fh.REMOVED,this._scheduleUpdate()):W.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=a0(()=>this._update()))}_update(){this._scheduledUpdateHandle=kt(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Fh.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case Mf.PENDING:e.createAnalysisViewTask=Mr(e.createAnalysisViewTask);break;case Mf.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=G(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){let i=e.analysis,r=i.type,n=this._analysisModules[r];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(r)}catch(a){throw this._creatingViewCount-=1,a}if(Vl(t))throw this._creatingViewCount-=1,Sr("AnalysisView creation aborted");let s=new n.module.default({analysis:i,view:this.view}),o=!0;so(t,()=>{o&&(this._creatingViewCount-=1,s.destroy())});try{await s.when()}catch(a){throw o=!1,s.destroyed||(this._creatingViewCount-=1,s.destroy()),a}if(Vl(t))throw Sr();return o=!1,e.view=s,e.state.view=Mf.CREATED,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./chunk-RH73QE42.js");case"dimension":return import("./chunk-TSB42FUC.js");case"direct-line-measurement":return import("./chunk-Z74676RP.js");case"line-of-sight":return import("./chunk-DTKKCWET.js");case"slice":return import("./chunk-HDKS5TMJ.js");case"viewshed":return import("./chunk-ELHTFDPG.js")}}};function q4(){let e=As();return e.promise.catch(()=>{}),e}u([d()],Lh.prototype,"updating",null),u([d({constructOnly:!0})],Lh.prototype,"view",void 0),u([d()],Lh.prototype,"_allAnalysisViews",void 0),u([d()],Lh.prototype,"_creatingViewCount",void 0),Lh=u([C("esri.views.3d.analysis.AnalysisViewManager3D")],Lh);var W4=Lh;var hl=class extends P{constructor(e){super(e),this.collision=new Ty,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Se.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Se.Local?this._set("altitude",e):W.getLogger(this).warn("Altitude constraint is ignored in local scenes")}get mode(){return this.state.viewingMode}clampAltitude(e){return this.altitude?q(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;let i=this.tilt(e);return q(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Se.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=KR)=>(i.min=gr.min,i.max=e,i)}_createDefaultTiltLocal(){let e=this.collision.enabled?Up([[4e3,gr.max],[1e4,Vt(88)],[6e6,Vt(88)]]):()=>gr.max;return(t,i=KR)=>(i.min=gr.min,i.max=e(t),i)}_createDefaultTiltGlobal(){let e=this.collision.enabled?Up([[4e3,gr.max],[5e4,Vt(88)],[6e6,Vt(88)],[2e7,gr.min]]):Up([[3e5,gr.max],[3e6,Vt(88)],[6e6,Vt(88)],[2e7,gr.min]]);return(t,i=KR)=>(i.min=gr.min,i.max=e(t),i)}};function oX(e){return{min:-2e5,max:4*e.radius}}u([d()],hl.prototype,"altitude",null),u([d({readOnly:!0})],hl.prototype,"collision",void 0),u([d()],hl.prototype,"distance",void 0),u([d({readOnly:!0})],hl.prototype,"minimumPoiDistance",void 0),u([d()],hl.prototype,"tilt",void 0),u([d({constructOnly:!0})],hl.prototype,"state",void 0),hl=u([C("esri.views.3d.state.Constraints")],hl);var XR=oX(dn),gr={min:Vt(.5),max:Vt(179.5)},KR={min:0,max:0},Ty=class extends P{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],Ty.prototype,"enabled",void 0),u([d({type:Number})],Ty.prototype,"elevationMargin",void 0),Ty=u([C("esri.views.3d.state.Constraints.CollisionConstraint")],Ty);var kh=class extends Ha{constructor(){super(...arguments),this.min=XR.min,this.max=XR.max}};u([d({type:Number})],kh.prototype,"min",void 0),u([d({type:Number})],kh.prototype,"max",void 0),kh=u([C("esri.views.3d.constraints.AltitudeConstraint")],kh);var pl=class extends Ha{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],pl.prototype,"near",null),u([Ir("near")],pl.prototype,"castNear",null),u([d({type:Number,value:1e-8})],pl.prototype,"far",null),u([Ir("far")],pl.prototype,"castFar",null),u([d({type:["auto","manual"]})],pl.prototype,"mode",void 0),pl=u([C("esri.views.3d.constraints.ClipDistanceConstraint")],pl);var JR={min:Hl(gr.min),max:Hl(gr.max)},ju=class extends Ha{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return q(e,JR.min,JR.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],ju.prototype,"mode",void 0),u([d({type:Number,value:JR.max})],ju.prototype,"max",null),u([Ir("max")],ju.prototype,"castMax",null),ju=u([C("esri.views.3d.constraints.TiltConstraint")],ju);var zu=class extends Ha{constructor(e){super(e),this.tilt=new ju,this.altitude=new kh,this.clipDistance=new pl}};u([d({type:ju})],zu.prototype,"tilt",void 0),u([d({type:kh})],zu.prototype,"altitude",void 0),u([d({type:pl})],zu.prototype,"clipDistance",void 0),zu=u([C("esri.views.3d.constraints.Constraints")],zu);function eP(e){return Fa(e,UL)||p0(e)?{wkid:Lx.GCSMARS2000}:Fa(e,jL)||m0(e)?{wkid:Lx.GCSMOON2000}:Qt.WGS84}var Vh=class{constructor(t,i,r,n,s,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}},Cr={sunny:new Vh([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],da.SIXTEEN),cloudy:new Vh([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],da.TWOHUNDRED,.6),rainy:new Vh([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],da.TWOHUNDRED,.4),snowy:new Vh([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],da.HUNDRED,.65),foggy:new Vh([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],da.SIXTEEN)};Cr.default=Cr.sunny;var Sf=class extends ft{constructor(t,i){super(t,i,new mt(eH,()=>import("./chunk-ZAAPIOMZ.js")))}initializePipeline(t){return Tt({blending:$p(ei.CONSTANT_COLOR,ei.ONE_MINUS_CONSTANT_COLOR,LL.ADD,t.writeTextureChannels===Xg.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ei.LEQUAL},colorWrite:St})}};var If=class extends ft{constructor(t,i){super(t,i,new mt(iH,()=>import("./chunk-5ODXXIYL.js")))}initializePipeline(t){return Tt({blending:t.mode===mm.Full?Zp:za(ei.ZERO,ei.ONE,ei.ONE,ei.ZERO),depthTest:{func:Ei.ALWAYS},colorWrite:St})}};var Ey=class extends P{constructor(e){super(e),this._needsRender=!0,this._passParameters=new tH,this._configuration=new Bw,this._fbo=new $a(e.context.renderContext.rctx,new vi(Vw)),e.context.techniques.precompile(If,new Bw);let t=new Bw;t.mode=mm.WeatherMap,e.context.techniques.precompile(If,t)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?mm.WeatherMap:mm.Full;let e=this.context.techniques.get(If,this._configuration);return e.compiled&&(this._texture=this._render(e)),this._texture}updateWeatherMap(e){M0(this._passParameters.weatherTile,e)||(Yi(this._passParameters.weatherTile,e),this._needsRender=!0)}destroy(){this._fbo=We(this._fbo)}_render(e){if(!this._fbo)return null;let t=this.context.renderContext.rctx,i=t.getViewport();return t.setViewport(0,0,Vw,Vw),t.bindFramebuffer(this._fbo),t.bindTechnique(e,this.context.renderContext.bind,this._passParameters),t.screen.draw(),t.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._fbo.colorTexture}};u([d({constructOnly:!0})],Ey.prototype,"context",void 0),Ey=u([C("esri.views.3d.environment.NoiseTextureAtlas")],Ey);var Cn=class extends P{constructor(e){super(e),this._state=Pn(Bd.Idle),this._passParameters=new J3,this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this._tilesPerFace=1,this.coverage=Xe(Cr.default.coverage[0],Cr.default.coverage[1],.5),this.density=Xe(Cr.default.density[0],Cr.default.density[1],.5),this.absorption=Xe(Cr.default.absorption[0],Cr.default.absorption[1],.5),this.cloudSize=Xe(Cr.default.cloudSize[0],Cr.default.cloudSize[1],.5),this.detailSize=Xe(Cr.default.detailSize[0],Cr.default.detailSize[1],.5),this.smoothness=Xe(Cr.default.smoothness[0],Cr.default.smoothness[1],.5),this.cloudHeight=Xe(Cr.default.cloudHeight[0],Cr.default.cloudHeight[1],.5),this.raymarchingSteps=Cr.default.raymarchingSteps,this._viewMatrix=$t(),this._dirty=!0,this.running=!0,this._configuration=new X3}initialize(){let e=_t(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius;let t=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(Xt.CLOUDS_GENERATOR,this),S(()=>this.coverage,t,Re),S(()=>this.density,t,Re),S(()=>this.absorption,t,Re),S(()=>this.cloudSize,t,Re),S(()=>this.detailSize,t,Re),S(()=>this.smoothness,t,Re),S(()=>this.cloudHeight,t,Re),S(()=>this.raymarchingSteps,t,Re)]);let i=OL(this._computeWeatherTile()),r=0;this.addHandles(S(()=>{let n=this._computeWeatherTile();return M0(i,n)||(++r,Yi(i,n)),r},t))}destroy(){this.destroyCubeMap(),this._passParameters.noiseTexture=G(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=this.raymarchingSteps,this._configuration.writeTextureChannels=Xg.RG,this.context.techniques.precompile(Sf,this._configuration),this._configuration.writeTextureChannels=Xg.BA,this.context.techniques.precompile(Sf,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case da.SIXTEEN:this._tilesPerFace=1;break;case da.HUNDRED:this._tilesPerFace=4;break;case da.COUNT:case da.TWOHUNDRED:this._tilesPerFace=8;break;default:this.raymarchingSteps}return this._configuration.writeTextureChannels=1-this.parameters.readChannels,this._configuration.steps=this.raymarchingSteps,this.context.techniques.get(Sf,this._configuration)}_computeWeatherTile(){let{camera:e,environment:t}=this.view,{latitude:i,longitude:r}=e.position;if(i==null||r==null)return Ad;es(Ca,(i+90)/180,(r+180)/360);let n=Math.floor(this._weatherTileCount*Math.abs(2*Ca[0]-1));Ca[0]=Math.floor(2*this._weatherTileCount*Ca[0]),Ca[1]=Math.floor(4*(this._weatherTileCount-n)*Ca[1]);let s=0,o=0;if(t?.lighting?.type!=="virtual"&&t?.lighting?.date!=null){let a=new Date(t.lighting.date);a.setUTCHours(t.lighting.date.getUTCHours()+(t.lighting.displayUTCOffset??0)),s=31*a.getUTCMonth()+a.getUTCDate(),o=a.getUTCFullYear()}return Ca[0]=(Ca[0]+s)%(2*this._weatherTileCount),Ca[1]=(Ca[1]+o%100)%(4*this._weatherTileCount),Ca}get state(){return this._state.value}set state(e){this._state.value=e}get usedMemory(){return(this._fbo?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new Ey({context:this.context}),this._passParameters.noiseTexture}_ensureFrameBufferCube(e){let t=this.context.renderContext.rctx;if(this._fbo==null){let i=new vi(e);i.target=Ug.TEXTURE_CUBE_MAP,i.wrapMode=ji.CLAMP_TO_EDGE,this._fbo=new $a(t,i),this.parameters.data=this}return t.unbindTexture(this._fbo.colorTexture),this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=We(this._fbo),this.parameters.data=null}applyPreset(e,t){let i=e.median,r=n=>{let s=Xe(n[0],n[1],i);return t<.5?Xe(n[0],s,2*t):Xe(s,n[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps,this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(e){if(this.state===Bd.Fading)return Ui;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=Bd.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);let t=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!t.compiled)return Ui;let i=aX[this._faceIndex],r=lX[this._faceIndex];iL(this._viewMatrix,cX,i,r),Lp(this._passParameters.viewMatrix,this._viewMatrix);let n=this.context.renderContext.rctx,s=n.getViewport(),o=Hw/this._tilesPerFace,a=this._tileIndex*o;n.setViewport(0,a,Hw,o);let l=this._ensureFrameBufferCube(Hw);n.bindFramebuffer(l),n.bindTechnique(t,this.context.renderContext.bind,this._passParameters);let c=Ug.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(c),n.screen.draw(),n.gl.flush(),n.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=0,this.state=Bd.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ui}};u([d({constructOnly:!0})],Cn.prototype,"context",void 0),u([d({constructOnly:!0})],Cn.prototype,"view",void 0),u([d({constructOnly:!0})],Cn.prototype,"requestRender",void 0),u([d()],Cn.prototype,"coverage",void 0),u([d()],Cn.prototype,"density",void 0),u([d()],Cn.prototype,"absorption",void 0),u([d()],Cn.prototype,"cloudSize",void 0),u([d()],Cn.prototype,"detailSize",void 0),u([d()],Cn.prototype,"smoothness",void 0),u([d()],Cn.prototype,"cloudHeight",void 0),u([d()],Cn.prototype,"raymarchingSteps",void 0),u([d()],Cn.prototype,"running",void 0),Cn=u([C("esri.views.3d.environment.CloudsRenderer")],Cn);var aX=[ta(1,0,0),ta(-1,0,0),ta(0,1,0),ta(0,-1,0),ta(0,0,1)],lX=[ta(0,1,0),ta(0,1,0),ta(0,0,-1),ta(0,0,1),ta(0,1,0)],cX=Z2(),Ca=NL();var PT=class extends ru{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=0}},Dy=class extends ft{constructor(t,i){super(t,i,new mt(nH,()=>import("./chunk-S25APQSR.js")),new Map([[yi.POSITION,0],[yi.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return Tt({blending:Qp,depthTest:{func:Ei.LEQUAL},colorWrite:St})}};var Hh=class extends ss{constructor(e){super(e),this.consumes={required:[Oe.TRANSPARENT_ENVIRONMENT]},this.produces=Oe.TRANSPARENT_ENVIRONMENT,this._rainSpeed=.1,this._snowSpeed=.01,this._numParticles=0,this._passParameters=new PT,this._configuration=new rH;let{view:t,type:i}=e;this._configuration.type=i==="rainy"?HM.Rain:HM.Snow,t._stage.renderView.techniques.precompile(Dy,this._configuration),this._passParameters.time=0,this._passParameters.radius=_t(t.spatialReference).radius,this.addHandles(S(()=>t.environment.weather,r=>{r.type===i&&this.addHandles(S(()=>r.precipitation,n=>this._adjustParticles(n),Ce))},Ce)),this.addHandles(S(()=>t._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,r=>{this._passParameters.opacity=r,r===1&&(this.removeHandles("opacity"),this.addHandles(S(()=>t._stage?.renderer.renderContext.bind.clouds.opacity??1,n=>this._passParameters.opacity=n,Ce),"opacity"))},Fe),"opacity")}_adjustParticles(e){let i=e<.5?Xe(0,.35,2*e):Xe(.35,1,2*(e-.5));this._numParticles=$4*i}destroy(){this._numParticles=0,this._vao=We(this._vao),this._instanceIdBuffer=We(this._instanceIdBuffer)}fadeOut(e){this.removeAllHandles(),this.addHandles(S(()=>this.renderContext?.bind.clouds.fadeFactor??1,t=>{this._passParameters.opacity=1-t,t===1&&(this.removeAllHandles(),e())}),"opacity")}updateAnimation(e){let t=(this.type==="rainy"?this._rainSpeed:this._snowSpeed)*o0(e.time)%1e5;return this._passParameters.time!==t&&(this._passParameters.time=t,!0)}render(e){let t=this.renderingContext;this._instanceIdBuffer??=this._createInstanceIndices(t);let i=Math.round(this._numParticles*this._passParameters.opacity),r=e.find(({name:o})=>o===Oe.TRANSPARENT_ENVIRONMENT);if(i<1)return r;let n=this.techniques.get(Dy,this._configuration);if(!n.compiled)return this.requestRender(Pe.UPDATE),r;let s=t.bindTechnique(n,this.bindParameters,this._passParameters);return this._vao??=uX(t,n.locations),t.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),BF(t,n.locations,this._instanceIdBuffer,Z4,0),t.drawArraysInstanced(Jt.TRIANGLES,0,3,i),UF(t,n.locations,this._instanceIdBuffer,Z4),r}_createInstanceIndices(e){let t=[];for(let i=0;i<$4;i++)t.push(i);return wr.createVertex(e,Jr.STATIC_DRAW,new Float32Array(t))}};function uX(e,t){let i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new ns(e,t,new Map([["geometry",is(dX)]]),new Map([["geometry",wr.createVertex(e,Jr.STATIC_DRAW,i)]]))}u([d()],Hh.prototype,"consumes",void 0),u([d()],Hh.prototype,"produces",void 0),u([d({constructOnly:!0})],Hh.prototype,"type",void 0),Hh=u([C("esri.views.3d.environment.Precipitation")],Hh);var $4=25e4,dX=Ps().vec3f(yi.POSITION),Z4=is(Ps().f32(yi.INSTANCEFEATUREATTRIBUTE),1);var Gu=class extends qp{constructor(e){super(e),this.produces=new Map([]),this._clouds=Pn(null),this._incarnation=0,this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage?.removeRenderPlugin(this),this._set("view",null)}get updating(){return!!this._clouds.value?.running}get weatherAvailable(){return xe(this.view.state.camera.eye)-_t(this.view.spatialReference).radius<=Jg}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=G(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:null}initializeRenderContext(e){this._context=e;let t=this.view,i=()=>this._requestRender();this.addHandles([S(()=>this._precipitation,i,Fe),S(()=>this._clouds.value?.state,i,Fe),S(()=>t.state.mode,i,Fe),S(()=>this._updateClouds(),i,Fe),S(()=>this._updatePrecipitation(),i,Fe),S(()=>this.weather,r=>this._initWeather(r))])}uninitializeRenderContext(){this._context=null,this._clouds.value=G(this._clouds.value),this._precipitation=G(this._precipitation),this._precipitationOutgoing=G(this._precipitationOutgoing)}prepareRender(e){let{bind:t,time:i}=e;if(this.view.viewingMode!=="local"&&t.clouds.data){t.clouds.fade(t.camera,i,this.view.qualitySettings.fadeDuration);let r=this._clouds.value;r&&r.state===Bd.Idle&&r.coverage===0&&!r.running&&r.destroyCubeMap()}}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(e){let t=this._context;if(!e||!t)return void(this._clouds.value=G(this._clouds.value));if(this._clouds.value)return;let i=this.view;this._clouds.value=new Cn({context:t,view:i,requestRender:()=>this._requestRender()})}_updateClouds(){let e=this.view.environment.weather;return e==null||this._clouds.value==null||this._clouds.value.applyPreset(Cr[e.type],hX(e)),++this._incarnation}_updatePrecipitation(){let e=this.view.environment.weather;if(e.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();let t=e.type==="rainy"||e.type==="snowy",i=this._context;return t&&i&&(this._precipitation=new Hh({view:this.view,type:e.type}),++this._incarnation),this._incarnation}get test(){}hasHighlightOptions(e){return!1}};function hX(e){switch(e.type){case"rainy":case"snowy":case"cloudy":case"sunny":return e.cloudCover;case"foggy":return e.fogStrength}}u([d({constructOnly:!0})],Gu.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Gu.prototype,"updating",null),u([d()],Gu.prototype,"weatherAvailable",null),u([d()],Gu.prototype,"_context",void 0),Gu=u([C("esri.views.3d.environment.EnvironmentRenderer")],Gu);var kT=Math.PI,Bi=Math.sin,Lr=Math.cos,iP=Math.tan,X4=Math.asin,rP=Math.atan2,J4=Math.acos,_r=kT/180,eG=864e5,tG=2440588,iG=2451545,pX={dec:0,ra:0};function mX(e){return e.valueOf()/eG-.5+tG}function OT(e){return new Date((e+.5-tG)*eG)}function NT(e){return mX(e)-iG}var FT=23.4397*_r;function rG(e,t){return rP(Bi(e)*Lr(FT)-iP(t)*Bi(FT),Lr(e))}function nP(e,t){return X4(Bi(t)*Lr(FT)+Lr(t)*Bi(FT)*Bi(e))}function nG(e,t,i){return rP(Bi(e),Lr(e)*Bi(t)-iP(i)*Lr(t))}function sG(e,t,i){return X4(Bi(t)*Bi(i)+Lr(t)*Lr(i)*Lr(e))}function oG(e,t){return _r*(280.16+360.9856235*e)-t}function aG(e){return _r*(357.5291+.98560028*e)}function lG(e){return _r*(1.9148*Bi(e)+.02*Bi(2*e)+3e-4*Bi(3*e))}function cG(e,t){return e+t+102.9372*_r+kT}function uG(e,t){var i=aG(e),r=cG(i,lG(i));return t||(t={dec:0,ra:0}),t.dec=nP(r,0),t.ra=rG(r,0),t}var Tn={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,i,r){var n=_r*-i,s=_r*t,o=NT(e),a=uG(o,pX),l=oG(o,n)-a.ra;return r||(r={azimuth:0,altitude:0}),r.azimuth=nG(l,s,a.dec),r.altitude=sG(l,s,a.dec),r}},LT=[[-.83,"sunrise","sunset"]];Tn.addTime=function(e,t,i){LT.push([e,t,i])};var dG=9e-4;function fX(e,t){return Math.round(e-dG-t/(2*kT))}function Q4(e,t,i){return dG+(e+t)/(2*kT)+i}function Y4(e,t,i){return iG+e+.0053*Bi(t)-.0069*Bi(2*i)}function gX(e,t,i){return J4((Bi(e)-Bi(t)*Bi(i))/(Lr(t)*Lr(i)))}function K4(e){var t=_r*(134.963+13.064993*e),i=_r*(93.272+13.22935*e),r=_r*(218.316+13.176396*e)+6.289*_r*Bi(t),n=5.128*_r*Bi(i),s=385001-20905*Lr(t);return{ra:rG(r,n),dec:nP(r,n),dist:s}}Tn.getTimes=function(e,t,i){var r=_r*-i,n=_r*t,s=fX(NT(e),r),o=Q4(0,r,s),a=aG(o),l=lG(a),c=cG(a,l),h=nP(c,0),p=Y4(o,a,c);function m(D){return Y4(Q4(gX(D,n,h),r,s),a,c)}function f(D){var M=(Bi(D)-Bi(n)*Bi(h))/(Lr(n)*Lr(h));return M<-1?Tn.PolarException.MIDNIGHT_SUN:M>1?Tn.PolarException.POLAR_NIGHT:Tn.PolarException.NORMAL}var g,_,v,b,x,E={solarNoon:OT(p),nadir:OT(p-.5),polarException:Tn.PolarException.NORMAL};for(g=0,_=LT.length;g<_;g+=1)x=p-((b=m((v=LT[g])[0]*_r))-p),E[v[1]]=OT(x),E[v[2]]=OT(b);return E.polarException=f(LT[0][0]*_r),E},Tn.getMoonPosition=function(e,t,i){var r=_r*-i,n=_r*t,s=NT(e),o=K4(s),a=oG(s,r)-o.ra,l=sG(a,n,o.dec);return l+=.017*_r/iP(l+10.26*_r/(l+5.1*_r)),{azimuth:nG(a,n,o.dec),altitude:l,distance:o.dist}},Tn.getMoonFraction=function(e){var t=NT(e),i=uG(t),r=K4(t),n=149598e3,s=J4(Bi(i.dec)*Bi(r.dec)+Lr(i.dec)*Lr(r.dec)*Lr(i.ra-r.ra)),o=rP(n*Bi(s),r.dist-n*Lr(s));return(1+Lr(o))/2};var En={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},Af=class{constructor(t,i){this.direct=t,this.ambient=i}};function TG(e,t,i,r,n,s){Te(s.ambient.color,1,1,1),s.ambient.intensity=En.global.ambient,Te(s.direct.color,1,1,1),s.direct.intensity=En.global.direct;let o=t[2],a=q((Math.abs(o)-En.local.altitude)/(En.global.altitude-En.local.altitude),0,1),l;if(s.globalFactor=a,e!=null&&(l=Tn.getTimes(e,t[1],t[0])),a<1){let c;if(e!=null)c=CX(e,l,r);else{let h=DG(r);c={direct:{intensity:En.local.directAtNoon*h.direct,color:yt(1,1,1)},ambient:{intensity:En.local.ambientAtNoon*h.ambient,color:yt(1,1,1)},timeOfDay:"early afternoon"}}ni(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Xe(c.ambient.intensity,s.ambient.intensity,a),ni(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Xe(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=e!=null?bX(e,l):1,e!=null?_X(e,t,i,s.direct.directionToLightSource):_P(n,i,s.direct.directionToLightSource)}function _P(e,t,i){t===Se.Global?ne(lP,e.eye):Te(lP,0,0,1),X(cP,e.viewForward,-1);let r=Bp(cP,lP),n=Math.max(r-2*uP,0),s=.85*n/(n+1),o=Math.max(uP,r-uP-s);uo(CG,-o,e.viewRight),si(i,cP,CG),he(i,i,X(TX,e.viewRight,EX)),ne(i,i)}function _X(e,t,i,r){let n=wX,s=Ed(vX);if(i===Se.Global)Tn.getPosition(e,0,0,n),Te(r,0,0,-1),Gx(s,s,-n.azimuth),eL(s,s,-n.altitude),si(r,r,s);else{let o=En.planarDirection,a=o.globalAngles,l=t[2],c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=q(c,0,1),c<1?(Tn.getPosition(e,t[1],t[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),Te(r,0,-1,0),kg(s,s,-n.azimuth),Gx(s,s,-n.altitude),si(r,r,s)}}function EG(e,t){if(t===Se.Global)return!0;let i=En.planarDirection;return Math.abs(e)<i.localAltitude}var yX=yt(.5773502691896258,-.5773502691896258,.5773502691896258),xy=class{constructor(){this.ambient={color:yt(1,1,1),intensity:.55},this.direct={color:yt(1,1,1),intensity:.55,directionToLightSource:hn(yX)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}},vX=$t(),wX={azimuth:0,altitude:0};function bX(e,t){let i=e.valueOf(),r,n;t.polarException===Tn.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=r+432e6):t.polarException===Tn.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=t.sunrise.valueOf(),n=t.sunset.valueOf());let s=r+(n-r)/2;return 1-q(Math.abs(i-s)/432e5,0,1)}function DG(e){switch(e){case"disabled":case"sunny":case"cloudy":return new Af(1,1);case"rainy":return new Af(.4,1.2);case"snowy":return new Af(.5,1.3);case"foggy":return new Af(.2,1.6)}}function hG(e,t){let i=(e[0]+e[1]+e[2])/3;e[0]+=(i-e[0])*t,e[1]+=(i-e[1])*t,e[2]+=(i-e[2])*t}var sP=yt(.01,.01,.01),dP=yt(1,.6,.5),hP=yt(1,.98,.98),pG=yt(1,1,1),oP=yt(.8,.8,1),pP=yt(.8,.8,1),mP=yt(.98,.98,1),mG=yt(1,1,1),aP=Bg(.01,En.local.ambientAtNight),fP=Bg(En.local.directAtTwilight,En.local.ambientAtTwilight),gP=Bg(.9*En.local.directAtNoon,En.local.ambientAtNoon),fG=Bg(En.local.directAtNoon,En.local.ambientAtNoon),gG=gP,_G=hP,yG=mP,vG=fP,wG=dP,bG=pP;function CX(e,t,i){let r=e.valueOf(),n,s;t.polarException===Tn.PolarException.MIDNIGHT_SUN?(n=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=n+432e6):t.polarException===Tn.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=t.sunrise.valueOf(),s=t.sunset.valueOf());let o=s-n,a=n+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,m=n-p/2,f=n+p/2,g=s-p/2,_=s+p/2,v=Hi(),b=w(),x=w(),E="";if(r<m||r>_)Yi(v,aP),ee(b,sP),ee(x,oP),E="night";else if(r<f){let T=(r-m)/(f-m);Md(v,aP,fP,T),ni(b,sP,dP,T),ni(x,oP,pP,T),E="sun rising"}else if(r<c){let T=(r-f)/(c-f);Md(v,fP,gP,T),ni(b,dP,hP,T),ni(x,pP,mP,T),E="early morning"}else if(r<a){let T=(r-c)/(a-c);Md(v,gP,fG,T),ni(b,hP,pG,T),ni(x,mP,mG,T),E="late morning"}else if(r<h){let T=(r-a)/(h-a);Md(v,fG,gG,T),ni(b,pG,_G,T),ni(x,mG,yG,T),E="early afternoon"}else if(r<g){let T=(r-h)/(g-h);Md(v,gG,vG,T),ni(b,_G,wG,T),ni(x,yG,bG,T),E="late afternoon"}else if(r<_){let T=(r-g)/(_-g);Md(v,vG,aP,T),ni(b,wG,sP,T),ni(x,bG,oP,T),E="sun setting"}let D=0;switch(i){case"rainy":case"foggy":D=.8;break;case"snowy":D=.5}D>0&&(hG(b,D),hG(x,D));let M=DG(i);return{direct:{intensity:v[0]*M.direct,color:b},ambient:{intensity:v[1]*M.ambient,color:x},timeOfDay:E}}var CG=$t(),lP=w(),cP=w(),TX=w(),uP=.25,EX=.2;var Gs=class extends oi.EventedAccessor{constructor(){super(),this._tmpLightParameters=new xy,this._defaultLightParameters=new xy,this._tmpDate=new Date,this._tmpTz={hours:0,minutes:0,seconds:0},this._viewHandlesKey="viewHandles",this._trackingEnabled=!1,this._mainLight=new rk,this._ambientLight=new tk,this._moonLight=new ik,this._disableProjectionEngineAutoLoad=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Se.Global&&x2(this._view.spatialReference)}get _weatherAvailable(){return this.weatherEnabled&&this._renderer?.weatherAvailable}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){let e=this._view?.stateManager?.camera?.position?.spatialReference??Qt.WGS84,t=eP(e);return this._disableProjectionEngineAutoLoad||Va(e,t)}connectView(e){if(this._renderer)return;this._renderer=new Gu({view:e});let t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([S(()=>e.environment.lighting,r=>this._updateLightingHandler(r),Fe),S(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,r=>this._lightingDateHandler(r),Fe),S(()=>e.environment.lighting.directShadowsEnabled,t,Fe),S(()=>e.qualitySettings.ambientOcclusion,t,Fe),S(()=>e.qualitySettings.reflections,t,Fe),S(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Fe),S(()=>[e.environment.weather.type,this.weatherEnabled],()=>this._updateLighting(null,bw.FadeWithWeather),Fe),S(()=>e.environment,r=>r.setComputeWeatherAvailable(()=>this._weatherAvailable),Ce),S(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ce),S(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,r=>this._updateCameraTracking(r),Ce),S(()=>e.state.camera,i,Ce),Wi(()=>this._canProjectCameraPosition,i,Fe)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=G(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{let t=this._view.environment.lighting;t?.type!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){let t=this._view.environment.lighting;if(t?.type!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(e),this._referencePositionGeographic!=null)){let i=bM(this._referencePositionGeographic,this._tmpTz);i!=null&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){let t=this._view;if(!t.ready)return;let i=t.stateManager.camera;if(!i)return;let{position:r}=i,n=r.spatialReference??Qt.WGS84,s=eP(n),o=this._referencePositionGeographic??w();if(!Kc(r,o,s))return this._referencePositionGeographic=null,void this._updateLighting();this._referencePositionGeographic=o,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(o,e)||this._updateLighting(e)}_updateLighting(e,t=bw.Immediate){let i=this._view,{lighting:r}=i.environment,n=r.type==="virtual",s=this._referencePositionGeographic,o=s!=null?this._tmpLightParameters:this._defaultLightParameters;if(s){e??=n?null:r.date;let m=this._weatherAvailable?i.environment.weather.type:"disabled";TG(e,s,i.state.viewingMode,m,i.state.camera,o)}else n&&_P(i.state.camera,i.state.viewingMode,o.direct.directionToLightSource);let a=this._mainLight,l=o.direct;X(a.intensity,l.color,l.intensity*Math.PI),ee(a.direction,l.directionToLightSource),a.specularStrength=o.specularStrength,a.environmentStrength=o.environmentStrength;let c=this._ambientLight;X(c.intensity,o.ambient.color,o.ambient.intensity);let h=this._moonLight;ni(h.intensity,DX,xX,o.globalFactor);let p=(1-.5*o.globalFactor)*(1-.4*o.noonFactor*(1-o.globalFactor));X(h.intensity,h.intensity,p),ee(h.direction,l.directionToLightSource),this._view._stage.renderer.updateLighting([a,c,h],o.noonFactor,o.globalFactor,this._weatherAvailable?t:bw.Immediate),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;let i=this._tmpDate;i.setTime((t||this._view.environment.lighting.date).getTime());let r=bM(e,this._tmpTz);if(r==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===r.hours&&n.minutes===r.minutes&&n.seconds===r.seconds)return!1}else n=r;let s=i.getUTCHours()-(r.hours-n.hours),o=i.getUTCMinutes()-(r.minutes-n.minutes),a=i.getUTCSeconds()-(r.seconds-n.seconds);return i.setUTCHours(s),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){let e=this._view._stage;if(!e)return;let t=this._referencePositionGeographic==null||EG(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,environment:this._view.environment,weatherVisible:this._weatherAvailable,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._referencePositionGeographic=null,e&&this._cameraHandler()}get test(){}};u([d({type:Boolean,readOnly:!0})],Gs.prototype,"updating",null),u([d()],Gs.prototype,"_disableProjectionEngineAutoLoad",void 0),u([d()],Gs.prototype,"_disableWeather",void 0),u([d()],Gs.prototype,"weatherEnabled",null),u([d()],Gs.prototype,"_weatherAvailable",null),u([d()],Gs.prototype,"referencePositionGeographic",null),u([d()],Gs.prototype,"_renderer",void 0),u([d()],Gs.prototype,"_referencePositionGeographic",void 0),u([d()],Gs.prototype,"_canProjectCameraPosition",null),Gs=u([C("esri.views.3d.environment.EnvironmentManager")],Gs);var DX=yt(.22,.22,.33),xX=yt(.22,.22,.22);var yP,Po=yP=class extends cn{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new yP(this.cloneConstructProperties())}cloneConstructProperties(){let e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Po.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Po.prototype,"date",void 0),u([Fx("date",["datetime"])],Po.prototype,"readDate",null),u([Dp("date")],Po.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Po.prototype,"directShadowsEnabled",void 0),u([Fx("directShadowsEnabled",["directShadows"])],Po.prototype,"readDirectShadowsEnabled",null),u([Dp("directShadowsEnabled")],Po.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Po.prototype,"displayUTCOffset",void 0),u([Dp("displayUTCOffset")],Po.prototype,"writeDisplayUTCOffset",null),Po=yP=u([C("esri.webscene.SunLighting")],Po);var Ec=Po;var Rf,qu=Rf=class extends oi.EventedMixin(Ec){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};let t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new Rf(e.cloneConstructProperties())}set defaultDate(e){let t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){let i=Rf.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));let n=Rf.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(VT.target=this,VT.timezoneOffset=n,this.emit("timezone-will-change",VT),VT.target=null),e!=null)return isNaN(e.getTime())||r!==e.getTime()}clone(){let e=this._get("date")===this._get("defaultDate"),t=new Rf(be(ie({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){let t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],qu.prototype,"cameraTrackingEnabled",void 0),u([d({type:Date})],qu.prototype,"defaultDate",null),u([d({type:Date})],qu.prototype,"date",null),qu=Rf=u([C("esri.views.3d.environment.SunLighting")],qu),function(e){function t({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}e.calculateTimezoneOffset=t}(qu||(qu={}));var VT={target:null,timezoneOffset:0},Dc=qu;var vP,My=vP=class extends cn{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new vP(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],My.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],My.prototype,"directShadowsEnabled",void 0),My=vP=u([C("esri.webscene.VirtualLighting")],My);var Wu=My;var HT,BT=HT=class extends oi.EventedMixin(Wu){constructor(e){super(e),this.cameraTrackingEnabled=!0}clone(){return new HT(be(ie({},this.cloneConstructProperties()),{cameraTrackingEnabled:this.cameraTrackingEnabled}))}static fromWebsceneLighting(e){return new HT(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){let t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],BT.prototype,"cameraTrackingEnabled",void 0),BT=HT=u([C("esri.views.3d.environment.VirtualLighting")],BT);var Bh=BT;var xG={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Dc,virtual:Bh}};var MG={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Ec,virtual:Wu}};var UT=class extends cn{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};u([d({readOnly:!0,json:{read:!1}})],UT.prototype,"type",void 0),UT=u([C("esri.webscene.background.Background")],UT);var jT=UT;var wP,Sy=wP=class extends jT{constructor(e){super(e),this.type="color",this.color=new fn([0,0,0,1])}clone(){return new wP(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([b0({color:"color"},{readOnly:!0})],Sy.prototype,"type",void 0),u([d(sF({nonNullable:!0}))],Sy.prototype,"color",void 0),Sy=wP=u([C("esri.webscene.background.ColorBackground")],Sy);var zT=Sy;var SG={base:jT,key:"type",typeMap:{color:zT}};function MX(e){return(t,i,r)=>{if(!t)return t;for(let n in e.typeMap)if(t.type===n){let s=new e.typeMap[n];return s.read(t,r),s}}}var IG={types:SG,json:{read:MX(SG),write:{overridePolicy:(e,t,i)=>({enabled:!i?.isPresentation})}}};var bP,AG=(e,t,i)=>({enabled:!i?.isPresentation}),$u=bP=class extends cn{constructor(e){super(e),this.lighting=new Ec,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){MV(e?.type,W.getLogger(this))&&this._set("weather",e)}clone(){return new bP(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Wu.prototype.clone.call(this.lighting):Ec.prototype.clone.call(this.lighting),background:ro(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:MG,nonNullable:!0,json:{write:!0}})],$u.prototype,"lighting",void 0),u([d(IG)],$u.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:AG}}})],$u.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:AG}}})],$u.prototype,"starsEnabled",void 0),u([d({types:xV,nonNullable:!0,json:{write:!0},value:new DV})],$u.prototype,"weather",null),$u=bP=u([C("esri.webscene.Environment")],$u);var GT=$u;var Iy,Uh=Iy=class extends GT{constructor(e){super(e),this.lighting=this.castLighting(),this._computeWeatherAvailable=void 0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){let t=e.cloneConstructProperties();return new Iy(be(ie({},t),{lighting:t.lighting?t.lighting.type==="virtual"?Bh.fromWebsceneLighting(t.lighting):Dc.fromWebsceneLighting(t.lighting):void 0}))}get weatherAvailable(){return this._computeWeatherAvailable?.()??!1}setComputeWeatherAvailable(e){this._computeWeatherAvailable=e}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){let t=this._convertLighting(e);return t!==e&&this.addHandles(r2(t)),t}_convertLighting(e){return e?e instanceof Dc||e instanceof Bh?e:e instanceof Ec?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Dc(ie(ie({},e.cloneConstructProperties()),this.lighting?.cloneNonPersistentConstructProperties())):e instanceof Wu?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Bh(ie(ie({},e.cloneConstructProperties()),this.lighting?.cloneNonPersistentConstructProperties())):p2(xG,e):new Dc}clone(){return new Iy({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ro(this.background)})}cloneWithWebsceneEnvironment(e){return new Iy(be(ie({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ro(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):Dc.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):Bh.fromWebsceneLighting(e.lighting);default:return e.lighting,Dc.fromWebsceneLighting(e.lighting)}}};u([d({nonNullable:!0})],Uh.prototype,"lighting",void 0),u([d()],Uh.prototype,"_computeWeatherAvailable",void 0),u([d({readOnly:!0})],Uh.prototype,"weatherAvailable",null),u([Ir("lighting")],Uh.prototype,"castLighting",null),Uh=Iy=u([C("esri.views.3d.environment.SceneViewEnvironment")],Uh);var jh=Uh;var dt;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(dt||(dt={}));var Ne;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Ne||(Ne={}));var ws;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(ws||(ws={}));var xi=class{constructor(t=dt.ALL,i=Ne.NONE,r=0,n=null,s=null,o=ws.TUMBLE){this.selection=t,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=n,this.interactionDirection=s,this.tiltMode=o}};function Zu(e,t){return!!(e&t)}function zh(e,t,i,r,n,s){e!==0&&(i?(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t)):r!=null?(s.min-=Math.max(0,(t-s.min)*(1-r)),s.max+=Math.max(0,(t-s.max)*(1-r))):n&&(s.min-=Math.max(0,t-s.min-n),s.max+=Math.max(0,t-s.max-n)))}var ml=new xi(dt.NONE);function qT(e,t,i,r){return t=t||e.viewForward,ee(r,t),X(r,r,Math.sign(ae(t,i))),r}function RG(e,t,i=ml){let r=WT(e,t,i);if(r===0)return!1;let n=e.renderCoordsHelper,s=n.getAltitude(t.eye)+r,o=qT(t,i.interactionDirection,AX(e,t,Math.sign(r),NX),OX),a=ee(LX,t.viewForward),l=n.intersectInfiniteManifold(ia(t.eye,o),s,CP);return t.eye=l??n.setAltitude(CP,s,t.eye),t.center=GV(CP,t.eye,a,t.center),!0}function WT(e,t,i=ml){if(!SX(e,i)||!e.state.constraints.altitude)return 0;let r=RX(e.state.constraints.altitude,PX);IX(e,i,r);let n=e.renderCoordsHelper.getAltitude(t.eye),s=q(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function SX(e,t){let i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==Ne.TUMBLE||!Zu(t.selection,dt.TILT))}function IX(e,t,i){let r=t.interactionType;if(r===Ne.NONE)return;let{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;let l=r===Ne.TUMBLE||r===Ne.ZOOM,c=WT(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,zh(c,h,l,a,.05*h,i)}function AX(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),X(r,r,i),r}function RX(e,t){return t.min=e.min,t.max=e.max,t}var PX={min:0,max:0},OX=w(),NX=w(),LX=w(),CP=w();function QT(e,t,i=ml){if(!e.state.isLocal)return 0;let r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;$T.min=0,$T.max=r,FX(e,i,$T);let n=TP(e,t),s=$T.max-n;return s>=-1e-6?0:s}function PG(e,t,i=ml){let r=QT(e,t,i);if(r===0)return!1;let n=e.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;let s=TP(e,t)+r,o=ee(VX,t.eye),a=qT(t,i.interactionDirection,kX(t,n.renderLocation,UX),BX);if(!Xc(EF(n.renderLocation,s),ia(t.eye,a),ZT))return!1;t.eye=ZT;let l=ve(HX,t.eye,o);t.center=he(ZT,t.center,l);let c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,ZT);return h!=null&&(t.center=h),!0}function FX(e,t,i){let r=t.interactionType;if(r===Ne.NONE)return;let{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;let l=r===Ne.ZOOM||r===Ne.PAN,c=QT(e,o),h=c===0?0:TP(e,o);i.min=n,i.max=s,zh(c,h,l,a,.05*h,i)}function TP(e,t){let i=e.pointsOfInterest.surfaceOrigin;return i.renderLocation?ui(t.eye,i.renderLocation):0}function kX(e,t,i){return Np(i,e.eye,t)}var $T={min:0,max:0},VX=w(),HX=w(),BX=w(),UX=w(),ZT=w();function Oo(e,t,i=Dn.EYE){let r=e.state.constraints;if(!r.collision.enabled)return!1;let n=nm(e,t.eye),s=e.renderCoordsHelper.getAltitude(t.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;let a=xe(t.eye);if(ve(YT,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(jX,o,t.eye),i===Dn.EYE_AND_CENTER)t.center=he(YT,t.eye,YT);else if(i===Dn.EYE_AND_CENTER_SCALE){let l=(a-s+o)/a;t.center=X(YT,t.center,l)}return!0}var Dn;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Dn||(Dn={}));var YT=w(),jX=w();function DP(e,t,i,r=!0){Ay.eyeCenterDistance=0,Ay.requiresTwoSteps=!1;let n=JT(e,t,i,ml,Ay);if(n===0)return!1;switch(uo(KT,-n,t.viewRight),i.tiltMode){case ws.LOOK_AROUND:si(Qu,t.viewForward,KT),X(Qu,Qu,Ay.eyeCenterDistance),t.center=he(Yu,t.eye,Qu);break;case ws.TUMBLE:ve(Qu,t.center,t.eye),si(Qu,Qu,KT),t.eye=ve(Yu,t.center,Qu);break;default:i.tiltMode}return t.up=si(Yu,t.up,KT),!Ay.requiresTwoSteps||!r||DP(e,t,i,!1)}function JT(e,t,i,r=ml,n){if(!e.state.constraints.tilt)return 0;let s=Math.min(t.relativeElevation*XT,t.distance),o=e.state.constraints.tilt(s,XX);return KX(e,i,o),r.interactionType===Ne.TUMBLE&&Zu(r.selection,dt.ALTITUDE)&&NG(e,r.interactionStartCamera,o),i.tiltMode===ws.LOOK_AROUND||r.tiltMode===ws.LOOK_AROUND?GX(e,t,o,n):zX(e,t,o)}function zX(e,t,i){let r=la(e.renderCoordsHelper,t.center,t.eye),n=r-q(r,i.min,i.max);return Ry(n)?n:0}function GX(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return WX(e,t,i,r);case"local":return qX(e,t,i,r)}}function qX(e,t,i,r){let n=la(e.renderCoordsHelper,t.center,t.eye),s=q(n,i.min,i.max),o=n-s;if(!Ry(o))return 0;if(r){let a=Math.abs(e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.max(Math.cos(s),1e-4);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function WX(e,t,i,r){let n=$X(e,t,JX),s=q(n.tiltAtCenter,i.min,i.max);if(!Ry(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=ZX(n),a=QX(n,o)):(o=n.constraints.clampTilt(n.distance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=YX(n,o)),r&&(r.eyeCenterDistance=EP(n,o)),a}function $X(e,t,i){let r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+_t(e.spatialReference).radius,s=e.renderCoordsHelper.intersectManifold(t.ray,r,Yu);return i.distance=Math.min(t.relativeElevation*XT,t.distance),i.centerIsOnSurface=!1,s!=null?(i.distance=Math.min(t.relativeElevation*XT,ui(t.eye,s)),i.tiltAtCenter=la(e.renderCoordsHelper,s,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=la(e.renderCoordsHelper,t.center,t.eye):(Jc(jp(zp,n),t.ray,Yu),i.distance=Math.min(t.relativeElevation*XT,ui(t.eye,Yu)),i.tiltAtCenter=oo(-ae(t.viewForward,ne(Yu,Yu)))),i.radius=n,i.eyeRadius=xe(t.eye),i.constraints=e.state.constraints,i}function Ry(e){return Math.abs(e)>1e-9}function ZX(e){let{constraints:t,distance:i,tiltAtCenter:r}=e,n=r,s=t.clampTilt(i,r),o=EP(e,s);if(t.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&Ry(s-n);){let l=(n+s)/2,c=EP(e,l);Ry(t.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function EP(e,t){if(!e.centerIsOnSurface)return e.distance;let i=Math.PI-q(t,0,Math.PI),r=Sp(e.radius/e.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(e.eyeRadius<e.radius&&s>1){let o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return s*e.eyeRadius}function QX(e,t){let i=Sp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Sp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function YX(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function KX(e,t,i){if(t.interactionType===Ne.NONE)return;let{interactionStartCamera:r,interactionFactor:n}=t;if(!r)return;let{min:s,max:o}=i,a=JT(e,r,ml,t),l=a===0?0:la(e.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,t.interactionType===Ne.TUMBLE?(Zu(t.selection,dt.ALTITUDE)&&NG(e,r,i),zh(a,l,!0,n,OG,i)):zh(a,l,!1,n,OG,i)}function NG(e,t,i){let r=e.state.constraints;if(e.state.isLocal||!r.altitude||!t)return;let n=Ar(t.center),s=Math.sqrt(n),o=t.distance,a=_t(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-n)/(-2*s*o),p=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-oo(p),i.max)),i.max=Math.min(i.max,Math.PI-oo(h))}var Qu=w(),KT=$t(),Yu=w(),OG=Vt(5),XT=30,XX={min:0,max:0},JX={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,distance:0,tiltAtCenter:0},Ay={eyeCenterDistance:0,requiresTwoSteps:!1};function Pt(e,t,i=rJ,r=t){r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);let n=!1;for(let a=0;a<nJ;a++){let l=0;for(let c of iJ)if(Zu(i.selection,c.type)){let h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(n=!0,l+=h)}if(l===0)break}let s=Zu(i.selection,dt.COLLISION),o=eJ(i.interactionType,e);return s&&Oo(e,r,o)&&(n=!0),n&&r.computeUp(e.state.viewingMode),n}function eJ(e,t){switch(e){case Ne.PAN:return Dn.EYE_AND_CENTER;case Ne.ASCEND:return t.state.isGlobal?Dn.EYE_AND_CENTER_SCALE:Dn.EYE_AND_CENTER;default:return Dn.EYE}}function on(e){let t=Math.min(1,e/150);return MR(t)}function tJ(e,t,i){return JT(e,t,i)*t.distance}var iJ=[{type:dt.TILT,error:tJ,apply:DP},{type:dt.ALTITUDE,error:WT,apply:RG},{type:dt.DISTANCE,error:QT,apply:PG}],rJ=new xi,nJ=5;var Py=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(t){this.viewingMode=t,this.center=w(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=hn(LG),this._fov=55,this._size=1}pixelsPerPanAtZoom(t){return this._size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this._size/2/(this._zoomToPanScale*t)}pixelsPerRotate(){let t=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/t}compareTo(t,i){if(this.viewingMode===Se.Global){let s=(xe(this.center)+xe(t.center))/2;i.pan=Bp(this.center,t.center)*s}else i.pan=ui(this.center,t.center);let r=Math.abs(t._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);let n=Math.abs(t._pitch-this._pitch);i.rotate=Math.max(r,n),i.fov=t.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=t._distance}interpolate(t,i,r){this.viewingMode===Se.Global?fF(t.center,i.center,r.pan,this.center):ni(this.center,t.center,i.center,r.pan),this._distance=isFinite(i.distance)?Xe(t.distance,i.distance+r.zoomOffset,r.zoom):t.distance,this._pitch=Xe(t.pitch,i.pitch,r.rotate);let n=t._yaw,s=i._yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this._yaw=Xe(n,s,r.rotate),this._fov=Xe(t.fov,i.fov,r.fov)}copyFrom(t){ee(this.center,t.center),this._pitch=t.pitch,this._yaw=t.yaw,this._distance=t.distance,ee(this.direction,t.direction),this._size=t.size,this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){let i=this._lookAtOrientation(t.center,FG);ee(this.center,t.center),ve(Zr,t.center,t.eye),ts(Zr,Zr,i),ts(Xu,t.up,i),this._distance=xe(Zr),this._distance!==0&&(Zr[0]/=this._distance,Zr[1]/=this._distance,Zr[2]/=this._distance),this._pitch=sJ(Zr),this._yaw=oJ(Zr,Xu),this._size=Math.sqrt(t.width*t.width+t.height*t.height),this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(t){let i=this._lookAtOrientation(this.center,FG);Qc(i,i),this._axisAngleVec3(eE,this._pitch-Math.PI/2,LG,Zr),this._axisAngleVec3(Gh,this._yaw,Zr,Zr),this._axisAngleVec3(eE,this._pitch-Math.PI/2,Gh,Xu),this._axisAngleVec3(Gh,this._yaw,Xu,Xu),X(Zr,Zr,this._distance),ts(Zr,Zr,i),ts(Xu,Xu,i),t.center=this.center,t.eye=ve(Zr,this.center,Zr),t.up=Xu,t.fov=this._fov}_axisAngleVec3(t,i,r,n){let s=Math.cos(i),o=Math.sin(i);return X(qs,r,s),At(bs,t,r),X(bs,bs,o),X(Ku,t,(1-s)*ae(t,r)),he(n,he(n,qs,bs),Ku)}_lookAtOrientation(t,i=Nn()){return this._upAtLookAt(t,Ku),At(qs,this.direction,Ku),ne(qs,qs),qs[0]===0&&qs[1]===0&&qs[2]===0&&ee(qs,eE),At(bs,Ku,qs),ne(bs,bs),i[0]=qs[0],i[1]=bs[0],i[2]=Ku[0],i[3]=qs[1],i[4]=bs[1],i[5]=Ku[1],i[6]=qs[2],i[7]=bs[2],i[8]=Ku[2],i}_upAtLookAt(t,i){return this.viewingMode===Se.Local?ee(i,Gh):ne(i,t)}};function sJ(e){return Math.PI-Bp(Gh,e)}function oJ(e,t){let i=aJ;return Math.abs(t[2])<.5?(ee(i,t),e[2]>0&&X(i,i,-1)):ee(i,e),At(bs,i,Gh),ne(bs,bs),Bp(eE,bs,Gh)}var qs=w(),bs=w(),Ku=w(),Zr=w(),Xu=w(),aJ=w(),Gh=X2,LG=K2,eE=Y2,FG=Nn();var tE=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(t){this.currentTime=0,this._animation=new bT(()=>new Py(t)),this._current=new Py(t)}update(t,i,r){let{source:n,target:s}=this._animation.definition,o=ve(lJ,i.center,t.center),a=xe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ee(n.direction,o),ee(s.direction,o),n.copyFromRenderCamera(t),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){this._animation.cameraAt(t,this._current),this._current.copyToRenderCamera(i)}step(t,i){this.finished||(this.currentTime=this.currentTime+s0(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}},lJ=w();var Ht;(function(e){e[e.Ready=0]="Ready",e[e.Rejected=1]="Rejected",e[e.Running=2]="Running",e[e.Stopped=3]="Stopped",e[e.Finished=4]="Finished"})(Ht||(Ht={}));var No=class extends P{constructor(e){super(e),this.state=Ht.Ready}get running(){return this.state===Ht.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ht.Stopped,!0)}finishController(){this.state=Ht.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],No.prototype,"view",void 0),u([d({readOnly:!0})],No.prototype,"running",null),u([d()],No.prototype,"state",void 0),u([d({readOnly:!0})],No.prototype,"isInteractive",null),No=u([C("esri.views.3d.state.controllers.CameraController")],No);var Ju=class extends No{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Sr()),this._asyncResult=null),this.state===Ht.Finished||this.state===Ht.Stopped?(i2(e),this.state===Ht.Finished?e.resolve():e.reject(Sr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ht.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==Ht.Ready&&this.state!==Ht.Running||(this.viewAnimation.state===bn.State.FINISHED?this.finish():this.viewAnimation.state===bn.State.STOPPED&&(this.state=Ht.Stopped))}onControllerEnd(e){this.viewAnimation==null||this.viewAnimation.done||(this.state===Ht.Finished?this.viewAnimation.finish():this.state===Ht.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ht.Finished?this._asyncResult.resolve():this._asyncResult.reject(Sr()))}finish(){this.finishController()}};Ju=u([C("esri.views.3d.state.controllers.AnimationController")],Ju);var fl=class extends Ju{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.type="point-to-point",this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new tE(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new bn}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;let i=this.animationSettings(t);iE.copyFrom(this.view.state.camera);let r=tn(this.view.state.viewingMode);this._intersectionHelper.intersectRay(iE.ray,r,kG)&&(iE.center=kG),this.animation.update(iE,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return be(ie({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?vy[e.easing]:e.easing})}};u([d({constructOnly:!0})],fl.prototype,"mode",void 0),u([d({readOnly:!0})],fl.prototype,"isInteractive",null),fl=u([C("esri.views.3d.state.controllers.PointToPointAnimationController")],fl);var iE=new Rt,kG=w();function xP(e){return e!=null&&"type"in e&&e.type==="point-to-point"}function qh(e=uJ){return[e[0],e[1],e[2],e[3]]}function xc(e,t){return cJ(e[0],e[1],e[2],t,pF.get())}function cJ(e,t,i,r,n=qh()){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function Pf(e,t,i){return At(i,e,t),ne(i,i),i[3]=U0(e,t),i}var uJ=[0,0,1,0],uje=jg(),dje=jg();function Oy(e,t,i,r){let n=Qa(t,i,dJ);return Xc(e,n,r)}var dJ=Os();var td;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(td||(td={}));var hE=30,Ff=[1,3e8],gl=80,pE=8,mE=200,fE=1508e5,gE=5,_E=50,$G=5,ZG=10,yE=90,Cs={exclude:new Set([Zl])};function _l(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function Ly(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Ws(e,t,i){let r=uo(mF.get(),i[3],i);r==null||rL(r,Yc)||(ve(Wt,e.eye,t),si(Wt,Wt,r),e.eye=he(Wt,Wt,t),ve(Wt,e.center,t),si(Wt,Wt,r),e.center=he(Wt,Wt,t),e.up=si(Wt,e.up,r))}function QG(e,t,i,r){return q0(e,Ew(t,i,LP),r)}function Fy(e,t,i,r){return q0(e,Qa(t,i,LP),r)}function kf(e,t,i,r){let n=fi.get(),s=1-i;ve(n,t,e.eye);let o=xe(n),a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(X(n,n,s),e.eye=he(Wt,e.eye,n),e.center=ni(Wt,e.center,t,s))}function vE(e,t,i){t.getScreenCenter(VG),Oy(e,t,VG,Wt)&&(t.center=Wt);let r=t.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;let s=X(fi.get(),t.viewForward,n);t.eye=ve(Wt,t.center,s)}var VG=Kt();function wE(e,t){Te(t,0,0,0);for(let i of e)he(t,t,i);X(t,t,1/e.length)}function ky(e,t,i,r){return Math.sin(e/xe(t))*(i+r.radius)}function IP(e,t,i,r){return ky(Math.PI/2,t,i,r)+(e-Math.PI/2)}var er;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(er||(er={}));var HG={Elevation:3e4,Angle:Vt(16)},YG=Vt(80);function bE(e,t,i,r,n,s){let o=w(),a=ur(),l=!0,c=!0;return e.intersectScreen(i,o,s)?a[3]=xe(o):(c=!1,t.aboveGround&&n!==td.Ellipsoid?a[3]=Math.max(xe(t.center),.9*r.radius):a[3]=xe(t.eye)-t.relativeElevation,n===td.Silhouette?id(a,t,i,o):l=Oy(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function yl(e,t,i,r){let n=e.relativeElevation;if(n>HG.Elevation&&r==="global")return er.Horizontal;Qa(e,t,SP);let s=Math.sign(n),o=i.worldUpAtPosition(e.eye,Wt);return-s*ae(o,SP.direction)<Math.sin(HG.Angle)*xe(SP.direction)?er.Vertical:er.Horizontal}function CE(e,t,i){ve(MP,i,t),e.eye=ve(Wt,e.eye,MP),e.center=ve(Wt,e.center,MP)}var MP=w();function id(e,t,i,r){let n=Qa(t,i,LP);return n!=null&&(Jc(e,n,rE),Xc(e,n,r)?!(po(rE,n.origin)<po(r,n.origin))||(ee(r,rE),!1):(ve(Of,t.eye,t.center),ne(Of,Of),z0(Of,-ae(ne(Of,Of),rE),BG),q0(BG,n,r),!1))}var rE=w(),Of=w(),BG=Wl();function AP(e,t,i,r,n,s){let o=0;if(At(dE,e,t),ve(aE,e,t),xe(e)<=n||!r.aboveGround){At(i,aE,r.eye);let a=ae(e,t)/(xe(e)*xe(t));if(a<.9999)o=oo(a);else{let c=xe(At(w(),e,t))/(xe(e)*xe(t));o=Sp(c)}let l=Math.cos(q(oa.normalize(Vt(s)),0,YG));o=-o-Math.max(0,xe(t)-n)/(l*n)}else ve(UG,r.eye,r.center),At(i,aE,UG),o=-xe(aE)/n;return ne(i,i),X(i,i,xe(dE)),o}var UG=w();function jG(e,t,i,r){let n,s,o=Math.cos(q(oa.normalize(Vt(r)),0,YG));return n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):oo(t/i),s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):oo(e/i),(s-n)*i}function hJ(e,t,i,r,n,s,o,a,l,c){let h=jG(e[2],t[2],s[3],a),p=l?jG(e[0],t[0],s[3],180):t[0]-e[0],m=Math.sin(o)*p-Math.cos(o)*h,f=Math.cos(o)*p+Math.sin(o)*h;ne(Wt,n);let g=l?m/Math.sqrt(Math.abs(s[3]**2-ae(i,Wt)**2)):m/s[3],_=f/Math.sqrt(Math.abs(s[3]**2-ae(i,r)**2));es(c,g,_)}function RP(e,t,i,r,n,s,o,a,l,c){At(dE,e,t),rw(s.up,s.eye,nE,sE,oE),rw([0,0,1],s.eye,Mc,ed,JG),ee(i,ed),ee(r,Mc),ne(i,i),X(i,i,xe(dE)),uM(e,ne(sE,sE),ne(oE,oE),ne(nE,nE),zG),uM(t,sE,oE,nE,GG),hJ(zG,GG,e,Mc,ed,o,a,l,c,n)}function pJ(e,t,i,r,n,s,o){uo(cE,n,r),uo(uE,o,s),lo(Lf,cE,uE),ve(t,e,i),si(t,t,Lf),he(t,t,i)}function PP(e,t,i,r,n,s){uo(cE,r,i),uo(uE,s,n),lo(Lf,cE,uE),ve(Wt,e.eye,t),si(Wt,Wt,Lf),e.eye=he(Wt,Wt,t),ve(Wt,e.center,t),si(Wt,Wt,Lf),e.center=he(Wt,Wt,t),ve(Wt,e.up,t),si(Wt,Wt,Lf),e.up=he(Wt,Wt,t)}var Wh={Pole:.95,Angle:Vt(18),Tilt:45,TiltHysteresisMargin:1e-7},Nf=!1;function TE(e,t,i,r,n,s){let o=Math.abs(r)>Math.PI-Wh.Angle||Math.abs(r)<Wh.Angle,a=(Math.abs(e[2])<i*Wh.Pole||Math.abs(t)>i)&&s;return o&&a?!Nf&&n<Wh.Tilt-Wh.TiltHysteresisMargin?Nf=!0:Nf&&n>Wh.Tilt+Wh.TiltHysteresisMargin&&(Nf=!1):Nf=!1,Nf}function OP(e,t,i,r,n,s){if(s)Pf(i,r,qG),Ws(t,e,qG);else{let o=AP(i,r,WG,t,e[3],n);Ws(t,e,xc(WG,o))}}function NP(e,t,i,r,n,s,o){let a=o?20:1,l=1e-12,c,h;ee($h,r),lE.copyFrom(t);for(let p=0;p<a&&po(i,$h)>l&&(c=po(i,$h),RP(i,$h,ed,Mc,Ny,lE,e,n,s,o),PP(lE,e,Mc,Ny[1],ed,Ny[0]),pJ($h,$h,e,Mc,Ny[1],ed,Ny[0]),h=po(i,$h),h<c||p===0);p++)t.copyFrom(lE)}function KG(e,t,i,r,n,s,o){TE(i,ae(t.up,i),e[3],-oa.normalize(Vt(n)),s,t.aboveGround)?NP(e,t,i,r,-oa.normalize(Vt(n)),s,o):OP(e,t,i,r,s,o)}function mJ(e,t,i,r,n,s){let{eye:o}=e;rw([0,0,1],o,Mc,ed,JG);let a=t.translation[0]*i.pan,l=n.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-ae(e.center,Mc)**2/xe(e.center)**2)),.5),h=(Math.sin(s)*l+Math.cos(s)*a)/c,p=-Math.cos(s)*l+Math.sin(s)*a;switch(co(r.pan.matrix,r.pan.matrix,h,Mc),r.pan.enabled=!0,n.mode){case"pan":co(r.pan.matrix,r.pan.matrix,p,ed),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function fJ(e,t,i,r,n){let{eye:s,viewRight:o}=e,a=At(fi.get(),o,s),l=t.translation[0]*i.pan;switch(l!==0&&(co(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{let c=t.translation[1]*i.pan;c!==0&&(co(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function XG(e,t,i,r,n,s,o,a,l){TE(e.center,ae(e.up,e.center),xe(e.center),-oa.normalize(Vt(s)),o,t.aboveGround)?mJ(t,i,r,a,l,-oa.normalize(Vt(n))):fJ(t,i,r,a,l)}var Mc=w(),ed=w(),JG=w(),nE=w(),sE=w(),oE=w(),zG=w(),GG=w(),Ny=Hi(),qG=qh(),cE=$t(),uE=$t(),Lf=$t(),$h=w(),Wt=w(),aE=w(),lE=new Rt,dE=w(),WG=w(),LP={origin:w(),direction:w()},SP={origin:w(),direction:w()};var eq=.6,FP=4,gJ=60,Vf=class extends fl{constructor(){super(...arguments),this._zoomLocation=w(),this._tmpCamera=new Rt,this._tmpViewDir=w(),this._tmpRayDir=Os(),this._targetOnSphere=w(),this._tmpCenter=w(),this._beginCamera=new Rt,this._constraintOptions=new xi(dt.ALL_EXCEPT_COLLISION,Ne.ZOOM,null,this._beginCamera),this._sphere=ur()}initialize(){this._intersector=tn(this.view.state.viewingMode)}step(e,t){if(!this.running)return;let i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let r=!1,n=!1;this._intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Cs:{})&&(r=e>0,n=!0),this._tmpCamera.copyFrom(i.camera),r?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ee(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:ku}}_updateCamera(e,t,i,r){let n=yl(e,i,this.view.renderCoordsHelper,this.view.viewingMode),s=Math.abs(this.view.camera.position.z),o=this._zoomLocation;ne(DE,e.eye),X(DE,DE,-1),Qa(e,i,this._tmpRayDir),ne(this._tmpRayDir.direction,this._tmpRayDir.direction);let a=q(Math.min(pE,1/Math.abs(ae(DE,this._tmpRayDir.direction)))*s,mE,fE);if(n===er.Horizontal){let l=eq**t;this._sphere[3]=xe(o),ve(this._tmpViewDir,e.center,e.eye);let c=Math.min(xe(this._tmpViewDir),a),h=c*l;if(l<=1&&h<FP&&(h=FP,l=h/c),Math.abs(c-h)<1e-6)return;let p=xe(e.center);if(this._sphere[3]!==p){let m=this._sphere[3]+l*(p-this._sphere[3]);e.center=X(EE,e.center,m/p)}X(this._tmpViewDir,this._tmpViewDir,-l),e.eye=he(EE,e.center,this._tmpViewDir),Pt(this.view,e,this._constraintOptions),po(o,e.center)>1e-12&&Oy(this._sphere,e,i,this._targetOnSphere)&&KG(this._sphere,e,o,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let l=eq**Math.abs(t),c=t>0?1:-1;ve(this._tmpViewDir,o,e.eye);let h=xe(this._tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,gJ),m=p??a;m=r&&t>0?Math.min(m,h):m,X(this._tmpRayDir.direction,this._tmpRayDir.direction,m),he(o,this._tmpRayDir.origin,this._tmpRayDir.direction);let f=m*l,g=Math.max(FP,1.01*e.nearFar[0]);if(t>0&&f<g&&(f=g,l=f/m),Math.abs(m-f)<1e-6)return;X(this._tmpRayDir.direction,this._tmpRayDir.direction,c*(1-l)),e.eye=he(EE,e.eye,this._tmpRayDir.direction),e.center=he(EE,e.center,this._tmpRayDir.direction)}Oo(this.view,e)}};Vf=u([C("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],Vf);var EE=w(),DE=w();var _J=.6,yJ=4,vJ=60,Hf=class extends fl{constructor(){super(...arguments),this._zoomLocation=w(),this._tmpCamera=new Rt,this._tmpRayDir=w(),this._tmpCenter=w(),this._beginCamera=new Rt,this._constraintOptions=new xi(dt.ALL,Ne.ZOOM,null,this._beginCamera)}step(e,t){if(!this.running)return;let i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);let r=tn(this.view.state.viewingMode),n=!1;e>0?(n=this._intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?Cs:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ee(this._zoomLocation,this._tmpCamera.center);let s=_J**e,o=this.view._stage.renderView.getMinimalDepthForArea(Xl(this.view),t[0],t[1],this.view.state.camera,vJ);ve(xE,this._tmpCamera.eye,this._zoomLocation),ne(xE,xE);let a=q(Math.min(pE,1/Math.abs(ae(wJ,xE)))*Math.abs(this.view.camera.position.z),mE,fE);if(o=o??a,o){let l=w();ve(l,this._zoomLocation,this._tmpCamera.eye),(o<xe(l)||!n)&&(ne(l,l),he(this._zoomLocation,this._tmpCamera.eye,X(l,l,o)))}this._updateCamera(this._tmpCamera,s,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:ku}}_updateCamera(e,t,i){ve(this._tmpRayDir,i,e.eye);let r=xe(this._tmpRayDir),n=r*t,s=t<=1,o=Math.max(yJ,1.01*e.nearFar[0]);n!==0&&(s&&n<o&&(n=o,t=n/r),Math.abs(r-n)<1e-6||(X(this._tmpRayDir,this._tmpRayDir,t),e.eye=ve(tq,i,this._tmpRayDir),e.center=ni(tq,e.center,i,1-t),Pt(this.view,e,this._constraintOptions)))}};Hf=u([C("esri.views.3d.state.controllers.ZoomStepControllerLocal")],Hf);var tq=w(),wJ=yt(0,0,1),xE=w();var ME=class extends rt{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){let i=t.data;if(my(i,"primary")){let r=this._view.state.isGlobal?new Vf({view:this._view,mode:"animation"}):new Hf({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.step(Math.log(.5)/Math.log(.6),Kt(i.x,i.y)),t.stopPropagation()}}};function nq(e,t,i){return e===Se.Global?new VP(i):new kP(t,i)}var kP=class{constructor(t,i){this._elevationProvider=t,this._referenceEllipsoid=_t(i),this._unitInMeters=Pg(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,n,s){s||(s={near:0,far:0});let o=t[2]*this._unitInMeters,a=o,l=o-n,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);let h={x:(r=r??new Vi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);ve(Zh,i,t),Bf[0]=Zh[0]>0?r.xmax:r.xmin,Bf[1]=Zh[1]>0?r.ymax:r.ymin,Bf[2]=Zh[2]>0?p/2:-p/2,ve(Bf,Bf,t),ne(Zh,Zh);let m=1.1*ae(Bf,Zh)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=g*TJ*this._unitInMeters,v=g*EJ*this._unitInMeters,b=q((o-v)/(_-v),0,1)**3,x=Math.min(Xe(f,m,b),f)*Math.max(Math.log(Math.abs(l)),1);return sq(Math.min(x,Math.max(34064e4,p))/this._unitInMeters,SE,this._unitInMeters,s)}},VP=class{constructor(t){this._referenceEllipsoid=_t(t)}compute(t,i,r,n,s){s||(s={near:0,far:0});let o=xe(t),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),m=o+this._referenceEllipsoid.radius,f=1.2*Xe(p,m,fm(h)),g=(Math.log(h)-iq)/(bJ-iq);return sq(f,q(SE-g*(SE-rq),rq,SE),1,s)}};function sq(e,t,i,r){let n=CJ/i,s=e/t;return s>n?(r.far=e,r.near=s):(r.near=n,r.far=r.near*t),r}var iq=7.983,bJ=16.994,SE=2e4,rq=100,CJ=2,TJ=.001,EJ=1e-4,Bf=w(),Zh=w();var Vy=class extends P{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;let t=this.view.state.camera;e.spatialReference!=null&&Sw(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>Oo(this.view,e,Dn.EYE_AND_CENTER))}};u([d({constructOnly:!0})],Vy.prototype,"view",void 0),Vy=u([C("esri.views.3d.state.SurfaceCollisionConstraint")],Vy);var Uf=class extends P{constructor(e){super(e),this.nearFarHeuristic=nq(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([S(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),S(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),S(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Fe),S(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Fe),S(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Fe),S(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Fe),S(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Fe),S(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Fe)]),this.view.state.isLocal&&this.addHandles(S(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Re)),this._updateNearFar(),this.view.state.viewingMode!==Se.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Vy({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){let e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(t=>oq(t,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){let t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?oq(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,nm(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCollision(){let e=this.view.map?.ground?.navigationConstraint?.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(dt.COLLISION);let r=this.view.constraints&&this.view.constraints.tilt;r&&r.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){let e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Se.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){let e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){let e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){let t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Vt(e.max))}_updateTiltAuto(){let e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){let e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;let t=this.view.state.constraints;if(t.tilt){let i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Hl(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));let i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=dt.ALL){this.view.state.updateCamera(t=>Pt(this.view,t,new xi(e,Ne.NONE,null)))}};function oq(e,t){t&&(e.near=t.near,e.far=t.far)}u([d({constructOnly:!0})],Uf.prototype,"view",void 0),u([d({readOnly:!0})],Uf.prototype,"surfaceCollisionConstraint",void 0),Uf=u([C("esri.views.3d.state.ConstraintsManager")],Uf);var Qh=class extends No{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ht.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Sw(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),Oo(this.view,e,Dn.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ht.Stopped)})}};u([d({constructOnly:!0})],Qh.prototype,"desiredCamera",null),Qh=u([C("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Qh);var DJ=.66;function lq(e){return 360-hM.normalize(e)}function OE(e){return hM.normalize(360-e)}function cq(e,t,i){let r=t.camera;if(r!=null)return MJ(r,TM(e));let{targetGeometry:n}=t;if(n==null)return null;let{camera:s,mode:o}=uq(e,t.rotation,i);if(n.type==="point")return IJ(e,t,n,s,o);let a=n.extent;return a==null?null:sm(e,a,s.heading,s.tilt,o)}async function xJ(e,t,i,r){let n=t.camera;if(n!=null)return SJ(n,TM(e),r);let{targetGeometry:s}=t;if(s==null)throw new Error("Viewpoint has no targetGeometry!");let{camera:o,mode:a}=uq(e,t.rotation,i);if(s.type==="point")return AJ(e,t,s,o,a,r);let l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return xM(e,l,o.heading,o.tilt,a,r)}function MJ(e,t){let i=e.position,r;try{r=Zx(i,t)}catch{return null}if(!r)return null;let n=e.clone();return n.position=r.clone(),n}async function SJ(e,t,i){let r=e.position,n=await Dd(r,t,{signal:i});Bt(i);let s=e.clone();return s.position=n.clone(),s}function uq(e,t,i){let r=uu(e,e.state.camera),n=as.ADJUST;return t!=null&&(r.heading=lq(t),n=as.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:n}}function IJ(e,t,i,r,n){let s=e.spatialReference,o;try{o=Zx(i.clone(),s)}catch{return null}if(!o)return null;let a=t.scale!=null?EM(e,t.scale):e.state.camera.distance;return s3(e,o,a,r,n)}async function AJ(e,t,i,r,n,s){let o=e.spatialReference,a=await Dd(i.clone(),o,{signal:s});Bt(s);let l=t.scale!=null?EM(e,t.scale):e.state.camera.distance;return Aw(e,a,l,r,n,s)}function dq(e,t,i=null){return i==null&&(i=new Si),GP(e,null,t.clone(),i)}async function hq(e,t,i){let r=BJ(e,t);if(!r)throw new Be("viewpointutils-create:no-target","Missing target for creating viewpoint");let n=new Fn({fov:e.camera.fov}),s=new Si({camera:n});if(r.target instanceof Si)return Yh(await OJ(e,r.target,r,i,s));if(r.target instanceof Fn)return Yh(await mq(e,r.target,i,s));let o=r.scale!=null||r.zoom!=null;if(r.target instanceof Vi){let c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Yh(o||c?await UP(e,r,r.target.center,n,i,s):await kJ(e,r,r.target,n,i,s))}let a=new jP,l=o?RJ(e,r):void 0;if(await pq(e,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(fL(a.boundingBox,Ni),$s.x=Ni[0],$s.y=Ni[1],$s.z=Ni[2],$s.spatialReference=e.spatialReference,isFinite($s.z)&&a.hasZ?c=yL(a.boundingBox):($s.z=void 0,c=G2(_L(a.boundingBox,jJ))),o||c)return Yh(await UP(e,r,$s,n,i,s));let h=UJ(e,a.screenSpaceObjects);return Yh(await HJ(e,r,$s,a.boundingBox,h,n,i,s))}return r.position?Yh(await LJ(e,r,n,s,i)):Yh(await FJ(e,r,n,i,s))}function zP(e,t){return t.scale==null&&t.zoom!=null?Pw(e,t.zoom):t.scale}function RJ(e,t){let i=zP(e,t);return i?uF(i):void 0}function NE(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=lq(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function GP(e,t,i,r){let n=e.spatialReference||Qt.WGS84;if(t??=vo(e,i),t==null)return r;let s=new pt({spatialReference:n});return cM(t.center,e.renderSpatialReference,s)&&(r.targetGeometry=s,r.scale=du(e,t.distance),r.rotation=OE(i.heading),r.camera=i),r}async function RE(e,t,i,r){let n=()=>new Be("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw n();t.type==="mesh"&&(t=t.extent);let s=e.basemapTerrain.spatialReference;if(!t.hasZ&&e.basemapTerrain){let p;switch(t.type){case"point":p=t;break;case"multipoint":case"polyline":p=t.extent?.center;break;case"extent":p=t.center;break;case"polygon":p=t.centroid}p!=null&&s&&e.elevationProvider?(p=await Dd(p,s,{signal:r}),Ni[2]=e_(e.elevationProvider,p)??0):Ni[2]=0}let o=zJ[t.type],a=new Array;if(o(t,t.hasZ?p=>{a.push([p[0],p[1],p[2]])}:p=>{a.push([p[0],p[1]])},Ni),a.length===0)throw n();let l=t.spatialReference,c=e.spatialReference,h=await Dd(new lL({spatialReference:l,hasZ:t.hasZ,hasM:!1,points:a}),c,{signal:r});if(t.hasZ&&(i.hasZ=!0),t.hasZ)for(let[p,m,f]of h.points)Ni[0]=p,Ni[1]=m,Ni[2]=f,C0(i.boundingBox,Ni);else for(let[p,m]of h.points)Ni[0]=p,Ni[1]=m,C0(i.boundingBox,Ni)}async function PJ(e,t,i,r,n){let s=await Ag(e.whenViewForGraphic(t));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await RE(e,t.geometry,r,n);let o=s.value,a=await Ag(o.whenGraphicBounds(t,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await RE(e,t.geometry,r,n);let{screenSpaceObjects:l,boundingBox:c}=a.value;dL(r.boundingBox,c),l&&l.forEach(h=>{r.screenSpaceObjects.push(h)}),isFinite(c[2])&&(r.hasZ=!0)}async function pq(e,t,i,r,n){if(Array.isArray(t)&&t.length===2){let s=t[0],o=t[1];if(typeof s=="number"&&typeof o=="number")return $s.x=s,$s.y=o,$s.z=void 0,$s.spatialReference=e.spatialReference?.isGeographic?e.spatialReference:Qt.WGS84,void await RE(e,$s,r,n)}t&&"map"in t&&typeof t.map=="function"?await Promise.allSettled(t.map(s=>pq(e,s,i,r,n))):t instanceof S2?await RE(e,t,r,n):t instanceof rs&&await PJ(e,t,i,r,n)}async function OJ(e,t,i,r,n){if(t.camera)return mq(e,t.camera,r,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=t.targetGeometry!=null?t.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=OE(i.heading):i.rotation!=null&&(n.rotation=i.rotation);let s=zP(e,i);return s!=null&&(n.scale=s),n.camera=await xJ(e,n,i.tilt,r),n}async function mq(e,t,i,r){let n=e.spatialReference,s=await Dd(t.position,n,{signal:i}),o=t.clone();return o.position=s,GP(e,null,o,r)}async function NJ(e,t,i,r,n,s,o){let a=e.renderSpatialReference;return await F0(t,HP,a,0,{signal:o}),await F0(i,AE,a,0,{signal:o}),s.targetGeometry=new pt(t),n.position=new pt(i),ve(PE,HP,AE),DM(e,AE,PE,r.up,n),s.scale=du(e,ui(AE,HP)),s.rotation=OE(n.heading),s.camera=n,s}async function UP(e,t,i,r,n,s){s.targetGeometry=i.clone();let o=cu(e);if(t.position)return NJ(e,s.targetGeometry,t.position,o,r,s,n);if(t.zoomFactor){let l=o.distance/t.zoomFactor,c=X(Ni,o.viewForward,-l);o.eye=he(Ni,o.center,c),s.scale=du(e,l)}uu(e,o,r);let a=NE(r,t)?as.LOCKED:as.ADJUST;if(!t.zoomFactor){let l=zP(e,t);if(l==null){await F0(s.targetGeometry,Ni,e.renderSpatialReference,0,{signal:n});let c=Ld(o.frustum,Ni)?ui(o.eye,Ni):o.distance;s.camera=await Aw(e,s.targetGeometry,c,r,a),s.scale=du(e,c)}else s.scale=l,s.camera=await n3(e,s.targetGeometry,s.scale,r,a,n)}return s}async function LJ(e,t,i,r,n){let s=cu(e);ee(PE,s.viewForward),DM(e,s.eye,PE,s.up,BP);let o=e.spatialReference,{position:a}=t;if(a){let l=await Dd(a,o,{signal:n});i.position=l}else i.position=new pt;return i.heading=t.heading!=null?t.heading:BP.heading,i.tilt=t.tilt!=null?t.tilt:BP.tilt,GP(e,null,i,r)}async function FJ(e,t,i,r,n){if(t.heading!=null||t.rotation!=null||t.scale!=null||t.tilt!=null||t.zoom!=null||t.zoomFactor!=null){let s=cu(e),{spatialReference:o,renderSpatialReference:a}=e,l=new pt({spatialReference:o});return cM(s.center,a,l)?UP(e,t,l,i,r,n):n}return n.scale=e.scale,n.camera=e.camera.clone(),NE(n.camera,t),n}async function kJ(e,t,i,r,n,s){s.targetGeometry=i.clone();let o=cu(e);uu(e,o,r);let a=NE(r,t)?as.LOCKED:as.ADJUST;return s.camera=await xM(e,i,r.heading,r.tilt,a,n),s}function VJ(e,t,i,r,n){let s=0;i.z!=null?s=i.z:e.basemapTerrain&&e.elevationProvider&&(s=e_(e.elevationProvider,i)),Te(Ni,i.x,i.y,s),GL(e.spatialReference,Ni,aq,e.renderSpatialReference),Lp(IE,aq),Qc(IE,IE),zl(Hy);let o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){let _=o[g],v=r[_[2]];isFinite(v)||(v=s),Te(Ni,r[_[0]],r[_[1]],v),Ua(Ni,e.spatialReference,Ni,e.renderSpatialReference),C0(Hy,ts(Ni,Ni,IE))}let a=hL(Hy),l=mL(Hy),c=pL(Hy),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),m=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,f=.5*l*p+.5*Math.max(a,c);return Math.max(m,f)/n}async function HJ(e,t,i,r,n,s,o,a){a.targetGeometry=i.clone();let l=cu(e),c=VJ(e,l,i,r,n);uu(e,l,s);let h=NE(s,t)?as.LOCKED:as.ADJUST;return a.camera=await Aw(e,a.targetGeometry,c,s,h,o),a.scale=du(e,c),a}function BJ(e,t){if(!t||!e.spatialReference)return null;let i={target:void 0};return"declaredClass"in t||Array.isArray(t)?i.target=t:(Object.assign(i,t),!i.target&&"center"in t&&t.center&&(i.target=t.center)),i}function Yh(e){return e?.camera!=null&&(e.rotation=OE(e.camera.heading)),e}function UJ(e,t){let i=DJ;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){let s=t[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(e.width,e.height)*2}var jP=class{constructor(){this.hasZ=!1,this.boundingBox=zl(),this.screenSpaceObjects=new Array}},Ni=w(),aq=$t(),IE=Nn(),Hy=Wc(),jJ=Yt(),PE=w(),AE=w(),HP=w(),BP={heading:0,tilt:0},$s=new pt,zJ={point(e,t,i){i[0]=e.x,i[1]=e.y,e.z!=null&&(i[2]=e.z),t(i)},polygon(e,t,i){let r=e.hasZ;for(let n=0;n<e.rings.length;n++){let s=e.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),t(i)}},polyline(e,t,i){let r=e.hasZ;for(let n=0;n<e.paths.length;n++){let s=e.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),t(i)}},multipoint(e,t,i){let r=e.points,n=e.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),t(i)},extent(e,t,i){e.zmin!=null&&e.zmax!=null?(t(Te(i,e.xmin,e.ymin,e.zmin)),t(Te(i,e.xmax,e.ymin,e.zmin)),t(Te(i,e.xmin,e.ymax,e.zmin)),t(Te(i,e.xmax,e.ymax,e.zmin)),t(Te(i,e.xmin,e.ymin,e.zmax)),t(Te(i,e.xmax,e.ymin,e.zmax)),t(Te(i,e.xmin,e.ymax,e.zmax)),t(Te(i,e.xmax,e.ymax,e.zmax))):(t(Te(i,e.xmin,e.ymin,i[2])),t(Te(i,e.xmax,e.ymin,i[2])),t(Te(i,e.xmin,e.ymax,i[2])),t(Te(i,e.xmax,e.ymax,i[2])))}};var LE=class{constructor(t,i,r){this._target=t,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;let o=new AbortController;this._options.signal!=null&&so(this._options.signal,()=>this.abort()),this._abortController=o,this._waitForReady()})}_resolve(t){if(this.state!=="finished")return this.state="finished",this._resolveCallback(t)}_reject(t){if(this.state!=="finished")return this.state="finished",this._rejectCallback(t)}abort(t=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!t&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController(),this._reject(Sr())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Zo(()=>this.view.ready,this._abortController.signal)}catch(t){return this._reject(t)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{let t=await hq(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;let i=t?this._getCameraFromViewpoint(t):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(t){this._reject(t)}}}_getCameraFromViewpoint(t){let i=!!(this._target instanceof Si&&this._target.camera||this._target instanceof Fn),r=t.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){let s=r.position,o=s&&s.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this._reject(new Be("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}let n=vo(this.view,r);return n==null?(this._reject(new Be("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:n,isFullySpecified:i}}_startAnimation(t,i){this.state="wait-for-animation-finish";let r=i.viewAnimation;if(r==null)return void this._reject(new Be("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.running||i.viewAnimation==null||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;t.isFullySpecified?(n=new Qh({view:this.view,desiredCamera:t.camera}),Oo(this.view,t.camera,Dn.EYE_AND_CENTER)):Pt(this.view,t.camera),i.begin(t.camera,this._options);let s=()=>{let a=this.view.state.cameraController;n&&(a&&a.running?xP(a)&&a.viewAnimation!=null&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===t.viewpoint&&i.state===Ht.Finished&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(i.state){case Ht.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Ht.Ready:case Ht.Rejected:case Ht.Running:case Ht.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t=null,i=null,r=this.view.state.cameraController;return xP(r)&&(r.updateStateFromViewAnimation(),r.running&&(t=r,i=t.viewAnimation)),t==null&&(t=new fl({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t),t.state===Ht.Rejected)?(i?.stop(),this._reject(new Be("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null):t}};var Li=class extends P{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=fq,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(t){this.viewStateManager._idleTimeout=t?fq:0}},this._propertiesPool=new kn({frustum:Iw},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new $P}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([ir(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),S(()=>this.view.state?.camera,(e,t)=>this._cameraChangedHandler(e,t),Fe)]),Wi(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Kr({prepare:()=>this._prepareFrame()}),S(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(kE)}),ir(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=G(this._propertiesPool)}get camera(){let e=this._get("camera");if(!this.ready)return e;let t=uu(this.view,this.view.state.camera,qP);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(vo(this.view,e),{applyConstraints:!1})||W.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){let e=this._get("contentCamera");if(!this.ready)return e;let t=uu(this.view,this.view.state.contentCamera,qP);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;let t=vo(this.view,e);t!=null?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(WP),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;let t=this.zoom,i=this.view.state.camera.distance**2,r=$2(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([S(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(WP),this.test.contentCameraResetState.clear())}),S(()=>this.zoom,s=>{s!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(s-t)/2),Math.abs(s-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),S(()=>this.view.state.camera,s=>{let o=po(r,s.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],WP),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():W.getLogger(this).error("#center=","Invalid center",e):W.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):W.getLogger(this).error("#center=","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){let e=this._get("extent");return e?Rp.fromExtent(e):null}return a3(this.view,this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");let e=this.view,t=Rw(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return t??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||W.getLogger(this).error("#extent=","Invalid extent",e):W.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):W.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){let e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){let e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");let e=this.view.basemapTerrain.tilingScheme,t=this.view.pointsOfInterest.cameraOnSurface.scale;return e&&t?i3(this.view,t,this.view.state.contentCamera,e):this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||W.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");let e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),n=Math.round(t[en.TOP]/i),s=Math.round(t[en.RIGHT]/i),o=Math.round(t[en.BOTTOM]/i),a=Math.round(t[en.LEFT]/i);return r!=null&&r.top===n&&r.right===s&&r.bottom===o&&r.left===a?r:{top:n,right:s,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,FE),this.view.state.updateCamera(t=>t.padding=FE))}_paddingToArray(e,t,i){e?ho(i,e.top||0,e.right||0,e.bottom||0,e.left||0):ho(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){let e=this.padding;return Zi((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?dq(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||W.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{let t=e.camera!=null?e.camera.position:e.targetGeometry,i=t!=null&&t.spatialReference;W.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else W.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?l3(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||W.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;let e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);let i=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return i&&tm(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(bo.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){let e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(bo.PhysicalPixelRendering,pi.IDLE)||e.isFeatureEnabled(bo.PhysicalPixelRendering,pi.INTERACTING)||e.isFeatureEnabled(bo.PhysicalPixelRendering,pi.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!Va(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!Va(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!Va(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||Va(this.viewpoint.targetGeometry?.spatialReference,e)&&Va(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new Uf({view:this.view}),this._prepareFrame();let e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(let t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){let t=this._initialViewpoint||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Se.Local&&this.addHandles(Wi(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(kE),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),kE)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(kE),this._constraintsManager=G(this._constraintsManager))}async goTo(e,t){return t=ie({animate:!0},t),this._gotoOperation!=null&&this._gotoOperation.abort(t.animate),this._gotoOperation=new LE(e,t,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(cu(this.view),{applyConstraints:!1})}step(e){let t=this.view.state,i=t?.cameraController;i&&(t.updateCamera(r=>i.stepController(e,r)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){let e=new Set,t=[];for(let{propertyName:i,overrides:r}of qJ){let n=e.has(i),s=this._isOverridden(i);!n&&s&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||s)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Fn)return void this.setStateCamera(vo(this.view,e),{applyConstraints:!1});if(e instanceof Si){if(e.targetGeometry instanceof Vi){let n=sm(this.view,e.targetGeometry,0,.5,as.LOCKED);return void(n!=null&&this.setStateCamera(vo(this.view,n),{applyConstraints:!0}))}let i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}let t=sm(this.view,e,0,.5,as.LOCKED);t!=null&&this.setStateCamera(vo(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&GJ.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Si?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Fn?this.isCompatible(e.position):e.spatialReference&&!ML(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=WJ){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=rd){let{heading:r,tilt:n}=this._getPreservingHeadingTilt(),s=o3(this.view,r,n,e,t,as.ADJUST);return s==null?null:(i.copyFrom(this.view.state.camera),i.eye=s.eye,i.center=s.center,i.up=s.up,i)}_centerToCamera(e){let t;if(e.hasZ)t=this.view.state.camera.distance;else{let{centerOnContent:i}=this.view.pointsOfInterest;i.runTask(),t=i.distance}return this._centerPointAtDistanceToCamera(e,t)}_extentToCamera(e){let{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=sm(this.view,e,t,i,as.ADJUST,qP);return r?vo(this.view,r):null}_scaleToCamera(e){if(e==null)return null;let t=this.view,i=t.pointsOfInterest.centerOnContent;i.runTask();let r=i.renderLocation,n=t.pointsOfInterest.cameraOnSurface.renderLocation,s=r3(t,e,t.state.contentCamera,r,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(Pw(this.view,e))}_viewpointToCamera(e){return vo(this.view,cq(this.view,e))}setStateCamera(e,t){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up,i.fov=e.fov):i.copyFrom(e),t.applyConstraints&&Pt(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new Qh({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){let{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;let i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height),this.view.state)){let r=this.view.state.camera;r.fullWidth===i.width&&r.fullHeight===i.height&&r.pixelRatio===i.pixelRatio||(rd.copyFrom(r),rd.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,FE),rd.padding=FE),rd.fullWidth=i.width,rd.fullHeight=i.height,rd.pixelRatio=i.pixelRatio,this.view.state.camera=rd),this._updateViewState()}}_updateElevation(e){let t=this.view.basemapTerrain?.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,r=t?nm(this.view,e.eye):0;e.relativeElevation=i-r}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=pi.ANIMATING:this.view.interacting?this.view.state.mode=pi.INTERACTING:(this.view.state.mode===pi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=pi.INTERACTING:this.view.state.mode=pi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:Fn,dependsOn:["view.state.camera","ready"]})],Li.prototype,"camera",null),u([d({type:Fn,dependsOn:["view.state.contentCamera","ready"]})],Li.prototype,"contentCamera",null),u([d({type:pt})],Li.prototype,"center",null),u([d()],Li.prototype,"visibleArea",null),u([d({type:Vi})],Li.prototype,"extent",null),u([d({readOnly:!0})],Li.prototype,"frustum",null),u([d()],Li.prototype,"_constraintsManager",void 0),u([d({readOnly:!0})],Li.prototype,"constraintsManager",null),u([d()],Li.prototype,"_initialViewpoint",null),u([d({readOnly:!0})],Li.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],Li.prototype,"ready",void 0),u([d({type:Number})],Li.prototype,"scale",null),u([d()],Li.prototype,"padding",null),u([d({readOnly:!0})],Li.prototype,"screenCenter",null),u([d({constructOnly:!0})],Li.prototype,"view",void 0),u([d({type:Si})],Li.prototype,"viewpoint",null),u([d({type:Number})],Li.prototype,"zoom",null),u([d({readOnly:!0})],Li.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],Li.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],Li.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],Li.prototype,"_windowDevicePixelRatio",void 0),u([d()],Li.prototype,"_devicePixelRatioOverride",void 0),Li=u([C("esri.views.3d.state.ViewStateManager")],Li);var $P=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}},GJ=new Set(["camera","viewpoint","extent","scale","center","zoom"]),qJ=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],WJ={heading:0,tilt:0},qP=new Fn,rd=new Rt,FE=Qi(),kE="pending-initial-view",WP="content-camera-reset",fq=300,ZP=100;var Qr=class extends No{constructor(){super(...arguments),this.startCamera=new Rt,this.currentCamera=new Rt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<ZP}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ht.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),ZP),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],Qr.prototype,"isInteractive",null),u([d()],Qr.prototype,"_lastInteraction",void 0),Qr=u([C("esri.views.3d.state.controllers.InteractiveController")],Qr);var an;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(an||(an={}));var Kh=class extends Qr{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=an.CENTER,this._rotScale=0,this._lastPoint=Hi(),this._tmpWorldUp=w(),this._tmpViewDir=w(),this._tmpRotCurPoint=Hi(),this._tmpTransf=$t(),this._tmpAxis=w(),this._tmpPivotPoint=w(),this._pivotPos=w(),this._constraintOptions=new xi(dt.ALL,Ne.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===an.CENTER?3:1.5}begin(e){if(this.running){switch(this.pivot){case an.EYE:ee(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Ne.LOOK_AROUND,this._constraintOptions.tiltMode=ws.LOOK_AROUND,this._constraintOptions.selection=dt.NONE;break;case an.CENTER:{let t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Cs:{});t||ee(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Ne.TUMBLE,this._constraintOptions.tiltMode=ws.TUMBLE,this._constraintOptions.selection=dt.ALL&~dt.DISTANCE;break}}_l(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){let i=this.startCamera,r=w();ve(r,this._pivotPos,i.eye);let n=xe(r),s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,gq);let o=Math.max(Math.min($G,1/Math.abs(ae(gq,i.viewForward)))*s,ZG);t&&(o=Math.min(n,o));let a=Kt(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=yl(this.startCamera,a,this.view.renderCoordsHelper,this.view.viewingMode),c=this.view._stage.renderView.getMinimalDepthForArea(Xl(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*yE,yE),h=this.view._stage.renderView.getMinimalDepthForArea(Xl(this.view),e[0],e[1],i,yE);c==null&&h==null||(c=c??h??0,h=h==null||l===er.Horizontal?c:h,o=c>h?h:c,o=t?Math.min(o,n):o),ne(r,r),ee(this._pivotPos,he(this._tmpPivotPoint,i.eye,X(this._tmpPivotPoint,r,o)))}update(e){if(this.running){switch(this.pivot){case an.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case an.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Pt(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this._tmpWorldUp),_l(e,t,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,s=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ve(this._tmpViewDir,i,r);let o=xe(this._tmpViewDir),a=oo(ae(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===an.EYE){n*=-.5;let l=.5*Math.PI-a,c=.5*Math.PI*.99;n=l-Math.max(-c,Math.min(c,l+n))}return n=q(n+a,gr.min,gr.max)-a,At(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===an.CENTER&&(s=-s),uo(this._tmpTransf,s,this._tmpWorldUp),co(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),si(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=si(QP,e.up,this._tmpTransf),he(QP,r,this._tmpViewDir),Yi(this._lastPoint,this._tmpRotCurPoint),QP}};u([d()],Kh.prototype,"pivot",void 0),Kh=u([C("esri.views.3d.state.controllers.RotateController")],Kh);var QP=w(),gq=w();var jf=class extends rt{constructor(t,i,r,n){super(!0),this._view=t,this.pointerActions=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(t){let i=t.data;if(i.pointers.size>1||!cf(t.data,this.pointerActions))return;let r=Kt(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Kh({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}};var VE="esri-fov-overlay",HE={base:VE,outer:`${VE}-outer`,reset:`${VE}-reset`,text:`${VE}-text`},vl=class extends La{constructor(e){super(e),this.onReset=()=>{},this._messagesCommon=null,this._messagesUnits=null,this.fov=null}render(){return $i("div",{class:HE.outer},$i("div",{class:HE.base},$i("p",{class:HE.text},this._overlay),$i("p",{class:HE.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){let{fov:e,_messagesUnits:t}=this;if(!t||e==null)return"";let i=Lk(Hl(e),"degrees","arithmetic","arithmetic",0),r=$J/(2*Math.tan(e/2));return`${i} | ${Nk(t,r,"millimeters",0,"abbr")} |`}get _reset(){return this._messagesUnits&&this.fov!=null?"\u21BA":""}};u([d()],vl.prototype,"onReset",void 0),u([d(),Qo("esri/t9n/common")],vl.prototype,"_messagesCommon",void 0),u([d(),Qo("esri/core/t9n/Units")],vl.prototype,"_messagesUnits",void 0),u([d()],vl.prototype,"fov",void 0),u([d()],vl.prototype,"_overlay",null),u([d()],vl.prototype,"_reset",null),vl=u([C("esri.widgets.FovOverlay")],vl);var $J=Math.sqrt(1872);var nd=class extends Qr{constructor(e){super(e),this.onStop=null,this._timeOutId=void 0,this._onReset=()=>{this._startSize=this._lastDrag=null,this._setFov(ZJ),this.updateTimeout()},this._center=w(),this._viewForward=w(),this._constraints=new xi(dt.ALL,Ne.ZOOM)}begin(e){KJ(e)?this._showOverlay().fov=e.fov:(this._lastDrag=e[1],this._startSize=null,this._ensureStartSize(this.view.state.camera))}updateTimeout(){clearTimeout(this._timeOutId),this._timeOutId=setTimeout(this.onStop,1500)}update(e){if(this._lastDrag==null)return this._lastDrag=e[1],this._startSize=null,void this._ensureStartSize(this.view.state.camera);let t=-(this._lastDrag-e[1])/2;this._lastDrag=e[1],this.step(t)}step(e){if(!this.running)return void(this._startSize=this._lastDrag=null);let t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=Hl(i.fov)+e,n=Vt(q(r,QJ,YJ));n!==i.fov?this._setFov(n):this._showOverlay().fov=i.fov}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(e){super.onControllerEnd(e),this._startSize=this._lastDrag=null,this.hideOverlay()}_showOverlay(){return this._overlay||(this._overlay=new Vu({id:"esri.FovOverlay",node:new vl({onReset:this._onReset})}),this.view.ui.add(this._overlay)),this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=G(this._overlay))}_setFov(e){let t=this.view.state,i=this.currentCamera.copyFrom(t.camera),r=this._ensureStartSize(i)/Math.tan(e/2),n=he(YP,this._center,X(YP,this._viewForward,-r));i.eye=n,i.fov=e,this._constraints.interactionStartCamera=t.camera,this._constraints.interactionFactor=on(this.currentCamera.height-t.camera.height),Pt(this.view,this.currentCamera,this._constraints),this.begin(i),this.commitCamera()}_ensureStartSize(e){if(this._startSize==null){ee(this._viewForward,e.viewForward);let t=this.view._stage.renderView.getMinimalDepthForArea(null,e.fullWidth/e.pixelRatio*.5,e.fullHeight/e.pixelRatio*.5,e,gl),i=ui(e.eye,this.view.pointsOfInterest.centerOnContent.renderLocation),r=t??i;he(this._center,e.eye,X(YP,this._viewForward,r)),this._startSize=r*Math.tan(e.fov/2)}return this._startSize}};u([d()],nd.prototype,"onStop",void 0),nd=u([C("esri.views.3d.state.controllers.FovController")],nd);var ZJ=Vt(new Fn().fov),QJ=10,YJ=150,YP=w();function KJ(e){return!Array.isArray(e)}var UE=class extends Qr{constructor(){super(...arguments),this._pickPoint=w(),this._tmpP0=Hi(),this._panAxisAngle=qh(),this._tmpRayDir=w(),this._tmpRayDirPick=w(),this._targetOnSphere=w(),this._navMode=er.Horizontal,this._tmpRay={origin:w(),direction:w()},this.dragBeginPoint=Kt(),this._normalizedAnchorPoint=Hi(),this._constraintOptions=new xi(dt.ALL_EXCEPT_COLLISION,Ne.ZOOM,0,this.startCamera),this._sphere=ur(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Yi(this.dragBeginPoint,e),_l(this.startCamera,e,this._normalizedAnchorPoint);let t=_t(this.view.spatialReference),i=bE(this._intersectionHelper,this.startCamera,e,t,td.Ellipsoid,this.view.map.ground.opacity===0?Cs:{});if(this._navMode=yl(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===er.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let r;Qa(this.startCamera,e,this._tmpRay),ne(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ve(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),r=xe(this._tmpRayDirPick));let n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,_q);let s=q(Math.min(hE,1/Math.abs(ae(_q,this._tmpRay.direction)))*n,Ff[0],Ff[1]),o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,gl);s=o??s,s=r!=null?Math.min(s,r):s,this._hasPickPoint=!0,X(this._tmpRay.direction,this._tmpRay.direction,s),he(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.running){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===er.Horizontal){ve(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);let t=xe(this._tmpRayDir);_l(this.currentCamera,e,this._tmpP0);let i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),r=t*2**i,n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;if(this._hasPickPoint&&r<t){let s=1-(1-r/t)*(1-this._sphere[3]/xe(this.currentCamera.center));this.currentCamera.center=X(BE,this.currentCamera.center,s)}X(this._tmpRayDir,this._tmpRayDir,-r/t),this.currentCamera.eye=he(BE,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=on(ea(this.dragBeginPoint,e)),Pt(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(id(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Pf(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Ws(this.currentCamera,this._sphere,this._panAxisAngle))}else{let t=xe(this._tmpRay.direction);_l(this.currentCamera,e,this._tmpP0);let i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),r=t*2**i,n=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<n&&(r=n),Math.abs(t-r)<1e-6)return;X(this._tmpRayDir,this._tmpRay.direction,1-r/t),this.currentCamera.eye=he(BE,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=he(BE,this.currentCamera.center,this._tmpRayDir)}Oo(this.view,this.currentCamera),this.commitCamera()}}finish(){this.running&&this.finishController()}};UE=u([C("esri.views.3d.state.controllers.ZoomControllerGlobal")],UE);var BE=w(),_q=w();var jE=class extends Qr{constructor(){super(...arguments),this._tmpP=w(),this._tmpDir=w(),this._tmpN=w(),this._tmpP0=Hi(),this._tmpPoi=w(),this._tmpRayDir=w(),this.dragBeginPoint=Kt(),this._normalizedAnchorPoint=Hi(),this._constraintOptions=new xi(dt.ALL,Ne.ZOOM,0,this.startCamera,w()),this._plane=Wl()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;Yi(this.dragBeginPoint,e),_l(this.startCamera,e,this._normalizedAnchorPoint);let t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Cs:{});ve(this._tmpDir,this._tmpP,this.startCamera.eye);let i=xe(this._tmpDir);ne(this._tmpDir,this._tmpDir);let r=Math.abs(this.view.camera.position.z),n=q(Math.min(hE,1/Math.abs(ae(XJ,this._tmpDir)))*r,Ff[0],Ff[1]),s=this.view._stage.renderView.getMinimalDepthForArea(Xl(this.view),e[0],e[1],this.view.state.camera,gl);n=s??n,n=t?Math.min(n,i):n,X(this._tmpDir,this._tmpDir,n),he(this._tmpP,this.startCamera.eye,this._tmpDir),ve(this._tmpN,this.startCamera.eye,this.startCamera.center),ne(this._tmpN,this._tmpN),this._tmpN[1]<0&&Rs(this._tmpN,this._tmpN),G0(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.running)return;QG(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ee(this._tmpPoi,this.currentCamera.center),_l(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Yi(this._normalizedAnchorPoint,this._tmpP0),ve(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);let i=xe(this._tmpRayDir),r=i*(1-t);this._constraintOptions.interactionDirection&&(ee(this._constraintOptions.interactionDirection,this._tmpRayDir),X(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/i));let n=this.view.state.constraints.minimumPoiDistance;t>=0&&r<n&&(r=n,t=-(r-i)/i),Math.abs(i-r)<1e-6||(X(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=he(Xh,this.currentCamera.eye,this._tmpRayDir),ni(Xh,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?Xh[2]=Math.max(this.startCamera.center[2],Xh[2]):Xh[2]=Math.min(this.startCamera.center[2],Xh[2]),this.currentCamera.center=Xh,this._constraintOptions.interactionFactor=on(ea(this.dragBeginPoint,e)),Pt(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}finish(){this.running&&this.finishController()}};jE=u([C("esri.views.3d.state.controllers.ZoomControllerLocal")],jE);var Xh=w(),XJ=yt(0,0,1);var zE=class extends rt{constructor(t,i,r){super(!0),this._view=t,this.pointerActions=i,this._fovModifier=r,this.registerIncoming("drag",[r],n=>this._handleZoom(n)),this.registerIncoming("drag",n=>this._handleZoom(n))}_handleZoom(t){let i=t.data;if(i.pointers.size>1||!cf(t.data,this.pointerActions))return;let r=Kt(i.center.x,i.center.y);switch(i.action){case"start":{this._cameraController?.finish();let n=this._view,s=t.modifiers.has(this._fovModifier);this._cameraController=s?new nd({view:n,onStop:()=>this._stopController()}):n.state.isGlobal?new UE({view:n}):new jE({view:n}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break}case"update":this._cameraController?.update(r);break;case"end":this._cameraController instanceof nd?this._cameraController.updateTimeout():this._stopController()}t.stopPropagation()}_stopController(){this._cameraController?.finish(),this._cameraController=null}};var Ic=class extends Qr{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Rt,this._headingStart=0,this._constraintOptions=new xi(dt.ALL,Ne.NONE,0,new Rt,null,ws.LOOK_AROUND)}handleEventGamepad(e){let t=gy(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||uf(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,CR(this._keysButtonState,this._transformation)}directionActive(e){return this._keysButtonState[e]===1}countActiveDirections(){return this._keysButtonState.reduce((e,t)=>t>0?e+1:e,0)}deactivateDirection(e){this._keysButtonState[e]=0;let t=CR(this._keysButtonState,this._transformation);uf(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){let t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Jh),this._applyDisabledMovementTypes(Jh),this._applyPan(Jh.pan),this._applyRotate(Jh.rotate),this._applyZoom(Jh.zoom),this._applyAscend(Jh.ascend),this._constraintOptions.interactionType=Ne.NONE,this._constraintOptions.selection=dt.COLLISION,Pt(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;let t=this.currentCamera;ve(Gn,t.center,t.eye),si(Gn,Gn,e.matrix),t.center=he(Gn,Gn,t.eye),t.up=si(Gn,t.up,e.matrix),this._constraintOptions.interactionType=Ne.LOOK_AROUND,this._constraintOptions.selection=dt.ALL_EXCEPT_COLLISION,Pt(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=si(Gn,t.eye,e.matrix),t.center=si(Gn,t.center,e.matrix),this.view.state.isGlobal&&(t.up=si(Gn,t.up,e.matrix)),this._constraintOptions.interactionType=Ne.PAN,this._constraintOptions.selection=dt.ALL,Pt(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;let t=this.currentCamera.viewForward;this.currentCamera.eye=he(Gn,this.currentCamera.eye,X(fi.get(),t,e)),ee(By,t),Rs(By,By),this._constraintOptions.interactionDirection=By,this._constraintOptions.interactionType=Ne.ZOOM,this._constraintOptions.selection=dt.ALL_EXCEPT_COLLISION,Pt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;let t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,fi.get());if(this._constraintOptions.interactionDirection=ee(By,t),this.view.state.isGlobal){let i=xe(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=X(Gn,this.currentCamera.eye,r),this.currentCamera.center=X(Gn,this.currentCamera.center,r)}else{let i=X(fi.get(),t,e);this.currentCamera.eye=he(Gn,this.currentCamera.eye,i),this.currentCamera.center=he(Gn,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Ne.ASCEND,this._constraintOptions.selection=dt.COLLISION,Pt(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=dt.ALL_EXCEPT_COLLISION,Pt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){see(i);let r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){let e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Gn)}_calculateControlTransformationLocal(e,t,i){let{viewRight:r,viewForward:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=Te(fi.get(),n[0],n[1],0);ne(a,a);let l=s.translation[0]*e.pan;if(l!==0){let g=X(fi.get(),r,l);zx(i.pan.matrix,i.pan.matrix,g),i.pan.enabled=!0}switch(o.mode){case"pan":{let g=-s.translation[1]*e.pan;if(g!==0){let _=X(fi.get(),a,g);zx(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}i.zoom=s.zoom*e.zoom;break}case"zoom":i.zoom=(-s.translation[1]+s.zoom)*e.zoom;break;default:o.mode}let c=s.translation[2]*e.ascend;i.ascend=c;let h=-s.heading*e.rotate;h!==0&&(co(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,fi.get())),i.rotate.enabled=!0);let p=s.tilt*e.rotate,m=la(this.view.renderCoordsHelper,t.center,t.eye),f=q(m+p,gr.min,gr.max)-m;f&&(co(i.rotate.matrix,i.rotate.matrix,f,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){let{eye:r,viewRight:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=At(fi.get(),n,r);ne(a,a),Rs(a,a),XG(this.startCamera,t,s,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Jh.pan,this._tmpCamera);let l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=s.translation[2]*e.ascend;i.ascend=c;let h=-s.heading*e.rotate;h!==0&&(co(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);let p=s.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);m!==0&&(co(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=s.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){let r=_t(this.view.spatialReference),n=ky(gr.min,t.origin,i,r),s=0,o=0,a=fi.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){let l=la(this.view.renderCoordsHelper,a,t.origin);s=ky(l,t.origin,i,r),o=ky(gr.max,t.origin,i,r)}else{Jc(jp(zp,i+r.radius),t,a);let l=Math.PI+U0(t.direction,a);s=IP(l,t.origin,i,r),o=IP(gr.max,t.origin,i,r)}return q(s+e,n,o)-s}_getPointAbsoluteSurfaceElevation(e,t,i){let{renderCoordsHelper:r}=this.view,n=r.getAltitude(e),s=t+Math.abs(n-t);return r.setAltitude(i,s,e),s}_clampedDistanceToSurface(e,t){let{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:n}=t3(this.view,t,0,vq,nee),s=i.intersectManifoldClosestSilhouette(ia(t,n),e,fi.get()),o=ui(t,s),a=i.intersectManifoldClosestSilhouette(ia(t,Np(fi.get(),t,r.center)),e,fi.get()),l=ui(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){let{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:n}=i,s=t.intersectManifoldClosestSilhouette(r.ray,this._filteredSurfaceElevation,fi.get());if(n){let o=ve(fi.get(),e,s),a=xe(o);X(o,o,1/a);let l=ne(fi.get(),e),c=oo(ae(l,o));return a*Math.sin(Math.min(eee,c))}{let o=ee(fi.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),ui(s,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:tee}_computeVelocities(e){let t=this._filteredSurfaceElevation,i=t+_t(this.view.spatialReference).radius,{camera:r,isGlobal:n}=this.view.state,s=fi.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,s),a=this._clampedDistanceToSurface(t,s),l=r.width/2,c=yq*r.width,h=yq*r.width,p=a*Math.tan(.5*r.fovX)/l,m=p/i,f=p/this._computeHeadingRotateRadius(s),g=o-t;return{pan:(n?m:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*g-g),zoom:2**(c*e/l)*a-a,rotate:q(f*h,iee,ree)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Ed(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Ed(e.rotate.matrix))}static activatesFor(e,t){let i=gy(t,e.navigation.gamepad,JJ);return!(t.action==="end"||uf(i))}};u([d({constructOnly:!0})],Ic.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],Ic.prototype,"disableMovements",void 0),Ic=u([C("esri.views.3d.state.controllers.GamepadKeyboardController")],Ic);var JJ={translation:[0,0,0],heading:0,tilt:0,zoom:0},vq=80,eee=Vt(vq),yq=.75,tee=5,iee=Vt(30),ree=Vt(80),Jh={zoom:0,ascend:0,pan:{enabled:!1,matrix:$t()},rotate:{enabled:!1,matrix:$t()}},Gn=w(),By=w(),nee=e3();function see(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Ed(e.pan.matrix),e.rotate.enabled=!1,Ed(e.rotate.matrix)}var GE=class extends rt{constructor(t){super(!0),this._view=t,this._watchHandles=new Pa,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([S(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Re),S(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){let i=this._view.navigation.gamepad.device;if(i&&t.data.device!==i)return;let r=this._cameraControllerGamepad?.running;if(r||Ic.activatesFor(this._view,t.data)){if(!r){let n=new Ic({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(n),n.state!==Ht.Rejected&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}};var Ts;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Ts||(Ts={}));var qE=class extends rt{constructor(t,i){super(!0),this._view=t,this._keyToDirection=new Map,this._keyToAction=new Map,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Se.Local},this._stickyKeyTimeoutHandle=void 0,this._stickyKeyDuration=200,this._addKeysMapping(i),this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=df(r=>r?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}setStickyKeyDuration(t){this._stickyKeyDuration=t}_addKeysMapping(t){this._addKeyMapping(t.pan.left,Ts.LEFT),this._addKeyMapping(t.pan.right,Ts.RIGHT),this._addKeyMapping(t.pan.forward,Ts.FORWARD),this._addKeyMapping(t.pan.backward,Ts.BACKWARD),this._addKeyMapping(t.pan.up,Ts.UP),this._addKeyMapping(t.pan.down,Ts.DOWN),this._addKeyMapping(t.lookAround.headingLeft,Ts.HEADINGLEFT),this._addKeyMapping(t.lookAround.headingRight,Ts.HEADINGRIGHT),this._addKeyMapping(t.lookAround.tiltUp,Ts.TILTUP),this._addKeyMapping(t.lookAround.tiltDown,Ts.TILTDOWN),this._addKeyMapping(t.zoom.zoomIn,Ts.ZOOMIN),this._addKeyMapping(t.zoom.zoomOut,Ts.ZOOMOUT),this._addKeyAction(t.reset.heading,()=>this._resetHeading()),this._addKeyAction(t.reset.tilt,()=>this._resetTilt())}_addKeyMapping(t,i){for(let r of this._eachKey(t))this._keyToDirection.set(r,i)}*_eachKey(t){typeof t=="string"?yield t:yield*t}_addKeyAction(t,i){for(let r of this._eachKey(t))this._keyToAction.set(r,i)}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;let i=this._keyToAction.get(t.data.key);if(i!=null)return t.stopPropagation(),void i();let r=this._keyToDirection.get(t.data.key);if(r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new Ic({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running)){if(t.stopPropagation(),this._cameraControllerKeyboard.directionActive(r)||(this._cameraControllerKeyboard.activateDirection(r),this._cameraControllerKeyboard.countActiveDirections()>1||!this._isPanning(r)))return;this._stickyKeyDuration>0&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0,this._stickyDirection!=null&&this._stickyDirection!==void 0&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey||!this._cameraControllerKeyboard?.running)return;let i=this._keyToDirection.get(t.data.key);if(i==null)return;t.stopPropagation();let r=this._stickyKeyTimeoutHandle===void 0;this._stickyKeyTimeoutHandle===void 0||this._cameraControllerKeyboard?.countActiveDirections()!==1?(this._cameraControllerKeyboard?.deactivateDirection(i),r&&(this._stickyDirection=void 0)):this._stickyDirection=i}_isPanning(t){return t<=3}_resetHeading(){this._view.goTo({heading:0}).catch(()=>{})}_resetTilt(){this._view.goTo({tilt:0}).catch(()=>{})}};var WE=class extends rt{constructor(t,i){super(!0),this._view=t,this.registerIncoming("mouse-wheel",[i],r=>this._handleFov(r)),this.registerIncoming("mouse-wheel",r=>this._handleZoom(r))}_handleZoom(t){if(!this._mouseWheelZoomEnabled)return;let i=t.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new Vf({view:this._view,mode:"interaction"}):new Hf({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._zoomController)),this._zoomController.step(-i.deltaY/60,Kt(i.x,i.y)),t.preventDefault(),t.stopPropagation()}_handleFov(t){this._mouseWheelZoomEnabled&&(this._fovController?.running||(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new nd({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),this._fovController.state!==Ht.Rejected)?(this._fovController.updateTimeout(),this._fovController.step(t.data.deltaY/20),t.preventDefault(),t.stopPropagation()):this._stopFovController())}get _mouseWheelZoomEnabled(){return this._view.navigation.actionMap.mouseWheel==="zoom"}_stopFovController(){this._fovController?.finish(),this._fovController=null}};var sd=class{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}};var Lo=class extends Ju{constructor(){super(...arguments),this._beginCamera=new Rt,this._elapsedTimeSec=0,this.constraintOptions=new xi(dt.ALL,Ne.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new bn}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Pt(this.view,t,this.constraintOptions)}};Lo=u([C("esri.views.3d.state.controllers.momentum.MomentumController")],Lo);var ep=class extends Lo{constructor(e){super(e),this.interactionType=Ne.PAN,this._tmpPan=w()}momentumStep(e,t){let i=this.momentum.value(e);X(this._tmpPan,this.momentum.direction,i),t.eye=ve(wq,t.eye,this._tmpPan),t.center=ve(wq,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],ep.prototype,"momentum",void 0),ep=u([C("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],ep);var wq=w();var oee=w(),$E=w(),Uy=class extends Lo{constructor(e){super(e),this.interactionType=Ne.PAN}momentumStep(e,t){let i=this.momentum.value1(e),r=this.momentum.value2(e);ee($E,t.eye),ne($E,$E),At(this.momentum.axis2,$E,this.momentum.axis1),PP(t,oee,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],Uy.prototype,"momentum",void 0),Uy=u([C("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Uy);var Ac=class extends Lo{set center(e){this._set("center",hn(e))}set axis(e){this._set("axis",hn(e))}constructor(e){super(e),this.interactionType=Ne.TUMBLE}momentumStep(e,t){let i=this.momentum.value(e);Ws(t,this.center,xc(this.axis,i))}};u([d({constructOnly:!0})],Ac.prototype,"momentum",void 0),u([d({constructOnly:!0})],Ac.prototype,"center",null),u([d({constructOnly:!0})],Ac.prototype,"axis",null),Ac=u([C("esri.views.3d.state.controllers.momentum.RotationMomentumController")],Ac);var od=class extends Lo{set zoomCenter(e){this._set("zoomCenter",hn(e))}constructor(e){super(e),this.interactionType=Ne.ZOOM,this.constraintOptions.interactionDirection=w()}momentumStep(e,t){let{interactionDirection:i}=this.constraintOptions;if(!i)return;ee(i,t.eye);let r=this.momentum.valueDelta(0,e);kf(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),Np(i,t.eye,i)}};u([d({constructOnly:!0})],od.prototype,"momentum",void 0),u([d({constructOnly:!0})],od.prototype,"zoomCenter",null),od=u([C("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],od);var ad=class extends Lo{set screenCenter(e){this._set("screenCenter",Kt(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",hn(e))}constructor(e){super(e),this.interactionType=Ne.ZOOM,this.radius=0,this._tmpSceneCenter=w(),this._tmpZoomAxisAngle=qh(),this._sphere=ur()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){let i=this.momentum.valueDelta(0,e);vE(this._sphere,t,i),this.constraintOptions.interactionType=Ne.ZOOM,Pt(this.view,t,this.constraintOptions),id(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Pf(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Ws(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Ne.PAN}};u([d({constructOnly:!0})],ad.prototype,"momentum",void 0),u([d({constructOnly:!0})],ad.prototype,"screenCenter",null),u([d({constructOnly:!0})],ad.prototype,"sceneCenter",null),u([d({constructOnly:!0})],ad.prototype,"radius",void 0),ad=u([C("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],ad);var jy=class{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};var bq=1e-5,KP=class extends _V{constructor(t,i,r,n,s,o=0,a){super(t,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}},ZE=class{constructor(t=300,i=12,r=.84){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=w(),this._tmpAxis2=w(),this._tmpAngles=Hi(),this._time=new mw(.3),this._screen=[new mw(.4),new mw(.4)],this._angle1=new jy(.6),this._angle2=new jy(.6),this._axis1=w(),this._axis2=w(),this._lastScene=w()}addMomentumDirectRotation(t,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=AP(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),Ar(this._tmpAxis2)<bq?a=0:ne(this._axis1,this._tmpAxis2),this._angle1.update(a),ee(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}addMomentumPreserveHeading(t,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;RP(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),Ar(this._tmpAxis2)<bq?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ne(this._axis1,this._tmpAxis1),ne(this._axis2,this._tmpAxis2)),ee(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;let t=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=t==null||i==null?null:Math.sqrt(t*t+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(t,i,r){let n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new KP(t,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}};var QE=class extends Qr{constructor(){super(...arguments),this._smoothRotation=new sd(.05),this._rotationAxis=w(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Wl(),this._beginRadius=0,this._smoothScaling=new sd(.05),this._zoomCenterScreen=Kt(),this._zoomMomentumEstimator=new _w,this._rotationMomentumEstimator=new gw,this._panSphericalMomentumEstimator=new ZE,this._panPlanarMomentumEstimator=new fw,this._adjustedSphere=ur(),this._tmp3d=w(),this._tmpScreenPointArray=Kt(),this._beginScreenPoint=Kt(),this._beginScenePoint=w(),this._screenPickPoint=Kt(),this._scenePickPoint=w(),this._navMode=er.Horizontal,this._sphere=ur(),this._pointerCount=0,this._tmpInteractionDirection=w(),this._beginCamera=new Rt,this._constraintOptions=new xi(dt.ALL,Ne.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.running)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-oa.normalize(Vt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Xo(e.center,this._screenPickPoint),Yi(this._beginScreenPoint,this._screenPickPoint);let t=_t(this.view.spatialReference),i=bE(this._intersectionHelper,this.startCamera,this._screenPickPoint,t,td.Silhouette,this.view.map.ground.opacity===0?Cs:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,ee(this._beginScenePoint,this._scenePickPoint),this._navMode=yl(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===er.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);let t=e.pointers.size>1;this._navMode===er.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();let t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._navMode===er.Horizontal?new ad({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new od({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});let i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Ac({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._navMode===er.Horizontal){let r=this._panSphericalMomentumEstimator.evaluateMomentum();if(r)return new Uy({view:this.view,momentum:r})}else{let r=this._panPlanarMomentumEstimator.evaluateMomentum();if(r)return new ep({view:this.view,momentum:r})}return null}_preparePlanarPanMode(e,t){let i=Rs(this._tmp3d,this.startCamera.viewForward);G0(this._scenePickPoint,i,this._panningPlane);let r=Kt(this._screenPickPoint[0],0),n=w(),s=xe(this.startCamera.eye);this._adjustedSphere[3]=s<this._sphere[3]?s-100:this._sphere[3],id(this._adjustedSphere,this.startCamera,r,n);let o=Td();this.startCamera.projectToRenderScreen(n,o);let a=w(),l=w(),c=w();ve(a,this._scenePickPoint,this.currentCamera.eye);let h=xe(a);ne(a,a);let p=gE*Math.max(Math.abs(this.view.camera.position.z),_E),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,gl),f=m??p;f=t?Math.min(f,h):f,ee(c,he(l,this.currentCamera.eye,X(l,a,f))),this._panningPlane[3]=-ae(this._panningPlane,c),this.startCamera.center=he(l,this.startCamera.eye,X(l,this.startCamera.viewForward,f));let g=Xo(e.center,this._tmpScreenPointArray);Fy(this._panningPlane,this.startCamera,g,this._beginScenePoint)}_zoomSpherical(e){let t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),vE(this._sphere,this.currentCamera,this._smoothScaling.value),Xo(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Ne.ZOOM,this._constraintOptions.interactionFactor=on(e.radius-this._beginRadius),Pt(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){let t=Xo(e.center,this._tmpScreenPointArray);id(this._sphere,this.currentCamera,t,this._tmp3d),TE(this._beginScenePoint,ae(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera.aboveGround)?(NP(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(OP(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Ne.PAN,this._constraintOptions.interactionFactor=on(ea(this._screenPickPoint,t)),Pt(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ne(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Rs(this._rotationAxis,this._rotationAxis);let t=this._smoothRotation.value,i=t+Ly(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=r,this._smoothRotation.update(i);let n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Ws(this.currentCamera,this._sphere,xc(this._rotationAxis,n)),this._constraintOptions.interactionType=Ne.TUMBLE,this._constraintOptions.interactionFactor=on(e.radius*i),Pt(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){let t=Xo(e.center,this._tmpScreenPointArray);Fy(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(CE(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Ne.PAN,this._constraintOptions.interactionFactor=on(ea(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Pt(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){let t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),kf(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Ne.ZOOM,this._constraintOptions.interactionFactor=on(e.radius-this._beginRadius),Pt(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ee(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Rs(this._rotationAxis,this._rotationAxis);let t=this._smoothRotation.value,i=e.angle-t;i=Ly(i);let r=t+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);let s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Ws(this.currentCamera,this._sphere,xc(this._rotationAxis,s)),this._constraintOptions.interactionType=Ne.TUMBLE,this._constraintOptions.interactionFactor=on(e.radius*s),Pt(this.view,this.currentCamera,this._constraintOptions)}};QE=u([C("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],QE);var Cq=yt(0,0,1),YE=class extends Qr{constructor(){super(...arguments),this._rotationValueSmooth=new sd(.05),this._scalingValueSmooth=new sd(.05),this._planeHorizontal=Wl(),this._planeVertical=Wl(),this._rotationMomentumEstimator=new gw,this._panMomentumEstimator=new fw(300,12,.9),this._zoomMomentumEstimator=new _w,this._beginRadius=0,this._beginCenter=w(),this._beginAngle=0,this._tmpPoints=[],this._navMode=er.Horizontal,this._beginCenterScreen=Kt(),this._tmpCentroid3d=w(),this._tmpCentroid2d=Kt(),this._tmp2d=Kt(),this._pointerCount=0,this._beginCamera=new Rt,this._constraintOptions=new xi(dt.ALL,Ne.NONE,0,this._beginCamera)}begin(e){if(!this.running)return;let t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Xo(e.center,this._beginCenterScreen),z0(Cq,0,this._planeHorizontal);let i=w(),r=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Cs:{}),n=w();Rs(n,this.startCamera.viewForward);let s=w();ee(s,Cq);let o=ae(n,s);this._navMode=yl(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);let a=Math.min(gE,1/Math.abs(ae(s,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),_E);eM(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||gF(this._planeHorizontal,this._planeHorizontal);let l=w(),c=w(),h=w();ve(l,i,this.currentCamera.eye);let p=xe(l);if(ne(l,l),this._navMode===er.Vertical){X(s,s,o),ve(this._planeVertical,n,s),ne(this._planeVertical,this._planeVertical),eM(this._planeVertical,this._planeVertical,i);let m=this.view._stage.renderView.getMinimalDepthForArea(Xl(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,gl),f=m??a;f=r?Math.min(f,p):f,ee(h,he(c,this.currentCamera.eye,X(c,l,f))),this._planeVertical[3]=-ae(this._planeVertical,h),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),wE(this._tmpPoints,this._beginCenter)}else{let m=r?p:a;ee(h,he(c,this.currentCamera.eye,X(c,l,m))),this._planeHorizontal[3]=-ae(this._planeHorizontal,h),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),wE(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.running)return;this.currentCamera.copyFrom(this.startCamera);let t=e.pointers.size>1,i=this._navMode===er.Horizontal?this._planeHorizontal:this._planeVertical,r=this._beginCenter;if(t){let n=this._beginRadius/e.radius,s=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=s,this._scalingValueSmooth.update(n),kf(this.currentCamera,r,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Ne.ZOOM,this._constraintOptions.interactionFactor=on(Math.abs(e.radius-this._beginRadius)),Pt(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),wE(this._tmpPoints,this._tmpCentroid3d),Xo(e.center,this._tmpCentroid2d),CE(this.currentCamera,r,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Ne.PAN,this._constraintOptions.interactionFactor=on(ea(this._beginCenterScreen,this._tmpCentroid2d)),Pt(this.view,this.currentCamera,this._constraintOptions),t){let n=r,s=this._rotationValueSmooth.value,o=s+Ly(e.angle-s),a=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=a,this._rotationValueSmooth.update(o);let l=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(l,.001*e.timestamp);let c=this._planeHorizontal;Ws(this.currentCamera,n,xc(c,l)),this._constraintOptions.interactionType=Ne.TUMBLE,this._constraintOptions.interactionFactor=on(Math.abs(e.radius*l)),Pt(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();let t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new od({view:this.view,momentum:t,zoomCenter:this._beginCenter});let i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Ac({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});let r=this._panMomentumEstimator.evaluateMomentum();return r?new ep({view:this.view,momentum:r}):null}_computePlanePoints(e,t,i,r){r.length=e.size;let n=this._tmp2d,s=0;return e.forEach(o=>{n[0]=o.x,n[1]=o.y,r[s]===void 0&&(r[s]=w()),Fy(t,i,n,r[s]),s+=1}),r}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};YE=u([C("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],YE);var zy=class extends rt{constructor(t,i,r){super(!0),this._view=t,this.pointerActions=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!cf(t.data,this.pointerActions))return;let i=t.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.running&&i<r;switch(t.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.running?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this._controller?.running){this._lastEndTimestamp=t.timestamp;let r=this._controller.end(t.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new QE({view:this._view}):new YE({view:this._view})}};var KE=class extends rt{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}};var XE=class extends rt{constructor(t,i=!1){super(!0),this._view=t,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){let i=this._invert?-1:1,r=Kt(0,t.data.delta*i);switch(t.data.action){case"begin":this._cameraController?.end(),this._cameraController=new Kh({view:this._view,pivot:an.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}};var JE=class extends rt{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Io({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(t,i){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(let{x:_,y:v}of i.pointers.values())r=Math.max(r,_),n=Math.min(n,_),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(let{x:_,y:v}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);let p=r-n,m=s-o,f=a-l,g=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(f-p)<=this._maxDelta&&Math.abs(g-m)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((n,s)=>{let o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}};var wl=class extends P{constructor(){super(...arguments),this.mode="default",this._updateMode=({mode:e,dragPrimary:t,dragSecondary:i,dragTertiary:r})=>{e==="pro"&&(i="zoom",r=t==="pan"?"rotate":"pan");let n={dragPrimary:t,dragSecondary:i,dragTertiary:r};this._modeDragPan&&(this._modeDragPan.pointerActions=xh("pan",n)),this._modeDragRotate&&(this._modeDragRotate.pointerActions=xh("rotate",n)),this._modeDragZoom&&(this._modeDragZoom.pointerActions=xh("zoom",n))}}destroy(){this.disconnect()}get primaryDragAction(){return this.view.navigation.actionMap.dragPrimary}set primaryDragAction(e){let{actionMap:t}=this.view.navigation;t.dragPrimary=e,t.dragSecondary=e==="pan"?"rotate":"pan"}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.removeAllHandles(),this.view.viewEvents.disconnect(),this._modeDragPan=null,this._modeDragRotate=null,this._modeDragZoom=null,this._modeKeyboardNavigation=null,this._inputManager=G(this._inputManager),this._source=G(this._source)}connect(){let e=this.view;this._source=new cT(this.view.surface,e.input);let t=[new gf,new _f,new yf,new ff(this.view.navigation),new JE],i=new ow({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new mf],qa.INTERNAL);let r={fov:"Shift",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:["u","U"],down:["j","J"]},lookAround:{headingLeft:["a","A"],headingRight:["d","D"],tiltUp:["w","W"],tiltDown:["s","S"],modifier:"b"},zoom:{zoomIn:["+","="],zoomOut:["-","_"]},reset:{heading:["n","N"],tilt:["p","P"]}};this._modeDragPan=new zy(e,["primary"]),this._modeDragRotate=new jf(e,["secondary"],an.CENTER),this._modeDragZoom=new zE(e,["tertiary"],r.fov),this._modeKeyboardNavigation=new qE(e,r),i.installHandlers("navigation",[new KE(e),new ME(e),new GE(e),new WE(e,r.fov),new jf(e,["primary"],an.EYE,[r.lookAround.modifier]),new jf(e,["secondary"],an.CENTER,[r.lookAround.modifier]),new zy(e,["tertiary"],[r.lookAround.modifier]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new XE(e)],qa.INTERNAL),this.view.viewEvents.connect(i),this.addHandles([S(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Re),S(()=>{let{actionMap:n}=this.view.navigation,{dragPrimary:s,dragSecondary:o,dragTertiary:a}=n;return{mode:this.mode,dragPrimary:s,dragSecondary:o,dragTertiary:a}},this._updateMode,Ce)])}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}get test(){}};u([d()],wl.prototype,"view",void 0),u([d({type:["default","pro"]})],wl.prototype,"mode",void 0),u([d({readOnly:!0})],wl.prototype,"updating",null),u([d()],wl.prototype,"latestPointerType",null),u([d()],wl.prototype,"latestPointerLocation",null),u([d()],wl.prototype,"multiTouchActive",null),u([d()],wl.prototype,"_inputManager",void 0),wl=u([C("esri.views.3d.input.SceneInputManager")],wl);var Tq=wl;var Zs,zf,XP=!1,JP=!1,eO=!1,tO=!1,Gy=null;function Eq(e,t){if(!JP||!zf)return;xq();let i=zf,r=0;for(let n=0;n<e.accBinsNumX;n++)for(let s=0;s<e.accBinsNumY;s++){let o=e.accBins[n][e.accBinsNumY-1-s];r+=o.length;let a=n*e.accBinsSizeX,l=(n+1)*e.accBinsSizeX,c=s*e.accBinsSizeY,h=(s+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),Mq(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function Dq(e){eO=dr.DECONFLICTOR_SHOW_VISIBLE,tO=dr.DECONFLICTOR_SHOW_INVISIBLE,XP=eO||tO,JP=dr.DECONFLICTOR_SHOW_GRID,Gy=null,XP||JP?Gy=()=>lee(e):Zs&&(Zs.parentElement.removeChild(Zs),Zs=null)}function xq(){Gy&&(Gy(),Gy=null)}function lee(e){Zs==null&&(Zs=document.createElement("canvas"),Zs.setAttribute("id","debugCanvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Zs));let{state:t}=e,{camera:i,pixelRatio:r}=t,{width:n,height:s}=i,o=n*r,a=s*r;Zs.setAttribute("width",`${o}px`),Zs.setAttribute("height",`${a}px`),Zs.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),zf=Zs.getContext("2d"),zf.clearRect(0,0,n,s),zf.font="12px Arial"}function Mq(e,t,i,r,n){xq();let s=Zs.height,o=zf;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(e,s-i),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.closePath()}function Sq(e,t){XP&&(t&&eO||!t&&tO)&&Mq(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var bl=w(),eD=w(),Gf=Qi(),qy=Qi(),iO=w(),Iq=$t(),cee=ur(),rO=Os(),uee=w(),dee=Yt(),nO=class{constructor(){this.aabr=Yt(),this.distance=0,this.distanceToTerrain=0,this.culled=!1,this.visible=!1}},tD=class{constructor(t,i){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info={}}},qn;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(qn||(qn={}));var sO=class{constructor(){this.camera=new Rt,this.slicePlane=$g(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),Wp(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}},Rc=class extends P{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._viewState=new sO,this._state=qn.Idle,this._active=new Map,this._visible=new Map,this._iterators=new aO,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0,this._updatingHandles=new mo}destroy(){this._updatingHandles.destroy(),this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==qn.Idle||this._dirty||this._updatingHandles.updating}get updatingProgress(){if(!this.updating)return 1;let e=this._state/qn.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case qn.Idle:this._startUpdate(),e.madeProgress();case qn.Process:if(this._state=qn.Process,!this._processActiveGraphics(e))return;case qn.Sort:if(this._state=qn.Sort,!this._sortVisibleGraphics(e))return;case qn.Deconflict:if(this._state=qn.Deconflict,!this._deconflictVisibleGraphics(e))return;default:Eq(this,this._visible),this._state=qn.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(e==null||e.type!=="object3d")return!1;let t=e.stageObject;return(t?.geometries.length??0)!==1?!1:t?.geometries[0]?.material instanceof iw}_startUpdate(){Dq(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);let{fullWidth:e,fullHeight:t}=this._viewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new nO,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),hee(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_createTerrainIntersector(){let e=tn(this.view.state.viewingMode);e.options.store=fo.MIN;let t=this.view.basemapTerrain,i=this.view.state.camera;return J2(Iq,this._viewState.camera.viewInverseTransposeMatrix),r=>{si(eD,r,Iq),e.reset(i.eye,eD,i),t.intersect(e,null,i.eye,eD);let n=e.results.ground.dist;return n!=null?n*ui(eD,i.eye):0}}_processActiveGraphics(e){let t=this._ensureActiveGraphicsIterator(),i=this._viewState.camera.inverseProjectionMatrix,r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0,n=Ct("enable-feature:non-occluded-hud")&&this.view.map.ground.opacity>0?this._createTerrainIntersector():null,s=r?cee:null,o=0;for(s!=null&&(si(s,Jo,this._viewState.camera.viewMatrix),s[3]=_t(this.view.spatialReference).radius,o=xF(s,Jo));!e.done;){e.madeProgress();let a=t.next();if(a.done===!0)return this._resetActiveGraphicsIterator(),!0;let l=a.value,c=l?.info[this.visibilityGroup];c&&(this._collectGraphics3DGraphics(l,i,s,o,n),c.culled?(this._setGraphicVisibility(l,!1),this._visible.delete(l.graphics3DGraphic.graphic.uid)):this._visible.set(l.graphics3DGraphic.graphic.uid,l))}return!1}_sortVisibleGraphics(e){let t=this._ensureSortGraphicsIterator();for(;!e.done;){let i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){let t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Ya.LABEL;for(;!e.done;){e.madeProgress();let r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;let n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}let o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),Sq(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Aq(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Aq(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=pee(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r,n){let s=e.graphics3DGraphic;if(s.destroyed)return;let o=e.info[this.visibilityGroup];if(!s.isVisible(Ya.GRAPHIC,lu.DECONFLICTION))return void(o.culled=!0);let a=this.getGraphicsLayers(s);Yo(o.aabr);let l=null;for(let c of a){if(!this.layerSupportsDeconfliction(c))continue;let h=c.stageObject.geometries[0].material;if(l==null){if(l=gee,this._getProjectionInfo(c,t,l),l.isOutsideScreen||this._isCulledBySlice(e,bl)||i!=null&&fee(l,i,r))return void(o.culled=!0);l.distanceToTerrain=n?.(l.positionView)??0}this._expandBoundingRect(o,c,h,l)}l==null?o.culled=!0:(o.distance=l.distance,o.distanceToTerrain=l.distanceToTerrain,o.culled=!1)}_getProjectionInfo(e,t,i){let r=this._viewState.camera,n=e.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;si(bl,a,r.viewMatrix);let l=s.attributes,c=l.get(yi.NORMAL).data,h=l.get(yi.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(bl,c,n.transformation,h,r,i.scaleInfo,bl),ho(Gf,bl[0],bl[1],bl[2],1),Vg(qy,Gf,r.projectionMatrix),X(i.positionNDC,qy,1/qy[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,iO),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(iO[2]),i.distance=iO[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),ho(qy,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Vg(Gf,qy,t),T0(Gf,Gf,1/Gf[3]),Te(i.positionView,bl[0],bl[1],bl[2])}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&GF(this._viewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:n}){let{fullWidth:s,fullHeight:o,pixelRatio:a}=this._viewState.camera,l=t.getScreenSize(mee);$F(l,n.factor,l),l[0]*=a,l[1]*=a;let c=v0(i.calculateRelativeScreenBounds(l,n.factorAlignment.scale*a,dee),Xe(0,s,.5+.5*r[0]),Xe(0,o,.5+.5*r[1])),h=this.marginFactor;if(h!==0){let p=h*Math.min(ao(c),Ul(c));c[0]-=p,c[1]-=p,c[2]+=p,c[3]+=p}ka(e.aabr,c,e.aabr)}_isConflicted(e){let t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup],r=!0;for(let n=Math.floor(i.aabr[0]/this._accBinsSizeX);n<=Math.floor(i.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;r=!1;let o=this._accBins[n][s];for(let a=0;a<o.length;a++){let l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,jl(c.aabr,i.aabr)))return!0}}return r}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);let r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new Nt)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){let t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this._accBinsSizeX),r=Math.floor(t.aabr[2]/this._accBinsSizeX),n=Math.floor(t.aabr[1]/this._accBinsSizeY),s=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){let i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,lu.DECONFLICTION,t),this.visibilityGroup===Ya.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function hee(e,t){let i=e.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(t,lu.DECONFLICTION,!0)}function*Aq(e){if(Map.prototype.entries){let t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*pee(e,t,i){t.clear(),e.forEach((n,s)=>{let o=t.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(i,lu.DECONFLICTION);let a=n.info?.[i];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE,o.behindTerrain=!!a&&a.distanceToTerrain!==0&&a.distance>a.distanceToTerrain}),yield;let r=t.iterableSort((n,s)=>n.behindTerrain!==s.behindTerrain?+n.behindTerrain-+s.behindTerrain:n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?+s.visible-+n.visible:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;t.forAll(n=>{let s=e.get(n.id);s&&(e.delete(n.id),e.set(n.id,s))}),t.clear()}u([d({constructOnly:!0})],Rc.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Rc.prototype,"updating",null),u([d({readOnly:!0})],Rc.prototype,"_updatingHandles",void 0),Rc=u([C("esri.views.3d.layers.graphics.Deconflictor")],Rc);var oO=class{constructor(){this.id=0,this.visible=!1,this.behindTerrain=!1,this.prio=0,this.distance=0}},aO=class{constructor(t=null,i=null,r=null){this.active=t,this.visible=i,this.sort=r,this.sortArray=new Nt({allocator:n=>n||new oO})}},mee=Hi(),lO=class{constructor(){this.positionView=w(),this.positionNDC=w(),this.distance=0,this.distanceToTerrain=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new vk}get isOutsideScreen(){let t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1||t[2]>=1}};function fee(e,t,i){return ee(rO.direction,e.positionView),Te(rO.origin,0,0,0),!!Xc(t,rO,uee)&&e.distanceWithoutPolygonOffset>i}var gee=new lO;var _ee=2e3,Wy=class extends Rc{constructor(e){super(e),this.visibilityGroup=Ya.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}initialize(){this._updatingHandles.add(()=>(this.view?.map?.ground?.opacity??0)===0,()=>this.setDirty())}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ui;let t=performance.now();if(e.state!==pi.IDLE&&t-this._lastDeconfliction<_ee)return Ui;super.runTask(e),this.state===qn.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],Wy.prototype,"parent",void 0),Wy=u([C("esri.views.3d.layers.graphics.LabelDeconflictor")],Wy);var iD=class extends Rc{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=Ya.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._updatingHandles.add(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),this._updatingHandles.add(()=>this.view?.map?.ground?.opacity===1,()=>this.setDirty()),this._updatingHandles.add(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Re),this._frameTask=this.view.resourceController.scheduler.registerTask(Xt.GRAPHICS_DECONFLICTOR,this),this._labels=new Wy({view:this.view,parent:this})}destroy(){this._labels=G(this._labels),this._frameTask=kt(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){let e=this.view?this.view.slicePlane:null;e!=null&&qF(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){for(let e of this._contexts.keys())if(e.symbolCreationContext.slicePlaneEnabled)return void this.setDirty()}addGraphicsOwner(e){let t=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){let t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){let r=i.graphic.uid,n=new tD(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,n),cO(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);let s=!this._graphicSupportsDeconfliction(i)||!cO(e);i.setVisibilityFlag(Ya.GRAPHIC,lu.DECONFLICTION,s)}_removeGraphic(e,t){let i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){let i=cO(e);i||yee(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){let i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;let t=e.layers;if(!t?.length)return!1;for(let i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){let t=this._contexts.get(e);if(t)return t;let i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function cO(e){let t=e.layer;return!(!t?.featureReduction||t.featureReduction.type!=="selection")}function yee(e){let t=e.graphics3DGraphics;t&&t.forEach(i=>i.setVisibilityFlag(Ya.GRAPHIC,lu.DECONFLICTION,!0))}iD=u([C("esri.views.3d.layers.graphics.GraphicsDeconflictor")],iD);function Rq(e,t,i,r,n,s,o=1){let a=Hg(t,n);if(a==null)return!1;if(a===EL){if(e===r&&i===s)return!0;let c=i+o;for(let h=i,p=s;h<c;++h,++p)ee(r[p],e[h]);return!0}let l=i+o;for(let c=i,h=s;c<l;++c,++h)a(e[c],0,r[h],0);return!0}var oD=class{constructor(t,i){this._renderCoordsHelper=t,this.opaqueGround=i,this._cache=new Map,this._cameraForward=w(),this._cameraEye=w(),this._cameraFovY=55*Math.PI/180,this._frustumBoundingSphereCenter=w(),this._frustumBoundingSphereRadius=0,this._frustum=new Iw(t),this._renderSR=t.spatialReference;let r=zL(this._renderSR);this._renderSREllipsoidRadius=_t(r).radius}setup(t){this._aboveGround=t.aboveGround,this._frustum.update(t),ne(this._cameraForward,t.viewForward),ee(this._cameraEye,t.eye),this._cameraFovY=t.fovY,this._updateFrustumBoundingSphere()}done(){this._cache.clear()}compute(t){if(this._cache.has(t.id))return this._cache.get(t.id);let i=this._isVisibleInFrustum(t);return this._cache.set(t.id,i),i}_isVisibleInFrustum(t){return this._renderCoordsHelper.viewingMode===Se.Local?this._isTileVisibleInFrustumLocal(t):this._isTileVisibleInFrustumGlobal(t)}_updateFrustumBoundingSphere(){let t=this._frustum,i=t.origin,r=xee;ne(r,t.direction);let n=t.points,s=Mee;ai(s,n[4],i);let o=.5*ae(s,s)/ae(r,s),a=this._frustumBoundingSphereCenter;Id(a,i,r,o);let l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(t){let i=t.spatialReference,r=t.extent,n=this._renderSR;if(or[0]=r[0],or[1]=r[1],or[2]=0,or[3]=r[2],or[4]=r[3],or[5]=0,!DL(or,i,0,or,n,0))return!1;Te(xn[0],or[0],or[1],0),Te(xn[1],or[3],or[1],0),Te(xn[2],or[3],or[4],0),Te(xn[3],or[0],or[4],0),Te(rD,.5*(or[0]+or[3]),.5*(or[1]+or[4]),.5*(or[2]+or[5]));let s=kq,o=.5*Rr(xn[0],xn[2]),a=this._frustum,l=this._frustumBoundingSphereRadius,c=this._frustumBoundingSphereCenter,h=Iee;ai(h,c,rD);let p=ae(s,h),m=See;if(Id(m,rD,s,p),Rr(m,c)>o+l)return!1;let f=this._cameraForward,g=ae(f,kq),_=this._cameraFovY,v=this._cameraEye;if(Math.abs(g)<Math.abs(Math.cos(.5*_))){let T=!0,I=Te(tte,f[0],f[1],0),A=ae(v,I);for(let O=0;O<4;++O){let $=xn[O];if(ae($,I)-A>0){T=!1;break}}if(T)return!1}{let T=xn[0],I=xn[2];if(T[0]<=v[0]&&v[0]<=I[0]&&T[1]<=v[1]&&v[1]<=I[1])return!0}let b=bee,x=this.opaqueGround&&this._aboveGround,E=this.opaqueGround&&!this._aboveGround,D=Math.min(E?nD:1/0,p+l),M=Math.max(x?-430:-1/0,p-l);for(let T=0;T<4;++T)Id(b[T],xn[T],s,D),Id(b[T+4],xn[T],s,M);if(Oq(a.planes,b,8))return!1;if(uO(a.planes,b,8))return!0;for(let T=0;T<4;++T){let I=b[T],A=b[T+4];if(pO(a.planes,I,A))return!0;let O=b[(T+1)%4];if(pO(a.planes,I,O))return!0;let $=b[4+(T+1)%4];if(pO(a.planes,A,$))return!0}if(Cl[0][3]=+xn[0][0],Cl[1][3]=-xn[2][0],Cl[2][3]=+xn[0][1],Cl[3][3]=-xn[2][1],Cl[4][3]=+M,Cl[5][3]=-D,uO(Cl,a.points)||uO(Cl,a.points))return!0;for(let T=0;T<4;++T){let I=v,A=a.points[T+4];if(Vq(Cl,I,A))return!0;let O=a.points[4+(T+1)%4];if(Vq(Cl,A,O))return!0}return!1}_isTileVisibleInFrustumGlobal(t){if(t.level<Zy)return!0;let i=t.spatialReference,r=t.extent,n=this.opaqueGround&&this._aboveGround,s=this.opaqueGround&&!this._aboveGround,o=xn,a=.5*(r[0]+r[2]);if(Te(o[0],r[0],r[1],0),Te(o[1],r[2],r[1],0),Te(o[2],r[2],r[3],0),Te(o[3],r[0],r[3],0),Te(o[4],a,r[1],0),Te(o[5],a,r[3],0),!Rq(o,i,0,o,this._renderSR,0,6))return!1;let l=o[0][2]>0,c=o[3][2]<0,h=l||c,p=this._renderSREllipsoidRadius;if(h){let _e=Cee;ld(_e,sD,o[0]);let L=Tee;if(ld(L,sD,o[1]),l){let N=Nq,V=o[4],U=Lq;ld(U,V,sD),ld(N,U,V);let Y=o[0];At(Y,_e,N),$y(Y,p);let re=o[1];At(re,L,N),$y(re,p)}else if(c){let N=Nq,V=o[5],U=Lq;ld(U,V,sD),ld(N,V,U);let Y=o[3];At(Y,N,_e),$y(Y,p);let re=o[2];At(re,N,L),$y(re,p)}}let m=rD,f=ai(Oee,o[3],o[0]);ne(f,f);let g=he(Nee,o[0],o[3]);X(g,g,.5);let _=-ae(g,f),v=he(Lee,o[0],o[1]);X(v,v,.5);let b=he(Fee,o[2],o[3]);X(b,b,.5);let x=ai(kee,b,v);ne(x,x);let E=-(_+ae(f,v))/ae(f,x);Id(m,v,x,E),$y(m,p);let D=this._frustumBoundingSphereRadius,M=this._frustumBoundingSphereCenter,T=this._frustum,I=T.planes,A=Eee;ne(A,m);let O=ae(o[0],A)/vr(o[0]),$=T.origin,H=T.points,k=!1;if(n){{k=!0;let L=ne(Fq,$);for(let N=0;N<4;++N){let V=H[4+N],U=ai(w(),V,$);ne(U,U);let Y=At(w(),L,U);ne(Y,Y);let re=At(w(),U,Y);if(ne(re,re),ae($,re)>p){k=!1;break}}}if(k&&ae($,A)<p*O-nD)return!1;let _e=ne(Fq,T.origin);if(ae(_e,A)<0)return!1;{let L=ne(Jee,T.direction);if(ae(L,A)>ete)return!1}}let K=Math.sqrt(1-O*O);if(K>.9)return!0;let F=!1,R=ae(A,M),j=vr(M);if(j<=D&&!I.some(_e=>$l(_e,dO)>0)){if(!n)return!0;F=!0}let B=R/j;if(!F&&R<=0&&-R>D)return!1;let z=D/j;if(Math.sqrt(1-B*B)*Math.sqrt(1-z*z)-z*B>K)return!1;if(!k&&(o.some(_e=>T.intersectsPoint(_e))||T.intersectsPoint(m)))return!0;let ce=Aee;ai(ce,M,dO);let ue=ae(ce,A),Ie=Dee;X(Ie,A,ue);let le=Rr(Ie,M),ze=i.isWGS84,Le=t.lij,de=ze&&Le[2]===2**Le[0]-1,fe=ze&&Le[2]===0,st=fe?$ee:de?qee:zee,De=fe?Zee:de?Wee:Gee;if(!F){let _e=o,L=Qee,N=Vee,V=Hee,U=dO;for(let Y of st){let re=_e[Y];if(Pq(N,_e[(Y+1)%4],re),Pq(V,U,re),ld(L,V,N),wee(L,H,1))return!1}}let Ee=null;if(!n&&ue<1.01*D){let _e=2.5*D;if(le>O*_e+D)return!1;let L=Pee,N=_e/O;for(let V=0;V<4;++V)X(L[V],o[V],N/p);Te(L[4],0,0,0),Ee=L}else{let _e=(s?p+nD:ue+D)/O,L=n?p-nD:(ue-D)/O,N=Ree;for(let V=0;V<4;++V){let U=o[V];X(N[V],U,L/p),X(N[V+4],U,_e/p)}Ee=N}if(Oq(I,Ee,Ee.length))return!1;let Ae=T.lines,He=Bee,Ve=Uee;for(let _e of Ae){ne(Ve,_e.direction);for(let L of De){let N=Ee[L];if(ne(He,N),hO(Ve,He,Ee,H))return!1;let V=(L+1)%4;if(n){let U=Ee[V];if(ai(He,U,N),ne(He,He),hO(Ve,He,Ee,H))return!1}if(s){let U=Ee[4+L],Y=Ee[4+V];if(ai(He,Y,U),ne(He,He),hO(Ve,He,Ee,H))return!1}}}return!0}};function ld(e,t,i){return At(e,t,i),ne(e,e),e}function Pq(e,t,i){return ai(e,t,i),ne(e,e),e}function $y(e,t){return X(e,e,t/vr(e)),e}var Hq=[eu.LEFT,eu.RIGHT,eu.BOTTOM,eu.TOP,eu.FAR];function vee(e,t,i){for(let r=0;r<i;++r)if($l(e,t[r])<=0)return!1;return!0}function Oq(e,t,i){for(let r of Hq)if(vee(e[r],t,i))return!0;return!1}function uO(e,t,i=t.length){for(let r=0;r<i;++r){let n=t[r],s=!0;for(let o of e)if($l(o,n)>0){s=!1;break}if(s)return!0}return!1}var Zy=2,Bq=4;function wee(e,t,i){for(let r of t)if(ae(r,e)<i)return!1;return!0}var bee=[w(),w(),w(),w(),w(),w(),w(),w()],or=[0,0,0,0,0,0],xn=[w(),w(),w(),w(),w(),w()],rD=w(),Nq=w(),Cee=w(),Tee=w(),Lq=w(),Eee=w(),Dee=w(),xee=w(),Mee=w(),See=w(),Iee=w(),dO=Fg(0,0,0),Aee=w(),Ree=[w(),w(),w(),w(),w(),w(),w(),w()],Pee=[w(),w(),w(),w(),w()],Oee=w(),Nee=w(),Lee=w(),Fee=w(),kee=w(),Vee=w(),Hee=w(),Bee=w(),Uee=w(),jee=w(),zee=[0,1,2,3],Gee=[0,1,2,3],qee=[0,1,3],Wee=[0,1,3],$ee=[1,2,3],Zee=[1,2,3],Qee=w();function Yee(e,t,i){let r=1/0,n=-1/0;for(let s of i){let o=ae(t,s);r=Math.min(r,o),n=Math.max(n,o)}e[0]=r,e[1]=n}function Kee(e,t,i,r){let n=1/0,s=-1/0;for(let o of r){let a=ae(i,o);if(n=Math.min(n,a),s=Math.max(s,a),n<=t&&s>=e)return!1}return!0}var Xee=[0,0];function hO(e,t,i,r){if(i.length===0||r.length===0)return!0;let n=jee;ld(n,e,t);let s=r[0]<i[0],o=s?i:r,a=Xee;return Yee(a,n,s?r:i),Kee(a[0],a[1],n,o)}var nD=430,Fq=w(),Jee=w(),ete=Math.cos(.25*Math.PI),kq=yt(0,0,1),tte=w();function pO(e,t,i){let r={t0:0,t1:1};for(let n of Hq)if(!Uq(e[n],t,i,r))return!1;return r.t0<r.t1}function Vq(e,t,i){let r={t0:0,t1:1};for(let n of e)if(!Uq(n,t,i,r))return!1;return r.t0<r.t1}function Uq(e,t,i,r){let{t0:n,t1:s}=r,o=$l(e,t),a=$l(e,i);if(o>=0&&a>=0)return!1;if(o<0&&a>=0){let l=-o/(a-o);if(l<n)return!1;l<s&&(s=l)}else if(o>=0&&a<0){let l=o/(o-a);if(l>s)return!1;l>n&&(n=l)}return r.t0=n,r.t1=s,!0}var Cl=[Nd(-1,0,0,1),Nd(1,0,0,-1),Nd(0,-1,0,1),Nd(0,1,0,-1),Nd(0,0,-1,1),Nd(0,0,1,-1)],sD=Fg(0,0,1);var Qy=class{constructor(t,i,r){this._renderCoordsHelper=t,this._tilingScheme=i,this._camera=new Rt,this._surfaceElevation=0,this._focusOnMap=[0,0],this._visibility=new oD(t,r)}set opaqueGround(t){this._visibility.opaqueGround=t}setup(t,i,r){this._camera.copyFrom(t),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,this._visibility.setup(this._camera)}done(){this._visibility.done()}update(t){let{measures:i,extent:r,level:n}=t;i.visible=this._visibility.compute(t),i.distance=z2(r,this._focusOnMap),i.mergeable=!0,i.lodLevel=Zy,i.splitPriority=Math.max(0,Zy-n),i.visible&&(this._isGlobal?this._updateSplitAndLodGlobal(t):this._updateSplitAndLodLocal(t))}_updateSplitAndLodGlobal(t){let i=t.level,r=this._renderCoordsHelper,{eye:n,fov:s}=this._camera,o=r.referenceEllipsoid.radius,a=vr(n)-o;if(2*Math.atan(o/a)<s&&a>0)return void(t.measures.lodLevel=Math.max(i,Zy));let l=jq,{extent:c}=t,{_surfaceElevation:h}=this;Te(l[0],c[0],c[1],h),Te(l[1],c[2],c[1],h),Te(l[2],c[2],c[3],h),Te(l[3],c[0],c[3],h);let p=Te(zq,.5*(c[0]+c[2]),.5*(c[1]+c[3]),h),m=this._tilingScheme.spatialReference;for(let v=0;v<4;++v)r.toRenderCoords(l[v],m,l[v]);r.toRenderCoords(p,m,p);let f=ne(mO.direction,p),g=ae(n,f),_=X(Gq,f,g);this._updateSplitAndLod(t,l,p,_)}_updateSplitAndLodLocal(t){let i=jq,{extent:r}=t,{_surfaceElevation:n}=this;Te(i[0],r[0],r[1],n),Te(i[1],r[2],r[1],n),Te(i[2],r[2],r[3],n),Te(i[3],r[0],r[3],n);let s=this._tilingScheme.spatialReference;for(let p=0;p<4;++p)this._renderCoordsHelper.toRenderCoords(i[p],s,i[p]);let o=Te(zq,.5*(i[0][0]+i[2][0]),.5*(i[0][1]+i[2][1]),.25*(i[0][2]+i[1][2]+i[2][2]+i[3][2])),a=Te(ite,o[0],o[1],0),{eye:l,far:c}=this._camera,h=Te(Gq,a[0],a[1],l[2]);Te(mO.origin,a[0],a[1],l[2]-2*c),ee(mO.direction,Wq),this._updateSplitAndLod(t,i,o,h)}_updateSplitAndLod(t,i,r,n){let s=Math.max(Rr(i[0],i[2]),Rr(i[1],i[3]),Rr(i[0],r)+Rr(r,i[2]),Rr(i[1],r)+Rr(r,i[3])),{eye:o,near:a,fov:l,viewForward:c,width:h,height:p,pixelRatio:m,frustum:f}=this._camera,g=ae(o,c),_=ae(r,c)-g,v=Rr(r,o),b=_,x=_,E=v,D=v,M=(B,z)=>z<a?1:Math.sqrt(B*B-z*z)/z,T=M(v,_);for(let B of i){let z=ae(B,c)-g;b=Math.min(b,z),x=Math.max(x,z);let ce=Rr(B,o);D=Math.max(D,ce),E=Math.min(E,ce);let ue=M(ce,z);T=Math.min(T,ue)}if(x<a)return void(t.measures.lodLevel=0);let I=Math.cos(.5*l),A=Rr(o,n);T>I&&A>nte*s&&(x=qq*D,b=qq*E);let O=.5*Math.sqrt(h*h+p*p)/m,$=2*Math.tan(.5*l),H=B=>Math.max(a,B)*rte/O*$,k=t.level,K=s*2**k*Math.max(1,$),F=H(b),R=Math.ceil(Math.log2(Math.max(1,K/F)));if(t.measures.lodLevel=Math.max(R,t.measures.lodLevel),t.measures.splitPriority+=t.measures.lodLevel-k,k<R){let B=+Ld(f,i[0])+ +Ld(f,i[1])+ +Ld(f,i[2])+ +Ld(f,i[3]);t.measures.splitPriority+=B}let j=H(x)/F;j>2.5&&(t.measures.splitPriority+=j)}get _isGlobal(){return this._renderCoordsHelper.viewingMode===Se.Global}},jq=[w(),w(),w(),w()],zq=w(),ite=w(),Gq=w(),Wq=Fg(0,0,1),mO=CF(Jo,Wq),rte=312,nte=.5,qq=2;var ste=60,Tr=class extends P{constructor(e){super(e),this.tiles=new ct,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=Pn(!1),this._pendingTiles=Pn(null),this._newTiles=new Nt,this._tests=!1,this._measurements=new Qy(e.renderCoordsHelper,e.tilingSchemeOwner.tilingScheme,this._opaqueGround)}initialize(){let e=()=>this._setDirty(),t=()=>this._reset();this.addHandles([S(()=>this.tileSize,t,Ce),S(()=>this.cameraOnSurface?.location,e,Ce),S(()=>this.viewState?.contentCamera,e,Ce),S(()=>this.focus?.location,e,Ce),S(()=>this.terrain?.baseOpacity??1,e),S(()=>this.tilingScheme,i=>{this._reset(),this._measurements=new Qy(this.renderCoordsHelper,i,this._opaqueGround)},Fe),S(()=>this._opaqueGround,i=>this._measurements.opaqueGround=i,Fe)]),this._frameWorker=this.scheduler?.registerTask(Xt.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=kt(this._frameWorker)}get tilingScheme(){let e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void W.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");let t=this._get("filterExtent");if(t===e||t!=null&&e&&t.equals(e))return;let i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;let e=Yt();return Mw(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){let{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty.value||!!this._pendingTiles.value}addClient(){let e=d2();return this._clients.add(e),this._clients.size===1&&this._setDirty(),yr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}get _opaqueGround(){return(this.terrain?.baseOpacity??1)===1}_setDirty(){this._hasClients&&!this.suspended&&(this._frameWorker?this._dirty.value=!0:this.runTask(Jn))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty.value=!1}get running(){return this.updating}_reset(){this._newTiles.clear(),this._pendingTiles.value=null,this._setDirty()}_getRootTiles(){let e=this.tilingScheme;return this._rootTileIds.map(t=>new NM(t[0],t[1],t[2],e))}runTask(e){e=this._tests?Jn:e,this._dirty.value=!1,this._pendingTiles.value||(this._startUpdate(e),this._frameWorker!=null&&(this._frameWorker.priority=Xt.FEATURE_TILE_TREE_ACTIVE)),this._splitPendingTiles(e),this._pendingTiles.value||this._frameWorker==null||(this._frameWorker.priority=Xt.FEATURE_TILE_TREE)}_startUpdate(e){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();let{_measurements:t,_filterExtentRect:i,_newTiles:r}=this;t.setup(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles.value=this._getRootTiles().filter(n=>{if(t.update(n),n.measures.visible&&(!i||jl(n.extent,i))){if(n.measures.splitPriority>0)return!0;r.push(n)}return!1}).sort($q),this._newTiles.clear(),e.madeProgress()}_splitPendingTiles(e){let t=this._pendingTiles.value;if(!t)return;let{tilingScheme:i,_filterExtentRect:r,_newTiles:n,_measurements:s}=this;for(;t.length>0&&this._tileBudgetExceeded<1;){let o=t.pop();if(e.madeProgress(),o.measures.splitPriority>0){i.ensureMaxLod(o.level+1);let a=o.createChildren();for(let l of a)s.update(l),!l.measures.visible||r&&!jl(l.extent,r)||(l.measures.splitPriority>0?t.push(l):n.push(l));t.sort($q),this._tileBudgetExceeded>=1&&(this._mergeNewTiles(),this._tileBudgetExceeded>=1&&this._mergeNewTiles(!0))}else n.push(o);if(e.done)return}n.pushArray(t),this._pendingTiles.value=null,this._updateTiles(),n.clear(),s.done()}get _tileBudgetExceeded(){return Math.max(0,(this._newTiles.length+(this._pendingTiles.value?.length??0))/ste-1)}_mergeNewTiles(e=!1){let{_newTiles:t,_measurements:i}=this,r=new Map(t.map(s=>[s.id,s])),n=!1;return r.forEach(s=>{let{lij:o,measures:a}=s;if(!a.mergeable||o[1]%2!=0||o[2]%2!=0||o[0]<=1||s.lodLevelDelta>=Bq)return;let l=a.lodLevel,c=l,h=!0,p=r.get(Lw(o[0],o[1]+1,o[2])),m=Math.abs((p?.measures.lodLevel??0)-l),f=m===0||e&&p?.measures.mergeable&&m<=1;if(!p||!f)return;c+=p.measures.lodLevel,h&&=m===0;let g=r.get(Lw(o[0],o[1],o[2]+1));if(m=Math.abs((g?.measures.lodLevel??0)-l),f=m===0||e&&g?.measures.mergeable&&m<=1,!g||!f)return;c+=g.measures.lodLevel,h&&=m===0;let _=r.get(Lw(o[0],o[1]+1,o[2]+1));if(m=Math.abs((_?.measures.lodLevel??0)-l),f=m===0||e&&_?.measures.mergeable&&m<=1,!_||!f)return;c+=_.measures.lodLevel,h&&=m===0,t.removeUnordered(s),t.removeUnordered(p),t.removeUnordered(g),t.removeUnordered(_);let v=new NM(o[0]-1,o[1]/2,o[2]/2,this.tilingScheme);i.update(v),v.measures.visible=!0,v.measures.lodLevel=c/4,v.measures.mergeable=h,t.push(v),n=!0}),n}_updateTiles(){for(;this._mergeNewTiles(););for(;this._tileBudgetExceeded&&this._mergeNewTiles(!0););for(let r of this.tiles.items)r.used=!1;let e=!1,t=this._newTiles.filter(r=>{let n=this._idToTile.get(r.id);return n?(e||=n.measures.lodLevel!==r.measures.lodLevel,n.measures=ie({},r.measures),n.used=!0):this._idToTile.set(r.id,r),!n}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles(),!e||i.length||t.length||this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};function $q(e,t){return e.lodLevelDelta-t.lodLevelDelta||e.measures.splitPriority-t.measures.splitPriority||t.measures.distance-e.measures.distance}u([d({constructOnly:!0})],Tr.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Tr.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Tr.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],Tr.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],Tr.prototype,"focus",void 0),u([d({constructOnly:!0})],Tr.prototype,"viewState",void 0),u([d({constructOnly:!0})],Tr.prototype,"terrain",void 0),u([d()],Tr.prototype,"tiles",void 0),u([d()],Tr.prototype,"tileSize",void 0),u([d({readOnly:!0})],Tr.prototype,"tilingScheme",null),u([d()],Tr.prototype,"filterExtent",null),u([d({readOnly:!0})],Tr.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],Tr.prototype,"_rootTileIds",null),u([d({value:!1})],Tr.prototype,"suspended",null),u([d({readOnly:!0})],Tr.prototype,"updating",null),Tr=u([C("esri.views.3d.layers.support.FeatureTileTree3D")],Tr);var Mi=class extends P{constructor(e){super(e),this._propertiesPool=new kn({camera:Rt},this),this._lastSeenCameraProjectionValues=new Rt,this.mode=pi.ANIMATING,this._cssCamera=new Rt,this._camera=new Rt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.constraints=new hl({state:this}),this.events=new oi,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}reset(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new kn({camera:Rt},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Se.Global){let e=_t(this.spatialReference).radius;this.camera=new Rt({eye:yt(4*e,0,0),center:yt(e,0,0),up:yt(0,0,1)})}else this.camera=new Rt({eye:yt(0,0,100),center:yt(0,0,0),up:yt(0,1,0)})}get animation(){return this.cameraController instanceof Ju&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){let e=this._cssCamera.copyFrom(this.camera),{height:t,width:i,pixelRatio:r}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/r),e.width=Math.round(i/r),e}get camera(){return this._camera}set camera(e){e!==Fo&&Fo.copyFrom(e),Fo.computeUp(this.viewingMode),this.events.emit("before-camera-change",Fo);let t=this._camera;if(ote(this._lastSeenCameraProjectionValues,Fo)&&(this._lastSeenCameraProjectionValues.copyFrom(Fo),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals(Fo)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Fo),this._cameraChanged=!t.almostEquals(Fo),this._cameraChanged)){let i=h2(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===pi.IDLE}get updating(){return this.mode!==pi.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Se.Global}get isLocal(){return this.viewingMode===Se.Local}get viewingMode(){return Gg(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get highlights(){let e=this.view.highlights.items.slice(0,ck);for(let t=0;t<e.length;){let i=e[t],r=e.findIndex(n=>n.name===i.name);r>=0&&t>r?e.splice(t,1):++t}return e}get highlightOrderMap(){let e=new Map;return this.highlights.forEach((t,i)=>e.set(t.name,i)),e}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Zq),this.addHandles(Wi(()=>e.state===Ht.Finished||e.state===Ht.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),Zq),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ht.Rejected)}switchCameraController(e){this.cameraController=e}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;let e=this._updateQueue.shift();Fo.copyFrom(this._get("camera")),e(Fo),this.camera=Fo,this._processingUpdates=!1,this._processUpdateQueue()}};u([d({constructOnly:!0})],Mi.prototype,"view",void 0),u([d()],Mi.prototype,"mode",void 0),u([d({readOnly:!0,type:bn})],Mi.prototype,"animation",null),u([d({type:Rt})],Mi.prototype,"cssCamera",null),u([d()],Mi.prototype,"_cssCamera",void 0),u([d({type:Rt})],Mi.prototype,"camera",null),u([d()],Mi.prototype,"_camera",void 0),u([d({readOnly:!0})],Mi.prototype,"pixelRatio",null),u([d()],Mi.prototype,"rasterPixelRatio",void 0),u([d()],Mi.prototype,"contentPixelRatio",void 0),u([d({readOnly:!0})],Mi.prototype,"alignPixelEnabled",null),u([d({readOnly:!0})],Mi.prototype,"updating",null),u([d({})],Mi.prototype,"_contentCamera",void 0),u([d({type:Rt})],Mi.prototype,"contentCamera",null),u([d({readOnly:!0})],Mi.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Mi.prototype,"events",void 0),u([d({readOnly:!0})],Mi.prototype,"isGlobal",null),u([d({readOnly:!0})],Mi.prototype,"isLocal",null),u([d({readOnly:!0})],Mi.prototype,"viewingMode",null),u([d({readOnly:!0})],Mi.prototype,"highlights",null),u([d({readOnly:!0})],Mi.prototype,"highlightOrderMap",null),u([d({readOnly:!0})],Mi.prototype,"navigating",null),u([d({readOnly:!0})],Mi.prototype,"stationary",null),u([d()],Mi.prototype,"_cameraChanged",void 0),u([d()],Mi.prototype,"cameraController",null),Mi=u([C("esri.views.3d.state.ViewState")],Mi);var Qq=Mi;function ote(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[en.TOP]!==t.padding[en.TOP]||e.padding[en.RIGHT]!==t.padding[en.RIGHT]||e.padding[en.BOTTOM]!==t.padding[en.BOTTOM]||e.padding[en.LEFT]!==t.padding[en.LEFT]}var Fo=new Rt,Zq="ViewStateHandles";var cD=class{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new Nt,this._tolerance=Kp,this._tmpRay=Os(),this._tmpRegion=Yt(),this._validateHUDIntersector=tn(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this._tmpRay),Yq(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Yq(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,n){return i.options.selectionMode=!1,i.options.store=fo.MIN,this.computeIntersection(t,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,n=.5){return t.getRenderCenter(lD,r,n),lD[0]+=.0466,lD[1]-=.0123,Dw(t,lD,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this._tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){let n=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);let n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||uk(n)&&n.intersector!==na.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=Kp){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((i,r)=>i.type===na.TERRAIN?1:r.type===na.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===na.TERRAIN?1:r.type===na.TERRAIN?-1:0)}_getPickRay(t,i){let r=this._view.state.camera;return Ew(r,t,i)}_intersectRayFreePointLocal(t,i){return this.viewingMode!==Se.Local||t==null||he(i,t.origin,ne(fi.get(),t.direction)),!1}intersectElevationFromScreen(t,i,r=0,n=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),i,r,n)}_intersectElevation(t,i,r=0,n=null){if(t==null)return null;let s=this._view,{renderCoordsHelper:o}=s,a=M2(s.spatialReference),l=i!=null?i.mode:"absolute-height",c=Ek(i)/a,h=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:p}=s.state;if(l==="absolute-height"){let D=o?.getAltitude(p.eye),M=ae(ne(Yy,t.direction),o.worldUpAtPosition(p.eye,lte));if(D<h&&M<0||D>=h&&M>0)return null;if(o.intersectInfiniteManifold(t,h,Yy)){let T=FM(s,Yy);return T.z??=0,T.z-=c,T}return null}let m=fi.get();p.projectToRenderScreen(t.origin,m);let f=new uD(null,this._forEachLayer),{slicePlane:g}=s,_=g!=null?aM(g):null,v=tn(this.viewingMode);v.options.store=fo.MIN,v.options.verticalOffset=h,v.options.normalRequired=!1;let b=t.origin,x=he(fi.get(),b,t.direction);v.reset(b,x,p),v.point=m;let E=n?"type"in n&&n.type==="graphics"?D=>D.layerUid!==n.uid:D=>D.graphicUid!==n.uid:null;switch(l){case"relative-to-scene":{let D=M=>(!E||E(M))&&!!M.lastValidElevationBB;v.intersect(f.layers,m,this._tolerance,null,D),this._externalIntersectionHandlers.forAll(M=>{if(M.type===na.I3S||M.type===na.TERRAIN||M.type===na.TILES3D){let T=M.slicePlaneEnabled?_:null;M.intersect(v,T,v.rayBegin,v.rayEnd,m)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(D=>{if(D.isGround){let M=D.slicePlaneEnabled?_:null;D.intersect(v,M,v.rayBegin,v.rayEnd,m)}})}if(v.results.min.getIntersectionPoint(Yy)){let D=FM(s,Yy);return D.z=r,D}return null}computeIntersection(t,i,r,n){if(t==null)return;let s=this._view.state.camera,o=fi.get();s.projectToRenderScreen(t.origin,o);let a=new uD(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);let l=t.origin,c=he(fi.get(),t.origin,t.direction);i.reset(l,c,s),i.intersect(a.layers,o,this._tolerance);let h=this._view.slicePlane,p=h!=null?aM(h):null;i.intersect(a.sliceableLayers,o,this._tolerance,p);let m=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{let v=_.layerUid,b=Array.isArray(v),x=b?v:[v];b&&(i.options.filteredLayerUids=[]);let E=!1;for(let D of x)a.filterLayerUid(D)?E=!0:b&&i.options.filteredLayerUids.push(D);if(i.options.isFiltered=!E,_.isGround&&m||!i.options.isFiltered){let D=_.slicePlaneEnabled?p:null;_.intersect(i,D,l,c,o,n)}});let f=fi.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){let _=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,b=fi.get();this._view.renderCoordsHelper.fromRenderCoords(f,b,g.spatialReference),b[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],v,"ground")??0,_.intersect(i,b,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){let i=t.results.hud;Ng(this._tmpRegion,q2);let r=this._view.state.camera,n=[],s=this._tmpRegion,o=b=>{let x=new fO(b),E=x.result.target.object.geometries.every(D=>D.material instanceof iw&&D.material.parameters.occlusionTest);n.push({item:x,occlusionTest:E}),E&&(r.projectToRenderScreen(b.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),U2(s,x.screenPoint))};t.sortResults(i.all),i.min.dist!=null&&o(i.min);for(let b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);let a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-Ky),h=Math.max(0,s[1]-Ky),p=Math.min(ao(s)+2*Ky,a-c),m=Math.min(Ul(s)+2*Ky,l-h),f=p>0&&m>0?new Uint8Array(p*m*4):null;f&&this._view._stage.renderer.readHUDVisibility(c,h,p,m,f);let g=!0,_=t.results.max.dist==null,v=0;for(let{item:b,occlusionTest:x}of n){let E=!x;if(x&&f)for(let D of ate){let M=4*(Math.min(b.screenPoint[0]+D[0],a)-s[0]+(Math.min(b.screenPoint[1]+D[1],l)-s[1])*p);if(M>=0&&M<f.length&&f[M]){E=!0;break}}E&&(g&&(t.results.min.copy(b.result),g=!1),_&&t.results.max.copy(b.result),t.options.store===fo.ALL&&t.results.all.splice(v++,0,b.result))}}},Ky=1,ate=(()=>{let e=[],t=Ky;for(let i=-1;i<=t;i++)for(let r=-1;r<=t;r++)e.push([r+t,i+t]);return e})(),fO=class{constructor(t){this.result=t,this.screenPoint=Td()}},aD;function Yq(e){return aD&&aD.viewingMode===e||(aD=tn(e)),aD}var uD=class{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t?.include,this.exclude=t?.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){let{include:i,exclude:r}=this;return t==null?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}};function gO(e){return typeof e=="object"&&"intersect"in e}var Yy=w(),lte=w(),lD=Td();var qf=class extends oi.EventedMixin(P){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=G(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,t,i,r,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){let o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&Fa(r,o.spatialReference)&&n===o.queryContext)return o.result}let s=null;return s=dD(s,this._im,e,t,i,r,n),s==null&&(s=dD(s,this._ground,e,t,i,r,n)),n==="scene"&&(s=dD(s,this._scene,e,t,i,r,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:n,result:s}),s}getSphereElevationBounds(e,t,i){let r=new Gp;function n(s){for(let o of s)if(o.getSphereElevationBounds){let a=o.getSphereElevationBounds(e,t,i);a!=null&&r.expandElevationRangeValues(a.elevationRangeMin,a.elevationRangeMax)}}return n(this._ground),n(this._im),i==="scene"&&n(this._scene),r}getRootElevationBounds(){let e=new Gp;for(let t of[this._im,this._ground,this._scene])t.forEach(i=>{if(i.getRootElevationBounds){let r=i.getRootElevationBounds();r!=null&&e.expandElevationRangeValues(r.elevationRangeMin,r.elevationRangeMax)}});return e}async queryElevation(e,t,i,r,n,s=null,o=0){let a=this._getElevationQuery(r);try{let l=await a.queryElevation(e,t,s,o);return n==="scene"?dD(l,this._scene,e,t,i,r,n):l}catch(l){return n2(l),this.getElevation(e,t,i,r,n)}}register(e,t){this.addHandles(t.on("elevation-change",i=>this.emit("elevation-change",i)),t),this._providersFromContext(e).push(t)}unregister(e){this.removeHandles(e);for(let t of[this._im,this._ground,this._scene]){let i=t.indexOf(e);i>-1&&t.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){let t=this._cachedQuery;if(t!=null&&Fa(e,t.spatialReference))return t;t?.destroy({completeTasks:!0});let{wkid:i,wkt:r,wkt2:n,latestWkid:s}=e,o=new UV(this.view.resourceController.scheduler,new Qt({wkid:i,wkt:r,wkt2:n,latestWkid:s}),()=>this.view.map?.ground,{maximumAutoTileRequests:4});return this._cachedQuery=o,o}};function dD(e,t,i,r,n,s,o){for(let a of t){let l=a.getElevation(i,r,n,s,o);l!=null&&(e=e!=null?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],qf.prototype,"view",void 0),u([d()],qf.prototype,"spatialReference",null),qf=u([C("esri.views.3d.support.CombinedElevationProvider")],qf);var Wf=(()=>{class e{static isValidProfile(i){return i in e.profiles}static getDefaultProfile(){return Ct("esri-iPhone")?"low":"medium"}static apply(i,r){let n=e.profiles[i];r.graphics3D.maxTotalNumberOfFeatures=n.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=n.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=n.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=n.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=n.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=n.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=n.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=n.graphics3D.uncompressedTextureDownsamplingEnabled;let s=r.sceneService.object,o=n.sceneService.object;s.lodFactor=o.lodFactor,r.sceneService.point.lodFactor=n.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=n.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=n.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=n.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=n.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=n.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=n.tiledSurface.vtlContentZoom,r.tiledSurface.elevationLevelDelta=n.tiledSurface.elevationLevelDelta,r.tiledSurface.reduceTileLevelDifferences=n.tiledSurface.reduceTileLevelDifferences,r.heatmap.pixelRatio=n.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=n.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=n.fadeDuration,r.antialiasingEnabled=n.antialiasingEnabled,r.physicallyBasedRenderingEnabled=n.physicalBasedRenderingEnabled,r.highQualityTransparency=n.highQualityTransparency,r.highResolutionAtmosphere=n.highResolutionAtmosphere,r.reflections=n.reflections,r.ambientOcclusion=n.ambientOcclusion,r.memoryLimit=n.memoryLimit,r.additionalCacheMemory=n.additionalCacheMemory,r.frameRate=n.frameRate,r.maximumPixelRatio=n.maximumPixelRatio}}return e.test={reset(){let t=Kq();for(let i of Object.keys(t))e.profiles[i]=t[i]}},e})(),Xy={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function Kq(){let e=!!Ct("esri-mobile"),t=!!Ct("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+Xy.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:e},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!Ct("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:e?600+Xy.GalaxyS20:750+Xy.FullHD,additionalCacheMemory:e?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!Ct("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:e?900+Xy.SurfacePro7:1500+Xy.FullHDRetina,additionalCacheMemory:e?-150:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}(function(e){e.profiles=Kq()})(Wf);var Ue;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Ue||(Ue={}));var cd=[Ue.ELEVATION,Ue.MAP];async function Xq(e,t){let{results:i,ground:r}=await bV(e,t),n=(!r.layer||!Og(r.layer.type))&&r.mapPoint,s=[],o=dte(e),a=n?cte(e,o):ute,l=0,c=0,h=()=>{let m=a.layerViews[c];n&&m&&"fetchPopupFeaturesAtLocation"in m&&s.push({mapPoint:r.mapPoint,layerView:m}),++c},p=null;for(;l<i.length||c<a.layerViews.length;){let m=i[l];if(m&&m.type!=="graphic")++l;else if(m?.layer?.type!=="scene"||m?.layer?.parent!==e?.map?.basemap)if(m){let f=m.layer?.uid,g=a.layerUids.has(f)&&m.distance===r.distance,_=o.get(m.layer?.uid);if(p??=m.mapPoint,c<a.layerViews.length&&(g||(m.distance??0)>r.distance)&&a.layerViews[c]!==_){h();continue}s.push({graphic:m.graphic,layerView:_}),++l}else h();else++l}return p??=r.mapPoint,{hits:s,location:p}}function cte(e,t){let i=new Set,r=[];for(let s=e.basemapTerrain.numLayers(Ue.MAP)-1;s>=0;s--){let o=e.basemapTerrain.layerViewByIndex(s,Ue.MAP);i.add(o.layer.uid),r.push(o)}let n=e.basemapTerrain.overlayManager.renderer.layers;for(let{uid:s}of n){let o=t.get(s);o&&(i.add(s),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}var ute={layerUids:new Set,layerViews:[]};function dte(e){let t=new Map;for(let i of e.allLayerViews){let r=i.layer.uid;t.set(r,i)}return t}var Qs=class extends P{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};u([d()],Qs.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Qs.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Qs.prototype,"maxNumberOfDrawCalls",void 0),u([d()],Qs.prototype,"maxTotalNumberOfVertices",void 0),u([d()],Qs.prototype,"snapshotAvailable",void 0),u([d()],Qs.prototype,"polygonLodFactor",void 0),u([d()],Qs.prototype,"polylineLodFactor",void 0),u([d()],Qs.prototype,"skipHighSymbolLods",void 0),u([d()],Qs.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Qs=u([C("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Qs);var Ta=class extends P{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Ta.prototype,"lodFactor",void 0),Ta=u([C("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Ta);var Pc=class extends P{constructor(){super(...arguments),this.object=new Ta,this.point=new Ta,this.integratedMesh=new Ta,this.pointCloud=new Ta,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:Ta})],Pc.prototype,"object",void 0),u([d({type:Ta})],Pc.prototype,"point",void 0),u([d({type:Ta})],Pc.prototype,"integratedMesh",void 0),u([d({type:Ta})],Pc.prototype,"pointCloud",void 0),u([d()],Pc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Pc=u([C("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Pc);var Oc=class extends P{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};u([d()],Oc.prototype,"lodBias",void 0),u([d()],Oc.prototype,"angledSplitBias",void 0),u([d()],Oc.prototype,"vtlContentZoom",void 0),u([d()],Oc.prototype,"elevationLevelDelta",void 0),u([d()],Oc.prototype,"reduceTileLevelDifferences",void 0),Oc=u([C("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Oc);var $f=class extends P{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],$f.prototype,"pixelRatio",void 0),u([d()],$f.prototype,"maxTotalNumberOfFeatures",void 0),$f=u([C("esri.views.3d.support.QualitySettings.HeatmapSettings")],$f);var Yr=class extends P{constructor(){super(...arguments),this.graphics3D=new Qs,this.sceneService=new Pc,this.tiledSurface=new Oc,this.heatmap=new $f,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:Qs})],Yr.prototype,"graphics3D",void 0),u([d({type:Pc})],Yr.prototype,"sceneService",void 0),u([d({type:Oc})],Yr.prototype,"tiledSurface",void 0),u([d({type:$f})],Yr.prototype,"heatmap",void 0),u([d()],Yr.prototype,"fadeDuration",void 0),u([d()],Yr.prototype,"antialiasingEnabled",void 0),u([d()],Yr.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Yr.prototype,"highQualityTransparency",void 0),u([d()],Yr.prototype,"highResolutionAtmosphere",void 0),u([d()],Yr.prototype,"reflections",void 0),u([d()],Yr.prototype,"ambientOcclusion",void 0),u([d()],Yr.prototype,"memoryLimit",void 0),u([d()],Yr.prototype,"additionalCacheMemory",void 0),u([d()],Yr.prototype,"frameRate",void 0),u([d()],Yr.prototype,"maximumPixelRatio",void 0),Yr=u([C("esri.views.3d.support.QualitySettings")],Yr);var _O=Yr;var hD=class{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}},yO=class{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new vO}},vO=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},pD=class{constructor(t,i,r,n){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new yO(s))}destroy(){this._clients.length=0}hasQuota(t){let i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){let i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,n)=>this._taskCallback(r,n))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){let i=this._clients[t.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Xr(i.numWorkers>=0)),this._next()}_next(){for(let t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(let t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){let i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}};var mD=class{constructor(t,i){this.element=t,this.type="image+type",this.isOpaque=i==="image/jpeg"}};var Jy=class extends P{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new pD((r,n)=>this._startLoading(r,n),(r,n)=>this._doneLoadingCB(r,n),e,t),i&&(this._frameTask=i.registerTask(Xt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=kt(this._frameTask),this._tasks.forEach(e=>Mr(e.abortController)),this._loadQueue=G(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){let n=As();n.__signal=r!=null?r.signal:null;let s=this._createOrUpdateTask(e,t,i,r,n);return so(r,()=>this._cancelRequest(s,n)),n.promise}_createTask(e,t,i,r,n,s){let o=new wO(e,t,i,r,n);return this._updateTask(o,s),this._tasks.set(n,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){t0(e.resolvers,t),t.reject(Sr()),e.resolvers.length===0&&(e.status===ko.DOWNLOADING&&(e.status=ko.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=ko.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,n){let s=mte(r?.uid||e,t,i),o=this._tasks.get(s);return o?(this._updateTask(o,n),o):this._createTask(e,r,t,i,s,n)}_doneLoadingCB(e,t){this._loadQueue&&(Xr(e.status===ko.DOWNLOADING),e.status=ko.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){let t=this._onLoadQueue.shift();Bt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){let t=this._doneQueue.shift();t.task.status!==ko.DOWNLOADED&&(t.err=t.err||Sr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Gr(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=am(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(let r of e.resolvers)if(t)Gr(t)?r.reject(t):r.reject(new Be("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;let n=i>0?ro(e.result):e.result;r.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===ko.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=ko.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;let n=e.abortController.signal;e.request=jc(e.url,be(ie({},e.options),{responseType:r,timeout:i,signal:n}));let s=a=>{e.duration=performance.now()-e.startTime,e.size=a instanceof ArrayBuffer?a.byteLength:e.size||0,e.result=a,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},o=a=>{e.status===ko.DOWNLOADING&&t(e,a)};return e.docType!=="image+type"?(e.request.then(a=>s(a.data),o),!0):(e.request.then(a=>{let l=a.data,c=pte(l);if(r="image",e.size=l.byteLength,c==="unknown")return e.request=jc(e.url,{responseType:r,timeout:i,signal:n}),void e.request.then(m=>s(m.data),o);let h=new Blob([l],{type:c}),p=window.URL.createObjectURL(h);e.request=jc(p,{responseType:r,timeout:i,signal:n}),e.request.then(m=>s(new mD(m.data,c)),o).finally(()=>window.URL.revokeObjectURL(p))},o),!0)}get test(){}};u([d({readOnly:!0})],Jy.prototype,"updating",void 0),Jy=u([C("esri.views.3d.support.StreamDataLoader")],Jy);var hte={numRetries:0};function pte(e){if(e.byteLength<2)return"unknown";let t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}var wO=class extends hD{constructor(t,i,r,n,s){super(n),this.url=t,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=ko.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=hte.numRetries}};function mte(e,t,i){return`${e}:${t}:${i}`}var ko;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(ko||(ko={}));var fD=class extends P{constructor(){super(...arguments),this.updating=!1}};function Jq(e){return new Tl({view:e})}u([d({readOnly:!0})],fD.prototype,"updating",void 0),fD=u([C("esri.views.3d.support.ResourceController.ResourceControllerMain")],fD);var Tl=class extends fD{constructor(){super(...arguments),this._immediateTask=xd,this._normalTask=xd,this._updatingObjects=Pn([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=D0(),this._memoryController=R3(this.view),this._streamDataLoader=new Jy,this._streamDataLoader.setup(A3,I3,this._scheduler),this.addHandles([S(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Fe),S(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Kr({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Xt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Xt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=kt(this._frameTask),this._streamDataLoader=G(this._streamDataLoader),this._memoryController=G(this._memoryController),this._scheduler=G(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){let t=this._streamDataLoader;return{request:(i,r,n)=>t.request(i,r,e,n),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){let t=this._updatingObjects;return t.value=[...t.value,e],yr(()=>{t.value=t.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(o0(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.frame(e))}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};u([d()],Tl.prototype,"view",void 0),u([d()],Tl.prototype,"_scheduler",void 0),u([d()],Tl.prototype,"_memoryController",void 0),u([d()],Tl.prototype,"_streamDataLoader",void 0),u([d()],Tl.prototype,"_immediateTask",void 0),u([d()],Tl.prototype,"_normalTask",void 0),u([d({readOnly:!0})],Tl.prototype,"updating",null),Tl=u([C("esri.views.3d.support.ResourceController")],Tl);var gD=class{constructor(t){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer;let i=t.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}};var _D=class{constructor(t){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,t.resourceController!=null){let i=t.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*$L.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=t.quality,this.load=t.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=t.basemapTerrain?.usedMemory??0,this.edgesMemory=t._stage?.renderer.usedMemory.edges??0,this.fboMemory=t._stage?.renderer.usedMemory.fbos??0,t.allLayerViews?.items.forEach(i=>{qV(i)&&this.layerPerformanceInfos.push(new gD(i))}),this.layerPerformanceInfos.sort((i,r)=>r.memory-i.memory)}};var yD=class{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,i,r){let n=r?`gltfPBR:${t}`:`gltf:${t}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):e8(this._gltfLoading,this._gltfMemCache,n,async o=>{let{loadGLTF:a}=await import("./chunk-THC27IVH.js");return a(new yF(o.streamDataRequester),t,o,r)},i)}loadWOSR(t,i){let r=`wosr:${t}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):e8(this._wosrLoading,this._wosrMemCache,r,s=>Sk(t,s),i)}};async function e8(e,t,i,r,n){Bt(n);let s=so(n,()=>fte(e,i)),o=e.get(i);if(o)o.refCount++;else{let a=new AbortController;o={refCount:1,abortController:a,promise:r(be(ie({},n),{signal:a.signal}))},e.set(i,o)}try{let a=await o.promise;return t.put(i,a),e.delete(i),Bt(n),a}finally{kt(s)}}function fte(e,t){let i=e.get(t);i!=null&&--i.refCount>0||(e.delete(t),i?.abortController.abort())}var ud=class extends P{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(Xt.TEXTURE_UNLOAD)??xd}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,t){let i=this.makeUid(e),r=this._textureRequests.get(i);if(!r){let n=new tv;n.texture=t(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(i,n),r=n}return r.referenceCount++,new ev(i,r.texture,()=>this._release(i))}_release(e){let t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;let t=this._textureRequests.get(e);!t||t.referenceCount>0||(t.texture?.unload(),this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return t!=null?`${e}.${t}px`:e}};u([d()],ud.prototype,"_frameTask",void 0),u([d()],ud.prototype,"updating",null),ud=u([C("esri.views.3d.support.TextureCollection")],ud);var ev=class{constructor(t,i,r){this.uid=t,this.texture=i,this.release=r}},tv=class{constructor(){this.referenceCount=0}};var vD=class extends ud{constructor(t,i,r){super(i,r),this._streamDataRequester=t}async fromUrl(t,i,r){Bt(r);let n=r?.signal,s=this.makeUid(t,i),o=this._textureRequests.get(s);if(!o){let a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:s,signal:a.signal});o=new tv,o.abortController=a;let c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async h=>{let p=this._createTexture(t,h,i);return c.texture=p,c.abortController=null,await p.load(this._stage.renderView.renderingContext),this._stage.add(p),new ev(s,p,()=>this._release(s))},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await n0(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(t,i,r){let n={width:i.width,height:i.height,wrap:{s:ji.CLAMP_TO_EDGE,t:ji.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(u0(t)){if(r||i.width===0&&i.height===0){let s=i.width?i.height/i.width:1;r=r||64,s>1?(i.width=Math.round(r/s),i.height=r):(i.width=r,i.height=Math.round(r*s))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new pk(i,n)}};var bD=class{constructor(t){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(s_.SYMBOLOGY),this.objectResourceCache=new yD((r,n)=>t.resourceController.memoryController.newCache(r,n)),this.textures=new vD(this.streamDataRequester,t.view._stage,t.resourceController.scheduler);let i=_t(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=Y0(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=WF(t.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return yr();this._graphicsOwners.push(t);let i=S(()=>t.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),yr(()=>{i.remove(),t0(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){let t=this._graphicsOwners.some(i=>i.layer?.screenSizePerspectiveEnabled===!0);if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Pa;let i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([S(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Fe),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else t||(this._screenSizePerspectiveHandles=G(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){let t=this._pointsOfInterest;wD.distance=t.centerOnSurfaceInfrequent.distance,wD.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(wD),this.screenSizePerspectiveSettingsLabels.update(wD),this._view._stage.renderView.requestRender()}get test(){}},wD={distance:0,fovY:0};var bO=class{constructor(t){this.destination=t}hide(){this.graphic!=null&&(this.destination.remove(this.graphic),this.graphic=null)}},El=class extends bO{constructor(t,i,r=""){super(t),this._symbol=new lF({symbolLayers:new ct([new oF({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new aF({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(t,i){if(!i)return;this.hide();let r=new pt({x:t[0],y:t[1],z:t[2],spatialReference:i});this.graphic=new rs({geometry:r,symbol:this._symbol}),this.destination.add(this.graphic)}};var Ea=class extends P{constructor(e){super(e)}};u([d({constructOnly:!0})],Ea.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Ea.prototype,"surface",void 0),u([d({constructOnly:!0})],Ea.prototype,"state",void 0),Ea=u([C("esri.views.3d.support.pointsOfInterest.PointOfInterest")],Ea);var gte=Array,Vo=class extends Ea{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new kn({location:pt,renderLocation:gte},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=w(),this._tmpPoint=new pt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){let e=()=>this._setDirty();this.addHandles(ir(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=G(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){let e=this._camera,t=ui(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return du(i,t)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){let e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),Ui;let e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);let t=(this._tmpPoint.z??0)>_te&&this.renderCoordsHelper.viewingMode===Se.Global&&(e.isWGS84||e.isWebMercator),i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:t?yte:0}).then(r=>this._updateSurfaceAltitude(r.geometry.z??0)).catch(r=>{Gr(r)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Ui}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(CO,this._estimatedSurfaceAltitude,this._camera.eye),Op(this._get("renderLocation"),CO)||(this._set("renderLocation",ee(this._propertiesPool.get("renderLocation"),CO)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],Vo.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Vo.prototype,"cache",void 0),u([d({constructOnly:!0})],Vo.prototype,"task",void 0),u([d()],Vo.prototype,"location",null),u([d({constructOnly:!0})],Vo.prototype,"map",void 0),u([d()],Vo.prototype,"renderLocation",void 0),u([d()],Vo.prototype,"scale",null),u([d()],Vo.prototype,"updating",null),Vo=u([C("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],Vo);var CO=w(),_te=1e5,yte=1e6;var vte=Array,Ys=class extends Ea{constructor(e){super(e),this._propertiesPool=new kn({location:pt,renderLocation:vte},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=w(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=kt(this._frameWorker),this._propertiesPool=G(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ui}_updateRenderLocation(){let e=bte,t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e),i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));let r=Cte;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ee(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=ui(this._camera.eye,e):(X(e,this._camera.viewForward,this._get("distance")),he(e,e,this._camera.eye)),Op(this._get("renderLocation"),e)||this._set("renderLocation",ee(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){let i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,t))return!1;if(this.state.isGlobal){let r=_t(this.renderCoordsHelper.spatialReference).radius,n=r+e,s=Ar(i.eye),o=s<n*n,a=ui(i.eye,t);if(o&&a>r/4){let l=n-Math.sqrt(s);return X(t,i.viewForward,l),he(t,t,i.eye),!0}}else{let r=this.surface?.ready?this.surface.extent:null;r!=null&&xw(r,this.surface?.spatialReference,iv,this.renderCoordsHelper.spatialReference)&&(t[0]=q(t[0],iv[0],iv[2]),t[1]=q(t[1],iv[1],iv[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(dr.TESTS_DISABLE_OPTIMIZATIONS)return!0;let i=this._camera.eye,r=ui(i,e),n=ui(i,t);if(Math.abs(n-r)/r>wte)return!0}return!1}};u([d({constructOnly:!0})],Ys.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Ys.prototype,"task",void 0),u([d()],Ys.prototype,"distance",void 0),u([d({constructOnly:!0})],Ys.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Ys.prototype,"location",null),u([d({readOnly:!0})],Ys.prototype,"renderLocation",void 0),u([d()],Ys.prototype,"updating",void 0),Ys=u([C("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ys);var wte=.05,bte=w(),Cte=w(),iv=Yt();var CD=class{constructor(t){this._handles=new Pa,this.events=new oi,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=G(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Tte)}},Tte={};var Ete=Array,Ho=class extends Ea{constructor(e){super(e),this._propertiesPool=new kn({location:pt,renderLocation:Ete},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([S(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),S(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Xt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=G(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){let e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){let{camera:e,contentPixelRatio:t}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/t)}get running(){return this._dirty}runTask(){let e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,t8);let n=Math.max(0,(Math.acos(ae(t8,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!$c(e,t)){let l=this._propertiesPool.get("renderLocation");ee(l,t),this._set("renderLocation",l)}return Ui}let s=1-q(n/(.5*Math.PI),0,1),o=s*s*s;this._calculateScreenHorizontalEdgeOnSurface(i8);let a=this._propertiesPool.get("renderLocation");return ni(a,t,i8,o),e&&$c(e,a)||this._set("renderLocation",a),Ui}_calculateScreenHorizontalEdgeOnSurface(e){let t=this.state.contentCamera,i=t.getRenderCenter(Td());if(i[1]=t.aboveGround?t.padding[en.BOTTOM]:t.fullHeight-t.padding[en.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;let r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,rv)){ve(rv,rv,t.eye);let n=ne(rv,rv);if(this.renderCoordsHelper.intersectInfiniteManifold(ia(t.eye,n),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Ho.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Ho.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Ho.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Ho.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d()],Ho.prototype,"updating",null),u([d()],Ho.prototype,"location",null),u([d()],Ho.prototype,"renderLocation",void 0),u([d()],Ho.prototype,"worldUnitsPerContentPixel",null),Ho=u([C("esri.views.3d.support.pointsOfInterest.Focus")],Ho);var t8=w(),rv=w(),i8=w();var Dl=class extends P{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;let e=w();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([S(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),ir(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),this.surfaceView?.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);let e=y0(this.surfaceView.extent),t=new pt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{})):this._set("location",t)}};u([d({constructOnly:!0})],Dl.prototype,"view",void 0),u([d({constructOnly:!0})],Dl.prototype,"cache",void 0),u([d()],Dl.prototype,"surface",null),u([d()],Dl.prototype,"surfaceView",null),u([d({readOnly:!0})],Dl.prototype,"location",void 0),u([d({readOnly:!0})],Dl.prototype,"renderLocation",null),Dl=u([C("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],Dl);var xl=class extends P{constructor(e){super(e),this._tileGeometryUpdateExtent=Yo(),this._tileGeometryUpdateSpatialReference=null,this.events=new oi,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Xt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Dte),Yo(this._tileGeometryUpdateExtent),this._set("updating",!1),Ui):Ui}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,ka(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){let i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){let i=this.state.contentCamera.eye,r=xte,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,tp,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,ip,t),tp[0]<ip[0]?(r[0]=tp[0],r[2]=ip[0]):(r[0]=ip[0],r[2]=tp[0]),tp[1]<ip[1]?(r[1]=tp[1],r[3]=ip[1]):(r[1]=ip[1],r[3]=tp[1]),jl(r,e)}};u([d({constructOnly:!0})],xl.prototype,"state",void 0),u([d({constructOnly:!0})],xl.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],xl.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],xl.prototype,"scheduler",void 0),u([d({constructOnly:!0})],xl.prototype,"surface",void 0),u([d({readOnly:!0})],xl.prototype,"updating",void 0),xl=u([C("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],xl);var Dte={},tp=w(),ip=w(),xte=Yo();var Mn=class extends P{constructor(e){super(e),this.renderPointOfView=w(),this._pois=new Array,this._debugCenters=null,this._tmpRay=Os(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new kn({renderPointOfView:Mte},this)}initialize(){let{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=tn(e.viewingMode),this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=fo.MIN,this._contentIntersector=tn(e.viewingMode);let n=()=>this._estimateSurfaceAltitudeAtCenter(),s=this.view.resourceController.scheduler,o=this.view.basemapTerrain?.elevationQueryCache,a={state:e,scheduler:s,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Ys(be(ie({},a),{task:Xt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("centerOnSurfaceFrequent",new Ys(be(ie({},a),{task:Xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("centerOnContent",new Ys(be(ie({},a),{task:Xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new Vo(be(ie({},a),{cache:o,task:Xt.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("surfaceGeometryUpdates",new xl(be(ie({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new CD({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new Dl({cache:o,view:this.view})),this._set("focus",new Ho({state:e,scheduler:s,surface:t,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(l,c)=>this._estimateSurfaceIntersectionAtRenderPoint(l,this.view.state.contentCamera,c)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus),this.addHandles([S(()=>e.contentCamera,l=>this._cameraChanged(l),Fe),S(()=>t.extent,()=>this._updateCenterPointsOfInterest()),S(()=>this.view.map?.ground?.navigationConstraint?.type,l=>{this._surfaceIntersector.options.backfacesTerrain=l==="none"},Re),Wi(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Fe),ir(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ir(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),S(()=>dr.SHOW_POI,l=>this._setDebug(l),Re)]),this._cameraChanged(this.view.state.contentCamera);for(let l of this._pois)l.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(let e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;let e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Zf,Ite)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Zf):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;let e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;let t=e.origin,i=he(Zf,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Zf)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Zf)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){let r=Dw(t,e,Ste);if(r==null)return null;let n=r.origin,s=he(Zf,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,s),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();let t=e.eye;Op(this.renderPointOfView,t)||this._set("renderPointOfView",ee(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(let e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters?.forEach(t=>t.hide()),void this.removeHandles("debug");if(!this._debugCenters){this._debugCenters=new Map;let t=this.view.graphics;this._debugCenters.set(this.centerOnContent,new El(t,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new El(t,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new El(t,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new El(t,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new El(t,"green","Focus"))}for(let t of this._pois)this.addHandles(S(()=>t.renderLocation,i=>this._debugCenters?.get(t)?.show(i,t.renderCoordsHelper.spatialReference),Re),"debug")}get test(){}};u([d()],Mn.prototype,"centerOnContent",void 0),u([d()],Mn.prototype,"centerOnSurfaceFrequent",void 0),u([d()],Mn.prototype,"centerOnSurfaceInfrequent",void 0),u([d()],Mn.prototype,"cameraOnSurface",void 0),u([d()],Mn.prototype,"focus",void 0),u([d()],Mn.prototype,"renderPointOfView",void 0),u([d()],Mn.prototype,"surfaceOrigin",void 0),u([d()],Mn.prototype,"contentGeometryUpdates",void 0),u([d()],Mn.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Mn.prototype,"view",void 0),u([d()],Mn.prototype,"updating",null),Mn=u([C("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Mn);var Mte=Array,Zf=w(),Ste=Os(),Ite={exclude:new Set([Zl])};var Ate=()=>W.getLogger("esri/core/MemCachePool"),Bo=class{constructor(t,i){this._cache=t(i,(r,n,s)=>{switch(n){case qx.ALL:return r.forEach(o=>o.dispose()),0;case qx.SOME:{let o=r.shift();return o?(s-=Math.round(o.cachedMemory),o.dispose()):s>0&&(Ate().warn("Encountered empty MemCachePool with non-zero memory."),s=0),s}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(t){return this._cache.getSize(t)}pop(t){let i=this._cache.peek(t);if(!i)return;let r=i.pop();return i.length>0?r&&(i.cachedMemory=this._cache.getSize(t)-Math.round(r.cachedMemory),this._cache.updateSize(t,i)):this._cache.pop(t),r}put(t,i,r=aL){let n=this._cache.peek(t);if(n)n.push(i),n.cachedMemory=this._cache.getSize(t)+Math.round(i.cachedMemory),this._cache.updateSize(t,n);else{let s=new TO(i);this._cache.put(t,s,r)}}},TO=class extends Array{constructor(t){super(),this.item=t,this.cachedMemory=t.cachedMemory,this.push(t)}};var TD=class{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,i){this._store.put(t,i)}};var Ml=class{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}};var ED=class{constructor(t,i,r){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i,this.samplerData=new Ok(r,i)}computeMinMaxValue(t,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;let s=t-this.level;if(s<=0)return n;let o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0,c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*i_,m=(c-1)/o,f=(r-this.j*o)*m,g=(i-this.i*o)*m;if(m<1){let _=Math.floor(f),v=Math.floor(g),b=_+v*c,x=h[b],E=h[b+1],D=h[b+c],M=h[b+c+1];if(x+E+D+M<p){let T=f-_,I=g-v,A=zg(x,E,D,M,T,I),O=zg(x,E,D,M,T+m,I),$=zg(x,E,D,M,T,I+m),H=zg(x,E,D,M,T+m,I+m);return n.min=Math.min(A,O,$,H),n.max=Math.max(A,O,$,H),n}f=_,g=v,m=1}else f=Math.floor(f),g=Math.floor(g),m=Math.ceil(m);for(let _=f;_<=f+m;_++)for(let v=g;v<=g+m;v++){let b=h[_+v*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}},Rte=.5*i_;function gi(e,t,i){if(i==null)return null;for(let r of i){if(!r)continue;let n=r.safeWidth,s=q(r.dy*(r.y1-t),0,n),o=q(r.dx*(e-r.x0),0,n),a=Math.floor(s),l=Math.floor(o),c=r.data.width,h=a*c+l,p=r.data.values,m=p[h],f=p[h+1],g=h+c,_=p[g],v=p[g+1];if(m+_+f+v<Rte){s-=a,o-=l;let b=m+(f-m)*o;return b+(_+(v-_)*o-b)*s}}return null}var Uo=class extends P{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){let e=[];return this.layerViews.forEach(t=>{let i=t.layer;if("operationalLayerType"in i&&F2(i.operationalLayerType)&&this.viewSpatialReference!=null){let r=n8(i.fullExtent,this.viewSpatialReference);r!=null&&e.push(B2(r))}}),e}};function r8(e,t){return e===Se.Global?new EO(t):new DO(t)}u([d({readOnly:!0})],Uo.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Uo.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Uo.prototype,"stencilEnabledExtents",null),u([d()],Uo.prototype,"viewSpatialReference",void 0),u([d()],Uo.prototype,"tilingScheme",void 0),u([d()],Uo.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Uo.prototype,"layers",void 0),u([d({constructOnly:!0})],Uo.prototype,"layerViews",void 0),Uo=u([C("esri.views.3d.terrain.ExtentHelper")],Uo);var EO=class extends Uo{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?u3:d3}};EO=u([C("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],EO);var DO=class extends Uo{_computeLayerViewsExtent(){let e=Yo(),t=this.viewSpatialReference;this.layerViews.forEach(n=>{let s=n.layer;if(n.isResolved()&&(s.type!=="graphics"||!s.internal)){let o=n8("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,t);ka(e,o,e)}});let i=Hx(e)?e:null,r=this._get("layerViewsExtent");return Ko(i,r)?r:i}_computeTiledLayersExtent(){let e=this.tilingScheme;if(!e)return null;let t=this.viewSpatialReference,i=Yo();this.layers.forEach(s=>{if(s.loaded&&Gc(s)){let o=zd(s,t,Se.Local);if(o==null)return;let{tileInfo:a,fullExtent:l}=o,c="tilemapCache"in s?s.tilemapCache?.effectiveMaxLOD:void 0;a!=null&&l!=null&&(Nw(s)||e.compatibleWith(a,c)&&l.spatialReference.equals(e.spatialReference))&&ka(i,l,i)}}),ka(i,this.defaultTiledLayersExtent,i);let r=Hx(i)?i:null,n=this._get("tiledLayersExtent");return Ko(r,n)?n:r}};function n8(e,t){return e==null||e.spatialReference.equals(t)?e:IL(e,e.spatialReference,t)}DO=u([C("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],DO);function DD(){let e=globalThis.require?.modules;if(e){let t=Object.keys(e);for(let i of t)i.includes(".glsl")&&delete e[i]}}var nv=class{constructor(t,i){this.screen=t,this.olid=i}};var s8=1.3,Pte=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],dd,Sn=class extends P{constructor(e){super(e),this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._latestOriginId=0,this._maxResolution=Ct("esri-mobile")?2048:4096}initialize(){let e=this.view;this.renderer=new VV({parent:this}),e._stage.renderer.plugins.add(this.renderer);let t=()=>this.requestRender();this._groundIntersector=tn(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([S(()=>this.renderer.hasHighlights,t),this.renderer.events.on("has-water",()=>e._stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",t),S(()=>e.state.camera.pixelRatio,t),S(()=>e.state.alignPixelEnabled,t),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),S(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),S(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Fe),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Xt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(Jn,i.camera,Pe.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Pe.BACKGROUND,i)})]),e._stage.renderer.overlay=this}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null),dd&&(dd.hide(),dd=null),this.renderer=G(this.renderer)}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.renderer.longitudeCyclical=null;let t=this.view.renderSpatialReference;e!=null&&t!=null?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this.renderer.longitudeCyclical=e.isWebMercator?new dM(-20037508342787e-6,20037508342787e-6):new dM(-180,180))):this.renderer.disposeOverlays()}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||dr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?_t(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return s8/this.view.resolutionScale}get _longitudeCyclical(){return this.renderer.longitudeCyclical}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._precompileShaders()?this._drawOverlays(Pe.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);let r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,U3)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.requestRender()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Pe.UPDATE)}_updateOverlays(e,t,i){if(!this._spatialReference)return Ui;let r=this._computeOverlayResolution(t);this._computeOverlayExtents(t,r,Sl),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Sl.stretch);let n=this._updateOverlay(aa.INNER,Sl.inner,r,1*Sl.pixelRatioAdjustment,Sl.mapUnitsPerPixel),s=ao(Sl.inner)/ao(Sl.outer),o=this._updateOverlay(aa.OUTER,Sl.outer,r,s*Sl.pixelRatioAdjustment,Sl.mapUnitsPerPixel);n!==Il.EXTENT&&o!==Il.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.updateOverlayParameters(i)),n===Il.NONE&&o===Il.NONE||this.requestRender(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){let t=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*t,r=e.fullHeight/e.pixelRatio*t,n=Math.ceil(1.5*Math.max(i,r));return Math.min(su(n),this._maxResolution)}_updateOverlay(e,t,i,r,n){if(this.renderer.overlays.length===0)return Il.NONE;let s=this.renderer.overlays[e],o=s.mapUnitsPerPixel;if(s.mapUnitsPerPixel=n,s.pixelRatio=r,Ote(t,s.extent)&&i===s.resolution)return o===n?Il.NONE:Il.RERENDER_ONLY;Ng(s.extent,t),s.resolution=i;let a=y0(s.extent);return s.renderLocalOrigin=EV(a[0],a[1],0,"OV_"+this._latestOriginId++),Il.EXTENT}updateOverlayParameters(e){this.surface.allTiles.forAll(t=>this.updateTileOverlayParameters(t)),this.surface.requestRender(e)}updateTileOverlayParameters(e){if(!e.renderData)return;let t=e.renderData.overlay;if(this.renderer.overlays.length===0)this._clearTileOverlayData(aa.INNER,t),this._clearTileOverlayData(aa.OUTER,t);else{let[i,r]=this.renderer.overlays,n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,r.extent)?(this._setTileOverlayData(n,aa.INNER,t),this._setTileOverlayData(n,aa.OUTER,t)):(this._clearTileOverlayData(aa.INNER,t),this._clearTileOverlayData(aa.OUTER,t))}}overlayPixelSizeInMapUnits(e,t){if(this.renderer.overlays.length===0)return t();let i=this.renderer.overlays[aa.INNER],r=this.renderer.overlays[aa.OUTER],n=this._pointIsInExtent(e,i.extent)?i:r;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;let r=this.renderer.overlays[t].extent,n=ao(r),s=Ul(r),o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);let a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,ao(e)/n,Ul(e)/s),i.setOffset(t,(o-r[0])/n,(e[1]-r[1])/s)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}reloadShaders(){DD(),this.requestRender(),this.runTask(Jn)}requestRender(e=Pe.UPDATE){this.renderer.hasOverlays?(e===Pe.UPDATE?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this._drawTexturesAnimateDirty=!0,this.view._stage.renderView.requestRender(e)):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r,n){let s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Fte,t,i);if(s==null)return!1;let o=s.origin,a=he(xD,s.origin,s.direction);this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a);let l=this._groundIntersector.results.min;return l.getIntersectionPoint(n)&&l.withinDistance(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5,r=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),s=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=q(s.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){let c=xD;Jc(jp(zp,_t(this.view.spatialReference).radius+a),ia(e.eye,e.viewForward),c),ve(c,c,e.eye);let h=oa.normalize(hF(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{let c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=pn(0,h,1,0),m=Vg(p,p,e.projectionMatrix)[1],f=q(.5+.5*m,0,1);i=f===1||f===0?.5:l?f*r:1-(1-f)*r}return this._intersectGroundFromView(e,.5,i,s.distance,t)}_computeOverlayExtents(e,t,i){let r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=w();this._findHorizonBasedPointOfInterest(e,n)||ee(n,r),dr.OVERLAY_SHOW_CENTER?(dd==null&&(dd=new El(this.view.graphics,"red")),dd.show(n,this._renderSR)):dd?.hide();let s=Math.max(.1,ui(e.eye,n)),o=la(this.view.renderCoordsHelper,r,e.eye);this._overlaySREqualsRenderSR||Ua(n,this._renderSR,n,this._spatialReference);let a=this.surface.extent,l=!this._isSpherical&&this._spatialReference?.isGeographic,c=l&&this._spatialReference?1/_t(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*s*c;i.mapUnitsPerPixel=p/this.worldToPCSRatio,i.stretch=this._overlayStretch;let m=t*p/2*i.stretch,f=!1,g=l?90:1/0;this._isSpherical&&a&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(I2(n[1])),g=a[3]):(f=!0,m/=_t(this._spatialReference).metersPerDegree,g=90),m>=g&&(m=g,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let _=1;f&&(_=1/Math.max(.2,Math.cos(Math.abs(Vt(n[1])))),m*_>180&&(_=180/m),i.mapUnitsPerPixel*=_);let v=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/v)*v);let b=m*_,x=32,E=.5*t/(x*b),D=.5*t/(x*m);n[0]=Math.round(n[0]*E)/E,n[1]=Math.round(n[1]*D)/D;let M=i.inner;M[0]=n[0]-b,M[1]=n[1]-m,M[2]=n[0]+b,M[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(M,1/0,g);let T=i.outer;if(6*b>ao(a))Ng(T,a);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)T[0]=M[0]-b,T[1]=M[1]-m,T[2]=M[2]+b,T[3]=M[3]+m;else{Ua(e.eye,this._renderSR,xD,this._spatialReference),x0(rp,n,xD);let A=-Math.atan2(rp[1],rp[0])+.125*Math.PI;A<0&&(A+=2*Math.PI);let O=Math.floor(A/(.25*Math.PI));T0(rp,Pte[O],2*m),rp[0]*=_,rp[2]*=_,wL(T,M,rp)}if(this._isSpherical)T[0]=this._longitudeCyclical.clamp(T[0]),T[2]=this._longitudeCyclical.clamp(T[2]),T[1]=Math.max(T[1],-g),T[3]=Math.min(T[3],g);else{let A=Lg(M,a,Nte),O=Lg(T,a,Lte);Ux(A,O)&&(T[2]=T[0],T[3]=T[1])}let I=Math.abs(M[2]-M[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_precompileShaders(){return!!this.renderer.hasOverlays&&(this.renderer.precompileShaders(this.view.state),!0)}_drawOverlays(e,t=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;let i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;let r=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(t),r!==this.renderer.computeValidity()&&this.updateOverlayParameters(Pe.UPDATE),i?(this.surface.requestRender(e),e===Pe.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Pe.BACKGROUND),this.renderer}_rectanglesOverlap(e,t){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):jl(e,t))}_rectInsideRect(e,t){return t!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Ux(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];let i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,n=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),v0(e,r,n)}get test(){}};function Ote(e,t){let r=dr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],Sn.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Sn.prototype,"running",null),u([d()],Sn.prototype,"_placementDirty",void 0),u([d()],Sn.prototype,"_contentUpdated",void 0),u([d()],Sn.prototype,"_isSpherical",null),u([d()],Sn.prototype,"worldToPCSRatio",null),u([d()],Sn.prototype,"renderer",void 0),u([d({constructOnly:!0})],Sn.prototype,"view",void 0),u([d({constructOnly:!0})],Sn.prototype,"surface",void 0),u([d()],Sn.prototype,"suspended",null),u([d()],Sn.prototype,"updating",null),u([d({type:Boolean})],Sn.prototype,"rendersOccludedDraped",null),Sn=u([C("esri.views.3d.terrain.OverlayManager")],Sn);var xO=class{constructor(){this.inner=Yt(),this.outer=Yt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=s8}},rp=Qi(),xD=w(),Sl=new xO,Nte=Yt(),Lte=Yt(),Fte=Os(),Il;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Il||(Il={}));var MD=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=zl(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=ki(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,zl(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(t){return this.outerEdgesOffsetAndLength[2*t]}getEdgeCount(t){return this.outerEdgesOffsetAndLength[2*t+1]}getEdgeVertexIndex(t,i){return this.getEdgeAttributeIndex(t,i)}getEdgeVertexPosition(t,i,r,n){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(t,n),i),he(i,i,r)}getEdgeNormal(t,i,r){let{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;HL(i,n,this.getEdgeAttributeIndex(t,r),s)}setEdgeNormalFromValues(t,i,r,n,s){this._setNormal(this.getEdgeAttributeIndex(t,i),r,n,s)}setEdgeVertexFromValuesRawPositionUV(t,i,r,n,s,o,a){let l=this.getEdgeAttributeIndex(t,i);this.vertexAttributes.position.setValues(l,r,n,s),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(t,i,r,n,s,o,a,l,c,h){let p=this.getEdgeAttributeIndex(t,i);this.vertexAttributes.position.setValues(p,r,n,s),this._setUV(p,o,a),this._setNormal(p,l,c,h)}_getEdgeVertexRaw(t,i){this.vertexAttributes.position.getVec(t,i)}_setNormal(t,i,r,n){let{typedBuffer:s,typedBufferStride:o}=this.vertexAttributes.normalCompressed;Od(s,t,i,r,n,o)}_setUV(t,i,r){jo(this.vertexAttributes.uv0,t,i,r)}getEdgeAttributeIndex(t,i){return te(0<=i&&i<this.getEdgeCount(t)),this.getEdgeFirstVertexIndex(t)+i}},o8=16384;function jo(e,t,i,r){e.setValues(t,i*o8,r*o8)}var SD=class{constructor(){this.sinLonLUT=new Array(jd+1),this.cosLonLUT=new Array(jd+1),this.sinLatLUT=new Array(jd+1),this.cosLatLUT=new Array(jd+1)}update(t,i,r){let n=i[0],s=i[2];for(let o=0;o<=t;o++){let a=o/t,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);let c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}};var ID=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}};var sv=class e{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=G(this._current),this._next=G(this._next),this._waiting=G(this._waiting),this._delayed=G(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){let i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=e.test.fadeMoment;if(this._delayed!=null&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Al.Immediate),this._delayed=null)),this._next!=null){t=t||performance.now();let i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==di.FADING,s=t-this._fadeStart>=i;(r||n||s)&&(G(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;let t=e.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(t,i=Al.Immediate){this._delayed=G(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=t);let r=e.test.fadeMoment||performance.now();return i!==Al.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):this._next==null?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(t!=null&&(G(this._waiting),this._waiting=t))}get _fadeDuration(){let t=this._getFadeDuration();return this._waiting?.5*t:t}_alignFadeStart(t){let i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}},Al;sv.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Al||(Al={}));var hd=class{constructor(t,i,r,n,s,o){this.texture=t,this.type=i,this.offsetAndScale=r,t.retain(),this.opacities=yt(n,s,o)}destroy(){this.texture.release()}};var AD=class{constructor(){this._scales=pn(-1,-1,-1,-1),this._offsets=pn(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};var RD=class extends ft{constructor(t,i){super(t,i,new mt(oH,()=>import("./chunk-5R6UDWLA.js")),MO),this.type="TerrainTechnique",this.useStencil=!1}initializePipeline(t){return this._stencilPipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}_createPipeline(t,i){let{renderOccluded:r,output:n}=t,s=t.backfaceCullingEnabled&&!r;return Tt({blending:r?Qp:null,culling:s?K0:null,depthTest:r?null:{func:Ei.LESS},depthWrite:r?null:QF,colorWrite:St,stencilTest:i?YF(W0.IntegratedMeshMaskExcluded):null,drawBuffers:n===oe.Depth?{buffers:[FL.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}},MO=new Map([[yi.POSITION,0],[yi.UV0,1],[yi.NORMALCOMPRESSED,2]]);var PD=class{constructor(){this.geometry=new MD,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureOpacity=1,this._textureRef=new sv(()=>this._tile.surface.fadeDuration),this.overlay=new AD,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(t,i){this.clear(),this._tile=t,this.geometry.reset(),this.intersectionData=null,this.geometryState=new ID,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),Ki&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)te(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(t,i){let r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){let l=r.surface.extent;if(l!=null&&(t===0&&r.extent[3]>l[3]||t===1&&r.extent[2]>l[2]||t===2&&r.extent[1]<l[1]||t===3&&r.extent[0]<l[0]))return n}let s=r.level,o=Hn[t];if(!i)return te(r.surface?.rootTiles==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.loaded){let l=i,c=l.renderData.geometryState,h=s-l.level;if(te(h>=0),h===0){let f=c.numVerticesPerSide-1;return Math.max(f,n)}let p=2**h,m=c.edgeResolutions[(t+2)%4]/p;return Math.max(1,m)}te(!i.leaf);let a=n;return i.forAllSubtreeOnSide(dm(o),l=>l===r||(l.loaded?(a=Math.max(a,2**(l.level-s)),!0):(te(!l.leaf),!1))),a}updateNeighborData(){let t=this.tile;if(!t.intersectsClippingArea)return;let i=t.renderData.geometryState,r=o=>(o.loaded||o.level===t.level)&&o?.intersectsClippingArea,n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let o=0;o<4;++o){let a=t.findNeighborTile(Hn[o],r),l=pd(t,a),c=l?.renderData?.geometryState.samplerDataVersion??-1,h=n[o],p=l!==pd(t,h),m=s[o]!==c;Ki&&a&&(te(t.level>=a.level),te(t.level-a.level<=Gi)),n[o]=a,(p||m)&&(s[o]=c,this._markEdgeDirty(o));let f=i.edgeResolutions[o],g=this._calculateEdgeResolution(o,a);te(Cd(g)),te(g>=1),i.edgeResolutions[o]=g,f!==g&&this._markEdgeResolutionDirty(o)}for(let o=0;o<4;++o){let a=t.findNeighborTile(Gd[o],r);i.cornerPeerNeighbors[o]=a;let l=pd(t,n[o]),c=pd(t,n[(o+1)%4]),h=pd(t,a);Da[o]=h,Da[(o+1)%4]=c,Da[(o+2)%4]=t,Da[(o+3)%4]=l,te(Da.some(g=>g?.loaded||g===t));let p=Da.reduce((g,_)=>Math.min(g,_?.level??1/0),1/0);Da.forEach((g,_)=>{g&&g?.level>p&&(Da[_]=null)}),te(Da.some(g=>g?.loaded||g===t));let m=i.cornerNeighborCornerTiles,f=i.cornerNeighborCornerTileSamplerVersions;for(let g=0;g<4;++g){let _=Da[g],v=_?.renderData.geometryState.samplerDataVersion??-1,b=4*o+g,x=m[b]!==_,E=!x&&f[b]!==v;(x||E)&&(m[b]=_,f[b]=v,this._markCornerDirty(o))}Ki&&te(OD.some(g=>m[4*o+g]?.loaded||m[4*o+g]===t))}Ki&&te(this.geometryState.edgeResolutions.every(o=>o>0));for(let o=0;o<4;++o)Da[o]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;Ki&&te(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;let{tile:i,_vao:r,geometry:n,geometryState:s}=this,o=!r||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=s.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>(n?.maxEdgeVertexCount??0),h=!c&&a,p=!h&&(this.dirtyEdges!==0||a),m=!p&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(t)):h?i.updateEdgeElevationsAndResolutions():p||m?i.updateEdgeElevations():m?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=We(this._vao),this.geometry.release(),!0)}ensureTexture(t,i,r,n){let s=i?mi.RGBA:mi.RGB;return this._texture!=null&&(r===di.FADING&&this._tile.surface.fadeDuration>0&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==t||this._texture.descriptor.pixelFormat!==s)&&this.releaseTexture(),this._texture==null&&(this._texture=n(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(t,i){return!(!t||!this._texture)&&(t.setTextureReference(new hd(this._texture,di.FADING,i,this._textureOpacity,0,1)),!0)}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&Vte)}get samplerDataChanged(){return!!(this._modifiedFlags&Hte)}get clippingAreaChanged(){return!!(this._modifiedFlags&Bte)}get wireframeChanged(){return!!(this._modifiedFlags&Ute)}get dirtyEdges(){return this._modifiedFlags>>SO&15}get dirtyCorners(){return this._modifiedFlags>>IO&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>AO&15}_markCornerDirty(t){let i=1<<t<<IO;this._modifiedFlags|=i}_markEdgeDirty(t){let i=1<<t<<SO;this._modifiedFlags|=i,this._markCornerDirty((t+0)%4),this._markCornerDirty((t+3)%4)}_markEdgeResolutionDirty(t){let i=1<<t<<AO;this._modifiedFlags|=i,this._markEdgeDirty(t)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<IO|15<<SO|15<<AO}updateGeometryState(){let t=this._elevationInfo,i=this.tile,r=t.samplerData?i.getElevationVerticesPerSide(t.maxTileLevel):i.minimumVerticesPerSide,n=Math.max(r,5),s=i.clippingArea;i.intersectsClippingArea&&!i.withinClippingArea||(s=null);let o=this.geometryState,a=!1;o.numVerticesPerSide!==n&&(this._modifiedFlags|=1,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),t.changed&&(this._modifiedFlags|=2,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),e0(o.clippingArea,s)||(this._modifiedFlags=4,o.clippingArea=s,a=!0);let l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||=a,a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();let i=this.geometry.vertexAttributes,r=this.geometry.indices,n=t.gl;this._vao=new ns(t,MO,new Map([["geometry",is(i.layout)]]),new Map([["geometry",wr.createVertex(t,n.STATIC_DRAW,i.buffer)]]),wr.createIndex(t,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(t,i=Al.Immediate){t?.texture===this._texture?this._textureOpacity=t.opacities[0]:this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(t){return this._textureRef.current?.texture===t||this._textureRef.next?.texture===t&&this._textureRef.fadeFactor<1}get _elevationInfo(){let t=this.geometryState.samplerData,i=this.tile.layerInfo[Ue.ELEVATION],r=i.length,n=new Array(r),s=0,o=0,a=!1;for(let h=0;h<r;h++){let p=i[h],m=p.upsampleInfo?.tile;if(m){let f=m.layerInfo[Ue.ELEVATION][h].data,g=f&&f.samplerData;t&&t[s]===g||(a=!0),n[s++]=g,o=Math.max(o,m.lij[0])}else if(p.data){let f=this.tile.surface.layerViewByIndex(h,Ue.ELEVATION);if(ca(this.tile,f)){let g=p.data;t&&t[s]===g.samplerData||(a=!0),n[s++]=g.samplerData,o=this.tile.level}}}t!=null&&t.length!==s&&(a=!0);let l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){let t=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+t}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!Ki)return;let t=this.tile;if(!t.loaded||!t.intersectsClippingArea||t.level===0)return void te(t?.loaded);let i=t.surface.extent;if(i!=null&&!t.intersectsExtent(i))return;let r=Hn.map((a,l)=>i!=null&&(l<2?-1:1)*(t.extent[3-l]-i[3-l])<0),n=t.level;te(this.dirtyCorners===0),te(this.dirtyEdges===0),te(this.dirtyEdgeResolutions===0),te(!this.numVerticesPerSideChanged),te(!this.samplerDataChanged),te(!this.clippingAreaChanged),te(!this.wireframeChanged);let s=Gd.map(a=>t.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.loaded||l.level===t.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){let l=o.cornerPeerNeighbors[a],c=s[a];te(c===l,`Tile[${t.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Hn.forEach((a,l)=>{if(r[l])return;let c=t.findNeighborTile(a,Ie=>(Ie.level===n||Ie?.loaded)&&Ie?.intersectsClippingArea);if(!c){let Ie=!t.surface.updatingRootTiles&&t.surface.rootTiles!=null&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(a);return void te(!Ie)}te(c.loaded||c.level===t.level),te(c===this.geometryState.edgePeerNeighbors[l]);let h=n-c.level;if(!c.loaded)return te(!c.leaf),void te(h===0);let p=c.renderData;te(t.isEdgeNeighbor(c,a)),te(h>=0);let m=2**h;if(h<0)return void te(!1);let f=t.renderData,g=f.geometry,_=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,x=p.geometry;if(!x)return void te(!1);let E=p.localOrigin,D=this.geometryState.edgePeerNeighbors[l];if(D?.loaded){let Ie=D.renderData;te(f.geometryState.edgePeerNeighborSamplerVersions[l]===Ie.geometryState.samplerDataVersion),te(this.geometryState.edgePeerNeighborSamplerVersions[l]===Ie.geometryState.samplerDataVersion)}let M=(l+2)%4,T=x.getEdgeCount(M),I=v-1,A=T-1;te(I*m===A,`Tile[${t.lij}]:e${l},res=${I} edgeRes mismatch with Neighbor[${c.lij}]:e${M},res=${A} (expected:${I*m})`);let O=t.extent,$=a===ii.NORTH||a===ii.SOUTH,H=T-1,k=H>>h,K=v-1;if(k<1)return void te(K===1);te(k===K),te(Cd(k));let F=x.numVerticesPerSide-1;te(h>0||k===Math.max(F,b));let R=t.getNeighborEdgeStartVertexIndex(l,c);te(0<=R&&R<m);let j=R*k;te(0<=j&&j<=H-k);let B=0,z=j;g.getEdgeVertexPosition(l,Rl,_,0),g.getEdgeVertexPosition(l,Pl,_,v-1);let ce=ui(Rl,Pl),ue=Math.max(kte,1e-4*ce);for(let Ie=0;Ie<=k;++Ie){g.getEdgeVertexPosition(l,Rl,_,B),x.getEdgeVertexPosition(M,Pl,E,z);let le=Ie/k,ze=$?O[0]+le*(O[2]-O[0]):a===ii.WEST?O[0]:O[2],Le=$?a===ii.SOUTH?O[1]:O[3]:O[1]+le*(O[3]-O[1]),de=t.surface.extent;if(de==null||j2(de,ze,Le)){let fe=Rr(Rl,Pl),st=vr(Rl)-dn.radius,De=vr(Pl)-dn.radius,Ee=fe<ue;if(!Ee){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${l}[${B}/${v}] and [${c.lij}].edge${M}[${z}/${T}]`),de!=null&&console.warn("  surface extent= ",de," x,y=",ze,",",Le);let Ve=w();ve(Ve,f.localOrigin,p.localOrigin),vr(Ve)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${p.localOrigin} d=${vr(Ve)} [${Ve}]`),(()=>{let N=hn(Rl),V=hn(Pl);t.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Rl,_,B),x.getEdgeVertexPosition(M,Pl,E,z);let U=w();ai(U,Rl,N),vr(U)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${N} vs ${Rl} d=${vr(U)} [${U}]`),ai(U,Pl,V),vr(U)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${V} vs ${Pl} d=${vr(U)} [${U}]`)})();let _e=g.getEdgeCount(l),L=x.getEdgeCount(T);te(Ee,`Mismatch in tile [${t.lij}].edge[${l}][${B}/${_e}] vs neighbor [${c.lij}].edge[${M}][${z}/${L}] ${Ka(Rl)} vs ${Ka(Pl)}  dist=${fe} h(t|n|d)=${st}|${De}|${De-st}`)}g.getEdgeNormal(l,Qf,B),x.getEdgeNormal(M,Yf,z),ne(a8,Qf),ne(l8,Yf);let Ae=ae(a8,l8),He=1-Ae<.01||!1||t===c;if(!He){let Ve=w();ai(Ve,Qf,Yf);let _e=()=>`Mismatch in tile edge normal ${IM(t.lij)} (${B}/${v-1}) edge ${l} vs neighbor ${IM(c.lij)}  (${z}/${T-1}) nedge ${M} :${Ka(Qf)} vs ${Ka(Yf)}  dot = ${Ae} : ${Ka(Ve)}`;console.warn("Mismatch in tile edge normal: ",_e());{t.updateEdgeElevations(),c.updateEdgeElevations();let L=w(),N=w();g.getEdgeNormal(l,L,B),x.getEdgeNormal(M,N,z),$c(Qf,L)||console.warn("Missing update in tile normal: ",Ka(Qf)," => ",Ka(L)),$c(Yf,N)||console.warn("Missing update in neighbor normal: ",Ka(Yf)," => ",Ka(N))}te(He,_e())}}B+=1,z+=1}})}},Rl=w(),Pl=w(),Qf=w(),Yf=w(),a8=w(),l8=w(),kte=1,Da=[null,null,null,null];function pd(e,t){return t?.loaded||t===e?t:null}var Vte=1,Hte=2,Bte=4,Ute=8,SO=4,IO=8,AO=12,OD=[0,1,2,3];var np=class{get updating(){return!!this._tileRequested}init(t,i,r,n){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;let s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){let t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t,i){this._setUpsampleTile(t,i),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,di.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;let t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return t!=null?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){let t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),{minLevel:n,maxLevel:s}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?ca:()=>!0,c=this.tile,h=c.level,p,m=this._tileLayerInfo.upsampleInfo,f=m?.tile?.level??-1,g=m!=null&&f-h>=o,_=L3(r),v=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;c&&l(c,r)&&c.level>=n;){let b=c.level,x=h-b,E=c.layerInfo[i][t];if(E.data&&x>=o){(!g||b>f)&&this._setUpsampleTile(c),E.dataInvalidated&&(p=c);break}let D=v?.getLevelRowColumn(c.lij)??c.lij;if(_?.getAvailability(D[0],D[1],D[2])!=="unavailable"&&b<=s&&!E.data&&!E.dataMissing&&((!p||c.level===n||b%Ow==0||h-p.level<o)&&(p=c),x>=a))break;c=c.parent}if(p!=null&&h-p.level<o)if(m)p=null;else{let b=this._findAncestorWithData();b!=null&&(this._setUpsampleTile(b),p=b.layerInfo[i][t].dataInvalidated?b:null)}return p}_findAncestorWithData(){let t=this.tile.elevationLevel,i=this._desiredMinLevelDelta,r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(t-n.level>=i)return n;r=n}return r}_setUpsampleTile(t,i){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,di.FADING,i)}get test(){}},RO=class extends np{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw c8}get _progressiveLevelModulo(){throw c8}dispose(){}},c8=new Error("Abstract method called on TileAgent"),Wn=new RO;var ND=class extends np{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function u8(e){return e.type==="elevation"}var LD=class extends np{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ow}};function d8(e){return e.type==="map"}var Er;(function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"})(Er||(Er={}));var sp=class{constructor(){this.waitingAgents=new Nt,this.pendingUpdates=0}static acquire(t){let i=PO.acquire();return i._init(t),i}release(){this.dispose(),FD.delete(this),PO.release(this)}dispose(){this.loadingAgent=We(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=pu(this._data)}static prune(){PO.prune(0)}_init(t){this.waitingAgents.clear(),this._data=pu(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Mr(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(t,i){if(t!==i&&i!=null){if(this.upsampleInfo==null)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===i)return;this.upsampleInfo.tile?.unrefMapData()}i.refMapData(),H3(t,i,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(t){pu(this._data),this._data=t}},PO=new no(sp,null,()=>{}),FD=new Map;function h8(){FD.size>0&&(console.log(`${FD.size} live TilePerLayerInfo allocations:`),FD.forEach(e=>console.log(e,`
`)))}var we;(function(e){e[e.NONE=0]="NONE",e[e.SPLIT=1]="SPLIT",e[e.ELEVATION=2]="ELEVATION",e[e.MERGE=4]="MERGE",e[e.GEOMETRY=8]="GEOMETRY",e[e.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=32]="TEXTURE_FADING"})(we||(we={}));var jte=.1,md=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Yt(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Yt(),this.centerAtSeaLevel=w(),this._center=[w(),ur(),w()],this.up=Q2(),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=0,this._rasterTileMemory=0,this._vectorTileMemory=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=w(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){LO.prune(0),FO.prune(0),sp.prune()}get _cached(){return!this.leaf&&this._mapDataRefCount<=0}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Fi.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;let t=this.parent,i=t?.frustumVisibility??Er.INTERSECTS;this._frustumVisibility=i===Er.INSIDE?Er.INSIDE:i===Er.OUTSIDE?Er.OUTSIDE:this._calculateFrustumVisibility(this.surface.frustum);let r=this._frustumVisibility!==Er.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get _loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){let t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}init(t,i,r,n,s){this._lij[0]=t,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=_t(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(t,i,r,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._withinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Fi.MIDDLE][3]=0,this.elevationLevel=t,n&&!Number.isNaN(n.elevationBoundsMin)?(this._elevationBoundsMin=n.elevationBoundsMin,this._elevationBoundsMax=n.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.clearChildren(),this._surface=s,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(let o of cd){let a=s.numLayers(o),l=this.layerInfo[o];for(let c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=sp.acquire(this._surface.upsampleInfoPool),o===Ue.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,jd)}dispose(){this._surface!=null&&(rr(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key),this.layerInfo.forEach(t=>{t.forEach(i=>i.release()),t.length=0}),this._surface=this._parent=null,this.clearChildren(),this.setMemoryDirty())}refMapData(){++this._mapDataRefCount,this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount,this._cached&&this.cachedMemory>0&&this._surface.upsampleMapCache.put(this.key,this)}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get cachedMemory(){return this._ensureUsedMemory(),this._surface==null?this.usedMemory:this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+this._vectorTileMemory}get _cpuImageMemorySize(){let i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(this._usedMemory>0)return this._vectorTileMemory=this.layerInfo[Ue.MAP].reduce((t,{data:i})=>t+(om(i)?i.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory,this._rasterTileMemory=0,this._vectorTileMemory=0;for(let{data:t}of this.layerInfo[Ue.MAP])om(t)?this._vectorTileMemory+=t.usedMemoryPerReference:this._rasterTileMemory+=this.getTerrainDataMemory(t);for(let t of this.layerInfo[Ue.ELEVATION])this._usedMemory+=t.data?this._cpuImageMemorySize:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.cachedMemory??0),this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this),this._usedMemory}getUsedMemoryForLayer(t,i){let r=this.layerInfo[t][i];return r?.data?t===Ue.MAP?this._cached?0:this.getTerrainDataMemory(r.data):t===Ue.ELEVATION?this._cpuImageMemorySize:0:0}getTerrainDataMemory(t){return g3(t)?t.texture.usedMemory:f3(t)?t.memoryUsage:om(t)?t.usedMemoryPerReference:am(t)||t instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(t){let i=this._center[Fi.MIDDLE],r=t,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(t,i,r){if(!this.visible)return we.NONE;if(t.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibility(t.frustum)===Er.OUTSIDE))return we.NONE;let n=this.level;ve(VD,this._center[Fi.MIDDLE],i);let s=Ar(VD),o=VD,a=this._center[Fi.MIDDLE];ve(OO,this._center[Fi.TOP],i);let l=Ar(OO);l<s&&(s=l,o=OO,a=this._center[Fi.TOP]),ve(NO,this._center[Fi.BOTTOM],i);let c=Ar(NO);if(c<s&&(s=c,o=NO,a=this._center[Fi.BOTTOM]),this._edgeLen2>s&&n<t.maxLod)return we.SPLIT;let h=Math.sqrt(s),p=t.fovX*h*2,m=this._edgeLen/p,f=()=>{if(n<t.maxLod)return this.elevationLevel=n,we.NONE;let I=n+Math.ceil(-Math.log2(t.relativeWidthLimit/m));return I!==this.elevationLevel?(this.elevationLevel=I,we.ELEVATION):we.NONE},g=r!=null?r-n:1/0;if(g<=.5)return f();let _=ae(this.up,VD),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(t.aboveGround&&_>0&&b<.001&&_/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return we.NONE;let x=r!=null?3-Math.min(g,2):1;if(m*x<t.relativeWidthLimit||n>=t.maxLod)return f();if(n<7)return we.SPLIT;X(Fr,this.up,_),ve(Fr,Fr,o);let E=Ar(Fr);if(E<=this.radius*this.radius)return we.SPLIT;X(Fr,Fr,this.radius/Math.sqrt(E)),he(Fr,Fr,a),ve(Fr,i,Fr);let D=Math.min(1,(Math.abs(ae(Fr,this.up))+.5*v+this._curvatureHeight)/xe(Fr)),M=jte/t.angledSplitBias,T=t.fovY*h*2;return D*(this._edgeLen/T*x)<M*t.relativeHeightLimit?we.NONE:we.SPLIT}createChildren(){let t=this._children,i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return t[0]=this.surface.createTile(i,r,n,this),t[1]=this.surface.createTile(i,r,n+1,this),t[2]=this.surface.createTile(i,r+1,n,this),t[3]=this.surface.createTile(i,r+1,n+1,this),t}clearChildren(){this._children[0]=this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(let t of cd)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(){this.renderData&&this.unrefMapData(),this.surface.renderer.unloadTile(this);for(let t of cd){let i=this.layerInfo[t];for(let r of i)r.loadingAgent&&r.loadingAgent!==Wn&&(kD(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0}this.resetPendingUpdate(we.GEOMETRY),this.resetPendingUpdate(we.TEXTURE_NOFADING),this.resetPendingUpdate(we.TEXTURE_FADING)}unloadMapData(){let t=this.layerInfo[Ue.MAP];for(let i of t)i.loadingAgent&&i.loadingAgent!==Wn&&(kD(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0,i.invalidateSourceData();this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(Ko(t,this._clippingArea))return!1;let i=this._intersectsClippingArea,r=this._withinClippingArea;t!=null?(this._intersectsClippingArea=this.intersectsExtent(t),this._withinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._withinClippingArea=!0),this._clippingArea=t,this.updateVisibility();let n=r&&this._withinClippingArea,s=!(r||i||this._withinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(we.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){let r=this.layerInfo[i][t];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(let t of cd){let i=this.layerInfo[t];for(let r of i)if(r.loadingAgent&&r.loadingAgent!==Wn&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(we.SPLIT)||t!==Ue.ELEVATION&&!this._loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){let i=this._pendingUpdates;return this._pendingUpdates|=t,t===we.SPLIT||t===we.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){let n=this.layerInfo[i][t];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,t),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,t);let a=om(n.data);return r.dataArrived(this,a),!0}if(n.requestPromise)return!0;Mr(n.requestAbort),n.requestAbort=new AbortController;let s=this._surface.requestTileData(this,t,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;let o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get leaf(){return this._children[0]==null}hasLij(t){return this._lij[0]===t[0]&&this._lij[1]===t[1]&&this._lij[2]===t[2]}findByLij(t){if(this.hasLij(t))return this;let i=this._children;return i[0]?i[0].findByLij(t)||i[1].findByLij(t)||i[2].findByLij(t)||i[3].findByLij(t):null}distanceToSquared(t){return Ar(ve(Fr,this._center[Fi.MIDDLE],t))}containsPoint(t){let i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}containsPointXY(t,i){let r=this.extent;return t>=r[0]&&i>=r[1]&&t<=r[2]&&i<=r[3]}unrequestLayerData(t,i,r){let n=this.layerInfo[i][t],s=n.waitingAgents,o=s.removeUnordered(r)!=null;rr(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){let n=om(r),s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i){let r=this.layerInfo[i][t];r.dataMissing=!0,r.waitingAgents.forAll(n=>n.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(t,i)),t){case Ue.MAP:return this._updateTexture(i);case Ue.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===di.FADING?we.TEXTURE_NOFADING:we.TEXTURE_FADING),this.setPendingUpdate(t===di.FADING?we.TEXTURE_FADING:we.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(we.GEOMETRY);for(let t of this.layerInfo[Ue.ELEVATION])t.pendingUpdates|=we.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){let t=this._elevationBoundsMin,i=this._elevationBoundsMax,r=1/0,n=-1/0,s=this.layerInfo[Ue.ELEVATION],o=!0;for(let a of s)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),n=Math.max(n,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),n=Math.max(n,0)),t===r&&i===n||(this._elevationBoundsMin=r,this._elevationBoundsMax=n,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){let t=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(t+i),n=this._center;X(Fr,this.up,r),he(n[Fi.MIDDLE],this.centerAtSeaLevel,Fr),X(Fr,this.up,t),he(n[Fi.TOP],this.centerAtSeaLevel,Fr),X(Fr,this.up,i),he(n[Fi.BOTTOM],this.centerAtSeaLevel,Fr)}findElevationBoundsForLayer(t,i){let r=this.layerInfo[Ue.ELEVATION][t],n=this.elevationLevelDelta,s=Math.max(this.elevationLevel-n,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=s)return;let a=this._surface.layerViewByIndex(t,Ue.ELEVATION);if(!ca(this,a))return;let l=Gte,c=!1,h=r.data;if(h&&h.level<=s){let p=r.data;l.min=p.samplerData.data.minValue,l.max=p.samplerData.data.maxValue,l.hasNoDataValues=p.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let p,m,f=0;for(let g=this._parent;g&&(!m||f<n)&&(f=this.elevationLevel-g.level,p=m||p,m=g.layerInfo[Ue.ELEVATION][t].data,!(!m&&p&&g.level<=s));g=g.parent);m=m||p,m&&(m.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=m.level,c=!0))}c&&(r.elevationBounds==null&&(r.elevationBounds=new Ml),r.elevationBounds.copyFrom(l))}modifyLayers(t,i,r){let n=this.layerInfo[r];for(let a of n)a.loadingAgent&&a.loadingAgent!==Wn&&(kD(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)t[a]===void 0&&n[a].release();let s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){let l=i[a];n[a]=l>-1?s[l]:sp.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,di.FADING))}updateAgents(t){if(this.renderData){let i=this.layerInfo[t];for(let r of i)r.loadingAgent===Wn&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(let t of cd){let i=this._isSuspended(t);for(let r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Wn&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Wn&&this.updateRenderData(t,di.FADING))}}removeLayerAgent(t,i){let r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Wn&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){let r=this.layerInfo[i][t];r.loadingAgent=Wn,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(t+1,i)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||qc(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,i,r){for(let n=t;n<i;++n){let s=this._surface.layerViewByIndex(n,r);if(hu(s)&&s?.layer?.blendMode!=="normal"||qc(s?.layer?.parent)&&this._hasBlendableAncestor(s?.layer?.parent))return!0}return!1}_createOrUpdateAgents(t,i){let r=this.layerInfo[i];if(r.length===0)return;let n=this._isSuspended(i);for(let s=t;s<r.length;++s){let o=r[s],a=this._surface.layerViewByIndex(s,i),l=!1;if(o.loadingAgent?ca(this,a)?(o.loadingAgent!==Wn&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Wn&&(l=o.loadingAgent.update())):o.dispose():ca(this,a)&&(o.loadingAgent=zte(this,s,i,n),l=o.loadingAgent.startLoading(),l?o.loadingAgent===Wn&&this.setPendingUpdate(we.GEOMETRY):(kD(o.loadingAgent),o.loadingAgent=Wn)),o.loadingAgent===Wn&&this.updateRenderData(i,di.FADING),!this._hasBlendModes(t,r.length,i)&&l&&a.isOpaque)return}}_isWithinExtent(t){let i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){let i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationVerticesPerSide(t){let i=this.elevationLevel-this.level,r=Math.max(this.level-t,this.elevationLevelDelta-i),n=q(1+(this._maxTesselation>>r),2,this._maxTesselation+1),s=this.minimumVerticesPerSide;return Math.max(n,s)}_findLIJ(t,i){if(!t)return null;let r=this.surface.rootTiles;if(r!=null){for(let n of r)if(qte(n,t)){let s=n,o=t[0]-s.level-1;for(;o>=0&&!s.leaf&&!i(s);){let a=t[1]>>o&1,l=t[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(t,i){let r=this._lij,n=this._getNeighborLIJ(r,t);return n?ov(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(t,i){let r=t===ii.NORTH_EAST?1:t===ii.NORTH_WEST?0:t===ii.SOUTH_WEST?2:3,n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(t,i){return this.findNeighborTile(t,r=>i(r)||r.level===this.level)?.findCorner(um(t),i)||null}forAllSubtreeOnSide(t,i){let r=t===ii.NORTH?[0,1]:t===ii.NORTH_EAST?[1]:t===ii.EAST?[1,3]:t===ii.SOUTH_EAST?[3]:t===ii.SOUTH?[2,3]:t===ii.SOUTH_WEST?[2]:t===ii.WEST?[0,2]:[0],n=s=>{let o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(t,i){if(!i)return 0;let r=this.level-i.level;if(te(!Ki||r>=0),r===0)return 0;let n=2**r,s=!(1&~t),o=s?0:1,a=i.lij[o+1]*n,l=this._lij[o+1],c=l-a,h=s?n-1-c:c;return Ki&&(te(a<=l&&l<a+n),te(0<=h&&h<n)),h}forEachLoadedNeighbor(t){let i=this.level,r=n=>n.level===i||n.loaded;Hn.forEach(n=>{let s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(dm(n),o=>!!o.loaded&&(t(o,n),!0))}),Gd.forEach(n=>{let s=this.findNeighborTile(n,r)?.findCorner(um(n),o=>o.loaded);te(!s||HD(this,s,n)),s?.loaded&&t(s,n)})}_getNeighborLIJ(t,i){let r=OM(i)?-1:PM(i)?1:0,n=AM(i)?-1:RM(i)?1:0,s=[t[0],t[1]+r,t[2]+n];return s[1]<0?null:this.surface.isGlobal?this._wrapLIJ(s):s[2]<0?null:s}_wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}isEdgeNeighbor(t,i){if(t==null)return!1;if(this.level===0&&t.level===0&&(this._eastEnd&&t._westEnd&&i===ii.EAST||this._westEnd&&t._eastEnd&&i===ii.WEST))return!0;let r=Math.max(1e-6*(this.extent[2]-this.extent[0]),1);switch(i){case ii.NORTH:return Vn(this.extent[3],t.extent[1],r);case ii.SOUTH:return Vn(this.extent[1],t.extent[3],r);case ii.EAST:return Vn(this.extent[2],t.extent[0],r)||Vn(this.extent[2],-t.extent[0],r);case ii.WEST:return Vn(this.extent[0],t.extent[2],r)||Vn(this.extent[0],-t.extent[2],r)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return this._lij[2]===0}checkGeometryWaterproofness(){r_&&(te(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(t){let i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(OM(t)&&i[3]+n>=r[3]||PM(t)&&i[1]-n<=r[1])return!1;let s=this.surface.isGlobal;return!(!s&&AM(t)&&i[0]-n<=r[0])&&!(!s&&RM(t)&&i[2]+n>=r[2])}updateDistanceToPOI(t){let i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2])return;ee(this._lastPOI,t);let r=this._center[Fi.MIDDLE],n=t[0]-r[0],s=t[1]-r[1],o=t[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function zte(e,t,i,r){let n=i===Ue.ELEVATION?FO.acquire():LO.acquire();return n.init(e,t,i,r),n}function kD(e){e.dispose(),u8(e)?FO.release(e):d8(e)&&LO.release(e)}var LO=new no(LD),FO=new no(ND),Gte=new Ml,Fi;function qte(e,t){let i=e.lij,r=t[0]-i[0];return!(r<0)&&t[1]>>r===i[1]&&t[2]>>r===i[2]}function ov(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function HD(e,t,i){return e!=null&&t!=null&&t!==e&&(e.level>=t.level?p8(e,t,i):p8(t,e,um(i)))}function p8(e,t,i){te(e.level>=t.level);let r=M3(i),n=S3(i),s=e.extent,o=t.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),h=Vn(a[0],l[0],c)||e.surface.isGlobal&&Vn(a[0],-l[0],c),p=Vn(a[1],l[1],c);if(h&&p)return!0;if(e.level===t.level)return te(!1),!1;if(!h&&!p)return te(!1),!1;let m=h?m8(o[1],o[3],s[1],s[3],c):m8(o[0],o[2],s[0],s[2],c);return te(m),m}function m8(e,t,i,r,n){return e-n<=i&&i<=r&&r<=t+n}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Fi||(Fi={}));var VD=w(),OO=w(),NO=w(),Fr=w();var Wte=65536;function f8(e,t){let{tile:i,geometry:r,geometryState:n}=e,{extentInRadians:s,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:h}=n,p=c-1,m=(c-2)**2,f=a&&(t===yo.HAS_SOUTH_POLE||t===yo.HAS_BOTH_POLES),g=a&&(t===yo.HAS_NORTH_POLE||t===yo.HAS_BOTH_POLES),_=((f?1:0)+(g?1:0))*BD*c,v=k8(n),b=m+_+4*v,x=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=x,r.maxEdgeVertexCount=v;let{boundingBox:E}=r;zl(E);let D=BO(e);kr.update(p,s,D),Zte(e),r.poleVerticesStartIndex=m;let M=$te(e,f,g);r.edgeVerticesStartIndex=m+_,jO(e),HO(e),I8(r,M,h),e.intersectionData=null}function $te(e,t,i){let{tile:r,localOrigin:n,geometry:s}=e,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:h,poleVerticesStartIndex:p}=s,m=c-1,f=n[0],g=n[1],_=n[2],v=a.radius,b=o[1],x=o[3],E=[],D=p,M=(T,I)=>{let A=I*c;zo(-f,-g,T*v-_,l),E.push(new VO(T===1,A,T===1?0:2,D,BD));let O=b8(T===-1?b:x,v),$=T*Math.PI/2-O,H=.99*(T===1?1:-1),k=v+0,{position:K,uv0:F}=h,{typedBuffer:R,typedBufferStride:j}=h.normalCompressed;for(let B=1;B<=BD;++B){let z=O+$*(B/BD),ce=Math.cos(z),ue=Math.sin(z);for(let Ie=0;Ie<=m;Ie++){let le=Ie/m,ze=kr.sinLonLUT[Ie],Le=kr.cosLonLUT[Ie]*ce,de=ze*ce,fe=ue,st=Le*k-f,De=de*k-g,Ee=fe*k-_;zo(st,De,Ee,l),K.setValues(D,st,De,Ee),jo(F,D,le,H),Od(R,D,Le,de,fe,j),++D}}};return t&&M(-1,0),i&&M(1,m),E}function Zte(e){let{tile:t}=e;if(!t.intersectsClippingArea)return;let{geometry:i,geometryState:r,localOrigin:n}=e,{numVerticesPerSide:s,samplerData:o}=r,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:h}=i,p=c.position,m=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:_}=t,v=_[0],b=_[2],x=_[1],E=_[3],D=t.ellipsoid.radius,M=n[0],T=n[1],I=n[2],A=p.typedBuffer,O=p.typedBufferStride,$=1/l,H=0;if(1<=a){let k=$,K=x*(1-k)+E*k,F=kr.sinLatLUT[1],R=kr.cosLatLUT[1];for(let j=1;j<=a;j++){let B=j*$,z=v*(1-B)+b*B,ce=kr.sinLonLUT[j],ue=kr.cosLonLUT[j],Ie=D+gi(z,K,o),le=Ie*ue*R-M,ze=Ie*ce*R-T,Le=Ie*F-I;zo(le,ze,Le,h);let de=(j-1)*O;A[de]=le,A[de+1]=ze,A[de+2]=Le,jo(m,j-1,B,k)}}for(let k=1;k<=a;k++){let K=k*$,F=x*(1-K)+E*K,R=kr.sinLatLUT[k],j=kr.cosLatLUT[k],B=k+1,z=B*$,ce=x*(1-z)+E*z,ue=kr.sinLatLUT[B],Ie=kr.cosLatLUT[B],le=kr.sinLonLUT[0],ze=kr.cosLonLUT[0],Le=D+gi(v,F,o),de=ze*j*Le-M,fe=le*j*Le-T,st=R*Le-I,De=H*O,Ee=A[De],Ae=A[De+1],He=A[De+2];for(let Ve=1;Ve<=a;Ve++){let _e=Ve*$,L=v*(1-_e)+b*_e,N=kr.sinLonLUT[Ve],V=kr.cosLonLUT[Ve],U=0,Y=0,re=0;if(Ve<a){let gt=(H+1)*O;U=A[gt],Y=A[gt+1],re=A[gt+2]}else{let gt=kr.sinLonLUT[l],wt=kr.cosLonLUT[l],xt=D+gi(b,F,o);U=wt*j*xt-M,Y=gt*j*xt-T,re=R*xt-I}let ye=de,J=fe,Z=st;de=Ee,fe=Ae,st=He,Ee=U,Ae=Y,He=re;let Q=U-ye,pe=Y-J,Me=re-Z,et=0,Je=0,$e=0;if(k>1){let gt=(H-a)*O;et=A[gt],Je=A[gt+1],$e=A[gt+2]}else{let gt=kr.sinLatLUT[0],wt=kr.cosLatLUT[0],xt=D+gi(L,x,o);et=V*wt*xt-M,Je=N*wt*xt-T,$e=gt*xt-I}let Ke=D+gi(L,ce,o),at=V*Ie*Ke-M,Ze=N*Ie*Ke-T,Ge=ue*Ke-I;if(k<a){let gt=H+a,wt=gt*O;A[wt]=at,A[wt+1]=Ze,A[wt+2]=Ge,zo(at,Ze,Ge,h),jo(m,gt,_e,z)}let y=et-at,qe=Je-Ze,je=$e-Ge,tt=V*j,ht=N*j,it=R;it*it<.999&&(tt=Me*qe-pe*je,ht=Q*je-Me*y,it=pe*y-Q*qe);let Ye=1/Math.sqrt(tt*tt+ht*ht+it*it);Od(f,H,tt*Ye,ht*Ye,it*Ye,g),++H}}}function g8(e){e.tile.intersectsClippingArea&&(HO(e),Jf(e),e.intersectionData=null)}function _8(e){e.tile.intersectsClippingArea&&(P8(e),HO(e),Jf(e),L8(e),e.intersectionData=null)}function y8(e){e.tile.intersectsClippingArea&&(w8(e),v8(e,!0),Jf(e),e.intersectionData=null)}function HO(e){e.tile.intersectsClippingArea&&(w8(e),v8(e))}function v8(e,t=!1){let{geometry:i,geometryState:r,tile:n,localOrigin:s}=e,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,h=c.radius,p=l[0],m=l[2],f=l[1],g=l[3],{samplerData:_}=r,v=a[0],b=a[2],x=a[1],E=a[3],D=BO(e),{boundingBox:M,vertexAttributes:T}=i,I=s[0],A=s[1],O=s[2],$=T.position,H=$.typedBuffer,k=$.typedBufferStride,K=T.uv0;for(let F=0;F<4;++F){let R=F===1||F===3,j=r.edgeResolutions[F];te(Cd(j));let B=j+1,z=pd(n,r.edgePeerNeighbors[F]);if(F8(n,z,F)){O8(e,F,z);continue}let ce=z!=null;te(!ce||z.level===n.level),te(!ce||wo(n,z)<=0);let ue=z?.renderData,Ie=ue?.geometryState;if(Ki){let Q=n.surface;if(!z&&Q&&!Q.updatingRootTiles){let pe=Hn[F],Me=n.findNeighborTile(pe,et=>et.loaded||et.leaf||et.level===n.level);Me?Me.intersectsClippingArea&&(te(!Me.loaded),te(!Me.leaf),te(Me.level===o)):te(Q?.rootTiles==null||!n.shouldHaveNeighbor(pe))}}let le=F===1?a[2]:a[0],ze=z?.extent,Le=ze&&R?F===1?ze[0]:ze[2]:le,de=F===0?a[3]:a[1],fe=F===1?1:0,st=F===0?1:0,De=F===1?m:p,Ee=F===0?g:f,Ae=Math.sin(De),He=Math.cos(De),Ve=Math.sin(Ee),_e=Math.cos(Ee),L=Ie?.samplerData,N=ce?(Q,pe,Me)=>.5*(gi(Q,pe,_)+gi(Me,pe,L)):(Q,pe,Me)=>gi(Q,pe,_),V=i.outerEdgesOffsetAndLength[2*F+0],U=t&&B>3?B-3:1,Y=_!=null&&_.some(Q=>Q!=null),re=L!=null&&L.some(Q=>Q!=null),ye=Y||re,J=1/j,Z=V;te(!ze||Vn(ze[2]-ze[0],a[2]-a[0])),(()=>{let Q=F===1?-1:F===3?1:0,pe=F===0?-1:F===2?1:0,Me=(a[2]-a[0])*J,et=Q*Me,Je=pe*Me,$e=R?Q*((m-p)*J):0,Ke=R?0:pe*J,at=st,Ze=R?De+$e:De,Ge=R?Math.sin(Ze):Ae,y=R?Math.cos(Ze):He,qe=R?De-$e:De,je=R?Math.sin(qe):Ae,tt=R?Math.cos(qe):He,ht=R?Ee:D(at+Ke),it=R?Ve:Math.sin(ht),Ye=R?_e:Math.cos(ht),gt=R?Ee:D(at-Ke),wt=R?Ve:Math.sin(gt),xt=R?_e:Math.cos(gt),bi=0,Ci=0,li=0;{let Qe=0*J,Gt=R?le:v*(1-Qe)+b*Qe,Ot=R?Le:Gt,se=R?x*(1-Qe)+E*Qe:de,ri=R?De:p*(1-Qe)+m*Qe,Ur=R?Ae:Math.sin(ri),Qn=R?He:Math.cos(ri),Mt=R?D(Qe):Ee,Ds=R?Math.sin(Mt):Ve,Rn=R?Math.cos(Mt):_e,Dr=h+N(Gt,se,Ot);bi=Qn*Rn*Dr,Ci=Ur*Rn*Dr,li=Ds*Dr}let ci=0,zt=0,bt=0;{let Qe=1*J,Gt=R?le:v*(1-Qe)+b*Qe,Ot=R?Le:Gt,se=R?x*(1-Qe)+E*Qe:de,ri=R?De:p*(1-Qe)+m*Qe,Ur=R?Ae:Math.sin(ri),Qn=R?He:Math.cos(ri),Mt=R?D(Qe):Ee,Ds=R?Math.sin(Mt):Ve,Rn=R?Math.cos(Mt):_e,Dr=h+N(Gt,se,Ot);ci=Qn*Rn*Dr,zt=Ur*Rn*Dr,bt=Ds*Dr}for(let Qe=1;Qe<B-1;Qe+=U){let Gt=0,Ot=0,se=0;{let zr=(Qe+1)*J,Kn=R?le:v*(1-zr)+b*zr,to=R?Le:Kn,tr=R?x*(1-zr)+E*zr:de,Xn=R?De:p*(1-zr)+m*zr,Sa=R?Ae:Math.sin(Xn),Bc=R?He:Math.cos(Xn),Ss=R?D(zr):Ee,io=R?Math.sin(Ss):Ve,kl=R?Math.cos(Ss):_e,Ia=h+N(Kn,tr,to);Gt=Bc*kl*Ia,Ot=Sa*kl*Ia,se=io*Ia}let ri=Gt,Ur=Ot,Qn=se,Mt=ci,Ds=zt,Rn=bt;ci=ri,zt=Ur,bt=Qn;{let zr=Z+Qe,Kn=zr*k,to=Mt-I,tr=Ds-A,Xn=Rn-O;H[Kn]=to,H[Kn+1]=tr,H[Kn+2]=Xn,zo(to,tr,Xn,M);let Sa=Qe*J;jo(K,zr,R?fe:Sa,R?Sa:st)}let Dr=bi,xs=Ci,ar=li;bi=Mt,Ci=Ds,li=Rn;let jr=Mt,eo=Ds,Ms=Rn,lr=1/Math.sqrt(jr*jr+eo*eo+Ms*Ms),xr=Ms*lr,_i=0,Yn=0,Ma=0;if(ye&&xr*xr<.999){let zr=0,Kn=0,to=0;{let tr=F===0?-1:1;zr=tr*(ri-Dr),Kn=tr*(Ur-xs),to=tr*(Qn-ar)}{let tr=Qe*J,Xn=R?le:v*(1-tr)+b*tr,Sa=R?Le:Xn,Bc=R?x*(1-tr)+E*tr:de,Ss=R?De:p*(1-tr)+m*tr,io=R?Ae:Math.sin(Ss),kl=R?He:Math.cos(Ss),Ia=R?D(tr):Ee,gp=R?Math.sin(Ia):Ve,_p=R?Math.cos(Ia):_e,Aa=jr,vd=eo,wd=Ms;if(ce){let Is=h+gi(Sa-et,Bc-Je,L),Ra=R?_p:xt;Aa=(R?tt:kl)*Ra*Is,vd=(R?je:io)*Ra*Is,wd=(R?gp:wt)*Is}{let Is=h+gi(Xn+et,Bc+Je,_),Ra=R?_p:Ye,Uc=(R?y:kl)*Ra*Is,yp=(R?Ge:io)*Ra*Is,vp=(R?gp:it)*Is;ce||(Aa=2*jr-Uc,vd=2*eo-yp,wd=2*Ms-vp);let Dg=F===3?-1:1,Kv=Dg*(Aa-Uc),Xv=Dg*(vd-yp),Jv=Dg*(wd-vp);_i=to*Xv-Kn*Jv,Yn=zr*Jv-to*Kv,Ma=Kn*Kv-zr*Xv;let xg=1/Math.sqrt(_i*_i+Yn*Yn+Ma*Ma);_i*=xg,Yn*=xg,Ma*=xg}}}else _i=jr*lr,Yn=eo*lr,Ma=Ms*lr;i.setEdgeNormalFromValues(F,Qe,_i,Yn,Ma)}})()}}function w8(e){N8(e)}function b8(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Qte(e,t,i,r){return b8(e*(1-r)+t*r,i)}function Yte(e,t,i){return e*(1-i)+t*i}function BO(e){let{tile:t}=e;if(t.surface.isWebMercator){let r=t.extent,n=t.ellipsoid.radius;return s=>Qte(r[1],r[3],n,s)}let i=t.extentInRadians;return r=>Yte(i[1],i[3],r)}function C8(e,t){let{tile:i,geometryState:r,geometry:n}=e,{extent:s,surface:o}=i,{wireframe:a}=r,l=s[0],c=s[1],h=s[2]-l,p=s[3]-c,{numVerticesPerSide:m,clippingArea:f}=r,g=f!=null?Math.max(0,(f[0]-l)/h):0,_=f!=null?Math.max(0,(f[1]-c)/p):0,v=f!=null?Math.min(1,(f[2]-l)/h):1,b=f!=null?Math.min(1,(f[3]-c)/p):1,x=(m-2)**2,E=k8(r),D=x+4*E,M=o.renderer.tileGeometryCache.acquire(D),{boundingBox:T}=n;zl(T),n.numVerticesPerSide=m,n.vertexAttributes=M,n.maxEdgeVertexCount=E,n.minu=g,n.minv=_,n.maxu=v,n.maxv=b,Kte(e),n.edgeVerticesStartIndex=x,jO(e),UO(e),I8(n,[],a),e.intersectionData=null}function Kte(e){let t=e.tile;if(!t.intersectsClippingArea)return;let{geometry:i,geometryState:r,localOrigin:n}=e,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:h}=t,{isWebMercatorOnPlateCarree:p}=l,m=o??zO,f=c[0],g=c[1],_=c[2],v=c[3],b=Math.max(f,m[0]),x=Math.min(_,m[2]),E=Math.max(g,m[1]),D=Math.min(v,m[3]),M=h.radius,T=t.horizontalScale,I=a-1,A=a-2,{minu:O,minv:$,maxu:H,maxv:k,boundingBox:K,vertexAttributes:F}=i,R=F.position,j=F.uv0,{typedBuffer:B,typedBufferStride:z}=F.normalCompressed,ce=n[0],ue=n[1],Ie=n[2],le=R.typedBuffer,ze=R.typedBufferStride,Le=0,de=q(g,E,D),fe=p?(Math.PI/2-2*Math.atan(Math.exp(-de/M)))*M:de*T,st=1/I,De=q(g*(1-st)+v*st,E,D),Ee=fe,Ae=p?(Math.PI/2-2*Math.atan(Math.exp(-De/M)))*M:De*T;for(let He=1;He<=A;He++){let Ve=He/I,_e=q(g*(1-Ve)+v*Ve,E,D),L=q(Ve,$,k),N=Ae,V=(He-1)/I,U=q(g*(1-V)+v*V,E,D),Y=Ee,re=(He+1)/I,ye=q(g*(1-re)+v*re,E,D),J=p?(Math.PI/2-2*Math.atan(Math.exp(-ye/M)))*M:ye*T,Z=q(re,$,k);Ee=Ae,Ae=J;let Q=q(f,b,x),pe=Q*T,Me=gi(Q,_e,s),et=1/I,Je=q(et,O,H),$e=q(f*(1-Je)+_*Je,b,x),Ke=Je,at=$e,Ze=$e*T,Ge=gi($e,_e,s);if(He===1){let y=Ze-ce,qe=Ee-ue,je=Ge-Ie,tt=0*ze;le[tt]=y,le[tt+1]=qe,le[tt+2]=je,zo(y,qe,je,K);let ht=q(et,O,H);jo(j,Le,ht,L)}for(let y=1;y<=A;y++){let qe=Ze,je=Ge,tt=(y+1)/I,ht=q(tt,O,H),it=q(f*(1-tt)+_*tt,b,x),Ye=at;at=it;{let zt=Le+1,bt=zt*ze;if(He===1||y===A){let Qe=it*T,Gt=gi(it,_e,s);if(He===1&&y<A){let Ot=Qe-ce,se=N-ue,ri=Gt-Ie;le[bt]=Ot,le[bt+1]=se,le[bt+2]=ri,zo(Ot,se,ri,K),jo(j,zt,ht,L)}Ze=Qe,Ge=Gt}else Ze=le[bt]+ce,Ge=le[bt+2]+Ie}let gt=Ze,wt=Ge,xt=pe,bi=Me;pe=qe,Me=je;let Ci=(Le-A)*ze,li=He===1?gi(Ye,U,s):le[Ci+2]+Ie,ci=gi(Ye,ye,s);if(He<A){let zt=Le+A,bt=zt*ze,Qe=qe-ce,Gt=J-ue,Ot=ci-Ie;le[bt]=Qe,le[bt+1]=Gt,le[bt+2]=Ot,zo(Qe,Gt,Ot,K);let se=Ke;Ke=ht,jo(j,zt,se,Z)}{let zt=gt-xt,bt=Y-J,Qe=bt*(wt-bi),Gt=zt*(li-ci),Ot=-bt*zt,se=Qe*Qe+Gt*Gt+Ot*Ot;if(se===0)Od(B,Le,0,0,1,z);else{let ri=1/Math.sqrt(se);Od(B,Le,Qe*ri,Gt*ri,Ot*ri,z)}}++Le}}}function T8(e,t){e.tile.intersectsClippingArea&&(M8(e),x8(e,!0),Jf(e),e.intersectionData=null)}function E8(e,t){e.tile.intersectsClippingArea&&(P8(e),UO(e),Jf(e),L8(e),e.intersectionData=null)}function D8(e,t){e.tile.intersectsClippingArea&&(UO(e),Jf(e),e.intersectionData=null)}function UO(e,t){e.tile.intersectsClippingArea&&(M8(e),x8(e,!1))}function x8(e,t){let{geometry:i,geometryState:r,localOrigin:n}=e,s=e.tile,{surface:o,extent:a}=s,{clippingArea:l,samplerData:c}=r,h=l??zO,p=a[0],m=a[2],f=a[1],g=a[3],_=[g>h[3],m>h[2],f<h[1],p<h[0]],v=s.horizontalScale,b=S8(o.isWebMercatorOnPlateCarree,s.ellipsoid.radius,v),{minu:x,minv:E,maxu:D,maxv:M,boundingBox:T}=i,I=Math.max(p,h[0]),A=Math.min(m,h[2]),O=Math.max(f,h[1]),$=Math.min(g,h[3]),H=n[0],k=n[1],K=n[2];for(let F=0;F<4;++F){let R=F===1||F===3,j=r.edgeResolutions[F];te(Cd(j));let B=j+1,z=_[F],ce=pd(s,r.edgePeerNeighbors[F]);if(!z&&F8(s,ce,F)){O8(e,F,ce);continue}let ue=ce!=null&&!z,Ie=ce?.renderData,le=Ie?.geometryState;if(Ki&&(te(!ue||ce.level===s.level),te(!ue||wo(s,ce)<=0),s&&!ce&&!o.updatingRootTiles)){let J=Hn[F],Z=s.findNeighborTile(J,Q=>Q.loaded||Q.leaf||Q.level===s.level);o.updatingRootTiles||(Z?Z.intersectsClippingArea&&(te(!Z.loaded),te(!Z.leaf),te(Z.level===s.level)):te(o?.rootTiles==null||!s.shouldHaveNeighbor(J)))}let ze=q(F===1?m:p,I,A),Le=q(F===0?g:f,O,$),de=le?.samplerData,fe=t&&B>3?B-3:1,st=q(F===1?1:0,x,D),De=q(F===0?1:0,E,M),Ee=ue?(J,Z)=>.5*(gi(J,Z,de)+gi(J,Z,c)):(J,Z)=>gi(J,Z,c),Ae=(m-p)/j,He=R?F===1?Ae:-Ae:0,Ve=R?0:F===0?Ae:-Ae,_e=-He,L=-Ve,N=0,V=0,U=0;{let J=0/j,Z=R?ze:q(p*(1-J)+m*J,I,A),Q=R?q(f*(1-J)+g*J,O,$):Le,pe=Ee(Z,Q);N=Z*v,V=b(Q),U=pe}let Y=0,re=0,ye=0;{let J=1/j,Z=R?ze:q(p*(1-J)+m*J,I,A),Q=R?q(f*(1-J)+g*J,O,$):Le,pe=Ee(Z,Q);Y=Z*v,re=b(Q),ye=pe}for(let J=1;J<B-1;J+=fe){let Z=J/j,Q=Y,pe=re,Me=ye;{let je=R?st:q(Z,x,D),tt=R?q(Z,E,M):De,ht=Q-H,it=pe-k,Ye=Me-K;zo(Q,it,Ye,T),i.setEdgeVertexFromValuesRawPositionUV(F,J,ht,it,Ye,je,tt)}{let je=(J+1)/j,tt=R?ze:q(p*(1-je)+m*je,I,A),ht=R?q(f*(1-je)+g*je,O,$):Le,it=Ee(tt,ht);Y=tt*v,re=b(ht),ye=it}let et=Y,Je=ye,$e=N,Ke=V,at=U;N=Q,V=pe,U=Me;let Ze=0,Ge=0,y=0;if(R){let je=re-pe,tt=Je-Me,ht=Ke-pe,it=at-Me,Ye=q(f*(1-Z)+g*Z,O,$),gt=ze+_e,wt=gt*v-Q,xt=gi(gt,Ye,c)-Me,bi=F===3?-1:1;if(Ze=bi*(-ht+je)*xt,Ge=bi*wt*(-it+tt),y=-bi*wt*(-ht+je),ue){let Ci=ze+He,li=Ci*v-Q;Ze=(-ht+je)*(xt-(gi(Ci,Ye,de)-Me)),Ge=(wt-li)*(-it+tt),y=-(wt-li)*(-ht+je)}}else{let je=et-Q,tt=Je-Me,ht=$e-Q,it=at-Me,Ye=q(p*(1-Z)+m*Z,I,A),gt=Le+L,wt=gi(Ye,gt,c)-Me,xt=b(gt)-pe,bi=F===2?-1:1;if(Ze=bi*xt*(-it+tt),Ge=bi*(-ht+je)*wt,y=-bi*xt*(-ht+je),ue){let Ci=Ye,li=Le+Ve,ci=b(li)-pe;Ze=(-xt+ci)*(-it+tt),Ge=(-ht+je)*(-wt+(gi(Ci,li,de)-Me)),y=-(-xt+ci)*(-ht+je)}}let qe=1/Math.sqrt(Ze*Ze+Ge*Ge+y*y);i.setEdgeNormalFromValues(F,J,Ze*qe,Ge*qe,y*qe)}}}function M8(e,t){N8(e)}function Xte(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function Jte(e,t){return e*t}function S8(e,t,i){return e?r=>Xte(r,t):r=>Jte(r,i)}function I8(e,t,i){let{numVerticesPerSide:r,vertexAttributes:n,maxEdgeVertexCount:s}=e,o=r-1,a=n.count,l=2*(r-3)*(r-3),c=4*(o+s-3),h=OD.reduce((_,v)=>_+(o+e.getEdgeCount(v)-3),0),p=t.reduce((_,v)=>_+o*(2*(v.latitudeResolution-1)+1),0),m=3*(i?2:1),f=(l+c+p)*m,g=a>=Wte?new Uint32Array(f):new Uint16Array(f);for(let _=0;_<f;++_)g[_]=0;e.indices=g,e.indexCount=(l+h+p)*m,e.poleIndicesStartIndex=l*m,e.edgeIndicesStartIndex=(l+p)*m,i?(iie(e),rie(e,t),R8(e)):(eie(e),tie(e,t),A8(e))}function eie(e){let{numVerticesPerSide:t,indices:i,vertexAttributes:r}=e,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=t-2,l=t-3,c=0,h=t-3,p=0;for(let m=0;m<l;++m){let f=m*a;for(let g=c;g<h;++g){let _=f+g,v=_+1,b=v+a,x=b-1;V8(_,v,b,x,o,s)?(i[p]=_,i[p+1]=v,i[p+2]=b,i[p+3]=b,i[p+4]=x,i[p+5]=_):(i[p]=_,i[p+1]=v,i[p+2]=x,i[p+3]=x,i[p+4]=v,i[p+5]=b),p+=6}}}function tie(e,t){let{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:n}=e,s=i-1,o=n;for(let a of t){let l=a.isNorth?1:2,c=a.isNorth?2:1,h=a.isNorth?3:4,p=a.isNorth?4:3,m=e.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),f=1;for(let g=0;g<a.latitudeResolution;++g){let _=g===0?a.rowOffset:m+i;for(let v=0;v<s;v++){let b=_+v;r[o]=m,r[o+l]=m+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+h]=m+1,r[o+p]=b+1,r[o+5]=b,o+=6):o+=3,m+=f}m=_,f=1}}}function A8(e){let{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,n=i-1,s=n-2,o=r;for(let a=0;a<4;++a){let l=GO[a],c=0,h=0,p=e.getEdgeCount(a),m=l.count;te(m===n-1);let f=a===1||a===2,g=f?1:2,_=f?2:1,v=e.getEdgeFirstVertexIndex(a),b=1,x=l.vertex0Index,E=l.stride;for(;c<p-1||h<m-1;){let D=x+h*E,M=v+c*b,T=c<p-1,I=h<m-1,A=T&&(!I||(T?0+n*(c+.5)/(p-1):0)<=(I?1+s*(h+.5)/(m-1):0));A?++c:++h;let O=A?M+b:D+E;t[o]=D,t[o+g]=M,t[o+_]=O,o+=3}}e.indexCount=o}function iie(e){let{indices:t,numVerticesPerSide:i,vertexAttributes:r}=e,{position:n}=r,{typedBuffer:s,typedBufferStride:o}=n,a=i-2,l=0;for(let c=0;c<i-3;++c){let h=c*a;for(let p=0;p<i-3;++p){let m=c*a+p,f=m+1,g=f+a,_=g-1,v=h+p,b=v+1,x=b+a;V8(v,b,x,x-1,o,s)?(Xf(t,l,m,f,g),l+=6,Xf(t,l,g,_,m)):(Xf(t,l,m,f,_),l+=6,Xf(t,l,_,g,f)),l+=6}}}function rie(e,t){let{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:n}=e,s=r-1,o=n;for(let a of t){let l=a.connectedOuterEdgeOffset,c=e.getEdgeVertexIndex(l,0),h=1;for(let p=0;p<a.latitudeResolution;++p){let m=p===0?a.rowOffset:c+r;for(let f=0;f<s;f++)Xf(i,o,c,c+1,m+f),o+=6,p<a.latitudeResolution-1&&(Xf(i,o,c+1,m+f+1,m+f),o+=6),c+=h;c=m,h=1}}}function R8(e){let{indices:t,numVerticesPerSide:i,edgeIndicesStartIndex:r}=e,n=i-1,s=n-2,o=r;for(let a=0;a<4;++a){let l=GO[a],c=0,h=0,p=e.getEdgeCount(a),m=l.count;te(m===n-1);let f=a===1||a===2,g=f?1:3,_=f?3:1,v=e.getEdgeFirstVertexIndex(a),b=1,x=l.vertex0Index,E=l.stride;for(;c<p-1||h<m-1;){let D=x+h*E,M=v+c*b,T=c<p-1,I=h<m-1,A=T&&(!I||(T?0+n*(c+.5)/(p-1):0)<=(I?1+s*(h+.5)/(m-1):0));A?++c:++h;let O=A?M+b:D+E;t[o]=D,t[o+g]=M,t[o+g+1]=M,t[o+_]=O,t[o+_+1]=O,t[o+5]=D,o+=6}}e.indexCount=o}function jO(e){let{geometry:t,geometryState:i}=e,{edgeResolutions:r}=i,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=t,o=n-2,a=s;for(let l=0;l<4;++l){{let c=l===0||l===2,h=(l===0?o-1:0)*o+(l===1?o-1:0),p=(c?0:1)*o+(c?1:0),m=GO[l];m.vertex0Index=h,m.stride=p,m.count=o}{let c=r[l]+1;t.outerEdgesOffsetAndLength[2*l+0]=a,t.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function P8(e){jO(e),e.geometryState.wireframe?R8(e.geometry):A8(e.geometry)}function O8(e,t,i){let{geometryState:r,geometry:n,tile:s,localOrigin:o}=e,a=t===1||t===3,l=r.edgeResolutions[t];te(Cd(l));let c=l+1,{boundingBox:h,minu:p,minv:m,maxu:f,maxv:g,vertexAttributes:_}=n,v=q(t===1?1:0,p,f),b=q(t===0?1:0,m,g),x=i.renderData,E=x.geometryState,D=x.geometry,M=(t+2)%4,T=D.getEdgeCount(M),I=s.getNeighborEdgeStartVertexIndex(t,i)*l,A=l*2**(s.level-i.level);te(E.edgeResolutions[M]===A),te(T-1===A);let O=x.localOrigin[0]-o[0],$=x.localOrigin[1]-o[1],H=x.localOrigin[2]-o[2],k=n.getEdgeFirstVertexIndex(t),K=_.position,F=K.typedBuffer,R=K.typedBufferStride,j=_.normalCompressed,B=j.typedBuffer,z=j.typedBufferStride,ce=_.uv0,ue=D.vertexAttributes,Ie=D.getEdgeFirstVertexIndex(M),le=ue.position.typedBuffer,ze=ue.position.typedBufferStride,Le=ue.normalCompressed.typedBuffer,de=ue.normalCompressed.typedBufferStride;for(let fe=1;fe<c-1;++fe){let st=k+fe,De=Ie+(I+fe),Ee=st*R,Ae=De*ze,He=le[Ae]+O,Ve=le[Ae+1]+$,_e=le[Ae+2]+H;F[Ee]=He,F[Ee+1]=Ve,F[Ee+2]=_e,zo(He,Ve,_e,h);let L=st*z,N=De*de;B[L]=Le[N],B[L+1]=Le[N+1];let V=fe/l,U=a?v:q(V,p,f),Y=a?q(V,m,g):b;jo(ce,st,U,Y)}}function N8(e){let{geometry:t,geometryState:i,localOrigin:r}=e,{clippingArea:n,samplerData:s}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:h,vertexAttributes:p}=t,m=e.tile,{surface:f,ellipsoid:g,extent:_,extentInRadians:v,horizontalScale:b}=m,x=f.view?.viewingMode==="local",E=g.radius,D=0,M=0,T=0,I=(L,N,V)=>{let U=v[N===0?1:3],Y=v[L===0?0:2],re=Math.cos(U),ye=Math.sin(U),J=Math.sin(Y),Z=Math.cos(Y),Q=E+V;D=Z*re*Q,M=J*re*Q,T=ye*Q},A=x?(()=>{let L=n,N=L!=null&&(_[3]>L[3]||_[2]>L[2]||_[1]<L[1]||_[0]<L[0]),V=S8(f.isWebMercatorOnPlateCarree,E,b);return(U,Y,re)=>{let ye=U===0?_[0]:_[2],J=Y===0?_[1]:_[3],Z=N?q(ye,L[0],L[2]):ye,Q=N?q(J,L[1],L[3]):J,pe=re;D=Z*b,M=V(Q),T=pe}})():I,O=0,$=0,H=0,k=0,K=0,F=0,R=0,j=0,B=0,z=x&&f.isWebMercatorOnPlateCarree,ce=(L,N,V,U,Y)=>{let re=0,ye=0,J=0;if(x){let Z=N*b,Q=z?(Math.PI/2-2*Math.atan(Math.exp(-V/E)))*E:V*b;re=Z-D,ye=Q-M,J=U-T}else{let Z=BO(L),Q=L.tile,pe=Q.extent,Me=Q.extentInRadians,et=(N-pe[0])/(pe[2]-pe[0]),Je=(V-pe[1])/(pe[3]-pe[1]),$e=Me[0]*(1-et)+Me[2]*et,Ke=Z(Je),at=Math.cos(Ke),Ze=Math.sin(Ke),Ge=Math.sin($e),y=Math.cos($e),qe=E+U;re=y*at*qe-D,ye=Ge*at*qe-M,J=Ze*qe-T}switch(Y){case 0:R+=re,j+=ye,B+=J;break;case 1:k-=re,K-=ye,F-=J;break;case 2:R-=re,j-=ye,B-=J;break;case 3:k+=re,K+=ye,F+=J}},ue=n??zO,Ie=_[0],le=_[2],ze=_[1],Le=_[3],de=[Le>ue[3],le>ue[2],ze<ue[1],Ie<ue[0]],fe=Math.max(Ie,ue[0]),st=Math.min(le,ue[2]),De=Math.max(ze,ue[1]),Ee=Math.min(Le,ue[3]),Ae=L=>Math.max(ue[0],Math.min(ue[2],L)),He=L=>Math.max(ue[1],Math.min(ue[3],L)),Ve=L=>{let N=i.cornerNeighborCornerTiles;O=0,$=0,H=1,k=0,K=0,F=0,R=0,j=0,B=0;let V=1/0;for(let Z=0;Z<4;++Z){let Q=N[4*L+Z];V=Math.min(V,Q?.level??1/0)}for(let Z=0;Z<4;++Z){let Q=N[4*L+Z];av[Z]=Q?.level===V?Q:null}let U=1,Y=0;for(let Z=0;Z<4;++Z){let Q=av[Z];Q&&(U=Math.max(U,Q?.renderData.geometryState.numVerticesPerSide),Y=Q.extent[2]-Q.extent[0])}let re=Y,ye=U;te(ye>1);let J=re/ye;for(let Z=0;Z<4;++Z){let Q=av[(Z+3)%4],pe=av[Z%4];if(!Q&&!pe)continue;let Me=Z===0?1:Z===1?2:Z===2?3:0,et=Z===0?2:Z===1?3:Z===2?0:1;if(Q&&pe){let Je=kO[Z][0]*J,$e=kO[Z][1]*J,Ke=Q.extent,at=Ae(Ke[Me===0||Me===1?2:0]+Je),Ze=He(Ke[Me===0||Me===3?3:1]+$e),Ge=pe.extent,y=Ae(Ge[et===0||et===1?2:0]+Je),qe=He(Ge[et===0||et===3?3:1]+$e),je=Q.renderData,tt=pe.renderData,ht=gi(at,Ze,je.geometryState.samplerData),it=gi(y,qe,tt.geometryState.samplerData);ce(je,at,Ze,.5*(ht+it),Z)}else{let Je=Q??pe,$e=Q?Me:et,Ke=Je.extent,at=kO[Z],Ze=Ae(Ke[$e===0||$e===1?2:0]+at[0]*J),Ge=He(Ke[$e===0||$e===3?3:1]+at[1]*J),y=Je.renderData,qe=gi(Ze,Ge,y.geometryState.samplerData);ce(y,Ze,Ge,qe,Z)}}if(!x){let Z=Math.sqrt(D*D+M*M+T*T);O=D/Z,$=M/Z,H=T/Z}if(x||H*H<.999){let Z=Math.sqrt(k*k+K*K+F*F);k/=Z,K/=Z,F/=Z;let Q=Math.sqrt(R*R+j*j+B*B);R/=Q,j/=Q,B/=Q,O=F*j-K*B,$=k*B-F*R,H=K*R-k*j;let pe=1/Math.sqrt(O*O+$*$+H*H);O*=pe,$*=pe,H*=pe}},_e=i.cornerNeighborCornerTiles;for(let L=0;L<4;++L){let N=L,V=(L+1)%4,U=L===0||L===1?1:0,Y=L===0||L===3?1:0,re=q(U,o,l),ye=q(Y,a,c),J=t.getEdgeFirstVertexIndex(N),Z=t.getEdgeCount(N),Q=L===0||L===3?Z-1:0,pe=t.getEdgeFirstVertexIndex(V),Me=t.getEdgeCount(V),et=L===0||L===1?Me-1:0,Je=-1;for(let at=0;at<4;++at){let Ze=_e[4*L+at],Ge=_e[4*L+Je];Ze&&(Je===-1||wo(Ge,Ze)>0)&&(Je=at)}let $e=Je,Ke=_e[4*L+$e];if(Ke!==m){let at=m.level-Ke.level,Ze=2**at,Ge=[Ke.lij[0]+at,Ke.lij[1]*Ze,Ke.lij[2]*Ze],y=[Ge[1]+Ze===m.lij[1],L===0&&($e===1||$e===0&&Ke!==_e[4*L+3])||L===1&&($e===0||$e===1&&Ke!==_e[4*L+2]),Ge[1]===m.lij[1]+1,L===2&&($e===3||$e===2&&Ke!==_e[4*L+1])||L===3&&($e===2||$e===3&&Ke!==_e[4*L+0])],qe=y.reduce((Ye,gt)=>Ye+(gt?1:0),0);te(qe===1||qe===2);let je=-1,tt=-1,ht=Ke.renderData;if(qe===1){let Ye=y.findIndex(wt=>wt);te(0<=Ye&&Ye<=3),je=(Ye+2)%4;let gt=i.edgeResolutions[Ye];tt=m.getNeighborEdgeStartVertexIndex(Ye,Ke)*gt+gt*(Ye===0&&L===0||Ye===1&&L===0||Ye===2&&L===1||Ye===3&&L===3?1:0)}else{te(y[1]||y[3]),je=y[1]?3:1;let Ye=ht.geometryState.edgeResolutions[je];tt=L===0||L===3?0:Ye}let it=ht.geometry;{let Ye=J+Q,gt=pe+et,wt=it.getEdgeFirstVertexIndex(je)+tt,xt=it.vertexAttributes,bi=ht.localOrigin;{let li=xt.position,ci=li.typedBuffer,zt=wt*li.typedBufferStride,bt=ci[zt]+bi[0]-r[0],Qe=ci[zt+1]+bi[1]-r[1],Gt=ci[zt+2]+bi[2]-r[2];zo(bt,Qe,Gt,h);let Ot=p.position,se=Ot.typedBuffer;{let ri=Ye*Ot.typedBufferStride;se[ri]=bt,se[ri+1]=Qe,se[ri+2]=Gt}{let ri=gt*Ot.typedBufferStride;se[ri]=bt,se[ri+1]=Qe,se[ri+2]=Gt}}let Ci=p.uv0;jo(Ci,Ye,re,ye),jo(Ci,gt,re,ye);{let li=xt.normalCompressed.typedBuffer,ci=wt*xt.normalCompressed.typedBufferStride,zt=p.normalCompressed,bt=zt.typedBuffer;{let Qe=Ye*zt.typedBufferStride;bt[Qe]=li[ci],bt[Qe+1]=li[ci+1]}{let Qe=gt*zt.typedBufferStride;bt[Qe]=li[ci],bt[Qe+1]=li[ci+1]}}}}else{let at=de[N],Ze=de[V],Ge;if(at||Ze){let tt=q(Ie*(1-U)+le*U,fe,st),ht=q(ze*(1-Y)+Le*Y,De,Ee);Ge=gi(tt,ht,s)}else Ge=nie(_e,L);A(U,Y,Ge),Ve(L);let y=D-r[0],qe=M-r[1],je=T-r[2];zo(y,qe,je,h),t.setEdgeVertexFromValuesRawPositionUVNormal(N,Q,y,qe,je,re,ye,O,$,H),t.setEdgeVertexFromValuesRawPositionUVNormal(V,et,y,qe,je,re,ye,O,$,H)}}for(let L=0;L<4;++L)av[L]=null}function nie(e,t){let i=4*t,r=OD.reduce((a,l)=>Math.min(a,e[i+l]?.level??1/0),1/0);Ki&&(te(!e[i+0]||!e[i+2]||HD(e[i+0],e[i+2],ii.SOUTH_WEST)),te(!e[i+1]||!e[i+3]||HD(e[i+1],e[i+3],ii.NORTH_WEST)));let n=0,s=0;for(let a=0;a<4;++a){let l=e[i+a];if(l&&l.level===r){let c=a===0||a===1,h=a===0||a===3,p=l.extent,m=p[c?0:2],f=p[h?1:3],g=l.renderData?.geometryState?.samplerData;s+=gi(m,f,g),n++}}let o=n?s/n:0;return te(o!=null),o}function Jf(e){let{vao:t,geometry:i}=e,{vertexAttributes:r,edgeVerticesStartIndex:n}=i,s=r.position.typedBuffer;t.vertexBuffers.get("geometry").setSubData(s,n,n,s.length)}function L8(e){let{vao:t,geometry:i}=e,{indices:r,indexCount:n,edgeIndicesStartIndex:s}=i;t.indexBuffer.setSubData(r,s,s,n)}var VO=class{constructor(t,i,r,n,s){this.isNorth=t,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=n,this.latitudeResolution=s}},kO=[[0,1],[1,0],[0,-1],[-1,0]],kr=new SD,zO=H2(-1/0,-1/0,1/0,1/0),av=[null,null,null,null];function F8(e,t,i){if(!t)return!1;let r=wo(e,t);return r>0||r===0&&i>=2}var Kf=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(t){return te(0<=t&&t<this.count),this.vertex0Index+this.stride*t}},GO=[new Kf,new Kf,new Kf,new Kf];function zo(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function k8(e){let{edgeResolutions:t,numVerticesPerSide:i}=e,r=1+Math.max(...t);return Math.max(i,r)}function V8(e,t,i,r,n,s){let o=e*n,a=s[o],l=s[o+1],c=s[o+2],h=t*n,p=s[h],m=s[h+1],f=s[h+2],g=i*n,_=s[g],v=s[g+1],b=s[g+2],x=r*n,E=s[x],D=s[x+1],M=s[x+2];return(p-E)*(p-E)+(m-D)*(m-D)+(f-M)*(f-M)>(a-_)*(a-_)+(l-v)*(l-v)+(c-b)*(c-b)}function Xf(e,t,i,r,n){e[t]=i,e[t+1]=r,e[t+2]=r,e[t+3]=n,e[t+4]=n,e[t+5]=i}var BD=6;var jD=class extends md{constructor(t,i,r,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Yt(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(t,i,r,n,s)}init(t,i,r,n,s){super.init(t,i,r,n,s);let o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&h0(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;let{isWebMercatorOnPlateCarree:c}=s,h=this._extentInRenderSR,p=this.extent;if(c){let m=yt(p[0],p[1],0);Ua(m,Qt.WebMercator,m,Qt.PlateCarree);let f=yt(p[2],p[3],0);Ua(f,Qt.WebMercator,f,Qt.PlateCarree),h[0]=m[0],h[1]=m[1],h[2]=f[0],h[3]=f[1]}else for(let m=0;m<4;++m)h[m]=p[m]*l;this.centerAtSeaLevel[0]=.5*(h[0]+h[2]),this.centerAtSeaLevel[1]=.5*(h[1]+h[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(h[2]-h[0],h[3]-h[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();let t=this._extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(n,s);this._center[Fi.MIDDLE][3]=o}_calculateFrustumVisibility(t){let i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5],c=!0;for(let h=0;h<6;h++){let p=t[h],m=p[0],f=p[1],g=p[2],_=p[3];if(m*(m>0?r:o)+f*(f>0?n:a)+g*(g>0?s:l)+_>=0)return Er.OUTSIDE;c=c&&m*(m<0?r:o)+f*(f<0?n:a)+g*(g<0?s:l)+_<=0}return c?Er.INSIDE:Er.INTERSECTS}_aabb(){let t=this._extentInRenderSR;return vL(t[0],t[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),t[2],t[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(t,i,r,n){return UD[0]=1/i[0],UD[1]=1/i[1],UD[2]=1/i[2],tw(this._aabb(),t,UD,r,n)}createGeometry(){C8(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){let t=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData,n=t,s=i;if(r){let o=r.geometry.boundingBox;n=o[2],s=o[5]}else if(!this.leaf){n=1/0,s=-1/0;for(let o of this.children){let a=o;n=Math.min(n,a._subtreeGeometryElevationBoundMin),s=Math.max(s,a._subtreeGeometryElevationBoundMax)}}(n!==this._subtreeGeometryElevationBoundMin||s!==this._subtreeGeometryElevationBoundMax)&&(this._subtreeGeometryElevationBoundMin=n,this._subtreeGeometryElevationBoundMax=s,this.parent?._updateSubtreeGeometryElevationsBounds())}get minimumVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){T8(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){D8(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){E8(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}},UD=w();var qO=class{constructor(){this.extent=Qi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},lv=class extends P{constructor(){super(...arguments),this._queries=new Nt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Nt({initialSize:30}),this._queryPool=new no(qO)}queryVisibleLevelRange(e,t,i,r){let n=this._queryPool.acquire();Pp(n.extent,e),n.minLevel=t??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=r,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){let e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){let t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){let t=e.level,i=0;for(;i<this._queriesInvPtr;){let r=this._queries.data[i],n=r.extent;t>=r.minLevel&&t<=r.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],lv.prototype,"updating",null),lv=u([C("esri.views.3d.terrain.ScaleRangeQueries")],lv);function H8(e,t,i,r){let n=Math.cos(i);e[0]=Math.cos(t)*n*r,e[1]=Math.sin(t)*n*r,e[2]=Math.sin(i)*r}var zD=class extends md{constructor(t,i,r,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=ur(),this._baseUsedMemory=1816,this.init(t,i,r,n,s)}init(t,i,r,n,s){super.init(t,i,r,n,s);let o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],h=this.extentInRadians[3],p=Xe(l,h,.5),m=Xe(a,c,.5),f=t===0?0:Math.min(Math.abs(l),Math.abs(h));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),H8(this.centerAtSeaLevel,m,p,this.ellipsoid.radius),ne(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();let t=this._center;if(this.lij[0]===0)Te(t[Fi.MIDDLE],0,0,0),Te(t[Fi.TOP],0,0,0),Te(t[Fi.BOTTOM],0,0,0),t[Fi.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();let i=t[Fi.MIDDLE],r=this.convexHull,n=0;for(let s=0;s<8;++s)n=Math.max(n,sie(i,r,3*s));t[Fi.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibility(t){if(!qg(t,this._boundingSphere))return Er.OUTSIDE;if(this.lij[0]<10)return Er.INTERSECTS;let i=this.convexHull,r=this.surface.view.state.camera.near,n=!0;for(let s=0;s<MF;s++){let o=s===eu.NEAR,a=t[s],l=a[0],c=a[1],h=a[2],p=a[3]-(o?r:0),m=!1;for(let f=0;f<8;++f){let g=3*f;if(l*i[g]+c*i[g+1]+h*i[g+2]+p<0){if(m=!0,!n)break}else n=!1}if(!m)return Er.OUTSIDE}return n?Er.INSIDE:Er.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){f8(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ki&&this._checkBVs()}_updateBoundingSphere(){let t=this._boundingSphere,i=t,r=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this.ellipsoid.radius,o=n;if(this.level===0)Te(i,0,0,0),t[3]=s+o;else{let a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],h=a[3];op(j8,l,c,s),op(z8,l,h,s),he(i,j8,z8),X(i,i,(s+.5*(r+n))/vr(i));let p=this.convexHull,m=0,f=(_,v)=>{let b=_[0]-p[3*v],x=_[1]-p[3*v+1],E=_[2]-p[3*v+2];return Math.sqrt(b*b+x*x+E*E)};for(let _=0;_<8;++_){let v=f(i,_);m=Math.max(m,v)}let g=m;t[3]=g+2}}_updateConvexHull(){let t=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;let r=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this._getPatchType(),o=this.surface.isWebMercator,a=o&&s===yo.HAS_NORTH_POLE,l=o&&s===yo.HAS_SOUTH_POLE,c=l||a,h=Math.PI/2,p=t[0],m=t[2],f=l?-h:t[1],g=a?h:t[3],_=.5*(p+m),v=r,b=i+(c?Math.min(0,v-1):v),x=(B,z,ce)=>op(B,z,ce,b),E=w(),D=w(),M=w(),T=w();x(E,p,f),x(D,p,g),x(M,m,g),x(T,m,f);let I=(B,z)=>{for(let ce=0;ce<3;++ce)this._convexHull[3*z+ce]=B[ce]};I(E,0),I(D,1),I(M,2),I(T,3);let A=n,O=i+(c?Math.max(0,A+1):A),$=w(),H=w(),k=w();op(H,_,g,b),op(k,_,f,b),he($,H,k),ne($,$);let K=w(),F=w(),R=(B,z)=>{ai(F,B,z),ne(F,F);let ce=-ae(B,K)/ae(F,K);te(ce>=0),X(F,F,ce),he(B,B,F)};if(2**this.lij[0]>2*this.lij[1]){let B=k,z=w();At(z,U8,B),ne(z,z),At(K,B,z),ne(K,K),te(Vn(ae(K,B)/vr(B),0)),R(E,D),R(T,M),I(E,0),I(T,3)}else if(2**this.lij[0]!==2*this.lij[1]){let B=H,z=w();At(z,U8,B),ne(z,z),At(K,z,B),ne(K,K),R(D,E),R(M,T),I(D,1),I(M,2)}let j=(B,z)=>{let ce=O/ae(z,$);for(let ue=0;ue<3;++ue)this._convexHull[3*B+ue]=z[ue]*ce};j(4,E),j(5,D),j(6,M),j(7,T)}_getPatchType(){let t=this.lij[1],i=t===0,r=t===(1<<this.level)-1;return i?r?yo.HAS_BOTH_POLES:yo.HAS_NORTH_POLE:r?yo.HAS_SOUTH_POLE:yo.REGULAR}intersectsRay(t,i,r,n){let s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-t[0],c=s[1]-t[1],h=s[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,m=i[0]*p-l,f=i[1]*p-c,g=i[2]*p-h;return m*m+f*f+g*g<o*o}get minimumVerticesPerSide(){return this.level<B8.length?B8[this.level]+1:2}updateCornerElevations(){y8(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){g8(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){_8(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Ki||this.level<=2)return;let t=this._boundingSphere,i=t[3],r=t,n=w(),s=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=s+o,c=1,h=0,p=this._center[Fi.MIDDLE][3],m=this.convexHull,f=(N,V)=>{for(let U=0;U<3;++U)N[U]=m[3*V+U]};{let N=w(),V=w(),U=w(),Y=w(),re=w(),ye=(J,Z,Q,pe)=>{f(V,J),f(U,Z),f(Y,Q),ai(V,V,U),ai(Y,Y,U),At(N,V,Y),ne(N,N);let Me=ae(N,U);f(re,pe);let et=ae(N,re),Je=Math.abs(et-Me);te(Vn(Je,0),`Non coplanar ${J},${Z},${Q},${pe} diff = ${Je}`)};ye(0,1,2,3),ye(4,5,6,7),ye(0,1,4,5),ye(1,2,5,6),ye(2,3,6,7),ye(3,0,7,4)}let g=uL(24),_=(N,V,U)=>{let Y=4*N;for(let re=0;re<3;++re)g[Y+re]=V[re];g[Y+3]=U},v=w(),b=w(),x=w(),E=w(),D=(N,V,U,Y)=>{f(v,V),f(b,U),f(x,Y),ai(v,v,b),ne(v,v),ai(x,x,b),ne(x,x),At(E,v,x),ne(E,E);let re=ae(E,b);_(N,E,re)};D(0,0,1,2),D(1,1,0,4),D(2,1,5,2),D(3,3,2,6),D(4,4,0,3),D(5,4,6,5);let M=(N,V,U,Y)=>{let re=4*N;return g[re]*V+g[re+1]*U+g[re+2]*Y-g[re+3]},T=(N,V,U,Y)=>M(N,V,U,Y)>=-1,I=(N,V)=>T(N,V[0],V[1],V[2]),A=2**this.lij[0]>2*this.lij[1],O=(N,V,U)=>Math.sqrt(G8(N,V,U,r[0],r[1],r[2]))<i,$=N=>O(N[0],N[1],N[2]),H=(N,V)=>O(N[V],N[V+1],N[V+2]),k=this.extentInRadians,K=.5*(k[0]+k[2]),F=k[1],R=k[3],j=w(),B=w();op(j,K,R,l),op(B,K,F,l);let z=A?"Upper":"Lower",ce=!0;for(let N=0;N<6;++N){for(let V=0;V<8;++V){let U=3*V,Y=T(N,m[U],m[U+1],m[U+2]);ce&&=Y,te(Y,`Tile[${this.lij}] Convex hull point ${V} outside of plane ${N}`)}te(I(N,B),`Tile[${this.lij}] (${z}) bottom mid outside of plane ${N}`),te(I(N,j),`Tile[${this.lij}] (${z}) top mid outside of plane ${N}`)}te(ce,"Not all convex hull points are inside  convex hull polyhedron"),te($(B),`Tile[${this.lij}] (${z}) bottom mid outside of bounding sphere`),te($(j),`Tile[${this.lij}] (${z}) top mid outside of bounding sphere`);for(let N=0;N<8;++N){let V=H(m,3*N);te(V,`Tile[${this.lij}] Convex hull point ${N} outside of bounding sphere`)}for(let N=0;N<6;++N)for(let V=0;V<8;++V){let U=3*V;T(N,m[U],m[U+1],m[U+2])||console.error(`Tile[${this.lij}] Convex hull point ${V} outside of plane ${N}`)}let{extentInRadians:ue}=this,Ie=Math.max(ue[2]-ue[0],ue[3]-ue[1]),le=Math.round(Ie*s),{renderData:ze}=this;if(!ze)return;let{geometry:Le,geometryState:de,localOrigin:fe}=ze,st=Le.vertexAttributes?.position;if(!st)return;let De=w(),Ee=Le.numVerticesPerSide-2,{indices:Ae,indexCount:He,edgeVerticesStartIndex:Ve,poleVerticesStartIndex:_e}=Le;if(!Ae)return;let L=new Set;for(let N=0;N<He;++N){let V=Ae[N];if(L.has(V))continue;L.add(V);let U=V<_e,Y=V>=Ve,re=!1,ye=-1;if(Y){let y=Ve;for(let qe=0;qe<4;++qe){let je=de.edgeResolutions[qe];if(V===y||V===y+je-1){re=!0;break}if(y+=je,V<y){ye=qe;break}}}let J=Y?de.edgePeerNeighbors[ye]:null,Z=Y&&J&&wo(this,J)>0;st.getVec(V,n),he(De,n,fe);let Q=vr(De)-s,pe=0,Me=!1,et=o-Q,Je=Q-a,$e=et>c,Ke=Je>c,at=$e||Ke,Ze=()=>{let y=U?"internal":Y&&!re?"edge":re?"corner":"pole";return`Tile[${this.lij}].vertex[${V}]:${y}`+($e?"(below)":Ke?"(above)":"")+(Z?"(Neighbor)":"")},Ge=Rr(De,r);if(Ge>=i+h){let y=Ge-i;at||(console.error(`${Ze()} is out of the bounding sphere by ${y.toFixed(0)} / ${i.toFixed(0)}[tol=${h}] h=${Q.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(y/i).toFixed(0)})`),Me=!0)}for(let y=0;y<6;++y)if(!T(y,De[0],De[1],De[2])){let qe=M(y,De[0],De[1],De[2]),je=V%Ee,tt=(V-je)/Ee;y===0&&et||y===5&&Je||(console.error(`${Ze()} (${je},${tt})|${Ee}] is out of the bounding trapezoid plane ${y} h=${Math.round(Q)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(qe)} radii = ${Math.round(i)}/${Math.round(p)}} : maxL = ${le}`),++pe)}if(Me||pe>0)break}}get convexHull(){return this._convexHull}},B8=[128,64,64,32,16,8,8,4];function sie(e,t,i){return G8(e[0],e[1],e[2],t[i],t[i+1],t[i+2])}function G8(e,t,i,r,n,s){let o=r-e,a=n-t,l=s-i;return o*o+a*a+l*l}var op=(e,t,i,r)=>{let n=Math.cos(t),s=Math.sin(t),o=Math.cos(i),a=Math.sin(i);e[0]=r*o*n,e[1]=r*o*s,e[2]=r*a},U8=[0,0,1],j8=w(),z8=w();var Go=class extends P{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([d()],Go.prototype,"fovX",void 0),u([d()],Go.prototype,"fovY",void 0),u([d()],Go.prototype,"relativeWidthLimit",void 0),u([d()],Go.prototype,"relativeHeightLimit",void 0),u([d()],Go.prototype,"maxLod",void 0),u([d()],Go.prototype,"angledSplitBias",void 0),u([d()],Go.prototype,"aboveGround",void 0),u([d()],Go.prototype,"frustum",void 0),Go=u([C("esri.views.3d.terrain.SplitLimits")],Go);var q8=Ps().vec3f(yi.POSITION).vec2i16(yi.UV0).vec2i16(yi.NORMALCOMPRESSED,{glNormalized:!0});var GD=class{constructor(t){this._storage=new Bo((i,r)=>t.newCache(i,r),"TileGeometry")}acquire(t){let r=Math.ceil(t/4)*4,n=this._storage,s=oie(r),o=n.pop(s);if(o)return o;let a=q8.createBuffer(r);return a.release=()=>n.put(s,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function oie(e){return e.toString()}var qD=class extends Q3{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Jo}},cv=class extends ft{constructor(t,i){super(t,i,new mt(aH,()=>import("./chunk-XBVGTIB3.js")))}};function W8(e,t){let i=e.transforms.tileUnitsToPixels,r=Ip(t),n=Math.cos(r),s=Math.sin(r),o=Math.ceil(512*(Math.abs(s)+Math.abs(n)));Fp(Ol),ql(Ol,Ol,[o/2,o/2]),kp(Ol,Ol,r),ql(Ol,Ol,[-256,-256]),L0(Ol,Ol,[1/8,1/8,1]),e.transforms.tileUnitsToPixels=Ol;let a=[],l=new YV(4096,a,()=>new WV),c=new QV(a,l,(h,p,m)=>new ZV(h,p,m,e.styleRepository,e.key.level,t),(h,p)=>{$V(h,p,!1)},()=>0,h=>{let p=e.styleRepository.getStyleLayerByUID(h).getLayoutProperty("visibility");return!p||p.getValue()!==NF.NONE});a.push(e),l.add(e),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(e),e.transforms.tileUnitsToPixels=i}var Ol=em();var aie=.125,WD=class{constructor(){this._renderParams={reshuffleManager:new aV,context:null,drawPhase:1,state:new WO,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new KV(new k0(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(t,i,r,n,s,o,a,l,c,h){let p=this._backgroundTile;this._updateRenderParameters(t,i,p,r,s,o,a,l,c,h),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,p,n)}renderContent(t,i,r,n,s,o,a,l,c,h,p,m){this._declutter(r),n.forAll(({sourceLayerInfo:{data:_}})=>this._declutter(_));let f=n.length>0;f&&this._stencilSymbols(t,i,r,n,s,o,a,l,c,h,p,m);let g=1;r.stencilRef=f?g:0,t.setStencilFunction(Ei.EQUAL,r.stencilRef,255),this._render(t,i,r,s,o,a,l,c,h,p,m),n.forAll(({sourceLod:_,offset:v,sourceLayerInfo:{data:b}})=>{b.stencilRef=++g,this._renderSymbols(t,_,b,s,o,a,l,v,h,p,m)})}_stencilSymbols(t,i,r,n,s,o,a,l,c,h,p,m){let f=1;r.stencilRef=f,t.setDepthTestEnabled(!1),t.setDepthWriteEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(S0.KEEP,S0.KEEP,S0.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(Ei.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(t,i,r,s,o,a,l,c,h,p,m),n.forAll(({sourceLod:g,offset:_,sourceLayerInfo:{data:v}})=>{v.stencilRef=++f,t.setStencilFunction(Ei.ALWAYS,v.stencilRef,255),this._stencilTileSymbols(t,g,v,s,o,a,l,_,h,p,m)}),t.setStencilWriteMask(0),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!0),t.setColorMask(!0,!0,!0,!0)}_renderSymbols(t,i,r,n,s,o,a,l,c,h,p){t.setStencilFunction(Ei.EQUAL,r.stencilRef,255),this._render(t,i,r,n,s,o,a,l,c,h,p,OF.SYMBOL)}_render(t,i,r,n,s,o,a,l,c,h,p,m){this._updateRenderParameters(t,i,r,n,o,a,l,c,h,p),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,r,s,m)}_stencilTileSymbols(t,i,r,n,s,o,a,l,c,h,p){this._updateRenderParameters(t,i,r,n,o,a,l,c,h,p),this._renderParams.stencilSymbols=!0,r.triangleCount=0,n.drawSymbols(this._renderParams,r,s)}_updateRenderParameters(t,i,r,n,s,o,a,l,c,h){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(t);let p=i[0]-s.getLevelShift(i[0]),m=this._renderParams;m.context=t,m.painter=n,m.glyphMosaic=n.glyphMosaic,m.spriteMosaic=n.spriteMosaic,m.pixelRatio=c*h,m.displayLevel=p,m.requiredLevel=p;let f=s.getScale(i[0]),[g,_]=s.getOffset(i,o*f),v=aie*o*f/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+_+(1-a[1])*o*2-2;let x=m.state,E=l/h;x.size[0]=E,x.size[1]=E,x.pixelRatio=h,x.rotation=(360-this._heading)%360;let D=2/E;P0(x.displayViewMat3,D,0,0,0,-D,0,-1,1,1);let M=Fp(x.displayMat3),T=Ip(this._heading);ql(M,M,[E/2,E/2]),kp(M,M,T),ql(M,M,[-E/2,-E/2]),N0(M,x.displayViewMat3,M)}updateHeading(t){this._heading=t}_declutter(t){this._declutteredForHeading.get(t)!==this._heading&&(W8(t,(360-this._heading)%360),this._declutteredForHeading.set(t,this._heading))}},WO=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Nn(),this.displayViewMat3=Nn(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};var uv=class extends ou{constructor(){super(...arguments),this.blendMode=fu.Normal}};u([Zt({count:fu.COUNT})],uv.prototype,"blendMode",void 0);var Nc=class extends uv{constructor(){super(...arguments),this.output=Pr.Composite,this.baseOpacityMode=_n.NotRequired,this.premultipliedSource=ua.Off}};u([Zt({count:Pr.COUNT})],Nc.prototype,"output",void 0),u([Zt({count:_n.COUNT})],Nc.prototype,"baseOpacityMode",void 0),u([Zt({count:ua.COUNT})],Nc.prototype,"premultipliedSource",void 0);var dv=class extends Nc{constructor(){super(...arguments),this.background=gm.BelowLayer}};u([Zt({count:gm.COUNT})],dv.prototype,"background",void 0);var hv=class extends ft{constructor(t,i){super(t,i,new mt(K3,()=>import("./chunk-56G5ZZSE.js")))}};var fd=class extends Nc{constructor(){super(...arguments),this.colorizerType=VM.Stretch,this.stretchType=pm.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([Zt({count:VM.COUNT})],fd.prototype,"colorizerType",void 0),u([Zt({count:pm.COUNT})],fd.prototype,"stretchType",void 0),u([Zt()],fd.prototype,"applyColormap",void 0),u([Zt()],fd.prototype,"requireBilinearWithNN",void 0);var pv=class{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){let i=this._fbos.get(t);if(i)return i;let r=new $a(this._rctx,new vi(t),new dw(I0.DEPTH24_STENCIL8,t));return this._fbos.set(t,r),r}};var lie=()=>W.getLogger("esri.views.3d.terrain"),$D=class{constructor(t,i){this._rctx=t,this._techniques=i,this._fbos=[],this._vectorTileHelper=new WD,this._bindParameters=new Cw(null),this._blendLayersTechniqueConfig=new dv,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=gn(this._rctx,mu.Pos2Tex)}dispose(){this._fbos.forEach(We),this._fbos=null,this._vtFBO=We(this._vtFBO),this._vaoQuad=We(this._vaoQuad),this._vectorTileHelper=We(this._vectorTileHelper)}updateHeading(t){this._vectorTileHelper?.updateHeading(t)}_acquireBlendLayersTechnique(t,i,r,n=ua.Off,s=gm.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._techniques.precompile(cv,this._blendLayersTechniqueConfig),this._techniques.get(cv,this._blendLayersTechniqueConfig)}drawBackground(t,i){let r=this._acquireBlendLayersTechnique(fu.Normal,i?Pr.ColorComposite:Pr.GridComposite,_n.NotRequired,ua.Off,gm.Only),n=this._rctx.bindTechnique(r,this._bindParameters,t);this._render(n)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Jt.TRIANGLE_STRIP,0,sa(this._vaoQuad,"geometry"))}drawGroup(t,i,r,n,s=ua.On){i===Pr.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),t.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);let o=t.baseOpacity<1?_n.Required:_n.NotRequired,a=this._acquireBlendLayersTechnique(n,i,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,t);this._render(l)}drawImageData(t,i,r,n,s=ua.Off){if(t.texture==null)return;let o=t.baseOpacity<1?_n.Required:_n.NotRequired;t.fboTexture=i===Pr.GroupBackgroundComposite||n===fu.Normal&&o===_n.NotRequired&&s===ua.Off?null:this.switch(r).colorTexture;let a=this._acquireBlendLayersTechnique(n,i,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,t);this._render(l)}drawRasterData(t,i,r,n,s){let o=s.sourceLayerInfo.data;if(!o.source||(s.tile.surface.layerViewByIndex(s.layerIndex,Ue.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;let a=t.baseOpacity<1?_n.Required:_n.NotRequired;t.fboTexture=n===fu.Normal&&a===_n.NotRequired?null:this.switch(r).colorTexture;let l=this._acquireRasterColorizerTechnique(o,i,n,a);o.opacity=t.opacity;let c=o.getUniforms();c.scale=s.scale,c.offset=s.offset,c.backgroundColor=t.backgroundColor,c.fboTexture=t.fboTexture,c.baseOpacity=t.baseOpacity;let h=this._rctx.bindTechnique(l,this._bindParameters,c);this._render(h)}_acquireRasterColorizerTechnique(t,i,r,n){let s=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new fd,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=t.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?pm.Noop:pm.PerBand,this._techniques.precompile(hv,this._rasterColorizerConfig),this._techniques.get(hv,this._rasterColorizerConfig)}drawVectorData(t,i,r,n,s,o,a,l){let c=this._rctx,h=s.sourceLayerInfo.data,p=s.tile.surface.layerViewByIndex(s.layerIndex,Ue.MAP),m=t.baseOpacity<1?_n.Required:_n.NotRequired,f=m===_n.Required||t.opacity<1||n!==fu.Normal||i!==Pr.Composite,g=f?ua.On:ua.Off,_=this._acquireBlendLayersTechnique(n,i,m,g);c.setPipelineState(_.getPipeline());let v=null,b=null;f?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new pv(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(Ti.DEPTH);try{this._vectorTileHelper.renderBackground(c,s.sourceLod,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/s.scale),s.offset,a,o,p.contentZoom),h&&this._vectorTileHelper.renderContent(c,s.sourceLod,h,s.vtlNeighborInfos,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/s.scale),s.offset,a,o,p.contentZoom)}catch(x){lie().warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return!v||(c.bindFramebuffer(b),t.texture=v.colorTexture,t.offset=Ad,t.scale=1,this.drawImageData(t,i,r,n,g),l)}copyFBOToTexture(t){let i=this._rctx,r=i.bindTexture(t.texture,Di.TEXTURE_UNIT_FOR_UPDATES),n=t.descriptor;i.gl.copyTexImage2D(Ug.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),t.generateMipmap(),i.bindTexture(r,Di.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Ti.COLOR|Ti.DEPTH|Ti.STENCIL)}_initFBO(t,i,r){this._rctx.bindFramebuffer(t),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new pv(this._rctx));this._initFBO(this._fbos[i].get(t),t,r)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){let i=this.currentFBO(t),r=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){let i=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}};var ZD=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Nt({allocator:t=>t||new $O})}},$O=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}};var mv=class{constructor(t,i){this._texture=t,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&(this._cache?(this._texture.isCompressing&&this._texture.abortCompression(),this._cache.put(this._generateCacheKey(),this)):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}_generateCacheKey(){return`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`+(JF(this._texture)?"compressed":"")}get descriptor(){return this._texture.descriptor}get cachedMemory(){return this._texture.usedMemory}};function ZO(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement}var QD=class extends SF{constructor(t){super("TextureCompressionWorker","compress",{compress:i=>[i.data]},t)}isCompressible(t){return ZO(t)}};var YO=class{constructor(t,i,r,n,s,o){this.start=t,this.end=i,this.blendMode=r,this.opacity=n,this.output=s,this.baseOpacity=o}},Fc=class extends P{constructor(e){super(e),this._passParameters=new qD,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1}initialize(){this._maxAnisotropy=this.rctx.parameters.maxMaxAnisotropy,this._compositor=new $D(this.rctx,this.techniques),this._ensureBackgroundTexture(this.tileSize),this.texturesBeingCompressed=0}dispose(){this._compositor=We(this._compositor),this._backgroundTexture=ki(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,t){if(!e.renderData)return;let i=e.surface,r=i.baseOpacity,n=0,s=0,o=this.tileSize,a=!1,l=!1,c=i.view.state.contentPixelRatio,h=!1;YD.clear(),eg.length=0;let p=e.layerInfo[Ue.MAP],m=0,f=null;for(;m<p.length;m++){let v=i.layerViewByIndex(m,Ue.MAP),b=v.layer,x=!ca(e,v),E=b.opacity,D=v.fullOpacity;if(l=l||Mp(b),hu(v)){let I=v.layer.blendMode!=="normal";if(qc(b.parent)){let A=b.parent.uid;A!=null&&A!==""&&(I=$8(b.parent)||I)}I&&(h=I,a=!1)}if((x||E===0)&&!h){p[m].pendingUpdates&=~(we.TEXTURE_NOFADING&we.TEXTURE_FADING);continue}++s;let M=lm(v),T=QO(e,m,M);if(T){if(p[m].pendingUpdates&=~(we.TEXTURE_NOFADING&we.TEXTURE_FADING),qc(b.parent)){let I=b.parent.uid;I!=null&&I!==""&&Z8(b.parent,m)}M?o=Math.max(o,this.tileSize*c):r===1&&D===1&&(v.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++n,f===null&&(f=m)}}let g=o/this.tileSize,_=this._ensureBackgroundTexture(this.tileSize);n!==0&&f!==null?n===1&&!h&&this._useLayerTexture(e,f)||this._composeLayers(e,t,m-1,l,o,g,!a||h,YD,h):uie(e,s,_,t!==di.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=Ad,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,t){let i=e.surface.layerViewByIndex(t,Ue.MAP),r=Mp(i.layer),n=r?e.surface.baseOpacity:1,s=r?1:e.surface.baseOpacity,o=i.fullOpacity,a=QO(e,t,!1);return!!this._dataToTexture(a)&&(e.renderData.setTextureReference(new hd(a.sourceLayerInfo.data,di.FADING,pn(a.offset[0],a.offset[1],a.scale,a.scale),n,s,o)),!0)}_composeLayers(e,t,i,r,n,s,o,a,l){this._compositor.ensureBuffer(n);let c=e.surface.baseOpacity,h=!1,p=On.LINEAR_MIPMAP_LINEAR,m=!1,f=0;for(let b=i;b>=0;b--){let x=e.surface.layerViewByIndex(b,Ue.MAP),E=x.layer,D=lm(x),M=QO(e,b,D),T=E.opacity,I=!ca(e,x);if(!M||(T===0||I)&&!l)continue;let A=!Mp(E)&&!h;A&&(h=!0);let O=!1;a.forEach(K=>{K.start===b&&(K.output=r?Pr.Composite:o&&A?this.backgroundIsGrid?Pr.GridComposite:Pr.ColorComposite:Pr.Composite,K.baseOpacity=A?c:1,eg.push(K),this._compositor.openGroup(n),O=!0)});let $=f===0,H=O?Pr.GroupBackgroundComposite:o&&$?this.backgroundIsGrid?Pr.GridComposite:Pr.ColorComposite:Pr.Composite,k=a_[hu(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=A&&!O&&c<1?c:1,this._passParameters.opacity=T,C3(M)?m=this._compositor.drawVectorData(this._passParameters,H,n,k,M,s,this.tileSize,m):b3(M)?(this._compositor.drawRasterData(this._passParameters,H,n,k,M),cie(M)&&(p=On.NEAREST)):this._dataToTexture(M)&&(this._passParameters.texture=M.sourceLayerInfo.data.texture,this._passParameters.offset=M.offset,this._passParameters.scale=M.scale,this._compositor.drawImageData(this._passParameters,H,n,k));eg.length>0&&eg[eg.length-1].end===b;){let K=eg.pop();this._passParameters.baseOpacity=K.baseOpacity,this._passParameters.opacity=K.opacity,this._passParameters.offset=Ad,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,K.output,n,a_[K.blendMode])}f++}let g=e.renderData,_=l||h&&c<1,v=g.ensureTexture(n,_,t,()=>this._buildTexture(n,_,p));this._compositor.copyFBOToTexture(v),this._compositor.unbind(),g.setTextureReference(new hd(v,t,Q8,h?1:c,0,1))}_dataToTexture(e){if(E3(e)){let t=e.sourceLayerInfo,i=e.scale===1;t.data=this._buildTexture(t.data,!0,i),e.tile.setMemoryDirty()}return T3(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t,i=On.LINEAR_MIPMAP_LINEAR){if(e==null)return null;let r=new vi;r.wrapMode=ji.CLAMP_TO_EDGE,r.samplingMode=typeof i=="boolean"?On.LINEAR_MIPMAP_LINEAR:i,r.maxAnisotropy=this._maxAnisotropy,r.preMultiplyAlpha=!0,r.flipped=!0,r.hasMipmap=!0,t||(r.pixelFormat=mi.RGB);let n=this.rctx,s=typeof i=="boolean"&&i,o;if(typeof e=="number")r.width=r.height=e,o=this._buildTileTexture(r,e);else if(am(e))r.isOpaque=e.isOpaque,r.isOpaque&&(r.pixelFormat=mi.RGB),o=this._buildTileTexture(r,e.element.width,s,e.element);else try{r.width=e.width,r.height=e.height,o=this._buildTileTexture(r,e.width,s,e)}catch{o=new mv(kw(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}let a=n.bindTexture(o.texture,Di.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Di.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,t,i=!1,r){let n=`${t} ${e.pixelFormat}`,s=this.cache.pop(n)??this.cache.pop(n+"compressed");if(i&&=ZO(r),s)return s.retain(),i&&s.texture.enableCompression(!0),s.texture.setData(r),s;e.shouldCompress=i;let o=new Di(this.rctx,e,r);return o.isCompressing&&(this.texturesBeingCompressed++,this.addHandles([S(()=>o.isCompressing,a=>{a?this.texturesBeingCompressed++:this.texturesBeingCompressed--},Fe)])),new mv(o,this.cache)}get test(){}};function QO(e,t,i){ln.layerIndex=t,ln.vtlNeighborInfos.clear();let r=e.layerInfo[Ue.MAP][t];if(es(ln.offset,0,0),ln.tile=e,ln.scale=1,ln.sourceLod=e.lij,ln.sourceLayerInfo=r,ln.isVTLBackground=i,r.data)return i&&e.forEachLoadedNeighbor((o,a)=>{if(o.level!==e.level)return;let l=o.layerInfo[Ue.MAP][t];if(!D3(l)||r.data===l.data)return;let c=ln.vtlNeighborInfos.pushNew();c.offset=Lc[a],c.sourceLod=o.lij,c.sourceLayerInfo=l}),ln;let n=r.upsampleInfo,s=n?.tile?.layerInfo[Ue.MAP][t];return s&&n.tile?(ln.tile=n.tile,Yi(ln.offset,n.offset),ln.scale=n.scale,ln.sourceLod=n.tile.lij,ln.sourceLayerInfo=s,ln):i?ln:null}function cie(e){let t=e.sourceLayerInfo.data;return!!t.source&&t.interpolation==="nearest"}function $8(e){let t=e.blendMode!=="normal";return qc(e.parent)&&(t=$8(e.parent)||t),t}function Z8(e,t){qc(e.parent)&&Z8(e.parent,t);let i=e.uid;if(i!=null&&i!==""){let r=YD.get(i);r?r.start=t:YD.set(i,new YO(t,t,e.blendMode,e.opacity,Pr.Composite,1))}}function uie(e,t,i,r){let n=e.renderData,s=!r&&n.textureReference!=null&&(e.surface.view.layerViewManager.updating||t>0)?Al.Delayed:Al.Immediate;n.setTextureReference(new hd(i,di.FADING,Q8,e.surface.baseOpacity,0,1),s)}u([d({constructOnly:!0})],Fc.prototype,"rctx",void 0),u([d({constructOnly:!0})],Fc.prototype,"techniques",void 0),u([d({constructOnly:!0})],Fc.prototype,"cache",void 0),u([d()],Fc.prototype,"tileSize",void 0),u([d()],Fc.prototype,"texturesBeingCompressed",void 0),Fc=u([C("esri.views.3d.terrain.TileRenderer")],Fc);var YD=new Map,eg=new Array,ln=new ZD,Q8=pn(0,0,1,1),Lc=new Array;Lc[ii.NORTH]=[0,-1],Lc[ii.NORTH_EAST]=[-1,-1],Lc[ii.EAST]=[-1,0],Lc[ii.SOUTH_EAST]=[-1,1],Lc[ii.SOUTH]=[0,1],Lc[ii.SOUTH_WEST]=[1,1],Lc[ii.WEST]=[1,0],Lc[ii.NORTH_WEST]=[1,-1];var X8=200,KO=40,die=.8,hie=10,XO=1e-6;function pie(e,t,i){let r=t,n=i,s=0,o=1/0;for(let a=0;a<3;++a){{let l=e[a];if(r[a]<l){if(n[a]<=XO)return!1;let c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-1e-6){let c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{let l=e[a+3];if(r[a]>l){if(n[a]>=-1e-6)return!1;let c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=XO){let c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}var KD=class{constructor(t,i,r,n,s){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},J8=(()=>{class e{constructor(i,r,n,s){this.globalTriangleVertexIndices=i,this.firstTriangleIndex=r,this.positions=s,this._rayDirection=w(),this._callback=K8,this._intersectionOptions=Y8,this.bspNodeTree=new Array;let o=n-r,a=new(o<yie?Uint8Array:o<vie?Uint16Array:Uint32Array)(o);this.triangleIndexMap=a;for(let l=0;l<o;++l)a[l]=l;{let l=_ie(i,r,n,s.data,s.stride),c=q(Math.log2(o/KO),2,hie),h=(p,m,f)=>{let g=fie(a,l,p,m),_=m-p;if(_<=KO){let M=new KD(g,void 0,0,p,m);return this.bspNodeTree.push(M),M}let{axis:v,midValue:b}=gie(g),x=mie(a,l,p,m,v,b),E=(M,T)=>{if(f>c)return;let I=T-M;return I<KO||I>=die*_?void 0:h(M,T,f+1)},D=new KD(g,v,b,x.next,x.mid);return this.bspNodeTree.push(D),D.leftNode=E(p,x.next),D.rightNode=E(x.mid,m),D};h(0,o,0)}}intersectRayTriangleRange(i,r){if(i>=r)return;let n=this.positions;ew(this._rayFrom,this._rayDirection,i,r,this.globalTriangleVertexIndices,n.data,n.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),e.numFacesTested+=r-i}intersectRay(i,r,n,s){e.numFacesTested=0;let o=i,a=r,l=a[0]-o[0],c=a[1]-o[1],h=a[2]-o[2];if(l*l+c*c+h*h<XO)return;this._rayFrom=o;let p=this._rayDirection;p[0]=l,p[1]=c,p[2]=h;let m=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=n,this.intersectRayBSP(this.bspNodeTree[0],0,m),this._callback=K8,this._intersectionOptions=Y8}intersectRayBSP(i,r,n){let s=this._rayFrom,o=this._rayDirection;if(!pie(i.aabb,s,o))return;let a=i.axis,l=i.d;if(s[a]<l||o[a]<0){let c=r,h=i.midStartIndex;if(c<h){let p=i.leftNode;p!==void 0?this.intersectRayBSP(p,c,h):this.intersectRayTriangleRange(c,h)}}if(this.intersectRayTriangleRange(i.midStartIndex,i.rightStartIndex),s[a]>l||o[a]>0){let c=i.rightStartIndex,h=n;if(c<h){let p=i.rightNode;p!==void 0?this.intersectRayBSP(p,c,h):this.intersectRayTriangleRange(c,h)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}}return e.numFacesTested=0,e})(),tg=[1/0,1/0,1/0],ig=[-1/0,-1/0,-1/0];function mie(e,t,i,r,n,s){let o=i,a=r;for(;o<a;){let c=e[o];t[6*c+n+3]<=s?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){let c=e[a-1];t[6*c+n]>=s?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function fie(e,t,i,r){if(r<=i)return Wx(NaN,NaN,NaN,NaN,NaN,NaN);{let n=6*e[i];for(let s=0;s<3;++s)tg[s]=t[n+0+s],ig[s]=t[n+3+s]}for(let n=i+1;n<r;++n){let s=6*e[n];for(let o=0;o<3;++o)tg[o]=Math.min(tg[o],t[s+0+o]),ig[o]=Math.max(ig[o],t[s+3+o])}return Wx(tg[0],tg[1],tg[2],ig[0],ig[1],ig[2])}function gie(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],n=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}function _ie(e,t,i,r,n){let s=i-t,o=new Float32Array(6*s);for(let a=0;a<s;++a){let l=3*(a+t),c=e[l]*n,h=e[l+1]*n,p=e[l+2]*n;for(let m=0;m<3;++m){let f=r[c+m],g=r[h+m],_=r[p+m];o[6*a+m]=Math.min(f,g,_),o[6*a+3+m]=Math.max(f,g,_)}}return o}var yie=255,vie=65535,Y8=new Xp,K8=()=>{};var Vr=class extends yk{constructor(t){super(),this.spherical=t,this.overlayMode=_M.Disabled,this.tileBlendInput=gu.LayerOnly,this.transparencyMode=yn.Opaque,this.pbrMode=Yp.Simplified,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.normalType=RF.Compressed,this.textureCoordinateType=KF.Compressed,this.highStepCount=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!0,this.canHaveOverlay=!0}};u([Zt({count:_M.COUNT})],Vr.prototype,"overlayMode",void 0),u([Zt({count:gu.COUNT})],Vr.prototype,"tileBlendInput",void 0),u([Zt({count:yn.COUNT})],Vr.prototype,"transparencyMode",void 0),u([Zt({count:Yp.COUNT})],Vr.prototype,"pbrMode",void 0),u([Zt()],Vr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([Zt()],Vr.prototype,"receiveShadows",void 0),u([Zt()],Vr.prototype,"backfaceCullingEnabled",void 0),u([Zt()],Vr.prototype,"textureFadingEnabled",void 0),u([Zt()],Vr.prototype,"renderOccluded",void 0),u([Zt()],Vr.prototype,"screenSpaceReflections",void 0),u([Zt()],Vr.prototype,"cloudReflections",void 0),u([Zt()],Vr.prototype,"tileBorders",void 0),u([Zt()],Vr.prototype,"visualizeNormals",void 0),u([Zt()],Vr.prototype,"screenSizePerspective",void 0),u([Zt()],Vr.prototype,"receiveAmbientOcclusion",void 0);var JO=7,wie=10,eN=Wc(),Es=class extends qp{get _isGlobal(){return this._stage.viewingMode===Se.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,t,i,r,n){super({}),this._overlayRenderer=e,this._stage=t,this._allTiles=i,this._ellipsoidRadius=r,this.type=na.TERRAIN,this.isGround=!0,this._passParameters=new sH,this._drawParameters=new VF,this._renderDataPool=new no(PD),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Fw,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=hr.Occlude,this.produces=new Map([[me.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===yn.Opaque],[me.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===yn.Transparent||this.transparency===yn.InvisibleWithDraped)],[me.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileSize=256,this._configuration=new Vr(t.viewingMode===Se.Global),this._tileTextureCache=new Bo((s,o)=>n.newCache(s,o),"TileTexture"),this.tileGeometryCache=new GD(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(S(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?wM:hr.Occlude,this.setNeedsRender()},Fe))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?FF:LF}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._configuration.transparencyMode!==e&&(this._configuration.transparencyMode=e,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get tileRenderer(){return this._tileRenderer}get texturesBeingCompressed(){return this._tileRenderer?this._tileRenderer?.texturesBeingCompressed:null}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(e){this._configuration.tileBorders!==e&&(this._configuration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(e){this._configuration.visualizeNormals!==e&&(this._configuration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(e){this._configuration.backfaceCullingEnabled!==e&&(this._configuration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Zl}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(e){this._configuration.hasSlicePlane!==e&&(this._configuration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._configuration.textureFadingEnabled!==e&&(this._configuration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._configuration.pbrMode!==e&&(this._configuration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._configuration.screenSizePerspective!==e&&(this._configuration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}set tileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}get tileSize(){return this._tileSize}_ensureRenderData(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._ensureRenderData(e),this.updateTileGeometryState(e),this.reuseTextureFromParent(e)||this.updateTileTexture(e,we.TEXTURE_FADING)}reuseTextureFromParent(e){let t=e.parent;if(!t)return!1;let i=pn(1&e.lij[2]?.5:0,1&e.lij[1]?0:.5,.5,.5);return t.renderData?.reuseTexture(e.renderData,i)??!1}updateTileTexture(e,t){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,t===we.TEXTURE_FADING?di.FADING:di.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(let i of e.layerInfo[Ue.ELEVATION])i.pendingUpdates&=~we.GEOMETRY;e.resetPendingUpdate(we.GEOMETRY);let t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.loaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){let t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){let t=wie-JO,i=Math.max(0,Math.floor((e.level-t)/JO)*JO);if(this._isGlobal&&i===0)return Jo;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Pe.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Pe.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Pe.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new Fc({rctx:this._rctx,tileSize:this._tileSize,techniques:this._techniques,cache:this._tileTextureCache}),this.updateTileBackground(),this._emptyTex=kw(this._rctx)}uninitializeRenderContext(){this._emptyTex=We(this._emptyTex),this._tileRenderer=We(this._tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==yn.Opaque)return;let n=bie,s=Cie;ve(n,r,i),Te(s,1/n[0],1/n[1],1/n[2]);let o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===fo.MIN,h=!!e.results.ground.target,p=dk(e.verticalOffset),m=e.tolerance,f,g=c&&o.dist!=null?o.dist:1/0,_=e.options,v=_.normalRequired||!_.backfacesTerrain,b=new Xp(!1,v),x=D=>{let M=D.renderData;if(!M?.vao)return;let T=M.geometry;gL(eN,T.boundingBox);let I=M.localOrigin;p!=null&&(p.localOrigin=I,p.applyToAabb(eN));let A=eN;if(rg[0]=i[0]-I[0],rg[1]=i[1]-I[1],rg[2]=i[2]-I[2],!tw(A,rg,s,m,g))return;let O=(z,ce,ue)=>{z.set(this.type,D,ce,ue,Yc),g=c&&o.dist!=null?o.dist:1/0},$=(z,ce,ue)=>{if((!v||ue!=null)&&z>=0&&(_.backfacesTerrain||ae(ue,n)<0)&&(_.invisibleTerrain||!_.selectionMode||t==null||t(i,r,z))){if((l.dist==null||z<l.dist)&&O(l,z,ue),_.isFiltered)return;_.store===fo.ALL&&(f==null?(f=hk(e.ray),O(f,z,ue),e.results.all.push(f)):z<f.dist&&O(f,z,ue)),(o.dist==null||z<o.dist)&&O(o,z,ue),_.store!==fo.MIN&&(a.dist==null||z>a.dist)&&O(a,z,ue)}},H=Tie;ve(H,r,I);let{indices:k,indexCount:K}=T,F=T.vertexAttributes,R=F.getField(yi.POSITION,PL),j=new wF(R.typedBuffer,3,F.stride/4),B=K/3;if(!p&&B>X8){let z=D.renderData;z.intersectionData==null&&(z.intersectionData=new J8(k,0,B,j)),z.intersectionData.intersectRay(rg,H,b,$)}else mk(rg,H,0,B,k,j,p,b,$)},E=this._rootTiles;E!=null&&(()=>{let D=this._tileIterator;D.reset(E);let M=e.options.invisibleTerrain;for(let T=D.next();T;T=D.next())!(T.visible||M&&T.intersectsClippingArea)||p==null&&!T.intersectsRay(i,n,m,g)||h&&this._useStencilForTile(T)?D.skipSubtree():x(T)})()}processScaleRangeQueries(e,t){if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(let i of this._visiblePatchesByOrigin.values())for(let r of i)r.renderData?.textureReference!=null&&e.queriesForTile(r);e.process(),t.madeProgress()}}acquireTechniques(e){let t=!!Ct("enable-feature:terrain-shadows")&&e.bind.shadowMap.enabled;t!==this._castShadows&&(this._castShadows=t,this._patchesByOriginDirty=!0);let i=e.bind.viewshedEnabled;if(this._inViewshed!==i&&(this._inViewshed=i,this._patchesByOriginDirty=!0),e.bind.slot===me.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&wM))return null}else{let r=this.transparency===yn.Opaque?me.OPAQUE_TERRAIN:me.TRANSPARENT_TERRAIN;if(e.bind.slot!==r)return null}if(this.transparency===yn.Invisible)return null;switch(this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1,this._configuration.overlayMode=this._overlayRenderer.mode,e.output){case oe.Color:case oe.ColorEmission:return this._configuration.screenSpaceReflections=e.bind.ssr.lastFrameColor!=null,this._configuration.cloudReflections=e.bind.clouds.data!=null,this._configuration.receiveShadows=e.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=e.bind.ssao!=null,this._acquireTechnique(e.output,e.bind.slot===me.OCCLUDED_TERRAIN);case oe.Shadow:case oe.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(oe.Shadow,!1):null;case oe.ViewshedShadow:return this._inViewshed?this._acquireTechnique(oe.ViewshedShadow,!1):null;case oe.Depth:case oe.Normal:return this._acquireTechnique(e.output,!1);case oe.ObjectAndLayerIdColor:return this._acquireTechnique(oe.ObjectAndLayerIdColor,!1);case oe.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(oe.Highlight,!1):null}return null}render(e,t){switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case oe.Color:case oe.ColorEmission:{let i=e.bind.slot===me.OCCLUDED_TERRAIN?au.Occluded:au.Color;this._renderMaterialPass(e,t,i);break}case oe.Depth:case oe.Normal:this._renderAuxiliaryPass(e,t,au.Color,this._visiblePatchesByOrigin);break;case oe.Highlight:{let i=e.bind.highlight?.name;i&&this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(au.Highlight)&&this._overlayRenderer.hasHighlightOptions(i)&&this._renderAuxiliaryPass(e,t,au.Highlight,this._visiblePatchesByOrigin);break}case oe.Shadow:case oe.ShadowExcludeHighlight:case oe.ViewshedShadow:this._renderAuxiliaryPass(e,t,null,this._allPatchesByOrigin);break;case oe.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,au.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;let t=this._tileRenderer,i;if(e!=null){let r=fn.toUnitRGBA(e);i=yt(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this._allTiles.forAll(r=>t.updateTileTexture(r,di.FADING)),this._configuration.tileBlendInput=t.backgroundIsGrid?gu.GridComposite:t.backgroundColor!=null?gu.ColorComposite:gu.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==o_.NONE){let e=Array.from(this._visiblePatchesByOrigin.values()),t=this._stencilEnabledLayerExtents;for(let i of e)F3(this.renderOrder,i,t);e.sort((i,r)=>k3(i[0],r[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){let e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(let t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){let t=this._tileIterator;for(t.resetOne(e);!t.done;){let i=t.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}let n=r.localOrigin;if(this._castShadows||this._inViewshed){let o=this._allPatchesByOrigin.get(n);o||(o=[],this._allPatchesByOrigin.set(n,o)),o.push(i)}if(!i.visible){this._numTilesCulled++,t.skipSubtree();continue}let s=this._visiblePatchesByOrigin.get(n);s||(s=[],this._visiblePatchesByOrigin.set(n,s)),s.push(i),t.skipSubtree()}}_useStencilForTile(e){for(let t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderAuxiliaryPass(e,t,i,r){let n=e.rctx;this._passParameters.overlayContent=i,n.bindTechnique(t,e.bind,this._passParameters);let s=this._stencilEnabledLayerExtents.length>0;r.forEach(o=>{this._drawParameters.origin=o[0].renderData.localOrigin,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters);for(let a=0;a<o.length;a++)this._renderPatch(e,t,o[a],Jt.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,t,i){let{rctx:r}=e;this._passParameters.overlayContent=i,r.bindTechnique(t,e.bind,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;let n=e.bind.camera,s=t.program;if(this._configuration.screenSizePerspective&&this.pointsOfInterest){let p=Y0(this._stage.viewingMode,this._ellipsoidRadius),m=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:m,fovY:n.fovY})}let o=this._stencilEnabledLayerExtents.length>0,a=i===au.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Jo),s.setUniform4fv("texOffsetAndScale",mn));let l=this._tileRenderer?.backgroundColor!=null?this._tileRenderer.backgroundColor:Jo;this._configuration.tileBlendInput===gu.ColorComposite&&s.setUniform3fv("backgroundColor",l);let c=this.wireframe?Jt.LINES:Jt.TRIANGLES;this._configuration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);let h=this._visiblePatchesByOrigin;for(let p of h.values()){let m=p[0].renderData.localOrigin;this._drawParameters.origin=m,t.program.bindDraw(e.bind,this._passParameters,this._drawParameters),this._numOriginsRendered++;for(let f of p){let g=f.renderData,_=g.textureReference;if(_!=null){if(!a){s.setUniform4fv("texOffsetAndScale",_.offsetAndScale),s.bindTexture("tex",_.texture.texture);let v=g.textureFadeFactor,b=v<1?g.nextTextureReference:null;this._configuration.textureFadingEnabled&&b!=null&&v<1?(s.setUniform1f("fadeFactor",v),s.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),s.setUniform3fv("nextTexOpacities",b.opacities),s.bindTexture("texNext",b.texture.texture)):s.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,t,f,c,o,i),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,i,r,n,s){let o=i.renderData,a=o.vao,l=a?.indexBuffer;if(!a||l==null)return void(Ki&&console.error("Rendered tile with no indices: ",i.lij," : ",o));let c=t.program;s==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),n&&(t.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(t.getPipeline()));let h=o.geometry.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_acquireTechnique(e,t){return this._configuration.output=e,this._configuration.renderOccluded=t,this._techniques.get(RD,this._configuration)}get test(){}hasHighlightOptions(e){return this._overlayRenderer.hasHighlightOptions(e)}};u([d({readOnly:!0})],Es.prototype,"_isGlobal",null),u([d()],Es.prototype,"renderOccludedFlags",void 0),u([d({value:!1})],Es.prototype,"renderingDisabled",null),u([d({value:!0})],Es.prototype,"visible",null),u([d()],Es.prototype,"texturesBeingCompressed",null),u([d()],Es.prototype,"renderPatchBorders",null),u([d()],Es.prototype,"visualizeNormals",null),u([d()],Es.prototype,"cullBackFaces",null),u([d({value:o_.FRONT_TO_BACK})],Es.prototype,"renderOrder",null),u([d()],Es.prototype,"wireframe",null),Es=u([C("esri.views.3d.terrain.TerrainRenderer")],Es);var bie=w(),Cie=w(),rg=w(),Tie=w();var XD=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}};var xa=class extends P{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),S(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!Gc(t)||t.isRejected())&&!(t.isFulfilled()&&!Eie(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!(t?.type==="vector-tile"||Nw(t)))),e)if(e.isResolved()){let t=zd(e,this.viewSpatialReference,this.viewingMode);if(t!=null){let i=new Ud(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){let t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Se.Global){let t=e.levels.length-1,i=e.spatialReference;i.isWebMercator?e=Ud.makeWebMercatorAuxiliarySphere(t):y3(i)&&(e=Ud.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(S(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Se.Global){let e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=Ud.WebMercatorAuxiliarySphere:_3(e)&&(this.tilingScheme=Ud.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{let e=this.extentHelper.layerViewsExtent;e==null||Ko(e,this.extent)||(this.tilingScheme=Ud.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function Eie(e,t,i){return zd(e,t,i)!=null}u([d()],xa.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],xa.prototype,"extent",void 0),u([d({value:!1})],xa.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],xa.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],xa.prototype,"layers",void 0),u([d({constructOnly:!0})],xa.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],xa.prototype,"viewingMode",void 0),xa=u([C("esri.views.3d.terrain.TilingSchemeLogic")],xa);var JD=class{constructor(){this._offset=Hi(),this.scale=0}get offset(){return this._offset}init(t,i,r,n){this.tile=t,this._offset[0]=i,this._offset[1]=r,this.scale=n}dispose(){this.tile=null,this._offset[0]=0,this._offset[1]=0,this.scale=0}};var t1,nt=t1=class extends oi.EventedMixin(P){get allTiles(){return this._allTiles}constructor(e){super(e),this._scaleRangeQueries=new lv,this._iteratorPool=new no(Fw,t=>t.remove=()=>this._iteratorPool.release(t)),this._postorderIterator=new N3,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new XD,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=w(),this._eyePosSurfaceSR=w(),this._splitLimits=new Go,this._frustum=rM(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new mo,this._frameTask=xd,this._allTiles=new Nt,this._upsampleInfoPool=new no(JD),this._shouldEmitChangeEvent=!1,this._destroying=!1,this._rootTilesExtent=Yt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Qt.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new Ml(1/0,-1/0),this.rootTileElevationBounds=new Ml(1/0,-1/0),this._projectorCache=new Map,this._radiusModifier=Math.cos(Math.PI/16/16),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Sn(be(ie({},e),{surface:this})),this._isGlobal=!e.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?zD:jD,this._ellipsoid=_t(e.view.spatialReference)}initialize(){let e=this.view,t=e.resourceController,i=t.memoryController;this._tileCache=new Bo((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new TD(i.newCache("elevation-query"));let r=this.overlayManager;this._renderer=new Es(r.renderer,e._stage,this._allTiles,this._ellipsoid.radius,i),this.addHandles([S(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),S(()=>this.renderer.visible,l=>this.suspended=!l),S(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(di.FADING)}),S(()=>({heading:e.camera?.heading,state:e.state?.mode}),({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);let h=Math.round(l)%360,p=Math.abs(h-this.heading);(c===pi.IDLE||Math.min(p,360-p)>=30)&&(this.heading=h)})],"overlayManager"),this.addHandles([S(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?di.UNFADED:di.IMMEDIATE)},Ce),S(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?di.UNFADED:di.IMMEDIATE),Ce),S(()=>this.backgroundColor,(l,c)=>{l?.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Fe),S(()=>this.snapLevel,()=>this._viewChanged=!0,Fe),S(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),S(()=>dr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?import("./chunk-WFNX6FSW.js").then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&dr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:e}))}):l||(this._treeDebugger=G(this._treeDebugger))},Re)]),this.addHandles([S(()=>this._renderer.tileRenderer?.texturesBeingCompressed,(l,c)=>{c&&l<c&&(this.setMemoryDirty(),this._allTiles.forAll(h=>h.setMemoryDirty()))})]),this.addHandles([S(()=>this._renderer.texturesBeingCompressed,(l,c)=>{l===0&&l!==c&&this.requestRender()})]);let{spatialReference:n}=e;this._extentHelper=r8(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:n});let s=new Ql({getCollections:()=>e.defaultsFromMap?.mapCollections?.map(({layers:l})=>l),getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new xa({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=t.createStreamDataRequester(s_.ELEVATION),this._mapDataRequester=t.createStreamDataRequester(s_.BASEMAP);let a=t.scheduler;this._frameTask=a.registerTask(Xt.TERRAIN_SURFACE,this),this.addHandles([S(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),Re),S(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Fe),S(()=>this.extent,()=>this._updateRootTiles(),Re),e.on("resize",()=>this._viewChangeUpdate()),S(()=>{let l=e.state;return[this._lodBias,this.lodSnappingEnabled,e.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Ce),S(()=>e.qualitySettings?.fadeDuration,l=>this._renderer.textureFadingEnabled=l>0,Re),S(()=>e.qualitySettings?.physicallyBasedRenderingEnabled,l=>this._renderer.pbrMode=l?Yp.Simplified:Yp.Disabled,Re),S(()=>e.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),S(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Fe)]),this.addHandles(e.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0,this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",G(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",G(this.overlayManager)),this._tileCache=G(this._tileCache),md.prune(),this._treeDebugger=G(this._treeDebugger),this._renderer=G(this._renderer),this._iteratorPool=G(this._iteratorPool),this._upsampleMapCache=G(this._upsampleMapCache),this._elevationQueryCache=G(this._elevationQueryCache),this._set("view",null),this._extentHelper=G(this._extentHelper),this._upsampleInfoPool=G(this._upsampleInfoPool),h8()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){let{view:e,tilingScheme:t}=this,i=e.scale;if(t&&i){let r=t.levelAtScale(i)+e.qualitySettings.tiledSurface.lodBias,n=t.getMaxLod();return r<=0?null:Math.min(r,n||1/0)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return this._extentHelper.stencilEnabledExtents.length>0}get _userClippingExtent(){let{spatialReference:e}=this,{clippingArea:t}=this.view;if(t==null||e==null)return null;let i=Yt(),r=Mw(t,i,e)?i:null,n=this._get("extent");return Ko(r,n)?n:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){let e=Lg(this.groundExtent,this._userClippingExtent,Yt()),t=this._get("extent");return Ko(e,t)?t:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating||this.renderer.texturesBeingCompressed)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===yn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(e,t,i,r){let n=this._rootTiles;if(!n?.length||n[0].layerInfo[Ue.ELEVATION].length===0)return null;let s=this._elevationProjectorCache.get(r);if(s===void 0&&(s=Hg(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,s)),s==null)return W.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;let o=Te(fv,e,t,i);return s(o,0,o,0),e6(n,o[0],o[1])}getElevations(e,t,i){let r=this._rootTiles,n=r?r[0].layerInfo[Ue.ELEVATION].length:0;if(r?.length&&n!==0)for(let s=0;s<t;++s){let o=3*s;i(s,e6(r,e[o],e[o+1]))}else for(let s=0;s<t;++s)i(s,null)}getScale(e){if(!this.tilingScheme)return null;if(!Kc(e,fv,this.spatialReference))return W.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;let t=this._rootTiles;if(t!=null){for(let i of t)if(i?.containsPoint(fv)){let r=i;for(;r.children[0]&&!r.rendered;){let n=r.children[0].extent,s=0;fv[0]>n[2]&&(s+=1),fv[1]<n[1]&&(s+=2),r=r.children[s]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureProjector(e){let t=this._projectorCache.get(e);if(t)return t;let i=Hg(e,this._tilingSchemeSpatialReference)??null;return this._projectorCache.set(e,i),i}getSphereElevationBounds(e,t){let i=this._ensureProjector(t);if(i==null)return W.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;TF(e,ng);let r=ng;i(r,0,r,0);let n=new Gp,s=this._rootTiles;if(s!=null){let o=[];for(let l of s)o.push(l);let a=0;for(;a<o.length;){let l=o[a];if(++a,!Bx(l.extent,ng))continue;let c=l.children;if(c[0]==null||l.rendered)n.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(let h of c)o.push(h)}}return n}getRootElevationBounds(){return new Gp(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){let e=(this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier;return Math.min(e,this._ellipsoid.radius)}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Kc(e,ng,this.spatialReference))return W.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ng[3]=t;let i=null,r=s=>{if(s&&Bx(s.extent,ng)){let o=s.children;if(o[0]&&!s.rendered)for(let a of o)r(a);else{let a=this._getLodBiasCorrectedScale(s.level);i=i==null?a:Math.min(i,a)}}},n=this._rootTiles;if(n!=null)for(let s of n)r(s);return i}queryVisibleScaleRange(e,t,i,r){let n=t?this.tilingScheme.levelAtScale(t):0,s=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+o,s+o,r)}_evaluateTransparency(){let e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?t?yn.Invisible:yn.InvisibleWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?yn.Opaque:yn.Transparent;return this._renderer.transparency=r,i!==r}_updateTilingScheme(){let e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;rr(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();let t=e?.spatialReference??Qt.WebMercator;this._spatialReference=t,this._isWebMercator=!!t?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&h0(this.view?.renderSpatialReference),this._isGeographic=t?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._projectorCache.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.tileSize=e.pixelSize,this.overlayManager.spatialReference=e.spatialReference,this._updateRootTiles())}_acquireTile(e,t,i,r){let n=this._tileCache.pop(t1._tileMemcacheKey);return n?(n.init(e,t,i,r,this),n):new this._tileConstructor(e,t,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){let{extent:e,tilingScheme:t}=this;if(!t)return;let i=Die,r=t.rootTilesInExtent(e,i,5*t_);if(this._rootTiles!=null){if(r.length>t_)return void W.getLogger(this).warn(h3);let n=this._rootTiles.map(o=>o.lij),s=Mg(n,r,ov);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){let o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>ov(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>t_&&(W.getLogger(this).warn(p3),r=t.rootTilesInExtent(e,i,t_)),this._setRootTiles(r.map(n=>this._newRootTile(n)));Ko(i,this._rootTilesExtent)||(this._rootTilesExtent=Yt(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){let e=this._allTiles.filter(t=>t.loaded&&t.intersectsClippingArea);e.sort(wo),e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(wo);let t=this.renderer;e.forEach(i=>t.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===we.SPLIT}_newRootTile(e){let t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(we.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){let t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(we.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;let t=B3(e),i=this.visibleElevationBounds,r=t?i.min:1/0,n=t?i.max:-1/0,s=this.extent,o=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();let a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){let l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(we.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),n=Math.max(l.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(n)&&(i.min!==r||i.max!==n)&&(this.visibleElevationBounds=new Ml(r,n))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0,i=this._rootTiles;i?.forEach(({elevationBoundsMin:n,elevationBoundsMax:s})=>{e=Math.min(e,n),t=Math.max(t,s)});let r=this.rootTileElevationBounds;r.min===e&&r.max===t||(this.rootTileElevationBounds=new Ml(e,t))}_updateViewDependentParameters(){let{camera:e,contentCamera:t}=this.view.state,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=nM(this._splitLimits.frustum??rM(),t.frustum):this._splitLimits.frustum=null,nM(this._frustum,e.frustum),ee(this._eyePosRenderSR,t.eye),Ua(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this.setMemoryDirty()}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor(t=>{this._layerViews[Ue.MAP].some(lm)&&t.setPendingUpdate(we.TEXTURE_FADING),this._pendingTilesToUpdate.add(t)})}_updateTileTexture(e,t){let i=e.resetPendingUpdate(we.TEXTURE_FADING)?we.TEXTURE_FADING:!!e.resetPendingUpdate(we.TEXTURE_NOFADING)&&we.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;let e=tN.extent;Yo(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>ka(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),tN.spatialReference=this.spatialReference,this.emit("elevation-change",tN),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);let t=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Ki&&this._checkTileInvariant(),!e.hasProgressed)return Ui}_checkTileInvariant(){let e=new Map;this._allTiles.forAll(t=>e.set(t,new Set)),this._allTiles.forAll(t=>{if(rr(t.rendered===t.leaf,` rendered ${t.rendered} != ${t.leaf} leaf`),!t.leaf){let i=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,r=t.children.reduce((n,s)=>n+(i(s)?0:1),0);if(rr(t.unmergableChildCount===r,` Tile[${t.lij.toString()}] unmergeable child count mismatch: actual ${t.unmergableChildCount} vs ${r}`),t.hasPendingUpdate(we.MERGE)){rr(!t.hasPendingUpdate(we.SPLIT),"Tile can be both split and merge at the same time");for(let n of t.children)rr(n.leaf||n.hasPendingUpdate(we.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(t.rendered){let o=t.renderData?.geometryState.edgePeerNeighbors[i];if(o!=null){{let a=t.level-o.level<=Gi;a||(console.log(`tile level delta [${t.lij.toString()}] vs [${o.lij.toString()}] > ${Gi}  (edge[${i}])`),rr(a,`tile level delta [${t.level}] vs [${o.level}] > ${Gi}`))}rr(t.level-o.level<=Gi,`Max tile lod delta exceeded: [${t.lij.toString()}] vs [${o.lij.toString()}]`)}}let r=t.level-Gi,n=o=>o.leaf||o.level===t.level,s=t.findNeighborTile(Hn[i],n);if(s!=null){if(t.leaf&&t.level>=Gi){let o=s;for(;t.level-o.level<Gi;)o=o.parent;let a=[r,t.lij[1]>>Gi,t.lij[2]>>Gi];if(!ov(a,o.lij)){let l=e.get(o);rr(!l.has(t),"Cannot already have neighbor"),l.add(t)}}rr(s.rendered||s.level===t.level,"Non-same-level-neighbor of rendered must be rendered"),rr(t.level-s.level<=Gi,`Tile level delta [${t.level}] vs [${s.level}] > ${Gi}`)}}}),this._allTiles.forAll(t=>{let i=t.maxLevelDeltaNeighborCount,r=e.get(t);rr(i===r.size,`Tile[${t.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;let t=new rN(this._allTiles.length);t.pushAll(this._rootTiles);let i=this.snapLevel,r=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});let s=this.view.state.contentCamera.viewProjectionMatrix;for(;!t.empty;){let o=t.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(we.MERGE),c=l?we.MERGE:o.shouldSplit(r,n,i),h=c===we.SPLIT;o.leaf?iN(o,h):t.pushAll(o.children),l?(o.resetPendingUpdate(we.SPLIT),o.leaf||o.setPendingUpdate(we.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(s)):h?(o.resetPendingUpdate(we.MERGE),o.leaf&&o.setPendingUpdate(we.SPLIT)):(o.resetPendingUpdate(we.SPLIT)&&o.updateAgentSuspension(),c===we.ELEVATION&&o.updateAgents(Ue.ELEVATION),o.leaf||(o.setPendingUpdate(we.MERGE),o.resetPendingUpdate(we.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(V3(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){te(e.loaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){let e=this._pendingTilesToUpdate,t=Array.from(e.keys()).filter(n=>n.loaded&&n.intersectsClippingArea);if(t.length===0)return void e.clear();let i=(n,s)=>{!s?.loaded||!s.intersectsClippingArea||s.level<n.level||e.has(s)||(e.add(s),t.push(s),s.renderData.updateNeighborData())};t.sort(wo);let r=t.length;for(let n=0;n<r;++n){let s=t[n];te(s.loaded),te(s.intersectsClippingArea);let o=s.renderData;o.updateNeighborData();let a=o.dirtyEdgeResolutions,l=o.geometryState,c=h=>{let p=Gd[h];i(s,l.cornerPeerNeighbors[h]?.findCorner(um(p),m=>m.loaded))};for(let h=0;h<4;++h)if(a&1<<h){let p=o.geometryState.edgePeerNeighbors[h];p&&p?.level>=s.level&&p.forAllSubtreeOnSide(dm(Hn[h]),m=>!(!m.loaded||!m.intersectsClippingArea)&&(te(e.has(m)||wo(s,m)<0),i(s,m),!0)),c((h+1)%4),c(h)}}e.clear(),this._updateTilesGeometries(t),this._shouldEmitChangeEvent=!0,Ki&&r_&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1,r=this.view.state.fixedContentCamera,n=!1;for(;!e.done;){n=!0;let s=!1,o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return e.done;let l=a;if(a.hasPendingUpdate(we.MERGE)){if(!t||a.unmergableChildCount>0)return e.done;for(a.resetPendingUpdate(we.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(we.MERGE);)l=l.parent;this._mergeTile(l),s=!0,e.madeProgress()}else if(a.resetPendingUpdate(we.SPLIT)){let c=!0,h=a.level;if(h>=Gi){let p=m=>m.leaf||h-m.level<Gi;for(let m=0;m<4;++m){let f=a.findNeighborTile(Hn[m],p);f!=null&&h-f.level===Gi&&(c=!1,Ki&&(te(f.leaf),te(f.hasPendingUpdate(we.SPLIT))))}}c?(this._splitTile(a),e.madeProgress(),s=!0):a.setPendingUpdate(we.SPLIT)}return e.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(we.GEOMETRY)&&(this._updateTileGeometryState(t),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.overlayManager?.updateOverlayParameters(Pe.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){let e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*c3}_getLodBiasCorrectedScale(e){let t=this.tilingScheme.levels,i=q(e-this._lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeSubtree(e){let t=e.children;t[0]&&(this._purgeTile(t[0]),this._purgeTile(t[1]),this._purgeTile(t[2]),this._purgeTile(t[3]),e.clearChildren())}_purgeTile(e){e.leaf?t6(e):this._purgeSubtree(e),this._allTiles.removeUnordered(e),this._unloadTile(e),e.dispose(),this._tileCache.put(t1._tileMemcacheKey,e)}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload()}_splitTile(e){rr(e.leaf,"Tile that is already split should not be split again!"),rr(e.rendered,"Tile marked to split is not rendered"),t6(e);let t=e.createChildren();this._allTiles.pushArray(t),e.updateAgentSuspension(),rr(e.rendered,"parent should be rendered"),t.forEach(i=>this._loadTile(i)),t.forEach(i=>this._pendingTilesToUpdate.add(i)),this._unloadTile(e),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),t.forEach(i=>iN(i,i.hasPendingUpdate(we.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){e1.spatialReference=this.spatialReference,e1.extent=e.extent,e1.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",e1)}createTile(e,t,i,r){rr(!!r,"createTile sanity check");let n=this._acquireTile(e,t,i,r);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(we.SPLIT),n}get _shortBatches(){return this.view.state.mode!==pi.IDLE}_mergeTile(e){rr(!e.hasPendingUpdate(we.SPLIT),"_mergeTile sanity check"),rr(!e.leaf,"Cannot merge a leaf"),e.leaf||(this._purgeSubtree(e),rr(!e.renderData,"Merging tile with existing render data?"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),iN(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager?.hasOverlays&&this.overlayManager.updateTileOverlayParameters(e)}_handleLayerViewChanges(e=Jn){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1,i=new Set,r=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){let s=this.view.allLayerViews.items[n];if(i.add(s.uid),n_(s)||cm(s))if(this._basemapLayerViewHandles.has(s.uid)&&!cm(s)){let o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<r||r==null)&&(t=!0),r=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0)}this._basemapLayerViewHandles.forEach((n,s)=>{i.has(s)||(this._unregisterTiledLayerView(s),t=!0)}),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(let t of this.view.allLayerViews.items)if(SM(t)&&!Mp(t.layer)&&t.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(let e of this.view.allLayerViews.items)if((hu(e)||cm(e))&&Y3(a_[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return MM(e)?Ue.ELEVATION:Ue.MAP}_registerTiledLayerView(e){let t=[];if((hu(e)||cm(e))&&t.push(S(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(di.UNFADED)})),!cm(e)){let i=this._layerClassFromLayerView(e);t.push(S(()=>e.suspended,()=>this._updateTiledLayers())),t.push(S(()=>e.fullOpacity,()=>this._updateTileTextures(di.UNFADED))),t.push(S(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),t.push(e.on("data-changed",()=>{let r=this._getLayerIdxByUID(i,e.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){let t=this._basemapLayerViewHandles.get(e);if(t){for(let i of t)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;let e=this.view.allLayerViews,t=[[],[]],i=null;e.forEach(r=>{if(!r.layer||r.suspended||!n_(r)||!r.fullExtent)return;let n=this._layerClassFromLayerView(r);if(n===Ue.MAP){let s=r.displayLevelRange.maxLevel;s!==1/0&&(i===null||s>i)&&(i=s)}t[n].push(r)});for(let r of cd){let n=this._layerViews[r],s=t[r];s.reverse();let o=s.length,a=n.length!==o,l=new Array(o),c=new Array(n.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){let p=s[h].uid;this._layerIndexByUid[r].set(p,h);let m=n.indexOf(s[h]);l[h]=m,h!==m&&(a=!0),m>-1&&(c[m]=h)}if(a){let h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=s,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){let t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){let i=t.next();i.restartAgents(e),e===Ue.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Ue.MAP),e===di.IMMEDIATE?this.renderer.updateTileTexture(t,we.TEXTURE_NOFADING):t.updateRenderData(Ue.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Pe.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){let n=this.layerViewByIndex(t,i),s=n.layer;return!s.tilemapCache||lm(n)?this._requestTileData(e,i,n,r):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(e.level,e.lij[1],e.lij[2],be(ie({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Bt(r),Gr(o)||this._dataMissing(e,i,n),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,r),r.signal)))}_requestTileData(e,t,i,r){if(this._destroying)return Promise.resolve();let n=t===Ue.ELEVATION;return r.requester??=n?this._elevationDataRequester:this._mapDataRequester,n?MM(i)?this._requestElevationTileData(e,i,r):Promise.reject():SM(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;let r=s=>{!Vl(i)&&s&&(this.setMemoryDirty(),this.requestUpdate(),this._elevationDataArrived(e,t,s))},n=s=>{Gr(s)||(W.getLogger(this).error(`Tile ${e.lij.toString()} layer ${Ue.ELEVATION}/${t.uid} error ${s}`),this._dataMissing(e,Ue.ELEVATION,t),this.requestUpdate())};return t.fetchTile(e.lij,i).then(s=>this._frameTask.schedule(()=>r(s)),n).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(e,t,i){let r=this._layerIndexByUid[Ue.ELEVATION].get(t.uid);if(r==null)return void W.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Ue.ELEVATION,e.lij.toString());let n=new ED(e.lij,e.extent,i);e.dataArrived(r,Ue.ELEVATION,n);let s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){let l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_requestMapTileData(e,t,i){++this._asyncWorkItems;let r=(a,l)=>{pu(l),Vl(i)||(console.error(`Tile ${e.lij.toString()} layer ${Ue.MAP}/${t.uid} error ${a}`),this._dataMissing(e,Ue.MAP,t),this.requestUpdate())},n=a=>l=>r(l,a),s=a=>this._frameTask.schedule(()=>{this.requestUpdate(),Vl(i)?pu(a):this._mapTileDataArrived(e,t,a)},i.signal,n(a)).catch(n(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return t.fetchTile(e.lij,i).then(s,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(e,t,i){let r=this._getLayerIdxByUID(Ue.MAP,t.uid);if(r==null)return pu(i),void W.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(r,Ue.MAP,i)}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i){let r=this._getLayerIdxByUID(t,i.uid);r!=null?e.dataMissing(r,t):W.getLogger(this).warn("TerrainSurface: received data from unknown layer")}get performanceInfo(){let e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.leaf&&e.numLeaves++;let i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((e,t)=>e+t.usedMemory,0)):null}getUsedMemoryForLayerView(e){let t=0,i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return r!=null&&this._allTiles.forAll(n=>t+=n.getUsedMemoryForLayer(i,r)),t}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!r_)return;let e=this._rootTiles;if(e==null)return;let t=s=>s?.renderData?.geometry?.indices?.length>0,i=(s,o)=>{t(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},r=s=>{if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!s.renderData?.geometry||(s.renderData.geometry.indices?.length??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),t(s)){s.checkGeometryWaterproofness();for(let o of s.children)i(o,s)}else if(s.leaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(let o of s.children)r(o)},n=s=>{let o=s.parent?.visible??!0,a=s.visible;s.computeVisibility();let l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.leaf)for(let c of s.children)n(c)};for(let s of e)r(s),n(s)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&e[2]===0}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){let t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this._isGlobal)return null;let r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}enableInternalChecks(e){w3(e)}enableWaterproofnessChecks(e){v3(e)}};nt._tileMemcacheKey="TerrainTileMemcache",u([d()],nt.prototype,"_renderer",void 0),u([d({constructOnly:!0})],nt.prototype,"_scaleRangeQueries",void 0),u([d({constructOnly:!0})],nt.prototype,"view",void 0),u([d({constructOnly:!0})],nt.prototype,"overlayManager",void 0),u([d()],nt.prototype,"_hasPendingUpdates",void 0),u([d()],nt.prototype,"_asyncWorkItems",void 0),u([d()],nt.prototype,"_allTilesDirty",void 0),u([d()],nt.prototype,"_allTilesSorted",void 0),u([d()],nt.prototype,"_viewChanged",void 0),u([d({type:Number})],nt.prototype,"heading",void 0),u([d()],nt.prototype,"_splitLimits",void 0),u([d({readOnly:!0})],nt.prototype,"_watchUpdatingTracking",void 0),u([d()],nt.prototype,"_frameTask",void 0),u([d({readOnly:!0})],nt.prototype,"snapLevel",null),u([d({readOnly:!0})],nt.prototype,"lodSnappingEnabled",null),u([d()],nt.prototype,"_userClippingExtent",null),u([d()],nt.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],nt.prototype,"extent",null),u([d({readOnly:!0})],nt.prototype,"groundExtent",null),u([d({readOnly:!0})],nt.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],nt.prototype,"updating",null),u([d({readOnly:!0})],nt.prototype,"running",null),u([d(m3)],nt.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],nt.prototype,"updatingProgressValue",null),u([d()],nt.prototype,"_maxNumUpdating",void 0),u([d()],nt.prototype,"baseOpacity",null),u([d()],nt.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],nt.prototype,"viewingMode",null),u([d()],nt.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],nt.prototype,"ready",null),u([d({value:o_.FRONT_TO_BACK})],nt.prototype,"renderOrder",null),u([d({readOnly:!0})],nt.prototype,"rootTiles",null),u([d()],nt.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],nt.prototype,"spatialReference",null),u([d({type:fn})],nt.prototype,"backgroundColor",null),u([d({value:!1})],nt.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],nt.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],nt.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],nt.prototype,"tilingSchemeLogic",void 0),u([d()],nt.prototype,"wireframe",null),u([d({value:!1})],nt.prototype,"suspended",null),u([d()],nt.prototype,"fadeDuration",null),u([d()],nt.prototype,"visibleElevationBounds",void 0),u([d()],nt.prototype,"rootTileElevationBounds",void 0),u([d()],nt.prototype,"_layerViewsDirty",void 0),u([d()],nt.prototype,"renderPatchBorders",null),u([d()],nt.prototype,"visualizeNormals",null),u([d()],nt.prototype,"renderingDisabled",null),nt=t1=u([C("esri.views.3d.terrain.TerrainSurface")],nt);var i6=nt,fv=w(),ng=ur(),Die=Yt();new Nt;var tN=new zV("ground"),e1={spatialReference:null,extent:null,scale:0};function e6(e,t,i){for(let r of e){if(!r.containsPointXY(t,i))continue;let n=r;for(;n&&!n.renderData;){let o=(t>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[o]}let s=n?.renderData?.geometryState.samplerData??null;return gi(t,i,s)}return null}var rN=class{constructor(t){this.capacity=t,this._head=0,this._tail=0,this._data=new Array(t)}push(t){let i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=t,this._tail=i+1}pushAll(t){let i=t.length;if(i===0)return;let r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let n=0;n<i;++n)this._data[r+n]=t[n];this._tail=r+i}pop(){let t=this._head;if(t<this._tail){let i=this._data[t];return this._head=t+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}};function iN(e,t){!e.leaf||e.level<Gi||sN(e,i=>{t&&r6(i);let r=nN(i);if(i.maxLevelDeltaNeighborCount++,r){let n=i.parent;for(;n;){let s=nN(n);if(n.unmergableChildCount++,!s)break;n=n.parent}}})}function r6(e){if(e.hasPendingUpdate(we.SPLIT))return;let t=e.parent;for(;t?.resetPendingUpdate(we.MERGE);)t=t.parent;e.resetPendingUpdate(we.MERGE),e.leaf&&e.setPendingUpdate(we.SPLIT),e.level<Gi||sN(e,i=>{r6(i)})}function t6(e){e.level<Gi||sN(e,t=>{if(t.maxLevelDeltaNeighborCount--,t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0){let i=t.parent;for(;i&&(i.unmergableChildCount--,nN(i));)i=i.parent}})}function nN(e){return e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0}function sN(e,t){if(e.level<Gi)return;let i=e.level-Gi,r=e.lij[1]>>Gi,n=e.lij[2]>>Gi,s=o=>o.leaf||o.level===i;for(let o=0;o<4;++o){let a=e.findNeighborTile(Hn[o],s);if(!a||a.level!==i)continue;let l=a.lij;l[1]===r&&l[2]===n||t(a)}}var oN=class{constructor(t,i,r,n){this.operation=t,this.geometry=i,this.states=r,this.sync=n}},gv=class extends P{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyRecordCount=0}get dirty(){return this._dirtyRecordCount>0}commitLayer(e,t){let i=this._dirtyGeomRecords.get(e);if(!i)return;let r=0;i.forEach((n,s)=>{let o=this._ensureGeomRecord(e,s);r+=n.size,n.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===zi.UPDATE){let m=o.get(h);if(m){if(c&Za.TRANSFORMATION){let f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,a,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:c})}else Xr(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===zi.REMOVE||p){let m=o.get(h);m?(t.removes.push(m),o.delete(h)):l===zi.REMOVE&&Xr(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===zi.ADD||p){let m=this.model.getObject(s);if(m!=null){let f=this.model.getRenderGeometry(m,a);t.adds.push(f),o.set(h,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this._dirtyRecordCount-=r}commitSyncUpdates(e,t){let i=this._dirtyGeomRecords.get(e);i&&i.forEach((r,n)=>{let s=this._ensureGeomRecord(e,n);r.forEach(({geometry:o,operation:a,states:l,sync:c},h)=>{let p=!1;if(a===zi.UPDATE&&c){let m=s.get(h);if(m){if(l&Za.TRANSFORMATION){let f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,o,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:l})}else Xr(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,t){let i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(n=>t.push(n)))}_objectStateChanged(e,t){for(let i of t.geometries)this._updateOrCreateDirtyRecord(t,i,null,zi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Za.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Za.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Za.OCCLUDEE,e)}attributesChanged({object:e,geometry:t,sync:i}){this._updateOrCreateDirtyRecord(e,t,null,zi.UPDATE,Za.GEOMETRY,i)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){let i=e.id;for(let r of t.geometries)this._geometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(let t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(let t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){let i=e.id;for(let r of t.geometries)this._geometryRemoved(t,r,i)}transformationChanged(e){let t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r.geometry,t,zi.UPDATE,Za.TRANSFORMATION)})}shaderTransformationChanged(e){let t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{r.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,zi.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,zi.REMOVE)}_updateOrCreateDirtyRecord(e,t,i,r,n=Za.NONE,s=!1){i=i??this._getParentLayerId(e);let o=e.id,a=t.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){let h=c.operation;h===zi.REMOVE&&r===zi.ADD&&c.states!==Za.NONE?c.operation=zi.UPDATE:h===zi.REMOVE&&r===zi.ADD||h===zi.ADD&&r===zi.REMOVE?(l.delete(a),this._dirtyRecordCount--):h!==zi.UPDATE||r!==zi.REMOVE&&r!==zi.UPDATE?(Xr((h===zi.REMOVE||h===zi.ADD)&&r===zi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=r,c.states|=n),c.sync=c.sync||s}else l.set(a,new oN(r,t,n,s)),this._dirtyRecordCount++}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:u2}formatDebugInfo(){let e=["ADD","UPD",void 0,"REM"],t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((n,s)=>{t.length>0&&(t+=`
`),t+=r+"."+s;let o=[];n.forEach(a=>{let l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){}};u([d()],gv.prototype,"_dirtyRecordCount",void 0),u([d({constructOnly:!0})],gv.prototype,"model",void 0),gv=u([C("esri.views.3d.webgl-engine.lib.ModelDirtySet")],gv);var n6=gv;var _v=class extends P{constructor(){super(...arguments),this.dirtySet=new n6({model:this}),this._content=new Map,this._originFactory=new LV(null)}getObject(e){return this._content.get(e)}add(e){let t=e.id;Xr(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),im(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),im(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(let t of e)t&&(Xr(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(let t of e)t&&(Xr(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){let i=new HV(t,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(t,s6);let{localOrigin:r}=t;return i.localOrigin=r??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,t,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(t,s6);let r=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==r}getStats(){let e={},t=Array.from(this._content.values());for(let i=0;i<X0.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};u([d({constructOnly:!0})],_v.prototype,"dirtySet",void 0),_v=u([C("esri.views.3d.webgl-engine.parts.Model")],_v);var s6=$t();var i1=class extends Uw{constructor(){super(...arguments),this.innerFadeDistance=0,this.altitudeFade=0,this.backgroundColor=w()}},sg=class extends ft{constructor(t,i){super(t,i,new mt(lH,()=>import("./chunk-CGCSPPRE.js")))}initializePipeline(t){return Tt({blending:t.reduced?Zp:$p(ei.SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),depthTest:{func:t.reduced?Ei.ALWAYS:Ei.LEQUAL},colorWrite:St})}};var yv=class extends ou{constructor(){super(...arguments),this.reduced=!1}};u([Zt()],yv.prototype,"reduced",void 0);var In=class extends ss{constructor(){super(...arguments),this.produces="disabled",this.consumes={required:[Oe.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=Oe.OPAQUE_ENVIRONMENT,this.requestRender(Pe.UPDATE)}_disable(){this.produces="disabled",this.requestRender(Pe.UPDATE)}};u([d()],In.prototype,"produces",void 0),u([d()],In.prototype,"consumes",void 0),In=u([C("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],In);var vv=class extends ft{constructor(t,i){super(t,i,new mt(uH,()=>import("./chunk-WS2JARHK.js")))}initializePipeline(){return Tt({blending:$p(ei.SRC_ALPHA,ei.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ei.ALWAYS},colorWrite:St})}};var r1=class extends In{constructor(){super(...arguments),this.requireGeometryDepth=!0,this._compositingPassParameters=new cH,this._vao=null,this._passParameters=new i1,this._configuration=new yv}initialize(){this.techniques.precompile(sg,this._configuration),this.techniques.precompile(vv),this._configuration.reduced=!0,this.techniques.precompile(sg,this._configuration),this._configuration.reduced=!1,this.addHandles([S(()=>this.view.environment.background,e=>{let t=e instanceof zT?Hp(e.color):mn;Te(this._passParameters.backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3])},Ce),S(()=>this.view._stage?.renderer?.fullResolutionAtmosphere,e=>this._configuration.reduced=!e,Ce),S(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ce)])}destroy(){this._vao=We(this._vao)}render(e){let t=e.find(({name:g})=>g===Oe.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return t;let i=this.renderingContext;this._vao??=gn(i,mu.Pos2Tex);let r=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);this._update();let n=this.techniques.get(sg,this._configuration);if(!n.compiled)return this.requestRender(Pe.UPDATE),t;if(!this._configuration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(n,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Jt.TRIANGLE_STRIP,0,4),t.attachDepth(r),t;let s=this.techniques.get(vv);if(!s.compiled)return this.requestRender(Pe.UPDATE),t;let o=i.getViewport(),a=this.bindParameters.camera,l=xe(a.eye)-dn.radius,c,h=dn.atmosphereHeight;if(l<h){let g=Math.min(1,Math.max(0,l/h));c=Xe(.2,.3,g)}else{let g=Math.min(1,Math.max(0,(l-h)/(15*h)));c=Xe(.3,.6,g)}let p=su(Math.round(c*a.fullViewport[2])),m=su(Math.round(c*a.fullViewport[3]));i.setViewport(0,0,p,m);let f=this.fboCache.acquire(p,m,"chapman",Pi.RGBA);return i.bindFramebuffer(f.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(n,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Jt.TRIANGLE_STRIP,0,4),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=f.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(s,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(r),f.release(),t}_update(){let e=this.bindParameters.camera,t=Ar(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]**2,n=q((i-this._passParameters.radii[0])/dn.atmosphereHeight,0,1);ho(this._passParameters.heightParameters,i,t,r,n);let s=this.view.basemapTerrain?.getLowerBoundRadius()??0;es(this._passParameters.radii,s,s+dn.atmosphereHeight),this._passParameters.innerFadeDistance=2*Math.sqrt((2*s-BM)*BM),this._passParameters.altitudeFade=fm(i-s)}};r1=u([C("esri.views.3d.environment.ChapmanAtmosphere")],r1);var wv=class extends ft{constructor(t,i){super(t,i,new mt(dH,()=>import("./chunk-JEMG7YVG.js")))}initializePipeline(){return Tt({blending:za(ei.ONE,ei.ZERO,ei.SRC_ALPHA,ei.ONE),depthTest:{func:Ei.LEQUAL},colorWrite:St})}};var n1=class extends In{constructor(e){super(e),this._planetRadius=_t(e.view.spatialReference).radius}initialize(){this.techniques.precompile(wv),this.addHandles([S(()=>this.view.environment.weather!=null&&this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Re)])}destroy(){this._vao=We(this._vao)}render(e){let t=e.find(({name:o})=>o===Oe.OPAQUE_ENVIRONMENT),i=this.bindParameters.clouds;if(!i.data)return t;let r=this.techniques.get(wv);if(!r.compiled)return this.requestRender(Pe.UPDATE),t;let n=this.renderingContext;this._vao??=gn(n);let s=n.bindTechnique(r,this.bindParameters);return n.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),n.drawArrays(Jt.TRIANGLE_STRIP,0,4),i.isFading&&this.requestRender(Pe.UPDATE),t}};n1=u([C("esri.views.3d.environment.CloudsComposition")],n1);var bv=class extends ft{constructor(t,i){super(t,i,new mt(pH,()=>import("./chunk-EYIEWMFL.js")))}initializePipeline(){return Tt({blending:za(ei.SRC_ALPHA,ei.ZERO,ei.ONE_MINUS_SRC_ALPHA,ei.ONE),colorWrite:St})}};var ap=class extends In{constructor(){super(...arguments),this.consumes={required:[Oe.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=Oe.TRANSPARENT_ENVIRONMENT,this.requestRender(Pe.UPDATE)}};u([d()],ap.prototype,"consumes",void 0),ap=u([C("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],ap);var xie=.95,Mie=1,s1=class extends ap{constructor(e){super(e),this.requireGeometryDepth=!0,this._newParameters=new Cv,this._oldParameters=new Cv,this._fadedParameters=new Cv,this._parameters=this._newParameters,this._passParameters=new hH;let t=_t(e.view.spatialReference);this._planetRadius=t.radius,this._atmosphereRadius=t.radius+t.atmosphereHeight,e.view._stage.renderView.techniques.precompile(bv)}toogle(){this.view.environment.atmosphereEnabled&&this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([S(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),Ce),S(()=>this.view.environment.weather,()=>this.toogle(),Ce),S(()=>this._updateFogParameters(),()=>{},Ce)]),this.addHandles(S(()=>this._fadeFactor,e=>this._fade(e),Ce))}get _fadeFactor(){return this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(e){let{_newParameters:t,_oldParameters:i}=this;e>=1?(this._parameters=t,this._oldParameters.copyFrom(this._newParameters)):e<=0?this._parameters=i:(this._fadedParameters.lerp(i,t,e),this._parameters=this._fadedParameters)}_updateFogParameters(){let e=this.view.environment.weather,t=e.type==="foggy"||e.type==="snowy"||e.type==="rainy";this._newParameters.strength=e.type==="foggy"?Xe(3e-5,.005,e.fogStrength**3):e.type==="snowy"||e.type==="rainy"?Xe(4e-6,2e-4,(e.precipitation??0)**3):0,this._newParameters.amount=t?1:0,e.type!=="foggy"&&e.type!=="snowy"||ee(this._newParameters.color,Iie),e.type==="rainy"&&ee(this._newParameters.color,Sie),this._fadeFactor>=1&&this._oldParameters.copyFrom(this._newParameters),this.requestRender(Pe.UPDATE)}render(e){let t=e.find(({name:s})=>s===Oe.TRANSPARENT_ENVIRONMENT);if(this._parameters.amount===0||(this._update(),this._passParameters.amount<=0))return t;let i=this.techniques.get(bv);if(!i.compiled)return this.requestRender(Pe.UPDATE),t;let r=this.renderingContext,n=t.getAttachment(r.gl.DEPTH_STENCIL_ATTACHMENT);return t.attachDepth(null),r.bindFramebuffer(t.fbo),r.bindTechnique(i,this.bindParameters,this._passParameters),r.screen.draw(),t.attachDepth(n),t}_update(){let e=this.bindParameters.camera;ne(o6,e.eye);let t=Math.max(0,ae(o6,this.bindParameters.lighting.mainLight.direction)),i=this._parameters.color;X(a6,i,.1),ni(this._passParameters.color,a6,i,t);let r=xe(e.eye);this._passParameters.atmosphereC=r**2-this._atmosphereRadius**2,this._passParameters.amount=(1-Bl(xie*Jg,Mie*Jg,Math.abs(r-this._planetRadius)))*this._parameters.amount,this._passParameters.strength=this._parameters.strength}};s1=u([C("esri.views.3d.environment.Fog")],s1);var Cv=class{constructor(){this.color=w(),this.strength=0,this.amount=0}copyFrom(t){this.amount=t.amount,this.strength=t.strength,ee(this.color,t.color)}lerp(t,i,r){this.amount=Xe(t.amount,i.amount,r),this.strength=Xe(t.strength,i.strength,r),ni(this.color,t.color,i.color,r)}},o6=w(),a6=w(),Sie=yt(.5,.5,.5),Iie=yt(1.5,1.5,1.5);var Nl=class extends ft{constructor(t,i){super(t,i,new mt(mH,()=>import("./chunk-BOLHIQHB.js")))}initializePipeline(t){let i=t.geometry===_u.Cylinder;return Tt({blending:Ga,culling:i?K0:void 0,depthTest:{func:Ei.LEQUAL},colorWrite:St})}};var l6=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var o1=class extends In{constructor(){super(...arguments),this._configuration=new jw,this._passParameters=new zw,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=_u.Cylinder,this.addHandles([S(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Re)])}destroy(){this._passParameters.texture=We(this._passParameters.texture),this._vao=We(this._vao)}precompile(){this.techniques.precompile(Nl,this._configuration)}render(e){let t=e.find(({name:s})=>s===Oe.OPAQUE_ENVIRONMENT),i=this.techniques.get(Nl,this._configuration);if(!i.compiled)return this.requestRender(Pe.UPDATE),t;let r=this.renderingContext;if(this._vao||(this._vao=Aie(r),this._vaoCount=sa(this._vao,"geometry")),!this._passParameters.texture){let s=new vi;s.wrapMode=ji.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Di(r,s,l6)}let n=r.bindTechnique(i,this.bindParameters,this._passParameters);return Rie(c6,this.bindParameters.camera.viewMatrix),n.setUniformMatrix4fv("view",c6),r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Jt.TRIANGLES,0,this._vaoCount),t}};function Aie(e){let t=bk(1,2,!1),{data:i,indices:r}=t[0][1],n=u6.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){let a=3*r[o%3==0?o+2:o%3==2?o-2:o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new ns(e,ja,new Map([["geometry",is(u6)]]),new Map([["geometry",wr.createVertex(e,Jr.STATIC_DRAW,n.buffer)]]))}function Rie(e,t){Ap(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}o1=u([C("esri.views.3d.environment.LocalAtmosphere")],o1);var c6=$t(),u6=Ps().vec3f(yi.POSITION);var d6=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);var a1=128,h6=-1e4,p6=0,aN=50,Pie=()=>1-511/512,Oie=Up([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]),cN=class extends In{constructor(e){super(e),this._passParameters=new zw,this._configuration=new jw,this._vao=null,this._vaoCount=0,this._fadeVao=null,this._fadeVaoCount=0,this._texV1=1;let t=e.view,i=_t(t.spatialReference),{outerAtmosphereRimWidth:r,radius:n}=i;this._planetRadius=n,this._innerRimFactor=1+h6/n,this._middleRimFactor=1+p6/n,this._outerRimFactor=1+r/n,this._texV0=p6/r,this._texVScale=this._texV1-this._texV0;let s=t._stage.renderView.techniques;s.precompile(Nl,this._configuration),this._configuration.geometry=_u.Underground,s.precompile(Nl,this._configuration)}initialize(){this.addHandles(S(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Re))}destroy(){this._passParameters.texture=We(this._passParameters.texture),this._fadeVao=We(this._fadeVao),this._vao=We(this._vao)}render(e){let t=e.find(({name:r})=>r===Oe.OPAQUE_ENVIRONMENT);this._update();let i=this.renderingContext;if(!this._passParameters.texture){let r=new vi;r.wrapMode=ji.CLAMP_TO_EDGE,r.flipped=!0,r.width=1,r.height=512,this._passParameters.texture=new Di(i,r,d6)}if(this._passParameters.undergroundFadeAlpha<1){this._vao||(this._vao=this._createRibbon(i),this._vaoCount=sa(this._vao,"geometry")),this._configuration.geometry=_u.Cone;let r=this.techniques.get(Nl,this._configuration);if(!r.compiled)return this.requestRender(Pe.UPDATE),t;i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Jt.TRIANGLES,0,this._vaoCount)}if(this._passParameters.undergroundFadeAlpha>0){this._fadeVao||(this._fadeVao=gn(i),this._fadeVaoCount=sa(this._fadeVao,"geometry")),this._configuration.geometry=_u.Underground;let r=this.techniques.get(Nl,this._configuration);if(!r.compiled)return this.requestRender(Pe.UPDATE),t;i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(Jt.TRIANGLE_STRIP,0,this._fadeVaoCount)}return t}_update(){let e=this.bindParameters.camera,t=w(),i=this._planetRadius,r=xe(e.eye),n=r-i;if(n<0){let m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;let s=Math.max(aN,n),o=i+h6;this._passParameters.innerScale=Nie(i+s,i,o)-1,this._passParameters.altitudeFade=fm(n),X(t,e.eye,(i+aN)/r),m6(t,e.center,e.up,i,this._passParameters.silhouette);let a=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),l=Pie(),c=Oie(n),h=this._texV0+l*this._texVScale,p=this._texV0+a*c*this._texVScale;if(n>aN){m6(e.eye,e.center,e.up,i,this._passParameters.silhouette);let m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),f=q((m-1.5)/(a-1.5),0,1);h=this._texV0+f*l*this._texVScale,p=this._texV0+Xe(this._texV1,a*c,f)*this._texVScale}es(this._passParameters.texV,h,p)}_createRibbon(e){let t=R0(3+3*a1*3),i=new Uint32Array(3*a1*5);t[0]=0,t[1]=0,t[2]=-1;for(let s=0;s<a1;s++){let o=9*s+3;t[o]=s,t[o+1]=this._innerRimFactor,t[o+2]=-1,t[o+3]=s,t[o+4]=this._middleRimFactor,t[o+5]=0,t[o+6]=s,t[o+7]=this._outerRimFactor,t[o+8]=1;let a=3*s+1,l=s===a1-1?1:a+3,c=15*s;i[c]=a,i[c+1]=a+1,i[c+2]=l+1,i[c+3]=l+1,i[c+4]=l,i[c+5]=a,i[c+6]=a+1,i[c+7]=a+2,i[c+8]=l+2,i[c+9]=l+2,i[c+10]=l+1,i[c+11]=a+1,i[c+12]=a,i[c+13]=l,i[c+14]=0}let r=f6.createBuffer(i.length),n=r.position;for(let s=0;s<i.length;++s){let o=3*i[s];n.set(s,0,t[o]),n.set(s,1,t[o+1]),n.set(s,2,t[o+2])}return new ns(e,ja,new Map([["geometry",is(f6)]]),new Map([["geometry",wr.createVertex(e,Jr.STATIC_DRAW,r.buffer)]]))}_computeScreenRimWidth(e,t,i,r){return he(og,r.center,r.v2),X(l1,og,this._outerRimFactor),tL(lN,t,og,i),Yx(og,lN,e.projectionMatrix,e.viewport,og),Yx(l1,lN,e.projectionMatrix,e.viewport,l1),ui(og,l1)/e.height}};function m6(e,t,i,r,n){let s=xe(e),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return X(n.center,e,a/s),At(l,e,t),Ar(l)<1&&At(l,e,i),X(l,l,o/xe(l)),At(c,l,e),X(c,c,o/xe(c)),o}cN=u([C("esri.views.3d.environment.MarsAtmosphere")],cN);var lN=$t(),og=w(),l1=w();function Nie(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}var f6=Ps().vec3f(yi.POSITION),g6=cN;var c1=class{constructor(t){this._totalCount=t,this._componentCountCache=-1,this._indexRanges=[0,t]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(t){if(t<0||t>=this._totalCount)return!1;if(this.allVisible())return!0;{let i=this._indexRanges,r=0,n=i.length/2;if(t<i[2*r]||t>i[2*n]+i[2*n+1])return!1;for(;n-r>0;){let s=Math.floor(.5*(r+n)),o=i[2*s];if(t<o){if(n-r==1)return!1;n=s;continue}if(t<o+i[2*s+1])return!0;if(n-r==1)return!1;r=s+1}return!1}}get componentCount(){if(this._componentCountCache===-1){let t=this._indexRanges,i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];this._componentCountCache=i}return this._componentCountCache}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Lie(t),this._componentCountCache=-1}forEachComponent(t){let i=this._indexRanges;for(let r=0;r<i.length;r+=2){let n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){let i=this._indexRanges;for(let r=0;r<i.length;r+=2){let n=i[r];if(!t(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(t){let i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){let s=r[n],o=s+r[n+1],a=t[s],l=t[o];i[n]=a,i[n+1]=l-a}return i}};function Lie(e){let t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let n=1;n<e.length;n++){let s=e[n];i+r===s?r+=1:(t.push(i),t.push(r),i=s,r=1)}return t.push(i),t.push(r),t}var u1=class{constructor(t,i){this.offsets=i,this._highlightsInOrder=[],this.pickability=null,this.componentHighlights=new Map,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null;let r=this.count;this.visibility=new c1(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRangesMap(){return this.componentHighlights.size===0?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRangesMap)}get shadowmapRanges(){return this.componentHighlights.size===0?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedShadowmapRanges)}markHighlightsDirty(){this.cachedHighlightRangesMap=null,this.cachedShadowmapRanges=null}markVisibilityDirty(){this.cachedGeometryRanges=null,this.markHighlightsDirty()}updateHighlights(t){this._updateHighlightOrder(t)&&(this.markHighlightsDirty(),this._updateCachedHighlightRanges())}_updateHighlightOrder(t){let{_highlightsInOrder:i}=this,r=i.length!==t.length;i.length=Math.min(t.length,8);for(let n=0;n<t.length;++n){let s=t.at(n).name;i.length<n?(r=!0,i.push(s)):i[n]!==s&&(i[n]=s,r=!0)}return r}_updateCachedHighlightRanges(){if(this.cachedHighlightRangesMap==null||this.cachedShadowmapRanges==null){let{highlightRangesMap:t,shadowmapRangesMap:i}=Fie(this.componentHighlights,this.visibility,this.offsets,this._highlightsInOrder);this.cachedHighlightRangesMap=t,this.cachedShadowmapRanges=i}}};function Fie(e,t,i,r){let n=new Map,s=[];if(e.size>0){let o=i.length;t.forEachComponent(a=>{let l=!1;for(let c=r.length-1;c>=0;--c){let h=r[c];if((e.get(h)?.[a]??0)>0){let m=wp(n,h,()=>[]),f=i[a],g=i[a+1];m.push(f),m.push(g-f),l||=h===kd;break}}return l||(o!==a-1&&(s.length>0&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0}),s.length>0&&s.push(i[o+1]-s[s.length-1])}return{highlightRangesMap:n,shadowmapRangesMap:s}}var d1=class{constructor(t,i,r,n,s,o){this.transform=t,this.toMapSpace=i,this.obb=r,this.componentData=n,this.renderable=s,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=G(this.intersectionGeometry),this.renderable=G(this.renderable),this.componentData=G(this.componentData)}};function _6(e,t,i,r,n,s,o){let a=s-o,l=t-e,c=new Float64Array(4*l);for(let h=0;h<l;++h){let p=3*(h+e),m=n*i[p+0],f=r[m+0],g=r[m+1],_=a/(r[m+2]-o),v=f*_,b=g*_,x=n*i[p+1],E=r[x+0],D=r[x+1],M=a/(r[x+2]-o),T=E*M,I=D*M,A=n*i[p+2],O=r[A+0],$=r[A+1],H=a/(r[A+2]-o),k=O*H,K=$*H,F=4*h;c[F+0]=Math.min(v,T,k),c[F+1]=Math.min(b,I,K),c[F+2]=Math.max(v,T,k),c[F+3]=Math.max(b,I,K)}return c}function y6(e,t,i,r,n){let s=t-e,o=new Float64Array(4*s);for(let a=0;a<s;++a){let l=3*(a+e),c=n*i[l+0],h=r[c+0],p=r[c+1],m=n*i[l+1],f=r[m+0],g=r[m+1],_=n*i[l+2],v=r[_+0],b=r[_+1],x=4*a;o[x+0]=Math.min(h,f,v),o[x+1]=Math.min(p,g,b),o[x+2]=Math.max(h,f,v),o[x+3]=Math.max(p,g,b)}return o}function v6(e,t){return new(kie(e))(t)}function kie(e){return e<128?Uint8Array:e<32768?Uint16Array:e<1<<31?Uint32Array:Array}var ag=class{constructor(t,i){this.elementCount=t,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=yt(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(t,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(t,i,r))}_intersectRayWithoutBVH(t){this._intersectRange(0,this.elementCount)}_intersectRange(t,i){this.model.intersectRange(t,i)}_intersectRayWithBVH(t,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(t):this._intersectGeometryWithBVHGeneralRay(t,i)}_intersectGeometryWithBVHVerticalRay(t){let i=t[0],r=t[1];if(!this.localMode){let{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(t[2]-a);i=t[0]*l,r=t[1]*l}let{_bspNodes:n}=this,s=0;for(;s>=0;){let o=n[s],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:h,maxMidIndexIndex:p,maxIndexIndex:m,aabb2D:f}=o;if(i<f[0]||i>f[2]||r<f[1]||r>f[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,m);break}{this._intersectRange(h,p);let g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,h);break}s=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(p,m);break}s=o.child1}}}}_intersectGeometryWithBVHGeneralRay(t,i){let r=t[0],n=t[1],s=i[0],o=i[1],{geometryMinZ:a}=this;if(!this.localMode){let g=0,_=1,v=Math.min(.5*this.planetCenterZ,a),b=t[2],x=i[2];if(b<v&&x<v||(b<v&&(g=(v-b)/(x-b)),x<v&&(_=(v-b)/(x-b)),g>_))return;let E=(1-g)*t[0]+g*i[0],D=(1-g)*t[1]+g*i[1],M=(1-g)*t[2]+g*i[2],T=(1-_)*t[0]+_*i[0],I=(1-_)*t[1]+_*i[1],A=(1-_)*t[2]+_*i[2],{planetCenterZ:O}=this,$=a-O,H=$/(M-O);r=E*H,n=D*H;let k=$/(A-O);s=T*k,o=I*k}let l=s-r,c=o-n,h=this._bspNodes,p=1;{let{aabb2D:g}=h[0],_=(x,E,D,M)=>{if(Math.abs(E)<1e-5*Math.max(M-D,1))return!1;let T=E>0,I=T?M:D,A=x+p*E;return(T?A<I:A>I)&&(p=Math.max((I-x)/E,p),!0)},v=()=>_(r,l,g[0],g[2]),b=()=>_(n,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}let m=[0,0,p],f=0;for(;f<m.length;){let g=m[f],_=m[f+1],v=m[f+2];if(f+=3,_>v)continue;let b=h[g],{minIndexIndex:x,maxIndexIndex:E}=b,{child0:D,child1:M,minMidIndexIndex:T,maxMidIndexIndex:I,aabb2D:A,d:O,dim:$}=b;{let H=r+_*l,k=r+v*l,K=Math.min(H,k),F=Math.max(H,k),R=A[0],j=A[2];if(F<R||j<K)continue;if(K<R){let B=(R-r)/l;l>0?_=Math.max(_,B):v=Math.min(v,B)}if(j<F){let B=(j-r)/l;l>0?v=Math.min(v,B):_=Math.max(_,B)}}{let H=n+_*c,k=n+v*c,K=Math.min(H,k),F=Math.max(H,k),R=A[1],j=A[3];if(F<R||j<K)continue;if(K<R){let B=(R-n)/c;c>0?_=Math.max(_,B):v=Math.min(v,B)}if(j<F){let B=(j-n)/c;c>0?v=Math.min(v,B):_=Math.max(_,B)}}if(D===-1&&M===-1)this._intersectRange(x,E);else{let H=$===0?r:n,k=$===0?l:c,K=H+_*k,F=H+v*k,R=Math.min(K,F),j=Math.max(K,F),B=q((O-H)/k,0,p);x<T&&R<=O&&(D!==-1?(m.push(D),m.push(k>=0?_:Math.max(_,B)),m.push(k>=0?Math.min(v,B):v)):this._intersectRange(x,T)),this._intersectRange(T,I),I<E&&O<=j&&(M!==-1?(m.push(M),m.push(k>=0?Math.max(_,B):_),m.push(k>=0?v:Math.min(v,B))):this._intersectRange(I,E))}}}_generateBsp(){let{elementCount:t}=this;if(t<1)return;let i=v6(t,t);this._elementIndexMap=i;for(let f=0;f<t;++f)i[f]=f;let r=this.model.getAabbs2D(),n=0,s=this._bspNodes;s.length=0;let{localMode:o}=this,a=!1;if(!o){let{planetCenterZ:f,geometryMinZ:g}=this;a=f>=0||g<.5*f}let l=[],c=(f,g,_,v,b)=>{l.push(f),l.push(g),l.push(_),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:h,minBspNodeElementCount:p}=this,m=(f,g,_,v,b)=>{let x=s.length;if(x>0&&(a||_>=h||g-f<p))return;let E=[0,0,0,0];Uie(E,f,g,i,r);let{d:D,dim:M}=o?Vie(E):Hie(E),{rangeMidStart:T,rangeMidEnd:I}=Bie(f,g,M,D,i,r),A=_===h-1,O=!A&&T>=f+p,$=!A&&g>=I+p;if(O||$||x===0){let H=new uN(f,T,I,g,M,D,E);if(O&&c(f,T,_+1,x,!0),$&&c(I,g,_+1,x,!1),s.push(H),v!==-1){let k=s[v];b?k.child0=x:k.child1=x}}};for(c(0,t,0,-1,!1);n<l.length;){let f=l[n],g=l[n+1],_=l[n+2],v=l[n+3];n+=4;let b=v>>1;m(f,g,_,b,v-(b<<1)==0)}this._generatedBVH=!0}};function Vie(e){let t=e[0],i=e[1],r=e[2],n=e[3],s,o;return r-t>=n-i?(o=.5*(t+r),s=0):(o=.5*(i+n),s=1),{d:o,dim:s}}function Hie(e){let t=e[0],i=e[1],r=e[2],n=e[3],s,o;return r-t>=n-i?(s=0,o=.5*(t+r)):(s=1,o=.5*(i+n)),{dim:s,d:o}}function Bie(e,t,i,r,n,s){let o=e;{let h=t;for(;o<h;){let p=n[o];w6(p,i,r,s)<0?++o:(--h,n[o]=n[h],n[h]=p)}}let a=o,l=o,c=t;for(;l<c;){let h=n[c-1];w6(h,i,r,s)>0?--c:(n[c-1]=n[l],n[l]=h,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function w6(e,t,i,r){let n=4*e,s=r[n+0+t];return r[n+2+t]<i?-1:s>i?1:0}function Uie(e,t,i,r,n){let s=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=t;c<i;++c){let h=4*r[c];s=Math.min(s,n[h+0]),o=Math.min(o,n[h+1]),a=Math.max(a,n[h+2]),l=Math.max(l,n[h+3])}e[0]=s,e[1]=o,e[2]=a,e[3]=l}var uN=class{constructor(t,i,r,n,s,o,a){this.minIndexIndex=t,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=n,this.dim=s,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}};var h1=class{constructor(t,i,r,n,s,o,a,l,c){this.componentIndex=t,this.vertexData=i,this.vertexStride=r,this.indexData=n,this.startTriangleNumber=s,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=w(),this.ray0=w(),this.isVerticalRay=!1,this._triangleHitCallback=b6,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new ag(o-s,this)}getAabbs2D(){return this.localMode?y6(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):_6(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(t,i,r,n,s,o){ee(this.ray0,t),ai(this.rayDirection,i,t),this.isVerticalRay=r,this.totalElevationOffset=n,this.normalRequired=o,this._triangleHitCallback=s,this._bvh.intersectRay(t,i,r),this._triangleHitCallback=b6}intersectRange(t,i){let r=this._bvh.elementIndexMap;dN(this.ray0,this.rayDirection,t,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(t){return this.totalElevationOffset}};function dN(e,t,i,r,n,s,o,a,l,c,h,p=null,m=0){a!==0?fk(e,t,i,r,n,s,o,a,l,c,h,p,m):ew(e,t,i,r,n,s,o,c,h,p,m)}function b6(){}function C6(e,t,i,r){if(i>=t)return e;e==null&&(e=jie());let n=e.isVisibleBit,s=e.data,o=T6(s),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=s,p=r===n;if(!(i<h.length*o)&&p){let m=a+1,f=Math.ceil(h.length*YN),g=c+1,_=Math.max(m,f);_=Math.min(_,g),s=new Uint32Array(_),s.set(h)}return a<s.length&&(s[a]=Gie(s[a],l,p)),e.data=s,e}function Tv(e,t){if(e==null)return!0;let{isVisibleBit:i,data:r}=e,n=T6(r);return t<r.length*n?zie(i,r,t,n):!e.isVisibleBit}function jie(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function zie(e,t,i,r){let n=i/r|0,s=i-n*r;return qie(t[n],s)===e}function T6(e){return e.BYTES_PER_ELEMENT*8}function Gie(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function qie(e,t){return!!(e&1<<t)}var p1=class{constructor(t,i,r,n,s,o,a,l){this.vertexData=t,this.vertexStride=i,this.indexData=r,this._components=n,this._componentAabbs3D=s,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=Qie,this._ray1=Yie,this._invDir=w(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=Kie,this._callback=E6,this.rayDirectionC=w(),this._componentIndexMap=null,this._bvh=new ag(n.count,this),this.componentIntersectionData=new Array(n.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){let{numComponents:t,planetCenterZ:i,minZGlobal:r}=this,n=new Float64Array(4*t),s=this._componentAabbs3D;for(let o=0;o<t;++o){let a=6*o,l=s[a+0],c=s[a+1],h=s[a+2],p=s[a+3],m=s[a+4],f=r/(h-i),g=r/(s[a+5]-i),_=Math.min(l*f,l*g),v=Math.min(c*f,c*g),b=Math.max(p*f,p*g),x=Math.max(m*f,m*g),E=4*o;n[E+0]=_,n[E+1]=v,n[E+2]=b,n[E+3]=x}return n}getAabbs2DLocal(){let{numComponents:t}=this,i=new Float64Array(4*t),r=this._componentAabbs3D;for(let n=0;n<t;++n){let s=6*n,o=r[s+0],a=r[s+1],l=r[s+3],c=r[s+4],h=4*n;i[h+0]=o,i[h+1]=a,i[h+2]=l,i[h+3]=c}return i}intersectRay(t,i,r,n,s,o,a){let{isVerticalRay:l}=a;this._ray0=t,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=n,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,gk(t,i,this._invDir),this._callback=s,this._bvh.intersectRay(t,i,l),this._callback=E6}intersectRange(t,i){let r=this._componentIndexMap,n=this._components,s=n.pickability,o=n.visibility;for(let a=t;a<i;++a){let l=r?r[a]:a;Tv(s,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(t){let i=this._components.offsets,r=i[t]/3;return i[t+1]/3-r}getComponentAabb3D(t,i){let r=this._componentAabbs3D,n=6*t;return i[0]=r[n],i[1]=r[n+1],i[2]=r[n+2],i[3]=r[n+3],i[4]=r[n+4],i[5]=r[n+5],i}_intersectComponent(t){if(!Tv(this._components.pickability,t))return;let i=this.getComponentAabb3D(t,Wie),r=!1,{localMode:n,_componentVerticalOffsets:s,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:h,_tolerance:p,rayDirectionC:m,componentIntersectionData:f}=this,{isVerticalRay:g}=this._intersectionOptions,_=this._components.offsets,v=ee($ie,a),b=ee(Zie,l),x=s?.[t]??0,E=x+(o?.offset??0);if(E!==0&&(n?(v[2]=a[2]-E,b[2]=l[2]-E,r=!0):o!=null&&(o.componentOffset=x)),o==null||r||E===0||o.applyToAabb(i),!_k(i,v,c,p))return;ai(m,b,v);let D=_[t]/3,M=_[t+1]/3,T=M-D,I=(K,F,R)=>{this._callback(K,F,t,R)},{vertexData:A,vertexStride:O,indexData:$,_intersectionOptions:H}=this,{normalRequired:k}=H;if(T>Xie){let K=f[t];K==null&&(K=new h1(t,A,O,$,D,M,this.geometryMinZ,h,n),f[t]=K),K.intersectRay(v,b,g,r?0:E,I,k)}else dN(v,m,D,M,$,A,O,r?0:E,h,k,I)}},Wie=Wc(),$ie=w(),Zie=w(),Qie=w(),Yie=w(),E6=()=>{},Kie=new Xp,Xie=40;var m1=class{constructor(t,i,r){this.viewingMode=t,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=w(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?A0(i.indices):kL(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(t,i){let r=this._ensureComponentAabbs(),n=6*t;return i[0]=r[n],i[1]=r[n+1],i[2]=r[n+2],i[3]=r[n+3],i[4]=r[n+4],i[5]=r[n+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,n,s,o,a,l){this.verticalOffset=n,this.componentVerticalOffsets=s;let{position:c}=o,h=ai(Jie,t,c),p=ai(ere,i,c),m=O0(tre,o.rotationScale);ts(h,h,m),ts(p,p,m);let f=Qc(rre,m);if(this.viewingMode===Se.Global){let _=this._planetCenter;Rs(_,c),ts(_,_,m)}let g=(_,v,b,x)=>{l(b,_,x?ts(ire,x,f):null,v)};this._intersectComponents(h,p,s,n,g,r,a)}_computePerComponentAabbs(){let t=this._aabb,i=.5*(t[0]+t[3]),r=.5*(t[1]+t[4]),n=.5*(t[2]+t[5]),s=this._components.count,o=R0(6*s),a=this._indices,l=this._positions,c=this._components.offsets,h=0,p=1/0,m=1/0,f=1/0,g=-1/0,_=-1/0,v=-1/0;for(let b=0;b<s;b++){let x=c[b],E=c[b+1],D=1/0,M=1/0,T=1/0,I=-1/0,A=-1/0,O=-1/0;if(x<E)for(let $=x;$<E;$++){let H=3*a[$],k=l[H],K=l[H+1],F=l[H+2];D=Math.min(D,k),M=Math.min(M,K),T=Math.min(T,F),I=Math.max(I,k),A=Math.max(A,K),O=Math.max(O,F)}else D=i,M=r,T=n,I=i,A=r,O=n;o[h++]=D,o[h++]=M,o[h++]=T,o[h++]=I,o[h++]=A,o[h++]=O,p=Math.min(p,D),m=Math.min(m,M),f=Math.min(f,T),g=Math.max(g,I),_=Math.max(_,A),v=Math.max(v,O)}return this._aabb[0]=p,this._aabb[1]=m,this._aabb[2]=f,this._aabb[3]=g,this._aabb[4]=_,this._aabb[5]=v,o}_intersectComponents(t,i,r,n,s,o,a){let l=this._componentBvh;l==null&&(l=new p1(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(t,i,r,n,s,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Se.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}},Jie=w(),ere=w(),tre=Nn(),ire=w(),rre=Nn();var f1=class{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}};var g1=class{constructor(t,i,r,n){this.vao=t,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}};function A6(e,t){let i=new qr,{eye:r,frustum:n,viewForward:s}=e;t.forAll(o=>{let a=o.offsetObb!=null?o.offsetObb:o.obb,l=ae(ai(Ks,a.center,r),s),c=a.projectedRadius(s);if(i.within(l-c)&&i.within(l+c))return;let h=lre(a,n);if(h===-1)return;if(h===0)return kc.far=l+c,kc.near=l-c,void i.union(kc);let p=_1.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<_1.length;o++){let a=_1.data[o];if(i.within(a.near)&&i.within(a.far))continue;kc.far=a.far,kc.near=1/0,are(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,nre,c=>{let h=sre;for(let p=0;p<R6&&c.length>0;p++){if(!(a.mask&1<<p))continue;ore(n[p],c,h);let m=c;c=h,h=m}for(let p=0;p<c.length;p+=3){Te($n,c.data[p],c.data[p+1],c.data[p+2]);let m=ae(ai($n,$n,r),s);kc.near=Math.min(kc.near,m)}})===0&&(kc.near=0),i.union(kc)}return _1.length=0,i}var _1=new Nt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),kc=new qr,$n=w(),lp=w(),nre=new Nt({deallocator:null}),sre=new Nt({deallocator:null});function ore(e,t,i){i.length=0;let r=t.length-3;hN($n,t,r);let n=$l(e,$n);n<=0&&(i.push($n[0]),i.push($n[1]),i.push($n[2]));let s=0,o=n;for(;s<r;s+=3){hN(lp,t,s);let a=$l(e,lp);o*a<0&&(ni($n,lp,$n,a/(a-o)),Zn(i,$n)),a<=0&&Zn(i,lp),o=a,ee($n,lp)}o*n<0&&(hN(lp,t,r),ni($n,lp,$n,n/(n-o)),Zn(i,$n))}function hN(e,t,i){return Te(e,t.data[i],t.data[i+1],t.data[i+2])}function Zn(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function are(e,t,i,r){dF(x6,e.quaternion),ai(Ks,t,e.center),RL(Ks,Ks,x6);let n=e.halfSize,s=8*((Ks[0]<-n[0]?-1:Ks[0]>n[0]?1:0)+3*(Ks[1]<-n[1]?-1:Ks[1]>n[1]?1:0)+9*(Ks[2]<-n[2]?-1:Ks[2]>n[2]?1:0)+13),o=D6[s];if(o===0)return o;BL(y1,e.quaternion),L0(y1,y1,e.halfSize);let a=(l,c)=>{let h=D6[s+c+1];return Te(l,((1&h)<<1)-1,(2&h)-1,((4&h)>>1)-1),ts(l,l,y1),he(l,e.center,l)};return i.length=0,Zn(i,a(pN,0)),Zn(i,a(M6,1)),Zn(i,a(Ks,2)),Zn(i,a(S6,3)),r(i),o===1||(i.length=0,Zn(i,pN),Zn(i,S6),Zn(i,a(Ks,4)),Zn(i,a(I6,5)),r(i),o===2||(i.length=0,Zn(i,pN),Zn(i,I6),Zn(i,a(Ks,6)),Zn(i,M6),r(i))),o}var D6=(()=>{let e=new Array(216),t=0,i=r=>{for(let n=0;n<r.length;n++)e[t+n]=r[n];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),R6=4;function lre(e,t){let i=0;for(let r=0;r<R6;r++){let n=e.intersectPlane(t[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}var y1=Nn(),x6=jg(),Ks=w(),pN=w(),M6=w(),S6=w(),I6=w();var v1=class{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryDepthRange(t){return this._objects.visibleObjects.length?A6(t,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(t=>t.renderable.material.hasEmissions)}hasHighlightOptions(t){return this._objects.hasHighlightOptions(t)}};var w1=class{constructor(){this.externalColor=Qi(),this.externalColorMixMode=Z0.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var b1=()=>W.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection"),C1=class{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._activeHighlightOptions=new Map,this._visible=new Nt,this._hidden=new Nt,this._renderSubmit=new v1(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new fH(t.rctx,2+(iu()?1:0))}destroy(){Xr(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(t=>t.destroy()),this._hidden.forAll(t=>t.destroy()),this._visible.clear(),this._hidden.clear()}createObject(t){let i=t.geometry,r=new u1(this._componentBufferManager,A0(i.componentOffsets)),n=this._createRenderable(t,r),s=new m1(this._viewingMode,i.positionData,r),o=new d1(t.transform,t.toMapSpace,t.obb.clone(),r,n,s);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(t){let i=t;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(t,i){let r=t;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(t){let i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=po(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){let r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){let r=t;r.componentData.visibility.reset(i),r.componentData.markVisibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.componentData.visibility.forEachComponent(i)}getComponentCount(t){let i=t,r=i.componentData.visibility.componentCount;return{visible:r,invisible:i.componentData.count-r}}setComponentData(t,i){let r=t,{renderable:n,componentData:s}=r,o=n.material,a=s.materialDataBuffer,l=s.materialDataIndices,c=new w1,h=a.textureBuffer,p=new Uint8Array(4),m=new Uint32Array(p.buffer),f=0,g=0,_=0,v=s.verticalOffsets,b=1/0,x=-1/0,E=!1,D=!1,M=0;for(let T=0;T<s.count;T++){i(T,c),f+=+(c.externalColor[3]<1),g+=+(c.externalColorMixMode===Z0.Replace&&c.externalColor[3]===1),_+=+c.castShadows,IF(c.externalColor,c.externalColorMixMode,p),p[2]=254&p[2]|+c.castShadows,h.setData(l[T],0,p[0],p[1],p[2],p[3]),E||=T>0&&M!==m[0],M=m[0],D||=c.elevationOffset!==0,D&&v==null&&(v=new Array(T).fill(0)),v!=null&&(v[T]=c.elevationOffset),b=Math.min(b,c.elevationOffset),x=Math.max(x,c.elevationOffset),AF(c.elevationOffset,p),h.setData(l[T],1,p[0],p[1],p[2],p[3]);let I=c.objectAndLayerIdColor;I!=null&&h.setData(l[T],2,I[0],I[1],I[2],I[3]),c.pickable!==Tv(s.pickability,T)&&(s.pickability=C6(s.pickability,s.count,T,c.pickable))}s.verticalOffsets=D?v:null,r.offsetObb=D?bF(r.obb,b,x,this._viewingMode,r.offsetObb??r.obb.clone()):null,E||D||iu()?(o.componentParameters=new W3,o.componentParameters.castShadows=mN(_,s.count),o.componentParameters.transparent=mN(f,s.count),o.componentParameters.opaqueOverride=mN(g,s.count),o.componentParameters.texture=h,h.updateTexture()):(o.componentParameters=new q3,o.componentParameters.castShadows=c.castShadows?hm.All:hm.None,o.componentParameters.externalColor=c.externalColor,o.componentParameters.externalColorMixMode=c.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(t,i,r,n=!1){t.intersectionGeometry.getComponentAabb(i,r);let s=t,o=s.componentData.verticalOffsets;if(n||o==null)return r;let a=o[i];if(this._viewingMode===Se.Local||a===0)return r[2]+=a,r[5]+=a,r;let l=lM(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(t,i,r,n){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||n.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);let s=t,o=s.componentData,a=o.count,l=o.verticalOffsets,c=s.intersectionGeometry,h=this._viewingMode===Se.Local,p=c.getComponentAabbs(),m=ure,f=1/0,g=-1/0;for(let _=0;_<a;_++){let v=6*_,b=l?.[_]??0,x=1/0,E=-1/0;if(h)x=p[v+2]+b+i,E=p[v+5]+b+i;else{if(m[0]=p[v],m[1]=p[v+1],m[2]=p[v+2],m[3]=p[v+3],m[4]=p[v+4],m[5]=p[v+5],b!==0){let I=lM(b);I.localOrigin=s.transform.position,I.applyToAabb(m)}let D=Math.max(Math.abs(m[3]),Math.abs(m[0])),M=Math.max(Math.abs(m[4]),Math.abs(m[1])),T=i+m[5]+r;n.expandElevationRangeValues(i+m[2],Math.sqrt(D*D+M*M+T*T)-r)}n.expandElevationRangeValues(x,E),f=Math.min(f,x),g=Math.max(g,E)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(t,i,r,n,s,o,a){let l=t,{transform:c}=l,{position:h}=c;return s!=null&&(s.localOrigin=h),l.intersectionGeometry.intersect(i,r,n,s,l.componentData.verticalOffsets,c,o,a)}addEdges(t,i,r,n,s){let o=t,{indices:a,positions:l}=o.intersectionGeometry,c=o.componentData.offsets;return i.addComponentObject(o,l,a,c,r,n,s)}async extractEdgeInformation(t,i,r){let n=t,s=n.componentData.visibility;if(s.allInvisible()){let{extractComponentsEdgeLocationsLayout:f}=await import("./chunk-FKI35EZK.js");return{buffer:f.createBuffer(0),origin:[0,0,0]}}let{indices:o,positions:a}=n.intersectionGeometry,l=n.componentData.offsets,{EdgeInputBufferLayout:c}=await import("./chunk-5XMH3XCD.js"),h=c.createBuffer(a.length/3);_F(h.position.typedBuffer,a,h.position.typedBufferStride,3),qL(h.position,h.position,n.transform.rotationScale),this._setComponentIndices(h.componentIndex,o,l);let p=h.count,m=this._computeVisibilityIndices(o,s,l,p);return{origin:hn(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:m,indicesLength:m.length,skipDeduplicate:!0,data:h,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let n=0;for(let s=0;s<r.length-1;s++){let o=r[s],a=r[s+1];for(let l=o;l<a;l++){let c=i?i[l]:l;t.set(c,n)}n++}}_computeVisibilityIndices(t,i,r,n){if(t&&i.allVisible())return t;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));let o=XN(t)?t?.BYTES_PER_ELEMENT===2||n<=65536?new Uint16Array(s):new Uint32Array(s):new Array(s),a=0;return i.forEachComponentRange((l,c)=>{let h=r[l],p=r[c];for(let m=h;m<p;m++)o[a++]=t?t[m]:m;return!0}),o}addComponentHighlight(t,i,r){let n=t.componentData,s=wp(n.componentHighlights,r,()=>new Uint32Array(n.count+1));{let o=this._activeHighlightOptions.get(r)??0;this._activeHighlightOptions.set(r,o+1)}s[i]++===0&&(n.markHighlightsDirty(),this._notifyDirty()),s[n.count]++}removeComponentHighlight(t,i,r){let{componentData:n}=t,s=n.componentHighlights.get(r);if(s===void 0)return void b1().warn("Removing non-existing highlight.");let o=s[i];if(o===0)return void b1().warn("Removing non-existing highlight.");this._removeActiveHighlight(r);let a=s[n.count];if(o>1)return s[i]=o-1,void(s[n.count]=a-1);s[i]=0,a===1?n.componentHighlights.delete(r):s[n.count]=a-1,n.markHighlightsDirty(),this._notifyDirty()}_removeActiveHighlight(t,i=1){let r=this._activeHighlightOptions.get(t);if(r===void 0)b1().warn("Removing non-existing highlight.");else{let n=r-i;n<0&&b1().warn("Removing non-existing highlight."),n<=0?this._activeHighlightOptions.delete(t):this._activeHighlightOptions.set(t,n)}}clearHighlights(t){let{componentData:i}=t,{componentHighlights:r}=i;if(r.size>0){for(let n of r)this._removeActiveHighlight(n[0],n[1][i.count]);r.clear(),i.markHighlightsDirty(),this._notifyDirty()}}hasHighlightOptions(t){return this._activeHighlightOptions.has(t)}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(t,i){let r=this._renderManager.rctx,n=t.geometry,s=n.vertices.layoutParameters,o=wr.createVertex(r,Jr.STATIC_DRAW,n.vertices.data),a=n.indices?wr.createIndex(r,Jr.STATIC_DRAW,n.indices):null,l=is(O3(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<i.count;_++){let v=i.offsets[_],b=i.offsets[_+1],x=i.materialDataIndices[_];if(n.indices!=null)for(let E=v;E<b;E++)c[n.indices[E]]=x;else for(let E=v;E<b;E++)c[E]=x}let h=wr.createVertex(r,Jr.STATIC_DRAW,c.buffer),p=new G3(t.transform,t.toMapSpace),m=new jF(r,j3,new Map([["data",l],["componentIndices",cre]]),new Map([["data",o],["componentIndices",h]]),a),f=new g1(m,Jt.TRIANGLES,s,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+h.usedMemory+(a!=null?a.usedMemory:0)};return new f1(p,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}},cre=is(Ps().u16(yi.COMPONENTINDEX));function mN(e,t){return e===t?hm.All:e===0?hm.None:hm.Some}var ure=Wc();var T1=class{constructor(t,i,r,n,s){this.rctx=t,this.viewingMode=i,this.stippleTextures=r,this.waterTextures=n,this.markerTextures=s}get spherical(){return this.viewingMode===Se.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}};var lg=class extends ss{constructor(e){super(e),this.consumes={required:["olid"]},this.produces="olid"}destroy(){}render(e){let t=e.find(({name:r})=>r==="olid"),i=this.renderingContext;return i.bindFramebuffer(t.fbo),i.clearFramebuffer(mn,!0,!0),this.view._stage.renderer.renderAllGeometry(oe.ObjectAndLayerIdColor),i.clear(Ti.DEPTH|Ti.STENCIL),this.view._stage.renderer.renderHUD(Ln.NotOccluded),t}};u([d()],lg.prototype,"consumes",void 0),u([d()],lg.prototype,"produces",void 0),lg=u([C("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],lg);var cg=class extends ss{constructor(e){super(e),this.consumes={required:[Oe.OCCLUDED]},this.produces=Oe.OCCLUDED,this._blit=new ww(e.view._stage.renderView.techniques,Yl.PremultipliedAlpha)}precompile(){let e=this.view._stage.renderer;e.plugins.plugins.forAll(t=>{e.precompileSlots(t,me.OCCLUDED_TERRAIN,me.TRANSPARENT_OCCLUDER_MATERIAL),t.material&&e.precompileOccludedSlots(t,P6)})}render(e){let t=e.find(({name:n})=>n===this.produces),i=this.view._stage.renderer,r=0;if(Vc.clear(),i.plugins.plugins.forAll(n=>{n.material&&n.queryRenderOccludedState(hr.OccludeAndTransparentStencil)&&(r|=hr.OccludeAndTransparentStencil,Vc.push(n))}),Vc.length>0&&(i.renderSlots(Vc,me.OCCLUDER_MATERIAL),r&hr.OccludeAndTransparentStencil&&this._renderAndComposite(t,.5,()=>i.renderSlots(Vc,me.TRANSPARENT_OCCLUDER_MATERIAL),!1,!1)),Vc.clear(),i.plugins.plugins.forAll(n=>{if(!n.material)return;let s=n.queryRenderOccludedState(hr.OccludeAndTransparent),o=n.queryRenderOccludedState(hr.Transparent),a=n.queryRenderOccludedState(hr.Opaque);(s||o||a)&&(r|=s?hr.OccludeAndTransparent:o?hr.Transparent:hr.Opaque,Vc.push(n))}),r|=i.plugins.renderOccludedFlags,!r)return t;for(let n of P6)r&n&&this._renderAndComposite(t,n===hr.Opaque?1:.5,()=>i.renderOccludedSlots(Vc,n),!0,W0.OutlineVisualElementMask);return Vc.clear(),t}_renderAndComposite(e,t,i,r,n){let s=this.renderingContext,{width:o,height:a}=e.fbo,l=this.fboCache.acquire(o,a,"tmp color"),c=r?this.fboCache.acquireDepth(br.DEPTH_STENCIL_TEXTURE,o,a,"tmp depth"):e.getAttachment(Pd);l.attachDepth(c),s.bindFramebuffer(l.fbo),s.clearFramebuffer(mn,r,n),i(),l.detachDepth(),this._blit.blend(s,l,e,this.bindParameters,t),r&&c.release(),l.release()}};u([d()],cg.prototype,"consumes",void 0),u([d()],cg.prototype,"produces",void 0),cg=u([C("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],cg);var Vc=new Nt,P6=[hr.OccludeAndTransparent,hr.Transparent,hr.Opaque];var Ev=class extends ft{constructor(t,i){super(t,i,new mt(_H,()=>import("./chunk-XNVWROXJ.js")))}initializePipeline(){return Tt({blending:za(ei.ONE,ei.ZERO,ei.ONE_MINUS_SRC_COLOR,ei.ONE),depthTest:{func:Ei.ALWAYS},colorWrite:St})}};var E1=class extends Uw{constructor(){super(...arguments),this.hazeStrength=1}},ug=class extends ft{constructor(t,i){super(t,i,new mt(yH,()=>import("./chunk-RM33HC4G.js")))}initializePipeline(t){return t.reduced?Tt({blending:Zp,depthTest:{func:Ei.ALWAYS},colorWrite:St}):Tt({blending:za(ei.ONE,ei.ZERO,ei.ONE_MINUS_SRC_COLOR,ei.ONE),colorWrite:St})}};var cp=class extends ou{constructor(){super(...arguments),this.reduced=!1}};u([Zt()],cp.prototype,"reduced",void 0);var D1=class extends ap{constructor(e){super(e),this._compositingPassParameters=new gH,this._passParameters=new E1,this._hazeConfiguration=new cp,this._vao=null,this.requireGeometryDepth=!0,this._oldAmount=1,this._newAmount=1,this._amount=this._newAmount;let t=e.view._stage.renderView.techniques;t.precompile(ug,new cp);let i=new cp;i.reduced=!0,t.precompile(ug,i),t.precompile(Ev)}initialize(){this.addHandles([S(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),Ce),S(()=>this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,e=>this._fade(e),Ce),S(()=>this.view.environment.weather.type,e=>this._newAmount=e==="rainy"?0:1,Ce),S(()=>this.view._stage.renderer?.fullResolutionAtmosphere,e=>this._hazeConfiguration.reduced=!e,Ce)])}_fade(e){e>=1?(this._amount=this._newAmount,this._oldAmount=this._newAmount):this._amount=e<=0?this._oldAmount:Xe(this._oldAmount,this._newAmount,e)}destroy(){this._vao=We(this._vao)}render(e){let t=e.find(({name:g})=>g===Oe.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return t;let i=this.renderingContext;this._vao??=gn(i,mu.Pos2Tex);let r=this.techniques.get(ug,this._hazeConfiguration);if(!r.compiled)return t;let n=t.getAttachment(i.gl.DEPTH_STENCIL_ATTACHMENT);if(this._update(),!this._hazeConfiguration.reduced)return t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),t.attachDepth(n),t;let s=this.techniques.get(Ev);if(!s.compiled)return t;let o=i.getViewport(),a=this.camera,l=xe(a.eye)-dn.radius,c,h=dn.atmosphereHeight;if(l<h){let g=Math.min(1,Math.max(0,l/h));c=Xe(.4,.5,g)}else{let g=Math.min(1,Math.max(0,(l-h)/(15*h)));c=Xe(.5,1,g)}let p=su(Math.round(c*a.fullViewport[2])),m=su(Math.round(c*a.fullViewport[3]));i.setViewport(0,0,p,m);let f=this.fboCache.acquire(p,m,"haze",Pi.RGBA);return i.bindFramebuffer(f.fbo),i.clearFramebuffer([0,0,0,1],!0,!0),i.bindTechnique(r,this.bindParameters,this._passParameters),this._renderCommon(i),i.setViewport(o.x,o.y,o.width,o.height),this._compositingPassParameters.color=f.getTexture(),t.detachDepth(),i.bindFramebuffer(t.fbo),i.bindTechnique(s,this.bindParameters,this._compositingPassParameters),i.screen.draw(),t.attachDepth(n),f.release(),t}_renderCommon(e){this._vao!=null&&(e.bindVAO(this._vao),e.drawArrays(Jt.TRIANGLE_STRIP,0,4))}_update(){let e=this.bindParameters.camera,t=Ar(e.eye),i=Math.sqrt(t),r=t-this._passParameters.radii[1]*this._passParameters.radii[1],n=q((i-this._passParameters.radii[0])/dn.atmosphereHeight,0,1);ho(this._passParameters.heightParameters,i,t,r,n);let s=this.view.basemapTerrain?.getLowerBoundRadius()??0;es(this._passParameters.radii,s,s+dn.atmosphereHeight),this._passParameters.hazeStrength=Xe(Xe(.6,1,Bl(9500,10500,i-dn.radius)),1,this._amount)}};D1=u([C("esri.views.3d.webgl-engine.effects.haze.Haze")],D1);var x1=class extends J0{constructor(){super(...arguments),this.shadowColor=pn(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},Dv=class extends ft{constructor(t,i){super(t,i,new mt(vH,()=>import("./chunk-SU3BDOLS.js"))),this.primitiveType=Jt.TRIANGLE_STRIP}initializePipeline(){return Tt({blending:Ga,colorWrite:St,depthTest:null,depthWrite:null})}};var dre=1/512,hre=4e4,pre=5e4,up=class extends ss{constructor(e){super(e),this.produces=ti.COMPOSITE,this.consumes={required:[ti.COMPOSITE,"highlights"]},this._passParameters=new x1,this._maxOpacity=1,this._shadowDifference=.2}initialize(){this.addHandles([S(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??sk,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Ce),S(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??ok,this._updateOccludedShadowOpacity(),this._ensureMaxOpacity()},Ce),S(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=Hp(e??nk),this._ensureMaxOpacity()},Ce)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){let e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3],this.requestRender(Pe.UPDATE)}precompile(){this.techniques.precompile(Dv)}render(e){let t=e.find(({name:n})=>n===ti.COMPOSITE),i=this.bindParameters;if(!i.shadowHighlightsVisible||!i.depth||!this._ensureIfVisible(i.camera,i.lighting.mainLight.direction))return t;let r=this.techniques.get(Dv);if(r.compiled){this._passParameters.highlight=e.find(({name:s})=>s==="highlights")?.getTexture(),this._passParameters.origin=i.camera.center;let n=this.renderingContext;n.bindFramebuffer(t.fbo),n.bindTechnique(r,i,this._passParameters),n.screen.draw()}else this.requestRender(Pe.UPDATE);return t}_ensureIfVisible(e,t){this._passParameters.opacityElevation=1-Bl(hre,pre,e.relativeElevation);let i=this.viewingMode===Se.Global?ne(O6,e.center):Te(O6,0,0,1),r=ae(i,t);return this._passParameters.dayNightTerminator=Bl(0,1,q(30*r,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=dre}};u([d()],up.prototype,"produces",void 0),u([d()],up.prototype,"consumes",void 0),u([d({constructOnly:!0})],up.prototype,"viewingMode",void 0),up=u([C("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],up);var O6=w();var xv=class extends ft{constructor(t,i){super(t,i,new mt(bH,()=>import("./chunk-IMNPXFMM.js")))}initializePipeline(){return Tt({blending:Qp,depthTest:null,depthWrite:null,colorWrite:St})}};var gd=class extends ss{constructor(){super(...arguments),this.produces=Oe.MAGNIFIER,this.consumes={required:[Oe.MAGNIFIER]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new wH,this._vao=null,this._magnifier=null,this._tmpScreenPoint=Kt(),this._tmpRenderPoint=W2()}initialize(){this.addHandles([S(()=>this.view.magnifier,e=>this._update(e),Ce)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;let t=()=>{let i=this._validMagnifier;i?(this._loadResources(i),this.produces=Oe.MAGNIFIER):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(S(()=>this._magnifier?.version,t)),t()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=We(this._vao)}_disposeTextures(){this._passParameters.mask=We(this._passParameters.mask),this._passParameters.overlay=We(this._passParameters.overlay),this._passParameters.input=We(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(xv)}render(e){let t=this._validMagnifier,i=e.find(({name:v})=>v===Oe.MAGNIFIER);if(t==null)return i;if(this._imageSources==null)return this.requestRender(Pe.UPDATE),i;let r=this.renderingContext,n=this.camera.pixelRatio,s=Math.ceil(n*t.size);this._vao??=gn(r,mu.Pos2,ja,0,1);let o=this.techniques.get(xv);if(this._ensureTextureResources(r,s),!o.compiled||!this._passParameters.input)return this.requestRender(Pe.UPDATE),i;let a=Math.ceil(1/this._factor*s),l=this._passParameters.input;l.resize(a,a),Xo(t.position,this._tmpScreenPoint);let c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),h=this.camera.fullWidth,p=this.camera.fullHeight,m=.5*a,f=.5*a;c[0]=q(c[0],m,h-m-1),c[1]=q(c[1],f,p-f-1);let g=Math.floor(c[0]-m),_=Math.floor(c[1]-f);return r.bindFramebuffer(i.fbo),o.program.bindTexture("textureInput",l),r.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,_,a,a,0),this._passParameters.magnifier=t,r.bindTechnique(o,this.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Jt.TRIANGLE_STRIP,0,4),i}_loadResources(e){let{maskUrl:t,overlayUrl:i}=e;this._imageLoadTask?.maskUrl===t&&this._imageLoadTask?.overlayUrl===i||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:un(async r=>{let n=t==null||i==null?yV(r):null,s=t!=null?nu(t,{signal:r}):n.then(a=>a.mask),o=i!=null?nu(i,{signal:r}):n.then(a=>a.overlay);this._imageSources={mask:await s,overlay:await o}})})}_ensureTextureResources(e,t){if(this._imageSources==null||this._passParameters.size===t&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=t,this._imageSources.overlay.height=this._imageSources.mask.height=t;let i=new vi;i.internalFormat=mi.RGBA,i.wrapMode=ji.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!u0(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Di(e,i,this._imageSources.overlay),i.pixelFormat=i.internalFormat=mi.ALPHA,i.preMultiplyAlpha=!1,this._passParameters.mask=new Di(e,i,this._imageSources.mask),i.pixelFormat=i.internalFormat=mi.RGBA,i.flipped=!1,this._passParameters.input=new Di(e,i)}};u([d()],gd.prototype,"produces",void 0),u([d()],gd.prototype,"consumes",void 0),u([d()],gd.prototype,"_imageSources",void 0),u([d()],gd.prototype,"_imageLoadTask",void 0),gd=u([C("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],gd);var Mv=class extends ft{constructor(t,i){super(t,i,new mt(CH,()=>import("./chunk-D77IKVLK.js")))}initializePipeline(){return Tt({colorWrite:St})}};var Sv=class extends ft{constructor(t,i){super(t,i,new mt(TH,()=>import("./chunk-ZFM2JEX4.js")))}initializePipeline(){return Tt({colorWrite:St})}};var Iv=class extends ft{constructor(t,i){super(t,i,new mt(EH,()=>import("./chunk-CQD2GOCN.js")))}initializePipeline(){return Tt({colorWrite:St})}};var M1=class extends ru{};var _d=class extends ss{constructor(e){super(e),this.produces="disabled",this.consumes={required:[Oe.ANTIALIASING],optional:[ti.COMPOSITE]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new M1}initialize(){this.addHandles([S(()=>this.isEnabled(),e=>e?this.enable():this.disable(),Ce)])}async enable(){if(this.produces=Oe.ANTIALIASING,this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;let e=this._abortController.signal;try{let t=await import("./chunk-TI47PP3Q.js");await this._loadTextures(t,e),this.requestRender(Pe.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,t){Bt(t);let[i,r]=await Promise.allSettled([nu(e.areaTexture,{signal:t}),nu(e.searchTexure,{signal:t})]);if(Bt(t),i.status!=="fulfilled"||r.status!=="fulfilled")return;let n=this.renderingContext;this._areaTexture=N6(n,On.LINEAR,mi.RGB,i.value),this._searchTexture=N6(n,On.NEAREST,mi.LUMINANCE,r.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=We(this._searchTexture),this._areaTexture=We(this._areaTexture)}precompile(){this.techniques.precompile(Iv),this.techniques.precompile(Mv),this.techniques.precompile(Sv)}render(e){let t=e.find(({name:m})=>m===Oe.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender(Pe.UPDATE),t;let i=this.techniques.get(Iv),r=this.techniques.get(Mv),n=this.techniques.get(Sv);if(!i.compiled||!r.compiled||!n.compiled)return this.requestRender(Pe.UPDATE),t;let s=e.find(({name:m})=>m===ti.COMPOSITE);if(!s)return t;let o=s.fbo.width,a=s.fbo.height,l=this.renderingContext;l.setViewport(0,0,o,a);let c=this.fboCache.acquire(o,a,"smaa edges",Pi.RG);l.bindFramebuffer(c.fbo),l.setClearColor(0,0,0,1),l.clear(Ti.COLOR),this._smaaParameters.color=s.getTexture();let h=this.bindParameters;l.bindTechnique(i,h,this._smaaParameters),l.screen.draw();let p=this.fboCache.acquire(o,a,"smaa blend");return l.bindFramebuffer(p.fbo),l.setClearColor(0,0,1,1),l.clear(Ti.COLOR),this._smaaParameters.inputTexture=c.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,l.bindTechnique(r,h,this._smaaParameters),l.screen.draw(),c.release(),l.bindFramebuffer(t.fbo),l.setClearColor(0,1,0,1),l.clear(Ti.COLOR),this._smaaParameters.inputTexture=p.getTexture(),l.bindTechnique(n,h,this._smaaParameters),l.screen.draw(),p.release(),t}};function N6(e,t,i,r){let n=new vi;return n.pixelFormat=i,n.wrapMode=ji.CLAMP_TO_EDGE,n.width=r.width,n.height=r.height,n.samplingMode=t,new Di(e,n,r)}u([d()],_d.prototype,"produces",void 0),u([d()],_d.prototype,"consumes",void 0),u([d({constructOnly:!0})],_d.prototype,"isEnabled",void 0),u([d()],_d.prototype,"_abortController",void 0),_d=u([C("esri.views.3d.webgl-engine.effects.smaa.SMAA")],_d);var S1=class extends ru{constructor(){super(...arguments),this.modelMatrix=$t()}},Av=class extends ft{constructor(t,i){super(t,i,new mt(DH,()=>import("./chunk-LVDOV23D.js")))}initializePipeline(){return Tt({blending:Ga,depthTest:{func:Ei.LEQUAL},colorWrite:St})}};var I1=class extends In{constructor(){super(...arguments),this._starData=null,this._loadDataTask=null,this._numPoints=0,this._passParameters=new S1}initialize(){this.addHandles([S(()=>this.view.environment.starsEnabled,e=>e?this._enable():this._disable(),Re),S(()=>this.view.environment.lighting.type==="virtual"?null:this.view.environment.lighting.date,e=>this._update(e),Ce)])}_enable(){super._enable(),this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=Mr(this._loadDataTask),this._numPoints=0,this._vao=We(this._vao),this._starData=null}precompile(){this.techniques.precompile(Av)}render(e){let t=e.find(({name:n})=>n===Oe.OPAQUE_ENVIRONMENT),i=this.renderingContext;if(this.loading)return this.requestRender(Pe.UPDATE),t;if(!this._starData)return t;this._vao??=this._ensureResources(this._starData,i);let r=this.techniques.get(Av);return r.compiled?(i.bindTechnique(r,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Jt.POINTS,0,this._numPoints),t):(this.requestRender(Pe.UPDATE),t)}_ensureResources(e,t){return this._numPoints=e.byteLength/F6,mre(t,new Float32Array(e,0,2*this._numPoints),new Uint8Array(e,2*this._numPoints*4,this._numPoints),this._numPoints)}_update(e){if(!e)return;let t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*fre(e),r=Ap(this._passParameters.modelMatrix,bre);kg(r,r,-i*Math.PI),lo(r,wre,r),kg(r,r,-t*Math.PI),this.requestRender(Pe.UPDATE)}_createLoadDataTask(){if(this._starData)return null;let e=un(async t=>{let{data:i}=await y2("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});gre(i),this._starData=i});return e.promise.catch(t=>{Gr(t)||W.getLogger(this).error(t)}).then(()=>{this.destroyed||this.requestRender(Pe.UPDATE)}),e}};function mre(e,t,i,r){let n=L6.createBuffer(r),s=n.position,o=n.color,a=n.size;for(let l=0;l<r;l++){let c=t[2*l],h=t[2*l+1];s.set(l,0,-Math.cos(c)*Math.sin(h)),s.set(l,1,-Math.sin(c)*Math.sin(h)),s.set(l,2,-Math.cos(h));let p=yre(i[l]),m=_re(vre[p[1]]);o.set(l,0,255*m[0]),o.set(l,1,255*m[1]),o.set(l,2,255*m[2]),o.set(l,3,255),a.set(l,p[0])}return new ns(e,ja,new Map([["geometry",is(L6)]]),new Map([["geometry",wr.createVertex(e,Jr.STATIC_DRAW,n.buffer)]]))}function fre(e){let t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}function gre(e){if(!e)throw new Be("stars:no-data-received","Failed to create stars because star catalogue is missing");let t=e.byteLength/F6;if(t%1!=0||t>5e4||t<5e3)throw new Be("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function _re(e){return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function yre(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}I1=u([C("esri.views.3d.webgl-engine.effects.stars.Stars")],I1);var vre=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],wre=Kx(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),bre=Kx(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),F6=9,L6=Ps().vec3f(yi.POSITION).vec4u8(yi.COLOR).f32(yi.SIZE);var Rv=class extends ft{constructor(t,i){super(t,i,new mt(MH,()=>import("./chunk-SYPJJZWA.js")))}initializePipeline(){return Tt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};var A1=class{constructor(t,i){this._rctx=t,this._techniques=i,this._configuration=new CV,this._passParameters=new TV,this._hudParameters=new xH,this._configuration.blitMode=Yl.PremultipliedAlpha,this._techniques.precompile(rm,this._configuration),this._configuration.hasOpacityFactor=!0,this._techniques.precompile(rm,this._configuration),this._configuration.hasOpacityFactor=!1,this._configuration.blitMode=Yl.Alpha,this._techniques.precompile(rm,this._configuration),this._configuration.blitMode=Yl.Depth,this._techniques.precompile(rm,this._configuration),this._techniques.precompile(Rv)}compositeHUD(t,i){this._hudParameters.texture=i;let r=this._techniques.get(Rv);this._rctx.bindTechnique(r,t,this._hudParameters),this._rctx.screen.draw()}compositePreMultipliedAlpha(t,i,r=1){this._composite(t,i,Yl.PremultipliedAlpha,r)}composite(t,i){this._composite(t,i,Yl.Alpha,1)}blitDepthToLinearDepth(t,i){this._composite(t,i,Yl.Depth,1)}_composite(t,i,r,n){this._configuration.blitMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;let s=this._techniques.get(rm,this._configuration);this._rctx.bindTechnique(s,t,this._passParameters),this._rctx.screen.draw()}};var R1=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Qx(new ArrayBuffer(4)),this._layerToOidToColor=new Zg,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Zg,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,i,r,n,s,o=null,a=null,l=null){t&&i&&r&&n&&(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),s&&this._layerUidToGraphicsUidToObjectId.set(n,i,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(t){let i=this.getObjectAndLayerIdColorArray(t);return pn(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;let i=this._layerUidToPopupEnabled.get(t.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;let r=this._layerUidToGraphicsUidToObjectId.get(t.layerUid,t.graphicUid)?.objectId;if(!r)return this.colorZero;let n=this._layerToOidToColor.get(t.layerUid,r);if(!n){if(Ct("enable-feature:objectAndLayerId-screenshot-testing"))n=r;else for(;!n;){let o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(t.layerUid,r,n),this._colorToUID.set(n,t)}let s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new Qx(s)}getColorToObjectAndLayerIdMapping(){let t=new Map;for(let[i,r]of this._colorToUID.entries()){let n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),s=this._layerUidToId.get(r.layerUid);n&&s&&t.set(i,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:n.objectId,lid:s,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",olid:n.objectId,lid:s})}return t}};var dg=class{constructor(t,i){this.key=t,this.free=i,this.incarnation=0,this._refCount=1}retain(t=1){this._refCount+=t}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment "${this.name}" in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}},Ll;(function(e){e[e.FBO=0]="FBO",e[e.DEPTH=1]="DEPTH",e[e.COLOR=2]="COLOR"})(Ll||(Ll={}));var hg=class extends dg{constructor(t,i,r){super(t,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get cachedMemory(){return this.attachment.usedMemory}};var P1=class extends hg{constructor(t,i,r){super(t,i,r),this.attachment=i,this.type=Ll.COLOR}};var Pv=class extends hg{constructor(){super(...arguments),this.type=Ll.DEPTH}};function k6(e){return e?.attachment.type===XF.Texture}var Ov=class extends dg{constructor(t,i,r,n,s,o){super(t,o),this.type=Ll.FBO,this._colors=new Map,this._name=ti.COMPOSITE,this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=n,this.acquireColor=s}dispose(){this.fbo?.dispose()}get cachedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(t){this._name=t}getTexture(t=cr.COLOR_ATTACHMENT0){return t===Pd?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(t)}getAttachment(t=cr.COLOR_ATTACHMENT0){return t===Pd?this._depth:this._colors.get(t)}hasAttachment(t){return l0(this._colors,i=>i.name===t)}attachDepth(t){return t?.retain(),this.detachDepth(),t&&this.fbo?.attachDepthStencil(t.attachment),this._depth=t,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=ki(this._depth)}obtainDepthTexture(){let t=this._depth;return k6(t)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,t):null}attachColor(t,i){return t.retain(),this.detachColor(i),this.fbo?.attachColorTexture(t.attachment,i),this._colors.set(i,t),this}detachColor(t){this.fbo?.detachColorTexture(t);let i=this._colors.get(t);this._colors.delete(t),i?.release()}detachAll(){this._colors.forEach((t,i)=>this.detachColor(i)),this.detachDepth()}};var pg=class{constructor(t,i){this._last=new Nt,this._incarnation=0,this._cache=new Bo(t,i)}destroy(){this._last?.forAll(t=>t.dispose()),this._last=null,this._cache.destroy()}set interactive(t){t&&!this._last?this._last=new Nt:t||(this._last?.forAll(i=>i.dispose()),this._last=null)}clean(){this._last?.filterInPlace(t=>!(t.incarnation<this._incarnation)||(this._cache.put(t.key,t),!1))}frame(){++this._incarnation}pop(t){if(this._last){let i=this._last.find(r=>r.key===t);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(t)}put(t){t.incarnation=this._incarnation,this._last?this._last.push(t):this._cache.put(t.key,t)}get usedMemory(){return this._last?.reduce((t,i)=>t+i.cachedMemory,0)??0}};var k1=class{constructor(t){this.rctx=t,this._acquired=new Set,this._cache=new pg(t.newCache,"FBOCache"),this._depthCache=new pg(t.newCache,"DepthAttachmentCache"),this._colorCache=new pg(t.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback?.()}frameEnd(){let t=this.debugCallback;t&&this._acquired.forEach(i=>i.type===Ll.FBO&&t(i.name,i.fbo,i.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((t,i)=>t+("getTexture"in i?i.getTexture()?.usedMemory??0:i.cachedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(t){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=t}acquire(t,i,r,n=Pi.RGBA){let s=fN(n,t,i),o=this._cache.pop(s);if(o){o.retain(),o.setName(r);let a=this.rctx.getBoundFramebufferObject();if(this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([cr.COLOR_ATTACHMENT0]),!o.fbo)throw new Be("attempt to use a not existing framebuffer");this.rctx.unbindTexture(o.fbo.colorTexture),this.rctx.bindFramebuffer(a)}else o=new Ov(s,r,new $a(this.rctx,be(ie({},V6[n]),{width:t,height:i})),a=>{a??=br.DEPTH_STENCIL_TEXTURE;let l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l,c)=>{l??=Pi.RGBA;let h=this._acquireColor(l,t,i,c??`${o.name} color ${a}`);return this.rctx.unbindTexture(h.attachment),o.attachColor(h,a),h.release(),o},()=>{this.debugCallback?.(o.name,o.fbo,o.numberOfColorAttachments),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(t,i,r,n){return this._acquireDepth(t,i,r,n)}_acquireDepth(t,i,r,n){let s=fN(t,i,r),o=this._depthCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);let a=t===br.DEPTH_STENCIL_TEXTURE?new Pv(s,new Di(this.rctx,be(ie({},H6[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Pv(s,new sV(this.rctx,be(ie({},H6[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=n,this._trackHandle(a)}_acquireColor(t,i,r,n){let s=fN(t,i,r),o=this._colorCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);let a=new P1(s,new Di(this.rctx,be(ie({},V6[t]),{width:i,height:r})),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=n,this._trackHandle(a)}_trackHandle(t){return this._acquired.add(t),t}},Fl=new Ov("default","default",null,()=>Fl,()=>Fl,()=>{});function fN(e,t,i){return`${e}x${t}x${i}`}Fl.release=()=>!1;var O1=new vi;O1.pixelFormat=mi.RED,O1.internalFormat=Zc.R8,O1.wrapMode=ji.CLAMP_TO_EDGE;var N1=new vi;N1.pixelFormat=mi.RG,N1.internalFormat=Zc.RG8,N1.wrapMode=ji.CLAMP_TO_EDGE;var L1=new vi;L1.internalFormat=Zc.RGBA4,L1.dataType=Ba.UNSIGNED_SHORT_4_4_4_4,L1.wrapMode=ji.CLAMP_TO_EDGE;var B6=new vi;B6.wrapMode=ji.CLAMP_TO_EDGE;var Nv=new vi;Nv.wrapMode=ji.CLAMP_TO_EDGE,Nv.samplingMode=On.LINEAR_MIPMAP_LINEAR,Nv.hasMipmap=!0,Nv.maxAnisotropy=8;var Lv=new vi;Lv.pixelFormat=mi.RED,Lv.dataType=Ba.HALF_FLOAT,Lv.internalFormat=Zc.R16F,Lv.samplingMode=On.NEAREST;var F1=new vi;F1.dataType=Ba.HALF_FLOAT,F1.internalFormat=Zc.RGBA16F,F1.samplingMode=On.NEAREST;var V6={[Pi.RED]:O1,[Pi.RG]:N1,[Pi.RGBA4]:L1,[Pi.RGBA]:B6,[Pi.RGBA_MIPMAP]:Nv,[Pi.R16F]:Lv,[Pi.RGBA16F]:F1},mg=new vi;mg.pixelFormat=mi.DEPTH_STENCIL,mg.dataType=Ba.UNSIGNED_INT_24_8,mg.samplingMode=On.NEAREST,mg.wrapMode=ji.CLAMP_TO_EDGE,mg.internalFormat=mi.DEPTH24_STENCIL8;var H6={[br.DEPTH_STENCIL_TEXTURE]:mg,[br.DEPTH16_BUFFER]:new dw(I0.DEPTH_COMPONENT16,4)};var fg;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(fg||(fg={}));var qo=class{constructor(t,i,r=fg.FrontToBack){this._rctx=t,this._techniques=i,this._sorting=r,this._draws=new Nt({allocator:n=>n??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,n,s){let o=this._draws.pushNew();o.geometry=i,o.geometryRanges=r,o.material=t,o.depthSquaredHint=n,o.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0,o.highlightName=s}acquire(t,i){return this._draws.map(r=>r.material.acquireTechnique(this._techniques,t,i,r.geometry.parameters))}dispatch(t,i,r){let n=this._rctx;this._previouslyBoundDraw.clear();let s=null,o=this._draws.length,a=i.highlight?.name;for(let l=0;l<o;l++){let c=this._draws.data[l];if(t.identifier===Kl.Highlight){let b=c.highlightName;if(b){if(b!==a)continue}else if(!a||!i.overlay?.hasHighlightOptions(a))continue}let h=r[l];h===s&&i.oitPass===Ns.NONE||(n.bindTechnique(h,i,t),s=h);let{geometryRanges:p,indexType:m,geometry:f,material:g}=c;n.bindVAO(f.vao),this._previouslyBoundDraw.get(h)!==g&&(h.program.bindDraw(i,t,g),this._previouslyBoundDraw.set(h,g));let _=p.length,{primitiveType:v}=f;for(let b=0;b<_;b+=2){let x=p[b],E=p[b+1];if(m!==0){let D=V1.get(m);n.drawElements(v,E,m,x*D)}else n.drawArrays(v,x,E)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){let t=this._sorting===fg.FrontToBack?1:-1;this._draws.sort((i,r)=>{let n=t*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}},V1=new Map;V1.set(Rd.UNSIGNED_BYTE,1),V1.set(Rd.UNSIGNED_SHORT,2),V1.set(Rd.UNSIGNED_INT,4);var H1=class{constructor(t){let i=t.renderContext.rctx,r=t.techniques;this.opaque=new qo(i,r),this.transparent=new qo(i,r,fg.BackToFront),this.integratedMesh=new qo(i,r),this.shadowMap=new qo(i,r),this.highlight=new qo(i,r),this.highlightIntegratedMesh=new qo(i,r),this.highlightShadowMap=new qo(i,r),this.viewshedShadowMap=new qo(i,r),this.nonHighlightShadowMap=new qo(i,r)}},gg=class extends kF{constructor(){super(...arguments),this.slicePlaneLocalOrigin=w(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var B1=class extends gg{constructor(){super(...arguments),this.identifier=Kl.Material,this.output=oe.Color,this.transparent=!1}},U1=class extends gg{constructor(){super(...arguments),this.identifier=Kl.ShadowMap}},j1=class extends gg{constructor(){super(...arguments),this.identifier=Kl.Highlight}},z1=class extends gg{constructor(){super(...arguments),this.identifier=Kl.ViewshedShadowMap}};var G1=class extends qp{constructor(){super({}),this.produces=new Map([[me.OPAQUE_MATERIAL,e=>this._produces(e,me.OPAQUE_MATERIAL)],[me.TRANSPARENT_MATERIAL,e=>this._produces(e,me.TRANSPARENT_MATERIAL)],[me.INTEGRATED_MESH,e=>this._produces(e,me.INTEGRATED_MESH)]]),this._materialPassParameters=new B1,this._shadowPassParameters=new U1,this._highlightPassParameters=new j1,this._viewshedPassParameters=new z1,this._systems=new Set}initializeRenderContext(e){this._context=e,this._passes=new H1(e)}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e,t){return!!this._invoke(e,t,i=>i.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!=null){for(let t of Object.values(this._passes))t.prepareSubmit();this._systems.forEach(t=>t.submit(this._passes,e.bind));for(let t of Object.values(this._passes))t.finishSubmit()}}acquireTechniques(e){if(this._systems.size===0)return null;let t=e.output===oe.Shadow||e.output===oe.ShadowHighlight||e.output===oe.ShadowExcludeHighlight?this._shadowPassParameters:e.output===oe.ViewshedShadow?this._viewshedPassParameters:e.output===oe.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bind;return this._updateParameters(i.camera,t,i.slot===me.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e.output,e.bind.slot,(r,n)=>r.acquire(n,e.bind))}render(e,t){this._invoke(e.output,e.bind.slot,(i,r)=>i.dispatch(r,e.bind,t))}_invoke(e,t,i){if(this._passes==null)return null;switch(t){case me.OPAQUE_MATERIAL:switch(e){case oe.Color:case oe.ColorEmission:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.opaque,this._materialPassParameters);case oe.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case oe.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case oe.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case oe.ShadowExcludeHighlight:return i(this._passes.nonHighlightShadowMap,this._shadowPassParameters);case oe.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case me.TRANSPARENT_MATERIAL:switch(e){case oe.Color:case oe.ColorEmission:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.transparent,this._materialPassParameters)}break;case me.INTEGRATED_MESH:switch(e){case oe.Color:case oe.ColorEmission:case oe.Depth:case oe.Normal:case oe.ObjectAndLayerIdColor:return i(this._passes.integratedMesh,this._materialPassParameters);case oe.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){let t=new qr;return this._systems.forEach(i=>t.union(i.queryDepthRange(e))),t}get hasEmissions(){let e=!1;return this._systems.forEach(t=>e=t.hasEmissions||e),e}_updateParameters(e,t,i){let r=e.viewInverseTransposeMatrix;Te(gN,r[3],r[7],r[11]),_N.set(gN),ee(t.transformWorldFromViewTH,_N.high),ee(t.transformWorldFromViewTL,_N.low),ee(t.slicePlaneLocalOrigin,gN),Lp(t.transformViewFromCameraRelativeRS,e.viewMatrix),Ap(t.transformProjFromView,e.projectionMatrix),t.identifier===Kl.Material&&(this._materialPassParameters.transparent=i,Qc(U6,t.transformViewFromCameraRelativeRS),O0(t.transformNormalViewFromGlobal,U6))}hasHighlightOptions(e){for(let t of this._systems)if(t.hasHighlightOptions(e))return!0;return!1}};G1=u([C("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],G1);var gN=w(),U6=Nn(),_N=new z3;function j6(e){return e.name}var q1=class{constructor(t){this._context=t,this._nodes=new Nt}destroy(){this._nodes.forEach(t=>t.destroy()),this._nodes.clear()}add(t){this._nodes.push(t),oM&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(t){this._nodes.remove(t),oM&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(t){return this._nodes.some(({produces:i})=>i===t)}require(t,...i){let r=this._nodes,n=s=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.required.includes(t)||s!=null&&l!==s?0:1),0);return i.length===0?n():i.reduce((s,o)=>s+n(o),0)}optional(t,...i){let r=this._nodes,n=s=>r.reduce((o,{consumes:a,produces:l})=>o+(!a.optional?.includes(t)||s!=null&&l!==s?0:1),0);return i.length===0?n():i.reduce((s,o)=>s+n(o),0)}updateAnimation(t){return this._nodes.reduce((i,r)=>r.updateAnimation(t)||i,!1)}precompile(...t){++this._context.techniques.precompiling;for(let i of t)this._nodes.forEach(r=>{r.produces===i&&r.precompile()});--this._context.techniques.precompiling}render(t,i,r=()=>{}){let n=t.name,s=this._nodes.filter(({produces:o})=>o===n);return s.length===0?j6(t)?t:Fl:(s.forEach(o=>{let a=[t];for(let l of o.consumes.required){if(l===n)continue;let c=i.get(l);if(c)a.push(c);else if(l!=="emissive"||!i.get(n)?.hasAttachment(l))return void(r&&r(a))}if(o.consumes.optional)for(let l of o.consumes.optional){if(l===n)continue;let c=i.get(l);c&&a.push(c)}try{let l=o.doRender(a);l&&l!==t&&(n!==l.name&&(W.getLogger(o).errorOnce(`RenderNode produced ${l.name}, expected ${n}`),l.setName(n)),t.release(),t=l,i.set(n,t))}catch(l){W.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState(),t)}requireGeometryDepth(){return this._nodes.some(t=>t.produces!=="disabled"&&t.requireGeometryDepth)}get test(){return{nodes:this._nodes}}};var W1=class{constructor(t){this.context=t,this._renderPlugins=new Nt,this._slots=new Array,this._version=Pn(0);for(let i=0;i<me.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(t=>t.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(t,i){let r=()=>{if(i?.aborted)throw t.uninitializeRenderContext(),Sr();this._renderPlugins.push(t),t.produces.forEach((s,o)=>this._slots[o].push(t)),this.context.requestRender(),this._version.value++},n=t.initializeRenderContext(this.context,i);if(Na(n))return n.then(r);r()}remove(t){this._renderPlugins.removeUnordered(t),t.uninitializeRenderContext();for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==t);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>i=r.updateAnimation?.(t)||i),i}precompile(...t){++this.context.techniques.precompiling;let i=this.context.renderContext.bind.slot;for(let r of t)this.context.renderContext.bind.slot=r,this._forEachRender(()=>{});this.context.renderContext.bind.slot=i,--this.context.techniques.precompiling}render(t,...i){for(let r of i)this.context.renderContext.bind.slot=r,this._forEachRender((n,s)=>n.render(this.context.renderContext,s,t))}_forEachRender(t){let i=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[i].forEach(n=>{if(!n.produces.get(i)?.(r)||n.isDecoration&&!this.context.renderContext.bind.decorations)return;let o=n.acquireTechniques(this.context.renderContext);o&&t(n,o)})}queryDepthRange(t){let i=new qr;return this._renderPlugins.forAll(r=>{let n=r.queryDepthRange?.(t);i.union(n)}),i}get updating(){return this._version.value>=0&&this._renderPlugins.some(t=>t.running)}produces(t,...i){return i.some(r=>this._slots[r].some(n=>{let s=n.produces.get(r);return!!s&&s(t)}))}consumes(t){return this._renderPlugins.some(i=>i.consumes().required.includes(t))}hasHighlightOptions(t){return Cre.some(i=>this._slots[i].some(r=>r.hasHighlightOptions(t)))}get hasDecorations(){return this._renderPlugins.some(t=>t.isDecoration)}get hasOccludees(){return this._renderPlugins.some(t=>t.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(t=>t.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,hr.None)}get usedMemory(){return this._renderPlugins.reduce((t,i)=>i.material?t:t+(i.usedMemory??0),0)}get test(){}},Cre=[me.OPAQUE_MATERIAL,me.TRANSPARENT_MATERIAL,me.DRAPED_MATERIAL,me.HUD_MATERIAL,me.LABEL_MATERIAL];var _g=class extends ft{constructor(t,i){super(t,i,new mt(IH,()=>import("./chunk-6ZARIC6L.js")))}initializePipeline(t){return Tt({blending:Ga,colorWrite:St,drawBuffers:t.hasEmission?{buffers:[cr.COLOR_ATTACHMENT0,cr.COLOR_ATTACHMENT1]}:{buffers:[cr.COLOR_ATTACHMENT0]}})}};var Fv=class extends ou{constructor(){super(...arguments),this.hasEmission=!1}};u([Zt()],Fv.prototype,"hasEmission",void 0);var $1=class{constructor(t){this._techniques=t,this._parameters=new SH,this._configuration=new Fv,t.precompile(_g,this._configuration),this._configuration.hasEmission=!0,t.precompile(_g,this._configuration)}blend(t,i,r,n,s){this._parameters.colorTexture=i.getTexture(),s&&(this._parameters.emissionTexture=i.getTexture(cr.COLOR_ATTACHMENT1),this._parameters.emissionFrontFaceTexture=r.getTexture(cr.COLOR_ATTACHMENT1)),this._parameters.alphaTexture=i.getTexture(s?cr.COLOR_ATTACHMENT2:cr.COLOR_ATTACHMENT1),this._parameters.frontFaceTexture=r.getTexture(),this._configuration.hasEmission=s;let o=this._techniques.get(_g,this._configuration);t.bindTechnique(o,n,this._parameters),t.screen.draw()}};var Z1=class{constructor(t,i){this._camera=t,this._dt=0,this._time=0,this._lastUpdate=0,this._lastUpdate=i,this._time=i}advance(t,i,r){let n=i-this._lastUpdate;this._dt=n/r,this._time=this._time+n,this._lastUpdate=i,this._camera=t}forceTime(t){this._lastUpdate=this._time=t,this._dt=0}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}};var Q1=class{constructor(){this._step=q6,this._dilation=1,this._firstIdleTime=0}frame(t,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,Ct("disable-feature:high-quality-idle"))this._dilation=1;else{let n=i?performance.now()-this._firstIdleTime:0;if(n>=z6+Ere)return this._step=1/0,void(this._dilation=1);this._dilation=n>=z6?Dre:1}let r=q(t/Tre,q6,Mre);this._step===1/0?this._step=r:this._step=this._step*G6+r*(1-G6)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}},Tre=.5,z6=12e4,Ere=1e4,Dre=10,G6=.9,xre=30,q6=1e3/1,Mre=1e3/xre;var Y1;(function(e){e[e.SHADOW_CASTERS=0]="SHADOW_CASTERS",e[e.FULL_SCENE=1]="FULL_SCENE"})(Y1||(Y1={}));var Sre=1e4,wN=100,Ire=500,Are=500,Rre=.1;function Z6(e,t,i,r=Y1.SHADOW_CASTERS){let n=0;if(!t.some(o=>!!o.material&&(n+=o.numGeometries,n>=Sre)))return kre.compute(e,t,r);let s=new qr;return i.forAll(o=>s.union(Pre(e,o))),s}function Pre(e,t){if(!t.visible)return;let i=new qr,r=t.getSpatialQueryAccelerator();return r?Ore(i,e,r):Nre(i,e,t.objects),i}function Ore(e,t,i){let{eye:r,viewForward:n,frustum:s}=t,o=l=>l.visible,a=i.objectCount;if(a<Ire)Wo.set(t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,n,tu.DepthOrder.FRONT_TO_BACK,Wo,(l,c)=>{bN(e,t,l),Wo.far=e.near,c.setRange(Wo)},s,o),Wo.set(Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,n,tu.DepthOrder.BACK_TO_FRONT,Wo,(l,c)=>{bN(e,t,l),Wo.near=e.far,c.setRange(Wo)},s,o);else{let l=Math.max(Math.min(a,Are),Math.ceil(a*Rre)),c=i.findClosest(n,tu.DepthOrder.FRONT_TO_BACK,s,o,l),h=i.findClosest(n,tu.DepthOrder.BACK_TO_FRONT,s,o,l);c&&h&&(W6(e,t,c.boundingVolumeWorldSpace.bounds),W6(e,t,h.boundingVolumeWorldSpace.bounds))}}function Nre(e,t,i){yg.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&yg.add(r)}),yg.empty||(yg.sort(t),Wo.set(t.near,Math.min(e.near,t.far)),yg.forEachInDepthRange(Wo,tu.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<e.near&&bN(e,t,r)}),Wo.set(Math.max(e.far,t.near),t.far),yg.forEachInDepthRange(Wo,tu.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{e.far=Math.max(e.far,s)}))}function bN(e,t,i){if(!i.visible||!qg(t.frustum,i.boundingVolumeWorldSpace.bounds))return;let r=i.transformation,n=Fre;i.geometries.forEach(s=>{lo(n,r,s.transformation);let o=j0(n);Q6(e,t,s.boundingInfo,n,o)})}function Q6(e,t,i,r,n){if(i==null)return;si(Hr,i.center,r);let{eye:s,viewForward:o}=t,a=o[0]*(Hr[0]-s[0])+o[1]*(Hr[1]-s[1])+o[2]*(Hr[2]-s[2]);if(Hr[3]=i.radius*n,!(a-Hr[3]>e.near&&a+Hr[3]<e.far)&&qg(t.frustum,Hr))if(i.radius>wN&&i.getChildren())for(let l of i.getChildren())Q6(e,t,l,r,n);else DN.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function W6(e,t,i){let r=t.eye,n=t.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];e.near=Math.min(e.near,s-i[3]),e.far=Math.max(e.far,s+i[3])}var CN=class{constructor(){this._items=new Nt({allocator:t=>t||{object:null,distance:0,near:0,far:0},deallocator:t=>(t.object=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().object=t}sort(t){let i=t.eye,r=t.viewForward;this._items.forAll(n=>{let s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(t,i,r){if(i===tu.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){let s=this._items.data[n];s.far<t.near||s.near>t.far||r(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){let s=this._items.data[n];s.far<t.near||s.near>t.far||r(s.object,s.near,s.far)}}},TN=class{constructor(){this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange=new qr(0,0)}compute(t,i,r){this._reset();let{viewMatrix:n}=t;i.forAll(c=>{c.forEachGeometry(h=>{if(!h.visible||r===Y1.SHADOW_CASTERS&&!h.castShadow)return;let p=h.boundingSphere,m=n[2]*p[0]+n[6]*p[1]+n[10]*p[2]+n[14],f=m-p[3],g=m+p[3];this._geometries.push(h),this._near.push(-g),this._far.push(-f)})});let s=new qr;if(this._geometries.length===0)return s;for(let c=0;c<this._geometries.length;++c)this._near[c]>s.far&&(s.far=this._near[c]),this._near[c]>2&&this._far[c]<s.near&&(s.near=this._far[c]);let o=this._looseRange;o.near=Math.max(.5*s.near,2),o.far=2*s.far;let a=0,l=0;for(let c=0;c<this._geometries.length;++c)this._near[c]<s.near&&(this._near[c]>=o.near?s.near=this._near[c]:this._nearCandidates[a++]=c),this._far[c]>s.far&&(this._far[c]<=o.far?s.far=this._far[c]:this._farCandidates[l++]=c);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return s;this._nearCandidates.sort((c,h)=>this._near[c]<this._near[h]?-1:this._near[c]>this._near[h]?1:0),this._farCandidates.sort((c,h)=>this._far[c]<this._far[h]?1:this._far[c]>this._far[h]?-1:0);for(let c=0;c<this._nearCandidates.length;++c){let h=this._nearCandidates[c];if(this._near[h]<s.near){let p=this._geometries[h],{boundingInfo:m,shaderTransformation:f}=p;this._includeNearBoundingInfoRec(t,m,f,s)}}for(let c=0;c<this._farCandidates.length;++c){let h=this._farCandidates[c];if(this._far[h]>s.far){let p=this._geometries[h],{boundingInfo:m,shaderTransformation:f}=p;this._includeFarBoundingInfoRec(t,m,f,s)}}return this._reset(),s}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_isOutsideSidePlanes(t,i){let r=t,n=DF(t);return i[0][0]*r[0]+i[0][1]*r[1]+i[0][2]*r[2]+i[0][3]>n||i[1][0]*r[0]+i[1][1]*r[1]+i[1][2]*r[2]+i[1][3]>n||i[2][0]*r[0]+i[2][1]*r[1]+i[2][2]*r[2]+i[2][3]>n||i[3][0]*r[0]+i[3][1]*r[1]+i[3][2]*r[2]+i[3][3]>n}_includeNearBoundingInfoRec(t,i,r,n){if(i==null)return;let s=i.center;si(Hr,s,r),Hr[3]=i.radius*j0(r);let{frustum:o}=t;if(this._isOutsideSidePlanes(Hr,o))return;let a=Hr[0],l=Hr[1],c=Hr[2],h=Hr[3],{viewMatrix:p}=t,m=p[2]*a+p[6]*l+p[10]*c+p[14],f=m+h;if(!(-(m-h)<2||-f>=n.near))if(-f>this._looseRange.near)n.near=-f;else{if(h>wN){let g=i.getChildren();if(g!==void 0){for(let _ of g)this._includeNearBoundingInfoRec(t,_,r,n);return}}DN.unionDepthRangeWithAABB(n,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}_includeFarBoundingInfoRec(t,i,r,n){if(i==null)return;let s=i.center;si(Hr,s,r),Hr[3]=i.radius*j0(r);let{frustum:o}=t;if(this._isOutsideSidePlanes(Hr,o))return;let[a,l,c,h]=Hr,{viewMatrix:p}=t,m=p[2]*a+p[6]*l+p[10]*c+p[14]-h;if(!(-m<=n.far))if(-m<this._looseRange.far)n.far=-m;else{if(h>wN){let f=i.getChildren();if(f!==void 0){for(let g of f)this._includeFarBoundingInfoRec(t,g,r,n);return}}DN.unionDepthRangeWithAABB(n,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}}},EN=class{constructor(){this._modelViewProj=$t(),this._clipPosition=[Qi(),Qi(),Qi(),Qi(),Qi(),Qi(),Qi(),Qi()]}unionDepthRangeWithAABB(t,i,r,n,s){let o=this._modelViewProj;lo(o,i,r);let a=!1;for(let l=0;l<8;++l){let c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?n[0]:s[0],p=l===0||l===1||l===4||l===5?n[1]:s[1],m=l<4?n[2]:s[2];c[0]=o[0]*h+o[4]*p+o[8]*m+o[12],c[1]=o[1]*h+o[5]*p+o[9]*m+o[13],c[2]=o[2]*h+o[6]*p+o[10]*m+o[14],c[3]=o[3]*h+o[7]*p+o[11]*m+o[15]}for(let l=0;l<12;++l){let c=Lre(this._clipPosition[vN[l][0]],this._clipPosition[vN[l][1]],this._clipPosition[vN[l][2]]),h=!0;for(let p=0;p<c.length;++p)if(c[p][3]>=2){h=!1;break}if(!h){a=!0;for(let p=0;p<c.length;++p){let m=c[p][3];Number.isFinite(m)&&(t.near=Math.min(m,t.near),t.far=Math.max(m,t.far))}}}return a}};function Lre(e,t,i){let r=[e,t,i];for(let n=0;n<4;++n){let s=r;r=[];for(let o=0;o<s.length;++o){let a=s[o],l=s[(o+1)%s.length];yN(l,n)?(yN(a,n)||r.push($6(a,l,n)),r.push(l)):yN(a,n)&&r.push($6(a,l,n))}}return r}function yN(e,t){return t===0?e[0]>=-e[3]:t===1?e[1]>=-e[3]:t===2?e[0]<=e[3]:t===3?e[1]<=e[3]:void Xr(!1)}function $6(e,t,i){let r=0;return i===0?r=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):i===1?r=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):i===2?r=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):i===3&&(r=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),bL(Qi(),e,t,r)}var vN=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Hr=ur(),Fre=$t(),Wo=new qr,yg=new CN,kre=new TN,DN=new EN;var Y6={idleOpacity:.8,navigatingOpacity:.4,maxDelta:.1,tiltFadeStart:20,tiltFadeEnd:30,altitudeStart:1e4,altitudeEnd:2e4};var K1=class{constructor(t){this._fbos=t,this._requiresEmission=!1,this._size=new FV(0,0),this._clearColor=Qi()}dispose(){this._color=ki(this._color),this.releaseDepth()}initialize(t,i,r,n){this._size.width=t,this._size.height=i,tm(this._size,this._fbos.rctx.parameters.maxTextureSize);let s=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=n,Pp(this._clearColor,r),s}releaseDepth(){this._color?.detachDepth(),this._depth=ki(this._depth)}update(t){let i=this._ensureColor();i.attachDepth(this.depth),this._color=t(i)}bind(){let t=this._color==null;if(this.color.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(this.color.fbo),t){let i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(Ti.COLOR|Ti.DEPTH|Ti.STENCIL),this._requiresEmission&&i.gl.clearBufferfv(i.gl.COLOR,1,hw)}}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(cr.COLOR_ATTACHMENT1,Pi.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(br.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}};var X1=class{constructor(){this._inputs=new Map}set(t,i){this._inputs.set(t,i)}get(t){return this._inputs.get(t)}has(t){return this._inputs.has(t)}release(t){this._inputs.get(t)?.release()&&this._inputs.delete(t)}};var kv=class extends ft{constructor(t,i){super(t,i,new mt(NH,()=>import("./chunk-DLO2QMVX.js"))),this.primitiveType=Jt.TRIANGLE_STRIP}initializePipeline(){return Tt({blending:Ga,colorWrite:St,depthTest:null,depthWrite:null})}};var K6=4e4,X6=5e4,xN=1/512,Vv=class extends P{constructor(e,t,i,r){super({}),this._techniques=e,this._rctx=t,this._data=i,this._requestRender=r,this._passParameters=new OH(this._data),this._configuration=new PH,this._enabled=!1,this._vao=gn(t)}dispose(){this._stop(),this._vao=We(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(kv,this._configuration)}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;let t=this._techniques.get(kv,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,e,this._passParameters),this._rctx.drawArrays(t.primitiveType,0,sa(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>xN}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._configuration.bandsEnabled=e,this._requestRenderIfEnabled())}_setColor(e){let t=this._passParameters.color;CL(e,t)||(Pp(this._passParameters.color,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],Vv.prototype,"opacityFromElevation",null),Vv=u([C("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],Vv);var Hv=class extends ft{constructor(t,i){super(t,i,new mt(RH,()=>import("./chunk-SLTB22ZT.js"))),this.primitiveType=Jt.TRIANGLE_STRIP}initializePipeline(){return Tt({blending:ZF,colorWrite:St,depthTest:null,depthWrite:null})}};var An=class extends P{constructor(e,t,i,r,n,s){super({}),this.fbos=e,this._techniques=t,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=n,this._requestRender=s,this._progress=0,this._sampleCount=0,this._passParameters=new J0,this._cachedLightDirections=[],this._depthRange=qr.zero,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new Cw(new Tw(e,i.viewingMode)),this._bindParameters.shadowMap.enabled=!0,this._vao=gn(this._rctx),this._accumulationRenderer=new Vv(t,this._rctx,this,s);let o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(Xt.SHADOW_ACCUMULATOR,this),S(()=>i.renderView,a=>{this.removeHandles(J6),a!=null&&this.addHandles(a.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),J6)},Ce),S(()=>this._previewing,()=>this._requestRenderIfEnabled(),Fe)],this._shadowAccumulatorKey),t.precompile(Hv)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=We(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=We(this._fbo),this._vao=We(this._vao),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get accumulating(){return this._active&&this._previewing||this._refining}get _refining(){return this._active&&!this._doneAccumulating&&!this._previewing}get _active(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==qr.zero&&this._opacityFromElevation>xN}get _doneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){let t=this._cachedLightDirections;if(e0(t,e,$c))return;let i=Math.min(AH,e.length);t.length=i,this._sampleCount=i;for(let r=0;r<i;++r)t[r]=ee(t[r]??w(),e[r]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._refining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._doneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.accumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();let n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Vre,this._sampleCount);n-=this._progress;for(let s=0;s<n;++s)this._accumulateShadow(),this._requestRender();return this._cameraForcedForScreenshot=!1,n>0}precompile(){this._accumulationRenderer.precompile()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){let t=this._fbo!=null;e.enabled!==t&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._active||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||t<0||t>=this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,mi.RGBA,Ba.UNSIGNED_BYTE,eW),eW[0]/this._progress)}_enable(){this._progress=0;let e=new vi;e.pixelFormat=mi.RED,e.internalFormat=Zc.R8,e.wrapMode=ji.CLAMP_TO_EDGE,this._fbo=new $a(this._rctx,e),this._requestRender()}_disable(){this._fbo=We(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Ti.COLOR),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);let e=this._techniques.get(Hv);this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,sa(this._vao,"geometry"))}_updateCamera(e){let t=this._fbo;if(t==null)return;let i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),t.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-Bl(K6,X6,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};u([d()],An.prototype,"_progress",void 0),u([d()],An.prototype,"_sampleCount",void 0),u([d()],An.prototype,"_fbo",void 0),u([d()],An.prototype,"_depthRange",void 0),u([d()],An.prototype,"_previewing",void 0),u([d()],An.prototype,"_accumulationRenderer",void 0),u([d()],An.prototype,"_refining",null),u([d()],An.prototype,"_active",null),u([d()],An.prototype,"canAccumulate",null),u([d()],An.prototype,"_doneAccumulating",null),u([d()],An.prototype,"_opacityFromElevation",null),u([d()],An.prototype,"running",null),An=u([C("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],An);var Vre=6,J6="renderView",eW=new Uint8Array(4);var Hre=$g(),J1=class{constructor(){this._plane=$g()}get plane(){return this._plane}set plane(t){Wp(t||Hre,this._plane)}};function tW(e,t){let i=e.capabilities.disjointTimerQuery;return i==null?null:new MN(i,t)}var MN=class{constructor(t,i){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{let n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){oV||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();let i=this._queryResults.get(t);if(i==null)return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;let r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{t!=null&&this._timer.deleteQuery(t)})}};var Ri;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.DEPTH="depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.NORMALS="normals",e.SSAO="SSAO",e.HIGHLIGHTS="highlights",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth",e.OPAQUE_ENVIRONMENT="opaque environment",e.TRANSPARENT_ENVIRONMENT="transparent environment",e.OCCLUDED="occluded",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish",e.FOCUS_AREA_MASK="focus area mask"})(Ri||(Ri={}));var SN=Object.values(ti).concat(Object.values(Oe)).concat(Object.values(Ri)),iW="Total",ex=class{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Ig(iW),this._cpuTimeSamplers=new Map(SN.map(i=>[i,new Ig(i)])),this._enableGPUTimer=0,this._totalGPUTime=new Ig("GPU"),this._gpuTimeSamplers=new Map(SN.map(i=>[i,new Ig(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){let i=[...SN,iW];this._gpuTimerPool=tW(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let t=!1;return{hasGPUTimerSupport:!0,remove:()=>{t||(t=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=We(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(t=>t.push(0)),this._gpuTimerPool.start())}advance(t){let i=performance.now();if(this._cpuTimeSamplers.get(t).push(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){let r=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).set(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){let i=this._gpuTimerPool.stop(Ri.FINISH);this._gpuTimeSamplers.get(Ri.FINISH).set(i),this._rctx.gl.flush()}let t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.push(t),this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};var dp=class{constructor(t,i,r,n,s,o){this._stage=t,this._techniques=r,this._rctx=n,this._compositingHelper=s,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._renderers=new Map,this.renderPassManager=new G1,this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=pn(0,0,0,1),this._sliceHelper=new J1,this._blit=null,this._oitblend=null,this._state=Pn(pi.IDLE),this._highQualityTransparencyEnabled=!0,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Q1,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Pn(0),this._lastFrameTime=0,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new X1,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new k1(n),this._renderStateFeatures=Pn(kM(!Ct("disable-feature:high-quality-idle"),t.view.qualityProfile)),this._framebuffer=new K1(this.fboCache),this.performanceInfo=new ex(this._rctx),this._shadowMap=new Tw(this.fboCache,t.viewingMode),this._shadowAccumulator=new An(this.fboCache,r,t,a=>{let l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{let h=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,h),this._renderShadowCascades(oe.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new kV(this._rctx,this._shadowMap,r),this._nodes=new q1(this._renderContext),this._plugins=new W1({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:t,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this._plugins.add(this.renderPassManager),this._handles=[S(()=>this._stage.view.state.camera,()=>o(),Ce),S(()=>dr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(Fd.TRANSPARENT):()=>{},o()},Re),S(()=>this._stage.view.environment.background?.color,a=>{let l=a?Hp(a):mn;ho(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},Ce),S(()=>this._stage.view.state.camera.relativeElevation,a=>this._inGlobeView=(a??1/0)>=5e5,Ce),S(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),Fe),S(()=>this._bindParameters.clouds.data?.state,()=>o(),Fe),S(()=>this._stage.view.state.highlights,a=>{this._bindParameters.highlights=a,this._updateHighlights(),o()},Re)]}destroy(){this._handles.forEach(t=>t.remove()),this._gpuTimerHandle=kt(this._gpuTimerHandle),this._nodes.destroy(),this._framebuffer.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=Mr(this._loadEdgeViewTask),this._edgeView=G(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),this._renderers.clear(),this._blit=null,this._oitblend=null,wk.prune(),LM.prune(),VL()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(t=null,i=!Ct("disable-feature:high-quality-idle")){this._renderStateFeatures.value=kM(i,t),this._requestRender()}isFeatureEnabled(t,i=this._state.value){return this._renderStateFeatures.value.get(i,t)??!1}setFeatureEnabled(t,i,r){this._renderStateFeatures.mutate(n=>n.set(i,t,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(bo.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(bo.WaterReflection))}get _hasHighlights(){return this._plugins.produces(oe.Highlight,me.OPAQUE_MATERIAL,me.TRANSPARENT_MATERIAL,me.DRAPED_MATERIAL,me.HUD_MATERIAL,me.LABEL_MATERIAL)}hasHighlightOptions(t){return this._plugins.hasHighlightOptions(t)}get _hasHUDHighlights(){return this._plugins.produces(oe.Highlight,me.HUD_MATERIAL,me.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(bo.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(bo.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(bo.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=ki(this._bindParameters.ssr.lastFrameColor),this._bindParameters.terrainDepth=ki(this._bindParameters.terrainDepth),this._bindParameters.geometryDepth=ki(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=ki(this._bindParameters.depth),this._bindParameters.hudVisibility=ki(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=un(async t=>{let{EdgeView:i}=await import("./chunk-TEPFLNMP.js");Bt(t);let r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:Gre(this._stage.view.resourceController)});return this._handles.push(S(()=>r.updating,()=>this._requestRender(),Fe)),this._requestRender(),this._edgeViewCallbacks.forEach(n=>n(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(t){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(t):t(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&nL(this._bindParameters.ssr.reprojectionMatrix,Yc)}set _reprojectionMatrix(t){KN(this._bindParameters.ssr.reprojectionMatrix,t)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){let{_shadowMap:i,_bindParameters:r}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&i.maxCascades!==t.shadowMapMaxCascades&&(i.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);let n=t.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.shadowCast!==void 0&&this._shadowAccumulator.setOptions(t.shadowCast)}set slicePlane(t){this._sliceHelper.plane!==t&&(this._sliceHelper.plane=t,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(t){return this._renderers.get(t)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,i){this._isRendering&&console.warn("Renderer.modify called while rendering");let{adds:r,removes:n,updates:s}=t;r.length===0&&n.length===0&&s.length===0||(HF(t).forEach((o,a)=>{if(i.done)return;let l=this._renderers.get(a);l==null&&o.adds.length>0&&(l=new LM({material:a,highlightOrderMap:this._stage.view.state.highlightOrderMap}),l.initializeRenderContext(this._plugins.context),this._plugins.add(l),this._renderers.set(a,l)),l&&(l.modify(o),l.updateHighlights(this._stage.view.state.highlightOrderMap),l.numGeometries===0&&(this._renderers.delete(l.material),this._plugins.remove(l),l.destroy())),o.removes.forEach(c=>t.removes.removeUnordered(c)),o.adds.forEach(c=>t.adds.removeUnordered(c)),o.updates.forEach(c=>t.updates.removeUnordered(c)),i.madeProgress()}),this.updateHasFlags())}updateHasFlags(){let t=this._pluginsHas;t.hudElements=this._plugins.produces(oe.Color,...Uv),t.water=this._plugins.produces(oe.Normal,me.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees,this._requestRender()}updateAnimation(t,i){this._animationTimer??=new Z1(t.camera,i),this._animationTimer.advance(t.camera,i,this._animationTimeDilation),t.forcedAnimationTime!=null&&this._animationTimer.forceTime(t.forcedAnimationTime);let r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(this._animationTimer),this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?kt(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(t,i,r=ra.Default,n=!1){try{return this._isRendering=!0,this._render(t,i,r,n)}catch(s){console.error(`Exception during rendering: ${s}`)}finally{this._isRendering=!1}return new nv(this._pluginInput.get(ti.FINAL),null)}_updateHUDOccludedFragmentOpacity(t,i){let{idleOpacity:r,navigatingOpacity:n,maxDelta:s,tiltFadeStart:o,tiltFadeEnd:a,altitudeStart:l,altitudeEnd:c}=Y6,h=this._stage.view,p=h.stateManager.camera,m=h.qualitySettings.fadeDuration,f=t===pi.IDLE?r:n,g=q((p.tilt-o)/(a-o),0,1),_=q((p.position.z??0-l)/(c-l),0,1),v=Xe(Xe(1,f,g),1,_),b=this._bindParameters.hudOccludedFragmentOpacity;if(m<=0||b===v||this._lastFrameTime===0||this._lastFrameTime>i)return this._bindParameters.hudOccludedFragmentOpacity=v,void(this._lastFrameTime=i);let x=i-this._lastFrameTime;this._lastFrameTime=i;let E=Math.min(Math.abs(r-n)*x/m,s);E>=Math.abs(v-b)?this._bindParameters.hudOccludedFragmentOpacity=v:(this._bindParameters.hudOccludedFragmentOpacity=b+Math.sign(v-b)*E,this._requestRender())}_render(t,i,r=ra.Default,n){this.performanceInfo.startFrame(),this.fboCache.frameStart(),this.fboCache.interactive=r===ra.Default,this._disposeBindBuffers();let{camera:s,contentCamera:o,mode:a,alignPixelEnabled:l}=t;this._state.value=a;let c=this._nodes.produces("magnifier-color"),h=this._nodes.produces(ti.FINAL),p=this._nodes.require("emissive",ti.FINAL,ti.COMPOSITE)>0&&this._plugins.hasEmissions,m=p?oe.ColorEmission:oe.Color;this._renderContext.time=i,this._renderContext.output=m,this._bindParameters.oitPass=Ns.NONE,this._bindParameters.alignPixelEnabled=l,this._bindParameters.decorations=!n,this._bindParameters.mainDepth=null,this._bindParameters.slicePlane=this._sliceHelper.plane,this._bindParameters.viewshedEnabled=this._nodes.produces(Oe.VIEWSHED),this._renderOverlay(i),s.setGLViewport(this._rctx);let f=this._framebuffer,g=f.initialize(s.fullWidth,s.fullHeight,this._backgroundColor,p);this.hasReflections?(g?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=g):g?.release(),this._ensureBindParametersCamera(s,o),this._updateHUDOccludedFragmentOpacity(a,i),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!n;let _=this._highQualityTransparency&&this._hasTransparentTerrain,v=this._plugins.produces(oe.Color,...Bv);this._precompilePrepasses(),this.performanceInfo.advance(Ri.PREPARE);let b=this._computeDepthRange(s);this._renderShadowMap(s,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(s,o),this._pluginInput.set("normals",this._renderNormals()),this._renderRemainingGeometryDepth(),this._renderShadowAccumulation(b,s,o),this._ensureBindParametersSSR(i),this._precompileShaders(_,v,m),this._renderContext.output=m,f.bind(),this._bindParameters.mainDepth=f.depth.attachment;let x=this.plugins.produces(oe.Color,...IN);x&&this._renderOpaqueGeometry(),f.update(H=>this._renderNodes(ti.OPAQUE,H,x)),this.fboCache.debugCallback?.(ti.OPAQUE,f.color.fbo),f.update(H=>this._renderNodes(Oe.OPAQUE_ENVIRONMENT,H)),this.fboCache.debugCallback?.(Oe.OPAQUE_ENVIRONMENT,f.color.fbo),this._renderTerrainDepth(_),this._renderEdges(Fd.OPAQUE),f.bind(),this._renderPlugins(me.VOXEL,Ri.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOIT(wg.Geometry,m):this._renderTransparentGeometry()),f.update(H=>this._renderNodes(ti.TRANSPARENT,H,v)),this.fboCache.debugCallback?.(ti.TRANSPARENT,f.color.fbo),this._renderGeometryDepth(_),this._renderHUDVisibility(),_||this._plugins.render(this._pluginInput,me.LINE_CALLOUTS),this._renderEdges(Fd.TRANSPARENT);let E=this._hasTransparentTerrain?this._renderTransparentTerrain():null;E&&(this.performanceInfo.advance(Ri.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(_?this._renderLineCallouts(Ln.Occluded):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),this._compositingHelper.compositeHUD(this._bindParameters,E.getTexture())),this._renderHUD(Ln.Occluded,f.color,m))),this._bindParameters.cullAboveTerrain=!1,E&&(f.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,E.getTexture()),E.release(),_&&(this._renderEdges(Fd.OPAQUE),v&&(this._oitEnabled?this._renderOIT(wg.Geometry,m):this._renderTransparentGeometry(),this.performanceInfo.advance(Ri.TRANSPARENT)),this._renderEdges(Fd.TRANSPARENT))),this._bindParameters.ssao=ki(this._bindParameters.ssao),_&&this._renderLineCallouts(Ln.NotOccluded),this._bindParameters.terrainDepthTest=!1,this._renderTransparentEnvironment(),this._pluginInput.set(Oe.FOCUSAREA,this._renderFocusAreaGeometry()),f.update(H=>this._renderNodes(Oe.TRANSPARENT_ENVIRONMENT,H)),f.update(H=>this._renderNodes(Oe.VIEWSHED,H)),f.update(H=>this._renderNodes(Oe.LASERLINES,H)),f.update(H=>this._renderNodes(Oe.OCCLUDED,H)),this._pluginInput.set("highlights",this._renderHighlightPrepass());let D=r===ra.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;f.update(H=>this._renderNodes(ti.COMPOSITE,H)),this._pluginInput.release(Oe.FOCUSAREA);let M=!(r!==ra.Default||h||c&&!n),T=this._pluginInput.get(ti.COMPOSITE),I=M?Fl:this.fboCache.acquire(T.fbo.width,T.fbo.height,Oe.ANTIALIASING),A=this._nodes.produces(Oe.ANTIALIASING)?this._renderNodes(Oe.ANTIALIASING,I):this._blitFBO(T,I,!1),O;this._pluginInput.set(Oe.ANTIALIASING,A),this._hasHUDHighlights?(this._renderHUD(Ln.NotOccluded,A,m),O=this._renderNodes(Oe.HIGHLIGHTS,A)):(O=this._renderNodes(Oe.HIGHLIGHTS,A),this._renderHUD(Ln.NotOccluded,O,m));let $=this._renderNodes(Oe.MAGNIFIER,O);return c&&!n&&r===ra.Default&&!h&&this._blitFBO($),h?($.attachDepth(f.depth),this._blitFBO(this._renderNodes(ti.FINAL,$)),$.detachDepth()):this._pluginInput.set(ti.FINAL,$),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),f.releaseDepth(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==ra.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),new nv(this._pluginInput.get(ti.FINAL),D)}_precompileShaders(t,i,r){if(++this._plugins.context.techniques.precompiling,this._renderContext.output=r,this._precompileOpaqueGeometry(),this._nodes.precompile(Oe.OPAQUE_ENVIRONMENT),this._bindParameters.terrainDepthTest=t,this._bindParameters.cullAboveTerrain=t,this._renderContext.output=oe.Depth,this._plugins.precompile(me.TRANSPARENT_TERRAIN),t&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry()),this._renderContext.output=r,this._plugins.precompile(me.TRANSPARENT_TERRAIN),i&&(this._precompileTransparentGeometry(),this._hasTransparentTerrain&&(this._bindParameters.cullAboveTerrain=!1,this._precompileTransparentGeometry(),this._bindParameters.cullAboveTerrain=t)),this._nodes.precompile(Oe.FOCUSAREA),this._needsHUDVisibility&&this._plugins.precompile(me.OCCLUSION_PIXELS),this._plugins.precompile(me.LINE_CALLOUTS),this._precompileHUD(Ln.Occluded),this._bindParameters.terrainDepthTest=!1,this._bindParameters.cullAboveTerrain=!1,this._nodes.precompile(Oe.VIEWSHED,Oe.LASERLINES,Oe.OCCLUDED,Oe.ANTIALIASING,Oe.HIGHLIGHTS),this._precompileHUD(Ln.NotOccluded),this._hasHighlights){let n=this._bindParameters;n.highlights.forEach((s,o)=>{n.highlightLevel=o,this._precompileAllGeometry(oe.Highlight)}),n.highlightLevel=null}this._nodes.precompile(ti.COMPOSITE,Oe.MAGNIFIER),this._shadowAccumulator.precompile(),this._plugins.precompile(me.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),--this._plugins.context.techniques.precompiling}_updateHighlights(){let t=this._stage.view.state;this._renderers.forEach(i=>i.updateHighlights(t.highlightOrderMap))}_renderFocusAreaGeometry(){if(!this._nodes.produces(Oe.FOCUSAREA))return null;let{width:t,height:i}=this._framebufferSize,r=this.fboCache.acquire(t,i,Oe.FOCUSAREA);return r=this._nodes.render(r,this._pluginInput),this.performanceInfo.advance(Ri.FOCUS_AREA_MASK),r}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;let t=this._renderContext.output;++this._techniques.precompiling;let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"olid");return r.acquireDepth(br.DEPTH_STENCIL_TEXTURE),r=this._nodes.render(r,this._pluginInput),--this._techniques.precompiling,this.performanceInfo.advance(Ri.OBJECT_AND_LAYER_ID_COLOR),this._renderContext.output=t,r}finish(t){this._hasAnimations||this._animationTimestep.clear();let i=this.performanceInfo.gpuSamplingEnabled,r=t===Pe.BACKGROUND;if(r||i){let n=r?this.performanceInfo.elapsedTime:0,s=0;i?s=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();let o=Math.max(n,s);this._animationTimestep.frame(o,r)}}readMainDepth(t,i){let{mainDepth:r,camera:n}=this._bindParameters;if(!r)return;let s=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(s.fbo),n.setGLViewport(this._rctx),this._rctx.setScissorRect(t[0],t[1],t[2],t[3]),this._rctx.setScissorTestEnabled(!0),this._rctx.clearFramebuffer(mn),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,r),this._rctx.setScissorTestEnabled(!1),this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width),s.fbo?.readPixels(t[0],t[1],t[2],t[3],mi.RGBA,Ba.UNSIGNED_BYTE,i),s.release()}readHUDVisibility(t,i,r,n,s){this._bindParameters.hudVisibility?.fbo?.readPixels(t,i,r,n,mi.RGBA,Ba.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_renderEdges(t){let i=this._edgeView;if(!i?.shouldRender())return;let r=this._framebufferSize,n=this.fboCache.acquire(r.width,r.height,"edges"),s=()=>i.render(this._bindParameters,t),o=this._bindParameters.geometryDepth;this.renderToTargets(s,n,o??this._framebuffer.depth,mn),this._framebuffer.bind(),this._compositingHelper.composite(this._bindParameters,n.getTexture()),n.release(),this.performanceInfo.advance(t===Fd.OPAQUE?Ri.OPAQUE_EDGES:Ri.TRANSPARENT_EDGES)}_renderOverlay(t){this._bindParameters.overlay=this.overlay?.render(t),this._bindParameters.overlay&&this.performanceInfo.advance(Ri.OVERLAY)}_renderShadowMap(t,i,r){if(!this.shadowsEnabled)return;let n=this._shadowMap;n.start(t,i,r,this.isFeatureEnabled(bo.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(oe.ShadowHighlight,this._shadowMap),n.moveSnapshot(vM.Highlight),this._renderShadowCascades(oe.ShadowExcludeHighlight,this._shadowMap),n.copySnapshot(vM.ExcludeHighlight),this._renderShadowCascades(oe.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(oe.Shadow),n.finish(),t.setGLViewport(this._rctx),this.performanceInfo.advance(Ri.SHADOW_MAP)}_precompileShadowCascades(t){for(let i of this._shadowMap.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._precompileAllGeometry(t)}_renderShadowCascades(t,i=this._shadowMap){for(let r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this.renderAllGeometry(t)}get _needsDepth(){return this._plugins.consumes(oe.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){let t=this._pluginInput.get("normals");if(t){let i=this._needsDepth?t.getAttachment(Pd):null;i?.retain(),this._pluginInput.set(Oe.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(i)}else this._renderAllGeometryDepth()}_renderGeometryWithoutNormalsDepth(t){if(!this._needsDepth||!t)return void(this._bindParameters.depth=ki(this._bindParameters.depth));let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"depth");r.attachDepth(t),t.release(),this._rctx.bindFramebuffer(r.fbo),this._rctx.clear(Ti.STENCIL),this._renderGeometryWithoutNormals(oe.Depth),ki(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Ri.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=ki(this._bindParameters.depth));let t=this._framebufferSize,i=this.fboCache.acquire(t.width,t.height,"depth").acquireDepth(br.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(i.fbo),this._rctx.clear(Ti.DEPTH|Ti.STENCIL),this.renderAllGeometry(oe.Depth),ki(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(Ri.DEPTH)}_renderTerrainDepth(t){if(this._bindParameters.terrainDepthTest=t,this._bindParameters.cullAboveTerrain=t,!t)return void(this._bindParameters.terrainDepth=ki(this._bindParameters.terrainDepth));let i=this._renderContext.output;this._renderContext.output=oe.Depth;let r=this._framebufferSize,n=this.fboCache.acquire(r.width,r.height,"terrain depth").acquireDepth(br.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clear(Ti.DEPTH|Ti.STENCIL),this._renderTransparentTerrain(),ki(this._bindParameters.terrainDepth),this._bindParameters.terrainDepth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderGeometryDepth(t){if(!t)return void(this._bindParameters.geometryDepth=ki(this._bindParameters.geometryDepth));let i=this._renderContext.output,{width:r,height:n}=this._framebufferSize,s=this.fboCache.acquire(r,n,"geometry depth").acquireDepth(br.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(s.fbo),this._rctx.clear(Ti.DEPTH|Ti.STENCIL),this._renderOpaqueAndTransparentGeometry(oe.Depth),this._renderContext.output=i,ki(this._bindParameters.geometryDepth),this._bindParameters.geometryDepth=s.obtainDepthTexture(),s.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowAccumulation}_computeDepthRange(t){if(!this._needsDepthRange)return qr.zero;let i=Z6(t,this._plugins.plugins,this._stage.layers);return i.union(this._plugins.queryDepthRange(t)),i.near=Math.max(t.near,i.near),i.far=Math.min(t.far,i.far),i}get _normalsRequired(){let t=this._nodes.require("normals",ti.FINAL,ti.COMPOSITE,ti.OPAQUE,ti.TRANSPARENT,Oe.VIEWSHED,Oe.LASERLINES);return(this.hasSSAO?1:0)+t}_precompilePrepasses(){this._normalsRequired&&this._precompileAllGeometry(oe.Normal),this._needsDepth&&this._precompileAllGeometry(oe.Depth),this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(oe.ShadowHighlight),this._precompileShadowCascades(oe.ShadowExcludeHighlight),this._precompileShadowCascades(oe.ShadowHighlight)):this._precompileShadowCascades(oe.Shadow)),this._needsShadowAccumulation&&this._precompileAllGeometry(oe.Shadow)}_renderNormals(){let t=this._normalsRequired;if(t===0)return;let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"normals",Pi.RGBA);r.acquireDepth(br.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(mn,!0,!0),this._renderGeometryWithNormals(oe.Normal);let n=this._nodes.optional("normals",ti.FINAL,ti.COMPOSITE,ti.OPAQUE,ti.TRANSPARENT,Oe.VIEWSHED);return r.retain(t+n-1),this.performanceInfo.advance(Ri.NORMALS),r}_renderSSAO(){let t=this._pluginInput.get("normals");if(!this.hasSSAO||!t)return void t?.detachDepth();Fl.setName(Oe.SSAO);let i=this._nodes.render(Fl,this._pluginInput);return this._bindParameters.ssao=i,t.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Ri.SSAO),i}_precompileAllGeometry(t){let i=this._renderContext.output;this._renderContext.output=t,this._precompileOpaqueGeometry(),this._precompileTransparentGeometry(),this._plugins.precompile(me.TRANSPARENT_TERRAIN),this._renderContext.output=i}renderAllGeometry(t){this._renderContext.output=t,this._renderOpaqueAndTransparentGeometry(t),this._renderTransparentTerrain()}precompileSlots(t,...i){for(let r of i)this._bindParameters.slot=r,t.precompile(this._renderContext)}precompileOccludedSlots(t,i){for(let r of i)this._renderContext.renderOccludedMask=r,this.precompileSlots(t,...rW);this._renderContext.renderOccludedMask=yM}renderSlots(t,...i){for(let r of i)this._bindParameters.slot=r,t.forAll(n=>{let s=n.acquireTechniques(this._renderContext);s&&n.render(this._renderContext,s,this._pluginInput)})}renderOccludedSlots(t,i){this._renderContext.renderOccludedMask=i,this.plugins.renderOccludedFlags>hr.Occlude&&this._plugins.render(this._pluginInput,me.OCCLUDED_TERRAIN),this.renderSlots(t,...rW),this._renderContext.renderOccludedMask=yM}renderHUD(t){this._bindParameters.hudRenderStyle=t,this._plugins.render(this._pluginInput,me.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(oe.ViewshedShadow)}renderViewshedShadowMap(t){let{camera:i,contentCamera:r}=this._bindParameters,n=this._renderContext.output;t.setGLViewport(this._rctx),this._ensureBindParametersCamera(t,t),this.renderAllGeometry(oe.ViewshedShadow),this._ensureBindParametersCamera(i,r),this._bindParameters.camera.setGLViewport(this._rctx),this._renderContext.output=n}_renderOpaqueAndTransparentGeometry(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderGeometryWithNormals(t){this._renderContext.output=t,this._plugins.render(this._pluginInput,...Ure),this._renderTransparentTerrain()}_renderGeometryWithoutNormals(t){this._renderContext.output=t,this._plugins.render(this._pluginInput,...jre)}_precompileOpaqueGeometry(){this._plugins.precompile(...IN)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...IN)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...Bv)}get _hasTransparentTerrain(){return this._plugins.produces(oe.Color,me.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){let t=()=>this._plugins.render(this._pluginInput,me.TRANSPARENT_TERRAIN);if(!Q0(this._renderContext.output))return void t();let i=this._framebufferSize,r=this.fboCache.acquire(i.width,i.height,"transparent terrain");return this.renderToTargets(t,r,this._framebuffer.depth,mn),r}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,me.OCCLUSION_PIXELS)}_renderHUDVisibility(){if(!this._needsHUDVisibility)return void(this._bindParameters.hudVisibility=ki(this._bindParameters.hudVisibility));let{width:t,height:i}=this._framebufferSize,r=this._bindParameters.hudVisibility;r?.fbo?.width===t&&r?.fbo?.height===i||(r?.release(),r=this.fboCache.acquire(t,i,"hud visibility",Pi.RGBA4),this._bindParameters.hudVisibility=r);let n=this._bindParameters.geometryDepth;r.attachDepth(n||this._framebuffer.depth),this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer([0,1,0,1]),this._plugins.render(this._pluginInput,me.OCCLUSION_PIXELS),r.detachDepth(),this._framebuffer.bind(),this.performanceInfo.advance(Ri.HUD_VISIBILITY)}_renderLineCallouts(t){if(this._bindParameters.hudRenderStyle=t,t===Ln.Occluded){let i=()=>this._plugins.render(this._pluginInput,me.LINE_CALLOUTS),r=this._framebufferSize,n=this.fboCache.acquireDepth(br.DEPTH16_BUFFER,r.width,r.height,"line callouts");this.renderToTargets(i,this._framebuffer.color,n,void 0,!0,!0),n.release()}else this._plugins.render(this._pluginInput,me.LINE_CALLOUTS)}_precompileHUD(t){if(this._precompileHUDOutput(t),this._hasHighlights){let i=this._renderContext.output;this._renderContext.output=oe.Highlight,this._precompileHUDOutput(t),this._renderContext.output=i}}_precompileHUDOutput(t){let i=this._bindParameters.hudRenderStyle;this._bindParameters.hudRenderStyle=t,this._oitEnabled&&Q0(this._renderContext.output)?(this._bindParameters.oitPass=Ns.ColorAlpha,this._plugins.precompile(...Uv),this._bindParameters.oitPass=Ns.FrontFace,this._plugins.precompile(...Uv),this._bindParameters.oitPass=Ns.NONE):this._plugins.precompile(...Uv),this._bindParameters.hudRenderStyle=i}_renderHUD(t,i,r){if(this._pluginsHas.hudElements){if(this._oitEnabled){let n=this._renderOIT(wg.HUD,r,t);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,n.getTexture()),n.release()}else if(this._renderContext.output=r,t===Ln.Occluded){let n=()=>this._renderHUDElements(t),s=this._framebufferSize,o=this.fboCache.acquireDepth(br.DEPTH16_BUFFER,s.width,s.height,"hud");this.renderToTargets(n,this._framebuffer.color,o,void 0,!0,!0),o.release()}else i.acquireDepth(br.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(t),i.detachDepth();this.performanceInfo.advance(t===Ln.Occluded?Ri.HUD_OCCLUDED:Ri.HUD)}}_renderHUDElements(t){this._bindParameters.hudRenderStyle=t,this._plugins.render(this._pluginInput,...Uv)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(oe.ShadowHighlight,me.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this._hasHighlights)return;let{fboCache:t,_rctx:i,_bindParameters:r}=this,n=this._framebufferSize,s=t.acquire(n.width,n.height,"highlights",Pi.RG);return s.acquireDepth(br.DEPTH_STENCIL_TEXTURE),i.bindFramebuffer(s.fbo),i.clearFramebuffer(mn,!0),this._renderContext.output=oe.Highlight,i.bindFramebuffer(s.fbo),AV(i,t,n,r,()=>this._renderHighlightGeometries()),this.performanceInfo.advance(Ri.HIGHLIGHTS),s}_renderHighlightGeometries(){this._plugins.render(this._pluginInput,...zre),this._rctx.clear(Ti.DEPTH),this._renderHUDElements(Ln.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.accumulating}_renderShadowAccumulation(t,i,r){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,t,i,r)&&this.performanceInfo.advance(Ri.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){this._oitEnabled&&Q0(this._renderContext.output)?(this._bindParameters.oitPass=Ns.ColorAlpha,this._plugins.precompile(...Bv),this._bindParameters.oitPass=Ns.FrontFace,this._plugins.precompile(...Bv),this._bindParameters.oitPass=Ns.NONE):this._plugins.precompile(...Bv)}_renderOIT(t,i,r=Ln.Both){let n=t===wg.HUD,s=this._framebufferSize,o=n?this.fboCache.acquire(s.width,s.height,"oit hud composite"):null,a=n?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),l=this._bindParameters,c=this._renderContext.output;this._renderContext.output=i,l.oitPass=Ns.ColorAlpha;let h=o?"oit hud color+alpha":"oit color+alpha",p=this.fboCache.acquire(s.width,s.height,h,Pi.RGBA16F),m=i===oe.ColorEmission;m&&p.acquireColor(cr.COLOR_ATTACHMENT1,Pi.RGBA16F,"emissive"),p.acquireColor(m?cr.COLOR_ATTACHMENT2:cr.COLOR_ATTACHMENT1,Pi.R16F),o||p.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(p.fbo),this._rctx.clearFramebuffer([0,0,0,1]),m&&this._rctx.gl.clearBufferfv(this._rctx.gl.COLOR,1,hw),a(),p.detachDepth(),l.oitPass=Ns.FrontFace;let f=this.fboCache.acquire(s.width,s.height,o?"oit hud front":"oit front");return m&&f.acquireColor(cr.COLOR_ATTACHMENT1,Pi.RGBA,"emissive"),o?f.acquireDepth(br.DEPTH16_BUFFER):f.attachDepth(this._framebuffer.depth),this._rctx.bindFramebuffer(f.fbo),this._rctx.clearFramebuffer(mn,!!o),a(),f.detachDepth(),l.oitPass=Ns.NONE,o?(this._rctx.bindFramebuffer(o.fbo),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clear(Ti.COLOR)):this._framebuffer.bind(),this._oitblend??=new $1(this._techniques),this._oitblend.blend(this._rctx,p,f,l,m),o?.detachDepth(),f.release(),p.release(),this._renderContext.output=c,o}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this.performanceInfo.advance(Ri.APPLY_ACCUMULATED_SHADOWS),this._framebuffer.bind(),this._plugins.render(this._pluginInput,me.TRANSPARENT_MATERIAL_WITHOUT_DEPTH),this.performanceInfo.advance(Ri.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(t,i){this._plugins.produces(this._renderContext.output,t)&&(this._plugins.render(this._pluginInput,t),this.performanceInfo.advance(i))}_renderNodes(t,i,r=!1){if(i.setName(t),this._pluginInput.set(t,i),!this._nodes.produces(t))return r&&this.performanceInfo.advance(t),i;let n=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(t),n}_blitFBO(t,i=Fl,r=!0){return this._blit??=new ww(this._techniques),this._blit.blit(this._rctx,t,i,this._bindParameters),this._pluginInput.set(t.name,i),r&&t.release(),i}_ensureBindParametersCamera(t,i){this._bindParameters.camera=t,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Yc:(jx(sW,this._bindParameters.camera.viewMatrix),jx(nW,this._bindParameters.camera.projectionMatrix),lo(vg,sW,nW),lo(vg,this._renderContext.lastFrameCamera.viewMatrix,vg),lo(vg,this._renderContext.lastFrameCamera.projectionMatrix,vg),this._reprojectionMatrix=vg);let i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,t-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Yc,this._ssrEnableTime=null}addRenderNode(t){this._nodes.add(t),this._requestRender()}removeRenderNode(t){this._nodes.remove(t),this._requestRender()}updateLighting(t,i,r,n){this._bindParameters.updateLighting(t,i,r,n),this._requestRender(Pe.UPDATE)}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(t,i,r,n,s=!1,o=!1){i.attachDepth(r),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(n,s,o),t(),i.detachDepth()}get test(){}},wg;u([d({readOnly:!0})],dp.prototype,"fullResolutionAtmosphere",null),u([d()],dp.prototype,"_edgeView",void 0),u([d()],dp.prototype,"updating",null),function(e){e[e.Geometry=0]="Geometry",e[e.HUD=1]="HUD"}(wg||(wg={}));var Ure=[me.INTEGRATED_MESH,me.OPAQUE_TERRAIN,me.OPAQUE_MATERIAL,me.TRANSPARENT_MATERIAL],jre=[me.OPAQUE_MATERIAL_WITHOUT_NORMALS,me.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],IN=[me.INTEGRATED_MESH,me.OPAQUE_TERRAIN,me.OPAQUE_MATERIAL,me.OPAQUE_MATERIAL_WITHOUT_NORMALS],Bv=[me.TRANSPARENT_MATERIAL,me.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],rW=[me.OPAQUE_MATERIAL,me.TRANSPARENT_MATERIAL,me.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],Uv=[me.LINE_CALLOUTS_HUD_DEPTH,me.HUD_MATERIAL,me.LABEL_MATERIAL],zre=[me.TRANSPARENT_MATERIAL,me.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,me.OPAQUE_MATERIAL,me.OPAQUE_MATERIAL_WITHOUT_NORMALS,me.TRANSPARENT_TERRAIN,me.INTEGRATED_MESH,me.OPAQUE_TERRAIN],nW=$t(),sW=$t(),vg=$t();function Gre(e){return t=>e.immediate.schedule(t)}var tx=class{constructor(t){this._rctx=t,this._vao=qre(t)}destroy(){this._vao=We(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Jt.TRIANGLES,0,3))}get test(){}};function qre(e,t=SV,i=ja){let r=new Float32Array([-1,-1,3,-1,-1,3]);return new ns(e,i,new Map([["geometry",t]]),new Map([["geometry",wr.createVertex(e,Jr.STATIC_DRAW,r)]]))}var ix=class{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=new Bo(t.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(t){let i=t.toString(),r=this._cache.pop(i);return r||(r=new ns(this._rctx,this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",wr.createVertex(this._rctx,Jr.STATIC_DRAW)]])),r.vertexBuffers.get("geometry")?.setSize(t),r)}deleteVao(t){if(t==null)return;let i=t.byteSize.toString();this._cache.put(i,t)}};var jv=class extends cV{constructor(t,i){super(t,i),this._vaoCaches=new Zg,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=i.newCache,this.screen=new tx(this)}configure(t){super.configure(t),this._newCache=t.newCache}destroy(){this._vaoCaches?.forAll(t=>t.dispose()),this._vaoCaches?.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy(),this._vaoCaches.forAll(t=>t.dispose()),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(t,i){let r=Array.from(t).join("."),n=JSON.stringify(i),s=this._vaoCaches.get(r,n);if(s)return s;let o=new ix(this,t,i);return this._vaoCaches.set(r,n,o),o}bindTechnique(t,i,r,n){return this.useProgram(t.program),this.setPipelineState(t.getPipeline()),t.program.bind(i),r&&(t.program.bindPass(r,i),n&&t.program.bindDraw(i,r,n)),t.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new lV(this),this._appleAmdDriverHelper.run())}get test(){}};function AN(e){return!!e.frameUpdate}var hp=class extends P{constructor(e){super({}),this._stage=e,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new oi,this._frameTask=e.view.resourceController.scheduler.registerTask(Xt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(X0.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}acquire(e){let t=this._textures.get(e);return t?(t.ref(),t.loadingPromise??t):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{let i=t.texture.frameUpdate(t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",Pe.BACKGROUND)}_createNewRef(e){let t=this._stage.getObject(e);if(t==null)return null;let i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new RN(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),t.glTexture?(this._updateGLTexture(r,t.glTexture),AN(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{let n=t.load(this._stage.renderView.renderingContext),s=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),AN(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Gr(a)||W.getLogger(this).error(a),null);return Na(n)?n.then(s,o):s(n)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Pe.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],hp.prototype,"_loadingCount",void 0),u([d()],hp.prototype,"_frameTask",void 0),u([d()],hp.prototype,"updating",null),hp=u([C("esri.views.3d.webgl-engine.lib.TextureRepository")],hp);var RN=class{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(W.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function oW(e,t){return new PV(i=>NV(i,e),i=>i,t)}var bg=class extends P{constructor(){super(...arguments),this._passParameters=new PN,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Mr(this._resourcesTask),this._passParameters.waveNormal=We(this._passParameters.waveNormal),this._passParameters.wavePerturbation=We(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=un(async t=>{await Promise.allSettled([this._loadImageResource(e,Rx("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,t),this._loadImageResource(e,Rx("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,t)])})),this._resourcesTask.finished?tM.LOADED:tM.LOADING}async _loadImageResource(e,t,i,r){try{let n=await nu(t,{signal:r});Bt(r);let s=new vi(n.width,n.height);s.pixelFormat=mi.RGB,s.samplingMode=On.LINEAR_MIPMAP_LINEAR,s.hasMipmap=!0,s.maxAnisotropy=8,i(new Di(e,s,n))}catch(n){W.getLogger(this).error("Failed to load water material normal texture.",n)}}};u([d()],bg.prototype,"_resourcesTask",void 0),u([d({type:Boolean,readOnly:!0})],bg.prototype,"updating",null),bg=u([C("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],bg);var PN=class extends ru{};var Wre=new Map;function rx(){return Wre}var nx=class{constructor(t,i){this.parameters=t,this.fbos=i}},sx=class{constructor(t,i,r){this._rctx=t,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(t){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Pe.BACKGROUND);let i=As();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t,i){for(let r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}let n=be(ie({},r.settings),{pixelRatio:r.settings.pixelRatio*t.parameters.camera.pixelRatio}),s=this._renderScreenshot(t,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){t.width=i.width,t.height=i.height;let n=t.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(t,r.disableDecorations,i),n.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(be(ie({},t),{resample:t.resample}),i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){let{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=t,a=this._ensureScreenshotEncodeCanvas(),l=B0(r,n,a);this._rctx.gl.readPixels(0,0,r,n,mi.RGBA,Rd.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,be(ie({},t),{region:void 0}));let c=B0(s.width,s.height,a);return mV(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){let{framebufferHeight:r,region:n}=t,s=this._ensureScreenshotEncodeCanvas(),o=B0(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,mi.RGBA,Rd.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,t)}_renderScreenshot(t,i,r){let n=t.parameters.camera,s={width:i.framebufferWidth,height:i.framebufferHeight};tm(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1,a=s.width!==n.fullWidth||s.height!==n.fullHeight,l=i.ignorePadding&&n.pixelRatio!==i.pixelRatio,c=a||i.disableDecorations||l||i.objectAndLayerIdColor,h=null,p=null;if(c){let _=n.clone();if(i.ignorePadding){let D=TL(_.padding);for(let M=0;M<4;M++)D[M]=Math.round(D[M]/_.pixelRatio*i.pixelRatio);_.padding=D}_.fullWidth=s.width,_.fullHeight=s.height,_.pixelRatio=i.pixelRatio;let v=n.fovX-_.fovX,b=n.fovY-_.fovY;v<0&&v<b?_.fovX=n.fovX:b<0&&b<v&&(_.fovY=n.fovY);let x={camera:_,contentCamera:_,mode:pi.IDLE,alignPixelEnabled:!0,contentPixelRatio:_.pixelRatio,forcedAnimationTime:t.parameters.forcedAnimationTime};this._forceCameraHook(x),o=!0;let E=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?ra.ObjectAndLayerID:ra.Screenshot,i.disableDecorations);p=E.screen,h=E.olid}let m=()=>{this._rctx.bindFramebuffer(null),p?.release()};this._rctx.bindFramebuffer(p?.fbo);let f=this._readbackScreenshot(i,m),g=null;if(i.objectAndLayerIdColor){let _=()=>{this._rctx.bindFramebuffer(null),h?.release()};this._rctx.bindFramebuffer(h?.fbo),g=this._readbackScreenshot(i,_),this._rctx.bindFramebuffer(null)}if(c&&!this._rctx.contextAttributes.alpha)for(let _=3;_<f.data.length;_+=4)f.data[_]=255;if(g&&!this._rctx.contextAttributes.alpha)for(let _=3;_<g.data.length;_+=4)g.data[_]=255;return o&&this._forceCameraHook(t.parameters),[f,g]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas??=document.createElement("canvas"),this._screenshotEncodeCanvas}};var aW={enabled:!1,disposeContextCache:()=>{let e=rx();e.forEach(t=>t.dispose()),e.clear()}};var Br=class extends P{constructor(e){super(e),this.events=new oi,this.waterTextures=new bg,this.olidRenderHelper=iu()?new R1:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._savedFadeDuration=0;let t=e.stage;try{this._initializeContext(t)}catch(n){return void console.error("Failed to initialize context",n)}let{memoryController:i}=t.view.resourceController;this.stippleTextures=OV(this._rctx,i),this.markerTextures=oW(this._rctx,i),this._techniques=new BV(new T1(this._rctx,t.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures)),this._textures=new hp(t),this.addHandles(this._textures.events.on("changed",n=>this.requestRender(n))),this._materials=new RV(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new A1(this._rctx,this._techniques),this.renderer=new dp(t,this._materials,this._techniques,this._rctx,this._compositingHelper,n=>this.requestRender(n)),this.addHandles([S(()=>t.view.ready,n=>{n&&this._createRenderNodes()},Re),S(()=>this.waterTextures?.updating,()=>this.requestRender(),Re),S(()=>t.view.qualityProfile,n=>this.renderer?.updateRenderFeatures(n),Ce)]);let r={renderScene:(n,s,o,a)=>this.renderer.render(n,s,o,a),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>t.options.screenshot.prepareOverlay(),renderOverlay:(n,s,o)=>t.options.screenshot.renderOverlay(n,s,o)};this._screenshotManager=new sx(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(t)}destroy(){let e=this.stage?.container;e?.contains(this._canvas)&&e.removeChild(this._canvas),this._frameTask=kt(this._frameTask),this._techniques=G(this._techniques),this._componentObjects=G(this._componentObjects),this._screenshotManager=G(this._screenshotManager),G(this.renderer),this._textures=G(this._textures),G(this.waterTextures),G(this.markerTextures),G(this.stippleTextures),this._canvas=null,this._rctx=G(this._rctx)}_createRenderNodes(){let{view:e,viewingMode:t}=this.stage;new I1({view:e}),m0(e.spatialReference)||(t===Se.Local?new o1({view:e}):p0(e.spatialReference)?new g6({view:e}):(new r1({view:e}),new n1({view:e}),new D1({view:e}),new s1({view:e}))),new ek({view:e,isEnabled:()=>this.renderer.hasSSAO}),new _d({view:e,isEnabled:()=>this.renderer.hasSMAA}),new gd({view:e}),new IV({view:e}),new up({view:e,viewingMode:t}),new cg({view:e}),iu()&&new lg({view:e})}requestRender(e=Pe.UPDATE){this._needsRender=!0,e===Pe.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,i,r,n,s=n){let o=r.constrainWindowSize(t,i,n*r.pixelRatio,s*r.pixelRatio),a=this._ensureLinearDepthArrayBuffer(o);this.renderer.readMainDepth(o,a);let l=(h,p,m)=>YL(p,h)*(m[1]-m[0])+m[0],c=Number.MAX_VALUE;for(let h=0;h<o[2]*o[3];h++){let p=l(4*h,a,r.nearFar);c>p&&p!==r.nearFar[0]&&p!==r.nearFar[1]&&(c=p)}if(e){let h=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);h!=null&&c>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureLinearDepthArrayBuffer(e){let t=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){DD(),await this._techniques.reloadAll(),this.renderer.overlay?.reloadShaders(),this.requestRender()}_registerFrameTask(e){let t=e.view.state,i=!1,r=Pe.BACKGROUND,n=!1,s={preRender:({time:o})=>{i=this.updating,r=this._needsUpdate?Pe.UPDATE:Pe.BACKGROUND,e.commitSyncLayers(),o=this._testTime??o,(o-this._lastAnimationUpdate>this.renderer.animationTimestep||t.forcedAnimationTime!=null||i||this._needsRender)&&(this.renderer.updateAnimation(t,o)&&this.requestRender(Pe.BACKGROUND),this._lastAnimationUpdate=o)},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){let a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,o=this._testTime??o,this.renderer.render(t,o),n=!0,a&&this.renderer.hasReflections&&(this.requestRender(Pe.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{this._textures.update();let a=new nx(t,this.renderer.fboCache);o=this._testTime??o,this._screenshotManager.update(a,o)},finish:()=>{n&&(this.renderer.finish(t.mode===pi.IDLE?r:Pe.UPDATE),n=!1)}};this._frameTask=Kr(s)}_initializeContext(e){let{options:t}=e,i=t.canvas??document.createElement("canvas");i.setAttribute("style","width: 100%; height:100%; display:block;"),this._canvas=i;let r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},n=i.getContext("webgl2",r);if(n==null)return void W.getLogger(this).error("A WebGL2 context could not be created.");this._rctx=$re(n,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&W.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested");let{container:s}=e;!this._rctx.contextAttributes.alpha&&Ct("safari")>=11&&(s.style.backgroundColor="black"),s.contains(i)||s.appendChild(i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}get _viewingMode(){return this.stage.viewingMode}getObjectAndLayerIdColor(e){return this.olidRenderHelper?.getObjectAndLayerIdColor(e)}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new C1(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}updateQualitySettings(e){this._testTime!=null&&(this._savedFadeDuration=e.fadeDuration,e.fadeDuration=0)}set testTime(e){this._testTime=e,e==null?this.stage.view.qualitySettings.fadeDuration=this._savedFadeDuration:this.updateQualitySettings(this.stage.view.qualitySettings)}get testTime(){return this._testTime}};function $re(e,t){let i=(n,s)=>t.view.resourceController.memoryController.newCache(n,s),r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:i};if(aW.enabled){let n=lW.get(e);return n?(n.configure(r),n.ref(),n):(n=new jv(e,r),lW.set(e,n),n.ref(),n)}return new jv(e,r)}u([d({type:Boolean,readOnly:!0})],Br.prototype,"updating",null),u([d({constructOnly:!0})],Br.prototype,"stage",void 0),u([d()],Br.prototype,"_rctx",void 0),u([d()],Br.prototype,"_canvas",void 0),u([d()],Br.prototype,"stippleTextures",void 0),u([d()],Br.prototype,"markerTextures",void 0),u([d()],Br.prototype,"waterTextures",void 0),u([d({readOnly:!0})],Br.prototype,"olidRenderHelper",void 0),u([d()],Br.prototype,"_textures",void 0),u([d({readOnly:!0})],Br.prototype,"renderer",void 0),u([d()],Br.prototype,"_screenshotManager",void 0),u([d()],Br.prototype,"componentObjectCollection",null),u([d()],Br.prototype,"_componentObjects",void 0),u([d()],Br.prototype,"_needsUpdate",void 0),u([d()],Br.prototype,"_needsWaterReflectionUpdate",void 0),Br=u([C("esri.views.3d.webgl-engine.parts.RenderView")],Br);var lW=rx();var Xs=class extends P{constructor(e){super(e),this._model=new _v,this._layers=new Nt,this._asyncChangeSet=new sM,this._syncChangeSet=new sM,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Br({stage:this})),this._frameTask=this.view.resourceController.scheduler.registerTask(Xt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),im(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(im(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return Ui}_commit(e){let t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;let r=this._layerSyncSet.has(i.id)||i.updatePolicy===vw.SYNC,n=r?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,r?Jn:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Jn),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==vw.ASYNC||(t.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){let e=this._model.dirtySet;this._layers.forAll(t=>{this._layerSyncSet.has(t.id)||t.updatePolicy===vw.SYNC?(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)):e.commitSyncUpdates(t.id,this._syncChangeSet)});for(let t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Jn),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Jn),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Jn))}addRenderPlugin(e,t){let i=this.renderer.plugins.add(e,t),r=()=>{gO(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Na(i))return i.then(r);r()}removeRenderPlugin(e){this.destroyed||(gO(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};u([d({constructOnly:!0})],Xs.prototype,"view",void 0),u([d({constructOnly:!0})],Xs.prototype,"options",void 0),u([d({readOnly:!0})],Xs.prototype,"viewingMode",null),u([d({constructOnly:!0})],Xs.prototype,"container",void 0),u([d({readOnly:!0})],Xs.prototype,"updating",null),u([d({constructOnly:!0})],Xs.prototype,"_model",void 0),u([d()],Xs.prototype,"renderView",void 0),u([d({readOnly:!0})],Xs.prototype,"renderer",null),u([d({readOnly:!0})],Xs.prototype,"running",null),Xs=u([C("esri.views.3d.webgl-engine.Stage")],Xs);var ox=new Set,cW=()=>W.getLogger("esri/views/support/TextureCompressionHelper");function uW(e,t){return Di.compressionWorkerHandle??=new QD(XV(t)),ox.has(e)?cW().warn("Repeated texture compression worker initialization by the same view."):ox.add(e),Di.compressionWorkerHandle}function dW(e){Di.compressionWorkerHandle&&(ox.delete(e)||cW().warn("Unknown view attempted to destroy the texture compression worker."),ox.size||(G(Di.compressionWorkerHandle),Di.compressionWorkerHandle=null))}var ax=class extends Bu{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],ax.prototype,"components",void 0),ax=u([C("esri.views.ui.3d.DefaultUI3D")],ax);var ON=ax;var ge=class extends zC(qC(GC(QC))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._overrideDefaultEnvironmentOnly=!0,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new kn({slicePlane:zF},this),this._resourceController=Jq(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new iD({view:this}),this.labeler=new P3({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Ru,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new zu,this.environment=new jh,this.environmentManager=new Gs,this.floors=new ct,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new W4({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Qq({view:this}),this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new ON,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.focusAreas=new jV({view:this}),nw();let t=(i=null)=>{i!=null&&i.type===Ox.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([ir(()=>this.map?.allLayers,"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),S(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Tq({view:this}),this.stateManager=new Li({view:this})}initialize(){if(Ct("enable-feature:esri-compress-textures")){let t=uW(this,this.resourceController);this.addResolvingPromise(t.promise)}this.groundView=new U4({view:this}),this._updateUpdatingMonitors();let e=()=>this._updateDefaultToMapOptions();this.addHandles(ir(()=>this.map?.allLayers,"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Re),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Re),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,t=>l2(t>0?1e3/Math.ceil(t):0),Re),this.updatingHandles.add(()=>this.map?.ground,e,Ce),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ce),this.addHandles(S(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Fe))}destroy(){this.destroyed||(dW(this),this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._set("analysisViewManager",G(this.analysisViewManager)),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=G(this.sharedSymbolResources),this._set("labeler",G(this.labeler)),this._set("deconflictor",G(this.deconflictor)),this._resourceController=G(this._resourceController),this._set("stateManager",G(this.stateManager)),this._set("inputManager",G(this.inputManager)),this.state.destroy(),this.highlights.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",G(this.environmentManager)),this._set("environment",G(this.environment)),this.groundView=G(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper?.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this.map,t=this._userClippingArea||Dx(e,"clippingArea");return!this._userClippingArea&&!Dx(e,"clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof Vi?this.spatialReference&&(t=lx(t,this.spatialReference),t==null)?(W.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(W.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?W.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Se.Global)return null;let e=this.renderSpatialReference,t=this.dataExtent;return t==null||e==null||t.spatialReference.equals(e)?t:lx(t,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent,t=this.spatialReference||Qt.WGS84,i=lx(this.clippingArea,t);i!=null&&(e=e!=null?e.intersection(i):i);let r=this._get("dataExtent");return e!=null&&e.equals(r)?r:e}get _groundAndLayersExtent(){let e=this.spatialReference||Qt.WGS84,t,i=s=>{let o=lx(s,e);o!=null&&(t!=null?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r?.spatialReference){let s=r.groundExtent;i(new Vi({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){let s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(t==null)return null;t.hasZ?(t.zmin=Math.min(0,t.zmin??0),t.zmax=Math.max(0,t.zmax??0)):(t.zmin=0,t.zmax=0);let n=this._get("_groundAndLayersExtent");return t.equals(n)?n:t}castEnvironment(e){return e?e instanceof jh?e:e instanceof GT?this.environment?.cloneWithWebsceneEnvironment(e)??jh.fromWebsceneEnvironment(e):bp(jh,e):new jh}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){Wf.isValidProfile(e)&&(Wf.apply(e,this.qualitySettings),this._stage?.renderView.updateQualitySettings(this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||Wf.getDefaultProfile()}set slicePlane(e){if(this._stage!=null&&(this._stage.renderer.slicePlane=e),e==null)return void this._set("slicePlane",null);let t=this._propertiesPool.get("slicePlane");Wp(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?cF(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){let e=this.getDefaultHeightModelInfo();return e!=null?g0.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(n=>{if(n.isFulfilled()){if(n.updating){if(t=!0,n.suspended||n_(n))return;++i,e+=n.updatingProgress}}else++i});for(let n of this._updatingObjects)n!=null&&n.updating&&(i+=.1,e+=.5*.1);for(let n of this._updatingObjectsWithProgress)n!=null&&n.updating&&(++i,e+=n.updatingProgress);let r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(n=>!n.isFulfilled())||this.textures?.updating),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){let n=performance.now();if(e<1){let s=Math.min((n-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-s)+e*s}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?n:0}return t}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){let e=this._predeterminedViewingMode;if(e!=null)return $0(e);let t=this.spatialReference;return t?this.defaultsFromMap?.viewingMode!=null&&t.equals(this.defaultsFromMap.spatialReference)?$0(this.defaultsFromMap.viewingMode):CM(t,Se.Global)?"global":"local":"global"}set viewingMode(e){this.ready?W.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get highlightOptions(){return this.highlights.find(({name:e})=>e===kd)??new _o}set highlightOptions(e){for(let t=0;t<this.highlights.length;++t)if(this.highlights.at(t).name===kd)return void this.highlights.items[t].assignFrom(e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new _D(this)}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return W.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;let i=Hd(e)?Vd(this,e):e;return Z3(this,i,t,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return W.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;let t=(e.z==null?e_(this.elevationProvider,e):null)??0;return Kc(e,cx,this.renderSpatialReference,t),this.state.camera.projectToScreen(cx,NN),Zi(NN[0],NN[1])}pixelSizeAt(e,t){if(!this.ready)return W.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!e)return 0;let i=this.renderSpatialReference;Kc(e,cx,i);let r=this.state.camera.computeScreenPixelSizeAt(cx);return t&&i!==t?r*Pg(i)/Pg(t):r}overlayPixelSizeInMapUnits(e){let t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e)):1}hitTest(e,t){if(!this.ready)return W.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;let i=Hd(e)?Vd(this,e):e;return $3(this,i,t,this._defaultHitTestOptions)}async popupHitTest(e){return Xq(this,e)}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(e.parent==null)throw new Be("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":case"viewshed":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){let t=await this._completeSettings(e);await this.whenReady();let i=await this._stage.renderView.takeScreenshot(t);return(await import("./chunk-YPQG6RNE.js")).encode(i,t,this._pixelFormat())}async _takeScreenshot(e){let t=await this._completeSettings(e);await this.whenReady();let i=await this._stage.renderView.takeScreenshot(t);return(await import("./chunk-YPQG6RNE.js")).encodeData(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){let t=await this._completeSettings(e);await this.whenReady();let i=await this._stage.renderView.takeScreenshotWithOID(t),{encodeData:r}=await import("./chunk-YPQG6RNE.js");return[r(i[0],this._pixelFormat()),r(i[1],this._pixelFormat())]}async _completeSettings(e){let{toRenderSettings:t,screenshotSuperSampleSettings:i}=await import("./chunk-YPQG6RNE.js"),r=t(e,this);return r.pixelRatio/=this.state.pixelRatio,i(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!iu())throw new Be("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");let{encode:t}=await import("./chunk-YPQG6RNE.js"),i=await this._completeSettings(e);await this.whenReady();let r=await this._stage.renderView.takeScreenshotWithOID(i),n=t(r[0],i,this._pixelFormat()),s=await this._completeSettings(e);return s.format="png",[n,t(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){let e=this._stage.renderView.olidRenderHelper;if(e)return e.getColorToObjectAndLayerIdMapping();throw new Be("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true")}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return YR.importLayerView(e)}hasLayerViewModule(e){return YR.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=TT(this.type),t=Ct("safari");if(t&&t<9&&(e=new Be("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),e!=null)throw W.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){let e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return e!=null?Gg(e):null}getSpatialReferenceSupport(e,t){let i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;let r=this._validateSpatialReferenceForViewingMode(e,t,Se.Local),n=this._validateSpatialReferenceForViewingMode(e,t,Se.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Se.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Se.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!CM(e,i)&&(t==null||!!Vx(t)||(!Gc(t)||zd(t,e,i)!=null)&&(!kx(t)||i!==Se.Global))}_makeSpatialReferenceConstraints(e,t,i){if(t==null)return[{spatialReference:e,viewingMode:i}];let{isWebMercator:r,isWGS84:n}=e;return Vx(t)&&(r||n)?!n||i===Se.Local||x3(t.tileInfo,t.fullExtent,e,Se.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Qt.WebMercator,viewingMode:i}]:[{spatialReference:r?Qt.WGS84:Qt.WebMercator,viewingMode:i}]:Gc(t)||kx(t)||!r&&!n?Gc(t)&&r&&i!==Se.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Qt.WGS84,viewingMode:Se.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Qt.WGS84:Qt.WebMercator,viewingMode:i}]}_validateSpatialReference(e){let t=this.getSpatialReferenceSupport(e)!=null,i=this._predeterminedViewingMode;return t||(i!=null?W.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${$0(i)} viewing mode.`):e.isGeographic&&W.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return W.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;let t=this.getViewForGraphic(e.graphic),i=null,r=!1,n=s=>{!r&&s!=null&&"processor"in s&&s.processor?.type==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(e))};return t!=null?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),yr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}maskOccludee(e){if(!e)return W.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;let t=this.getViewForGraphic(e),i=null,r=!1,n=s=>{!r&&s!=null&&PF(s)&&(i=s.maskOccludee(e))};return t!=null?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),yr(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.filter(t=>t.type!=="media-3d").find(t=>t.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await Zo(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new Be("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{let n=this.map.allLayers.on("change",s=>{s.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new i6({view:this})),this._set("elevationProvider",new qf({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Mn({view:this})),this._set("featureTiles",new Tr({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));let e=()=>{let t=this.basemapTerrain?.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){let i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Gl(_0(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>dr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(import("./chunk-3OO5TCSF.js")).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&dr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):t||!this._featureTreeDebugger||dr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ce),this.updatingHandles.add(()=>this.clippingArea,e,Ce),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Ce)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.featureTiles&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",G(this.featureTiles)),this._set("pointsOfInterest",G(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){let e=this.spatialReference,t=this.state.isGlobal,i=Ck(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Tk.create(this.state.viewingMode,i)),t||this.addHandles(S(()=>this.basemapTerrain?.extent,r=>{let n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!xw(r,this.basemapTerrain.spatialReference,hW,n)||(this.renderCoordsHelper.extent=hW)},Fe),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Kp/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===Ox.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.addHandles(S(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Fe),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;let r=e.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(e,{disableDecorations:t}),r.getImageData(0,0,i.width,i.height)}_initStage(){let e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,n,s)=>this._renderScreenshotOverlay(r,n,s)}},t=new cD(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",t);let i=Cp(this.surface);this._stage=new Xs({view:this,options:e,container:i}),this._stage.renderer.slicePlane=this.slicePlane,this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),Re),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),r0(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new Be("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Kp/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=G(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new bD({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;let e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){let t=(await import("./chunk-T3T7F6ML.js")).default;Bt(e),await Zo(()=>this.basemapTerrain?.ready,e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){let e=Gg(this.viewingMode);e===Se.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles(ir(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();let t=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=t?.environment;i&&(this._overrideDefaultEnvironmentOnly?QR(this.environment,i):this.environment=this.environment.cloneWithWebsceneEnvironment(i)),this.timeExtent=t?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new ud(this._stage,this.resourceController.scheduler));let r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this._overrideDefaultEnvironmentOnly=!1,this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",G(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Zl);for(let e of this.map.allLayers.items)Og(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Zl);for(let e of this.map.allLayers.items)Og(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function lx(e,t){return e!=null&&E0(e.spatialReference,t)?Gl(e,t):null}ge.type="3d",u([d()],ge.prototype,"_userClippingArea",void 0),u([d()],ge.prototype,"_resourceController",void 0),u([d()],ge.prototype,"_stage",void 0),u([d({readOnly:!0})],ge.prototype,"deconflictor",void 0),u([d({readOnly:!0})],ge.prototype,"labeler",void 0),u([d(Qg(Ru,"analyses"))],ge.prototype,"analyses",void 0),u([d({type:bn,readOnly:!0})],ge.prototype,"animation",null),u([d({readOnly:!0})],ge.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],ge.prototype,"elevationProvider",void 0),u([d()],ge.prototype,"camera",null),u([d({type:Fn})],ge.prototype,"contentCamera",null),u([d({readOnly:!0})],ge.prototype,"canvas",void 0),u([d({type:pt})],ge.prototype,"center",null),u([d({type:Vi})],ge.prototype,"clippingArea",null),u([d({type:zu})],ge.prototype,"constraints",void 0),u([d({type:Vi,readOnly:!0})],ge.prototype,"renderDataExtent",null),u([d({readOnly:!0})],ge.prototype,"tileInfo",null),u([d({type:Vi,readOnly:!0})],ge.prototype,"dataExtent",null),u([d({type:Vi,readOnly:!0})],ge.prototype,"_groundAndLayersExtent",null),u([d({type:jh})],ge.prototype,"environment",void 0),u([Ir("environment")],ge.prototype,"castEnvironment",null),u([d({readOnly:!0})],ge.prototype,"environmentManager",void 0),u([d({type:Vi})],ge.prototype,"extent",null),u([d({type:ct})],ge.prototype,"floors",void 0),u([d()],ge.prototype,"screenCenter",null),u([d()],ge.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],ge.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],ge.prototype,"graphicsView",void 0),u([d({readOnly:!0})],ge.prototype,"analysisViewManager",void 0),u([d()],ge.prototype,"groundView",void 0),u([d({type:Boolean})],ge.prototype,"initialExtentRequired",null),u([d()],ge.prototype,"defaultsFromMapSettings",null),u([d()],ge.prototype,"interacting",null),u([d()],ge.prototype,"stationary",null),u([d()],ge.prototype,"navigating",null),u([d()],ge.prototype,"map",void 0),u([d()],ge.prototype,"padding",null),u([d({type:Mn,readOnly:!0})],ge.prototype,"pointsOfInterest",void 0),u([d({type:Tr,readOnly:!0})],ge.prototype,"featureTiles",void 0),u([d()],ge.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],ge.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],ge.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],ge.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],ge.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],ge.prototype,"state",void 0),u([d({readOnly:!0})],ge.prototype,"inputManager",void 0),u([d({readOnly:!0})],ge.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],ge.prototype,"qualityProfile",null),u([d({type:_O,get(){let e=this._get("qualitySettings");return e||(e=new _O,Wf.apply(this.qualityProfile,e)),e}})],ge.prototype,"qualitySettings",void 0),u([d()],ge.prototype,"slicePlane",null),u([d({readOnly:!0})],ge.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],ge.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],ge.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ge.prototype,"resolution",null),u([d({type:Number})],ge.prototype,"scale",null),u([d()],ge.prototype,"heightModelInfo",null),u([d()],ge.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],ge.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],ge.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],ge.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],ge.prototype,"type",void 0),u([d(),Ir(e=>e instanceof Bu?e:c0(ON,e))],ge.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],ge.prototype,"updating",null),u([d()],ge.prototype,"_updatingObjects",null),u([d()],ge.prototype,"_updatingObjectsWithProgress",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],ge.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],ge.prototype,"viewingMode",null),u([d({type:Si})],ge.prototype,"viewpoint",null),u([d({readOnly:!0})],ge.prototype,"visibleArea",null),u([d({type:Number})],ge.prototype,"zoom",null),u([d({type:_o})],ge.prototype,"highlightOptions",null),u([d({readOnly:!0})],ge.prototype,"quality",null),u([d({readOnly:!0})],ge.prototype,"resolutionScale",null),u([d()],ge.prototype,"textures",void 0),ge=u([C("esri.views.SceneView")],ge);var cx=w(),NN=Kt(),hW=Yt(),pW=ge;var $o=Math.PI,qi=$o*2,zv=$o/180,ESt=180/$o,Zre=1440,Qre=398600.8,Js=6378.135,Hc=60/Math.sqrt(Js*Js*Js/Qre),LN=Js*Hc/60,Yre=1/Hc,mp=.001082616,Kre=-253881e-11,Xre=-165597e-11,fp=Kre/mp,Gv=2/3,Jre=1440/(2*$o);function ene(e,t){for(var i=[31,e%4===0?29:28,31,30,31,30,31,31,30,31,30,31],r=Math.floor(t),n=1,s=0;r>s+i[n-1]&&n<12;)s+=i[n-1],n+=1;var o=n,a=r-s,l=(t-r)*24,c=Math.floor(l);l=(l-c)*60;var h=Math.floor(l),p=(l-h)*60;return{mon:o,day:a,hr:c,minute:h,sec:p}}function mW(e,t,i,r,n,s){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;return 367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+i+17210135e-1+((o/6e4+s/60+n)/60+r)/24}function ux(e,t,i,r,n,s){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(e instanceof Date){var a=e;return mW(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}return mW(e,t,i,r,n,s,o)}function fW(e,t){var i=e.e3,r=e.ee2,n=e.peo,s=e.pgho,o=e.pho,a=e.pinco,l=e.plo,c=e.se2,h=e.se3,p=e.sgh2,m=e.sgh3,f=e.sgh4,g=e.sh2,_=e.sh3,v=e.si2,b=e.si3,x=e.sl2,E=e.sl3,D=e.sl4,M=e.t,T=e.xgh2,I=e.xgh3,A=e.xgh4,O=e.xh2,$=e.xh3,H=e.xi2,k=e.xi3,K=e.xl2,F=e.xl3,R=e.xl4,j=e.zmol,B=e.zmos,z=t.init,ce=t.opsmode,ue=t.ep,Ie=t.inclp,le=t.nodep,ze=t.argpp,Le=t.mp,de,fe,st,De,Ee,Ae,He,Ve,_e,L,N,V,U,Y,re,ye,J,Z,Q,pe,Me,et=119459e-10,Je=.01675,$e=.00015835218,Ke=.0549;Me=B+et*M,z==="y"&&(Me=B),pe=Me+2*Je*Math.sin(Me),J=Math.sin(pe),L=.5*J*J-.25,N=-.5*J*Math.cos(pe);var at=c*L+h*N,Ze=v*L+b*N,Ge=x*L+E*N+D*J,y=p*L+m*N+f*J,qe=g*L+_*N;Me=j+$e*M,z==="y"&&(Me=j),pe=Me+2*Ke*Math.sin(Me),J=Math.sin(pe),L=.5*J*J-.25,N=-.5*J*Math.cos(pe);var je=r*L+i*N,tt=H*L+k*N,ht=K*L+F*N+R*J,it=T*L+I*N+A*J,Ye=O*L+$*N;return V=at+je,re=Ze+tt,ye=Ge+ht,U=y+it,Y=qe+Ye,z==="n"&&(V-=n,re-=a,ye-=l,U-=s,Y-=o,Ie+=re,ue+=V,De=Math.sin(Ie),st=Math.cos(Ie),Ie>=.2?(Y/=De,U-=st*Y,ze+=U,le+=Y,Le+=ye):(Ae=Math.sin(le),Ee=Math.cos(le),de=De*Ae,fe=De*Ee,He=Y*Ee+re*st*Ae,Ve=-Y*Ae+re*st*Ee,de+=He,fe+=Ve,le%=qi,le<0&&ce==="a"&&(le+=qi),Z=Le+ze+st*le,_e=ye+U-re*le*De,Z+=_e,Q=le,le=Math.atan2(de,fe),le<0&&ce==="a"&&(le+=qi),Math.abs(Q-le)>$o&&(le<Q?le+=qi:le-=qi),Le+=ye,ze=Z-Le-st*le)),{ep:ue,inclp:Ie,nodep:le,argpp:ze,mp:Le}}function tne(e){var t=e.epoch,i=e.ep,r=e.argpp,n=e.tc,s=e.inclp,o=e.nodep,a=e.np,l,c,h,p,m,f,g,_,v,b,x,E,D,M,T,I,A,O,$,H,k,K,F,R,j,B,z,ce,ue,Ie,le,ze,Le,de,fe,st,De,Ee,Ae,He,Ve,_e,L,N,V,U,Y,re,ye,J,Z,Q,pe,Me,et,Je,$e,Ke,at,Ze,Ge,y,qe,je=.01675,tt=.0549,ht=29864797e-13,it=47968065e-14,Ye=.39785416,gt=.91744867,wt=.1945905,xt=-.98088458,bi=a,Ci=i,li=Math.sin(o),ci=Math.cos(o),zt=Math.sin(r),bt=Math.cos(r),Qe=Math.sin(s),Gt=Math.cos(s),Ot=Ci*Ci,se=1-Ot,ri=Math.sqrt(se),Ur=0,Qn=0,Mt=0,Ds=0,Rn=0,Dr=t+18261.5+n/1440,xs=(4.523602-.00092422029*Dr)%qi,ar=Math.sin(xs),jr=Math.cos(xs),eo=.91375164-.03568096*jr,Ms=Math.sqrt(1-eo*eo),lr=.089683511*ar/Ms,xr=Math.sqrt(1-lr*lr),_i=5.8351514+.001944368*Dr,Yn=.39785416*ar/Ms,Ma=xr*jr+.91744867*lr*ar;Yn=Math.atan2(Yn,Ma),Yn+=_i-xs;var zr=Math.cos(Yn),Kn=Math.sin(Yn);H=wt,k=xt,R=gt,j=Ye,K=ci,F=li,x=ht;for(var to=1/bi,tr=0;tr<2;)tr+=1,l=H*K+k*R*F,h=-k*K+H*R*F,g=-H*F+k*R*K,_=k*j,v=k*F+H*R*K,b=H*j,c=Gt*g+Qe*_,p=Gt*v+Qe*b,m=-Qe*g+Gt*_,f=-Qe*v+Gt*b,E=l*bt+c*zt,D=h*bt+p*zt,M=-l*zt+c*bt,T=-h*zt+p*bt,I=m*zt,A=f*zt,O=m*bt,$=f*bt,Ge=12*E*E-3*M*M,y=24*E*D-6*M*T,qe=12*D*D-3*T*T,Q=3*(l*l+c*c)+Ge*Ot,pe=6*(l*h+c*p)+y*Ot,Me=3*(h*h+p*p)+qe*Ot,et=-6*l*m+Ot*(-24*E*O-6*M*I),Je=-6*(l*f+h*m)+Ot*(-24*(D*O+E*$)+-6*(M*A+T*I)),$e=-6*h*f+Ot*(-24*D*$-6*T*A),Ke=6*c*m+Ot*(24*E*I-6*M*O),at=6*(p*m+c*f)+Ot*(24*(D*I+E*A)-6*(T*O+M*$)),Ze=6*p*f+Ot*(24*D*A-6*T*$),Q=Q+Q+se*Ge,pe=pe+pe+se*y,Me=Me+Me+se*qe,Y=x*to,U=-.5*Y/ri,re=Y*ri,V=-15*Ci*re,ye=E*M+D*T,J=D*M+E*T,Z=D*T-E*M,tr===1&&(B=V,z=U,ce=Y,ue=re,Ie=ye,le=J,ze=Z,Le=Q,de=pe,fe=Me,st=et,De=Je,Ee=$e,Ae=Ke,He=at,Ve=Ze,_e=Ge,L=y,N=qe,H=zr,k=Kn,R=eo,j=Ms,K=xr*ci+lr*li,F=li*xr-ci*lr,x=it);var Xn=(4.7199672+(.2299715*Dr-_i))%qi,Sa=(6.2565837+.017201977*Dr)%qi,Bc=2*B*le,Ss=2*B*ze,io=2*z*De,kl=2*z*(Ee-st),Ia=-2*ce*de,gp=-2*ce*(fe-Le),_p=-2*ce*(-21-9*Ot)*je,Aa=2*ue*L,vd=2*ue*(N-_e),wd=-18*ue*je,Is=-2*z*He,Ra=-2*z*(Ve-Ae),Uc=2*V*J,yp=2*V*Z,vp=2*U*Je,Dg=2*U*($e-et),Kv=-2*Y*pe,Xv=-2*Y*(Me-Q),Jv=-2*Y*(-21-9*Ot)*tt,xg=2*re*y,qW=2*re*(qe-Ge),WW=-18*re*tt,$W=-2*U*at,ZW=-2*U*(Ze-Ke);return{snodm:li,cnodm:ci,sinim:Qe,cosim:Gt,sinomm:zt,cosomm:bt,day:Dr,e3:yp,ee2:Uc,em:Ci,emsq:Ot,gam:_i,peo:Ur,pgho:Ds,pho:Rn,pinco:Qn,plo:Mt,rtemsq:ri,se2:Bc,se3:Ss,sgh2:Aa,sgh3:vd,sgh4:wd,sh2:Is,sh3:Ra,si2:io,si3:kl,sl2:Ia,sl3:gp,sl4:_p,s1:V,s2:U,s3:Y,s4:re,s5:ye,s6:J,s7:Z,ss1:B,ss2:z,ss3:ce,ss4:ue,ss5:Ie,ss6:le,ss7:ze,sz1:Le,sz2:de,sz3:fe,sz11:st,sz12:De,sz13:Ee,sz21:Ae,sz22:He,sz23:Ve,sz31:_e,sz32:L,sz33:N,xgh2:xg,xgh3:qW,xgh4:WW,xh2:$W,xh3:ZW,xi2:vp,xi3:Dg,xl2:Kv,xl3:Xv,xl4:Jv,nm:bi,z1:Q,z2:pe,z3:Me,z11:et,z12:Je,z13:$e,z21:Ke,z22:at,z23:Ze,z31:Ge,z32:y,z33:qe,zmol:Xn,zmos:Sa}}function ine(e){var t=e.cosim,i=e.argpo,r=e.s1,n=e.s2,s=e.s3,o=e.s4,a=e.s5,l=e.sinim,c=e.ss1,h=e.ss2,p=e.ss3,m=e.ss4,f=e.ss5,g=e.sz1,_=e.sz3,v=e.sz11,b=e.sz13,x=e.sz21,E=e.sz23,D=e.sz31,M=e.sz33,T=e.t,I=e.tc,A=e.gsto,O=e.mo,$=e.mdot,H=e.no,k=e.nodeo,K=e.nodedot,F=e.xpidot,R=e.z1,j=e.z3,B=e.z11,z=e.z13,ce=e.z21,ue=e.z23,Ie=e.z31,le=e.z33,ze=e.ecco,Le=e.eccsq,de=e.emsq,fe=e.em,st=e.argpm,De=e.inclm,Ee=e.mm,Ae=e.nm,He=e.nodem,Ve=e.irez,_e=e.atime,L=e.d2201,N=e.d2211,V=e.d3210,U=e.d3222,Y=e.d4410,re=e.d4422,ye=e.d5220,J=e.d5232,Z=e.d5421,Q=e.d5433,pe=e.dedt,Me=e.didt,et=e.dmdt,Je=e.dnodt,$e=e.domdt,Ke=e.del1,at=e.del2,Ze=e.del3,Ge=e.xfact,y=e.xlamo,qe=e.xli,je=e.xni,tt,ht,it,Ye,gt,wt,xt,bi,Ci,li,ci,zt,bt,Qe,Gt,Ot,se,ri,Ur,Qn,Mt,Ds,Rn,Dr,xs,ar,jr,eo,Ms,lr,xr,_i,Yn=17891679e-13,Ma=21460748e-13,zr=22123015e-14,Kn=17891679e-13,to=73636953e-16,tr=21765803e-16,Xn=.0043752690880113,Sa=37393792e-14,Bc=11428639e-14,Ss=.00015835218,io=119459e-10;Ve=0,Ae<.0052359877&&Ae>.0034906585&&(Ve=1),Ae>=.00826&&Ae<=.00924&&fe>=.5&&(Ve=2);var kl=c*io*f,Ia=h*io*(v+b),gp=-io*p*(g+_-14-6*de),_p=m*io*(D+M-6),Aa=-io*h*(x+E);(De<.052359877||De>$o-.052359877)&&(Aa=0),l!==0&&(Aa/=l);var vd=_p-t*Aa;pe=kl+r*Ss*a,Me=Ia+n*Ss*(B+z),et=gp-Ss*s*(R+j-14-6*de);var wd=o*Ss*(Ie+le-6),Is=-Ss*n*(ce+ue);(De<.052359877||De>$o-.052359877)&&(Is=0),$e=vd+wd,Je=Aa,l!==0&&($e-=t/l*Is,Je+=Is/l);var Ra=0,Uc=(A+I*Xn)%qi;if(fe+=pe*T,De+=Me*T,st+=$e*T,He+=Je*T,Ee+=et*T,Ve!==0){if(lr=Math.pow(Ae/Hc,Gv),Ve===2){xr=t*t;var yp=fe;fe=ze;var vp=de;de=Le,_i=fe*de,Qe=-.306-(fe-.64)*.44,fe<=.65?(Gt=3.616-13.247*fe+16.29*de,se=-19.302+117.39*fe-228.419*de+156.591*_i,ri=-18.9068+109.7927*fe-214.6334*de+146.5816*_i,Ur=-41.122+242.694*fe-471.094*de+313.953*_i,Qn=-146.407+841.88*fe-1629.014*de+1083.435*_i,Mt=-532.114+3017.977*fe-5740.032*de+3708.276*_i):(Gt=-72.099+331.819*fe-508.738*de+266.724*_i,se=-346.844+1582.851*fe-2415.925*de+1246.113*_i,ri=-342.585+1554.908*fe-2366.899*de+1215.972*_i,Ur=-1052.797+4758.686*fe-7193.992*de+3651.957*_i,Qn=-3581.69+16178.11*fe-24462.77*de+12422.52*_i,fe>.715?Mt=-5149.66+29936.92*fe-54087.36*de+31324.56*_i:Mt=1464.74-4664.75*fe+3763.64*de),fe<.7?(Dr=-919.2277+4988.61*fe-9064.77*de+5542.21*_i,Ds=-822.71072+4568.6173*fe-8491.4146*de+5337.524*_i,Rn=-853.666+4690.25*fe-8624.77*de+5341.4*_i):(Dr=-37995.78+161616.52*fe-229838.2*de+109377.94*_i,Ds=-51752.104+218913.95*fe-309468.16*de+146349.42*_i,Rn=-40023.88+170470.89*fe-242699.48*de+115605.82*_i),xs=l*l,tt=.75*(1+2*t+xr),ht=1.5*xs,Ye=1.875*l*(1-2*t-3*xr),gt=-1.875*l*(1+2*t-3*xr),xt=35*xs*tt,bi=39.375*xs*xs,Ci=9.84375*l*(xs*(1-2*t-5*xr)+.33333333*(-2+4*t+6*xr)),li=l*(4.92187512*xs*(-2-4*t+10*xr)+6.56250012*(1+2*t-3*xr)),ci=29.53125*l*(2-8*t+xr*(-12+8*t+10*xr)),zt=29.53125*l*(-2-8*t+xr*(12+8*t-10*xr)),eo=Ae*Ae,Ms=lr*lr,jr=3*eo*Ms,ar=jr*Kn,L=ar*tt*Qe,N=ar*ht*Gt,jr*=lr,ar=jr*Sa,V=ar*Ye*se,U=ar*gt*ri,jr*=lr,ar=2*jr*to,Y=ar*xt*Ur,re=ar*bi*Qn,jr*=lr,ar=jr*Bc,ye=ar*Ci*Mt,J=ar*li*Rn,ar=2*jr*tr,Z=ar*ci*Ds,Q=ar*zt*Dr,y=(O+k+k-(Uc+Uc))%qi,Ge=$+et+2*(K+Je-Xn)-H,fe=yp,de=vp}Ve===1&&(bt=1+de*(-2.5+.8125*de),se=1+2*de,Ot=1+de*(-6+6.60937*de),tt=.75*(1+t)*(1+t),it=.9375*l*l*(1+3*t)-.75*(1+t),wt=1+t,wt*=1.875*wt*wt,Ke=3*Ae*Ae*lr*lr,at=2*Ke*tt*bt*Yn,Ze=3*Ke*wt*Ot*zr*lr,Ke=Ke*it*se*Ma*lr,y=(O+k+i-Uc)%qi,Ge=$+F+et+$e+Je-(H+Xn)),qe=y,je=H,_e=0,Ae=H+Ra}return{em:fe,argpm:st,inclm:De,mm:Ee,nm:Ae,nodem:He,irez:Ve,atime:_e,d2201:L,d2211:N,d3210:V,d3222:U,d4410:Y,d4422:re,d5220:ye,d5232:J,d5421:Z,d5433:Q,dedt:pe,didt:Me,dmdt:et,dndt:Ra,dnodt:Je,domdt:$e,del1:Ke,del2:at,del3:Ze,xfact:Ge,xlamo:y,xli:qe,xni:je}}function FN(e){var t=(e-2451545)/36525,i=-62e-7*t*t*t+.093104*t*t+(876600*3600+8640184812866e-6)*t+67310.54841;return i=i*zv/240%qi,i<0&&(i+=qi),i}function kN(e,t,i,r,n,s,o){return e instanceof Date?FN(ux(e)):FN(t!==void 0?ux(e,t,i,r,n,s,o):e)}function rne(e){var t=e.ecco,i=e.epoch,r=e.inclo,n=e.opsmode,s=e.no,o=t*t,a=1-o,l=Math.sqrt(a),c=Math.cos(r),h=c*c,p=Math.pow(Hc/s,Gv),m=.75*mp*(3*h-1)/(l*a),f=m/(p*p),g=p*(1-f*f-f*(1/3+134*f*f/81));f=m/(g*g),s/=1+f;var _=Math.pow(Hc/s,Gv),v=Math.sin(r),b=_*a,x=1-5*h,E=-x-h-h,D=1/_,M=b*b,T=_*(1-t),I="n",A;if(n==="a"){var O=i-7305,$=Math.floor(O+1e-8),H=O-$,k=.017202791694070362,K=1.7321343856509375,F=5075514194322695e-30,R=k+qi;A=(K+k*$+R*H+O*O*F)%qi,A<0&&(A+=qi)}else A=kN(i+24332815e-1);return{no:s,method:I,ainv:D,ao:_,con41:E,con42:x,cosio:c,cosio2:h,eccsq:o,omeosq:a,posq:M,rp:T,rteosq:l,sinio:v,gsto:A}}function nne(e){var t=e.irez,i=e.d2201,r=e.d2211,n=e.d3210,s=e.d3222,o=e.d4410,a=e.d4422,l=e.d5220,c=e.d5232,h=e.d5421,p=e.d5433,m=e.dedt,f=e.del1,g=e.del2,_=e.del3,v=e.didt,b=e.dmdt,x=e.dnodt,E=e.domdt,D=e.argpo,M=e.argpdot,T=e.t,I=e.tc,A=e.gsto,O=e.xfact,$=e.xlamo,H=e.no,k=e.atime,K=e.em,F=e.argpm,R=e.inclm,j=e.xli,B=e.mm,z=e.xni,ce=e.nodem,ue=e.nm,Ie=.13130908,le=2.8843198,ze=.37448087,Le=5.7686396,de=.95240898,fe=1.8014998,st=1.050833,De=4.4108898,Ee=.0043752690880113,Ae=720,He=-720,Ve=259200,_e,L,N,V,U,Y,re,ye,J=0,Z=0,Q=(A+I*Ee)%qi;if(K+=m*T,R+=v*T,F+=E*T,ce+=x*T,B+=b*T,t!==0){(k===0||T*k<=0||Math.abs(T)<Math.abs(k))&&(k=0,z=H,j=$),T>0?_e=Ae:_e=He;for(var pe=381;pe===381;)t!==2?(re=f*Math.sin(j-Ie)+g*Math.sin(2*(j-le))+_*Math.sin(3*(j-ze)),U=z+O,Y=f*Math.cos(j-Ie)+2*g*Math.cos(2*(j-le))+3*_*Math.cos(3*(j-ze)),Y*=U):(ye=D+M*k,N=ye+ye,L=j+j,re=i*Math.sin(N+j-Le)+r*Math.sin(j-Le)+n*Math.sin(ye+j-de)+s*Math.sin(-ye+j-de)+o*Math.sin(N+L-fe)+a*Math.sin(L-fe)+l*Math.sin(ye+j-st)+c*Math.sin(-ye+j-st)+h*Math.sin(ye+L-De)+p*Math.sin(-ye+L-De),U=z+O,Y=i*Math.cos(N+j-Le)+r*Math.cos(j-Le)+n*Math.cos(ye+j-de)+s*Math.cos(-ye+j-de)+l*Math.cos(ye+j-st)+c*Math.cos(-ye+j-st)+2*(o*Math.cos(N+L-fe)+a*Math.cos(L-fe)+h*Math.cos(ye+L-De)+p*Math.cos(-ye+L-De)),Y*=U),Math.abs(T-k)>=Ae?pe=381:(Z=T-k,pe=0),pe===381&&(j+=U*_e+re*Ve,z+=re*_e+Y*Ve,k+=_e);ue=z+re*Z+Y*Z*Z*.5,V=j+U*Z+re*Z*Z*.5,t!==1?(B=V-2*ce+2*Q,J=ue-H):(B=V-ce-F+Q,J=ue-H),ue=H+J}return{atime:k,em:K,argpm:F,inclm:R,xli:j,mm:B,xni:z,nodem:ce,dndt:J,nm:ue}}var pp=function(e){return e[e.None=0]="None",e[e.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",e[e.MeanMotionBelowZero=2]="MeanMotionBelowZero",e[e.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",e[e.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",e[e.Decayed=6]="Decayed",e}(pp||{});function gW(e,t){var i,r,n,s,o,a,l,c,h,p,m,f,g,_,v,b,x,E,D,M,T,I,A,O,$,H,k,K=15e-13;e.t=t,e.error=pp.None;var F=e.mo+e.mdot*e.t,R=e.argpo+e.argpdot*e.t,j=e.nodeo+e.nodedot*e.t;h=R,T=F;var B=e.t*e.t;if(A=j+e.nodecf*B,x=1-e.cc1*e.t,E=e.bstar*e.cc4*e.t,D=e.t2cof*B,e.isimp!==1){l=e.omgcof*e.t;var z=1+e.eta*Math.cos(F);a=e.xmcof*(z*z*z-e.delmo),b=l+a,T=F+b,h=R-b,f=B*e.t,g=f*e.t,x=x-e.d2*B-e.d3*f-e.d4*g,E+=e.bstar*e.cc5*(Math.sin(T)-e.sinmao),D=D+e.t3cof*f+g*(e.t4cof+e.t*e.t5cof)}I=e.no;var ce=e.ecco;if(M=e.inclo,e.method==="d"){_=e.t;var ue={irez:e.irez,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,del1:e.del1,del2:e.del2,del3:e.del3,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,argpo:e.argpo,argpdot:e.argpdot,t:e.t,tc:_,gsto:e.gsto,xfact:e.xfact,xlamo:e.xlamo,no:e.no,atime:e.atime,em:ce,argpm:h,inclm:M,xli:e.xli,mm:T,xni:e.xni,nodem:A,nm:I},Ie=nne(ue);ce=Ie.em,h=Ie.argpm,M=Ie.inclm,T=Ie.mm,A=Ie.nodem,I=Ie.nm}if(I<=0)return e.error=pp.MeanMotionBelowZero,null;var le=Math.pow(Hc/I,Gv)*x*x;if(I=Hc/Math.pow(le,1.5),ce-=E,ce>=1||ce<-.001)return e.error=pp.MeanEccentricityOutOfRange,null;ce<1e-6&&(ce=1e-6),T+=e.no*D,$=T+h+A,A%=qi,h%=qi,$%=qi,T=($-h-A)%qi;var ze={am:le,em:ce,im:M,Om:A,om:h,mm:T,nm:I},Le=Math.sin(M),de=Math.cos(M),fe=ce;if(O=M,p=h,k=A,H=T,s=Le,n=de,e.method==="d"){var st={inclo:e.inclo,init:"n",ep:fe,inclp:O,nodep:k,argpp:p,mp:H,opsmode:e.operationmode},De=fW(e,st);if(fe=De.ep,k=De.nodep,p=De.argpp,H=De.mp,O=De.inclp,O<0&&(O=-O,k+=$o,p-=$o),fe<0||fe>1)return e.error=pp.PerturbedEccentricityOutOfRange,null}e.method==="d"&&(s=Math.sin(O),n=Math.cos(O),e.aycof=-.5*fp*s,Math.abs(n+1)>15e-13?e.xlcof=-.25*fp*s*(3+5*n)/(1+n):e.xlcof=-.25*fp*s*(3+5*n)/K);var Ee=fe*Math.cos(p);b=1/(le*(1-fe*fe));var Ae=fe*Math.sin(p)+b*e.aycof,He=H+p+k+b*e.xlcof*Ee,Ve=(He-k)%qi;c=Ve,v=9999.9;for(var _e=1;Math.abs(v)>=1e-12&&_e<=10;)r=Math.sin(c),i=Math.cos(c),v=1-i*Ee-r*Ae,v=(Ve-Ae*i+Ee*r-c)/v,Math.abs(v)>=.95&&(v>0?v=.95:v=-.95),c+=v,_e+=1;var L=Ee*i+Ae*r,N=Ee*r-Ae*i,V=Ee*Ee+Ae*Ae,U=le*(1-V);if(U<0)return e.error=pp.SemiLatusRectumBelowZero,null;var Y=le*(1-L),re=Math.sqrt(le)*N/Y,ye=Math.sqrt(U)/Y,J=Math.sqrt(1-V);b=N/(1+J);var Z=le/Y*(r-Ae-Ee*b),Q=le/Y*(i-Ee+Ae*b);m=Math.atan2(Z,Q);var pe=(Q+Q)*Z,Me=1-2*Z*Z;b=1/U;var et=.5*mp*b,Je=et*b;e.method==="d"&&(o=n*n,e.con41=3*o-1,e.x1mth2=1-o,e.x7thm1=7*o-1);var $e=Y*(1-1.5*Je*J*e.con41)+.5*et*e.x1mth2*Me;if($e<1)return e.error=pp.Decayed,null;m-=.25*Je*e.x7thm1*pe;var Ke=k+1.5*Je*n*pe,at=O+1.5*Je*n*s*Me,Ze=re-I*et*e.x1mth2*pe/Hc,Ge=ye+I*et*(e.x1mth2*Me+1.5*e.con41)/Hc,y=Math.sin(m),qe=Math.cos(m),je=Math.sin(Ke),tt=Math.cos(Ke),ht=Math.sin(at),it=Math.cos(at),Ye=-je*it,gt=tt*it,wt=Ye*y+tt*qe,xt=gt*y+je*qe,bi=ht*y,Ci=Ye*qe-tt*y,li=gt*qe-je*y,ci=ht*qe,zt={x:$e*wt*Js,y:$e*xt*Js,z:$e*bi*Js},bt={x:(Ze*wt+Ge*Ci)*LN,y:(Ze*xt+Ge*li)*LN,z:(Ze*bi+Ge*ci)*LN};return{position:zt,velocity:bt,meanElements:ze}}function sne(e,t){var i=t.opsmode,r=t.satn,n=t.epoch,s=t.xbstar,o=t.xecco,a=t.xargpo,l=t.xinclo,c=t.xmo,h=t.xno,p=t.xnodeo,m,f,g,_,v,b,x,E,D,M,T,I,A,O,$,H,k,K,F,R,j,B,z,ce,ue,Ie,le,ze,Le,de,fe,st,De,Ee,Ae,He,Ve,_e,L,N,V,U,Y,re,ye,J,Z,Q,pe,Me,et,Je,$e,Ke,at,Ze,Ge=15e-13,y=e;y.isimp=0,y.method="n",y.aycof=0,y.con41=0,y.cc1=0,y.cc4=0,y.cc5=0,y.d2=0,y.d3=0,y.d4=0,y.delmo=0,y.eta=0,y.argpdot=0,y.omgcof=0,y.sinmao=0,y.t=0,y.t2cof=0,y.t3cof=0,y.t4cof=0,y.t5cof=0,y.x1mth2=0,y.x7thm1=0,y.mdot=0,y.nodedot=0,y.xlcof=0,y.xmcof=0,y.nodecf=0,y.irez=0,y.d2201=0,y.d2211=0,y.d3210=0,y.d3222=0,y.d4410=0,y.d4422=0,y.d5220=0,y.d5232=0,y.d5421=0,y.d5433=0,y.dedt=0,y.del1=0,y.del2=0,y.del3=0,y.didt=0,y.dmdt=0,y.dnodt=0,y.domdt=0,y.e3=0,y.ee2=0,y.peo=0,y.pgho=0,y.pho=0,y.pinco=0,y.plo=0,y.se2=0,y.se3=0,y.sgh2=0,y.sgh3=0,y.sgh4=0,y.sh2=0,y.sh3=0,y.si2=0,y.si3=0,y.sl2=0,y.sl3=0,y.sl4=0,y.gsto=0,y.xfact=0,y.xgh2=0,y.xgh3=0,y.xgh4=0,y.xh2=0,y.xh3=0,y.xi2=0,y.xi3=0,y.xl2=0,y.xl3=0,y.xl4=0,y.xlamo=0,y.zmol=0,y.zmos=0,y.atime=0,y.xli=0,y.xni=0,y.bstar=s,y.ecco=o,y.argpo=a,y.inclo=l,y.mo=c,y.no=h,y.nodeo=p,y.operationmode=i;var qe=78/Js+1,je=42/Js,tt=je*je*je*je;y.init="y",y.t=0;var ht={satn:r,ecco:y.ecco,epoch:n,inclo:y.inclo,no:y.no,method:y.method,opsmode:y.operationmode},it=rne(ht),Ye=it.ao,gt=it.con42,wt=it.cosio,xt=it.cosio2,bi=it.eccsq,Ci=it.omeosq,li=it.posq,ci=it.rp,zt=it.rteosq,bt=it.sinio;if(y.no=it.no,y.con41=it.con41,y.gsto=it.gsto,y.a=Math.pow(y.no*Yre,-2/3),y.alta=y.a*(1+y.ecco)-1,y.altp=y.a*(1-y.ecco)-1,y.error=0,Ci>=0||y.no>=0){if(y.isimp=0,ci<220/Js+1&&(y.isimp=1),le=qe,j=tt,K=(ci-1)*Js,K<156){le=K-78,K<98&&(le=20);var Qe=(120-le)/Js;j=Qe*Qe*Qe*Qe,le=le/Js+1}F=1/li,J=1/(Ye-le),y.eta=Ye*y.ecco*J,I=y.eta*y.eta,T=y.ecco*y.eta,R=Math.abs(1-I),b=j*Math.pow(J,4),x=b/Math.pow(R,3.5),_=x*y.no*(Ye*(1+1.5*I+T*(4+I))+.375*mp*J/R*y.con41*(8+3*I*(8+I))),y.cc1=y.bstar*_,v=0,y.ecco>1e-4&&(v=-2*b*J*fp*y.no*bt/y.ecco),y.x1mth2=1-xt,y.cc4=2*y.no*x*Ye*Ci*(y.eta*(2+.5*I)+y.ecco*(.5+2*I)-mp*J/(Ye*R)*(-3*y.con41*(1-2*T+I*(1.5-.5*T))+.75*y.x1mth2*(2*I-T*(1+I))*Math.cos(2*y.argpo))),y.cc5=2*x*Ye*Ci*(1+2.75*(I+T)+T*I),E=xt*xt,Y=1.5*mp*F*y.no,re=.5*Y*mp*F,ye=-.46875*Xre*F*F*y.no,y.mdot=y.no+.5*Y*zt*y.con41+.0625*re*zt*(13-78*xt+137*E),y.argpdot=-.5*Y*gt+.0625*re*(7-114*xt+395*E)+ye*(3-36*xt+49*E),Q=-Y*wt,y.nodedot=Q+(.5*re*(4-19*xt)+2*ye*(3-7*xt))*wt,Z=y.argpdot+y.nodedot,y.omgcof=y.bstar*v*Math.cos(y.argpo),y.xmcof=0,y.ecco>1e-4&&(y.xmcof=-Gv*b*y.bstar/T),y.nodecf=3.5*Ci*Q*y.cc1,y.t2cof=1.5*y.cc1,Math.abs(wt+1)>15e-13?y.xlcof=-.25*fp*bt*(3+5*wt)/(1+wt):y.xlcof=-.25*fp*bt*(3+5*wt)/Ge,y.aycof=-.5*fp*bt;var Gt=1+y.eta*Math.cos(y.mo);if(y.delmo=Gt*Gt*Gt,y.sinmao=Math.sin(y.mo),y.x7thm1=7*xt-1,2*$o/y.no>=225){y.method="d",y.isimp=1,V=0,$=y.inclo;var Ot={epoch:n,ep:y.ecco,argpp:y.argpo,tc:V,inclp:y.inclo,nodep:y.nodeo,np:y.no,e3:y.e3,ee2:y.ee2,peo:y.peo,pgho:y.pgho,pho:y.pho,pinco:y.pinco,plo:y.plo,se2:y.se2,se3:y.se3,sgh2:y.sgh2,sgh3:y.sgh3,sgh4:y.sgh4,sh2:y.sh2,sh3:y.sh3,si2:y.si2,si3:y.si3,sl2:y.sl2,sl3:y.sl3,sl4:y.sl4,xgh2:y.xgh2,xgh3:y.xgh3,xgh4:y.xgh4,xh2:y.xh2,xh3:y.xh3,xi2:y.xi2,xi3:y.xi3,xl2:y.xl2,xl3:y.xl3,xl4:y.xl4,zmol:y.zmol,zmos:y.zmos},se=tne(Ot);y.e3=se.e3,y.ee2=se.ee2,y.peo=se.peo,y.pgho=se.pgho,y.pho=se.pho,y.pinco=se.pinco,y.plo=se.plo,y.se2=se.se2,y.se3=se.se3,y.sgh2=se.sgh2,y.sgh3=se.sgh3,y.sgh4=se.sgh4,y.sh2=se.sh2,y.sh3=se.sh3,y.si2=se.si2,y.si3=se.si3,y.sl2=se.sl2,y.sl3=se.sl3,y.sl4=se.sl4,f=se.sinim,m=se.cosim,D=se.em,M=se.emsq,B=se.s1,z=se.s2,ce=se.s3,ue=se.s4,Ie=se.s5,ze=se.ss1,Le=se.ss2,de=se.ss3,fe=se.ss4,st=se.ss5,De=se.sz1,Ee=se.sz3,Ae=se.sz11,He=se.sz13,Ve=se.sz21,_e=se.sz23,L=se.sz31,N=se.sz33,y.xgh2=se.xgh2,y.xgh3=se.xgh3,y.xgh4=se.xgh4,y.xh2=se.xh2,y.xh3=se.xh3,y.xi2=se.xi2,y.xi3=se.xi3,y.xl2=se.xl2,y.xl3=se.xl3,y.xl4=se.xl4,y.zmol=se.zmol,y.zmos=se.zmos,k=se.nm,pe=se.z1,Me=se.z3,et=se.z11,Je=se.z13,$e=se.z21,Ke=se.z23,at=se.z31,Ze=se.z33;var ri={inclo:$,init:y.init,ep:y.ecco,inclp:y.inclo,nodep:y.nodeo,argpp:y.argpo,mp:y.mo,opsmode:y.operationmode},Ur=fW(y,ri);y.ecco=Ur.ep,y.inclo=Ur.inclp,y.nodeo=Ur.nodep,y.argpo=Ur.argpp,y.mo=Ur.mp,A=0,O=0,H=0;var Qn={cosim:m,emsq:M,argpo:y.argpo,s1:B,s2:z,s3:ce,s4:ue,s5:Ie,sinim:f,ss1:ze,ss2:Le,ss3:de,ss4:fe,ss5:st,sz1:De,sz3:Ee,sz11:Ae,sz13:He,sz21:Ve,sz23:_e,sz31:L,sz33:N,t:y.t,tc:V,gsto:y.gsto,mo:y.mo,mdot:y.mdot,no:y.no,nodeo:y.nodeo,nodedot:y.nodedot,xpidot:Z,z1:pe,z3:Me,z11:et,z13:Je,z21:$e,z23:Ke,z31:at,z33:Ze,ecco:y.ecco,eccsq:bi,em:D,argpm:A,inclm:$,mm:H,nm:k,nodem:O,irez:y.irez,atime:y.atime,d2201:y.d2201,d2211:y.d2211,d3210:y.d3210,d3222:y.d3222,d4410:y.d4410,d4422:y.d4422,d5220:y.d5220,d5232:y.d5232,d5421:y.d5421,d5433:y.d5433,dedt:y.dedt,didt:y.didt,dmdt:y.dmdt,dnodt:y.dnodt,domdt:y.domdt,del1:y.del1,del2:y.del2,del3:y.del3,xfact:y.xfact,xlamo:y.xlamo,xli:y.xli,xni:y.xni},Mt=ine(Qn);y.irez=Mt.irez,y.atime=Mt.atime,y.d2201=Mt.d2201,y.d2211=Mt.d2211,y.d3210=Mt.d3210,y.d3222=Mt.d3222,y.d4410=Mt.d4410,y.d4422=Mt.d4422,y.d5220=Mt.d5220,y.d5232=Mt.d5232,y.d5421=Mt.d5421,y.d5433=Mt.d5433,y.dedt=Mt.dedt,y.didt=Mt.didt,y.dmdt=Mt.dmdt,y.dnodt=Mt.dnodt,y.domdt=Mt.domdt,y.del1=Mt.del1,y.del2=Mt.del2,y.del3=Mt.del3,y.xfact=Mt.xfact,y.xlamo=Mt.xlamo,y.xli=Mt.xli,y.xni=Mt.xni}y.isimp!==1&&(g=y.cc1*y.cc1,y.d2=4*Ye*J*g,U=y.d2*J*y.cc1/3,y.d3=(17*Ye+le)*U,y.d4=.5*U*Ye*J*(221*Ye+31*le)*y.cc1,y.t3cof=y.d2+2*g,y.t4cof=.25*(3*y.d3+y.cc1*(12*y.d2+10*g)),y.t5cof=.2*(3*y.d4+12*y.cc1*y.d3+6*y.d2*y.d2+15*g*(2*y.d2+g)))}gW(y,0),y.init="n"}function _W(e,t){var i="i",r=0,n=e.substring(2,7),s=parseInt(e.substring(18,20),10),o=parseFloat(e.substring(20,32)),a=parseFloat(e.substring(33,43)),l=parseFloat("".concat(e.substring(44,45),".").concat(e.substring(45,50),"E").concat(e.substring(50,52))),c=parseFloat("".concat(e.substring(53,54),".").concat(e.substring(54,59),"E").concat(e.substring(59,61))),h=parseFloat(t.substring(8,16))*zv,p=parseFloat(t.substring(17,25))*zv,m=parseFloat(".".concat(t.substring(26,33))),f=parseFloat(t.substring(34,42))*zv,g=parseFloat(t.substring(43,51))*zv,_=parseFloat(t.substring(52,63))/Jre,v=s<57?s+2e3:s+1900,b=ene(v,o),x=b.mon,E=b.day,D=b.hr,M=b.minute,T=b.sec,I=ux(v,x,E,D,M,T),A={error:r,satnum:n,epochyr:s,epochdays:o,ndot:a,nddot:l,bstar:c,inclo:h,nodeo:p,ecco:m,argpo:f,mo:g,no:_,jdsatepoch:I};return sne(A,{opsmode:i,satn:A.satnum,epoch:A.jdsatepoch-24332815e-1,xbstar:A.bstar,xecco:A.ecco,xargpo:A.argpo,xinclo:A.inclo,xmo:A.mo,xno:A.no,xnodeo:A.nodeo}),A}function yW(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var n=ux.apply(void 0,i),s=(n-e.jdsatepoch)*Zre;return gW(e,s)}function vW(e,t){for(var i=6378.137,r=6356.7523142,n=Math.sqrt(e.x*e.x+e.y*e.y),s=(i-r)/i,o=2*s-s*s,a=Math.atan2(e.y,e.x)-t;a<-$o;)a+=qi;for(;a>$o;)a-=qi;for(var l=20,c=0,h=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y)),p;c++<l;)p=1/Math.sqrt(1-o*(Math.sin(h)*Math.sin(h))),h=Math.atan2(e.z+i*p*o*Math.sin(h),n);var m=n/Math.cos(h)-i*p;return{longitude:a,latitude:h,height:m}}var dx=class e{satellites=[];async loadBaseSatellites(t){let r=(await jc(t,{responseType:"text"})).data.split(`
`),n=Math.floor(r.length/3),s=Date.now();for(let o=0;o<n;o++){let a=r[o*3].trim(),l=r[o*3+1].trim(),c=r[o*3+2].trim();!a||!l||!c||this.satellites.push({name:a,line1:l,line2:c,time:s,origin:"base"})}}addUserSatellite(t,i,r){this.satellites.push({name:t,line1:i,line2:r,time:Date.now(),origin:"user"})}getAllSatellites(){return this.satellites}static \u0275fac=function(i){return new(i||e)};static \u0275prov=jt({token:e,factory:e.\u0275fac,providedIn:"root"})};var lne=["viewDiv"],hx=class e{constructor(t){this.satelliteService=t}viewDiv;async ngAfterViewInit(){let t=new Yg,i=new Yg,r=new Su({basemap:"satellite",layers:[t,i]}),n=new pW({container:this.viewDiv.nativeElement,map:r,constraints:{altitude:{max:12e9}},popup:new eV({dockEnabled:!0,dockOptions:{breakpoint:!1}}),environment:{lighting:{type:"virtual"}}});S(()=>n.popup?.selectedFeature,()=>i.removeAll()),n.popup?.on("trigger-action",c=>{if(c.action.id==="track"){i.removeAll();let h=n.popup?.selectedFeature,p=[];for(let f=0;f<60*24;f++){let g=this.getSatelliteLocation(new Date(h?.attributes.time+f*60*1e3),h?.attributes.line1,h?.attributes.line2);g&&p.push([g.x,g.y,g.z])}let m=new rs({geometry:{type:"polyline",paths:[p]},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:[192,192,192,.5]},size:3}]}});i.add(m)}});let o=await jc("https://developers.arcgis.com/javascript/latest/sample-code/satellites-3d/live/brightest.txt",{responseType:"text"});console.log("Loaded TLE data:",o.data);let a=o.data.split(`
`),l=Math.floor(a.length/3);for(let c=0;c<l;c++){let h=a[c*3],p=a[c*3+1],m=a[c*3+2],f=Date.now();if(h.includes("COSMOS")){let g=p.substring(9,16),_=Number(g.substring(0,2))>=57?`19${g.substring(0,2)}`:`20${g.substring(0,2)}`,v=Number(g.substring(2,5)).toString(),b=Number(p.substring(2,7)),x=this.getSatelliteLocation(new Date(f),p,m);if(!x)continue;let E={title:"{name}",content:"Launch number {number} of {year}"};t.add(new rs({geometry:x,symbol:{type:"picture-marker",url:"https://developers.arcgis.com/javascript/latest/sample-code/satellites-3d/live/satellite.png",width:48,height:48},attributes:{name:h,line1:p,line2:m,time:f,year:_,number:v,id:b},popupTemplate:E}));let D=[],M=15;for(let I=0;I<M*24;I++){let A=new Date(f+I*M*1e3),O=this.getSatelliteLocation(A,p,m);O&&D.push([O.x,O.y,O.z])}let T=new rs({geometry:{type:"polyline",paths:[D]},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:[192,192,192,.5]},size:2}]}});i.add(T)}}}getSatelliteLocation(t,i,r){try{let n=_W(i,r),s=yW(n,t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());if(!s||!s.position)return null;let o=s.position,a=kN(t),l=vW(o,a),c=180/Math.PI;return{type:"point",x:c*l.longitude,y:c*l.latitude,z:l.height*1e3}}catch{return null}}static \u0275fac=function(i){return new(i||e)(Lt(dx))};static \u0275cmp=Bs({type:e,selectors:[["app-map-3-d"]],viewQuery:function(i,r){if(i&1&&vA(lne,7),i&2){let n;wA(n=bA())&&(r.viewDiv=n.first)}},decls:2,vars:0,consts:[["viewDiv",""],[2,"width","100%","height","85vh"]],template:function(i,r){i&1&&Un(0,"div",1,0)},styles:["[_nghost-%COMP%]{display:block;height:100%}#viewDiv[_ngcontent-%COMP%]{width:100%;height:100%}"]})};var SW=(()=>{class e{_renderer;_elementRef;onChange=i=>{};onTouched=()=>{};constructor(i,r){this._renderer=i,this._elementRef=r}setProperty(i,r){this._renderer.setProperty(this._elementRef.nativeElement,i,r)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static \u0275fac=function(r){return new(r||e)(Lt(V_),Lt(lc))};static \u0275dir=gs({type:e})}return e})(),cne=(()=>{class e extends SW{static \u0275fac=(()=>{let i;return function(n){return(i||(i=pC(e)))(n||e)}})();static \u0275dir=gs({type:e,features:[al]})}return e})(),IW=new ut("");var une={provide:IW,useExisting:rc(()=>wx),multi:!0};function dne(){let e=hc()?hc().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}var hne=new ut(""),wx=(()=>{class e extends SW{_compositionMode;_composing=!1;constructor(i,r,n){super(i,r),this._compositionMode=n,this._compositionMode==null&&(this._compositionMode=!dne())}writeValue(i){let r=i??"";this.setProperty("value",r)}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static \u0275fac=function(r){return new(r||e)(Lt(V_),Lt(lc),Lt(hne,8))};static \u0275dir=gs({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,n){r&1&&_s("input",function(o){return n._handleInput(o.target.value)})("blur",function(){return n.onTouched()})("compositionstart",function(){return n._compositionStart()})("compositionend",function(o){return n._compositionEnd(o.target.value)})},standalone:!1,features:[$m([une]),al]})}return e})();function pne(e){return e==null||mne(e)===0}function mne(e){return e==null?null:Array.isArray(e)||typeof e=="string"?e.length:e instanceof Set?e.size:null}var UN=new ut(""),AW=new ut("");function fne(e){return pne(e.value)?{required:!0}:null}function wW(e){return null}function RW(e){return e!=null}function PW(e){return j_(e)?Qd(e):e}function OW(e){let t={};return e.forEach(i=>{t=i!=null?ie(ie({},t),i):t}),Object.keys(t).length===0?null:t}function NW(e,t){return t.map(i=>i(e))}function gne(e){return!e.validate}function LW(e){return e.map(t=>gne(t)?t:i=>t.validate(i))}function _ne(e){if(!e)return null;let t=e.filter(RW);return t.length==0?null:function(i){return OW(NW(i,t))}}function jN(e){return e!=null?_ne(LW(e)):null}function yne(e){if(!e)return null;let t=e.filter(RW);return t.length==0?null:function(i){let r=NW(i,t).map(PW);return iS(r).pipe(hs(OW))}}function zN(e){return e!=null?yne(LW(e)):null}function bW(e,t){return e===null?[t]:Array.isArray(e)?[...e,t]:[e,t]}function vne(e){return e._rawValidators}function wne(e){return e._rawAsyncValidators}function VN(e){return e?Array.isArray(e)?e:[e]:[]}function mx(e,t){return Array.isArray(e)?e.includes(t):e===t}function CW(e,t){let i=VN(t);return VN(e).forEach(n=>{mx(i,n)||i.push(n)}),i}function TW(e,t){return VN(t).filter(i=>!mx(e,i))}var fx=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=jN(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=zN(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,i){return this.control?this.control.hasError(t,i):!1}getError(t,i){return this.control?this.control.getError(t,i):null}},Eg=class extends fx{name;get formDirective(){return null}get path(){return null}},Yv=class extends fx{_parent=null;name=null;valueAccessor=null},gx=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},bne={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},YSt=be(ie({},bne),{"[class.ng-submitted]":"isSubmitted"}),FW=(()=>{class e extends gx{constructor(i){super(i)}static \u0275fac=function(r){return new(r||e)(Lt(Yv,2))};static \u0275dir=gs({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,n){r&2&&ya("ng-untouched",n.isUntouched)("ng-touched",n.isTouched)("ng-pristine",n.isPristine)("ng-dirty",n.isDirty)("ng-valid",n.isValid)("ng-invalid",n.isInvalid)("ng-pending",n.isPending)},standalone:!1,features:[al]})}return e})(),kW=(()=>{class e extends gx{constructor(i){super(i)}static \u0275fac=function(r){return new(r||e)(Lt(Eg,10))};static \u0275dir=gs({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,n){r&2&&ya("ng-untouched",n.isUntouched)("ng-touched",n.isTouched)("ng-pristine",n.isPristine)("ng-dirty",n.isDirty)("ng-valid",n.isValid)("ng-invalid",n.isInvalid)("ng-pending",n.isPending)("ng-submitted",n.isSubmitted)},standalone:!1,features:[al]})}return e})();var qv="VALID",px="INVALID",Cg="PENDING",Wv="DISABLED",yd=class{},_x=class extends yd{value;source;constructor(t,i){super(),this.value=t,this.source=i}},Zv=class extends yd{pristine;source;constructor(t,i){super(),this.pristine=t,this.source=i}},Qv=class extends yd{touched;source;constructor(t,i){super(),this.touched=t,this.source=i}},Tg=class extends yd{status;source;constructor(t,i){super(),this.status=t,this.source=i}},HN=class extends yd{source;constructor(t){super(),this.source=t}},BN=class extends yd{source;constructor(t){super(),this.source=t}};function VW(e){return(bx(e)?e.validators:e)||null}function Cne(e){return Array.isArray(e)?jN(e):e||null}function HW(e,t){return(bx(t)?t.asyncValidators:e)||null}function Tne(e){return Array.isArray(e)?zN(e):e||null}function bx(e){return e!=null&&!Array.isArray(e)&&typeof e=="object"}function Ene(e,t,i){let r=e.controls;if(!(t?Object.keys(r):r).length)throw new lt(1e3,"");if(!r[i])throw new lt(1001,"")}function Dne(e,t,i){e._forEachChild((r,n)=>{if(i[n]===void 0)throw new lt(1002,"")})}var yx=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,i){this._assignValidators(t),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return uc(this.statusReactive)}set status(t){uc(()=>this.statusReactive.set(t))}_status=Zm(()=>this.statusReactive());statusReactive=hh(void 0);get valid(){return this.status===qv}get invalid(){return this.status===px}get pending(){return this.status==Cg}get disabled(){return this.status===Wv}get enabled(){return this.status!==Wv}errors;get pristine(){return uc(this.pristineReactive)}set pristine(t){uc(()=>this.pristineReactive.set(t))}_pristine=Zm(()=>this.pristineReactive());pristineReactive=hh(!0);get dirty(){return!this.pristine}get touched(){return uc(this.touchedReactive)}set touched(t){uc(()=>this.touchedReactive.set(t))}_touched=Zm(()=>this.touchedReactive());touchedReactive=hh(!1);get untouched(){return!this.touched}_events=new Xa;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(CW(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(CW(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(TW(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(TW(t,this._rawAsyncValidators))}hasValidator(t){return mx(this._rawValidators,t)}hasAsyncValidator(t){return mx(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let i=this.touched===!1;this.touched=!0;let r=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(be(ie({},t),{sourceControl:r})),i&&t.emitEvent!==!1&&this._events.next(new Qv(!0,r))}markAllAsDirty(t={}){this.markAsDirty({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsDirty(t))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsTouched(t))}markAsUntouched(t={}){let i=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=t.sourceControl??this;this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:r})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,r),i&&t.emitEvent!==!1&&this._events.next(new Qv(!1,r))}markAsDirty(t={}){let i=this.pristine===!0;this.pristine=!1;let r=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(be(ie({},t),{sourceControl:r})),i&&t.emitEvent!==!1&&this._events.next(new Zv(!1,r))}markAsPristine(t={}){let i=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=t.sourceControl??this;this._forEachChild(n=>{n.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,r),i&&t.emitEvent!==!1&&this._events.next(new Zv(!0,r))}markAsPending(t={}){this.status=Cg;let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Tg(this.status,i)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(be(ie({},t),{sourceControl:i}))}disable(t={}){let i=this._parentMarkedDirty(t.onlySelf);this.status=Wv,this.errors=null,this._forEachChild(n=>{n.disable(be(ie({},t),{onlySelf:!0}))}),this._updateValue();let r=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new _x(this.value,r)),this._events.next(new Tg(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(be(ie({},t),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(n=>n(!0))}enable(t={}){let i=this._parentMarkedDirty(t.onlySelf);this.status=qv,this._forEachChild(r=>{r.enable(be(ie({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(be(ie({},t),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(t,i){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},i),this._parent._updateTouched({},i))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===qv||this.status===Cg)&&this._runAsyncValidator(r,t.emitEvent)}let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new _x(this.value,i)),this._events.next(new Tg(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(be(ie({},t),{sourceControl:i}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Wv:qv}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,i){if(this.asyncValidator){this.status=Cg,this._hasOwnPendingAsyncValidator={emitEvent:i!==!1,shouldHaveEmitted:t!==!1};let r=PW(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(n=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(n,{emitEvent:i,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,i={}){this.errors=t,this._updateControlsErrors(i.emitEvent!==!1,this,i.shouldHaveEmitted)}get(t){let i=t;return i==null||(Array.isArray(i)||(i=i.split(".")),i.length===0)?null:i.reduce((r,n)=>r&&r._find(n),this)}getError(t,i){let r=i?this.get(i):this;return r&&r.errors?r.errors[t]:null}hasError(t,i){return!!this.getError(t,i)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,i,r){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||r)&&this._events.next(new Tg(this.status,i)),this._parent&&this._parent._updateControlsErrors(t,i,r)}_initObservables(){this.valueChanges=new wn,this.statusChanges=new wn}_calculateStatus(){return this._allControlsDisabled()?Wv:this.errors?px:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Cg)?Cg:this._anyControlsHaveStatus(px)?px:qv}_anyControlsHaveStatus(t){return this._anyControls(i=>i.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,i){let r=!this._anyControlsDirty(),n=this.pristine!==r;this.pristine=r,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),n&&this._events.next(new Zv(this.pristine,i))}_updateTouched(t={},i){this.touched=this._anyControlsTouched(),this._events.next(new Qv(this.touched,i)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){bx(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let i=this._parent&&this._parent.dirty;return!t&&!!i&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=Cne(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Tne(this._rawAsyncValidators)}},vx=class extends yx{constructor(t,i,r){super(VW(i),HW(r,i)),this.controls=t,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,i){return this.controls[t]?this.controls[t]:(this.controls[t]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(t,i,r={}){this.registerControl(t,i),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(t,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(t,i,r={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],i&&this.registerControl(t,i),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,i={}){Dne(this,!0,t),Object.keys(t).forEach(r=>{Ene(this,!0,r),this.controls[r].setValue(t[r],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(t,i={}){t!=null&&(Object.keys(t).forEach(r=>{let n=this.controls[r];n&&n.patchValue(t[r],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(t={},i={}){this._forEachChild((r,n)=>{r.reset(t?t[n]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(t,i,r)=>(t[r]=i.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(i,r)=>r._syncPendingControls()?!0:i);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(i=>{let r=this.controls[i];r&&t(r,i)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[i,r]of Object.entries(this.controls))if(this.contains(i)&&t(r))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(i,r,n)=>((r.enabled||this.disabled)&&(i[n]=r.value),i))}_reduceChildren(t,i){let r=t;return this._forEachChild((n,s)=>{r=i(r,n,s)}),r}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var GN=new ut("",{providedIn:"root",factory:()=>qN}),qN="always";function xne(e,t){return[...t.path,e]}function BW(e,t,i=qN){UW(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||i==="always")&&t.valueAccessor.setDisabledState?.(e.disabled),Sne(e,t),Ane(e,t),Ine(e,t),Mne(e,t)}function EW(e,t){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(t)})}function Mne(e,t){if(t.valueAccessor.setDisabledState){let i=r=>{t.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(i),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}function UW(e,t){let i=vne(e);t.validator!==null?e.setValidators(bW(i,t.validator)):typeof i=="function"&&e.setValidators([i]);let r=wne(e);t.asyncValidator!==null?e.setAsyncValidators(bW(r,t.asyncValidator)):typeof r=="function"&&e.setAsyncValidators([r]);let n=()=>e.updateValueAndValidity();EW(t._rawValidators,n),EW(t._rawAsyncValidators,n)}function Sne(e,t){t.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,e.updateOn==="change"&&jW(e,t)})}function Ine(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,e.updateOn==="blur"&&e._pendingChange&&jW(e,t),e.updateOn!=="submit"&&e.markAsTouched()})}function jW(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Ane(e,t){let i=(r,n)=>{t.valueAccessor.writeValue(r),n&&t.viewToModelUpdate(r)};e.registerOnChange(i),t._registerOnDestroy(()=>{e._unregisterOnChange(i)})}function Rne(e,t){e==null,UW(e,t)}function Pne(e,t){if(!e.hasOwnProperty("model"))return!1;let i=e.model;return i.isFirstChange()?!0:!Object.is(t,i.currentValue)}function One(e){return Object.getPrototypeOf(e.constructor)===cne}function Nne(e,t){e._syncPendingControls(),t.forEach(i=>{let r=i.control;r.updateOn==="submit"&&r._pendingChange&&(i.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function Lne(e,t){if(!t)return null;Array.isArray(t);let i,r,n;return t.forEach(s=>{s.constructor===wx?i=s:One(s)?r=s:n=s}),n||r||i||null}var Fne={provide:Eg,useExisting:rc(()=>WN)},$v=Promise.resolve(),WN=(()=>{class e extends Eg{callSetDisabledState;get submitted(){return uc(this.submittedReactive)}_submitted=Zm(()=>this.submittedReactive());submittedReactive=hh(!1);_directives=new Set;form;ngSubmit=new wn;options;constructor(i,r,n){super(),this.callSetDisabledState=n,this.form=new vx({},jN(i),zN(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(i){$v.then(()=>{let r=this._findContainer(i.path);i.control=r.registerControl(i.name,i.control),BW(i.control,i,this.callSetDisabledState),i.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(i)})}getControl(i){return this.form.get(i.path)}removeControl(i){$v.then(()=>{let r=this._findContainer(i.path);r&&r.removeControl(i.name),this._directives.delete(i)})}addFormGroup(i){$v.then(()=>{let r=this._findContainer(i.path),n=new vx({});Rne(n,i),r.registerControl(i.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(i){$v.then(()=>{let r=this._findContainer(i.path);r&&r.removeControl(i.name)})}getFormGroup(i){return this.form.get(i.path)}updateModel(i,r){$v.then(()=>{this.form.get(i.path).setValue(r)})}setValue(i){this.control.setValue(i)}onSubmit(i){return this.submittedReactive.set(!0),Nne(this.form,this._directives),this.ngSubmit.emit(i),this.form._events.next(new HN(this.control)),i?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submittedReactive.set(!1),this.form._events.next(new BN(this.form))}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(i){return i.pop(),i.length?this.form.get(i):this.form}static \u0275fac=function(r){return new(r||e)(Lt(UN,10),Lt(AW,10),Lt(GN,8))};static \u0275dir=gs({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,n){r&1&&_s("submit",function(o){return n.onSubmit(o)})("reset",function(){return n.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[$m([Fne]),al]})}return e})();function DW(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}function xW(e){return typeof e=="object"&&e!==null&&Object.keys(e).length===2&&"value"in e&&"disabled"in e}var kne=class extends yx{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,i,r){super(VW(i),HW(r,i)),this._applyFormState(t),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),bx(i)&&(i.nonNullable||i.initialValueIsDefault)&&(xW(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,i={}){this.value=this._pendingValue=t,this._onChange.length&&i.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,i.emitViewToModelChange!==!1)),this.updateValueAndValidity(i)}patchValue(t,i={}){this.setValue(t,i)}reset(t=this.defaultValue,i={}){this._applyFormState(t),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){DW(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){DW(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){xW(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var Vne={provide:Yv,useExisting:rc(()=>$N)},MW=Promise.resolve(),$N=(()=>{class e extends Yv{_changeDetectorRef;callSetDisabledState;control=new kne;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new wn;constructor(i,r,n,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=i,this._setValidators(r),this._setAsyncValidators(n),this.valueAccessor=Lne(this,s)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){let r=i.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),Pne(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){BW(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(i){MW.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){let r=i.isDisabled.currentValue,n=r!==0&&PA(r);MW.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?xne(i,this._parent):[i]}static \u0275fac=function(r){return new(r||e)(Lt(Eg,9),Lt(UN,10),Lt(AW,10),Lt(IW,10),Lt(dc,8),Lt(GN,8))};static \u0275dir=gs({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[$m([Vne]),al,ac]})}return e})();var zW=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275dir=gs({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return e})();var Hne=(()=>{class e{_validator=wW;_onChange;_enabled;ngOnChanges(i){if(this.inputName in i){let r=this.normalizeInput(i[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):wW,this._onChange&&this._onChange()}}validate(i){return this._validator(i)}registerOnValidatorChange(i){this._onChange=i}enabled(i){return i!=null}static \u0275fac=function(r){return new(r||e)};static \u0275dir=gs({type:e,features:[ac]})}return e})();var Bne={provide:UN,useExisting:rc(()=>ZN),multi:!0};var ZN=(()=>{class e extends Hne{required;inputName="required";normalizeInput=PA;createValidator=i=>fne;enabled(i){return i}static \u0275fac=(()=>{let i;return function(n){return(i||(i=pC(e)))(n||e)}})();static \u0275dir=gs({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,n){r&2&&TC("required",n._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[$m([Bne]),al]})}return e})();var Une=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=ol({type:e});static \u0275inj=pa({})}return e})();var GW=(()=>{class e{static withConfig(i){return{ngModule:e,providers:[{provide:GN,useValue:i.callSetDisabledState??qN}]}}static \u0275fac=function(r){return new(r||e)};static \u0275mod=ol({type:e});static \u0275inj=pa({imports:[Une]})}return e})();var Cx=class e{newSatellite="";newSatelliteAdded=()=>{};satellite={name:"",line1:"",line2:""};onSubmit(){console.log("New satellite added:",this.satellite),this.satellite={name:"",line1:"",line2:""}}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=Bs({type:e,selectors:[["app-add-sat-form"]],outputs:{newSatelliteAdded:"newSatelliteAdded"},decls:12,vars:3,consts:[[3,"ngSubmit"],["type","text","name","name","required","",3,"ngModelChange","ngModel"],["type","text","name","line1","required","",3,"ngModelChange","ngModel"],["type","text","name","line2","required","",3,"ngModelChange","ngModel"],["type","submit"]],template:function(i,r){i&1&&(Ai(0,"form",0),_s("ngSubmit",function(){return r.onSubmit()}),Ai(1,"label"),jn(2," Name: "),Ai(3,"input",1),Wm("ngModelChange",function(s){return q_(r.satellite.name,s)||(r.satellite.name=s),s}),mr()(),Ai(4,"label"),jn(5," Line 1: "),Ai(6,"input",2),Wm("ngModelChange",function(s){return q_(r.satellite.line1,s)||(r.satellite.line1=s),s}),mr()(),Ai(7,"label"),jn(8," Line 2: "),Ai(9,"input",3),Wm("ngModelChange",function(s){return q_(r.satellite.line2,s)||(r.satellite.line2=s),s}),mr()(),Ai(10,"button",4),jn(11,"Add Satellite"),mr()()),i&2&&(Nr(3),qm("ngModel",r.satellite.name),Nr(3),qm("ngModel",r.satellite.line1),Nr(3),qm("ngModel",r.satellite.line2))},dependencies:[jA,GW,zW,wx,FW,kW,ZN,$N,WN],encapsulation:2})};function zne(e,t){if(e&1){let i=z_();Ai(0,"app-history",8),_s("highlight",function(n){Im(i);let s=Ch();return Am(s.highlight(n))}),mr()}}function Gne(e,t){e&1&&Un(0,"app-add-sat-form")}function qne(e,t){if(e&1&&Un(0,"app-map",6),e&2){let i=Ch();bh("highlighted",i.highlightedPosition)}}function Wne(e,t){if(e&1&&Un(0,"app-map-feature",6),e&2){let i=Ch();bh("highlighted",i.highlightedPosition)}}function $ne(e,t){e&1&&Un(0,"app-map-3-d",7)}var Tx=class e{constructor(t,i){this.http=t;this.positionService=i}title="iss-tracker";positions=new ec([]);highlightedPosition=null;activeMap="map1";ngOnInit(){this.loadISSPosition(),setInterval(()=>this.loadISSPosition(),1e4)}loadISSPosition(){this.http.get("http://api.open-notify.org/iss-now.json").subscribe(t=>{let i=new Date,r=parseFloat(t.iss_position.latitude),n=parseFloat(t.iss_position.longitude),s={latitude:r,longitude:n,time:i};console.log("New position fetched:",s),this.positionService.updatePositions(s)})}switchMap(t){this.activeMap=t}highlight(t){this.highlightedPosition=t}static \u0275fac=function(i){return new(i||e)(Lt(VC),Lt(ll))};static \u0275cmp=Bs({type:e,selectors:[["app-root"]],decls:18,vars:11,consts:[[1,"container"],[1,"header"],[1,"nav-list"],[1,"nav-button",3,"click"],[1,"main-content"],[1,"right-panel"],[1,"map-component",3,"highlighted"],[1,"map-component"],[3,"highlight"]],template:function(i,r){i&1&&(Ai(0,"div",0)(1,"header",1)(2,"h1"),jn(3,"Satellite Tracker"),mr(),Ai(4,"nav",2)(5,"button",3),_s("click",function(){return r.switchMap("map1")}),jn(6,"Map"),mr(),Ai(7,"button",3),_s("click",function(){return r.switchMap("map2")}),jn(8,"Map-Feature"),mr(),Ai(9,"button",3),_s("click",function(){return r.switchMap("map3")}),jn(10,"Map-3D"),mr()()(),Ai(11,"main",4),vh(12,zne,1,0,"app-history"),vh(13,Gne,1,0,"app-add-sat-form"),Ai(14,"div",5),vh(15,qne,1,1,"app-map",6),vh(16,Wne,1,1,"app-map-feature",6),vh(17,$ne,1,0,"app-map-3-d",7),mr()()()),i&2&&(Nr(5),ya("active",r.activeMap==="map1"),Nr(2),ya("active",r.activeMap==="map2"),Nr(2),ya("active",r.activeMap==="map3"),Nr(3),wh(r.activeMap==="map1"||r.activeMap==="map2"?12:-1),Nr(),wh(r.activeMap==="map3"?13:-1),Nr(2),wh(r.activeMap==="map1"?15:-1),Nr(),wh(r.activeMap==="map2"?16:-1),Nr(),wh(r.activeMap==="map3"?17:-1))},dependencies:[BC,AT,RT,Cx,hx],encapsulation:2})};UA(Tx,Yj).catch(e=>console.error(e));
