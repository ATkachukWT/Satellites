import{a as j,c as I}from"./chunk-N64WAD57.js";import{$ as U,A as y,B as g,C as T,I as R,L as E,o as M,u as O,v as J}from"./chunk-MGSAXUID.js";import{a as c}from"./chunk-OCNYIIP3.js";import{a as u,b as f}from"./chunk-GPURZ6GA.js";import{a as P}from"./chunk-CDP4MSRO.js";import{n as V}from"./chunk-2NP7F5RO.js";import{f as m}from"./chunk-FENRIY2T.js";import{a as k,d as v}from"./chunk-WDETDPZG.js";import{a as G,c as z,d as C}from"./chunk-HX2VGIR2.js";import{d as l}from"./chunk-64QN2VGD.js";import{a as Z,n as _}from"./chunk-Z5Q7KLA4.js";import{l as A}from"./chunk-WZDN6K3C.js";import{a as N}from"./chunk-N2WTMF3X.js";function K(i,t,s=null){let e=Q(i,!0);if(e.hasm!==void 0&&(e.hasM=e.hasm,delete e.hasm),e.hasz!==void 0&&(e.hasZ=e.hasz,delete e.hasz),e.spatialreference!==void 0&&(e.spatialReference=e.spatialreference,delete e.spatialreference),e.spatialReference||(e.spatialReference=t),e.rings!==void 0){let a=H(q(e.rings),e.hasZ,e.hasM);if(a==null)return null;e.rings=a.arrays,e.hasZ=a.hasZ,e.hasM=a.hasM}if(e.paths!==void 0){let a=H(q(e.paths),e.hasZ,e.hasM);if(a==null)return null;e.paths=a.arrays,e.hasZ=a.hasZ,e.hasM=a.hasM}if(e.points!==void 0){let a=nt(e.points,e.hasZ,e.hasM);if(a==null)return null;e.points=a.array,e.hasZ=a.hasZ,e.hasM=a.hasM}let r=m(e);if(s!=null&&r?.type!==s)throw new f(null,u.InvalidParameter,null);return r}function Q(i,t=!1){let s={};for(let e of i.keys()){let r=t?e.toLowerCase():e,a=i.attributes[e];s[r]=J(a)?Q(a):a}return s}var D=Symbol("NoValue");function b(i){return Array.isArray(i)&&i.length>0?i[0]:i instanceof c&&i.length()>0?i.get(0):D}function q(i){let t=b(b(i));return t===D||Array.isArray(t)||t instanceof c||t instanceof _?i:[i]}var F=0;function W(i){return A(i,F)??F}function X(i){return typeof i=="number"&&!Number.isNaN(i)}var x=null;function Y(i){return A(i,x)??x}function $(i){return typeof i=="number"&&!Number.isNaN(i)||i===null}function w(i){return!(i.length<2)&&typeof i[0]=="number"&&!Number.isNaN(i[0])&&typeof i[1]=="number"&&!Number.isNaN(i[1])}function st(i){return w(i)?i.length>2?i.slice(0,2):i:null}function rt(i){return w(i)?X(i[2])?i.length>3?i.slice(0,3):i:[i[0],i[1],W(i[2])]:null}function at(i){return w(i)?i.length>=3&&!$(i[2])?[i[0],i[1],Y(i[2])]:i.length>3?i.slice(0,3):i:null}function ot(i){return w(i)?X(i[2])&&$(i[3])?i.length>4?i.slice(0,4):i:[i[0],i[1],W(i[2]),Y(i[3])]:null}function tt(i,t){return i?t?ot:rt:t?at:st}function et(i,t){return i?t?s=>[s.x,s.y,s.z??F,s.m??x]:s=>[s.x,s.y,s.z??F]:t?s=>[s.x,s.y,s.m??x]:s=>[s.x,s.y]}function B(i,t,s){return Array.isArray(i)?s(i):i instanceof _?t(i):i instanceof c?s(i.toArray()):null}function p(i,t,s){return Array.isArray(i)?i.length>=t:i instanceof c?i.length()>=t:i instanceof _&&i[s]}function it(i,t,s){return i===void 0&&t===void 0?{hasZ:p(s,3,"hasZ"),hasM:p(s,4,"hasM")}:i===void 0?t===!0?{hasZ:p(s,4,"hasZ"),hasM:!0}:{hasZ:p(s,3,"hasZ"),hasM:!1}:t===void 0?i===!0?{hasZ:!0,hasM:p(s,4,"hasM")}:{hasZ:!1,hasM:p(s,3,"hasM")}:{hasZ:i===!0,hasM:t===!0}}function S(i,t,s){let e=[];if(Array.isArray(i))for(let r=0;r<i.length;r++){let a=B(i[r],t,s);a!=null&&e.push(a)}else if(i instanceof c)for(let r=0;r<i.length();r++){let a=B(i.get(r),t,s);a!=null&&e.push(a)}return e}function nt(i,t,s){let e=b(i);if(e===D)return null;let{hasZ:r,hasM:a}=it(t,s,e);return{array:S(i,et(r,a),tt(r,a)),hasZ:r,hasM:a}}function H(i,t,s){let e=b(b(i));if(e===D)return null;let{hasZ:r,hasM:a}=it(t,s,e),o=et(r,a),n=tt(r,a),d=[];if(Array.isArray(i))for(let h=0;h<i.length;h++)d.push(S(i[h],o,n));else if(i instanceof c)for(let h=0;h<i.length();h++)d.push(S(i.get(h),o,n));return{arrays:d,hasZ:r,hasM:a}}var L=class i{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(t,s){let e=new i;return e.contextTimeZone=s??null,e._geometry=t.geometry!=null?t.geometry:null,t.attributes===void 0||t.attributes===null?e.attributes={}:e.attributes=t.attributes,t._sourceLayer?(e._layer=t._sourceLayer,e._fieldTypesFixed=!1):t._layer?(e._layer=t._layer,e._fieldTypesFixed=!1):t.layer&&"fields"in t.layer?(e._layer=t.layer,e._fieldTypesFixed=!1):t.sourceLayer&&"fields"in t.sourceLayer&&(e._layer=t.sourceLayer,e._fieldTypesFixed=!1),e._layer&&!e._fieldTypesFixed&&(e.fieldsIndex=this.hydrateFieldsIndex(e._layer)),e}static createFromArcadeFeature(t){if(t instanceof i){let e=new i;return e._fieldTypesFixed=t._fieldTypesFixed,e.attributes=t.attributes,e._geometry=t._geometry,e._optimizedGeomDefinition=t._optimizedGeomDefinition,t._layer&&(e._layer=t._layer),e.fieldsIndex=t.fieldsIndex,e.contextTimeZone=t.contextTimeZone,e}let s={};for(let e of t.keys())s[e]=t.field(e);return i.createFromGraphicLikeObject(t.geometry(),s,t.fullSchema(),t.contextTimeZone)}static createFromOptimisedFeature(t,s,e){let r=new i;return r._geometry=t.geometry?{geometry:t.geometry}:null,r._optimizedGeomDefinition=e,r.attributes=t.attributes||{},r._layer=s,r._fieldTypesFixed=!1,r}static createFromArcadeDictionary(t,s){let e=new i;return e.attributes=t.field("attributes"),e.attributes!==null&&e.attributes instanceof I?(e.attributes=e.attributes.attributes,e.attributes===null&&(e.attributes={})):e.attributes={},e._geometry=t.field("geometry"),e._geometry!==null&&(e._geometry instanceof I?e._geometry=K(e._geometry,s):e._geometry instanceof Z||(e._geometry=null)),e}static createFromGraphicLikeObject(t,s,e=null,r){let a=new i;return a.contextTimeZone=r??null,s===null&&(s={}),a.attributes=s,a._geometry=t??null,a._layer=e,a._layer&&(a._fieldTypesFixed=!1,a.fieldsIndex=this.hydrateFieldsIndex(a._layer)),a}static hydrateFieldsIndex(t){return t===null?null:O(t)?t.getFieldsIndex():t.fieldsIndex?t.fieldsIndex:P.fromLayerJSON({datesInUnknownTimezone:t.datesInUnknownTimezone,fields:t.fields,timeInfo:t.timeInfo,editFieldsInfo:t.editFieldsInfo,dateFieldsTimeReference:t.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(t,s,e=null){s===null&&(s={}),this.attributes=s,this._geometry=t??null,this._layer=e,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(t=!1){this._fieldTypesFixed===!1&&this._fixFieldTypes();let s=R(this.attributes,{useNumbersForDates:t});return'{"geometry":'+(this.geometry()===null?"null":E(this.geometry()))+',"attributes":'+s+"}"}_fixFieldTypes(){if(this._fieldsToFixDataTypes&&this._fieldsToFixDataTypes?.length>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);let t=[],s=this._layer.fields;for(let e=0;e<s.length;e++){let r=s[e],{name:a,type:o}=r;switch(o){case"date":case"esriFieldTypeDate":t.push({field:a,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":t.push({field:a,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":t.push({field:a,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":t.push({field:a,dataType:"timestamp-offset"})}}this._fieldsToFixDataTypes=t,t.length>0&&this._fixAllFields(t),this._fieldTypesFixed=!0}isUnknownDateTimeField(t){return this.fieldsIndex?.getTimeZone(t)==="unknown"}_fixAllFields(t){this.attributes=N({},this.attributes);let s=this.contextTimeZone??"system";for(let e=0;e<t.length;e++){let r=t[e].field,a=t[e].dataType,o=this.attributes[r];if(o===void 0){for(let n in this.attributes)if(n.toLowerCase()===r.toLowerCase()){if(o=this.attributes[n],o!==null){if(a==="time-only"){T(o)||(this.attributes[n]=v.fromReader(o.toString()));break}if(a==="date-only"){g(o)||(this.attributes[n]=k.fromReader(o.toString()));break}if(a==="timestamp-offset"){y(o)||(this.attributes[n]=l.fromReaderAsTimeStampOffset(o.toString()));break}let d=this.isUnknownDateTimeField(n);o instanceof Date?this.attributes[n]=d?l.unknownDateJSToArcadeDate(o):l.dateJSAndZoneToArcadeDate(o,s):y(o)||(this.attributes[n]=d?l.unknownEpochToArcadeDate(o):l.epochToArcadeDate(o,s))}break}}else if(o!==null){if(a==="time-only"){T(o)?this.attributes[r]=o:this.attributes[r]=v.fromReader(o.toString());continue}if(a==="date-only"){g(o)?this.attributes[r]=o:this.attributes[r]=k.fromReader(o.toString());continue}if(a==="timestamp-offset"){y(o)?this.attributes[r]=o:this.attributes[r]=l.fromReaderAsTimeStampOffset(o.toString());continue}let n=this.isUnknownDateTimeField(r);y(o)?this.attributes[r]=o:o instanceof Date?this.attributes[r]=n?l.unknownDateJSToArcadeDate(o):l.dateJSAndZoneToArcadeDate(o,s):this.attributes[r]=n?l.unknownEpochToArcadeDate(o):l.epochToArcadeDate(o,s)}}}geometry(){return this._geometry===null||this._geometry instanceof Z||(this._optimizedGeomDefinition?(this._geometry=m(V(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=m(this._geometry)),this._geometry}field(t){this._fieldTypesFixed||this._fixFieldTypes();let s=this.attributes[t];if(s!==void 0)return s;let e=t.toLowerCase();for(let r in this.attributes)if(r.toLowerCase()===e)return this.attributes[r];if(this._hasFieldDefinition(e))return null;throw new f(null,u.FieldNotFound,null,{key:t})}_hasFieldDefinition(t){if(this._layer===null)return!1;for(let s=0;s<this._layer.fields.length;s++)if(this._layer.fields[s].name.toLowerCase()===t)return!0;return!1}setField(t,s){if(this.immutable)throw new f(null,u.Immutable,null);if(s instanceof Date&&(s=this.isUnknownDateTimeField(t)?l.unknownDateJSToArcadeDate(s):l.dateJSToArcadeDate(s)),M(s)===!1)throw new f(null,u.TypeNotAllowedInFeature,null);let e=t.toLowerCase();if(this.attributes[t]===void 0){for(let r in this.attributes)if(r.toLowerCase()===e)return void(this.attributes[r]=s);this.attributes[t]=s}else this.attributes[t]=s}hasField(t){let s=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(let e in this.attributes)if(e.toLowerCase()===s)return!0;return!!this._hasFieldDefinition(s)}keys(){let t=[],s={};for(let e in this.attributes)t.push(e),s[e.toLowerCase()]=1;if(this._layer!==null)for(let e=0;e<this._layer.fields.length;e++){let r=this._layer.fields[e];s[r.name.toLowerCase()]!==1&&t.push(r.name)}return t=t.sort(),t}static parseAttributesFromDictionary(t){let s={};for(let e in t.attributes){let r=t.attributes[e];if(!M(r))throw new f(null,u.InvalidParameter,null);s[e]=r}return s}static fromJson(t,s){let e=null;t.geometry!==null&&t.geometry!==void 0&&(e=m(t.geometry));let r={};if(t.attributes!==null&&t.attributes!==void 0)for(let a in t.attributes){let o=t.attributes[a];if(o===null)r[a]=o;else{if(!(C(o)||G(o)||z(o)||y(o)||T(o)||g(o)))throw new f(null,u.InvalidParameter,null);r[a]=o}}return i.createFromGraphicLikeObject(e,r,null,s??null)}fullSchema(){return this._layer}gdbVersion(){if(this._layer===null)return"";let t=this._layer.gdbVersion;return t===void 0?"":t===""&&this._layer.capabilities?.isVersioned?"SDE.DEFAULT":t}castAsJson(t){let s={attributes:{},geometry:t?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null};for(let e in this.attributes){let r=this.attributes[e];r!==void 0&&(s.attributes[e]=U(r,t))}return s}async castAsJsonAsync(t=null,s){return this.castAsJson(s)}};j(L);export{K as a,L as b};
