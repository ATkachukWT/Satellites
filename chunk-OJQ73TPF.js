import{a as p}from"./chunk-OVHPPCBL.js";import{P as D,u as g,x}from"./chunk-CKJ56T2Q.js";import{a as h}from"./chunk-F6JAWRPN.js";var i=class{constructor(t,s=30){this.name=t,this._counter=0,this._samples=new Array(s)}push(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}set(t){t!=null&&(this._samples[this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,s)=>t-s)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,s)=>t+s,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var f=class{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}},d=class{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}},w=0,_=0,c={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},k=["prepare","preRender","render","postRender","update","finish"],v=[],n=new h,A=class{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,b()}};function y(){r!=null&&(cancelAnimationFrame(r),r=requestAnimationFrame(F))}function b(){r==null&&(w=performance.now(),r=requestAnimationFrame(F))}var u={frameTasks:n,willDispatch:!1,clearFrameTasks:j,dispatch:R,executeFrameTasks:P,reschedule:y};function L(e){let t=new d(e);return v.push(t),u.willDispatch||(u.willDispatch=!0,p(R)),t}function N(e){let t=new f(e);return n.push(t),b(),new A(t)}var r=null;function j(e=!1){n.forAll(t=>{t.removed=!0}),e&&M()}function O(e){_=Math.max(0,e)}function F(){let e=performance.now();r=null,r=n.some(s=>!s.paused&&!s.removed)?requestAnimationFrame(F):null,u.executeFrameTasks(e)}function P(e){let t=e-w;w=e;let s=_>0?_:1e3/60,l=Math.max(0,t-s);c.time=e,c.frameDuration=s-l;for(let o=0;o<k.length;o++){let q=performance.now(),T=k[o];n.forAll(a=>{a.paused||a.removed||(o===0&&a.ticks++,a.phases[T]&&(c.elapsedFrameTime=performance.now()-e,c.deltaTime=a.ticks===0?0:t,a.phases[T]?.call(a,c)))}),H[o].push(performance.now()-q)}M(),I.push(performance.now()-e)}var m=new h;function M(){n.forAll(e=>{e.removed&&m.push(e)}),n.removeUnorderedMany(m.data,m.length),m.clear()}function R(){for(;v.length;){let e=v.shift();e.isActive&&e.callback()}u.willDispatch=!1}function U(e=1,t){let s=D(),l=()=>{x(t)?s.reject(g()):e===0?s():(--e,p(()=>l()))};return l(),s.promise}function E(e){return U(1,e)}async function Q(e){await E(e),await new Promise(t=>requestAnimationFrame(()=>{e?.aborted||t()}))}var H=k.map(e=>new i(e)),I=new i("total");export{i as a,L as b,N as c,O as d,U as e,E as f,Q as g};
