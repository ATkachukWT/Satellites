import{a as ye,b as Ce}from"./chunk-3VYKLHOM.js";import{a as ve,c as Se}from"./chunk-CRVFDW2R.js";import{b as xe}from"./chunk-INZW3TXV.js";import{b as Te}from"./chunk-MOHGYSPI.js";import{c as Re,q as Ae}from"./chunk-7S2234XQ.js";import{a as De}from"./chunk-PXDIM3V6.js";import{a as _e}from"./chunk-LSUWBOLF.js";import{b as Ve}from"./chunk-LHI3UGTZ.js";import{g as Le}from"./chunk-VUJT53YX.js";import{b as me,c as ge,d as Pe,e as be}from"./chunk-WUXNV6ZW.js";import{a as ue}from"./chunk-PSFZFYFC.js";import{a as Ee,b as m}from"./chunk-CMKJEBQJ.js";import{b as j,c as fe}from"./chunk-V4ZQZTCB.js";import{a as R,b as A}from"./chunk-PEYNLMWW.js";import{g as pe}from"./chunk-B74L7AUE.js";import{a as de}from"./chunk-L7NOU4T2.js";import{a as ae,b as oe,c as le,d as he,l as ce}from"./chunk-UBQPWKE4.js";import{a as v,c as y,d as re}from"./chunk-YSD7LK2L.js";import{a as W}from"./chunk-LXEWGICX.js";import{c as ne}from"./chunk-3CCK7BDD.js";import{a as V}from"./chunk-QCZ3ZIGQ.js";import{c as n}from"./chunk-ONYJLWAD.js";import{f as N}from"./chunk-VMECOA4F.js";import{a as Q,m as Y}from"./chunk-KD27XIJC.js";import{a as se}from"./chunk-S52JRLJC.js";import{b as H}from"./chunk-U4TLMQTY.js";import{a as r}from"./chunk-RWCIDBNQ.js";import{a as G,b as te,r as ie}from"./chunk-HM5RIVQC.js";import{b as E,c as L,d as $,e as ee}from"./chunk-6B5XFA6F.js";import{c as O}from"./chunk-PTZYZULI.js";import{a as z,m as B}from"./chunk-NMLYCCKN.js";import{a,b as I,c as U}from"./chunk-BOVYXYHK.js";import{b as J,h as K}from"./chunk-QT6UNBJP.js";import{H as T}from"./chunk-QHVIRF5H.js";import{I as k}from"./chunk-WZDN6K3C.js";import{a as l}from"./chunk-QGVBCWUY.js";import{c as Z}from"./chunk-CKJ56T2Q.js";var M=class extends de{constructor(){super(...arguments),this.innerColor=U(1,1,1),this.innerWidth=1,this.glowColor=U(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=K(6),this.pointDistanceOrigin=a(),this.pointDistanceTarget=a(),this.lineVerticalPlaneSegment=v(),this.intersectsLineSegment=v(),this.intersectsLineRadius=3,this.heightManifoldTarget=a(),this.lineStartWorld=a(),this.lineEndWorld=a()}},w=class extends A{constructor(e,i){super(e,i,new R(Se,()=>import("./chunk-OQDFMDQT.js")))}};var q=class extends M{constructor(){super(...arguments),this.origin=a()}},D=class extends A{constructor(e,i){super(e,i,new R(xe,()=>import("./chunk-MBVZ5FT2.js")),F)}},F=new Map([[r.START,0],[r.END,1],[r.EXTRUDE,2],[r.START_UP,3],[r.END_UP,4]]);var S=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=a(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){let i=Q(3*e.length),s=0;for(let o of e)i[s++]=o[0],i[s++]=o[1],i[s++]=o[2];this.buffers=[i]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let i=this._buffers[0],s=3*Math.floor(i.length/3/2);L(this._origin,i[s],i[s+1],i[s+2])}else L(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let i=this._ensureVAO(e);i!=null&&(e.bindVAO(i),e.drawArrays(te.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===V.Global?Be:Oe}_ensureVAO(e){return this._buffers==null?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,i){let s=this._createDataBuffer(i);return this._dirty=!1,new _e(e,F,new Map([["data",se(this._layout)]]),new Map([["data",ue.createVertex(e,ie.STATIC_DRAW,s)]]))}_ensureVertexData(e,i){if(!this._dirty)return;let s=this._createDataBuffer(i);e.vertexBuffers.get("data")?.setData(s),this._dirty=!1}_createDataBuffer(e){let i=e.reduce((c,d)=>c+Me(d),0);this._count=i;let s=this._layout.createBuffer(i),o=this._origin,_=0,u=0,h="startUp"in s?this._setUpVectors.bind(this,s):void 0;for(let c of e){for(let d=0;d<c.length;d+=3){let C=L(we,c[d],c[d+1],c[d+2]);d===0?u=this._renderCoordsHelper.getAltitude(C):this._renderCoordsHelper.setAltitude(C,u);let p=_+2*d;h?.(d,p,c,C);let X=ee(we,C,o);if(d<c.length-3){for(let b=0;b<6;b++)s.start.setVec(p+b,X);s.extrude.setValues(p,0,-1),s.extrude.setValues(p+1,1,-1),s.extrude.setValues(p+2,1,1),s.extrude.setValues(p+3,0,-1),s.extrude.setValues(p+4,1,1),s.extrude.setValues(p+5,0,1)}if(d>0)for(let b=-6;b<0;b++)s.end.setVec(p+b,X)}_+=Me(c)}return s.buffer}_setUpVectors(e,i,s,o,_){let u=this._renderCoordsHelper.worldUpAtPosition(_,ze);if(i<o.length-3)for(let h=0;h<6;h++)e.startUp.setVec(s+h,u);if(i>0)for(let h=-6;h<0;h++)e.endUp.setVec(s+h,u)}};function Me(t){return 3*(2*(t.length/3-1))}var ze=a(),we=a(),Be=H().vec3f(r.START).vec3f(r.END).vec2f(r.EXTRUDE).vec3f(r.START_UP).vec3f(r.END_UP),Oe=H().vec3f(r.START).vec3f(r.END).vec2f(r.EXTRUDE);var f=class extends Ee{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}};l([m()],f.prototype,"contrastControlEnabled",void 0),l([m()],f.prototype,"spherical",void 0);var g=class extends f{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}};l([m()],g.prototype,"heightManifoldEnabled",void 0),l([m()],g.prototype,"pointDistanceEnabled",void 0),l([m()],g.prototype,"lineVerticalPlaneEnabled",void 0),l([m()],g.prototype,"intersectsLineEnabled",void 0);var P=class extends fe{constructor(t){super(t),this.produces=j.LASERLINES,this.consumes={required:[j.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new g,this._pathTechniqueConfiguration=new f,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new q;let e=t.view._stage.renderView.techniques,i=new f;i.contrastControlEnabled=t.contrastControlEnabled,e.precompile(D,i)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===V.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(D,this._pathTechniqueConfiguration),this._blit=new Te(this._techniques,De.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=Z(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view._stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(t){this._heightManifoldEnabled!==t&&(this._heightManifoldEnabled=t,this.requestRender(n.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(t){E(this._passParameters.heightManifoldTarget,t),this.requestRender(n.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(t){t!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=t,this.requestRender(n.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(t){E(this._passParameters.pointDistanceTarget,t),this.requestRender(n.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(t){E(this._passParameters.pointDistanceOrigin,t),this.requestRender(n.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(t){t!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=t,this.requestRender(n.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){y(t,this._passParameters.lineVerticalPlaneSegment),this.requestRender(n.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(t){t!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=t,this.requestRender(n.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(t){y(t,this._passParameters.intersectsLineSegment),this.requestRender(n.UPDATE)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(t){t!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=t,this.requestRender(n.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(t){t!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=t,this._pathVerticalPlaneData!=null&&this.requestRender(n.UPDATE))}set pathVerticalPlaneVertices(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new S(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}set pathVerticalPlaneBuffers(t){this._pathVerticalPlaneData==null&&(this._pathVerticalPlaneData=new S(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=t,this.pathVerticalPlaneEnabled&&this.requestRender(n.UPDATE)}setParameters(t){pe(this._passParameters,t)&&this.requestRender(n.UPDATE)}precompile(){this._acquireTechnique()}render(t){let e=t.find(({name:u})=>u===this.produces);if(!this.bindParameters.decorations||this._blit==null)return e;let i=this.renderingContext,s=t.find(({name:u})=>u==="normals");this._passParameters.normals=s?.getTexture();let o=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return i.bindFramebuffer(e.fbo),o(),e;this._passParameters.colors=e.getTexture();let _=this.fboCache.acquire(e.fbo.width,e.fbo.height,"laser lines");return i.bindFramebuffer(_.fbo),i.setClearColor(0,0,0,0),i.clear(G.COLOR|G.DEPTH),o(),i.unbindTexture(e.getTexture()),this._blit.blend(i,_,e,this.bindParameters)||this.requestRender(n.UPDATE),_.release(),e}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===V.Global,this._techniques.get(w,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;let t=this._acquireTechnique();if(t.compiled){let e=this.renderingContext;e.bindTechnique(t,this.bindParameters,this._passParameters),e.screen.draw()}else this.requestRender(n.UPDATE)}_renderPath(){if(this._pathVerticalPlaneData==null)return;let t=this._techniques.get(D,this._pathTechniqueConfiguration);if(t.compiled){let e=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,e.bindTechnique(t,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(e)}else this.requestRender(n.UPDATE)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;let t=this.bindParameters.camera,e=this._passParameters;if(this._intersectsLineInfinite){if(oe(ne(e.intersectsLineSegment.origin,e.intersectsLineSegment.vector),x),x.c0=-Number.MAX_VALUE,!ce(t.frustum,x))return!1;le(x,e.lineStartWorld),he(x,e.lineEndWorld)}else E(e.lineStartWorld,e.intersectsLineSegment.origin),$(e.lineEndWorld,e.intersectsLineSegment.origin,e.intersectsLineSegment.vector);return!0}get test(){}};l([T({constructOnly:!0})],P.prototype,"contrastControlEnabled",void 0),l([T({constructOnly:!0})],P.prototype,"isDecoration",void 0),l([T()],P.prototype,"produces",void 0),l([T()],P.prototype,"consumes",void 0),P=l([k("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],P);var x=ae();var qe=class extends ye{constructor(e){super(e),this._angleCutoff=ve,this._style={},this._heightManifoldTarget=a(),this._heightManifoldEnabled=!1,this._intersectsLine=v(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e!=null?(E(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let i=this.view.renderCoordsHelper.worldUpAtPosition(e,He);this.intersectsLine=re(e,i),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e!=null?(y(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e!=null?y(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e!=null?{origin:I(e.origin),target:e.target?I(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer==null&&(this._renderer=new P({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){this._renderer!=null&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,i=e!=null;this._renderer.pointDistanceEnabled=i&&e.target!=null&&this.visible,i&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view._stage&&(this._renderer.destroy(),this._renderer=null)}},He=a();var Ie=class extends Ce{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=O(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=O(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let i=this._preferredTextureSize;this._size=e,i<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){B(e,this._color)||(z(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){B(e,this._outlineColor)||(z(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let i=e.geometries[0];if(i==null)return;let s=i.getMutableAttribute(r.SIZE).data,o=this._geometrySize;s[0]=o,s[1]=o,e.geometryVertexAttributeUpdated(e.geometries[0],r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:Pe(this._primitive),distanceFieldBoundingBox:ge,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/me}createExternalResources(){this._texture=be(this._primitive,this._preferredTextureSize),this._material=new Ve(this._materialParameters,this.view.state.viewingMode===V.Global);let e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){let i=this._createRenderGeometry();i!=null&&e.addGeometry(i)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return J(2*this._geometrySize,16,128)}calculateMapBounds(e){let i=this.object?.geometries[0];if(!i)return!1;let s=i.attributes.get(r.POSITION).data;return W(s,this.view.renderCoordsHelper.spatialReference,Ue,this.view.spatialReference),Y(e,Ue),!0}_createRenderGeometry(){let{geometry:e,_material:i}=this;if(e==null||i==null)return null;let{renderCoordsHelper:s,elevationProvider:o}=this.view,_=Re(e,o,Ae.fromElevationInfo(this.elevationInfo),s),u=L(N.get(),e.x,e.y,_),h=N.get();W(u,e.spatialReference,h,s.spatialReference);let c=this._geometrySize;return Le(i,{position:h,size:[c,c],centerOffsetAndDistance:[0,0,0,1]})}},Ue=a();export{qe as a,Ie as b};
