import{g as w}from"./chunk-LIECELJH.js";import"./chunk-36MVAC23.js";import{a as l}from"./chunk-DFYW3Y3B.js";import"./chunk-UBQPWKE4.js";import{a as L,e as y,g as j}from"./chunk-YSD7LK2L.js";import{b as P,p as f}from"./chunk-CAXK5KYB.js";import"./chunk-3CCK7BDD.js";import"./chunk-LNYBTIG7.js";import"./chunk-VMECOA4F.js";import"./chunk-JPMGMA4B.js";import"./chunk-DJW5LMRG.js";import"./chunk-ALWV3RJ2.js";import"./chunk-DEH76MSI.js";import"./chunk-QCRXBE6I.js";import"./chunk-G7TP3ZYQ.js";import"./chunk-SBVUMOLF.js";import"./chunk-Y6YEAKJ5.js";import"./chunk-S52JRLJC.js";import"./chunk-U4TLMQTY.js";import"./chunk-PDQQY7RQ.js";import"./chunk-W5OI4BJ2.js";import"./chunk-RWCIDBNQ.js";import"./chunk-2NH7HOKA.js";import"./chunk-HM5RIVQC.js";import"./chunk-EM35R6FY.js";import"./chunk-2ZFXOJDB.js";import"./chunk-QXXXCEV5.js";import{d as p,o as g,p as h}from"./chunk-6B5XFA6F.js";import"./chunk-ZTOZWLEE.js";import"./chunk-PTZYZULI.js";import"./chunk-NMLYCCKN.js";import"./chunk-RSDQHAJX.js";import{a as c,b as u}from"./chunk-BOVYXYHK.js";import"./chunk-BCREO4Q5.js";import"./chunk-QT6UNBJP.js";import{I as x}from"./chunk-WZDN6K3C.js";import{a as C}from"./chunk-QGVBCWUY.js";import"./chunk-OVHPPCBL.js";import"./chunk-IYZFKXJ6.js";import{v as E}from"./chunk-CKJ56T2Q.js";import"./chunk-F6JAWRPN.js";import"./chunk-UHRSAPGQ.js";import"./chunk-V76GWARL.js";import"./chunk-N2WTMF3X.js";var v=1e3;function I(t,s,o){let n=P(),e=n;return g(e,e,t,.5),g(e,e,s,.5),n[3]=h(e,t),p(e,e,o),n}var _=class{constructor(){this._idToComponent=new Map,this._components=new l(t=>t.bounds),this._edges=new l(t=>t.bounds),this._tmpLineSegment=L(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}async fetchCandidates(t,s){await Promise.resolve(),E(s),await this._ensureEdgeLocations(t,s);let o=[];return this._edges.forEachNeighbor(n=>(this._addCandidates(t,n,o),o.length<v),t.bounds),{result:{candidates:o}}}async _ensureEdgeLocations(t,s){let o=[];if(this._components.forEachNeighbor(i=>{if(i.info==null){let{id:a,uid:r}=i;o.push({id:a,uid:r})}return!0},t.bounds),!o.length)return;let n={components:o},e=await this.remoteClient.invoke("fetchAllEdgeLocations",n,s??{});for(let i of e.components)this._setFetchEdgeLocations(i)}async add(t){let s=new F(t.id,t.bounds);return this._idToComponent.set(s.id,s),this._components.add([s]),{result:{}}}async remove(t){let s=this._idToComponent.get(t.id);if(s){let o=[];this._edges.forEachNeighbor(n=>(n.component===s&&o.push(n),!0),s.bounds),this._edges.remove(o),this._components.remove([s]),this._idToComponent.delete(s.id)}return{result:{}}}_setFetchEdgeLocations(t){let s=this._idToComponent.get(t.id);if(s==null||t.uid!==s.uid)return;let o=w.createView(t.locations),n=new Array(o.count),e=c(),i=c();for(let d=0;d<o.count;d++){o.position0.getVec(d,e),o.position1.getVec(d,i);let m=I(e,i,t.origin),V=new b(s,d,m);n[d]=V}this._edges.add(n);let{objectIds:a,origin:r}=t;s.info={locations:o,objectIds:a,origin:r}}_addCandidates(t,s,o){let{info:n}=s.component,{origin:e,objectIds:i}=n,a=n.locations,r=a.position0.getVec(s.index,this._tmpP1),d=a.position1.getVec(s.index,this._tmpP2);p(r,r,e),p(d,d,e);let m=i[a.componentIndex.get(s.index)];this._addEdgeCandidate(t,m,r,d,o),S(t,m,r,o),S(t,m,d,o)}_addEdgeCandidate(t,s,o,n,e){if(!t.returnEdge)return;let i=t.bounds,a=y(o,n,this._tmpLineSegment),r=j(a,i,this._tmpP3);f(t.bounds,r)&&e.push({type:"edge",objectId:s,target:u(r),distance:h(i,r),start:u(o),end:u(n)})}};_=C([x("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],_);var X=_;function S(t,s,o,n){if(!t.returnVertex||!f(t.bounds,o))return;let e=t.bounds;n.push({type:"vertex",objectId:s,target:u(o),distance:h(e,o)})}var F=(()=>{class t{constructor(o,n){this.id=o,this.bounds=n,this.info=null,this.uid=++t.uid}}return t.uid=0,t})(),b=class{constructor(s,o,n){this.component=s,this.index=o,this.bounds=n}};export{X as default};
