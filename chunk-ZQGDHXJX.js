import{a as Rt}from"./chunk-7CMALMKV.js";import{b as St,c as Et}from"./chunk-56YFAJ3D.js";import{a as Pe,b as Pt,c as Gt,d as Ge}from"./chunk-7WIURX4Y.js";import{a as be}from"./chunk-WPZN772I.js";import{e as Tt}from"./chunk-W26XKMAT.js";import{b as bt}from"./chunk-TOH4K6HW.js";import{b as U,c as vt}from"./chunk-44S2QQS2.js";import{a as A}from"./chunk-NRBJLISB.js";import{a as ve}from"./chunk-JGEVVXD4.js";import{p as te,q as re}from"./chunk-B3FO6PT7.js";import{m as Te}from"./chunk-LFH24RLM.js";import{a as K,n as _e}from"./chunk-Z5Q7KLA4.js";import{a as R}from"./chunk-4XZ6X7MQ.js";import{a as wt,b as _t}from"./chunk-SBHKMV3P.js";import{b as He}from"./chunk-R4A63S45.js";import{E,d as gt}from"./chunk-ETE32IYO.js";import{f as h}from"./chunk-SG7CQU4O.js";import{H as n,J as j}from"./chunk-QHVIRF5H.js";import{I as c,o as ht}from"./chunk-WZDN6K3C.js";import{a as i}from"./chunk-QGVBCWUY.js";import{A as Ye,D as ft,u as ee}from"./chunk-CKJ56T2Q.js";import{r as W,t as u}from"./chunk-UHRSAPGQ.js";import{a as yt}from"./chunk-V76GWARL.js";import{a as T,b as k}from"./chunk-N2WTMF3X.js";var $e,M=$e=class extends j{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return ht($e,e)}};i([n({type:R})],M.prototype,"outSpatialReference",void 0),i([n({type:Te})],M.prototype,"processExtent",void 0),i([n({type:R})],M.prototype,"processSpatialReference",void 0),i([n({nonNullable:!0})],M.prototype,"returnColumnName",void 0),i([n({nonNullable:!0})],M.prototype,"returnFeatureCollection",void 0),i([n({nonNullable:!0})],M.prototype,"returnM",void 0),i([n({nonNullable:!0})],M.prototype,"returnZ",void 0),M=$e=i([c("esri.rest.geoprocessor.GPOptions")],M);var Se=M;var D=class extends h{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};i([n({type:Te})],D.prototype,"extent",void 0),i([n()],D.prototype,"height",void 0),i([n()],D.prototype,"href",void 0),i([n()],D.prototype,"opacity",void 0),i([n()],D.prototype,"rotation",void 0),i([n()],D.prototype,"scale",void 0),i([n()],D.prototype,"visible",void 0),i([n()],D.prototype,"width",void 0),D=i([c("esri.layers.support.MapImage")],D);var It=D;var oe=class extends h{constructor(e){super(e),this.area=0,this.units=null}};i([n({json:{write:!0}})],oe.prototype,"area",void 0),i([A(Et)],oe.prototype,"units",void 0),oe=i([c("esri.rest.support.ArealUnit")],oe);var xt=oe;var ae=class extends h{constructor(e){super(e),this.itemId=null,this.url=null}};i([n({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],ae.prototype,"itemId",void 0),i([n({type:String,json:{write:!0}})],ae.prototype,"url",void 0),ae=i([c("esri.rest.support.DataFile")],ae);var Ee=ae;var ie=class extends h{constructor(e){super(e),this.distance=0,this.units=null}};i([n({json:{write:!0}})],ie.prototype,"distance",void 0),i([A(St)],ie.prototype,"units",void 0),ie=i([c("esri.rest.support.LinearUnit")],ie);var jt=ie;var b="multi-value-",ne=new wt({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${b}areal-unit`,"GPMultiValue:GPBoolean":`${b}boolean`,"GPMultiValue:GPComposite":`${b}composite`,"GPMultiValue:GPDataFile":`${b}data-file`,"GPMultiValue:GPDate":`${b}date`,"GPMultiValue:GPDouble":`${b}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${b}feature-record-set-layer`,"GPMultiValue:Field":`${b}field`,"GPMultiValue:GPLinearUnit":`${b}linear-unit`,"GPMultiValue:GPLong":`${b}long`,"GPMultiValue:GPRasterData":`${b}raster-data`,"GPMultiValue:GPRasterDataLayer":`${b}raster-data-layer`,"GPMultiValue:GPRecordSet":`${b}record-set`,"GPMultiValue:GPString":`${b}string`});var V=class extends h{constructor(e){super(e),this.dataType=null,this.paramName=null,this.value=null}};i([A(ne,{ignoreUnknown:!1})],V.prototype,"dataType",void 0),i([n()],V.prototype,"paramName",void 0),i([n()],V.prototype,"value",void 0),V=i([c("esri.rest.support.ParameterValue")],V);var Dt=V;var B=class extends h{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};i([n()],B.prototype,"format",void 0),i([n({json:{read:{source:"itemID"},write:{target:"itemID"}}})],B.prototype,"itemId",void 0),i([n()],B.prototype,"url",void 0),B=i([c("esri.rest.support.RasterData")],B);var Ct=B;async function Mt(e,t,r,o,a){let s={},p={},l=[];return fr(o,l,s),bt(l).then(d=>{let{outSpatialReference:m,processExtent:y,processSpatialReference:f,returnColumnName:w,returnFeatureCollection:g,returnM:S,returnZ:Z}=r,{path:v}=U(e);for(let mt in s){let[mr,yr]=s[mt];p[mt]=d.slice(mr,yr)}let X=m?m.wkid||m:null,we=f?f.wkid||f:null,J=t==="execute"?{returnColumnName:w||void 0,returnFeatureCollection:g||void 0,returnM:S||void 0,returnZ:Z||void 0}:null,ur=se(k(T(T(T({},y?{context:{extent:y,outSR:X,processSR:we}}:{"env:outSR":X,"env:processSR":we}),o),J),{f:"json"}),null,p),cr=k(T({},a),{query:ur});return E(`${v}/${t}`,cr)})}function fr(e,t,r){for(let o in e){let a=e[o];if(a&&typeof a=="object"&&a instanceof be){let{features:s}=a;r[o]=[t.length,t.length+s.length],s.forEach(p=>{t.push(p.geometry)})}}}async function Ze(e,t){switch(e){case"areal-unit":return xt.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Ee.fromJSON(t);case"linear-unit":return jt.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Ee.fromJSON(t);if("layerDefinition"in t){let r=new(await import("./chunk-KD7CC3OV.js")).default,{layerDefinition:o,featureSet:a}=t;return r.read({layerDefinition:o,featureSet:a},{origin:"portal-item"}),r.spatialReference=R.fromJSON(a.spatialReference??o.spatialReference??o.extent.spatialReference),r}return be.fromJSON(t);case"record-set":return"url"in t?Ee.fromJSON(t):be.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?It.fromJSON(t.mapImage):Ct.fromJSON(t);case"field":return Tt.fromJSON(t)}}function hr(e){return e.startsWith(b)}function gr(e){return e.replace(b,"")}async function wr(e,t){let r=gr(e),o=r==="composite"?t.map(a=>Ze(ne.fromJSON(a.dataType),a.value)):t.map(a=>Ze(r,a));return Promise.all(o)}async function Xe(e){let t=ne.fromJSON(e.dataType),{paramName:r}=e,o=hr(t)?await wr(t,e.value):await Ze(t,e.value);return new Dt({dataType:t,paramName:r,value:o})}function se(e,t,r){for(let o in e){let a=e[o];Array.isArray(a)?e[o]=JSON.stringify(a.map(s=>se({item:s},!0).item)):a instanceof Date&&(e[o]=a.getTime())}return vt(e,t,r)}var Re,_r=_t()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),et=1e3,F=Re=class extends h{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(e){let{jobId:t,sourceUrl:r}=this,{path:o}=U(r),a=k(T(T({},this.requestOptions),e),{query:{f:"json"}}),s=`${o}/jobs/${t}/cancel`,{data:p}=await E(s,a),{messages:l,jobStatus:d,progress:m}=Re.fromJSON(p);return this.set({messages:l,jobStatus:d,progress:m}),d==="job-cancelled"?this:new Promise((y,f)=>{Ye(a.signal,()=>{this.clearCancelJobTimer(),f(ee())}),this.clearCancelJobTimer();let w=()=>{this._cancelJobTimer||f(ee()),this.checkJobStatus(e).then(({jobStatus:g})=>{switch(g){case"job-cancelling":default:this._cancelJobTimer=setTimeout(w,et);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":f(this);break;case"job-cancelled":y(this)}})};this._cancelJobTimer=setTimeout(w,et)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(e){let{path:t}=U(this.sourceUrl),r=k(T(T({},this.requestOptions),e),{query:{f:"json"}}),o=`${t}/jobs/${this.jobId}`,{data:a}=await E(o,r),{messages:s,jobStatus:p,progress:l}=Re.fromJSON(a);return this.set({messages:s,jobStatus:p,progress:l}),this}async fetchResultData(e,t,r){t=Se.from(t||{});let{returnColumnName:o,returnFeatureCollection:a,returnM:s,returnZ:p,outSpatialReference:l}=t,{path:d}=U(this.sourceUrl),m=se({returnColumnName:o||null,returnFeatureCollection:a||null,returnM:s||null,returnZ:p||null,outSR:l,returnType:"data",f:"json"},null),y=k(T(T({},this.requestOptions),r),{query:m}),f=`${d}/jobs/${this.jobId}/results/${e}`,{data:w}=await E(f,y);return Xe(w)}async fetchResultImage(e,t,r){let{path:o}=U(this.sourceUrl),a=k(T({},t.toJSON()),{f:"json"}),s=se(a),p=k(T(T({},this.requestOptions),r),{query:s}),l=`${o}/jobs/${this.jobId}/results/${e}`,{data:d}=await E(l,p);return Xe(d)}async fetchResultMapImageLayer(){let{path:e}=U(this.sourceUrl),t=e.indexOf("/GPServer/"),r=`${e.slice(0,Math.max(0,t))}/MapServer/jobs/${this.jobId}`;return new(await import("./chunk-I6FMIKYS.js")).default({url:r})}async waitForJobCompletion(e={}){let{interval:t=et,signal:r,statusCallback:o}=e;return new Promise((a,s)=>{Ye(r,()=>{this.clearJobCompletionTimer(),s(ee())}),this.clearJobCompletionTimer();let p=()=>{this._jobCompletionTimer||s(ee()),this.checkJobStatus().then(({jobStatus:l})=>{switch(l){case"job-succeeded":a(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":o&&o(this),this._jobCompletionTimer=setTimeout(p,t);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":s(this);break;default:this._jobCompletionTimer=setTimeout(p,t)}}).catch(l=>{s(l)})};this._jobCompletionTimer=setTimeout(p,t)})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}};i([n()],F.prototype,"jobId",void 0),i([A(_r,{ignoreUnknown:!1})],F.prototype,"jobStatus",void 0),i([n({type:[Rt]})],F.prototype,"messages",void 0),i([n()],F.prototype,"progress",void 0),i([n()],F.prototype,"requestOptions",void 0),i([n({json:{write:!0}})],F.prototype,"sourceUrl",void 0),F=Re=i([c("esri.rest.support.JobInfo")],F);var Ot=F;async function kt(e,t,r,o){return r=Se.from(r||{}),Mt(e,"submitJob",r,t??{},o).then(({data:a})=>{let s=Ot.fromJSON(a);return s.sourceUrl=e,s})}var Y=class extends j{constructor(e){super(e),this.headerKeys=[],this.outSpatialReference=null,this.exceededTransferLimit=!1}};i([n()],Y.prototype,"headerKeys",void 0),i([n()],Y.prototype,"outSpatialReference",void 0),i([n()],Y.prototype,"exceededTransferLimit",void 0),Y=i([c("esri.rest.knowledgeGraph.GraphQueryResultHeader")],Y);var L=Y;var pe=class extends j{constructor(e){super(e),this.resultRows=[],this.resultHeader=new L}};i([n()],pe.prototype,"resultRows",void 0),i([n()],pe.prototype,"resultHeader",void 0),pe=i([c("esri.rest.knowledgeGraph.GraphQueryResult")],pe);var tt=pe;var le=class extends j{constructor(e){super(e),this.resultRowsStream=new ReadableStream,this.resultHeader=new L}};i([n()],le.prototype,"resultRowsStream",void 0),i([n()],le.prototype,"resultHeader",void 0),le=i([c("esri.rest.knowledgeGraph.GraphQueryStreamingResult")],le);var rt=le;var q=class extends h{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=!0,this.description="",this.fieldNames=[]}};i([n({type:String,json:{write:!0}})],q.prototype,"name",void 0),i([n({type:Boolean,json:{write:!0}})],q.prototype,"unique",void 0),i([n({type:Boolean,json:{write:!0}})],q.prototype,"ascending",void 0),i([n({type:String,json:{write:!0}})],q.prototype,"description",void 0),i([n({type:[String],json:{write:!0}})],q.prototype,"fieldNames",void 0),q=i([c("esri.rest.knowledgeGraph.FieldIndex")],q);var Ie=q;var G=class extends h{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=!0,this.required=!1,this.defaultVisibility=!0,this.systemMaintained=null,this.role="esriGraphPropertyUNSPECIFIED",this.defaultValue=null}};i([n({type:String,json:{write:!0}})],G.prototype,"name",void 0),i([n({type:String,json:{write:!0}})],G.prototype,"alias",void 0),i([n({type:String,json:{write:!0}})],G.prototype,"fieldType",void 0),i([n({type:String,json:{write:!0}})],G.prototype,"geometryType",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"hasM",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"hasZ",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"nullable",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"editable",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"required",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"defaultVisibility",void 0),i([n({type:Boolean,json:{write:!0}})],G.prototype,"systemMaintained",void 0),i([n({type:String,json:{write:!0}})],G.prototype,"role",void 0),i([n({json:{write:!0}})],G.prototype,"defaultValue",void 0),G=i([c("esri.rest.knowledgeGraph.GraphProperty")],G);var xe=G;var N=class extends h{constructor(e){super(e),this.name=null,this.alias=null,this.role="Regular",this.strict=null,this.properties=[],this.fieldIndexes=[],this.type=null}};i([n({type:String,json:{write:!0}})],N.prototype,"name",void 0),i([n({type:String,json:{write:!0}})],N.prototype,"alias",void 0),i([n({type:String,json:{write:!0}})],N.prototype,"role",void 0),i([n({type:Boolean,json:{write:!0}})],N.prototype,"strict",void 0),i([n({type:[xe],json:{write:!0}})],N.prototype,"properties",void 0),i([n({type:[Ie],json:{write:!0}})],N.prototype,"fieldIndexes",void 0),N=i([c("esri.rest.knowledgeGraph.GraphObjectType")],N);var de=N;var ot=class extends de{constructor(e){super(e),this.type="entity"}};ot=i([c("esri.rest.knowledgeGraph.EntityType")],ot);var ue=ot;var je=class extends de{constructor(e){super(e),this.endPoints=[],this.type="relationship"}};i([n({json:{write:!0}})],je.prototype,"endPoints",void 0),je=i([c("esri.rest.knowledgeGraph.RelationshipType")],je);var De=je;var ce=class extends h{constructor(e){super(e),this.value=null,this.behavior=null}};i([n({type:String,json:{write:!0}})],ce.prototype,"value",void 0),i([n({type:String,json:{write:!0}})],ce.prototype,"behavior",void 0),ce=i([c("esri.rest.knowledgeGraph.SourceTypeValueBehavior")],ce);var Ce=ce;var I=class extends h{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=[],this.entityTypes=[],this.relationshipTypes=[],this.metaEntityTypes=[],this.provenanceSourceTypeValues=[]}};i([n({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],I.prototype,"timestamp",void 0),i([n({type:R,json:{write:!0}})],I.prototype,"spatialReference",void 0),i([n({type:Boolean,json:{write:!0}})],I.prototype,"strict",void 0),i([n({type:String,json:{write:!0}})],I.prototype,"objectIdField",void 0),i([n({type:String,json:{write:!0}})],I.prototype,"globalIdField",void 0),i([n()],I.prototype,"arcgisManaged",void 0),i([n()],I.prototype,"identifierInfo",void 0),i([n()],I.prototype,"searchIndexes",void 0),i([n({type:[ue],json:{write:!0}})],I.prototype,"entityTypes",void 0),i([n({type:[De],json:{write:!0}})],I.prototype,"relationshipTypes",void 0),i([n({type:[ue],json:{write:!0}})],I.prototype,"metaEntityTypes",void 0),i([n({type:[Ce],json:{write:!0}})],I.prototype,"provenanceSourceTypeValues",void 0),I=i([c("esri.rest.knowledgeGraph.DataModel")],I);var Me=I;var _=class extends h{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1,this.supportsProvenance=!1}};i([n({type:[String],json:{write:!0}})],_.prototype,"capabilities",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"supportsSearch",void 0),i([n({type:[String],json:{write:!0}})],_.prototype,"supportedQueryFormats",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"allowGeometryUpdates",void 0),i([n({type:Number,json:{write:!0}})],_.prototype,"searchMaxRecordCount",void 0),i([n({type:Object,json:{write:!0}})],_.prototype,"serviceCapabilities",void 0),i([n({type:Number,json:{write:!0}})],_.prototype,"maxRecordCount",void 0),i([n({type:String,json:{write:!0}})],_.prototype,"description",void 0),i([n({type:String,json:{write:!0}})],_.prototype,"copyrightText",void 0),i([n({type:String,json:{write:!0}})],_.prototype,"units",void 0),i([n({type:R,json:{write:!0}})],_.prototype,"spatialReference",void 0),i([n({type:Number,json:{write:!0}})],_.prototype,"currentVersion",void 0),i([n({type:Object,json:{write:!0}})],_.prototype,"dateFieldsTimeReference",void 0),i([n({type:String,json:{write:!0}})],_.prototype,"serviceItemId",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"supportsDocuments",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"dataEditingNotSupported",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"schemaEditingNotSupported",void 0),i([n({type:Boolean,json:{write:!0}})],_.prototype,"supportsProvenance",void 0),_=i([c("esri.rest.knowledgeGraph.ServiceDefinition")],_);var Oe=_;var H=class extends h{constructor(e){super(e),this.url=null,this.dataModel=null,this.serviceDefinition=null}};i([n({type:String,json:{write:!0}})],H.prototype,"url",void 0),i([n({type:Me,json:{write:!0}})],H.prototype,"dataModel",void 0),i([n({type:Oe,json:{write:!0}})],H.prototype,"serviceDefinition",void 0),H=i([c("esri.rest.knowledgeGraph.KnowledgeGraph")],H);var Ft=H;function O(e,t,r){if(e.error_code!==0)throw new u(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function Nt(e,t,r,o=!1){let a=new r.ClientDataFetchRequestEncoder;a.deleteLater();for(let p of e){let l=Tr(p,t,r,o);a.add_client_data_fetch_request_parameter(l)}a.encode();let s=a.get_encoding_result();return O(s.error,"knowledge-graph:fetchClientDataAtKeys-encoding-failed","Attempting to encode the fetchClientDataAtKeys failed"),structuredClone(s.get_byte_buffer())}function Tr(e,t,r,o){let a=new r.ClientDataKey;a.deleteLater(),a.key_string=e;let s=new r.ClientDataFetchRequestParameter;s.deleteLater(),s.set_key(a);let p=t.get(e);return p&&!o&&(s.v_tag={v_tag:p.version}),s}var At="esri/rest/knowledgeGraph/wasmInterface/",at,vr=null;async function C(){let e=vr??at;if(e)return e;let t=!!yt("wasm-simd");return at=br(t),at}async function br(e){if(e){let{default:r}=await import("./chunk-BISBYJCP.js").then(o=>o.a);return r({locateFile:o=>He(At+o)})}let{default:t}=await import("./chunk-DXRK7MPE.js").then(r=>r.a);return t({locateFile:r=>He(At+r)})}var z,Ut,ke;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})(z||(z={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Ut||(Ut={})),function(e){e[e.exclude=0]="exclude",e[e.include=1]="include"}(ke||(ke={}));function it(e,t){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(st(o,t))}),r}function nt(e,t){let r=new t.ObjectValue;r.deleteLater();for(let[o,a]of Object.entries(e))r.set_key_value(o,st(a,t));return r}function me(e,t){if(e instanceof ve)return Gr(e,t);if(e instanceof _e)return Sr(e,t);if(e instanceof re||e instanceof te)return Pr(e,t);throw new u("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function Lt(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function qt(e,t,r){if(!e.extent)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new u("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function zt(e,t){t.provenance_behavior={value:ke[e]}}function st(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof K)return me(e,t);if(Array.isArray(e)){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(st(o,t))}),r}return nt(e,t)}function Pr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[],s=[];e instanceof re?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,s=e.paths):e instanceof te&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,s=e.rings);let p=0,l=0;return s.forEach(d=>{let m=0;d.forEach(y=>{m++,y.forEach(f=>{o[l]=f,l++})}),a[p]=m,p++}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function Gr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[];a[0]=e.points.length;let s=0;return e.points.forEach(p=>{p.forEach(l=>{o[s]=l,s++})}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function Sr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],a=[];a[0]=1,o[0]=e.x,o[1]=e.y;let s=2;return e.hasZ&&(o[s]=e.z,s++),e.hasM&&(o[s]=e.m,s++),r.coords=new Float64Array(o),r.lengths=new Uint32Array(a),r}function ye(e,t){if(!e.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Pe){let r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,a]of Object.entries(e.properties))r.set_key_value(o,Jt(a,t));return e.id&&r.set_id(e.id),r}if(e instanceof Ge){let r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,a]of Object.entries(e.properties))r.set_key_value(o,Jt(a,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new u("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function Wt(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Jt(e,t){return e==null?null:typeof e!="object"||e instanceof Date?e:e instanceof K?me(e,t):null}var Fe,Qt,fe,Ne;(function(e){e[e.ClientDataKeyTypeUNSPECIFIED=0]="ClientDataKeyTypeUNSPECIFIED",e[e.ClientDataKeyTypeString=1]="ClientDataKeyTypeString"})(Fe||(Fe={})),function(e){e[e.ClientDataTypeUNSPECIFIED=0]="ClientDataTypeUNSPECIFIED",e[e.ClientDataTypeString=1]="ClientDataTypeString"}(Qt||(Qt={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.ClientData=1]="ClientData",e[e.NotModified=2]="NotModified"}(fe||(fe={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Error=1]="Error",e[e.ClientDataValue=2]="ClientDataValue"}(Ne||(Ne={}));function Kt(e,t,r,o=!1){let a=new Map;for(let s=0;s<e.get_results_count();s++){let p=e.get_result_at(s);if(p.get_fetch_result_case().value!==Ne.ClientDataValue||p.error().error_code!==0){let f=p.get_key().key_string;r.has(f)&&t.delete(f);continue}let l=p.get_value(),d=p.get_key().key_string,m=r.get(d),y;if(l.get_data_case().value===fe.NotModified&&m)y=m.value;else{if(l.get_data_case().value!==fe.ClientData)continue;{y=l.get_data().client_data_string;let f=p.get_value().get_v_tag().v_tag;o||t.set(d,{key:d,version:f,value:y})}}a.set(d,y)}return a}function Vt(e){let t=e.get_keys(),r=new Array;for(let o=0;o<t.get_keys_count();o++){let a=t.get_key_at(o);a.get_client_data_key_type().value===Fe.ClientDataKeyTypeString&&r.push(a.key_string)}return r}var Q=class extends j{constructor(e){super(e),this.name=null,this.supportedCategory="esriTypeUNSPECIFIED",this.analyzers=[],this.searchProperties=new Map}};i([n()],Q.prototype,"name",void 0),i([n()],Q.prototype,"supportedCategory",void 0),i([n()],Q.prototype,"analyzers",void 0),i([n()],Q.prototype,"searchProperties",void 0),Q=i([c("esri.rest.knowledgeGraph.SearchIndex")],Q);var Bt=Q;var Ae,he,ge,Ue,Le,qe,ze;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(Ae||(Ae={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(he||(he={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(ge||(ge={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Ue||(Ue={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Le||(Le={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension",e[e.esriGraphPropertyProvenanceInstanceId=10]="esriGraphPropertyProvenanceInstanceId",e[e.esriGraphPropertyProvenanceSourceType=11]="esriGraphPropertyProvenanceSourceType",e[e.esriGraphPropertyProvenanceSourceName=12]="esriGraphPropertyProvenanceSourceName",e[e.esriGraphPropertyProvenanceSource=13]="esriGraphPropertyProvenanceSource",e[e.esriGraphPropertyProvenanceComment=14]="esriGraphPropertyProvenanceComment",e[e.esriGraphPropertyProvenanceTypeName=15]="esriGraphPropertyProvenanceTypeName",e[e.esriGraphPropertyProvenancePropertyName=16]="esriGraphPropertyProvenancePropertyName"}(qe||(qe={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(ze||(ze={}));var pt=!1;function Ht(e){e.deleteLater(),pt=!1;let t=new Me({timestamp:e.timestamp,spatialReference:new R(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:ze[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Ue[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:Fr(e.search_indexes),entityTypes:Yt(e.entity_types),relationshipTypes:Or(e.relationship_types),metaEntityTypes:Yt(e.meta_entity_types),provenanceSourceTypeValues:kr(e.provenance_source_type_values.value_behavior_array)});return pt&&W.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),t}function Er(e){return e.deleteLater(),new ue($t(e))}function Rr(e){return e.deleteLater(),new Ie({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Dr(e.fields)})}function $t(e){return{name:e.name,alias:e.alias,role:Ae[e.role.value],strict:e.strict,properties:Cr(e.properties),fieldIndexes:Mr(e.field_indexes)}}function Ir(e){return e.deleteLater(),new xe({alias:e.alias,name:e.name,fieldType:he[e.field_type.value]?he[e.field_type.value]:void 0,geometryType:ge[e.geometry_type.value]?ge[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:qe[e.role.value],defaultValue:e.default_value})}function xr(e){e.deleteLater();let t=$t(e),r=[];for(let o=0;o<e.end_points.size();o++){let a=e.end_points.get(o);r.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return e.end_points.delete(),new De(Object.assign({endPoints:r},t))}function jr(e){return new Ce({behavior:e.behavior,value:e.value})}function Yt(e){let t=[];for(let r=0;r<e.size();r++)t.push(Er(e.get(r)));return e.delete(),t}function Dr(e){let t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return e.delete(),t}function Cr(e){let t=[];for(let r=0;r<e.size();r++){let o=Ir(e.get(r));o.fieldType==="esriFieldTypeBigInteger"&&(pt=!0),t.push(o)}return e.delete(),t}function Mr(e){let t=[];for(let r=0;r<e.size();r++)t.push(Rr(e.get(r)));return e.delete(),t}function Or(e){let t=[];for(let r=0;r<e.size();r++)t.push(xr(e.get(r)));return e.delete(),t}function kr(e){let t=[];for(let r=0;r<e.size();r++){let o=e.get(r);o.deleteLater(),t.push(jr(o))}return e.delete(),t}function Fr(e){let t=[];for(let r=0;r<e.size();r++){let o=new Bt,a=e.get(0);o.name=a.name,o.supportedCategory=Le[a.supported_category.value];let s=a.analyzers.size();for(let p=0;p<s;p++)o.analyzers.push({name:a.analyzers.get(p).name});a.analyzers.delete();for(let p=0;p<a.search_properties.keys().size();p++){let l=a.search_properties.keys().get(p),d=a.search_properties.get(l),m=[];for(let y=0;y<d.property_names.size();y++)m.push(d.property_names.get(y));o.searchProperties.set(l,{propertyNames:m})}t.push(o)}return e.delete(),t}var x;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(x||(x={}));function Zt(e,t){let r={spatialReference:t},o=lt(e,r),a=e.lengths,s=e.coords,p=a[0];r.points=[];let l=0;for(let d=0;d<p;d++){let m=[];for(let y=0;y<o;y++)m[y]=s[l],l++;r.points.push(m)}return new ve(r)}function Xt(e,t){let r={spatialReference:t},o=2;lt(e,r);let a=e.coords;return r.x=a[0],r.y=a[1],e.has_z&&(r.z=a[o],o++),e.has_m&&(r.m=a[o]),new _e(r)}function er(e,t){let{paths:r,hasM:o,hasZ:a}=rr(e,x.ESRI_GEOMETRY_POLYLINE);return new re({paths:r,hasM:o,hasZ:a,spatialReference:t})}function tr(e,t){let{paths:r,hasM:o,hasZ:a}=rr(e,x.ESRI_GEOMETRY_POLYGON);return new te({rings:r,hasM:o,hasZ:a,spatialReference:t})}function rr(e,t){let r={paths:[],hasM:!1,hasZ:!1},o=lt(e,r),{coords:a,geometry_type:s,lengths:p}=e;if(s.value!==t)throw new u("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");let l=0;return p.forEach(d=>{let m=[];for(let y=0;y<d;y++){let f=[];for(let w=0;w<o;w++)f[w]=a[l],l++;m.push(f)}r.paths.push(m)}),r}function lt(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}var Je=()=>W.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),Nr={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case x.ESRI_GEOMETRY_POINT:return Xt(e,r);case x.ESRI_GEOMETRY_MULTIPOINT:return Zt(e,r);case x.ESRI_GEOMETRY_POLYLINE:return er(e,r);case x.ESRI_GEOMETRY_POLYGON:return tr(e,r);case x.ESRI_GEOMETRY_ENVELOPE:case x.ESRI_GEOMETRY_MULTI_PATCH:return Je().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case x.ESRI_GEOMETRY_NULL:case x.ESRI_GEOMETRY_ANY:default:return Je().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return Je().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case z.OBJECT:return Ur(e,t,r);case z.ENTITY:return or(e,t,r);case z.RELATIONSHIP:return ar(e,t,r);case z.PATH:return Lr(e,t,r);case z.ARRAY:return Ar(e,t,r);default:return Je().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Ar(e,t,r){let o=[],a=e.count();for(let s=0;s<a;s++){let p=e.get_value_at(s);o.push(We(p,t,r))}return o}function We(e,t,r){return Nr.decodedWasmObjToQueryResponseObj(e,t,r)}function or(e,t,r){let o=e.type_name,a=dt(e,t,r),s=e.get_id();return new Pe(Object.assign({typeName:o,id:s},a))}function dt(e,t,r){let o={},a=e.key_count();for(let s=0;s<a;s++)o[e.get_key_at(s)]=We(e.get_value_at(s),t,r);return{properties:o}}function Ur(e,t,r){return new Pt(dt(e,t,r))}function Lr(e,t,r){let o=e.entity_count(),a=e.relationship_count(),s=[];for(let p=0;p<o;p++)s.push(or(e.get_entity_at(p),t,r)),p<a&&s.push(ar(e.get_relationship_at(p),t,r));return new Gt({path:s})}function ar(e,t,r){let o=e.type_name,a=dt(e,t,r);return new Ge(Object.assign({typeName:o,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},a))}function ir(e){let t=[];for(let o=0;o<e.get_header_keys().size();o++)t.push(e.get_header_keys().get(o));let r=new R(e.get_out_sr());return new L({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}var $=class extends j{constructor(e){super(e),this.hasError=!1,this.error=null,this.editResults=[]}};i([n()],$.prototype,"hasError",void 0),i([n()],$.prototype,"error",void 0),i([n()],$.prototype,"editResults",void 0),$=i([c("esri.rest.knowledgeGraph.GraphApplyEditsResult")],$);var nr=$;function sr(e){let t=e.has_error(),r=new nr({hasError:t,error:t?{errorCode:e.error.error_code,errorMessage:e.error.error_message}:null}),o=e.get_edit_results_count();for(let a=0;a<o;a++){let s=e.get_edit_results_at(a),p=e.get_edit_results_type_name_at(a),l=[],d=[],m=[],y=s.get_add_results_count(),f=s.get_update_results_count(),w=s.get_delete_results_count();for(let g=0;g<y;g++){let S=s.get_add_result_at(g);l.push({id:S.id,error:{errorCode:S.error.error_code,errorMessage:S.error.error_message}})}for(let g=0;g<f;g++){let S=s.get_update_result_at(g);d.push({id:S.id,error:{errorCode:S.error.error_code,errorMessage:S.error.error_message}})}for(let g=0;g<w;g++){let S=s.get_delete_result_at(g);m.push({id:S.id,error:{errorCode:S.error.error_code,errorMessage:S.error.error_message}})}r.editResults.push({typeName:p,adds:l,updates:d,deletes:m})}return r}var Ve=new Map,al=()=>new Map(Ve.entries()),P={fetchKnowledgeGraph:async e=>{let t=new Ft({url:e}),r=[];return r.push(Be(t)),r.push(qr(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await dr(e)},refreshServiceDefinition:async e=>{let t=(await E(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new Oe(t),e.serviceDefinition},executeFindPathsAsynchronous:async(e,t)=>{let r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");let o=r[0];return await zr(`${o}/rest/services/System/KnowledgeGraphServerToolsAsync/GPServer/ServerFilteredFindPaths`,{in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:e.config.toJSON(),result_type:"STRING"},{},t)},executeFindPaths:async(e,t)=>{let r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new u("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");let o=r[0],a=await Jr(`${o}/rest/services/System/KnowledgeGraphServerTools/GPServer/ServerFilteredFindPaths/execute`,T({method:"post",query:{f:"pjson",in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:JSON.stringify(e.config),result_type:"STRING"}},t));if(a.data.results.length<1)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results returned",a);let s;for(let p of a.data.results)if(p.paramName==="out_results_string"){s=p.value;break}if(!s)throw new u("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results were returned on the expected paramater out_results_string",a);return s},fetchAsynchronousFindPathsResultData:async(e,t)=>(await e.fetchResultData("out_results_string",null,t)).value,executeQueryStreaming:async(e,t,r)=>{let o="include",a=`${e.url}/graph/query`;await ut(e);let s=await Ke(a,r);if(!e.serviceDefinition?.supportsProvenance&&t.provenanceBehavior===o)throw new u("knowledge-graph:provenance-not-supported","The Knowledge Graph Service definition indicated that provenance is not supported");s.data.body=await Kr(t,e);let p=await Qe(s.data.url,s.data);if(e.dataModel){let l=await pr(p,e.dataModel);return new rt({resultRowsStream:l.readableStream,resultHeader:l.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{if(e.serviceDefinition?.dataEditingNotSupported)throw new u("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");let o=`${e.url}/graph/applyEdits`;await ut(e);let a=await Ke(o,r);return a.data.body=await Qr(t,e),Br(await Qe(a.data.url,a.data))},executeQuery:async(e,t,r)=>{let o=`${e.url}/graph/query`,a=await E(o,{responseType:"array-buffer",query:T({f:"pbf",openCypherQuery:t.openCypherQuery},r?.query),signal:r?.signal,timeout:r?.timeout}),s=a.getHeader?.("content-type"),p=a.data;if(s?.includes("application/x-protobuf")){let l=new(await C()).GraphQueryDecoder;if(l.deleteLater(),e.dataModel){let d=ct({wasmQueryDecoder:l,newArrayBufferToParse:p,dataModel:e.dataModel});return new tt({resultRows:d.resultRows,resultHeader:d.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:a.data})},executeSearch:async(e,t,r)=>{let o=t.typeCategoryFilter,a=`${e.url}/graph/search`,s=await E(a,{responseType:"array-buffer",query:T({f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:o},r?.query),signal:r?.signal,timeout:r?.timeout}),p=s.getHeader?.("content-type"),l=s.data;if(p?.includes("application/x-protobuf")){let d=new(await C()).GraphQueryDecoder;if(d.deleteLater(),e.dataModel){let m=ct({wasmQueryDecoder:d,newArrayBufferToParse:l,dataModel:e.dataModel});return new tt({resultRows:m.resultRows,resultHeader:m.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:p,data:s.data})},executeSearchStreaming:async(e,t,r)=>{let o=`${e.url}/graph/search`;await ut(e);let a=await Ke(o,r);a.data.body=await Vr(t);let s=await Qe(a.data.url,a.data);if(e.dataModel){let p=await pr(s,e.dataModel);return new rt({resultRowsStream:p.readableStream,resultHeader:p.resultHeader})}throw new u("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},fetchClientDataAtKeys:async(e,t,r={ignoreCache:!1})=>{if(!t.length)return new Map;let o=Ve.get(e.url||"");o||(o=new Map,Ve.set(e.url||"",o));let a=new Map(o.entries()),s=`${e.url}/clientData/fetch`;t=Array.from(new Set(t));let p=await C(),l=Nt(t,o,p,r.ignoreCache),d=await Ke(s,r.requestOptions);d.data.body=l;let m=await Qe(d.data.url,d.data),y=m.headers.get("content-type");if(y?.includes("application/x-protobuf")){let f=new p.ClientDataFetchResponseDecoder;f.deleteLater();let w=await m.arrayBuffer();return f.decode(new Uint8Array(w)),f.has_error()&&O(f.error,"knowledge-graph:fetchClientDataAtKeys-decoding-error","An error occurred while decoding the client data keys response"),Kt(f,o,a,r.ignoreCache)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response when fetching client data",{responseType:y,data:m})},fetchAllClientDataKeys:async(e,t)=>{let r=`${e.url}/clientData`,o=await E(r,{responseType:"array-buffer",query:{f:"pbf"},signal:t?.signal,timeout:t?.timeout}),a=o.getHeader?.("content-type"),s=o.data;if(a?.includes("application/x-protobuf")){let p=new(await C()).ClientDataKeysResponseDecoder;return p.deleteLater(),p.decode(new Uint8Array(s)),p.has_error()&&O(p.error,"knowledge-graph:fetchAllClientDataKeys-decoding-error","An error occurred while decoding the client data keys response"),Vt(p)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:o.data})},clearClientDataCache:()=>Ve.clear(),_fetchWrapper:async(e,t)=>fetch(e,t),_submitJobWrapper:async(e,t,r,o)=>kt(e,t,r,o),_esriRequestWrapper:async(e,t)=>E(e,t)};async function il(e,t,r){return P.executeApplyEdits(e,t,r)}async function nl(e,t,r){return P.executeQuery(e,t,r)}async function sl(e,t,r){return P.executeQueryStreaming(e,t,r)}async function pl(e,t,r){return P.executeSearch(e,t,r)}async function ll(e,t,r){return P.executeSearchStreaming(e,t,r)}function dl(e,t){return P.fetchAllClientDataKeys(e,t)}function ul(e,t,r){return P.fetchClientDataAtKeys(e,t,r)}async function cl(e){return P.fetchKnowledgeGraph(e)}async function Be(e){return P.refreshDataModel(e)}async function qr(e){return P.refreshServiceDefinition(e)}async function ml(e,t){return P.executeFindPathsAsynchronous(e,t)}async function yl(e,t){return P.executeFindPaths(e,t)}async function fl(e,t){return P.fetchAsynchronousFindPathsResultData(e,t)}function hl(){return P.clearClientDataCache()}async function Qe(e,t){return P._fetchWrapper(e,t)}async function zr(e,t,r,o){return P._submitJobWrapper(e,t,r,o)}async function Jr(e,t){return P._esriRequestWrapper(e,t)}async function ut(e){gt?.findCredential(e.url)||(e.dataModel?await dr(e):await Be(e))}function Wr(e,t,r,o){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof K?r.set_param_key_value(e,me(t,o)):Array.isArray(t)?r.set_param_key_value(e,it(t,o)):r.set_param_key_value(e,nt(t,o))}async function Qr(e,t){if(t.dataModel||await Be(t),!t.dataModel)throw new u("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");let r=await C(),o=!!e.options?.cascadeDelete,a=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?Wt(e.options?.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());a.deleteLater(),a.cascade_delete=o;try{let p;e.entityAdds?.forEach(l=>{p=a.add_entity(ye(l,r)),O(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(l=>{if(!l.originId||!l.destinationId)throw new u("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");p=a.add_relationship(ye(l,r)),O(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(l=>{if(!l.id)throw new u("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");p=a.update_entity(ye(l,r)),O(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(l=>{if(!l.id)throw new u("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");p=a.update_relationship(ye(l,r)),O(p,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(l=>{if(!l.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let d=a.make_delete_helper(l.typeName,!0);d.deleteLater(),l.ids?.forEach(m=>{d.delete_by_id(m)})}),e.relationshipDeletes?.forEach(l=>{if(!l.typeName)throw new u("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let d=a.make_delete_helper(l.typeName,!1);l.ids?.forEach(m=>{d.delete_by_id(m)})}),a.encode()}catch(p){throw new u("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:p})}let s=a.get_encoding_result();return O(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(s.get_byte_buffer())}async function Kr(e,t){let r=await C(),o=new r.GraphQueryRequestEncoder;if(o.deleteLater(),e.outputSpatialReference?o.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:o.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),o.open_cypher_query=e.openCypherQuery,e.bindParameters)for(let[s,p]of Object.entries(e.bindParameters))Wr(s,p,o,r);if(e.bindGeometryQuantizationParameters)Lt(e.bindGeometryQuantizationParameters,o);else{if(t.dataModel||await Be(t),t.dataModel?.spatialReference?.wkid!==4326)throw new u("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");o.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&qt(e.outputQuantizationParameters,o,r),e.provenanceBehavior&&zt(e.provenanceBehavior,o);try{o.encode()}catch(s){throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:s})}let a=o.get_encoding_result();if(a.error.error_code!==0)throw new u("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return structuredClone(a.get_byte_buffer())}async function Vr(e){let t=await C(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(it(e.idsFilter,t))}catch(a){throw new u("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:a})}e.namedTypesFilter?.forEach(a=>{r.add_named_type_filter(a)});try{r.encode()}catch(a){throw new u("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:a})}let o=r.get_encoding_result();if(o.error.error_code!==0)throw new u("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return structuredClone(o.get_byte_buffer())}async function Ke(e,t){return E(e,{responseType:"native-request-init",method:"post",query:T({f:"pbf"},t?.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}async function Br(e){let t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){let r=await e.arrayBuffer(),o=new(await C()).GraphApplyEditsDecoder;return o.deleteLater(),o.decode(new Uint8Array(r)),sr(o)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}var lr=50;function gl(e){lr=e}function ct({wasmQueryDecoder:e,newArrayBufferToParse:t,dataModel:r,decodedHeader:o,limitMaxProcessingTime:a=!1}){t&&e.push_buffer(new Uint8Array(t));let s=[],p,l,d=0,m=Date.now(),y=!0;for(;e.next_row();){p&&l||(p=o??ir(e),l=p.outSpatialReference??new R({wkid:4326})),d||(d=e.get_header_keys().size());let f=new Array(d);for(let w=0;w<d;w++){let g=e.get_value(w);f[w]=We(g,r,l)}if(s.push(f),a&&Date.now()-m>lr){y=!1;break}}if(e.has_error())throw new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - inner row decoding",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return{resultHeader:p,resultRows:s,parsedAllResultsFromBuffer:y}}async function pr(e,t){let r=e.headers.get("content-type");if(e.headers.get("content-length")&&W.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r?.includes("application/x-protobuf")){let o=e.body?.getReader(),a=new(await C()).GraphQueryDecoder,s,p,l;a.deleteLater();let d=new Promise((w,g)=>{p=w,l=g}),m=!1,y=null;return{readableStream:new ReadableStream({pull:async function w(g){if(!o){let v=new u("knowledge-graph:stream-decoding-error","Error reading from stream - reader is undefined");throw l(v),v}let{done:S,value:Z}=y?{done:!1,value:null}:await o.read().catch(v=>{throw l(v),o.releaseLock(),v});Z&&(y=Z);try{if(S){let J;if(a.has_error()?J=new u("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - query stream done",{errorCode:a.error.error_code,errorMessage:a.error.error_message}):m||p(new L),o.releaseLock(),J)throw g.error(J),l(J),J;return void g.close()}let{resultHeader:v,resultRows:X,parsedAllResultsFromBuffer:we}=ct({wasmQueryDecoder:a,newArrayBufferToParse:Z,dataModel:t,decodedHeader:s,limitMaxProcessingTime:!0});return we&&(y=null),!s&&v&&(s=v,p(v),m=!0),X.length>0?void g.enqueue(X):await w(g)}catch(v){throw W.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").error(v),l(v),o.releaseLock(),ft(v)?v:new u("knowledge-graph:unexpected-server-response","Error inside streaming data return parsing",{error:v})}}}),resultHeader:await d}}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function dr(e){let t=`${e.url}/dataModel/queryDataModel`,r=await E(t,{responseType:"array-buffer",query:{f:"pbf"}}),o=r.getHeader?.("content-type"),a=r.data;if(o?.includes("application/x-protobuf")){let s=(await C()).decode_data_model_from_protocol_buffer(new Uint8Array(a));if(!s)throw new u("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return Ht(s)}throw new u("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:r.data})}export{C as a,he as b,ge as c,Ve as d,al as e,P as f,il as g,nl as h,sl as i,pl as j,ll as k,dl as l,ul as m,cl as n,Be as o,qr as p,ml as q,yl as r,fl as s,hl as t,Qe as u,zr as v,Jr as w,gl as x};
