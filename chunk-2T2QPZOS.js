import{c as S,g as D}from"./chunk-HUKD3ORH.js";import{A as p,B as N,C as T,a as F,b as E,z as A}from"./chunk-HP4LYRR4.js";import{a as x}from"./chunk-AFC2H4Q3.js";import{c as L}from"./chunk-4G7UTTZJ.js";import{b as h}from"./chunk-NSYL2RQJ.js";import{b as v,c as w}from"./chunk-KJULKTB5.js";import{r as b,t as f}from"./chunk-UHRSAPGQ.js";var d=()=>b.getLogger("esri.layers.support.labelFormatUtils"),g={type:"simple",evaluate:()=>null},I={getAttribute:(n,t)=>n.field(t)};async function q(n,t,u){if(!n||!n.symbol||!t)return g;let l=n.where,o=S(n),a;if(o.type==="arcade"){let i=E(o.expression),s=t.get(i);if(s&&(A(s)||p(s)||N(s)))a={type:"simple",evaluate(e){let r="attributes"in e?e.attributes?.[s.name]:e.field(s.name);return r==null?"":r.toString()}};else{let e=await L(o.expression,u,t);if(e==null)return g;a={type:"arcade",evaluate(r,c){try{let m="attributes"in r?e.repurposeFeature(r):r;m.contextTimeZone=c??null;let y=e.evaluate({$view:{timeZone:c},$feature:m},e.services);if(y!=null)return y.toString()}catch(m){d().error(new f("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:m,feature:r,expression:o}))}return null},needsHydrationToEvaluate:()=>D(o.expression)==null}}}else a={type:"simple",evaluate:i=>o.expression.replaceAll(/{[^}]*}/g,s=>{let e=s.slice(1,-1),r=t.get(e);if(!r)return s;let c=null;return c="attributes"in i?i?.attributes?.[r.name]:i.field(r.name),c==null?"":V(c,r)})};if(l){let i;try{i=await x(l,t)}catch(e){return d().error(new f("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:l,error:e})),g}let s=a.evaluate;a.evaluate=(e,r)=>{let c="attributes"in e?void 0:I;try{if(i.testFeature(e,c))return s(e,r)}catch(m){d().error(new f("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:l,feature:e,error:m}))}return null}}return a}function V(n,t){if(n==null)return"";let u=t.domain;if(u){if(u.type==="codedValue"||u.type==="coded-value"){let o=n;for(let a of u.codedValues)if(a.code===o)return a.name}else if(u.type==="range"){let{max:o,min:a}=F(t),i=+n;if(a!=null&&o!=null&&a<=i&&i<=o)return u.name}}let l=n;return T(t)?l=w(l,v("short-date")):p(t)&&(l=h(+l)),l||""}export{q as a,V as b};
