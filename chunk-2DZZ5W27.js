import{a as $i}from"./chunk-UXLLQMI3.js";import{o as Oi}from"./chunk-724E6NM3.js";import{a as b,b as zt,c as De}from"./chunk-QW5LN4Z5.js";import{a as Vi}from"./chunk-EVFVSJN5.js";import{j as we}from"./chunk-JAENS3D3.js";import{q as pi}from"./chunk-I7FLOUNH.js";import{a as ht}from"./chunk-CUJN6GMF.js";import{a as Ri}from"./chunk-IKCK67OG.js";import{a as bi}from"./chunk-E3UR4EIC.js";import{b as qt}from"./chunk-O4MHA7YC.js";import{a as Vt}from"./chunk-M7AB4SQK.js";import{a as Li}from"./chunk-GQVERT3D.js";import{A as Ti,B as Ei,C as ki,a as at,b as Ce,c as nt,d as lt,e as dt,f as Pe,g as wi,h as ce,i as Nt,j as Pt,m as ct,n as Ii,q as Mi,r as Fi,s as Ai,t as Dt,u as pt,v as ut,w as mt,x as Ci,y as xi,z as ie}from"./chunk-2JKSIF4Q.js";import{a as Ne}from"./chunk-G7BT6VC5.js";import{a as te}from"./chunk-3REMXE4W.js";import{a as hi,c as fi,e as rt,f as yi,g as gi,h as vi,j as ot,l as _i}from"./chunk-4ABKPPKG.js";import{a as it}from"./chunk-PMVQ5DJK.js";import{b as st}from"./chunk-TBA3OZMJ.js";import{b as mi}from"./chunk-S4QV2MGO.js";import{a as ui}from"./chunk-JTDXB5TK.js";import{A as Si}from"./chunk-HP4LYRR4.js";import{b as $t}from"./chunk-QT6UNBJP.js";import{a as Ot}from"./chunk-MDSLION2.js";import{c as G,d as $,e as P}from"./chunk-I2UM4WSJ.js";import{e as c}from"./chunk-DCHNVAWJ.js";import{e as Rt,f as J,g as Je,h as et,j as St}from"./chunk-6Z6LKUG5.js";import{a as _e}from"./chunk-V2GNNIXD.js";import{b as Lt}from"./chunk-NSYL2RQJ.js";import{a as A,b as Ge,c as be,d as li,i as E}from"./chunk-MWSXMSWY.js";import{f as Ae}from"./chunk-JRCKELO6.js";import{b as kt}from"./chunk-KJULKTB5.js";import{a as ai}from"./chunk-LACL4BQ2.js";import{c as fe}from"./chunk-YR2HD3ZC.js";import{n as tt}from"./chunk-Z5Q7KLA4.js";import{a as ci}from"./chunk-4XZ6X7MQ.js";import{a as X}from"./chunk-DB3UIQCU.js";import{b as ni}from"./chunk-R4A63S45.js";import{E as di}from"./chunk-ETE32IYO.js";import{H as a,J as Q}from"./chunk-QHVIRF5H.js";import{I as M,i as oi}from"./chunk-WZDN6K3C.js";import{a as o}from"./chunk-QGVBCWUY.js";import{C as si,D as Et,E as Ye,G as he,J as ri,O as Xe,b as Ke,e as Y,v as ve}from"./chunk-CKJ56T2Q.js";import{l as Qe,o as Fe,p as Tt,r as de,t as L}from"./chunk-UHRSAPGQ.js";import{g as Ve,w as le}from"./chunk-V76GWARL.js";import{a as g,b as $e,c as ii}from"./chunk-N2WTMF3X.js";var Ni={editing:!1,operations:{add:!0,update:!0,delete:!0}},Pi=fe.ofType(Li),j=class extends Q{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=g({},Ni),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Pi,this.fileInfos=new fe,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles(A(()=>this.graphic,()=>this._graphicChanged(),E))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return g(g({},Ni),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){let{_attachmentLayer:e,attachmentInfos:t,orderByFields:i}=this;if(!e||typeof e.queryAttachments!="function")throw new L("invalid-layer","getAttachments(): A valid layer is required.");let s=this._getObjectId();if(typeof s!="number")throw new L("invalid-object-id","getAttachments(): Numeric object id is required");let r=i?.map(u=>`${u.field} ${u.order==="descending"?"DESC":"ASC"}`),n=new Vt({objectIds:[s],returnMetadata:!0,orderByFields:r}),d=[],l=e.queryAttachments(n).then(u=>u[s]||d).catch(()=>d);this._getAttachmentsPromise=l,this.notifyChange("state");let p=await l;return t.destroyAll(),p.length&&t.addMany(p),this._getAttachmentsPromise=null,this.notifyChange("state"),p}async addAttachment(e,t=this.graphic){let{_attachmentLayer:i,attachmentInfos:s,capabilities:r}=this;if(!t)throw new L("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new L("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!r.operations?.add)throw new L("invalid-capabilities","addAttachment(): add capabilities are required.");if(!i||typeof i.addAttachment!="function")throw new L("invalid-layer","addAttachment(): A valid layer is required.");let n=i.addAttachment(t,e).then(l=>this._queryAttachment(l.objectId,t)),d=await n;return s.add(d),d}async deleteAttachment(e){let{_attachmentLayer:t,attachmentInfos:i,graphic:s,capabilities:r}=this;if(!e)throw new L("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!r.operations?.delete)throw new L("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new L("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new L("invalid-graphic","deleteAttachment(): A graphic is required.");let n=t.deleteAttachments(s,[e.id]).then(()=>e),d=await n;return i.remove(d),d.destroy(),d}async updateAttachment(e,t=this.activeAttachmentInfo){let{_attachmentLayer:i,attachmentInfos:s,graphic:r,capabilities:n}=this;if(!e)throw new L("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new L("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations?.update)throw new L("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=s.indexOf(t);if(!i||typeof i.updateAttachment!="function")throw new L("invalid-layer","updateAttachment(): A valid layer is required.");if(!r)throw new L("invalid-graphic","updateAttachment(): A graphic is required.");let l=i.updateAttachment(r,t.id,e).then(u=>this._queryAttachment(u.objectId)),p=await l;return s.splice(d,1,p),p}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let s=this.fileInfos.indexOf(i);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:t}),this.fileInfos.items[s]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new L("invalid-attachment-id","Could not query attachment.");let s=this._getObjectId(t);if(typeof s!="number")throw new L("invalid-object-id","getAttachments(): Numeric object id is required");let r=new Vt({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(r).then(n=>n[s][0])}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){let{graphic:e}=this,t=at(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};o([a()],j.prototype,"capabilities",void 0),o([X("capabilities")],j.prototype,"castCapabilities",null),o([a()],j.prototype,"activeAttachmentInfo",void 0),o([a()],j.prototype,"activeFileInfo",void 0),o([a({readOnly:!0,type:Pi})],j.prototype,"attachmentInfos",void 0),o([a()],j.prototype,"fileInfos",void 0),o([a({type:te})],j.prototype,"graphic",void 0),o([a()],j.prototype,"mode",void 0),o([a({type:[hi]})],j.prototype,"orderByFields",void 0),o([a({readOnly:!0})],j.prototype,"state",null),o([a()],j.prototype,"filesEnabled",void 0),o([a({readOnly:!0})],j.prototype,"supportsResizeAttachments",null),j=o([M("esri.widgets.Attachments.AttachmentsViewModel")],j);var qe=j;function Bt(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Di(e){let t=ni("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var xe={close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",locateCircled:"esri-icon-locate-circled",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"};var qi={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},C="esri-attachments",v={base:C,loaderContainer:`${C}__loader-container`,loader:`${C}__loader`,fadeIn:`${C}--fade-in`,container:`${C}__container`,containerList:`${C}__container--list`,containerPreview:`${C}__container--preview`,actions:`${C}__actions`,deleteButton:`${C}__delete-button`,addAttachmentButton:`${C}__add-attachment-button`,errorMessage:`${C}__error-message`,items:`${C}__items`,item:`${C}__item`,itemButton:`${C}__item-button`,itemMask:`${C}__item-mask`,itemMaskIcon:`${C}__item-mask--icon`,itemImage:`${C}__image`,itemImageResizable:`${C}__image--resizable`,itemLabel:`${C}__label`,itemFilename:`${C}__filename`,itemChevronIcon:`${C}__item-chevron-icon`,itemLink:`${C}__item-link`,itemLinkOverlay:`${C}__item-link-overlay`,itemLinkOverlayIcon:`${C}__item-link-overlay-icon`,itemEditIcon:`${C}__item-edit-icon`,itemAddIcon:`${C}__item-add-icon`,itemAddButton:`${C}__item-add-button`,formNode:`${C}__form-node`,fileFieldset:`${C}__file-fieldset`,fileLabel:`${C}__file-label`,fileName:`${C}__file-name`,fileInput:`${C}__file-input`,metadata:`${C}__metadata`,metadataFieldset:`${C}__metadata-fieldset`,progressBar:`${C}__progress-bar`},jt=window.CSS,q=class extends ${constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=g({},qi),this._supportsImageOrientation=jt&&jt.supports&&jt.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=g({viewModel:new qe},e)),e}initialize(){this.addHandles([be(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),be(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),A(()=>this.viewModel?.mode,()=>this._modeChanged(),E)])}loadDependencies(){return G({icon:()=>import("./chunk-A7SCRTXK.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return g(g({},qi),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return c("div",{class:this.classes(v.base,b.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?c("div",{class:v.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return c("div",{class:v.loaderContainer,key:"loader"},c("div",{class:v.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?c("div",{class:v.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,s=this.visibleElements.cancelAddButton?c("button",{bind:this,class:this.classes(b.button,b.buttonTertiary,b.buttonSmall,b.buttonHalf,e&&b.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,r=this.visibleElements.addSubmitButton?c("button",{class:this.classes(b.button,b.buttonSecondary,b.buttonSmall,b.buttonHalf,{[b.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,n=t?c("span",{class:v.fileName,key:"file-name"},t.name):null,d=c("form",{afterCreate:et,afterRemoved:Je,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c("fieldset",{class:v.fileFieldset},n,c("label",{class:this.classes(v.fileLabel,b.button,b.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,c("input",{bind:this,class:v.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),r,s);return c("div",{class:v.formNode,key:"add-form-container"},d)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:s,submitting:r}=this,{capabilities:n}=i,d=r||!s,l,p,u,m;s?(l=s.type,p=s.name,u=s.size):e&&"file"in e?(l=e.file.type,p=e.file.name,u=e.file.size):e&&"contentType"in e&&(l=e.contentType,p=e.name,u=e.size,m=e.url);let h=n.editing&&n.operations?.delete&&t.deleteButton?c("button",{bind:this,class:this.classes(b.button,b.buttonSmall,b.buttonTertiary,v.deleteButton,{[b.buttonDisabled]:r}),disabled:r,key:"delete-button",onclick:R=>this._submitDeleteAttachment(R,e),type:"button"},this.messages.delete):void 0,f=n.editing&&n.operations?.update&&t.updateButton?c("button",{class:this.classes(b.button,b.buttonSmall,b.buttonThird,{[b.buttonDisabled]:d}),disabled:d,key:"update-button",type:"submit"},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?c("button",{bind:this,class:this.classes(b.button,b.buttonSmall,b.buttonTertiary,b.buttonThird,{[b.buttonDisabled]:r}),disabled:r,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,_=n.editing&&n.operations?.update?c("fieldset",{class:v.fileFieldset,key:"file"},c("span",{class:v.fileName,key:"file-name"},p),c("label",{class:this.classes(v.fileLabel,b.button,b.buttonSecondary)},this.messages.changeFile,c("input",{bind:this,class:v.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,I=c("fieldset",{class:v.metadataFieldset,key:"size"},c("label",null,Oi(this.messagesUnits,u??0))),x=c("fieldset",{class:v.metadataFieldset,key:"content-type"},c("label",null,l)),F=m!=null?c("a",{class:v.itemLink,href:m,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),c("div",{class:v.itemLinkOverlay},c("span",{class:v.itemLinkOverlayIcon},c("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),T=c("form",{afterCreate:et,afterRemoved:Je,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:R=>this._submitUpdateAttachment(R,e)},c("div",{class:v.metadata},I,x),_,c("div",{class:v.actions},h,y,f));return c("div",{class:v.formNode,key:"edit-form-container"},F,T)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,s=Di(t),r={[v.itemImageResizable]:i};return c("div",{class:this.classes(v.itemMaskIcon,v.itemMask),key:s},c("img",{alt:e,class:this.classes(r,v.itemImage),src:s,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:s,name:r,url:n}=e;if(!i||!Bt(s))return this._renderGenericImageMask(r,s);let d=this._getCSSTransform(e),l=d?{transform:d,"image-orientation":"none"}:{},p=`${n}${n?.includes("?")?"&":"?"}w=${t}`,u={[v.itemImageResizable]:i};return c("div",{class:this.classes(v.itemMask),key:p},c("img",{alt:r,class:this.classes(u,v.itemImage),src:p,styles:l,title:r}))}_renderFile(e){let{file:t}=e;return c("li",{class:v.item,key:t},c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:v.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),c("label",{class:v.itemLabel},c("span",{class:v.itemFilename},t.name||this.messages.noTitle),c("span",{"aria-hidden":"true",class:this.classes(v.itemChevronIcon,J(this.container)?xe.left:xe.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:s}=this,{capabilities:r,supportsResizeAttachments:n}=i,{contentType:d,name:l,url:p}=e,u=this._renderImageMask(e,t==="list"?48:400),m=r.editing?c("span",{"aria-hidden":"true",class:this.classes(v.itemChevronIcon,J(this.container)?xe.left:xe.right)}):null,h=[u,s==="preview"&&n&&Bt(d)?null:c("label",{class:v.itemLabel},c("span",{class:v.itemFilename},l||this.messages.noTitle),m)],f=r.editing?c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:v.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},h):c("a",{class:v.itemButton,href:p??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},h);return c("li",{class:v.item,key:e},f)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:s,capabilities:r,fileInfos:n}=t,d=!!s?.length,l=!!n?.length,p={[v.containerList]:e!=="preview",[v.containerPreview]:e==="preview"},u=r.editing&&r.operations?.add&&i.addButton?c("button",{bind:this,class:this.classes(b.button,b.buttonTertiary,v.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},c("span",{"aria-hidden":"true",class:this.classes(v.itemAddIcon,xe.plus)}),this.messages.add):void 0,m=d?c("ul",{class:v.items,key:"attachments-list"},s.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,h=l?c("ul",{class:v.items,key:"file-list"},n.toArray().map(y=>this._renderFile(y))):void 0,f=l||d?void 0:c("div",{class:b.empty},this.messages.noAttachments);return c("div",{class:this.classes(v.container,p),key:"attachments-container"},m,h,f,u)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};o([a()],q.prototype,"capabilities",null),o([a()],q.prototype,"displayType",void 0),o([a({readOnly:!0})],q.prototype,"effectiveDisplayType",null),o([a()],q.prototype,"graphic",null),o([a()],q.prototype,"icon",null),o([a()],q.prototype,"label",null),o([a(),P("esri/widgets/Attachments/t9n/Attachments")],q.prototype,"messages",void 0),o([a(),P("esri/core/t9n/Units")],q.prototype,"messagesUnits",void 0),o([a({readOnly:!0})],q.prototype,"selectedFile",void 0),o([a({readOnly:!0})],q.prototype,"submitting",void 0),o([a({readOnly:!0})],q.prototype,"error",void 0),o([a({type:qe})],q.prototype,"viewModel",void 0),o([a()],q.prototype,"visibleElements",void 0),o([X("visibleElements")],q.prototype,"castVisibleElements",null),q=o([M("esri.widgets.Attachments")],q);var zi=q;var ze=class extends qe{constructor(e){super(e),this.description=null,this.title=null}};o([a()],ze.prototype,"description",void 0),o([a()],ze.prototype,"title",void 0),ze=o([M("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ze);var Be=ze;function ft(r,s){var n=r,{level:e,class:t}=n,i=ii(n,["level","class"]);let d=bs(e);return c(`h${d}`,$e(g({},i),{"aria-level":String(d),class:Rt(b.heading,t),role:"heading"}),s)}function bs(e){return $t(Math.ceil(e),1,6)}var Ut="esri-feature-element-info",Ht={base:Ut,title:`${Ut}__title`,description:`${Ut}__description`},Te=class extends ${constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return c("div",{class:Ht.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?c(ft,{class:Ht.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?c("div",{class:Ht.description,innerHTML:e,key:"description"}):null}};o([a()],Te.prototype,"description",void 0),o([a()],Te.prototype,"headingLevel",void 0),o([a()],Te.prototype,"title",void 0),Te=o([M("esri.widgets.Feature.support.FeatureElementInfo")],Te);var se=Te;var ws={base:"esri-feature-attachments"},re=class extends ${constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new zi,this.headingLevel=2,this.viewModel=new Be}initialize(){this._featureElementInfo=new se,this.addHandles([A(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E),A(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,E)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return c("div",{class:ws.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};o([a({readOnly:!0})],re.prototype,"attachmentsWidget",void 0),o([a()],re.prototype,"description",null),o([a()],re.prototype,"displayType",null),o([a()],re.prototype,"graphic",null),o([a()],re.prototype,"headingLevel",void 0),o([a()],re.prototype,"title",null),o([a({type:Be})],re.prototype,"viewModel",void 0),re=o([M("esri.widgets.Feature.FeatureAttachments")],re);var Bi=re;var ye=class extends Q{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(A(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},E))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(Ce({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}async _createContent(e){let t=this.graphic;if(!t||!e)return;let i=Ce({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let s=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};o([a({readOnly:!0})],ye.prototype,"created",void 0),o([a()],ye.prototype,"creator",void 0),o([a()],ye.prototype,"destroyer",void 0),o([a({type:te})],ye.prototype,"graphic",void 0),o([a({readOnly:!0})],ye.prototype,"state",null),ye=o([M("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ye);var Ie=ye;function Is(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:Fs(e[t])}}}function Ms(e){let t=e?.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function Fs(e){return function(t,...i){Ms(t)?St(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function As(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);let i=t._delegatedEventNames,s=Array.isArray(e)?e:Cs(e);i.push(...s)}}function Cs(e){return e.split(",").map(t=>t.trim())}function yt(e){return e&&typeof e.render=="function"}function ji(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}var Wt="esri-feature-content",Zt={base:Wt,loaderContainer:`${Wt}__loader-container`,loader:`${Wt}__loader`},Ee=class extends ${constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(s=>{nt(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return c("div",{class:Zt.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return c("div",{class:Zt.loaderContainer,key:"loader"},c("div",{class:Zt.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:e,key:e}):yt(e)?c("div",{key:e},!e.destroyed&&e.render()):c("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};o([a()],Ee.prototype,"creator",null),o([a()],Ee.prototype,"graphic",null),o([a({type:Ie})],Ee.prototype,"viewModel",void 0),Ee=o([M("esri.widgets.Feature.FeatureContent")],Ee);var ke=Ee;var pe=class extends Q{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;let r=s.clone();r.label=dt(r,e),i.push(r)}),i}};o([a()],pe.prototype,"attributes",void 0),o([a({type:[_i]})],pe.prototype,"expressionInfos",void 0),o([a()],pe.prototype,"description",void 0),o([a({type:[rt]})],pe.prototype,"fieldInfos",void 0),o([a({readOnly:!0})],pe.prototype,"formattedFieldInfos",null),o([a()],pe.prototype,"title",void 0),pe=o([M("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],pe);var Me=pe;var xs=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Ui(e,t){if(typeof t!="string"||!t)return t;let i=xs.find(p=>p.pattern.test(t));if(!i)return t;let s=t.match(i.pattern),r=s?.[2],n=Qe(Qe(i.label,{messages:e,hierPart:r}),{appName:i.appName}),d=i.target?` target="${i.target}"`:"",l=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${d} href="$1"${l}>${n}</a>`)}var gt="esri-feature-fields",vt={base:gt,fieldHeader:`${gt}__field-header`,fieldData:`${gt}__field-data`,fieldDataDate:`${gt}__field-data--date`},ee=class extends ${constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new Me,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new se,this.addHandles(A(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),E))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{class:vt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,s=e.fieldName||"",r=e.label||s,n=i?i[s]==null?"":i[s]:"",d=!!e.format?.dateFormat,l=typeof n=="number"&&!d?this._forceLTR(n):Ui(this.messagesURIUtils,n),p={[vt.fieldDataDate]:d};return c("tr",{key:`fields-element-info-row-${s}-${t}`},c("th",{class:vt.fieldHeader,innerHTML:r,key:`fields-element-info-row-header-${s}-${t}`}),c("td",{class:this.classes(vt.fieldData,p),innerHTML:l,key:`fields-element-info-row-data-${s}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?c("table",{class:b.table,summary:this.messages.fieldsSummary},c("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};o([a()],ee.prototype,"attributes",null),o([a()],ee.prototype,"description",null),o([a()],ee.prototype,"expressionInfos",null),o([a()],ee.prototype,"fieldInfos",null),o([a()],ee.prototype,"title",null),o([a({type:Me,nonNullable:!0})],ee.prototype,"viewModel",void 0),o([a(),P("esri/widgets/Feature/t9n/Feature")],ee.prototype,"messages",void 0),o([a(),P("esri/widgets/support/t9n/uriUtils")],ee.prototype,"messagesURIUtils",void 0),ee=o([M("esri.widgets.Feature.FeatureFields")],ee);var _t=ee;function Hi(e){if(!e.colorStops)return[];let t=[...e.colorStops].filter(s=>s.color?.a>0),i=t.length-1;if(t[0]){let s=t[i];s&&s.ratio!==1&&(t.push(new bi({ratio:1,color:s.color})),i++)}return t.map((s,r)=>{let n="";return r===0?n=e.legendOptions?.minLabel||"low":r===i&&(n=e.legendOptions?.maxLabel||"high"),{color:s.color,label:n,ratio:s.ratio}}).reverse()}var Mn=kt("short-date");async function K(e,t,i){oi(e,t,()=>[]).push(...i)}async function Wi(e){let t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){for(let i of e.visualVariables)if(Ls(i)){let s=(await Vi(i)??[]).map(r=>r.color);await K(t,i.field||i.valueExpression,s)}}if(e.type==="heatmap"){let i=Hi(e).map(s=>s.color);await K(t,e.field||e.valueExpression,i)}else if(e.type==="pie-chart"){for(let i of e.attributes)await K(t,i.field||i.valueExpression,[i.color]);await K(t,"default",[e?.othersCategory?.color,we(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(let i of e.attributes)await K(t,i.field||i.valueExpression,[i.color]);await K(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(e.authoringInfo?.type==="predominance")for(let i of e.uniqueValueInfos??[])await K(t,i.value.toString(),[we(i.symbol,null)]);else{let i=(e.uniqueValueInfos??[]).map(l=>we(l.symbol,null)),{field:s,field2:r,field3:n,valueExpression:d}=e;(s||d)&&await K(t,s||d,i),r&&await K(t,r,i),n&&await K(t,n,i)}else if(e.type==="class-breaks"){let i=e.classBreakInfos.map(n=>we(n.symbol,null)),{field:s,valueExpression:r}=e;await K(t,s??r,i)}else e.type==="simple"&&await K(t,"default",[we(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await K(t,"default",[we(e.defaultSymbol,null)]),t.forEach((i,s)=>{let r=Ve(i.filter(Boolean),(n,d)=>JSON.stringify(n)===JSON.stringify(d));t.set(s,r)}),t}function Ls(e){return e.type==="color"}var Rs="esri.widgets.Feature.support.relatedFeatureUtils",Zi=()=>de.getLogger(Rs),Qi=new Map;function Le(e){if(!ie(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function Ss(e,t){if(!t.relationships)return null;let i=null,{relationships:s}=t;return s.some(r=>r.id===parseInt(e,10)&&(i=r,!0)),i}function Os({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:s,id:r})=>`${s}`===i&&r===e?.id)??null}function $s(e,t){let i=t.toLowerCase();for(let s in e)if(s.toLowerCase()===i)return e[s];return null}function Ki(e,t){let i=Ss(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function Yi(e,t){if(!t||!e)return;let{features:i,statsFeatures:s}=e,r=i?.value;t.relatedFeatures=r?r.features:[];let n=s?.value;t.relatedStatsFeatures=n?n.features:[]}function Vs(e,t,i,s){let r=new Ne;return r.outFields=["*"],r.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),r.objectIds=[e.attributes[i.objectIdField]],r.gdbVersion=i.gdbVersion??null,r.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(r,s)??Promise.resolve({})}function Ns(e,t,i){let s=0,r=[];for(;s<t.length;)r.push(`${e} IN (${t.slice(s,i+s)})`),s+=i;return r.join(" OR ")}function Ps(e){return e?Ve(e):void 0}function Ds(e){return e?Ve(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}async function qs(e,t,i,s){let r=i.layerId.toString(),{layerInfo:n,relation:d,relatedFields:l,outStatistics:p,url:u,sourceSpatialReference:m}=t,h=Ps(l),f=Ds(p);if(!n||!d)return null;let y=Os({originRelationship:d,relationships:n.relationships,layerId:r});if(y?.relationshipTableId&&y.keyFieldInRelationshipTable){let I=(await Vs(e,y,i,s))[e.attributes[i.objectIdField]];if(!I)return null;let x=I.features.map(F=>F.attributes[n.objectIdField]);if(f?.length&&n.supportsStatistics){let F=new st;F.where=Ns(n.objectIdField,x,1e3),F.outFields=h,F.outStatistics=f,F.sourceSpatialReference=m;let T={features:Promise.resolve(I),statsFeatures:ht(u,F)};return he(T)}}let _=y?.keyField;if(_){let I=Si(Bs(n.fields,_)),x=$s(e.attributes,d.keyField),F=I?`${_}=${x}`:`${_}='${x}'`,T=i.historicMoment,R=i.gdbVersion,ae=ht(u,new st({where:F,outFields:h,sourceSpatialReference:m,historicMoment:T,gdbVersion:R}),s),ne=f?.length&&n.supportsStatistics?ht(u,new st({where:F,outFields:h,outStatistics:f,sourceSpatialReference:m}),s):null,me={features:ae};return ne&&(me.statsFeatures=ne),he(me)}return null}function zs(e,t){return di(e,{query:{f:"json"},signal:t?.signal})}function Xi({relatedInfos:e,layer:t},i){let s={};return e.forEach((r,n)=>{let{relation:d}=r;if(!d){let h=new L("relation-required","A relation is required on a layer to retrieve related records.");throw Zi().error(h),h}let{relatedTableId:l}=d;if(typeof l!="number"){let h=new L("A related table ID is required on a layer to retrieve related records.");throw Zi().error(h),h}let p=`${t.url}/${l}`,u=Qi.get(p),m=u??zs(p);u||Qi.set(p,m),s[n]=m}),si(he(s),i)}function Gi({graphic:e,relatedInfos:t,layer:i},s){let r={};return t.forEach((n,d)=>{n.layerInfo&&(r[d]=qs(e,n,i,s))}),he(r)}function Ji({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let s=new mi({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(s)}}function Bs(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var es={chartAnimation:!0},V=class extends Q{constructor(e){super(e),this.abilities=g({},es),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return g(g({},es),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},s=this.formattedAttributes??{},r=this.expressionAttributes??{},n=this.fieldInfoMap??new Map;return e?.map(d=>{let l=d?.clone();return l?(l.title=ce({attributes:i,fieldInfoMap:n,globalAttributes:s,expressionAttributes:r,layer:t,text:l.title}),l.caption=ce({attributes:i,fieldInfoMap:n,globalAttributes:s,expressionAttributes:r,layer:t,text:l.caption}),l.altText=ce({attributes:i,fieldInfoMap:n,globalAttributes:s,expressionAttributes:r,layer:t,text:l.altText}),l.type==="image"?l.value?(this._setImageValue({value:l.value,formattedAttributes:s,layer:t}),l.value.sourceURL?l:void 0):void 0:l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"?l.value?(this._setChartValue({value:l.value,chartType:l.type,attributes:i,formattedAttributes:s,layer:t,expressionAttributes:r}),l):void 0:null):null}).filter(le)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:s,layer:r}=e,{linkURL:n,sourceURL:d}=i;if(d){let l=Pt(d,r);i.sourceURL=Nt({formattedAttributes:s,template:l,fieldInfoMap:t})}if(n){let l=Pt(n,r);i.linkURL=Nt({formattedAttributes:s,template:l,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:s,chartType:r,layer:n,expressionAttributes:d}=e,{popupTemplate:l,relatedInfos:p}=this,{fields:u,normalizeField:m}=t,h=n;if(t.fields=wi(u,h),m&&(t.normalizeField=Pe(m,h)),!u.some(y=>!!(s[y]!=null||ie(y)&&p?.size)))return;let f=l?.fieldInfos??[];u.forEach((y,_)=>{let I=t.colors?.[_];if(ie(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:s,chartType:r,value:t,color:I})]);let x=this._getChartOption({value:t,attributes:i,chartType:r,formattedAttributes:s,expressionAttributes:d,fieldName:y,fieldInfos:f,color:I});t.series.push(x)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:s,chartType:r,value:n,color:d}=e,l=[],p=Le(i),u=p&&this.relatedInfos?.get(p.layerId.toString());if(!u)return l;let{relatedFeatures:m,relation:h}=u;if(!h||!m)return l;let{cardinality:f}=h;return m.forEach(y=>{let{attributes:_}=y;_&&Object.keys(_).forEach(I=>{I===p.fieldName&&l.push(this._getChartOption({value:n,attributes:_,formattedAttributes:s,fieldName:i,chartType:r,relatedFieldName:I,hasMultipleRelatedFeatures:m?.length>1,fieldInfos:t,color:d}))})}),f==="one-to-many"||f==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:s,expressionAttributes:r,fieldName:n,relatedFieldName:d,fieldInfos:l,chartType:p,hasMultipleRelatedFeatures:u,color:m}=e,h=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:_}=t,I=y?ie(y)?i[Le(y).fieldName]:i[y]:null,x=lt(n)&&r&&r[n]!==void 0?r[n]:d&&i[d]!==void 0?i[d]:i[n]!==void 0?i[n]:s[n],F=new gi({fieldName:n,color:m,value:x===void 0?null:x&&I?x/I:x});if(ie(n)){let me=f.get(n.toLowerCase()),Ct=_&&f.get(_.toLowerCase()),Oe=me?.fieldName??n,B=u&&_?Le(_).fieldName:Ct?.fieldName??_,xt=u&&B?i[B]:s[B]??me?.label??me?.fieldName??d,Ze=u&&d?i[d]:s[Oe];return F.tooltip=this._getTooltip({label:xt,value:Ze,chartType:p}),F}let T=Mi(l,n),R=Pe(n,h),ae=_&&s[_]!==void 0?s[_]:dt(T||new rt({fieldName:R}),this.popupTemplate?.expressionInfos),ne=s[R];return F.tooltip=this._getTooltip({label:ae,value:ne,chartType:p}),F}};o([a()],V.prototype,"abilities",void 0),o([X("abilities")],V.prototype,"castAbilities",null),o([a()],V.prototype,"activeMediaInfoIndex",void 0),o([a({readOnly:!0})],V.prototype,"activeMediaInfo",null),o([a()],V.prototype,"attributes",void 0),o([a()],V.prototype,"description",void 0),o([a()],V.prototype,"fieldInfoMap",void 0),o([a()],V.prototype,"formattedAttributes",void 0),o([a()],V.prototype,"expressionAttributes",void 0),o([a({readOnly:!0})],V.prototype,"formattedMediaInfos",null),o([a()],V.prototype,"isAggregate",void 0),o([a()],V.prototype,"layer",void 0),o([a({readOnly:!0})],V.prototype,"formattedMediaInfoCount",null),o([a()],V.prototype,"mediaInfos",void 0),o([a()],V.prototype,"popupTemplate",void 0),o([a()],V.prototype,"relatedInfos",void 0),o([a()],V.prototype,"title",void 0),V=o([M("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],V);var oe=V;var N="esri-feature-media",U={base:N,mediaContainer:`${N}__container`,mediaItemContainer:`${N}__item-container`,mediaItem:`${N}__item`,mediaItemText:`${N}__item-text`,mediaItemTitle:`${N}__item-title`,mediaItemCaption:`${N}__item-caption`,mediaNavigation:`${N}__item-navigation`,mediaPagination:`${N}__pagination`,mediaPaginationText:`${N}__pagination-text`,mediaPrevious:`${N}__previous`,mediaPreviousIconLTR:`${N}__previous-icon`,mediaPreviousIconRTL:`${N}__previous-icon--rtl`,mediaNext:`${N}__next`,mediaNextIconLTR:`${N}__next-icon`,mediaNextIconRTL:`${N}__next-icon--rtl`,mediaChart:`${N}__chart`,mediaPaginationButton:`${N}__pagination-button`,mediaPaginationIcon:`${N}__pagination-icon`,mediaChartRendered:`${N}__chart--rendered`},Qt=15,ge="category",je="value",js="rgba(50, 50, 50, 1)",Us=250,Hs=500,Ws=200,H=class extends ${constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new oe,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=async i=>{let{destroyed:s,viewModel:r}=this;if(s||!r||!i)return;let{createRoot:n}=await import("./chunk-YAWB47X5.js"),d=await n(i);this._chartRootMap.set(i,d),this._renderChart({mediaInfo:r.activeMediaInfo,root:d})}}initialize(){this._featureElementInfo=new se,this.addHandles([A(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),E),A(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),E)])}loadDependencies(){return G({icon:()=>import("./chunk-A7SCRTXK.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{bind:this,class:U.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?c("div",{class:U.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),c("div",{class:U.mediaNavigation},i,e>1?c("div",{class:U.mediaPagination},this._renderMediaPageButton("previous"),c("span",{class:U.mediaPaginationText},_e(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?c("div",{class:U.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?c("div",{class:U.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?c("div",{class:U.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:r,refreshInterval:n,altText:d,title:l,type:p}=e,{sourceURL:u,linkURL:m}=r,h=nt(m??void 0)?"_blank":"_self",f=h==="_blank"?"noreferrer":"",y=n?t:null,_=y?y.timestamp:0,I=y?y.sourceURL:u,x=c("img",{alt:d||l,key:`media-${p}-${i}-${s}-${_}`,src:I??void 0});return(m?c("a",{href:m,rel:f,target:h,title:l},x):null)??x}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return c("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:U.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?c("div",{class:U.mediaItemContainer,key:"media-container"},c("div",{class:U.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,s=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",n=t?this._previous:this._next;return c("button",{"aria-label":i,bind:this,class:U.mediaPaginationButton,key:r,onclick:n,tabIndex:0,title:i,type:"button"},c("calcite-icon",{class:U.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}async _getSeriesColors(e){let{colorAm5:t}=await import("./chunk-2RL6W4ZK.js"),i=new Map;return e.forEach(s=>{s.color&&i.set(s,t(s.color.toCss(!0)))}),i}async _getRendererColors(){let{colorAm5:e}=await import("./chunk-2RL6W4ZK.js"),t=new Map,i=this._getRenderer(),s="default";if(!i)return t;let r=await Wi(i);return r.delete(s),Array.from(r.values()).every(n=>n?.length===1)&&Array.from(r.keys()).forEach(n=>{let d=r.get(n)?.[0]?.toCss(!0);d&&t.set(n,e(d))}),t}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!$i()}_getChartAnimationMS(){return this._canAnimateChart()?Us:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Hs:0}async _renderChart(e){let{root:t,mediaInfo:i}=e,{value:s,type:r}=i,{ResponsiveThemeAm5:n,DarkThemeAm5:d,AnimatedThemeAm5:l,ColorSetAm5:p,ThemeAm5:u,esriChartColorSet:m}=await import("./chunk-2RL6W4ZK.js"),h=u.new(t);h.rule("ColorSet").set("colors",m),h.rule("ColorSet").set("reuse",!0);let f=[n.new(t),h];Ot()&&f.push(d.new(t)),this._canAnimateChart()&&f.push(l.new(t)),t.setThemes(f);let y=await this._getRendererColors(),_=await this._getSeriesColors(s.series),I=p.new(t,{}),x=_.get(s.series[0]),F=x?{lineSettings:{stroke:x}}:void 0,T=s.series.map((R,ae)=>{let ne=_.get(R)||y.get(R.fieldName)||I.getIndex(ae);return g({[ge]:R.tooltip,[je]:R.value,columnSettings:{fill:ne,stroke:ne}},F)}).filter(R=>r!=="pie-chart"||R.value!=null&&R.value>0);r==="pie-chart"?this._createPieChart(e,T):this._createXYChart(e,T)}_getDirection(){return J(this.container)?"rtl":"ltr"}async _customizeChartTooltip(e,t="horizontal"){let{colorAm5:i}=await import("./chunk-2RL6W4ZK.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(js)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Ws})}async _createPieChart(e,t){let{TooltipAm5:i}=await import("./chunk-2RL6W4ZK.js"),{PieChartAm5:s,PieSeriesAm5:r}=await import("./chunk-JFVGNYAE.js"),{mediaInfo:n,root:d}=e,{title:l}=n,p=5,u=n?.altText||n?.title||"",m=d.container.children.push(s.new(d,{ariaLabel:u,focusable:!0,paddingBottom:p,paddingTop:p,paddingLeft:p,paddingRight:p})),h=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=i.new(d,{labelText:h}),y=m.series.push(r.new(d,{name:l,valueField:je,categoryField:ge,tooltip:f}));y.ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:p}),this._customizeChartTooltip(f),y.slices.template.setAll({ariaLabel:h,focusable:!0,templateField:"columnSettings"}),y.data.setAll(t),y.appear(this._getChartSeriesAnimationMS()),m.appear(this._getChartAnimationMS()),m.root.dom.classList.toggle(U.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}async _createColumnChart(e,t,i){let{TooltipAm5:s,ScrollbarAm5:r}=await import("./chunk-2RL6W4ZK.js"),{CategoryAxisAm5:n,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,ColumnSeriesAm5:u}=await import("./chunk-FPP46N4W.js"),{mediaInfo:m,root:h}=t,{value:f,title:y}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(n.new(h,{renderer:d.new(h,{inversed:J(this.container)}),categoryField:ge}));_.get("renderer").labels.template.setAll({forceHidden:!0});let I=e.yAxes.push(l.new(h,{renderer:p.new(h,{inside:!1}),min:this._getMinSeriesValue(f.series)}));I.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",F=s.new(h,{labelText:x}),T=e.series.push(u.new(h,{name:y,xAxis:_,yAxis:I,valueYField:je,categoryXField:ge,tooltip:F}));this._customizeChartTooltip(F),T.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>Qt&&e.set("scrollbarX",r.new(h,{orientation:"horizontal"})),_.data.setAll(i),T.data.setAll(i),T.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,i){let{TooltipAm5:s,ScrollbarAm5:r}=await import("./chunk-2RL6W4ZK.js"),{CategoryAxisAm5:n,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,ColumnSeriesAm5:u}=await import("./chunk-FPP46N4W.js"),{mediaInfo:m,root:h}=t,{value:f,title:y}=m;e.setAll({wheelX:"panY",wheelY:"zoomY"});let _=e.yAxes.push(n.new(h,{renderer:p.new(h,{inversed:!0}),categoryField:ge}));_.get("renderer").labels.template.setAll({forceHidden:!0});let I=e.xAxes.push(l.new(h,{renderer:d.new(h,{inside:!1,inversed:J(this.container)}),min:this._getMinSeriesValue(f.series)}));I.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryY}",F=s.new(h,{labelText:x}),T=e.series.push(u.new(h,{name:y,xAxis:I,yAxis:_,valueXField:je,categoryYField:ge,tooltip:F}));this._customizeChartTooltip(F,"vertical"),T.columns.template.setAll({ariaLabel:x,focusable:!0,templateField:"columnSettings"}),f.series.length>Qt&&e.set("scrollbarY",r.new(h,{orientation:"vertical"})),_.data.setAll(i),T.data.setAll(i),T.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,i){let{TooltipAm5:s,ScrollbarAm5:r}=await import("./chunk-2RL6W4ZK.js"),{CategoryAxisAm5:n,AxisRendererXAm5:d,ValueAxisAm5:l,AxisRendererYAm5:p,LineSeriesAm5:u}=await import("./chunk-FPP46N4W.js"),{root:m,mediaInfo:h}=t,{value:f,title:y}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(n.new(m,{renderer:d.new(m,{inversed:J(this.container)}),categoryField:ge}));_.get("renderer").labels.template.setAll({forceHidden:!0});let I=e.yAxes.push(l.new(m,{renderer:p.new(m,{inside:!1}),min:this._getMinSeriesValue(f.series)}));I.get("renderer").labels.template.setAll({direction:this._getDirection()});let x="{categoryX}",F=i[0]?.lineSettings?.stroke,T=s.new(m,{getFillFromSprite:!F,labelText:x});F&&T.get("background")?.setAll({fill:F});let R=e.series.push(u.new(m,{name:y,xAxis:_,yAxis:I,valueYField:je,categoryXField:ge,tooltip:T}));R.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(T,"vertical"),f.series.length>Qt&&e.set("scrollbarX",r.new(m,{orientation:"horizontal"})),_.data.setAll(i),R.data.setAll(i),R.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){let{XYChartAm5:i,XYCursorAm5:s}=await import("./chunk-FPP46N4W.js"),{root:r,mediaInfo:n}=e,{type:d}=n,l=n?.altText||n?.title||"",p=r.container.children.push(i.new(r,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));p.set("cursor",s.new(r,{})),d==="column-chart"&&await this._createColumnChart(p,e,t),d==="bar-chart"&&await this._createBarChart(p,e,t),d==="line-chart"&&await this._createLineChart(p,e,t),p.root.dom.classList.toggle(U.mediaChartRendered,!0)}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,s=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let r=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=r}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[s,r=""]=e.split("#");return`${s}${i}timestamp=${t}${r?"#":""}${r}`}};o([a()],H.prototype,"_refreshIntervalInfo",void 0),o([a()],H.prototype,"attributes",null),o([a()],H.prototype,"activeMediaInfoIndex",null),o([a()],H.prototype,"description",null),o([a()],H.prototype,"fieldInfoMap",null),o([a()],H.prototype,"layer",null),o([a()],H.prototype,"mediaInfos",null),o([a()],H.prototype,"popupTemplate",null),o([a()],H.prototype,"relatedInfos",null),o([a()],H.prototype,"title",null),o([a({type:oe})],H.prototype,"viewModel",void 0),o([a(),P("esri/widgets/Feature/t9n/Feature")],H.prototype,"messages",void 0),H=o([M("esri.widgets.Feature.FeatureMedia")],H);var bt=H;function Re(e,t,i,s){let r=null,n=1e3;typeof t=="number"?(n=t,s=i):(r=t??null,n=i);let d,l=0,p=()=>{l=0,e.apply(s,d)},u=(...m)=>{r&&r.apply(s,m),d=m,n?l||(l=setTimeout(p,n)):p()};return u.remove=()=>{l&&(clearTimeout(l),l=0)},u.forceUpdate=()=>{l&&(clearTimeout(l),p())},u.hasPendingUpdates=()=>!!l,u}var Zs="esri.widgets.Feature.support.arcadeFeatureUtils",Kt=()=>de.getLogger(Zs);function ts(e){return typeof e=="string"?ut(pt(e)):Array.isArray(e)?Qs(e):e?.declaredClass==="esri.arcade.Dictionary"?Ks(e):e}function Qs(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?ut(pt(t)):t}</li>`).join("")}</ul>`}function Ks(e){let t=e.keys().map(i=>{let s=e.field(i);return`<tr><th>${i}</th><td>${typeof s=="string"?ut(pt(s)):s}</td></tr>`}).join("");return`<table class="${b.table}">${t}</table>`}async function Yt(){let[e,t]=await Promise.all([import("./chunk-CFF4U475.js"),import("./chunk-73LWLSFK.js")]);return{executor:e,syntaxUtils:t}}function Ys(e){return"createQuery"in e&&"queryFeatures"in e}async function Xs({graphic:e,view:t,options:i}){let{isAggregate:s,layer:r}=e;if(!s||!r||t?.type!=="2d")return[];let n=await t.whenLayerView(r);if(!Ys(n))return[];let d=n.createQuery(),l=e.getObjectId();d.aggregateIds=l!=null?[l]:[];let{features:p}=await n.queryFeatures(d,i);return p}function Gs({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:s,objectIdField:r,geometryType:n,spatialReference:d,displayField:l}=e;return new Ri($e(g({fields:s,objectIdField:r,geometryType:n,spatialReference:d,displayField:l,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function Js(e){let t=e.declaredClass==="esri.views.3d.layers.VoxelGraphic";return e.isAggregate?"popup-feature-reduction":t?"popup-voxel":"popup"}function is(e){return{scale:e?.scale,timeProperties:{currentStart:e?.timeExtent?.start,currentEnd:e?.timeExtent?.end,startIncluded:!0,endIncluded:!0}}}function er(e){return{$voxel:e}}async function tr(e,t,i,s,r){let n=null;if(r.has("$aggregatedfeatures")){let d=await Xs({graphic:e,view:t,options:i}),l=e.sourceLayer||e.layer;n=Gs({layer:l,aggregatedFeatures:d,interceptor:s})}return{vars:{$feature:e,$aggregatedFeatures:n,$view:is(t)},[Symbol.dispose]:()=>n?.[Symbol.dispose]()}}function ir(e,t,i,s){let r=(e.sourceLayer||e.layer)??void 0;return{$feature:e,$layer:r!=null&&pi(r)?r:r?.type==="scene"&&r.associatedLayer!=null?r.associatedLayer:void 0,$map:t,$datastore:r?.url,$userInput:i,$graph:r?.type==="knowledge-graph-sublayer"?r?.parentCompositeLayer?.knowledgeGraph:void 0,$view:is(s)}}async function sr(e,{graphic:t,map:i,location:s,view:r,options:n,interceptor:d,arcadeExecutor:l}){switch(e){case"popup":return{vars:ir(t,i,s,r),[Symbol.dispose](){}};case"popup-feature-reduction":{let p=new Set(l.variablesUsed);return await tr(t,r,n,d,p)}case"popup-voxel":return{vars:er(t),[Symbol.dispose](){}};default:throw new Error(`Unexpected profile name ${e}`)}}async function Xt({expressionInfo:e,arcade:{executor:t,syntaxUtils:i},graphic:s}){let r=e?.expression;if(!r)return null;let n=Js(s),d=t.createArcadeProfile(n),l;try{l=await t.createArcadeExecutor(r,d)}catch(u){return Kt().error("arcade-executor-error",{error:u,expressionInfo:e}),null}let p=new Set;return l.variablesUsed.includes("$view")&&(i.scriptUsesViewProperties(l.syntaxTree,["scale"])&&p.add("view-scale"),i.scriptUsesViewProperties(l.syntaxTree,["timeProperties"])&&p.add("view-time-extent")),{dependencies:p,async evaluate({graphic:u,interceptor:m,location:h,map:f,options:y,spatialReference:_,view:I}){let x=await sr(n,{graphic:u,map:f,location:h,view:I,options:y,interceptor:m,arcadeExecutor:l}),F={abortSignal:y?.signal??void 0,interceptor:m??void 0,rawOutput:!0,spatialReference:_??void 0,timeZone:I?.timeZone,console(...T){Kt().info(...T)}};try{return await l.executeAsync(x.vars,F)}catch(T){return void Kt().error("arcade-execution-error",{error:T,graphic:u,expressionInfo:e})}finally{x[Symbol.dispose]()}}}}async function ss(e,t){if(!e?.length)return{dependencies:new Set,expressions:new Map};let i=await Yt(),s=new Set,r=new Map;for(let n of e){let d=await Xt({expressionInfo:n,arcade:i,graphic:t});r.set(`expression/${n.name}`,d),d?.dependencies.forEach(l=>s.add(l))}return{dependencies:s,expressions:r}}var rs=1,W=class extends Q{constructor(e){super(e),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new Me:t==="media"?new oe:t==="text"?new Ie:null;this._set("contentElementViewModel",i)},this._compileThrottled=Re(this._startCompile,()=>this.notifyChange("state"),rs,this),this._evaluateThrottled=Re(this._startEvaluate,()=>this.notifyChange("state"),rs,this),this.addHandles([A(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),E),A(()=>[this.contentElement],()=>this._createVM(),E),Ge(()=>{if(!this._compileTask?.finished)return null;let t=this._compileTask.value,i=t?.dependencies;return[t,this.spatialReference,this.map,this.view,i?.has("view-scale")?this.view?.scale:null,i?.has("view-time-extent")?this.view?.timeExtent?.start:null,i?.has("view-time-extent")?this.view?.timeExtent?.end:null]},([t])=>this._evaluateThrottled(t))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){this._compileTask=Y(this._compileTask),this._evaluateTask=Y(this._evaluateTask),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null)}get contentElement(){return this._evaluateTask?.value}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{contentElement:e,contentElementViewModel:t}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!this._compileTask?.finished||!this._evaluateTask?.finished?"loading":e||t?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}_startCompile(){this._evaluateTask=Y(this._evaluateTask),this._compileTask=Y(this._compileTask),this._compileTask=Ae(async e=>{let{expressionInfo:t,graphic:i}=this;if(!t||!i)return null;let s=await Yt();ve(e);let r=await Xt({expressionInfo:t,arcade:s,graphic:i});return ve(e),r})}_startEvaluate(e){this._evaluateTask=Y(this._evaluateTask),this._evaluateTask=Ae(async t=>{let{graphic:i}=this;if(!e||!i)return null;let{interceptor:s,spatialReference:r,map:n,location:d,view:l}=this,p=await e.evaluate({graphic:i,interceptor:s,location:d,map:n,options:{signal:t},spatialReference:r,view:l});ve(t);let u=p;if(!u||u.declaredClass!=="esri.arcade.Dictionary")return null;let m=await u.castAsJsonAsync(t);ve(t);let h=m?.type,f=h==="media"?vi.fromJSON(m):h==="text"?ot.fromJSON(m):h==="fields"?yi.fromJSON(m):null;return f.type==="media"&&!f.mediaInfos||f.type==="fields"&&!f.fieldInfos||f.type==="text"&&!f.text?null:f})}};o([a()],W.prototype,"_compileTask",void 0),o([a()],W.prototype,"_evaluateTask",void 0),o([a({type:fi})],W.prototype,"expressionInfo",void 0),o([a({type:te})],W.prototype,"graphic",void 0),o([a({readOnly:!0})],W.prototype,"contentElement",null),o([a({readOnly:!0})],W.prototype,"contentElementViewModel",void 0),o([a()],W.prototype,"interceptor",void 0),o([a({type:tt})],W.prototype,"location",void 0),o([a()],W.prototype,"spatialReference",null),o([a({readOnly:!0})],W.prototype,"state",null),o([a()],W.prototype,"map",null),o([a()],W.prototype,"view",void 0),W=o([M("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],W);var Ue=W;var os="esri-feature",as={base:`${os}-expression`,loadingSpinnerContainer:`${os}__loading-container`},wt=class extends ${constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new Ue}initialize(){this.addHandles(A(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),E))}loadDependencies(){return G({loader:()=>import("./chunk-43NVUQHZ.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return c("div",{class:as.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return c("div",{class:as.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let s=e?i==="fields"?new _t({viewModel:e}):i==="media"?new bt({viewModel:e}):i==="text"?new ke({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};o([a({type:Ue})],wt.prototype,"viewModel",void 0),wt=o([M("esri.widgets.Feature.FeatureExpression")],wt);var ns=wt;var ls,Gt;(function(e){e.Text="text",e.Number="number",e.Date="date",e.Unsupported="unsupported"})(ls||(ls={})),function(e){e.CANNOT_BE_EMPTY="input-validation-error::cannot-be-empty",e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"}(Gt||(Gt={}));var ds=e=>{let t=[];if(e.formTemplate){let{description:i,title:s}=e.formTemplate;e.fields?.forEach(r=>{let n=s&&Tt(s,r.name),d=i&&Tt(i,r.name);(n||d)&&t.push(r.name)})}return t};var Jt=100,w=class extends ui.ClonableMixin(it.IdentifiableMixin(Q)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();let t=new AbortController;this._queryAbortController=t,await Ye(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,await Ye(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{let t=new AbortController;this._queryPageAbortController=t,await Ye(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryDebounced=Xe(this._queryController,Jt),this._queryFeatureCountDebounced=Xe(this._queryFeatureCountController,Jt),this._queryPageDebounced=Xe(this._queryPageController,Jt),this._query=async()=>{let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this.relatedLayer?.type!=="subtype-group"||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t?.signal}))))},this.addHandles([A(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),E),A(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),A(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,s=1,r=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,s),r))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let s=i.clone();return s.field=Pe(i.field,t),s}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){let{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new fe}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;if(!e?.loaded||!t||!i)return null;let s=e.type==="subtype-sublayer"&&e.parent&&ct(e.parent)?e.parent:e;return ki(t,s,i)??null}get relatedLayerKeyField(){let{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&t!=null?e.relationships?.find(i=>i.id===t)?.keyField:null}get relatedLayerKeyFields(){let{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(t=>t.keyField).filter(le)??[]:[]}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null&&t?.loaded?t.relationships?.find(({id:i})=>i===e)??null:null}get relationshipKey(){let{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new fe}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:s,_loaded:r,canLoad:n}=this;return t||n&&!r?"loading":e||i?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){let{layer:e,relatedLayer:t}=this;await e?.load(),await t?.load();let{_queryFeatureCountAbortController:i,activeCategory:s,canQuery:r,objectId:n,relatedLayerKeyField:d,relationshipId:l,relationshipKey:p,supportsCacheHint:u}=this;if(!r||!e||!t||n==null)return this._set("featureCount",0),void this._set("allCategories",null);if(t?.type==="subtype-group"&&!s){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),d&&p!=null){let{default:_}=await import("./chunk-OIVJLVHJ.js"),{uniqueValueInfos:I}=await _({layer:t,sqlWhere:`${d} = '${p}'`,field:t.subtypeField,signal:i?.signal}),x=I.map(({count:F,value:T})=>{let R=t.subtypes?.find(ae=>ae.code===T)?.name;return T!=null&&R?{count:F,value:T,name:R}:void 0}).filter(le);this._set("allCategories",x)}return}let{historicMoment:m,gdbVersion:h}=e,f=new Ne({cacheHint:u,gdbVersion:h,historicMoment:m,relationshipId:l,returnGeometry:!1,objectIds:[n],where:this._getRelationshipWhereClause(t)}),y=await e.queryRelatedFeaturesCount(f,{signal:i?.signal});this._set("allCategories",null),this._set("featureCount",y[n]||0)}_getRelationshipWhereClause(e){let{activeCategory:t}=this,i=e.createQuery(),s="subtypeField"in e?e.subtypeField:void 0,r=t&&s?`${s} = ${t.value}`:void 0,n=i.where;return n&&r?`(${n}) AND (${r})`:n??r}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}async _queryPage(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:s,featureCount:r}=this;!i||t<2||!r||this.relatedLayer?.type==="subtype-group"&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:s?.signal}))}async _queryRelatedFeatures(e){let{displayCount:t,featureCount:i,featurePage:s,featuresPerPage:r,layer:n,orderByFieldsFixedCasing:d,relatedLayer:l,relatedLayerKeyFields:p,relationshipId:u,showAllEnabled:m,supportsCacheHint:h}=this,{canQuery:f,objectId:y}=this;if(!f||!n||!l||y==null)return[];let _=m?((s-1)*r+i)%i:0,I=m?r:t,x=l.objectIdField,F="subtypeField"in l?l.subtypeField:void 0,T=[...d.map(B=>B.field),...ds(l),...p,x,F].filter(or),R=d.map(B=>`${B.field} ${B.order}`),{historicMoment:ae,gdbVersion:ne}=n,me=new Ne({orderByFields:R,start:_,num:I,outFields:T,cacheHint:h,historicMoment:ae,gdbVersion:ne,relationshipId:u,returnGeometry:!1,objectIds:[y],where:this._getRelationshipWhereClause(l)}),Ct=await n.queryRelatedFeatures(me,{signal:e?.signal}),Oe=Ct[y]?.features||[];return l.type==="subtype-group"&&F?Oe.forEach(B=>{let xt=B.attributes[F],Ze=l.findSublayerForSubtypeCode?.(xt);B.sourceLayer=Ze,B.layer=Ze}):Oe.forEach(B=>{B.sourceLayer=l,B.layer=l}),Oe}};function or(e){return e!=null&&e!==""}o([a()],w.prototype,"_loaded",void 0),o([a()],w.prototype,"_queryAbortController",void 0),o([a()],w.prototype,"_queryPageAbortController",void 0),o([a()],w.prototype,"_queryFeatureCountAbortController",void 0),o([a({value:1})],w.prototype,"featurePage",null),o([a()],w.prototype,"featuresPerPage",void 0),o([a({readOnly:!0})],w.prototype,"orderByFieldsFixedCasing",null),o([a({readOnly:!0})],w.prototype,"supportsCacheHint",null),o([a({readOnly:!0})],w.prototype,"canLoad",null),o([a({readOnly:!0})],w.prototype,"canQuery",null),o([a()],w.prototype,"activeCategory",void 0),o([a({readOnly:!0})],w.prototype,"allCategories",void 0),o([a({readOnly:!0})],w.prototype,"allCategoriesCount",null),o([a({readOnly:!0})],w.prototype,"categories",null),o([a()],w.prototype,"description",void 0),o([a({value:3})],w.prototype,"displayCount",null),o([a({type:te})],w.prototype,"graphic",void 0),o([a({readOnly:!0})],w.prototype,"itemDescriptionFieldName",null),o([a()],w.prototype,"layer",void 0),o([a()],w.prototype,"map",void 0),o([a({readOnly:!0})],w.prototype,"objectId",null),o([a({readOnly:!0})],w.prototype,"objectIdField",null),o([a()],w.prototype,"orderByFields",void 0),o([a({readOnly:!0})],w.prototype,"relatedFeatures",null),o([a({readOnly:!0})],w.prototype,"relatedLayer",null),o([a({readOnly:!0})],w.prototype,"relatedLayerKeyField",null),o([a({readOnly:!0})],w.prototype,"relatedLayerKeyFields",null),o([a({readOnly:!0})],w.prototype,"relationship",null),o([a({readOnly:!0})],w.prototype,"relationshipKey",null),o([a({readOnly:!0})],w.prototype,"relationshipKeyField",null),o([a({readOnly:!0})],w.prototype,"featureCount",void 0),o([a({readOnly:!0})],w.prototype,"relatedFeatureViewModels",null),o([a()],w.prototype,"relationshipId",void 0),o([a()],w.prototype,"showAllEnabled",void 0),o([a()],w.prototype,"state",null),o([a()],w.prototype,"title",void 0),w=o([M("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],w);var He=w;var It,Mt="esri-feature",We=`${Mt}-relationship`,ue={base:We,listContainer:`${We}__list`,listItem:`${We}__list-item`,listItemHidden:`${We}__list-item--hidden`,listContainerQuerying:`${We}__list--querying`,featureObserver:`${Mt}__feature-observer`,stickySpinnerContainer:`${Mt}__sticky-loading-container`,loadingSpinnerContainer:`${Mt}__loading-container`},cs={title:!0,description:!0},D=It=class extends ${constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType="feature-relationship",this.headingLevel=2,this.viewModel=new He,this.messages=null,this.messagesCommon=null,this.visibleElements=g({},cs),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:s,relatedFeatures:r,featuresPerPage:n,featurePage:d}=this.viewModel;i==="ready"&&s&&r.length>=n*d&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new se,this.addHandles([A(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E),A(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),be(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return G({chip:()=>import("./chunk-3D46QYDW.js"),icon:()=>import("./chunk-A7SCRTXK.js"),list:()=>import("./chunk-BLHBX2NH.js"),"list-item":()=>import("./chunk-5G3JHIPS.js"),loader:()=>import("./chunk-43NVUQHZ.js"),notice:()=>import("./chunk-5ZX46MTW.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ke(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:s,allCategoriesCount:r}=this.viewModel;return!e&&s==="ready"&&(!!r&&(r>i||i===0)||!!t&&(t>i||i===0))}get displayListItems(){let{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){let{messages:e}=this,{featureCount:t,allCategories:i,allCategoriesCount:s}=this.viewModel;return _e(e?.numberRecords,{number:Lt(i?s:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){let{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return g(g({},cs),e)}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(ue.base,b.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}async _selectCategory(e){let{flowItems:t,featureVisibleElements:i,viewModel:s}=this;t&&(s.activeCategory=e,s.showAllEnabled=!0,t.push(new It({flowItems:t,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:s})))}async _selectRecord(e){let{flowItems:t,featureVisibleElements:i}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:s}=await import("./chunk-CILU6NBL.js");t.push(new s({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:i}))}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:i}=this;t.showAllEnabled=!0;let s=new It({flowItems:e,featureVisibleElements:i,visibleElements:{title:!1,description:!1},viewModel:t});e.push(s)}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:ue.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("calcite-loader",{inline:!0,label:""})}_renderLoading(){return c("div",{class:ue.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return c("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=J(this.container)?"chevron-left":"chevron-right";return c("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderCategory(e){let{count:t,name:i,value:s}=e,r=Lt(t);return c("calcite-list-item",{class:ue.listItem,disabled:!t,key:s,label:i,onCalciteListItemSelect:()=>this._selectCategory(e)},c("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),this._renderChevronIconNode())}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let s=e.state==="loading";return c("calcite-list-item",{class:this.classes(ue.listItem,{[ue.listItemHidden]:s}),description:Fe(e.description??""),key:e.uid,label:Fe(i),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?c("calcite-list-item",{description:this.allItemsDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return c("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return c("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:ue.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e,categories:t}=this.viewModel;return c("calcite-list",{displayMode:"flat",label:this.messages?.relatedFeaturesList},t?.map(i=>this._renderCategory(i))??e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return c("div",{class:this.classes(ue.listContainer,{[ue.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(A(()=>[i.title,i.state],()=>this.scheduleRender(),E),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;await ri(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};o([a()],D.prototype,"_relatedFeatureIntersectionObserverNode",void 0),o([a({readOnly:!0})],D.prototype,"displayShowAllButton",null),o([a({readOnly:!0})],D.prototype,"displayListItems",null),o([a({readOnly:!0})],D.prototype,"allItemsDescription",null),o([a()],D.prototype,"description",null),o([a()],D.prototype,"featureVisibleElements",void 0),o([a()],D.prototype,"flowItems",void 0),o([a()],D.prototype,"flowType",void 0),o([a()],D.prototype,"headingLevel",void 0),o([a()],D.prototype,"title",null),o([a({type:He})],D.prototype,"viewModel",void 0),o([a(),P("esri/widgets/Feature/t9n/Feature")],D.prototype,"messages",void 0),o([a(),P("esri/t9n/common")],D.prototype,"messagesCommon",void 0),o([a()],D.prototype,"visibleElements",void 0),o([X("visibleElements")],D.prototype,"castVisibleElements",null),D=It=o([M("esri.widgets.Feature.FeatureRelationship")],D);var ps=D;var ei="esri-feature-utility-network-associations",us=`${ei}__loading-container`,Ft={base:ei,listContainer:`${ei}__list`,loadingContainer:us,loadingContainerSticky:`${us}--sticky`},Z=class extends ${constructor(e,t){super(e,t),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType="feature-utility-network-associations",this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new De,this.messages=null,this.messagesCommon=null,this.visibleElements=new zt}initialize(){this._featureElementInfo=new se,this.addHandles([A(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E)])}loadDependencies(){return G({icon:()=>import("./chunk-A7SCRTXK.js"),list:()=>import("./chunk-BLHBX2NH.js"),"list-item":()=>import("./chunk-5G3JHIPS.js"),loader:()=>import("./chunk-43NVUQHZ.js"),notice:()=>import("./chunk-5ZX46MTW.js")})}destroy(){this._featureElementInfo=Ke(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(Ft.base,b.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:Ft.loadingContainerSticky,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return c("div",{class:Ft.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noAssociations))}_renderAssociationType(e){let{viewModel:t}=this,i=this._getAssociationTypeTitle(e);return c("calcite-list-item",{description:Fe(e.description),key:`association-type-${e.type}`,label:Fe(i),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:t,listType:e,title:i})},c("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderAssociations(e){let{viewModel:t}=this;return t.source==="featureForm"||t.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){let{messages:e,viewModel:t}=this,{state:i,associationTypes:s}=t;return c("div",{class:Ft.listContainer,key:"list-container"},i==="ready"?c("div",null,c("calcite-list",{displayMode:"flat",label:e?.associationsList},s.map(r=>this._renderAssociations(r)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){let{messages:t}=this;if(e.title)return e.title;switch(e.type){case"attachment":return t.associationsAttachments;case"connectivity":return t.associationsConnectivity;case"structure":return t.associationsStructure;case"content":return t.associationsContents;case"container":return t.associationsContainer}}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,s=t.title&&this.title;this._featureElementInfo?.set({description:i,title:s,headingLevel:e})}};o([a({constructOnly:!0})],Z.prototype,"onSelectAssociationType",void 0),o([a()],Z.prototype,"flowType",void 0),o([a()],Z.prototype,"flowItems",void 0),o([a()],Z.prototype,"parentFeatureViewModel",void 0),o([a()],Z.prototype,"featureVisibleElements",void 0),o([a()],Z.prototype,"description",null),o([a()],Z.prototype,"headingLevel",void 0),o([a()],Z.prototype,"title",null),o([a({type:De})],Z.prototype,"viewModel",void 0),o([a(),P("esri/widgets/Feature/t9n/Feature")],Z.prototype,"messages",void 0),o([a(),P("esri/t9n/common")],Z.prototype,"messagesCommon",void 0),o([a({type:zt,nonNullable:!0})],Z.prototype,"visibleElements",void 0),Z=o([M("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],Z);var ms=Z;var At=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=s=>{}),this.preRequestCallback||(this.preLayerQueryCallback=s=>{})}};var Se,hs=1,fs="content-view-models",ys="relationship-view-models",ar="association-view-models",gs={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0},k=Se=class extends it.IdentifiableMixin(Q){constructor(e){super(e),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=g({},gs),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._graphicChangedThrottled=Re(this._graphicChanged,()=>this.notifyChange("waitingForContent"),hs,this),this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent||t.type==="utility-network-associations"&&!!i.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=Re(this._evaluateExpressionAttributes,()=>this.notifyChange("waitingForContent"),hs,this),this.addHandles([A(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),E),Ge(()=>{if(!this._graphicChangedTask?.finished||this._graphicChangedTask.value==null)return null;let t=this._graphicChangedTask.value,i=t?.expressionInfos?.dependencies;return[t,i?.has("view-scale")?this.view?.scale:null,i?.has("view-time-extent")?this.view?.timeExtent?.start:null,i?.has("view-time-extent")?this.view?.timeExtent?.end:null]},([t])=>this._evaluateExpressionAttributesThrottled(t))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=Y(this._graphicChangedTask),this._evaluateExpressionAttributesTask=Y(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Ai(Dt(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return at(this.graphic)}castAbilities(e){return g(g({},gs),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??ai}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){let{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:i,_evaluateExpressionAttributesTask:s,_associationVMAbortController:r}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||i!=null&&!i.finished||s!=null&&!s.finished||!!r}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof oe&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof oe&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof oe&&t.previous()}async updateGeometry(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;await i?.load();let s=i?.objectIdField;if(!s||!e||!i)return;let r=e?.attributes?.[s];if(r==null)return;let n=[r];if(!e.geometry){let d=await Ci({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}),l=d?.geometry;l&&(e.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){this._evaluateExpressionAttributesTask=Y(this._evaluateExpressionAttributesTask),this._graphicChangedTask=Y(this._graphicChangedTask),this._graphicChangedTask=Ae(async e=>{this._error=null,this._clear();let{graphic:t}=this;try{if(!t)return null;let{_sourceLayer:i,_effectivePopupTemplate:s}=this,r=this.spatialReference;await xi({graphic:t,popupTemplate:s,layer:i,spatialReference:r},{signal:e});let[{value:n},{value:d}]=await he([this._getContent(),this._getTitle()]),[,{value:l}]=await he([this._checkForRelatedFeatures({signal:e}),ss(s?.expressionInfos,t)]);return{expressionInfos:l,content:n,title:d}}catch(i){throw Et(i)||(this._error=i,de.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate})),i}})}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):e.type==="utility-network-associations"?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(le):typeof e=="string"?this._compileText(new ot({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(ys),this.removeHandles(fs),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),s=t?.getObjectId();return i!=null&&s!=null&&i===s}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:s,spatialReference:r,timeZone:n}=this;t?.filter(Boolean).forEach(d=>{e.some(l=>this._matchesFeature(l,d))||e.add(new Se({abilities:{relationshipContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:d}))}),e.forEach(d=>{t?.find(p=>this._matchesFeature(d,p))||e.remove(d)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:s,contentElementViewModel:r}=e,n=s?.type;r&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createFieldsVMParams(s,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:s,contentElementIndex:t,formattedAttributes:i}),r.set(this._createMediaVMParams(s,t))),n==="text"&&r.set(this._createTextVMParams(s)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:s,relationshipId:r,title:n,description:d}=e,{_sourceLayer:l,graphic:p,map:u}=this;if(!ct(l))return;let m=new He(g({displayCount:i,graphic:p,orderByFields:s,relationshipId:r,layer:l,map:u},this._compileTitleAndDesc({title:n,description:d})));return this.contentViewModels[t]=m,this.addHandles(be(()=>m.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(m)),ys),e}_matchesGlobalFeature(e,t){let i=e?.association.globalId,s=t?.association.globalId;return i!=null&&s!=null&&i===s}async _setUpUtilityNetworkAssociationsViewModels(e,t,i){let{view:s,spatialReference:r,timeZone:n}=this;e.forEach((l,p)=>{let u=t.get(p);u?l.forEach(m=>{u.find(h=>this._matchesGlobalFeature(m,h))||(l.remove(m),l.length===0&&e.delete(p))}):(l.removeAll(),e.delete(p))}),t.forEach((l,p)=>{let u=e.get(p)||new fe;l?.filter(Boolean).forEach(m=>{u.some(h=>this._matchesGlobalFeature(h,m))||u.add({association:m.association,featureViewModel:new Se({abilities:{utilityNetworkAssociationsContent:!1},map:i,view:s,spatialReference:r,timeZone:n,graphic:m.feature}),terminalName:m.terminalName})}),e.set(p,u)});let d=new AbortController;this._associationVMAbortController=d,await this._sortListObjectsByTitle(e,{signal:d.signal}),this._associationVMAbortController===d&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(e,t){for(let i of e.values()){let s=i.map(r=>li(()=>r.featureViewModel.state==="ready",t?.signal));await Promise.all(s),i.sort(this._compareByFeatureTitle)}}_compareByFeatureTitle(e,t){let i=qt(e.featureViewModel),s=qt(t.featureViewModel);return i.localeCompare(s,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(e,t){let{displayCount:i,title:s,description:r,associationTypes:n}=e,{_sourceLayer:d,graphic:l,map:p}=this;if(!Ii(d))return;let u=new De(g({graphic:l,displayCount:i,associationTypes:n,layer:d,map:p},this._compileTitleAndDesc({title:s,description:r})));return this.contentViewModels[t]=u,this.addHandles([A(()=>u.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(u.associationViewModels,u.associationFeatures,u.map))],ar),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:s,map:r,spatialReference:n,view:d,location:l}=this,p=new Ue({expressionInfo:i,graphic:s,interceptor:Se.interceptor,map:r,spatialReference:n,view:d,location:l});return this.contentViewModels[t]=p,this.addHandles(A(()=>p.contentElementViewModel,()=>this._setExpressionContentVM(p,t),E),fs),e}_compileAttachments(e,t){let{graphic:i}=this,{description:s,title:r,orderByFields:n}=e;return this.contentViewModels[t]=new Be(g({graphic:i,orderByFields:n},this._compileTitleAndDesc({title:r,description:s}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:s,destroyer:r}=e;return this.contentViewModels[t]=new Ie({graphic:i,creator:s,destroyer:r}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:s,graphic:r,formattedAttributes:n}=this,d=r?.attributes,l=this._expressionAttributes,p=n.global;return{title:ce({attributes:d,fieldInfoMap:i,globalAttributes:p,expressionAttributes:l,layer:s,text:e}),description:ce({attributes:d,fieldInfoMap:i,globalAttributes:p,expressionAttributes:l,layer:s,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,s=this.formattedAttributes,r=g(g({},s?.global),s?.content[t]),n=e?.fieldInfos||i?.fieldInfos,d=n?.filter(({fieldName:m})=>!!m&&(lt(m)||ie(m)||r.hasOwnProperty(m))),l=i?.expressionInfos,{description:p,title:u}=e;return g({attributes:r,expressionInfos:l,fieldInfos:d},this._compileTitleAndDesc({title:u,description:p}))}_compileFields(e,t){let i=e.clone(),s=new Me(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=s,i.fieldInfos=s.formattedFieldInfos.slice(),i}_createMediaVMParams(e,t){let{abilities:i,graphic:s,_fieldInfoMap:r,_effectivePopupTemplate:n,relatedInfos:d,_sourceLayer:l,_expressionAttributes:p}=this,u=this.formattedAttributes,m=s?.attributes??{},{description:h,mediaInfos:f,title:y}=e;return g({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:m,isAggregate:s?.isAggregate,layer:l,fieldInfoMap:r,formattedAttributes:g(g({},u?.global),u?.content[t]),expressionAttributes:p,mediaInfos:f,popupTemplate:n,relatedInfos:d},this._compileTitleAndDesc({title:y,description:h}))}_compileMedia(e,t){let i=e.clone(),s=new oe(this._createMediaVMParams(e,t));return i.mediaInfos=s.formattedMediaInfos.slice(),this.contentViewModels[t]=s,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:s,_expressionAttributes:r}=this;if(e&&e.text){let n=t?.attributes??{},d=this.formattedAttributes?.global??{};e.text=ce({attributes:n,fieldInfoMap:i,globalAttributes:d,expressionAttributes:r,layer:s,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new Ie(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:s}=this;if(!e)return;let{lastEditInfoEnabled:r}=e,n=t?.editFieldsInfo;return r&&n?Fi(n,i?.attributes,s,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:s,_expressionAttributes:r}=this,n=s?.attributes??{},d=this.formattedAttributes?.global??{};return ce({attributes:n,fieldInfoMap:t,globalAttributes:d,expressionAttributes:r,layer:i,text:e})}async _getTitle(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ce({type:"title",value:e?.title,event:{graphic:t}}):null}async _getContent(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ce({type:"content",value:e?.content,event:{graphic:t}}):null}_evaluateExpressionAttributes({title:e,content:t,expressionInfos:i}){this._evaluateExpressionAttributesTask=Y(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=Ae(async s=>{let{graphic:r,map:n,view:d,spatialReference:l,location:p}=this;try{if(!r)return;let u;if(i!=null){let m=[];for(let[h,f]of i.expressions.entries())f!=null?m.push(f.evaluate({graphic:r,interceptor:Se.interceptor,location:p,map:n,options:{signal:s},spatialReference:l,view:d}).then(y=>[h,ts(y)]).catch(()=>[h,void 0])):m.push(Promise.resolve([h,void 0]));u=Object.fromEntries(await Promise.all(m)),ve(s)}this._expressionAttributes=u,this._graphicExpressionAttributes=g(g({},r.attributes),u),this._set("formattedAttributes",this._createFormattedAttributes(t)),this._set("title",this._compileTitle(e)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(t)||null)}catch(u){Et(u)||(this._error=u,de.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:u,graphic:r,popupTemplate:this._effectivePopupTemplate}))}})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:s,graphic:r,relatedInfos:n,_sourceLayer:d,_fieldInfoMap:l,_graphicExpressionAttributes:p,timeZone:u}=this;i.content[t]=mt({fieldInfos:s?.fieldInfos,graphic:r,attributes:g(g({},p),e.attributes),layer:d,fieldInfoMap:l,relatedInfos:n,timeZone:u})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:s,relatedInfos:r,_sourceLayer:n,_fieldInfoMap:d,_graphicExpressionAttributes:l,timeZone:p}=this;i.content[t]=mt({fieldInfos:e.fieldInfos,graphic:s,attributes:g(g({},l),e.attributes),layer:n,fieldInfoMap:d,relatedInfos:r,timeZone:p})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:s,_sourceLayer:r,_fieldInfoMap:n,_graphicExpressionAttributes:d,timeZone:l}=this,p=t?.fieldInfos,u={global:mt({fieldInfos:p,graphic:i,attributes:d,layer:r,fieldInfoMap:n,relatedInfos:s,timeZone:l}),content:[]};return Array.isArray(e)&&e.forEach((m,h)=>{m.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:m,contentElementIndex:h,formattedAttributes:u}),m.type==="media"&&this._createMediaFormattedAttributes({contentElement:m,contentElementIndex:h,formattedAttributes:u})}),u}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Dt(i),e)}async _queryRelatedInfos(e,t,i){let{relatedInfos:s,_sourceLayer:r}=this;s.clear();let n=r?.associatedLayer!=null?await r?.associatedLayer.load(i):r;if(!n||!e||!t.filter(u=>!!u.fieldName&&ie(u.fieldName))?.length)return;t.forEach(u=>this._configureRelatedInfo(u,n));let l=await Xi({relatedInfos:s,layer:n},i);Object.keys(l).forEach(u=>{let m=s.get(u.toString()),h=l[u]?.value;m&&h&&(m.layerInfo=h.data)});let p=await Gi({graphic:e,relatedInfos:s,layer:n},i);Object.keys(p).forEach(u=>{Yi(p[u]?.value,s.get(u.toString()))})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,s=Le(e.fieldName||"");if(!s)return;let{layerId:r,fieldName:n}=s;if(!r)return;let d=i.get(r.toString())||Ki(r,t);d&&(Ji({relatedInfo:d,fieldName:n,fieldInfo:e}),this.relatedInfos.set(r,d))}};k.interceptor=new At(Ti,Ei),o([a()],k.prototype,"_error",void 0),o([a()],k.prototype,"_graphicChangedTask",void 0),o([a()],k.prototype,"_evaluateExpressionAttributesTask",void 0),o([a()],k.prototype,"_associationVMAbortController",void 0),o([a({readOnly:!0})],k.prototype,"_effectivePopupTemplate",null),o([a({readOnly:!0})],k.prototype,"_fieldInfoMap",null),o([a({readOnly:!0})],k.prototype,"_sourceLayer",null),o([a()],k.prototype,"abilities",void 0),o([X("abilities")],k.prototype,"castAbilities",null),o([a({readOnly:!0})],k.prototype,"content",void 0),o([a({readOnly:!0})],k.prototype,"contentViewModels",void 0),o([a()],k.prototype,"description",void 0),o([a({type:Boolean})],k.prototype,"defaultPopupTemplateEnabled",void 0),o([a({readOnly:!0})],k.prototype,"isTable",null),o([a({readOnly:!0})],k.prototype,"state",null),o([a({readOnly:!0})],k.prototype,"formattedAttributes",void 0),o([a({type:te,value:null})],k.prototype,"graphic",null),o([a({readOnly:!0})],k.prototype,"lastEditInfo",void 0),o([a({type:tt})],k.prototype,"location",void 0),o([a({readOnly:!0})],k.prototype,"relatedInfos",void 0),o([a({type:ci})],k.prototype,"spatialReference",null),o([a()],k.prototype,"timeZone",null),o([a({readOnly:!0})],k.prototype,"title",void 0),o([a()],k.prototype,"map",null),o([a({readOnly:!0})],k.prototype,"waitingForContent",null),o([a()],k.prototype,"view",void 0),k=Se=o([M("esri.widgets.Feature.FeatureViewModel")],k);var ti=k;var z="esri-feature",S={base:z,container:`${z}__size-container`,title:`${z}__title`,main:`${z}__main-container`,btn:`${z}__button`,icon:`${z}__icon`,content:`${z}__content`,contentNode:`${z}__content-node`,contentNodeText:`${z}__content-node--text`,contentElement:`${z}__content-element`,text:`${z}__text`,lastEditedInfo:`${z}__last-edited-info`,fields:`${z}__fields`,fieldHeader:`${z}__field-header`,fieldData:`${z}__field-data`,fieldDataDate:`${z}__field-data--date`,loadingSpinnerContainer:`${z}__loading-container`};var vs=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>yt(i)&&!i.destroyed?c("div",{class:S.contentNode,key:i},i.render()):i instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:i,class:S.contentNode,key:i}):ji(i)?c("div",{afterCreate:this._attachToNode,bind:i.domNode,class:S.contentNode,key:i}):null}_attachToNode(i){let s=this;i.appendChild(s)}};return t=o([M("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var _s={title:!0,content:!0,lastEditedInfo:!0},O=class extends vs($){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType="feature",this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=g({},_s),this.viewModel=new ti}initialize(){this.addHandles(A(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),E))}loadDependencies(){return G({notice:()=>import("./chunk-5ZX46MTW.js"),loader:()=>import("./chunk-43NVUQHZ.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return g(g({},_s),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=c("div",{class:S.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return c("div",{class:this.classes(S.base,b.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return c("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?c("div",{key:"error-title",slot:"title"},e.errorMessage):null,c("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return c("div",{class:S.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?c("div",{class:S.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?c(ft,{class:S.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?c("div",{class:S.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:c("div",{class:this.classes(S.contentNode,S.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);case"utility-network-associations":return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:s}=t.viewModel;return i==="loading"||s.length>0?c("div",{class:this.classes(S.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:S.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:S.contentElement,key:this._buildKey("utility-network-association-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?c("div",{class:S.contentElement,key:this._buildKey("expression-element",e)},t.render()):null}_renderCustom(e,t){let{creator:i}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:i?c("div",{class:S.contentElement,key:this._buildKey("custom-element",t)},s.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:S.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:S.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:s,user:r}=i,n=i.type==="edit"?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,d=_e(n,{date:s,user:r});return c("div",{class:this.classes(S.lastEditedInfo,S.contentElement),key:"edit-info-element"},d)}_renderText(e,t){let i=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:i?c("div",{class:this.classes(S.contentElement,S.text),key:this._buildKey("text-element",t)},s.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:i,viewModel:s}=this,r=s?.content,{contentViewModels:n}=s;if(Array.isArray(r))r.forEach((d,l)=>{if(d.type==="attachments"&&(this._contentWidgets[l]=new Bi({displayType:d.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:n[l]})),d.type==="fields"&&(this._contentWidgets[l]=new _t({viewModel:n[l]})),d.type==="media"&&(this._contentWidgets[l]=new bt({viewModel:n[l]})),d.type==="text"&&(this._contentWidgets[l]=new ke({viewModel:n[l]})),d.type==="custom"&&(this._contentWidgets[l]=new ke({viewModel:n[l]})),d.type==="expression"&&(this._contentWidgets[l]=new ns({viewModel:n[l]})),d.type==="relationship"){let p=new ps({flowItems:i,featureVisibleElements:t,viewModel:n[l]});this._contentWidgets[l]=p}if(d.type==="utility-network-associations"){let p=async m=>{let{viewModel:h,listType:f,title:y}=m;if(!i)return;h.activeAssociationType=f;let{default:_}=await import("./chunk-5T7TEFOM.js"),I=new _({viewModel:h,parentFeatureViewModel:s,listType:f,title:y,featureVisibleElements:t,description:s.title,flowItems:i});i.push(I)},u=new ms({flowItems:i,onSelectAssociationType:p,parentFeatureViewModel:s,featureVisibleElements:t,viewModel:n[l]});this._contentWidgets[l]=u}},this);else{let d=n[0];d&&!d.destroyed&&(this._contentWidgets[0]=new ke({viewModel:d}))}this.scheduleRender()}};o([a()],O.prototype,"flowType",void 0),o([a()],O.prototype,"graphic",null),o([a()],O.prototype,"defaultPopupTemplateEnabled",null),o([a()],O.prototype,"flowItems",void 0),o([a()],O.prototype,"headingLevel",void 0),o([a({readOnly:!0})],O.prototype,"isTable",null),o([a()],O.prototype,"icon",null),o([a()],O.prototype,"label",null),o([a()],O.prototype,"location",null),o([a(),P("esri/widgets/Feature/t9n/Feature")],O.prototype,"messages",void 0),o([a(),P("esri/t9n/common")],O.prototype,"messagesCommon",void 0),o([a()],O.prototype,"spatialReference",null),o([a()],O.prototype,"timeZone",null),o([a({readOnly:!0})],O.prototype,"title",null),o([a()],O.prototype,"visibleElements",void 0),o([X("visibleElements")],O.prototype,"castVisibleElements",null),o([a()],O.prototype,"map",null),o([a()],O.prototype,"view",null),o([a({type:ti})],O.prototype,"viewModel",void 0),O=o([M("esri.widgets.Feature")],O);var dm=O;export{Re as a,xe as b,ft as c,Is as d,As as e,ti as f,S as g,vs as h,dm as i};
