import{b as j,i as z,l as q,o as G,q as O}from"./chunk-7S2234XQ.js";import{d as F}from"./chunk-2XYAAYOE.js";import{a as C}from"./chunk-NIYDRLW4.js";import{b as A}from"./chunk-6DGDLLNL.js";import{b as D}from"./chunk-4G7UTTZJ.js";import{a as P}from"./chunk-BOVYXYHK.js";import{a as x}from"./chunk-4XZ6X7MQ.js";import{v as I}from"./chunk-CKJ56T2Q.js";async function Y(n,p,f,v,a){let{elevationProvider:l,renderCoordsHelper:s}=n,{elevationInfo:d}=p,{pointsInFeatures:b,spatialReference:m}=v,u=x.fromJSON(m),g=G(d,!0),h=await q(g,u,a);I(a);let c=[],e=new Set,r=new Set,o=new O,t=C(0,0,0,x.WGS84),i=new z,E=P();t.spatialReference=u;let B=n.elevationProvider.spatialReference??n.spatialReference;for(let{objectId:S,points:R}of b){let y=f(S);if(y==null){for(let w of R)c.push(w.z??0);e.add(S);continue}y.isDraped&&r.add(S);let H=y.graphic.geometry;o.setFromElevationInfo(F(H,d)),o.updateFeatureExpressionInfoContext(h,y.graphic,p);for(let{x:w,y:J,z:N}of R)t.x=w,t.y=J,t.z=N??0,await A(t,E,B,0,{signal:a}),j(E,l,o,s,i),c.push(i.z)}return{elevations:c,drapedObjectIds:r,failedObjectIds:e}}async function ee(n,p,f){if(n==null||p.candidates.length===0)return k;let v=n.graphics3DGraphicsByObjectID??n.graphics3DGraphics,a=[],l=[],{renderer:s}=n,d=s!=null&&"arcadeRequired"in s&&s.arcadeRequired?D():null,b=async(e,{graphic:r,graphics3DSymbol:o})=>{let t=await d,i=await n.getRenderingInfoAsync(r,s,t,{signal:f});return i==null?[]:o.queryForSnapping(e,u,i,f)},{candidates:m,spatialReference:u}=p;for(let e=0;e<m.length;++e){let r=m[e],{objectId:o}=r,t=typeof o=="number"?v?.get(o):void 0;if(t==null)continue;let{graphics3DSymbol:i}=t;i.symbologySnappingSupported&&(a.push(b(r,t)),l.push(e))}if(a.length===0)return k;let g=await Promise.all(a);I(f);let h=[],c=[];for(let e=0;e<g.length;++e){let r=g[e],o=l[e];for(let t of r)h.push(t),c.push(o)}return{candidates:h,sourceCandidateIndices:c}}var k={candidates:[],sourceCandidateIndices:[]};export{Y as a,ee as b};
